[{"data":1,"prerenderedAt":3256},["ShallowReactive",2],{"randomIndex/archives/page/11/":3,"index-page-11-zh":4,"language-switch-/archives/page/11/-en":3254,"posts-nums-total-zh":3255},3,[5,113,586,710,1447,1830,2188,2899,3006,3112],{"title":6,"date":7,"path":8,"tags":9,"body":11},"记录一次原创文章被抄袭","2021-09-21","/2021/09/21/csdn-copied-my-article",[10],"Blog",{"type":12,"value":13,"toc":109},"minimark",[14,26,29,36,39,42,48,55,61,67,73,76,100,106],[15,16,17,18,25],"p",{},"今天在网站自搜的时候偶然间发现了一个叫「程序员宝宝」的站点转载了我去年在知乎专栏上发的一篇文章",[19,20,24],"a",{"href":21,"rel":22},"https://zhuanlan.zhihu.com/p/141107518",[23],"nofollow","《Ubuntu下对deepin-wine的使用详解》","。",[15,27,28],{},"转载的质量并不高，超链接都没有转载上去，只有干巴巴的图片和文字。翻到结尾处，我一口老血喷出。",[15,30,31],{},[32,33],"img",{"alt":34,"src":35},"都不知道哪里来的版权申明","https://static.031130.xyz/uploads/2024/08/12/62f3cacc1ff3f.webp",[15,37,38],{},"我就纳闷了，我作为原创博主，自己都没有给这篇文章挂上CC的版权协议，怎么就有人自称是原创给我挂上了CC协议，要知道我知乎还明确勾选了「转载需要申请」呢。",[15,40,41],{},"抱着吃瓜的心态在谷歌上搜索，我发现了五篇抄袭我的文章。CSDN三篇，还有「程序员宝宝」和「程序员宅基地」使用相同UI的、被我怀疑是机器人搬运的站点。",[15,43,44],{},[32,45],{"alt":46,"src":47},"谷歌搜索结果","https://static.031130.xyz/uploads/2024/08/12/62f3cad01576d.webp",[15,49,50,51],{},"CSDN那边，我在页面页脚处找到了「在线客服」，注册帐号后联系了客服，客服反应非常迅速，",[52,53,54],"strong",{},"5分钟内就对抄袭文章进行了下架处理，这点值得表扬。",[15,56,57],{},[32,58],{"alt":59,"src":60},"CSDN客服聊天记录1","https://static.031130.xyz/uploads/2024/08/12/62f3cad3ceaa6.webp",[15,62,63],{},[32,64],{"alt":65,"src":66},"CSDN客服聊天记录2","https://static.031130.xyz/uploads/2024/08/12/62f3cad833827.webp",[15,68,69],{},[32,70],{"alt":71,"src":72},"CSDN客服聊天记录3","https://static.031130.xyz/uploads/2024/08/12/62f3cadacac4d.webp",[15,74,75],{},"至于「程序员宝宝」和「程序员宅基地」这两个站点，在他们的版权申明中写得很清楚。",[77,78,79,84,87,97],"blockquote",{},[15,80,81],{},[52,82,83],{},"如果你是文章作者：",[15,85,86],{},"请通过邮件联系我们，邮件内容包括：",[88,89,90,94],"ol",{},[91,92,93],"li",{},"待删除的文章链接",[91,95,96],{},"发件人是待删除文章作者的证明（如果发件人邮箱地址能证明你是文章作者，此项内容可以为空）",[15,98,99],{},"我们会在收到邮件后7个工作日内进行处理。",[15,101,102,103],{},"但我找遍了整个网站，",[52,104,105],{},"根本没有发现站点方的邮箱。",[15,107,108],{},"不知诸位有何解决方案？",{"title":110,"searchDepth":111,"depth":111,"links":112},"",2,[],{"title":114,"date":115,"path":116,"tags":117,"body":120},"使用AUR(Helper)安装软件时究竟发生了什么？对于常见的构建错误如何解决？","2021-09-11 19:22:29","/2021/09/11/detailed-explanation-for-aur",[118,119],"Linux","Archlinux",{"type":12,"value":121,"toc":572},[122,127,132,141,148,157,192,195,198,225,228,250,256,260,267,273,277,280,284,291,297,300,333,335,338,344,350,354,483,487,490,497,504,517,521,524,526,529,535,538,557,560,568],[77,123,124],{},[15,125,126],{},"虽然对于没有能力手动修改/编写PKGBUILD的Arch用户其实是不应该使用AUR中的包的，这些软件的PKGBUILD可以由个人随意发布，并不能保证安全性，但是作为Archlinux的特色，但随着AUR Helper的趋于便利，还是吸引了不少小白使用AUR。本文将主要讲一讲 AUR Helper 帮助我们安装软件时到底做了些什么事情，并提供一些使用AUR Helper构建时常见错误的解决方案。",[128,129,131],"h2",{"id":130},"partⅰ基本原理","PartⅠ基本原理",[133,134,136,140],"h3",{"id":135},"makepkg是如何工作的",[137,138,139],"code",{},"makepkg","是如何工作的？",[15,142,143,144,147],{},"以钉钉举例，我们可以从AUR上使用 ",[137,145,146],{},"git clone https://aur.archlinux.org/dingtalk-bin.git"," 获取到由这个包的维护者为我们提前写好的构建脚本。他的目录大概是长成下面这个样子:",[149,150,155],"pre",{"className":151,"code":153,"language":154},[152],"language-text","dingtalk-bin\n├── com.alibabainc.dingtalk.desktop\n├── dingtalk.sh\n├── .git\n├── .gitignore\n├── PKGBUILD\n├── service-terms-zh\n└── .SRCINFO\n","text",[137,156,153],{"__ignoreMap":110},[158,159,160,167,173,179],"ul",{},[91,161,162,163,166],{},"其中，",[137,164,165],{},".git","是git的工作目录，可以忽视。",[91,168,169,172],{},[137,170,171],{},".gitignore","属于git的配置文件之一，我们也不用管。",[91,174,175,178],{},[137,176,177],{},"PKGBUILD","是这个目录下最重要的东西，是一个用于提供参数的脚本。makepkg通过执行PKGBUILD脚本来获取到参数，自动进行下载和构建过程。",[91,180,181,184,185,184,188,191],{},[137,182,183],{},"service-terms-zh",", ",[137,186,187],{},"com.alibabainc.dingtalk.desktop",[137,189,190],{},"dingtalk.sh","是包里所需要用到的东西。",[193,194],"hr",{},[15,196,197],{},"当我们cd到这个目录下执行makepkg时，",[15,199,200,201,204,205,208,209,212,213,216,217,220,221,224],{},"makepkg会调用",[137,202,203],{},"curl"," / ",[137,206,207],{},"git","下载PKGBUILD中",[137,210,211],{},"source=()","部分中以",[137,214,215],{},"http(s)","协议头或者",[137,218,219],{},"git+","开头的链接，这些东西将会被下载到这个目录的",[137,222,223],{},"src","文件夹下。",[15,226,227],{},"对于curl下载的东西，makepkg会使用校验码核对下载到的文件是否完整、是否是当初这个包的维护者下载到的这一个。",[15,229,230,231,234,235,234,238,241,242,246,247,224],{},"校验通过后，makepkg会依次执行",[137,232,233],{},"prepare(){}","、",[137,236,237],{},"build(){}",[137,239,240],{},"package(){}","函数中的命令陆续完成",[243,244,245],"em",{},"准备、编译","过程，并将最终要打进包里的文件放置到",[137,248,249],{},"pkg",[15,251,252,253,255],{},"最后，makepkg将会将",[137,254,249],{},"文件夹的内容压缩成包。",[133,257,259],{"id":258},"aur-helper-干了些什么","AUR Helper 干了些什么",[15,261,262,263,266],{},"我们还是以钉钉为例，看看我们执行",[137,264,265],{},"yay dingtalk-bin","时到底发生了什么。",[15,268,269],{},[32,270],{"alt":271,"src":272},"当你使用yay安装软件到底发生了什么","https://static.031130.xyz/uploads/2024/08/12/62f3cdb03ec8c.webp",[128,274,276],{"id":275},"partⅱ常见错误解决方案","PartⅡ常见错误解决方案",[15,278,279],{},"如果有其他情况觉得可以完善的，欢迎在评论区留言。",[133,281,283],{"id":282},"_1-base-devel-没有安装","1. base-devel 没有安装",[15,285,286,287,290],{},"正如上面所说的，没有安装",[137,288,289],{},"base-devel","组，赶紧补上!",[15,292,293,294,296],{},"由于",[137,295,289],{},"并不是一个具体的包，而是由多个包构成的包组，其实并没有很好的方法来检测你是否已经安装。",[15,298,299],{},"所以如果你不确定，你也可以执行下面的命令来确保自己已经安装。",[149,301,305],{"className":302,"code":303,"language":304,"meta":110,"style":110},"language-bash shiki shiki-themes one-light one-dark-pro","sudo pacman -S base-devel --noconfirm --needed\n","bash",[137,306,307],{"__ignoreMap":110},[308,309,312,316,320,324,327,330],"span",{"class":310,"line":311},"line",1,[308,313,315],{"class":314},"sAdtL","sudo",[308,317,319],{"class":318},"sDhpE"," pacman",[308,321,323],{"class":322},"sAGMh"," -S",[308,325,326],{"class":318}," base-devel",[308,328,329],{"class":322}," --noconfirm",[308,331,332],{"class":322}," --needed\n",[193,334],{},[15,336,337],{},"常见表现:",[149,339,342],{"className":340,"code":341,"language":154},[152],"ERROR: Cannot find the strip binary required for object file stripping.\n",[137,343,341],{"__ignoreMap":110},[149,345,348],{"className":346,"code":347,"language":154},[152],"PKGBUILD: line XXX XXX: command not found\n",[137,349,347],{"__ignoreMap":110},[133,351,353],{"id":352},"_2-source源文件下载失败","2. source源文件下载失败",[88,355,356,468,474],{},[91,357,358,362,363,366,370,372,373,25,376,394,396,407,416,418,419,422,423,426,427,429,432,434,435,465,467],{},[359,360,361],"h4",{"id":361},"网络问题","国内的网络问题不用多说了，大多数情况下都是Github连接不上。",[364,365],"br",{},[32,367],{"alt":368,"src":369},"yay下载失败","https://static.031130.xyz/uploads/2024/08/12/62f3cc9c9dda8.webp",[364,371],{},"最简单的解决方案就是把source里下载失败的东西通过特殊手段（比如你浏览器设置下代理，或者找找fastgit这种反代）下载下来以后直接扔到PKGBUILD所在的路径，然后手动执行",[137,374,375],{},"makepkg -si",[77,377,378,381],{},[15,379,380],{},"-s代表自动下载makedepend，-i表示构建成功以后自动安装",[15,382,383,384,387,388,393],{},"yay存放PKGBUILD的默认路径是在",[137,385,386],{},"$HOME/.cache/yay/$pkgname","下面，具体可以参考我的另一篇关于",[19,389,392],{"href":390,"rel":391},"https://blog.zhullyb.top/2021/04/04/yay-more/#builddir-lt-dir-gt",[23],"yay的用法详解","的博客。",[364,395],{},[52,397,398,399,406],{},"我在这里再讲一种使用 ",[19,400,403],{"href":401,"rel":402},"http://fastgit.org/",[23],[243,404,405],{},"fastgit"," 作为反代加速github下载的方法。",[408,409,410,411,25],"del",{},"如果觉得fastgit帮助到了你，你可以考虑",[19,412,415],{"href":413,"rel":414},"http://fastgit.org/donate.html",[23],"给fastgit项目打钱",[364,417],{},"当你的yay出现这个询问菜单时，（也就是出现",[137,420,421],{},"Diffs to show","/",[137,424,425],{},"显示哪些差异？","字样时）",[364,428],{},[32,430],{"alt":110,"src":431},"https://static.031130.xyz/uploads/2024/08/12/62f3cca0c7aba.webp",[364,433],{},"我们再开一个终端，输入",[149,436,438],{"className":302,"code":437,"language":304,"meta":110,"style":110},"sed -i \"s|github.com|hub.fastgit.org|g\" $HOME/.cache/yay/*/PKGBUILD\n",[137,439,440],{"__ignoreMap":110},[308,441,442,445,448,451,455,458,462],{"class":310,"line":311},[308,443,444],{"class":314},"sed",[308,446,447],{"class":322}," -i",[308,449,450],{"class":318}," \"s|github.com|hub.fastgit.org|g\"",[308,452,454],{"class":453},"sJa8x"," $HOME",[308,456,457],{"class":318},"/.cache/yay/",[308,459,461],{"class":460},"s2QsP","*",[308,463,464],{"class":318},"/PKGBUILD\n",[364,466],{},"接着就下一步安装即可。",[91,469,470,473],{},[359,471,472],{"id":472},"链接失效","这种情况多见于维护者维护不到位，上游放出了新版本包并删除老版本包以后维护者没有及时跟进的。你可以去逛一逛AUR的评论区查看解决方案，或者去查找上游的最新版本是多少，尝试更改PKGBUILD中的pkgver参数和checksum以后尝试makepkg。",[91,475,476,479,480],{},[359,477,478],{"id":478},"需要手动下载","一般情况下是上游没有提供直链，makepkg无法自行下载，需要人工介入。解决方法同上面的",[19,481,361],{"href":482},"#%E7%BD%91%E7%BB%9C%E9%97%AE%E9%A2%98",[133,484,486],{"id":485},"_3-checksum-错误","3. checksum 错误",[15,488,489],{},"上文已经提到过，checksum用于判断你所下载到的软件和维护者当初下载到的是否一致。但是有些情况下，确实是维护者忘了更新checksum值了，因此我们需要做一个判断。",[15,491,492,493,496],{},"打开",[137,494,495],{},".SCRINFO","，找到checksum报错的那个文件的链接。",[15,498,499,500,503],{},"使用wget/curl等工具将他下载下来，可以通过",[137,501,502],{},"md5sum+文件名","的方式获取他们的md5值。连续下载两次，核对两次的检验值是否一致。",[15,505,506,507,510,511,514,515,25],{},"如果结果一致，那么说明并不是网络波动导致的检验值不符，而是维护者没有及时跟进导致的，你可以使用",[137,508,509],{},"yay -S $pkgname --skipchecksums","的方式跳过验证校验值的过程，或者你可以修改PKGBUILD中的校验值为",[137,512,513],{},"\"SKIP\"","来跳过某一文件的校验后手动",[137,516,139],{},[133,518,520],{"id":519},"_4-tuna反代受限","4. tuna反代受限",[15,522,523],{},"tuna的服务器只有一个ip，但当使用他提供的AUR的反代服务时，全国的使用者都会被AUR认为是tuna这一个ip，过大的请求数量可能导致tuna的服务器超出AUR每天给每个ip限制的请求次数。",[193,525],{},[15,527,528],{},"具体表现:",[149,530,533],{"className":531,"code":532,"language":154},[152],"Rate limit reached\n",[137,534,532],{"__ignoreMap":110},[15,536,537],{},"解决方案，改回AUR的服务器，使用自己的ip进行请求",[149,539,541],{"className":302,"code":540,"language":304,"meta":110,"style":110},"yay --aururl \"https://aur.archlinux.org\" --save\n",[137,542,543],{"__ignoreMap":110},[308,544,545,548,551,554],{"class":310,"line":311},[308,546,547],{"class":314},"yay",[308,549,550],{"class":322}," --aururl",[308,552,553],{"class":318}," \"https://aur.archlinux.org\"",[308,555,556],{"class":322}," --save\n",[128,558,559],{"id":559},"写在最后",[15,561,562,563],{},"关于AUR使用的更多细节可以阅读 ",[19,564,567],{"href":565,"rel":566},"https://blog.zhullyb.top/2021/04/04/yay-more/",[23],"《yay进阶》",[569,570,571],"style",{},"html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html pre.shiki code .sJa8x, html code.shiki .sJa8x{--shiki-default:#E45649;--shiki-dark:#E06C75}html pre.shiki code .s2QsP, html code.shiki .s2QsP{--shiki-default:#E45649;--shiki-dark:#E5C07B}",{"title":110,"searchDepth":111,"depth":111,"links":573},[574,579,585],{"id":130,"depth":111,"text":131,"children":575},[576,578],{"id":135,"depth":3,"text":577},"makepkg是如何工作的？",{"id":258,"depth":3,"text":259},{"id":275,"depth":111,"text":276,"children":580},[581,582,583,584],{"id":282,"depth":3,"text":283},{"id":352,"depth":3,"text":353},{"id":485,"depth":3,"text":486},{"id":519,"depth":3,"text":520},{"id":559,"depth":111,"text":559},{"title":587,"date":588,"path":589,"tags":590,"body":592},"使用fakehome方案暂时解决跑在KDE暗色主题下的程序使用亮色字体的问题","2021-09-05","/2021/09/05/wrong-fonts-color-fix-under-kde-with-a-dark-theme",[118,119,591],"Bwrap",{"type":12,"value":593,"toc":708},[594,603,616,619,622,631,636,643,646,675,678,693,700,705],[15,595,596],{},[52,597,598,599,602],{},"9月6日更新：AUR的",[137,600,601],{},"wemeet-bin","维护者sukanka已经将咱的运行指令直接打进了包内，故本文已经基本失去原本的应用意义，但仍可以作为一个案例来解决类似问题。",[77,604,605,608,611],{},[15,606,607],{},"在使用腾讯最近推出的Linux原生腾讯会议的时候，咱遇到了个十分影响体验的问题。",[15,609,610],{},"我在使用KDE的暗色主题，腾讯回忆自作主张将字体颜色调成了白色。然而，字体背景是白色的没，因此导致对比度下降，字体难以辨认。效果大概是这个鬼样子:",[15,612,613],{},[32,614],{"alt":110,"src":615},"https://static.031130.xyz/uploads/2024/08/12/62f3cb059b229.webp",[15,617,618],{},"然而我一时半会儿却找不到合适的变量在运行腾讯会议之前unset，无法指定它使用一个正确的字体颜色。",[15,620,621],{},"此时，我想到了fakehome的解决方案——bwrap。",[15,623,624,625,630],{},"关于bwrap，依云在ta的",[19,626,629],{"href":627,"rel":628},"https://blog.lilydjwg.me/2021/8/12/using-bwrap.215869.html",[23],"博客","里讲过运行原理，我在这里直接摘一小段过来",[77,632,633],{},[15,634,635],{},"bwrap 的原理是，把 / 放到一个 tmpfs 上，然后需要允许访问的目录通过 bind mount 弄进来。所以没弄进来的部分就是不存在，写数据的话就存在内存里，用完就扔掉了。",[15,637,638,639,642],{},"而我们要做的，就是开一个tmpfs作为",[137,640,641],{},"$HOME/.config","，让腾讯会议读取不到KDE的主题配置文件。",[15,644,645],{},"使用如下命令",[149,647,649],{"className":302,"code":648,"language":304,"meta":110,"style":110},"bwrap --dev-bind / / --tmpfs $HOME/.config wemeet\n",[137,650,651],{"__ignoreMap":110},[308,652,653,656,659,662,664,667,669,672],{"class":310,"line":311},[308,654,655],{"class":314},"bwrap",[308,657,658],{"class":322}," --dev-bind",[308,660,661],{"class":318}," /",[308,663,661],{"class":318},[308,665,666],{"class":322}," --tmpfs",[308,668,454],{"class":453},[308,670,671],{"class":318},"/.config",[308,673,674],{"class":318}," wemeet\n",[15,676,677],{},"软件启动确认没有问题后，我们可以更改腾讯会议desktop中的启动命令",[149,679,681],{"className":302,"code":680,"language":304,"meta":110,"style":110},"sudo $EDITOR /usr/share/applications/wemeetapp.desktop\n",[137,682,683],{"__ignoreMap":110},[308,684,685,687,690],{"class":310,"line":311},[308,686,315],{"class":314},[308,688,689],{"class":453}," $EDITOR",[308,691,692],{"class":318}," /usr/share/applications/wemeetapp.desktop\n",[15,694,695,696,699],{},"将",[137,697,698],{},"Exec=","后面的命令改成我们刚刚启动所使用的命令即可。",[77,701,702],{},[15,703,704],{},"关键词: bwrap, linux, 暗色模式, 深色模式, 夜间模式, 白色字体, 亮色字体",[569,706,707],{},"html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html pre.shiki code .sJa8x, html code.shiki .sJa8x{--shiki-default:#E45649;--shiki-dark:#E06C75}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}",{"title":110,"searchDepth":111,"depth":111,"links":709},[],{"title":711,"date":712,"path":713,"tags":714,"body":717},"来，从AUR给Fedora偷个包","2021-07-23 01:50:09","/2021/07/23/build-a-rpm-package-from-aur-with-archlinux",[118,119,715,716],"Fedora","RPM Package",{"type":12,"value":718,"toc":1435},[719,727,732,735,742,745,753,756,763,780,784,790,796,800,803,816,827,834,840,857,880,886,889,896,912,915,933,937,1184,1187,1192,1198,1212,1215,1221,1226,1232,1235,1241,1247,1250,1268,1274,1276,1283,1316,1366,1371,1382,1397,1409,1421,1432],[77,720,721,724],{},[15,722,723],{},"前一阵子，某Q群里的某初中生居然跳上了Fedora这辆灵车，还一直缠着我要我给他整个打rpm包的教程，说什么要复兴FedoraCN之类的我听不懂的话。碰巧听说Fedora似乎还没有wechat-uos，于是我就寻思着给Fedora打一个，顺便熟悉一下dnf的操作。",[15,725,726],{},"事实上，Fedora和Archlinux的目录结构很相似，理论上来讲Archlinux的大部分包都可以直接解压后塞到Fedora里直接用，对于咱这种日常偷Deb包的Arch用户来说基本没什么难度，唯一的难点在于处理依赖关系。",[15,728,729],{},[52,730,731],{},"Tips1: 使用电脑端的访客可以在页面左下角打开侧栏以获取目录。",[133,733,734],{"id":734},"下载链接",[15,736,737,738],{},"如果你是为了wechat-uos这个包而非教程而来的，下载链接在这里。",[19,739,740],{"href":740,"rel":741},"https://zhullyb.lanzoui.com/ikN55rqr7ah",[23],[133,743,744],{"id":744},"偷包环境",[158,746,747,750],{},[91,748,749],{},"Archlinux实体机(打包)",[91,751,752],{},"Fedora虚拟机(依赖查询、测试)",[133,754,755],{"id":755},"准备好wechat-uos",[15,757,758,759,762],{},"首先，咱们先在Archlinux上把我们的",[137,760,761],{},"wechat-uos","先打包好，这个老生常谈的问题我不多赘述了。",[149,764,766],{"className":302,"code":765,"language":304,"meta":110,"style":110},"yay -S wechat-uos --noconfirm\n",[137,767,768],{"__ignoreMap":110},[308,769,770,772,774,777],{"class":310,"line":311},[308,771,547],{"class":314},[308,773,323],{"class":322},[308,775,776],{"class":318}," wechat-uos",[308,778,779],{"class":322}," --noconfirm\n",[133,781,783],{"id":782},"查找wechat-uos在archlinux上所需的依赖","查找wechat-uos在Archlinux上所需的依赖",[15,785,786,787,789],{},"再去查看",[137,788,761],{},"所需要的依赖",[149,791,794],{"className":792,"code":793,"language":154},[152],"[zhullyb@Archlinux ~]$ yay -Si wechat-uos\n:: Querying AUR...\nRepository      : aur\nName            : wechat-uos\nKeywords        : electron  patched  uos  wechat  weixin\nVersion         : 2:2.0.0-1145141919\nDescription     : UOS专业版微信 (迫真魔改版)\nURL             : https://www.chinauos.com/resource/download-professional\nAUR URL         : https://aur.archlinux.org/packages/wechat-uos\nGroups          : None\nLicenses        : MIT\nProvides        : None\nDepends On      : gtk2  gtk3  libxss  gconf  nss  lsb-release  bubblewrap\nMake Deps       : imagemagick\nCheck Deps      : None\nOptional Deps   : None\nConflicts With  : None\nMaintainer      : DuckSoft\nVotes           : 16\nPopularity      : 0.603501\nFirst Submitted : Wed 30 Dec 2020 12:21:51 PM CST\nLast Modified   : Sat 20 Feb 2021 06:53:24 AM CST\nOut-of-date     : No\n",[137,795,793],{"__ignoreMap":110},[133,797,799],{"id":798},"查找fedora上的对应依赖包名","查找Fedora上的对应依赖包名",[15,801,802],{},"然后我们需要去Fedora上找一找这些依赖在Fedora上的包名都叫什么。",[15,804,805,806,809,810,812,813],{},"比如这个",[137,807,808],{},"bubblewrap","，我们需要的是他提供的",[137,811,655],{},"，所以我们直接在Fedora上",[137,814,815],{},"sudo dnf provides bwrap",[15,817,818,819,822,823,826],{},"再比如",[137,820,821],{},"gconf","并没有在",[137,824,825],{},"/usr/bin","路径下直接留下什么非常具有代表性的可执行文件，所以在Fedora里面寻找等效包就稍微复杂一些，但也并非不能找。",[15,828,829,830,833],{},"先在Archlinux下使用",[137,831,832],{},"pacman -Ql gconf","，输出结果有点长，我就截一小段上来。",[149,835,838],{"className":836,"code":837,"language":154},[152],"[zhullyb@Archlinux ~]$ pacman -Qlq gconf\n/etc/\n/etc/gconf/\n/etc/gconf/2/\n/etc/gconf/2/evoldap.conf\n/etc/gconf/2/path\n/etc/gconf/gconf.xml.defaults/\n/etc/gconf/gconf.xml.mandatory/\n/etc/gconf/gconf.xml.system/\n/etc/xdg/\n/etc/xdg/autostart/\n/etc/xdg/autostart/gsettings-data-convert.desktop\n/usr/\n/usr/bin/\n/usr/bin/gconf-merge-schema\n/usr/bin/gconf-merge-tree\n/usr/bin/gconfpkg\n/usr/bin/gconftool-2\n......\n",[137,839,837],{"__ignoreMap":110},[15,841,842,843,845,846,849,850,853,854,25],{},"可以发现，",[137,844,821],{},"还是有不少文件是非常具有代表性的，比如这里的",[137,847,848],{},"/usr/bin/gconf-merge-tree","，我们在Fedora上使用",[137,851,852],{},"sudo dnf provides gconf-merge-tree","很容易就能找到对应的包是",[137,855,856],{},"GConf2",[15,858,859,862,863,866,867,870,871,873,874,876,877,879],{},[137,860,861],{},"lsb-release","这个依赖中，我们只是需要",[137,864,865],{},"/etc/lsb-release","这个文件存在让我们的bwrap可以顺利地伪装成uos的样子。Fedora中虽然有",[137,868,869],{},"redhat-lsb-core","这个包算是",[137,872,861],{},"的等效包，但是并不提供这个文件，因此我们只需要在待会儿打包的时候带一个",[137,875,865],{},"的空文件即可，不需要将",[137,878,869],{},"写进依赖。",[15,881,882,883,25],{},"最终我们可以确定下来需要的依赖为",[137,884,885],{},"gtk2,gtk3,libXScrnSaver,nss,bubblewrap,GConf2",[133,887,888],{"id":888},"准备打包",[359,890,892,893],{"id":891},"安装rpm-tools","安装",[137,894,895],{},"rpm-tools",[149,897,899],{"className":302,"code":898,"language":304,"meta":110,"style":110},"sudo pacman -S rpm-tools\n",[137,900,901],{"__ignoreMap":110},[308,902,903,905,907,909],{"class":310,"line":311},[308,904,315],{"class":314},[308,906,319],{"class":318},[308,908,323],{"class":322},[308,910,911],{"class":318}," rpm-tools\n",[359,913,914],{"id":914},"生成工作路径",[149,916,918],{"className":302,"code":917,"language":304,"meta":110,"style":110},"mkdir -pv $HOME/rpmbuild/{BUILD,BUILDROOT,RPMS,SOURCES,SPECS,SRPMS}\n",[137,919,920],{"__ignoreMap":110},[308,921,922,925,928,930],{"class":310,"line":311},[308,923,924],{"class":314},"mkdir",[308,926,927],{"class":322}," -pv",[308,929,454],{"class":453},[308,931,932],{"class":318},"/rpmbuild/{BUILD,BUILDROOT,RPMS,SOURCES,SPECS,SRPMS}\n",[359,934,936],{"id":935},"编写-spec-文件","编写 spec 文件",[149,938,940],{"className":302,"code":939,"language":304,"meta":110,"style":110},"Name: wechat-uos\nVersion: 2.0.0\nRelease: 1\nSummary: A wechat client based on electron.\nLicense: None\nURL: https://www.chinauos.com/resource/download-professional\nPackager: zhullyb\n\nRequires: gtk2,gtk3,libXScrnSaver,nss,bubblewrap,GConf2\n\nAutoReqProv: no\n\n%description\n\n%prep\n\n%pre\n\n%post\n\n%preun\n\n%postun\n\n%files\n/etc/lsb-release\n/opt/wechat-uos/\n/usr/bin/wechat-uos\n/usr/lib/license/libuosdevicea.so\n/usr/share/applications/wechat-uos.desktop\n/usr/share/icons/hicolor/128x128/apps/wechat.png\n/usr/share/icons/hicolor/16x16/apps/wechat.png\n/usr/share/icons/hicolor/256x256/apps/wechat.png\n/usr/share/icons/hicolor/48x48/apps/wechat.png\n/usr/share/icons/hicolor/64x64/apps/wechat.png\n",[137,941,942,950,958,966,990,999,1008,1017,1024,1033,1038,1047,1052,1058,1063,1069,1074,1080,1085,1091,1096,1102,1107,1113,1118,1124,1130,1136,1142,1148,1154,1160,1166,1172,1178],{"__ignoreMap":110},[308,943,944,947],{"class":310,"line":311},[308,945,946],{"class":314},"Name:",[308,948,949],{"class":318}," wechat-uos\n",[308,951,952,955],{"class":310,"line":111},[308,953,954],{"class":314},"Version:",[308,956,957],{"class":322}," 2.0.0\n",[308,959,960,963],{"class":310,"line":3},[308,961,962],{"class":314},"Release:",[308,964,965],{"class":322}," 1\n",[308,967,969,972,975,978,981,984,987],{"class":310,"line":968},4,[308,970,971],{"class":314},"Summary:",[308,973,974],{"class":318}," A",[308,976,977],{"class":318}," wechat",[308,979,980],{"class":318}," client",[308,982,983],{"class":318}," based",[308,985,986],{"class":318}," on",[308,988,989],{"class":318}," electron.\n",[308,991,993,996],{"class":310,"line":992},5,[308,994,995],{"class":314},"License:",[308,997,998],{"class":318}," None\n",[308,1000,1002,1005],{"class":310,"line":1001},6,[308,1003,1004],{"class":314},"URL:",[308,1006,1007],{"class":318}," https://www.chinauos.com/resource/download-professional\n",[308,1009,1011,1014],{"class":310,"line":1010},7,[308,1012,1013],{"class":314},"Packager:",[308,1015,1016],{"class":318}," zhullyb\n",[308,1018,1020],{"class":310,"line":1019},8,[308,1021,1023],{"emptyLinePlaceholder":1022},true,"\n",[308,1025,1027,1030],{"class":310,"line":1026},9,[308,1028,1029],{"class":314},"Requires:",[308,1031,1032],{"class":318}," gtk2,gtk3,libXScrnSaver,nss,bubblewrap,GConf2\n",[308,1034,1036],{"class":310,"line":1035},10,[308,1037,1023],{"emptyLinePlaceholder":1022},[308,1039,1041,1044],{"class":310,"line":1040},11,[308,1042,1043],{"class":314},"AutoReqProv:",[308,1045,1046],{"class":318}," no\n",[308,1048,1050],{"class":310,"line":1049},12,[308,1051,1023],{"emptyLinePlaceholder":1022},[308,1053,1055],{"class":310,"line":1054},13,[308,1056,1057],{"class":314},"%description\n",[308,1059,1061],{"class":310,"line":1060},14,[308,1062,1023],{"emptyLinePlaceholder":1022},[308,1064,1066],{"class":310,"line":1065},15,[308,1067,1068],{"class":314},"%prep\n",[308,1070,1072],{"class":310,"line":1071},16,[308,1073,1023],{"emptyLinePlaceholder":1022},[308,1075,1077],{"class":310,"line":1076},17,[308,1078,1079],{"class":314},"%pre\n",[308,1081,1083],{"class":310,"line":1082},18,[308,1084,1023],{"emptyLinePlaceholder":1022},[308,1086,1088],{"class":310,"line":1087},19,[308,1089,1090],{"class":314},"%post\n",[308,1092,1094],{"class":310,"line":1093},20,[308,1095,1023],{"emptyLinePlaceholder":1022},[308,1097,1099],{"class":310,"line":1098},21,[308,1100,1101],{"class":314},"%preun\n",[308,1103,1105],{"class":310,"line":1104},22,[308,1106,1023],{"emptyLinePlaceholder":1022},[308,1108,1110],{"class":310,"line":1109},23,[308,1111,1112],{"class":314},"%postun\n",[308,1114,1116],{"class":310,"line":1115},24,[308,1117,1023],{"emptyLinePlaceholder":1022},[308,1119,1121],{"class":310,"line":1120},25,[308,1122,1123],{"class":314},"%files\n",[308,1125,1127],{"class":310,"line":1126},26,[308,1128,1129],{"class":314},"/etc/lsb-release\n",[308,1131,1133],{"class":310,"line":1132},27,[308,1134,1135],{"class":314},"/opt/wechat-uos/\n",[308,1137,1139],{"class":310,"line":1138},28,[308,1140,1141],{"class":314},"/usr/bin/wechat-uos\n",[308,1143,1145],{"class":310,"line":1144},29,[308,1146,1147],{"class":314},"/usr/lib/license/libuosdevicea.so\n",[308,1149,1151],{"class":310,"line":1150},30,[308,1152,1153],{"class":314},"/usr/share/applications/wechat-uos.desktop\n",[308,1155,1157],{"class":310,"line":1156},31,[308,1158,1159],{"class":314},"/usr/share/icons/hicolor/128x128/apps/wechat.png\n",[308,1161,1163],{"class":310,"line":1162},32,[308,1164,1165],{"class":314},"/usr/share/icons/hicolor/16x16/apps/wechat.png\n",[308,1167,1169],{"class":310,"line":1168},33,[308,1170,1171],{"class":314},"/usr/share/icons/hicolor/256x256/apps/wechat.png\n",[308,1173,1175],{"class":310,"line":1174},34,[308,1176,1177],{"class":314},"/usr/share/icons/hicolor/48x48/apps/wechat.png\n",[308,1179,1181],{"class":310,"line":1180},35,[308,1182,1183],{"class":314},"/usr/share/icons/hicolor/64x64/apps/wechat.png\n",[359,1185,1186],{"id":1186},"处理source",[77,1188,1189],{},[15,1190,1191],{},"一般来说，我们需要配置各种奇奇怪怪的编译命令，但是我这里直接选择了打包二进制文件，一来是减少了对于spec的学习成本，二来是因为wechat-uos本来就不开源，也没什么好编译的。",[15,1193,1194,1195,1197],{},"创建我们",[137,1196,761],{},"的二进制文件所需要放入的文件夹。",[149,1199,1201],{"className":302,"code":1200,"language":304,"meta":110,"style":110},"mkdir $HOME/rpmbuild/BUILDROOT/wechat-uos-2.0.0-1.x86_64\n",[137,1202,1203],{"__ignoreMap":110},[308,1204,1205,1207,1209],{"class":310,"line":311},[308,1206,924],{"class":314},[308,1208,454],{"class":453},[308,1210,1211],{"class":318},"/rpmbuild/BUILDROOT/wechat-uos-2.0.0-1.x86_64\n",[15,1213,1214],{},"将我们的wechat-uos直接放入对应的文件夹中",[15,1216,1217],{},[32,1218],{"alt":1219,"src":1220},"解压原先打包好的wechat-uos","https://static.031130.xyz/uploads/2024/08/12/62f3cadde8d65.webp",[15,1222,1223,1224],{},"补上我们的",[137,1225,865],{},[149,1227,1230],{"className":1228,"code":1229,"language":154},[152],"mkdir $HOME/rpmbuild/BUILDROOT/wechat-uos-2.0.0-1.x86_64/etc/\ntouch $HOME/rpmbuild/BUILDROOT/wechat-uos-2.0.0-1.x86_64/etc/lsb-release\n",[137,1231,1229],{"__ignoreMap":110},[133,1233,1234],{"id":1234},"正式打包",[149,1236,1239],{"className":1237,"code":1238,"language":154},[152],"rpmbuild -bb --target=x86_64 SPECS/wechat-uos.spec --nodeps\n",[137,1240,1238],{"__ignoreMap":110},[15,1242,1243],{},[32,1244],{"alt":1245,"src":1246},"打包成功","https://static.031130.xyz/uploads/2024/08/12/62f3cae15fdcf.webp",[133,1248,1249],{"id":1249},"安装测试",[149,1251,1253],{"className":302,"code":1252,"language":304,"meta":110,"style":110},"sudo dnf install ./wechat-uos-2.0.0-1.x86_64.rpm\n",[137,1254,1255],{"__ignoreMap":110},[308,1256,1257,1259,1262,1265],{"class":310,"line":311},[308,1258,315],{"class":314},[308,1260,1261],{"class":318}," dnf",[308,1263,1264],{"class":318}," install",[308,1266,1267],{"class":318}," ./wechat-uos-2.0.0-1.x86_64.rpm\n",[15,1269,1270],{},[32,1271],{"alt":1272,"src":1273},"测试通过","https://static.031130.xyz/uploads/2024/08/12/62f3cae5aa4b0.webp",[133,1275,559],{"id":559},[15,1277,1278,1279,1282],{},"rpm的打包工具是我近期",[52,1280,1281],{},"最","想吐槽的东西了，主要槽点有两个。",[15,1284,1285,1286,1289,1290,422,1293,422,1296,1299,1300,1307,1308,1311,1312,1315],{},"其一是：rpm在打包时的默认状态下，会使用 ",[137,1287,1288],{},"file"," 命令判断文件，如果是二进制的，用ldd判断依赖；如果是脚本，过滤文件中对应的 ",[137,1291,1292],{},"use",[137,1294,1295],{},"requires",[137,1297,1298],{},"import"," 语句，以此来找出内部依赖。**这固然是个非常贴心的小善举，**能够确保软件正常运行，",[52,1301,1302,1303,1306],{},"但完全有可能造成比较奇怪的问题。",[52,1304,1305],{},"比如我本次打包中rpm","自作聪明","地给我添加了一个",[137,1309,1310],{},"libffmpeg.so","的依赖，这东西整个Fedora自带的四个源里都不存在，在安装测试的时候出现了找不到依赖的情况。想我这种添加了找不到依赖的情况还算是运气好的，之前听说有人在使用opensuse的某个私人源的时候发现安装网易云音乐居然吧wps-office都给依赖上了，我想就是rpm自动检测到了网易云需要某个库，而wps恰好自带了这个库而导致的依赖误报。在Archlinux中，我们有一个叫",[137,1313,1314],{},"namcap","的小工具能够使用类似的方法检测软件运行时可能所需要的内部依赖，但他并不会默认启用，更不会自说自话的就直接把他添加为依赖，连一声也不吭。",[15,1317,1318,1319,1322,1323,1325,1326,1329,1330,234,1332,1335,1336,1338,1339,1342,1343,1345,1346,1348,1349,1352,1353,1355,1356,1358,1359,1361,1362,1365],{},"其二是：rpm检测新增包内文件是否与系统已安装的软件包内的文件因为使用相同路径而冲突时，不仅会核对是否有冲突的同路径同名文件，他",[52,1320,1321],{},"还会核对文件夹","的文件占用情况。这说起来可能会有些抽象，我举个例子。在Fedora中，",[137,1324,825],{},"路径是被",[137,1327,1328],{},"filesystem","这个包所占有的，所以其他包在打包时是不能直接使用",[137,1331,825],{},[137,1333,1334],{},"/usr","、甚至",[137,1337,422],{},"来限定包内文件的范围的（也就是上面spec文件中的%files区域）。而我在第一次打包时，想要直接打包",[137,1340,1341],{},"BUILDROOT","下的所有文件，于是%files就直接填写了",[137,1344,422],{},"作为限定，安装时提示",[137,1347,825],{},"和",[137,1350,1351],{},"/usr/lib","被",[137,1354,1328],{},"这个包所占用，文件冲突。为此我还特意去仔细对比了Fedora自带的",[137,1357,1328],{},"和我这个",[137,1360,761],{},"是否有冲突的文件，实则证明并没有，只是单纯这个",[52,1363,1364],{},"检测机制过于死板","罢了。而在Archlinux中，pacman安装时只会检测包内的文件是否与系统内的现有文件路径产生冲突，而不会非常无意义的去限定哪个文件夹是属于哪个包的。",[133,1367,1369],{"id":1368},"附上本文的参考资料",[52,1370,1368],{},[77,1372,1373],{},[15,1374,1375,1376,1381],{},"为了避免源网页失效，我特意去",[19,1377,1380],{"href":1378,"rel":1379},"http://web.archive.org",[23],"互联网档案馆","做了备份",[15,1383,1384,1385,1390,1391,1396],{},"「",[19,1386,1389],{"href":1387,"rel":1388},"https://blog.csdn.net/get_set/article/details/53453320",[23],"RPM打包原理、示例、详解及备查","」\t\t\t\t\t\t\t 「",[19,1392,1395],{"href":1393,"rel":1394},"http://web.archive.org/web/20210722180835/https://blog.konghy.cn/2015/11/13/rpmbuild/",[23],"Archive","」",[15,1398,1384,1399,1404,1405,1396],{},[19,1400,1403],{"href":1401,"rel":1402},"https://blog.konghy.cn/2015/11/13/rpmbuild/",[23],"在 Ubuntu 下直接将二进制文件制作成 rpm 包","」\t\t「",[19,1406,1395],{"href":1407,"rel":1408},"http://web.archive.org/web/20210722180859/http://blog.sina.cn/dpool/blog/s/blog_6a5aee670101r1si.html",[23],[15,1410,1384,1411,1416,1417,1396],{},[19,1412,1415],{"href":1413,"rel":1414},"http://blog.sina.cn/dpool/blog/s/blog_6a5aee670101r1si.html",[23],"解除RPM包的依赖的方法","」\t\t\t\t\t\t\t\t\t\t\t「",[19,1418,1395],{"href":1419,"rel":1420},"http://web.archive.org/web/20210722180936/https://blog.csdn.net/get_set/article/details/53453320",[23],[15,1422,1423],{},[243,1424,1425,1426,1431],{},"本文同时发布于「",[19,1427,1430],{"href":1428,"rel":1429},"https://zhuanlan.zhihu.com/p/392650904",[23],"知乎专栏","」，如果你恰好有知乎帐号的话或许可以考虑帮我点个赞？",[569,1433,1434],{},"html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html pre.shiki code .sJa8x, html code.shiki .sJa8x{--shiki-default:#E45649;--shiki-dark:#E06C75}",{"title":110,"searchDepth":111,"depth":111,"links":1436},[1437,1438,1439,1440,1441,1442,1443,1444,1445,1446],{"id":734,"depth":3,"text":734},{"id":744,"depth":3,"text":744},{"id":755,"depth":3,"text":755},{"id":782,"depth":3,"text":783},{"id":798,"depth":3,"text":799},{"id":888,"depth":3,"text":888},{"id":1234,"depth":3,"text":1234},{"id":1249,"depth":3,"text":1249},{"id":559,"depth":3,"text":559},{"id":1368,"depth":3,"text":1368},{"title":1448,"date":1449,"path":1450,"tags":1451,"body":1452},"下载一份openharmony的源码","2021-06-06 16:47:34","/2021/06/06/download-openharmony-source-code",null,{"type":12,"value":1453,"toc":1827},[1454,1459,1462,1473,1487,1493,1501,1619,1626,1638,1645,1657,1664,1686,1696,1703,1715,1725,1728,1734,1737,1740,1746,1753,1773,1779,1786,1789,1795,1801,1807,1812,1818,1824],[77,1455,1456],{},[15,1457,1458],{},"不知道为什么，总是有人告诉我鸿蒙已经开源了，不信可以自己去看源码balabala，其实鸿蒙的手机端目前为止依然没有开源，或者说没有完整完整开源。本文我将介绍如何拉取一份openharmony开源的源码。",[15,1460,1461],{},"首先需要准备以下东西",[158,1463,1464,1467,1470],{},[91,1465,1466],{},"一台装有类unix环境的电脑（wsl大概也行）",[91,1468,1469],{},"6G磁盘剩余空间",[91,1471,1472],{},"互联网（如果使用手机流量的话大概是1.5G）",[88,1474,1476,1482],{"start":1475},0,[91,1477,1478,1481],{},[359,1479,1480],{"id":1480},"安装git","没什么好说的，不再赘述。",[91,1483,1484],{},[359,1485,1486],{"id":1486},"设置git用户名和邮箱",[149,1488,1491],{"className":1489,"code":1490,"language":154},[152],"git config --global user.email \"you@example.com\"\ngit config --global user.name \"Your Name\"\n",[137,1492,1490],{"__ignoreMap":110},[88,1494,1495],{"start":111},[91,1496,1497],{},[359,1498,1500],{"id":1499},"下载repo这个大多数发行版自己都有打包但是都比较滞后不如直接下载最新版的二进制文件设置好path变量直接用","下载repo（这个大多数发行版自己都有打包，但是都比较滞后，不如直接下载最新版的二进制文件设置好path变量直接用）",[149,1502,1504],{"className":302,"code":1503,"language":304,"meta":110,"style":110},"mkdir -p ~/bin\ncurl https://storage.googleapis.com/git-repo-downloads/repo > ~/bin/repo\nchmod a+x ~/bin/repo\n\ncat >> ~/.bashrc \u003C\u003CEOF\n\n# set PATH so it includes user's private bin if it exists\nif [ -d \"\\$HOME/bin\" ] ; then\n    PATH=\"\\$HOME/bin:\\$PATH\"\nfi\nEOF\n\nsource ~/.bashrc\n",[137,1505,1506,1516,1530,1541,1545,1562,1566,1571,1583,1598,1603,1607,1611],{"__ignoreMap":110},[308,1507,1508,1510,1513],{"class":310,"line":311},[308,1509,924],{"class":314},[308,1511,1512],{"class":322}," -p",[308,1514,1515],{"class":318}," ~/bin\n",[308,1517,1518,1520,1523,1527],{"class":310,"line":111},[308,1519,203],{"class":314},[308,1521,1522],{"class":318}," https://storage.googleapis.com/git-repo-downloads/repo",[308,1524,1526],{"class":1525},"s5ixo"," > ",[308,1528,1529],{"class":318},"~/bin/repo\n",[308,1531,1532,1535,1538],{"class":310,"line":3},[308,1533,1534],{"class":314},"chmod",[308,1536,1537],{"class":318}," a+x",[308,1539,1540],{"class":318}," ~/bin/repo\n",[308,1542,1543],{"class":310,"line":968},[308,1544,1023],{"emptyLinePlaceholder":1022},[308,1546,1547,1550,1553,1556,1559],{"class":310,"line":992},[308,1548,1549],{"class":314},"cat",[308,1551,1552],{"class":1525}," >> ",[308,1554,1555],{"class":318},"~/.bashrc",[308,1557,1558],{"class":1525}," \u003C\u003C",[308,1560,1561],{"class":1525},"EOF\n",[308,1563,1564],{"class":310,"line":1001},[308,1565,1023],{"emptyLinePlaceholder":1022},[308,1567,1568],{"class":310,"line":1010},[308,1569,1570],{"class":318},"# set PATH so it includes user's private bin if it exists\n",[308,1572,1573,1576,1580],{"class":310,"line":1019},[308,1574,1575],{"class":318},"if [ -d \"",[308,1577,1579],{"class":1578},"s_Sar","\\$",[308,1581,1582],{"class":318},"HOME/bin\" ] ; then\n",[308,1584,1585,1588,1590,1593,1595],{"class":310,"line":1026},[308,1586,1587],{"class":318},"    PATH=\"",[308,1589,1579],{"class":1578},[308,1591,1592],{"class":318},"HOME/bin:",[308,1594,1579],{"class":1578},[308,1596,1597],{"class":318},"PATH\"\n",[308,1599,1600],{"class":310,"line":1035},[308,1601,1602],{"class":318},"fi\n",[308,1604,1605],{"class":310,"line":1040},[308,1606,1561],{"class":1525},[308,1608,1609],{"class":310,"line":1049},[308,1610,1023],{"emptyLinePlaceholder":1022},[308,1612,1613,1616],{"class":310,"line":1054},[308,1614,1615],{"class":1578},"source",[308,1617,1618],{"class":318}," ~/.bashrc\n",[88,1620,1621],{"start":3},[91,1622,1623],{},[359,1624,1625],{"id":1625},"新建一个文件夹以同步源码",[149,1627,1629],{"className":302,"code":1628,"language":304,"meta":110,"style":110},"mkdir openharmony\n",[137,1630,1631],{"__ignoreMap":110},[308,1632,1633,1635],{"class":310,"line":311},[308,1634,924],{"class":314},[308,1636,1637],{"class":318}," openharmony\n",[88,1639,1640],{"start":968},[91,1641,1642],{},[359,1643,1644],{"id":1644},"进入这个文件夹",[149,1646,1648],{"className":302,"code":1647,"language":304,"meta":110,"style":110},"cd openharmony\n",[137,1649,1650],{"__ignoreMap":110},[308,1651,1652,1655],{"class":310,"line":311},[308,1653,1654],{"class":1578},"cd",[308,1656,1637],{"class":318},[88,1658,1659],{"start":992},[91,1660,1661],{},[359,1662,1663],{"id":1663},"初始化repo",[149,1665,1667],{"className":302,"code":1666,"language":304,"meta":110,"style":110},"repo init -u https://gitee.com/openharmony/manifest.git --depth=1\n",[137,1668,1669],{"__ignoreMap":110},[308,1670,1671,1674,1677,1680,1683],{"class":310,"line":311},[308,1672,1673],{"class":314},"repo",[308,1675,1676],{"class":318}," init",[308,1678,1679],{"class":322}," -u",[308,1681,1682],{"class":318}," https://gitee.com/openharmony/manifest.git",[308,1684,1685],{"class":322}," --depth=1\n",[15,1687,1688,1689,1692,1693,1695],{},"​\t注:  ",[137,1690,1691],{},"--depth=1","是为了仅保留一层commit记录，防止过多的历史commit占用空间，如果你想保留历\t史commit，那可以把这里的",[137,1694,1691],{},"去掉。",[88,1697,1698],{"start":1001},[91,1699,1700],{},[359,1701,1702],{"id":1702},"使用repo正式开始同步源码",[149,1704,1706],{"className":302,"code":1705,"language":304,"meta":110,"style":110},"repo sync\n",[137,1707,1708],{"__ignoreMap":110},[308,1709,1710,1712],{"class":310,"line":311},[308,1711,1673],{"class":314},[308,1713,1714],{"class":318}," sync\n",[15,1716,1717,1718,1721,1722],{},"repo在sync的时候其实可以加很多选项，可以通过",[137,1719,1720],{},"repo help","自行研究，我自己常用的是",[137,1723,1724],{},"repo sync  --force-sync --current-branch --no-tags --no-clone-bundle --optimized-fetch --prune -j$(nproc --all) -f1",[15,1726,1727],{},"看到以下提示代表同步成功",[149,1729,1732],{"className":1730,"code":1731,"language":154},[152],"repo sync has finished successfully.\n",[137,1733,1731],{"__ignoreMap":110},[133,1735,1736],{"id":1736},"后话",[15,1738,1739],{},"结果就当源码下载好并开始checkout后，出现了以下错误",[149,1741,1744],{"className":1742,"code":1743,"language":154},[152],"Garbage collecting: 100% (220/220), done in 1.204s\nUpdating files: 100% (35/35), done.\nUpdating files: 100% (27/27), done.\ngit-lfs filter-process --skip: line 1: git-lfs: command not found\nfatal: the remote end hung up unexpectedly\nerror.GitError: Cannot checkout device_hisilicon_modules: Cannot initialize work tree for device_hisilicon_modules\nerror: Cannot checkout device_hisilicon_modules\n",[137,1745,1743],{"__ignoreMap":110},[15,1747,1748,1749,1752],{},"看着error很容易可以发现是我的系统没有",[137,1750,1751],{},"git-lfs","的原因，看样子openharmony使用了git-lfs来储存了某个大文件。",[149,1754,1756],{"className":302,"code":1755,"language":304,"meta":110,"style":110},"sudo pacman -S git-lfs  #别的发行版请自行查找相关安装方法\n",[137,1757,1758],{"__ignoreMap":110},[308,1759,1760,1762,1764,1766,1769],{"class":310,"line":311},[308,1761,315],{"class":314},[308,1763,319],{"class":318},[308,1765,323],{"class":322},[308,1767,1768],{"class":318}," git-lfs",[308,1770,1772],{"class":1771},"sW2Sy","  #别的发行版请自行查找相关安装方法\n",[15,1774,1775,1776,1778],{},"于是乎，安装好",[137,1777,1751],{},"重新sync源码",[15,1780,1781,1782,1785],{},"oepnharmony目录下，",[137,1783,1784],{},".repo","文件夹内是你从git服务器上下载下来的原始数据，repo将在所有数据下载完成以后将他们自动checkout成代码。",[15,1787,1788],{},"源码结构是下面这个样子",[149,1790,1793],{"className":1791,"code":1792,"language":154},[152],".\n├── applications\n├── base\n├── build\n├── build.py -> build/lite/build.py\n├── build.sh -> build/build_scripts/build.sh\n├── developtools\n├── device\n├── docs\n├── domains\n├── drivers\n├── foundation\n├── .gn -> build/core/gn/dotfile.gn\n├── interface\n├── kernel\n├── prebuilts\n├── productdefine\n├── .repo\n├── test\n├── third_party\n├── utils\n└── vendor\n\n18 directories, 3 files\n",[137,1794,1792],{"__ignoreMap":110},[15,1796,1797],{},[32,1798],{"alt":1799,"src":1800},"这里是OpenHarmony包含.repo原始数据的全部大小","https://static.031130.xyz/uploads/2024/08/12/62f3cb1057a22.webp",[15,1802,1803],{},[32,1804],{"alt":1805,"src":1806},"这里是OpenHarmony的.repo原始数据的大小","https://static.031130.xyz/uploads/2024/08/12/62f3cb13027fb.webp",[15,1808,1809],{},[52,1810,1811],{},"我提供个参考数据，AOSP源码不含.repo原始数据的大小是40G，就openharmony这个代码量，恐怕很难让我相信这是一个兼容安卓应用的系统的完整代码。",[15,1813,1814],{},[32,1815],{"alt":1816,"src":1817},"这里是AOSP的.repo原始数据大小","https://static.031130.xyz/uploads/2024/08/12/62f3cb15ccbf1.webp",[15,1819,1820],{},[32,1821],{"alt":1822,"src":1823},"这里是AOSP包含.repo原始数据的大小","https://static.031130.xyz/uploads/2024/08/12/62f3cb182333b.webp",[569,1825,1826],{},"html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html pre.shiki code .s_Sar, html code.shiki .s_Sar{--shiki-default:#0184BC;--shiki-dark:#56B6C2}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html pre.shiki code .sW2Sy, html code.shiki .sW2Sy{--shiki-default:#A0A1A7;--shiki-default-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic}",{"title":110,"searchDepth":111,"depth":111,"links":1828},[1829],{"id":1736,"depth":3,"text":1736},{"title":1831,"date":1832,"path":1833,"tags":1834,"body":1836},"在Windows与Linux双系统下共享蓝牙鼠标","2021-05-30","/2021/05/30/share-xiaomi-bluetooth-mouse-on-both-windows-and-linux",[118,119,1835],"Windows",{"type":12,"value":1837,"toc":2186},[1838,1855,1858,1871,1877,1883,1886,1897,1903,1906,1912,1917,1920,2040,2046,2049,2055,2102,2105,2176,2183],[77,1839,1840,1849,1852],{},[15,1841,1842,1843,1848],{},"我自己使用的鼠标是一只",[19,1844,1847],{"href":1845,"rel":1846},"https://www.mi.com/mouse",[23],"小米的无线蓝牙双模鼠标","。但是由于我的USB接口不是很充裕，我平时还是蓝牙鼠标用的比较多。",[15,1850,1851],{},"但是，每当我在Windows和Archlinux上切换时，我不得不重新配对我的蓝牙鼠标。原因我在翻译Archwiki上关于蓝牙鼠标相关叙述时已经解释得非常清楚了，我摘在下面：",[15,1853,1854],{},"“首先，计算机保存蓝牙设备的 MAC 地址和配对密钥；然后，蓝牙设备保存计算机的 MAC 地址和配对密钥。这两步通常不会有问题，不过设备蓝牙端口的 MAC 地址在 Linux 和 Windows 上都是相同的 (这在硬件层面上就设定好了)。然而，当在 Windows 或 Linux  中重新配对设备时，它会生成一个新密钥，覆盖了蓝牙设备之前保存的密钥，即与 Windows 配对产生的密钥会覆盖原先与 Linux  配对的密钥，反之亦然。“",[15,1856,1857],{},"先在Linux上连接蓝牙鼠标，再重启到Windows重新配对蓝牙蓝牙鼠标。",[15,1859,1860,1861,1866,1867,1870],{},"到",[19,1862,1865],{"href":1863,"rel":1864},"https://docs.microsoft.com/en-us/sysinternals/downloads/psexec",[23],"微软官网","下载",[137,1868,1869],{},"PsExec.zip","，解压后，记住你所解压的路径。",[15,1872,1873,1874],{},"在Windows中，使用管理员权限打开",[137,1875,1876],{},"cmd.exe",[15,1878,1879],{},[32,1880],{"alt":1881,"src":1882},"在Windows下使用管理员权限打开cmd","https://static.031130.xyz/uploads/2024/08/12/62f3cb081565a.webp",[15,1884,1885],{},"cd到PsExec解压目录，使用如下命令将我们所需要的蓝牙密钥信息保存到C盘根目录下。",[149,1887,1891],{"className":1888,"code":1889,"language":1890,"meta":110,"style":110},"language-cmd shiki shiki-themes one-light one-dark-pro","psexec.exe -s -i regedit /e C:\\BTKeys.reg HKEY_LOCAL_MACHINE\\SYSTEM\\ControlSet001\\Services\\BTHPORT\\Parameters\\Keys\n","cmd",[137,1892,1893],{"__ignoreMap":110},[308,1894,1895],{"class":310,"line":311},[308,1896,1889],{},[15,1898,1899],{},[32,1900],{"alt":1901,"src":1902},"使用psexec获取蓝牙信息","https://static.031130.xyz/uploads/2024/08/12/62f3cb0aae88f.webp",[15,1904,1905],{},"根目录的BTkeys.reg可以直接用记事本打开，内容大概是下面这个样子",[15,1907,1908],{},[32,1909],{"alt":1910,"src":1911},"BTkeys.reg","https://static.031130.xyz/uploads/2024/08/12/62f3cb0d9e04f.webp",[77,1913,1914],{},[15,1915,1916],{},"为了方便后面的解说，我用各种颜色标注了起来。",[15,1918,1919],{},"在Linux下获取su权限以后，我们需要将Linux下随机分配给鼠标的蓝牙地址改成在Windows上获取的那个地址。上图中「红部分」划出来的就是Windows下获取的地址。",[149,1921,1923],{"className":302,"code":1922,"language":304,"meta":110,"style":110},"[zhullyb@Archlinux ~]$ su\nPassword: \n[root@Archlinux zhullyb]# cd /var/lib/bluetooth/E0\\:94\\:67\\:74\\:0D\\:5F/\n[root@Archlinux E0:94:67:74:0D:5F]# ls\nC6:2A:1B:33:2E:71  cache  settings\n[root@Archlinux E0:94:67:74:0D:5F]# mv C6\\:2A\\:1B\\:33\\:2E\\:71/ C4\\:F6\\:B3\\:2C\\:BD\\:7E\n",[137,1924,1925,1930,1938,1969,1974,1985],{"__ignoreMap":110},[308,1926,1927],{"class":310,"line":311},[308,1928,1929],{"class":1525},"[zhullyb@Archlinux ~]$ su\n",[308,1931,1932,1935],{"class":310,"line":111},[308,1933,1934],{"class":314},"Password:",[308,1936,1937],{"class":1525}," \n",[308,1939,1940,1943,1946,1949,1951,1954,1956,1959,1961,1964,1966],{"class":310,"line":3},[308,1941,1942],{"class":1525},"[root@Archlinux zhullyb]# cd /var/lib/bluetooth/E0",[308,1944,1945],{"class":1578},"\\:",[308,1947,1948],{"class":1525},"94",[308,1950,1945],{"class":1578},[308,1952,1953],{"class":1525},"67",[308,1955,1945],{"class":1578},[308,1957,1958],{"class":1525},"74",[308,1960,1945],{"class":1578},[308,1962,1963],{"class":1525},"0D",[308,1965,1945],{"class":1578},[308,1967,1968],{"class":1525},"5F/\n",[308,1970,1971],{"class":310,"line":968},[308,1972,1973],{"class":1525},"[root@Archlinux E0:94:67:74:0D:5F]# ls\n",[308,1975,1976,1979,1982],{"class":310,"line":992},[308,1977,1978],{"class":314},"C6:2A:1B:33:2E:71",[308,1980,1981],{"class":318},"  cache",[308,1983,1984],{"class":318},"  settings\n",[308,1986,1987,1990,1992,1995,1997,2000,2002,2005,2007,2010,2012,2015,2017,2020,2022,2025,2027,2030,2032,2035,2037],{"class":310,"line":1001},[308,1988,1989],{"class":1525},"[root@Archlinux E0:94:67:74:0D:5F]# mv C6",[308,1991,1945],{"class":1578},[308,1993,1994],{"class":1525},"2A",[308,1996,1945],{"class":1578},[308,1998,1999],{"class":1525},"1B",[308,2001,1945],{"class":1578},[308,2003,2004],{"class":1525},"33",[308,2006,1945],{"class":1578},[308,2008,2009],{"class":1525},"2E",[308,2011,1945],{"class":1578},[308,2013,2014],{"class":1525},"71/ C4",[308,2016,1945],{"class":1578},[308,2018,2019],{"class":1525},"F6",[308,2021,1945],{"class":1578},[308,2023,2024],{"class":1525},"B3",[308,2026,1945],{"class":1578},[308,2028,2029],{"class":1525},"2C",[308,2031,1945],{"class":1578},[308,2033,2034],{"class":1525},"BD",[308,2036,1945],{"class":1578},[308,2038,2039],{"class":1525},"7E\n",[15,2041,2042,2043],{},"再编辑",[137,2044,2045],{},"/var/lib/bluetooth/\u003C本机蓝牙地址>/\u003C鼠标蓝牙地址>/info",[15,2047,2048],{},"原文件如下：",[149,2050,2053],{"className":2051,"code":2052,"language":154},[152],"[General]\nName=MiMouse\nAppearance=0x03c2\nAddressType=static\nSupportedTechnologies=LE;\nTrusted=true\nBlocked=false\nWakeAllowed=true\nServices=00001530-1212-efde-1523-785feabcd123;00001800-0000-1000-8000-00805f9b34fb;00001801-0000-1000-8000-00805f9b34fb;0000180a-0000-1000-8000-00805f9b34fb;0000180f-0000-1000-8000-00805f9b34fb;00001812-0000-1000-8000-00805f9b34fb;\n\n[IdentityResolvingKey]\nKey=067764BF59A7531E978AFDC6BB5EC8E1\n\n[LongTermKey]\nKey=E3C49B4F3256018192942EB0CDDEE6A3\nAuthenticated=0\nEncSize=16\nEDiv=28209\nRand=15970850852728832717\n\n[DeviceID]\nSource=2\nVendor=10007\nProduct=64\nVersion=40\n\n[ConnectionParameters]\nMinInterval=6\nMaxInterval=9\nLatency=100\nTimeout=600\n",[137,2054,2052],{"__ignoreMap":110},[158,2056,2057,2072,2092],{},[91,2058,2059,2060,2063,2064,2067,2068,2071],{},"「黄色部分」",[137,2061,2062],{},"LTK"," 对应 ",[137,2065,2066],{},"LongTermKey"," 下的 ",[137,2069,2070],{},"Key","，把小写转换成大写并删去逗号即可。",[91,2073,2074,2075,2063,2078,2081,2082,2085,2086,2085,2089],{},"「绿色部分」",[137,2076,2077],{},"ERand",[137,2079,2080],{},"Rand","。这里比较特殊的是，我们必须先将 Windows 中的值倒转过来再转换为 10 进制。即",[137,2083,2084],{},"c2,83,7f,8f,7c,76,b4,02","->",[137,2087,2088],{},"02,b4,76,7c,8f,7f,83,c2",[137,2090,2091],{},"194910961239294914",[91,2093,2094,2095,2063,2098,2101],{},"「蓝色部分」",[137,2096,2097],{},"EDIV",[137,2099,2100],{},"EDiv","。把 16 进制转换成 10 进制即可，这里就不用倒转了。",[15,2103,2104],{},"具体的转换方法我不再赘述，我把我的转换过程放在下面，我相信各位读者能够看懂。",[149,2106,2108],{"className":302,"code":2107,"language":304,"meta":110,"style":110},"[zhullyb@Archlinux ~]$ echo 'e3,c0,b2,8e,64,2b,12,16,d8,c2,d7,d4,59,55,92,cd' | tr a-z A-Z | sed 's/[[:punct:]]//g'\nE3C0B28E642B1216D8C2D7D4595592CD\n[zhullyb@Archlinux ~]$ echo $((16#02B4767C8F7F83C2))    #这里我是手动倒叙的\n194910961239294914\n[zhullyb@Archlinux ~]$ echo $((16#000055a3))\n21923\n",[137,2109,2110,2137,2142,2156,2161,2171],{"__ignoreMap":110},[308,2111,2112,2115,2118,2121,2124,2127,2130,2132,2134],{"class":310,"line":311},[308,2113,2114],{"class":1525},"[zhullyb@Archlinux ~]$ echo ",[308,2116,2117],{"class":318},"'e3,c0,b2,8e,64,2b,12,16,d8,c2,d7,d4,59,55,92,cd'",[308,2119,2120],{"class":1525}," | ",[308,2122,2123],{"class":314},"tr",[308,2125,2126],{"class":318}," a-z",[308,2128,2129],{"class":318}," A-Z",[308,2131,2120],{"class":1525},[308,2133,444],{"class":314},[308,2135,2136],{"class":318}," 's/[[:punct:]]//g'\n",[308,2138,2139],{"class":310,"line":111},[308,2140,2141],{"class":314},"E3C0B28E642B1216D8C2D7D4595592CD\n",[308,2143,2144,2147,2150,2153],{"class":310,"line":3},[308,2145,2146],{"class":1525},"[zhullyb@Archlinux ~]$ echo $((",[308,2148,2149],{"class":314},"16#02B4767C8F7F83C2",[308,2151,2152],{"class":1525},"))    ",[308,2154,2155],{"class":1771},"#这里我是手动倒叙的\n",[308,2157,2158],{"class":310,"line":968},[308,2159,2160],{"class":314},"194910961239294914\n",[308,2162,2163,2165,2168],{"class":310,"line":992},[308,2164,2146],{"class":1525},[308,2166,2167],{"class":314},"16#000055a3",[308,2169,2170],{"class":1525},"))\n",[308,2172,2173],{"class":310,"line":1001},[308,2174,2175],{"class":314},"21923\n",[15,2177,2178,2179,2182],{},"做完这些操作以后，",[137,2180,2181],{},"sudo systemctl start bluetooth","即可",[569,2184,2185],{},"html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .s_Sar, html code.shiki .s_Sar{--shiki-default:#0184BC;--shiki-dark:#56B6C2}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html pre.shiki code .sW2Sy, html code.shiki .sW2Sy{--shiki-default:#A0A1A7;--shiki-default-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic}",{"title":110,"searchDepth":111,"depth":111,"links":2187},[],{"title":2189,"date":2190,"path":2191,"tags":2192,"body":2194},"选择最新的Archlinux镜像源","2021-05-29","/2021/05/29/choose-the-last-archlinux-mirror-site-in-china",[119,2193],"Mirror Site",{"type":12,"value":2195,"toc":2895},[2196,2200,2203,2212,2215,2221,2231,2237,2783,2786,2792,2795,2798,2806,2809,2870,2877,2883,2889,2892],[133,2197,2199],{"id":2198},"找到最新的archlinux镜像源","找到最新的Archlinux镜像源",[15,2201,2202],{},"我是testing+kde-unstable用户，平均每天更新4次，对于我而言，选择最新的Archlinux镜像是非常重要的。",[15,2204,2205,2206,2211],{},"Archlinux的主源并不开放给个人用户使用，仅开放给",[19,2207,2210],{"href":2208,"rel":2209},"https://archlinux.org/mirrors/tier/1/",[23],"一级镜像站","进行同步，因此我们需要手动寻找国内较新的镜像站。（理论上来说一级镜像站应该比二级镜像站更新，但是有些一级镜像站的同步频率并不高，同步延迟可能会比某些二级镜像站还要高）",[15,2213,2214],{},"一个archlinux的镜像目录大概是长下面这个样子",[149,2216,2219],{"className":2217,"code":2218,"language":154},[152],"archlinux/\n├── community\n├── community-staging\n├── community-testing\n├── core\n├── extra\n├── gnome-unstable\n├── images\n├── iso\n├── kde-unstable\n├── lastsync\n├── lastupdate\n├── multilib\n├── multilib-staging\n├── multilib-testing\n├── pool\n├── staging\n└── testing\n",[137,2220,2218],{"__ignoreMap":110},[15,2222,2223,2224,1348,2227,2230],{},"其中的",[137,2225,2226],{},"lastsync",[137,2228,2229],{},"lastupdate","用unix时间戳记录着上一次同步时间和镜像的上一次变更时间。",[15,2232,2233,2234,2236],{},"因此，我们只需要对比各个镜像站的",[137,2235,2226],{},"谁比较新就行了，我写了如下的辣鸡脚本",[149,2238,2240],{"className":302,"code":2239,"language":304,"meta":110,"style":110},"#!/bin/bash\n\ntuna=$(curl -s https://mirrors.tuna.tsinghua.edu.cn/archlinux/lastsync)\nbfsu=$(curl -s https://mirrors.bfsu.edu.cn/archlinux/lastsync)\nsjtug=$(curl -s https://mirror.sjtu.edu.cn/archlinux/lastsync)\naliyun=$(curl -s https://mirrors.aliyun.com/archlinux/lastsync)\nustc=$(curl -s https://mirrors.ustc.edu.cn/archlinux/lastsync)\nzju=$(curl -s https://mirrors.zju.edu.cn/archlinux/lastsync)\ncqu=$(curl -s https://mirrors.cqu.edu.cn/archlinux/lastsync)\nlzu=$(curl -s https://mirror.lzu.edu.cn/archlinux/lastsync)\nneusoft=$(curl -s https://mirrors.neusoft.edu.cn/archlinux/lastsync)\ndgut=$(curl -s https://mirrors.dgut.edu.cn/archlinux/lastsync)\nnetease=$(curl -s https://mirrors.163.com/archlinux/lastsync)\ntencent=$(curl -s https://mirrors.tencent.com/archlinux/lastsync)\nhit=$(curl -s https://mirrors.hit.edu.cn/archlinux/lastsync)\nhuaweicloud=$(curl -s https://mirrors.huaweicloud.com/archlinux/lastsync)\nsohu=$(curl -s https://mirrors.sohu.com/archlinux/lastsync)\nopentuna=$(curl -s https://opentuna.cn/archlinux/lastsync)\npku=$(curl -s https://mirrors.pku.edu.cn/archlinux/lastsync)\nnju=$(curl -s https://mirrors.nju.edu.cn/archlinux/lastsync)\nnjupt=$(curl -s https://mirrors.nju.edu.cn/archlinux/lastsync)\n\necho \"\"\"\n$tuna        #tuna\n$bfsu        #bfsu\n$sjtug       #sjtug\n$aliyun      #aliyun\n$ustc        #ustc\n$zju         #zju\n$cqu         #cqu\n$lzu         #lzu\n$neusoft     #neusoft\n$dgut        #dgut\n$netease     #netease\n$tencent     #tencent\n$hit         #hit\n$huaweicloud #huaweicloud\n$sohu        #sohu\n$opentuna    #opentuna\n$pku         #pku\n$nju         #nju\n$njupt       #njupt\n\"\"\"  | sort -r\n",[137,2241,2242,2247,2251,2274,2292,2310,2328,2346,2364,2382,2400,2418,2436,2454,2472,2490,2508,2526,2544,2562,2580,2597,2601,2609,2617,2625,2633,2641,2649,2657,2665,2673,2681,2689,2697,2705,2714,2723,2732,2741,2750,2759,2768],{"__ignoreMap":110},[308,2243,2244],{"class":310,"line":311},[308,2245,2246],{"class":1771},"#!/bin/bash\n",[308,2248,2249],{"class":310,"line":111},[308,2250,1023],{"emptyLinePlaceholder":1022},[308,2252,2253,2256,2260,2263,2265,2268,2271],{"class":310,"line":3},[308,2254,2255],{"class":453},"tuna",[308,2257,2259],{"class":2258},"sknuh","=",[308,2261,2262],{"class":1525},"$(",[308,2264,203],{"class":314},[308,2266,2267],{"class":322}," -s",[308,2269,2270],{"class":318}," https://mirrors.tuna.tsinghua.edu.cn/archlinux/lastsync",[308,2272,2273],{"class":1525},")\n",[308,2275,2276,2279,2281,2283,2285,2287,2290],{"class":310,"line":968},[308,2277,2278],{"class":453},"bfsu",[308,2280,2259],{"class":2258},[308,2282,2262],{"class":1525},[308,2284,203],{"class":314},[308,2286,2267],{"class":322},[308,2288,2289],{"class":318}," https://mirrors.bfsu.edu.cn/archlinux/lastsync",[308,2291,2273],{"class":1525},[308,2293,2294,2297,2299,2301,2303,2305,2308],{"class":310,"line":992},[308,2295,2296],{"class":453},"sjtug",[308,2298,2259],{"class":2258},[308,2300,2262],{"class":1525},[308,2302,203],{"class":314},[308,2304,2267],{"class":322},[308,2306,2307],{"class":318}," https://mirror.sjtu.edu.cn/archlinux/lastsync",[308,2309,2273],{"class":1525},[308,2311,2312,2315,2317,2319,2321,2323,2326],{"class":310,"line":1001},[308,2313,2314],{"class":453},"aliyun",[308,2316,2259],{"class":2258},[308,2318,2262],{"class":1525},[308,2320,203],{"class":314},[308,2322,2267],{"class":322},[308,2324,2325],{"class":318}," https://mirrors.aliyun.com/archlinux/lastsync",[308,2327,2273],{"class":1525},[308,2329,2330,2333,2335,2337,2339,2341,2344],{"class":310,"line":1010},[308,2331,2332],{"class":453},"ustc",[308,2334,2259],{"class":2258},[308,2336,2262],{"class":1525},[308,2338,203],{"class":314},[308,2340,2267],{"class":322},[308,2342,2343],{"class":318}," https://mirrors.ustc.edu.cn/archlinux/lastsync",[308,2345,2273],{"class":1525},[308,2347,2348,2351,2353,2355,2357,2359,2362],{"class":310,"line":1019},[308,2349,2350],{"class":453},"zju",[308,2352,2259],{"class":2258},[308,2354,2262],{"class":1525},[308,2356,203],{"class":314},[308,2358,2267],{"class":322},[308,2360,2361],{"class":318}," https://mirrors.zju.edu.cn/archlinux/lastsync",[308,2363,2273],{"class":1525},[308,2365,2366,2369,2371,2373,2375,2377,2380],{"class":310,"line":1026},[308,2367,2368],{"class":453},"cqu",[308,2370,2259],{"class":2258},[308,2372,2262],{"class":1525},[308,2374,203],{"class":314},[308,2376,2267],{"class":322},[308,2378,2379],{"class":318}," https://mirrors.cqu.edu.cn/archlinux/lastsync",[308,2381,2273],{"class":1525},[308,2383,2384,2387,2389,2391,2393,2395,2398],{"class":310,"line":1035},[308,2385,2386],{"class":453},"lzu",[308,2388,2259],{"class":2258},[308,2390,2262],{"class":1525},[308,2392,203],{"class":314},[308,2394,2267],{"class":322},[308,2396,2397],{"class":318}," https://mirror.lzu.edu.cn/archlinux/lastsync",[308,2399,2273],{"class":1525},[308,2401,2402,2405,2407,2409,2411,2413,2416],{"class":310,"line":1040},[308,2403,2404],{"class":453},"neusoft",[308,2406,2259],{"class":2258},[308,2408,2262],{"class":1525},[308,2410,203],{"class":314},[308,2412,2267],{"class":322},[308,2414,2415],{"class":318}," https://mirrors.neusoft.edu.cn/archlinux/lastsync",[308,2417,2273],{"class":1525},[308,2419,2420,2423,2425,2427,2429,2431,2434],{"class":310,"line":1049},[308,2421,2422],{"class":453},"dgut",[308,2424,2259],{"class":2258},[308,2426,2262],{"class":1525},[308,2428,203],{"class":314},[308,2430,2267],{"class":322},[308,2432,2433],{"class":318}," https://mirrors.dgut.edu.cn/archlinux/lastsync",[308,2435,2273],{"class":1525},[308,2437,2438,2441,2443,2445,2447,2449,2452],{"class":310,"line":1054},[308,2439,2440],{"class":453},"netease",[308,2442,2259],{"class":2258},[308,2444,2262],{"class":1525},[308,2446,203],{"class":314},[308,2448,2267],{"class":322},[308,2450,2451],{"class":318}," https://mirrors.163.com/archlinux/lastsync",[308,2453,2273],{"class":1525},[308,2455,2456,2459,2461,2463,2465,2467,2470],{"class":310,"line":1060},[308,2457,2458],{"class":453},"tencent",[308,2460,2259],{"class":2258},[308,2462,2262],{"class":1525},[308,2464,203],{"class":314},[308,2466,2267],{"class":322},[308,2468,2469],{"class":318}," https://mirrors.tencent.com/archlinux/lastsync",[308,2471,2273],{"class":1525},[308,2473,2474,2477,2479,2481,2483,2485,2488],{"class":310,"line":1065},[308,2475,2476],{"class":453},"hit",[308,2478,2259],{"class":2258},[308,2480,2262],{"class":1525},[308,2482,203],{"class":314},[308,2484,2267],{"class":322},[308,2486,2487],{"class":318}," https://mirrors.hit.edu.cn/archlinux/lastsync",[308,2489,2273],{"class":1525},[308,2491,2492,2495,2497,2499,2501,2503,2506],{"class":310,"line":1071},[308,2493,2494],{"class":453},"huaweicloud",[308,2496,2259],{"class":2258},[308,2498,2262],{"class":1525},[308,2500,203],{"class":314},[308,2502,2267],{"class":322},[308,2504,2505],{"class":318}," https://mirrors.huaweicloud.com/archlinux/lastsync",[308,2507,2273],{"class":1525},[308,2509,2510,2513,2515,2517,2519,2521,2524],{"class":310,"line":1076},[308,2511,2512],{"class":453},"sohu",[308,2514,2259],{"class":2258},[308,2516,2262],{"class":1525},[308,2518,203],{"class":314},[308,2520,2267],{"class":322},[308,2522,2523],{"class":318}," https://mirrors.sohu.com/archlinux/lastsync",[308,2525,2273],{"class":1525},[308,2527,2528,2531,2533,2535,2537,2539,2542],{"class":310,"line":1082},[308,2529,2530],{"class":453},"opentuna",[308,2532,2259],{"class":2258},[308,2534,2262],{"class":1525},[308,2536,203],{"class":314},[308,2538,2267],{"class":322},[308,2540,2541],{"class":318}," https://opentuna.cn/archlinux/lastsync",[308,2543,2273],{"class":1525},[308,2545,2546,2549,2551,2553,2555,2557,2560],{"class":310,"line":1087},[308,2547,2548],{"class":453},"pku",[308,2550,2259],{"class":2258},[308,2552,2262],{"class":1525},[308,2554,203],{"class":314},[308,2556,2267],{"class":322},[308,2558,2559],{"class":318}," https://mirrors.pku.edu.cn/archlinux/lastsync",[308,2561,2273],{"class":1525},[308,2563,2564,2567,2569,2571,2573,2575,2578],{"class":310,"line":1093},[308,2565,2566],{"class":453},"nju",[308,2568,2259],{"class":2258},[308,2570,2262],{"class":1525},[308,2572,203],{"class":314},[308,2574,2267],{"class":322},[308,2576,2577],{"class":318}," https://mirrors.nju.edu.cn/archlinux/lastsync",[308,2579,2273],{"class":1525},[308,2581,2582,2585,2587,2589,2591,2593,2595],{"class":310,"line":1098},[308,2583,2584],{"class":453},"njupt",[308,2586,2259],{"class":2258},[308,2588,2262],{"class":1525},[308,2590,203],{"class":314},[308,2592,2267],{"class":322},[308,2594,2577],{"class":318},[308,2596,2273],{"class":1525},[308,2598,2599],{"class":310,"line":1104},[308,2600,1023],{"emptyLinePlaceholder":1022},[308,2602,2603,2606],{"class":310,"line":1109},[308,2604,2605],{"class":1578},"echo",[308,2607,2608],{"class":318}," \"\"\"\n",[308,2610,2611,2614],{"class":310,"line":1115},[308,2612,2613],{"class":453},"$tuna",[308,2615,2616],{"class":318},"        #tuna\n",[308,2618,2619,2622],{"class":310,"line":1120},[308,2620,2621],{"class":453},"$bfsu",[308,2623,2624],{"class":318},"        #bfsu\n",[308,2626,2627,2630],{"class":310,"line":1126},[308,2628,2629],{"class":453},"$sjtug",[308,2631,2632],{"class":318},"       #sjtug\n",[308,2634,2635,2638],{"class":310,"line":1132},[308,2636,2637],{"class":453},"$aliyun",[308,2639,2640],{"class":318},"      #aliyun\n",[308,2642,2643,2646],{"class":310,"line":1138},[308,2644,2645],{"class":453},"$ustc",[308,2647,2648],{"class":318},"        #ustc\n",[308,2650,2651,2654],{"class":310,"line":1144},[308,2652,2653],{"class":453},"$zju",[308,2655,2656],{"class":318},"         #zju\n",[308,2658,2659,2662],{"class":310,"line":1150},[308,2660,2661],{"class":453},"$cqu",[308,2663,2664],{"class":318},"         #cqu\n",[308,2666,2667,2670],{"class":310,"line":1156},[308,2668,2669],{"class":453},"$lzu",[308,2671,2672],{"class":318},"         #lzu\n",[308,2674,2675,2678],{"class":310,"line":1162},[308,2676,2677],{"class":453},"$neusoft",[308,2679,2680],{"class":318},"     #neusoft\n",[308,2682,2683,2686],{"class":310,"line":1168},[308,2684,2685],{"class":453},"$dgut",[308,2687,2688],{"class":318},"        #dgut\n",[308,2690,2691,2694],{"class":310,"line":1174},[308,2692,2693],{"class":453},"$netease",[308,2695,2696],{"class":318},"     #netease\n",[308,2698,2699,2702],{"class":310,"line":1180},[308,2700,2701],{"class":453},"$tencent",[308,2703,2704],{"class":318},"     #tencent\n",[308,2706,2708,2711],{"class":310,"line":2707},36,[308,2709,2710],{"class":453},"$hit",[308,2712,2713],{"class":318},"         #hit\n",[308,2715,2717,2720],{"class":310,"line":2716},37,[308,2718,2719],{"class":453},"$huaweicloud",[308,2721,2722],{"class":318}," #huaweicloud\n",[308,2724,2726,2729],{"class":310,"line":2725},38,[308,2727,2728],{"class":453},"$sohu",[308,2730,2731],{"class":318},"        #sohu\n",[308,2733,2735,2738],{"class":310,"line":2734},39,[308,2736,2737],{"class":453},"$opentuna",[308,2739,2740],{"class":318},"    #opentuna\n",[308,2742,2744,2747],{"class":310,"line":2743},40,[308,2745,2746],{"class":453},"$pku",[308,2748,2749],{"class":318},"         #pku\n",[308,2751,2753,2756],{"class":310,"line":2752},41,[308,2754,2755],{"class":453},"$nju",[308,2757,2758],{"class":318},"         #nju\n",[308,2760,2762,2765],{"class":310,"line":2761},42,[308,2763,2764],{"class":453},"$njupt",[308,2766,2767],{"class":318},"       #njupt\n",[308,2769,2771,2774,2777,2780],{"class":310,"line":2770},43,[308,2772,2773],{"class":318},"\"\"\"",[308,2775,2776],{"class":1525},"  | ",[308,2778,2779],{"class":314},"sort",[308,2781,2782],{"class":322}," -r\n",[15,2784,2785],{},"其运行结果如下",[149,2787,2790],{"className":2788,"code":2789,"language":154},[152],"1622248120     #neusoft\n1622247879        #dgut\n1622247698         #hit\n1622246042         #zju\n1622246042        #tuna\n1622246042        #bfsu\n1622242426       #sjtug\n1622242426       #njupt\n1622242426         #nju\n1622240702        #ustc\n1622240522         #cqu\n1622238783     #netease\n1622235120         #lzu\n1622232241 #huaweicloud\n1622230871     #tencent\n1622217845      #aliyun\n1622217001         #pku\n1622203750        #sohu\n1622166379    #opentuna\n",[137,2791,2789],{"__ignoreMap":110},[15,2793,2794],{},"通过不同时刻的多次测试可以看出，国内同步频率最高的是东软（neusoft）的镜像。顺手一查，没错，是个一级镜像站。通过unix时间戳得知，东软的archlinux镜像几乎是每分钟同步一次，恐怖如斯。。。",[128,2796,2797],{"id":2797},"获得更好的下载速度",[15,2799,2800,2801],{},"我们已经得知东软是国内同步频率最高的Archlinux镜像站了，但是我用东软镜像站的下载速度并不太好看。此时，我们就要搬出依云大佬的神器——",[19,2802,2805],{"href":2803,"rel":2804},"https://blog.lilydjwg.me/2020/10/29/pacsync.215578.html",[23],"pacsync",[15,2807,2808],{},"在root用户下使用如下命令装载pacysnc后",[149,2810,2812],{"className":302,"code":2811,"language":304,"meta":110,"style":110},"echo '#!/bin/bash -e\n\nunshare -m bash \u003C\u003C'EOF'\nmount --make-rprivate /\nfor f in /etc/pacman.d/*.sync; do\n  filename=\"${f%.*}\"\n  mount --bind \"$f\" \"$filename\"\ndone\npacman -Sy\nEOF' > /usr/bin/pacsync\n",[137,2813,2814,2821,2825,2830,2835,2840,2845,2850,2855,2860],{"__ignoreMap":110},[308,2815,2816,2818],{"class":310,"line":311},[308,2817,2605],{"class":1578},[308,2819,2820],{"class":318}," '#!/bin/bash -e\n",[308,2822,2823],{"class":310,"line":111},[308,2824,1023],{"emptyLinePlaceholder":1022},[308,2826,2827],{"class":310,"line":3},[308,2828,2829],{"class":318},"unshare -m bash \u003C\u003C'EOF'\n",[308,2831,2832],{"class":310,"line":968},[308,2833,2834],{"class":318},"mount --make-rprivate /\n",[308,2836,2837],{"class":310,"line":992},[308,2838,2839],{"class":318},"for f in /etc/pacman.d/*.sync; do\n",[308,2841,2842],{"class":310,"line":1001},[308,2843,2844],{"class":318},"  filename=\"${f%.*}\"\n",[308,2846,2847],{"class":310,"line":1010},[308,2848,2849],{"class":318},"  mount --bind \"$f\" \"$filename\"\n",[308,2851,2852],{"class":310,"line":1019},[308,2853,2854],{"class":318},"done\n",[308,2856,2857],{"class":310,"line":1026},[308,2858,2859],{"class":318},"pacman -Sy\n",[308,2861,2862,2865,2867],{"class":310,"line":1035},[308,2863,2864],{"class":318},"EOF'",[308,2866,1526],{"class":1525},[308,2868,2869],{"class":318},"/usr/bin/pacsync\n",[15,2871,2872,2873,2876],{},"创建",[137,2874,2875],{},"/etc/pacman.d/mirrorlist.sync","指定我们用来同步pacman数据库（比如东软）",[15,2878,2879,2882],{},[137,2880,2881],{},"/etc/pacman.d/mirrorlist","中存放其他国内镜像源地址（按照同步速度从上到下）",[15,2884,2885,2886],{},"以后的同步命令为 ",[137,2887,2888],{},"sudo pacsync && yay -Su",[15,2890,2891],{},"觉得命令过长的话设置alias可以是个不错的选择。",[569,2893,2894],{},"html pre.shiki code .sW2Sy, html code.shiki .sW2Sy{--shiki-default:#A0A1A7;--shiki-default-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic}html pre.shiki code .sJa8x, html code.shiki .sJa8x{--shiki-default:#E45649;--shiki-dark:#E06C75}html pre.shiki code .sknuh, html code.shiki .sknuh{--shiki-default:#383A42;--shiki-dark:#56B6C2}html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html pre.shiki code .s_Sar, html code.shiki .s_Sar{--shiki-default:#0184BC;--shiki-dark:#56B6C2}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}",{"title":110,"searchDepth":111,"depth":111,"links":2896},[2897,2898],{"id":2198,"depth":3,"text":2199},{"id":2797,"depth":111,"text":2797},{"title":2900,"date":2901,"path":2902,"tags":2903,"body":2904},"请给 tuna/ustc 镜像站减压","2021-05-27 21:25:48","/2021/05/27/relieve-the-pressure-of-tuna-mirror-site-please",[118,2193],{"type":12,"value":2905,"toc":2999},[2906,2915,2921,2924,2935,2938,2946,2954,2960,2963,2969,2972,2978,2981,2987,2990,2996],[15,2907,2908,2909,2914],{},"不知道从什么时候开始，我总觉得tuna的镜像站提供的下载速度越来越慢，直到我前几天翻开tuna镜像站的「",[19,2910,2913],{"href":2911,"rel":2912},"https://mirrors.tuna.tsinghua.edu.cn/status/#server-status",[23],"服务器状态","」，我被眼前的景象给震惊到了。",[15,2916,2917],{},[32,2918],{"alt":2919,"src":2920},"本图截于2021年5月27日晚","https://static.031130.xyz/uploads/2024/08/12/62f3baac63cd2.webp",[15,2922,2923],{},"我在这里大致观察了一下这张图：服务器流量主要是由四个部分组成，「http-ipv4」、「https-ipv4」、「http-ipv6」和「https-ipv6」。光是从过去24小时的平均出站流量来计算的话，大约就是2.4Gb/s，如果观察图中的流量高峰期的话，大概是4Gb/s的一个速率。这个流量大小是什么概念呢？根据我个人浅薄的建站经验来讲，这个流量可以让大部分供应商把你的网站判断为正在遭受攻击，你将被强制进入黑洞模式。然而对于tuna的镜像站而言，这个流量速率确是日常。换句话说，tuna的服务器都相当于每时每刻都在被来自全国的开发者“攻击”。",[77,2925,2926,2929],{},[15,2927,2928],{},"来自 2022 年的竹林: 我是真没想到去年 tuna 的网络负载只有这点的。2022 年的负载图在下面附上，已经翻了一倍不止了",[15,2930,2931],{},[32,2932],{"alt":2933,"src":2934},"本图截于2022年8月10日晚","https://static.031130.xyz/uploads/2024/08/12/62f3ba4204ecb.webp",[15,2936,2937],{},"因此，我们也就不难理解为什么tuna近些年来经常出现断流等一系列问题了。",[77,2939,2940,2943],{},[15,2941,2942],{},"客观上 TUNA 和 UTSC 是国内知名度和镜像项目数量以及同步速度都靠前的镜像站，但也因为如此，这两个镜像站每日的带宽负载是很大的；能跑满我的本地带宽速度是较理想的情况，但是那么大的负载，时间跨度长了体验到的波动差异也就多了起来。至少在我这里，长时间使用两个镜像站的速度波动挺大的。TUNA 也曾微言过带宽日益不堪重负，所以从道德情感和技术理论等角度上，尽管他们是理想的镜像站点，我个人不会优先使用这两个镜像站，也不会优先推荐别人使用。",[15,2944,2945],{},"——WPlanck",[15,2947,2948,2949,2953],{},"国内的开源镜像站我大多都已经收集到",[19,2950,2952],{"href":2951},"/2020/07/11/china-mainland-mirrorlist/","这一篇博客中","了，以下几个镜像站是我重点推荐的。",[133,2955,2956],{"id":2278},[19,2957,2278],{"href":2958,"rel":2959},"https://mirrors.bfsu.edu.cn/",[23],[15,2961,2962],{},"tuna的姊妹站，通俗来讲就是tuna派人维护，北京外国语大学出钱。人少、稳定、涵盖项目较广。",[133,2964,2965],{"id":2296},[19,2966,2296],{"href":2967,"rel":2968},"https://mirrors.sjtug.sjtu.edu.cn/",[23],[15,2970,2971],{},"上海交大的站点，也有不少项目，据说sjtug上的manjaro镜像是国内几个开源镜像站中同步最勤快的，用的人也不多。",[133,2973,2974],{"id":2530},[19,2975,2530],{"href":2976,"rel":2977},"https://opentuna.cn/",[23],[15,2979,2980],{},"tuna那边用国内aws服务器搭的站点，速度超快，不过比较可惜的是现在同步的项目不多，同步频率低，大概是一天一次的样子。",[133,2982,2983],{"id":2548},[19,2984,2548],{"href":2985,"rel":2986},"https://mirrors.pku.edu.cn/Mirrors",[23],[15,2988,2989],{},"是不是没想到北大也有镜像站？没记错的话是今年三四月左右刚开的，和opentuna情况差不多，用的人少、速度快、同步的项目不多。",[133,2991,2992],{"id":2476},[19,2993,2476],{"href":2994,"rel":2995},"https://mirrors.hit.edu.cn/",[23],[15,2997,2998],{},"哈尔滨工业大学的镜像站，速度我跑下来感觉一般，不是特别亮眼，不过同步频率高。",{"title":110,"searchDepth":111,"depth":111,"links":3000},[3001,3002,3003,3004,3005],{"id":2278,"depth":3,"text":2278},{"id":2296,"depth":3,"text":2296},{"id":2530,"depth":3,"text":2530},{"id":2548,"depth":3,"text":2548},{"id":2476,"depth":3,"text":2476},{"title":3007,"date":3008,"path":3009,"tags":3010,"body":3011},"我为什么选择Archlinux？","2021-05-23","/2021/05/23/why-i-use-archlinux",[119],{"type":12,"value":3012,"toc":3103},[3013,3016,3019,3022,3029,3032,3038,3041,3044,3048,3051,3054,3057,3060,3063,3066,3069,3072,3080,3084,3087,3090,3094,3097,3100],[15,3014,3015],{},"对于我而言，我用Archlinux主要的原因就是实用主义。我可以很负责的说，Arch真的是在我所有用过的发行版当中最符合实用主义的一个了。",[15,3017,3018],{},"很多大佬一提到Archlinux就扯些什么kiss原则，在我看来则不然。",[128,3020,3021],{"id":3021},"整洁规范的系统",[15,3023,3024,3025,3028],{},"规范代码为的不是为了什么",[52,3026,3027],{},"Art of Code","，而是可读性的提升；遵循kiss原则亦是如此。",[15,3030,3031],{},"配置文件的路径写好了，符合规范，我们就能一下子找到，我们是为了实用主义而遵守kiss原则。",[15,3033,3034,3035],{},"同样的，我同样可以为了实用主义而破坏kiss原则。",[408,3036,3037],{},"比如在我的archiso-zhullyb中，我添加了一个pacman的hook将我的定制内核重命名为linux以确保其能够正确被ventoy所识别，这也是为了实用主义。",[15,3039,3040],{},"那么，什么时候我会破坏kiss原则呢？当我认为破坏kiss原则所带来的利大于弊时，我就会考虑以一个并不规范但却有效的方法来处理问题。",[15,3042,3043],{},"但很有趣的是，由于Archlinux的官方总是将kiss奉为圣旨，这就给我们提供了一个非常nice的环境了——在一个非常规范的系统内，破坏kiss原则所带来的代价并不会很大，这就好比在一个布线整齐的机房内临时私拉两三根线并不会给维护带来多大的困难。",[128,3045,3047],{"id":3046},"archlinux对上游软件包的发行策略","Archlinux对上游软件包的发行策略",[15,3049,3050],{},"不同于apt在源内提供了统一软件的多个版本供用户选择，pacman剑走偏锋，默认用户系统内所有软件都是最新的。",[15,3052,3053],{},"由此带来了一个好处——不会出现由于版本过高/过低导致的依赖问题。只要我保证系统内的所有软件都是最新的，就不会出问题，非常的简单粗暴。",[15,3055,3056],{},"此外，不考虑依赖版本这一特点对于打包人来说也是一种解脱。",[128,3058,3059],{"id":3059},"pacman简单的打包方式",[15,3061,3062],{},"不同于deb以及rpm，pacman的软件包应该是所有发行版中最省事儿的。",[15,3064,3065],{},"打包软件时，我们只需要写（改）一份PKGBUILD，就可以仅仅通过在PKGBUILD所在的路径执行makepkg命令来完成一次打包，这相比起deb而言可谓是天差地别。如此简单有效的打包方式注定其将被实用主义者所青睐。",[128,3067,3068],{"id":3068},"超低的社区贡献成本",[15,3070,3071],{},"很多发行版社区开发与贡献其实并不容易参与进去，我拿Ubuntu来做个比较。",[77,3073,3074,3077],{},[15,3075,3076],{},"附: Archwiki是先斩后奏类型的文档，在你按下保存按钮的那一刻，wiki将立即被更新，所有访客都将看到你改动后的内容。wiki文档拥有变更记录，不担心有人恶意搞破坏，向wiki管理员提出举报后破坏者的账号会被及时封禁，wiki可以非常简单地回滚到之前的状态。",[15,3078,3079],{},"AUR同样也是，你可以随意上传自己的PKGBUILD，可以被别的用户及时看到。如果上传恶意脚本，在别的用户举报后你将迅速被封号。",[133,3081,3083],{"id":3082},"wiki方面","Wiki方面",[15,3085,3086],{},"Ubuntu其实是我第一个上手的Linux发行版，在为期半年的Ubuntu体验中，我对于社区做出的贡献为0。这倒也不是我不热衷于参与社区贡献，而是对Ubuntu社区的贡献成本太高了。去贡献文档翻译，需要等待漫长的审核过程，在第一篇汉化文章正式展现在别的用户眼前后，我一定会被激发出继续翻译第二篇的热情。然而，面对太长的审核周期，再高涨的热情恐怕也会被浇灭。",[15,3088,3089],{},"Arch的社区则不一样，他并不像别的社区那样严谨——只要注册个wiki的账号便可以开始贡献文档。你可以随意地编辑一篇文章或者是新增一篇自己的文章，编辑后的文章将能够立即被别的用户所阅读到，没有任何审核过程，有了这份热情，我便继续翻译别的文档，我想，这应该就是archwiki为何涵盖面如此之广的原因。",[133,3091,3093],{"id":3092},"aur方面","AUR方面",[15,3095,3096],{},"同样也是拿Ubuntu对比。",[15,3098,3099],{},"在Archlinux下，我只需要简单的写一个PKGBUILD即可轻松构建一个软件包，同时，我也可以将这份有我攥写的PKGBUILD上传到AUR供别的用户使用。AUR作为一个公开的储存库，任何Arch用户都可以通过AUR Helper轻松得从AUR中获取我写的PKGBUILD并在本地打成自己的包。与此同时，我也可以创建一个私人源，直接发行我构建的二进制包。",[15,3101,3102],{},"Ubutnu则不然，他的打包方式则要麻烦得多，同时也没有类似PKGBUILD一样的东西便于用户分享自己的打包脚本。唯一能够分享自己的劳动成果的方式无非就是直接分享自己打出来的deb包，最多也不过是建立自己的ppa，这对于用户来说是极为麻烦的。用户需要处心积虑地寻找自己所需要的deb包或是含有目标包的ppa地址并手动添加，不像Archlinux有AUR这种东西能够让我们知道在哪里能够找到我们所需要的包。",{"title":110,"searchDepth":111,"depth":111,"links":3104},[3105,3106,3107,3108],{"id":3021,"depth":111,"text":3021},{"id":3046,"depth":111,"text":3047},{"id":3059,"depth":111,"text":3059},{"id":3068,"depth":111,"text":3068,"children":3109},[3110,3111],{"id":3082,"depth":3,"text":3083},{"id":3092,"depth":3,"text":3093},{"title":3113,"date":3114,"path":3115,"tags":3116,"body":3119},"使用vercel创建一个随机图片api","2021-05-21","/2021/05/21/create-a-random-picture-api-with-vercel",[3117,3118],"Network","Vercel",{"type":12,"value":3120,"toc":3252},[3121,3132,3143,3146,3149,3160,3163,3168,3181,3187,3190,3196,3249],[15,3122,3123,3124,3131],{},"如果你的网络环境不算太差的话，你在访问我博客的时候应该可以看到顶部有一张背景图。假如你访问我的博客时留心观察，你或许会发现每次你访问我博客时的背景都是不一样的。如果你没玩够，或许你可以尝试",[19,3125,3128],{"href":3126,"rel":3127},"https://randompic.zhul.in/api/randomtoppic.php",[23],[52,3129,3130],{},"点击这里","，我总共搜集了20张壁纸供诸位赏玩。",[15,3133,3134,3135,3142],{},"是的，这是使用php实现的随机图片api，托管于vercel，你可以在",[19,3136,3139],{"href":3137,"rel":3138},"https://note.aya1.top/#/4-phpapi",[23],[52,3140,3141],{},"aya的博客","上找到我使用的代码。具体配置方式我不再赘述。",[15,3144,3145],{},"然而，我们还需要解决一个问题: php在哪里运行？",[15,3147,3148],{},"如果你拥有自己的服务器，在国内访问速度毫不逊色，那就好办了，直接扔自己服务器上即可。然而，我并没有。我需要找到一个在国内访问速度给力的地方来部署我的api，以确保访客在打开我的博客时可以在第一时间获取到图片的真实链接并开始加载。",[15,3150,3151,3152,3155,3156,3159],{},"起初，我将其部署在我的好朋友(",[408,3153,3154],{},"你可以猜猜他是谁",")的国内vps上，访问速度自然不用说。然而，他的服务器",[52,3157,3158],{},"不支持https","，这就导致使用chrome访问的时候chrome不会自动访问我的api，博客顶部一片惨蓝。。。",[15,3161,3162],{},"随后，我使用的是000webhost提供的虚拟主机，国内访问起来也还不错，大概正常运行了半个月左右的时间，然后莫名开始502了。我懂，作为不交钱的白嫖用户应该自觉滚蛋了，这点觉悟咱还是有。",[15,3164,3165],{},[52,3166,3167],{},"随后，我找到了目前的方案——vercel",[15,3169,3170,3171,3174,3175,3180],{},"vercel是被我用来部署静态网页的，但我没想到他也能",[52,3172,3173],{},"支持php","。参考了",[19,3176,3179],{"href":3177,"rel":3178},"https://github.com/juicyfx/vercel-php",[23],"vercel-php","项目后，我大致了解了整个仓库结构。",[149,3182,3185],{"className":3183,"code":3184,"language":154},[152],"project\n├── api\n│   └── index.php\n└── vercel.json\n",[137,3186,3184],{"__ignoreMap":110},[15,3188,3189],{},"php和附带的资源文件(如果有的话)一定要放到api文件夹下才能够正常被vercel识别。",[15,3191,3192,3193],{},"以下附",[137,3194,3195],{},"vercel.json",[149,3197,3201],{"className":3198,"code":3199,"language":3200,"meta":110,"style":110},"language-json shiki shiki-themes one-light one-dark-pro","{\n  \"functions\": {\n    \"api/index.php\": {\n      \"runtime\": \"vercel-php@0.4.0\"\n    }\n  }\n}\n","json",[137,3202,3203,3208,3216,3223,3234,3239,3244],{"__ignoreMap":110},[308,3204,3205],{"class":310,"line":311},[308,3206,3207],{"class":1525},"{\n",[308,3209,3210,3213],{"class":310,"line":111},[308,3211,3212],{"class":453},"  \"functions\"",[308,3214,3215],{"class":1525},": {\n",[308,3217,3218,3221],{"class":310,"line":3},[308,3219,3220],{"class":453},"    \"api/index.php\"",[308,3222,3215],{"class":1525},[308,3224,3225,3228,3231],{"class":310,"line":968},[308,3226,3227],{"class":453},"      \"runtime\"",[308,3229,3230],{"class":1525},": ",[308,3232,3233],{"class":318},"\"vercel-php@0.4.0\"\n",[308,3235,3236],{"class":310,"line":992},[308,3237,3238],{"class":1525},"    }\n",[308,3240,3241],{"class":310,"line":1001},[308,3242,3243],{"class":1525},"  }\n",[308,3245,3246],{"class":310,"line":1010},[308,3247,3248],{"class":1525},"}\n",[569,3250,3251],{},"html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html pre.shiki code .sJa8x, html code.shiki .sJa8x{--shiki-default:#E45649;--shiki-dark:#E06C75}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}",{"title":110,"searchDepth":111,"depth":111,"links":3253},[],"/en/archives/",131,1765392897028]
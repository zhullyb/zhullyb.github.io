[{"data":1,"prerenderedAt":6336},["ShallowReactive",2],{"randomIndex/archives/page/6/":3,"index-page-6-zh":4,"language-switch-/archives/page/6/-en":6334,"posts-nums-total-zh":6335},0,[5,226,597,1044,1530,1854,4933,5165,5466,6217],{"title":6,"date":7,"path":8,"tags":9,"body":12},"crontab 中简单的@语法糖","2024-02-08 17:21:31","/2024/02/08/extra-usage-for-crontab",[10,11],"Linux","crontab",{"type":13,"value":14,"toc":223},"minimark",[15,23,39,162,165,168,219],[16,17,18,19],"p",{},"说来惭愧，其实我用了这么久的 Linux，一直没有学会编写 crontab 脚本。一行的开头写上五位莫名其妙的数字或星号，后面跟上需要执行的命令，看上去很 kiss，",[20,21,22],"del",{},"但我确实记不住，以至于我现在每次写 crontab 都是让 ChatGPT 来帮我写。",[16,24,25,26,30,31,38],{},"不过我最近查阅 Linux 下设置开机自启脚本的方案的时候，意外地看到 crontab 中居然可以用 ",[27,28,29],"code",{},"@reboot command"," 的方式去写，这让我意识到 crontab 也是有一些简单的语法糖的。在查阅了 ",[32,33,37],"a",{"href":34,"rel":35},"https://man.archlinux.org/man/crontab.5.en#EXTENSIONS",[36],"nofollow","crontab 的 manual"," 后，我发现一共有下面这么几种 @ 写法的语法糖。这是在全网大部分的 crontab 中文教程中是没有的。",[40,41,42,58],"table",{},[43,44,45],"thead",{},[46,47,48,52,55],"tr",{},[49,50,51],"th",{},"语法糖",[49,53,54],{},"执行条件",[49,56,57],{},"等效表达式",[59,60,61,74,89,102,117,132,147],"tbody",{},[46,62,63,69,72],{},[64,65,66],"td",{},[27,67,68],{},"@reboot",[64,70,71],{},"开机时候运行",[64,73],{},[46,75,76,81,84],{},[64,77,78],{},[27,79,80],{},"@yearly",[64,82,83],{},"一年一次",[64,85,86],{},[27,87,88],{},"0 0 1 1 *",[46,90,91,96,98],{},[64,92,93],{},[27,94,95],{},"@annually",[64,97,83],{},[64,99,100],{},[27,101,88],{},[46,103,104,109,112],{},[64,105,106],{},[27,107,108],{},"@monthly",[64,110,111],{},"一月一次",[64,113,114],{},[27,115,116],{},"0 0 1 * *",[46,118,119,124,127],{},[64,120,121],{},[27,122,123],{},"@weekly",[64,125,126],{},"一周一次",[64,128,129],{},[27,130,131],{},"0 0 * * 0",[46,133,134,139,142],{},[64,135,136],{},[27,137,138],{},"@daily",[64,140,141],{},"一天一次",[64,143,144],{},[27,145,146],{},"0 0 * * *",[46,148,149,154,157],{},[64,150,151],{},[27,152,153],{},"@hourly",[64,155,156],{},"一小时一次",[64,158,159],{},[27,160,161],{},"0 * * * *",[16,163,164],{},"这几个简单的语法糖可以满足大部分 crontab 的情况，免去了对使用者学习并记忆 crontab 的表达式的要求。",[16,166,167],{},"比如说，如果我希望我的系统在每次开机时都用 TG Bot 发送一条上线信息，那就是",[169,170,175],"pre",{"className":171,"code":172,"language":173,"meta":174,"style":174},"language-bash shiki shiki-themes one-light one-dark-pro","@reboot curl -s -X POST https://api.telegram.org/bot{id}:{apikey}/sendMessage -d chat_id={uid} -d text=\"`date`\"\n","bash","",[27,176,177],{"__ignoreMap":174},[178,179,182,185,189,193,196,199,202,205,208,210,213,216],"span",{"class":180,"line":181},"line",1,[178,183,68],{"class":184},"sAdtL",[178,186,188],{"class":187},"sDhpE"," curl",[178,190,192],{"class":191},"sAGMh"," -s",[178,194,195],{"class":191}," -X",[178,197,198],{"class":187}," POST",[178,200,201],{"class":187}," https://api.telegram.org/bot{id}:{apikey}/sendMessage",[178,203,204],{"class":191}," -d",[178,206,207],{"class":187}," chat_id={uid}",[178,209,204],{"class":191},[178,211,212],{"class":187}," text=\"`",[178,214,215],{"class":184},"date",[178,217,218],{"class":187},"`\"\n",[220,221,222],"style",{},"html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}",{"title":174,"searchDepth":224,"depth":224,"links":225},2,[],{"title":227,"date":228,"path":229,"tags":230,"body":234},"备份 umami 数据库，并使用 TG Bot 保存 dump 文件","2024-02-01 00:00:01","/2024/02/01/backup-umami-database-and-send-it-by-tg-bot",[231,232,233],"umami","Shell Script","Bot",{"type":13,"value":235,"toc":595},[236,245,253,260,263,266,437,448,451,460,463,471,480,555,562,586,592],[16,237,238,239,244],{},"前一阵子看到点墨的博客",[32,240,243],{"href":241,"rel":242},"https://blog.m-l.cc/2023/11/09/ding-shi-bei-fen-mysql-mariadb-shu-ju-ku-bing-shang-chuan-zhi-tgbot/",[36],"「定时备份mysql/mariadb数据库并上传至tgbot」","，我意识到个人站点的数据库 dump 使用 TG Bot 存放是一个非常合适的做法。个人站点的数据库体积本身就不大，TG Bot 又有官方提供的 api，非常适合自动化任务。我就寻思着给我的 umami 数据库也写个定时任务备份一下，也不至于之前做一次迁移数据全部爆炸的悲剧重演。",[16,246,247,248,252],{},"我的 umami 是",[32,249,251],{"href":250},"/2022/11/08/free-umami-deploy-plan/","「使用 vercel+supabase 免费部署 umami」","部署出来的，数据库在 supabase 上，因此我们先打开 supabase 的 dashboard，获取到数据库的 url。",[16,254,255],{},[256,257],"img",{"alt":258,"src":259},"supabase 操作面板","https://static.031130.xyz/uploads/2024/08/12/65ba6aae157e6.webp",[16,261,262],{},"密码我自然是不记得了，不过好在 Firefox 的密码管理器帮我记住了，直接去设置里就能找到。即使密码忘了也不要紧，往下翻有重置密码的按钮。",[16,264,265],{},"随后就要开始编写我们的教本了，这是我的",[169,267,269],{"className":171,"code":268,"language":173,"meta":174,"style":174},"#!/bin/bash\n\nDATABASE_URL=\"postgres://\"\nDATE=$(date '+%F')\n\nTG_BOT_TOKEN='1145141919:ABCDEFGHIJKLVMNOPQRSTUVWXYZabcdefgh'\nTG_CHAT_ID='9191415411'\n\npg_dump ${DATABASE_URL} > umami_dump_${DATE}.sql\ncurl -F document=@umami_dump_${DATE}.sql https://api.telegram.org/bot${TG_BOT_TOKEN}/sendDocument?chat_id=${TG_CHAT_ID}\nrm umami_dump_${DATE}.sql\n",[27,270,271,277,283,297,317,322,333,344,349,380,420],{"__ignoreMap":174},[178,272,273],{"class":180,"line":181},[178,274,276],{"class":275},"sW2Sy","#!/bin/bash\n",[178,278,279],{"class":180,"line":224},[178,280,282],{"emptyLinePlaceholder":281},true,"\n",[178,284,286,290,294],{"class":180,"line":285},3,[178,287,289],{"class":288},"sJa8x","DATABASE_URL",[178,291,293],{"class":292},"sknuh","=",[178,295,296],{"class":187},"\"postgres://\"\n",[178,298,300,303,305,309,311,314],{"class":180,"line":299},4,[178,301,302],{"class":288},"DATE",[178,304,293],{"class":292},[178,306,308],{"class":307},"s5ixo","$(",[178,310,215],{"class":184},[178,312,313],{"class":187}," '+%F'",[178,315,316],{"class":307},")\n",[178,318,320],{"class":180,"line":319},5,[178,321,282],{"emptyLinePlaceholder":281},[178,323,325,328,330],{"class":180,"line":324},6,[178,326,327],{"class":288},"TG_BOT_TOKEN",[178,329,293],{"class":292},[178,331,332],{"class":187},"'1145141919:ABCDEFGHIJKLVMNOPQRSTUVWXYZabcdefgh'\n",[178,334,336,339,341],{"class":180,"line":335},7,[178,337,338],{"class":288},"TG_CHAT_ID",[178,340,293],{"class":292},[178,342,343],{"class":187},"'9191415411'\n",[178,345,347],{"class":180,"line":346},8,[178,348,282],{"emptyLinePlaceholder":281},[178,350,352,355,359,361,364,367,370,373,375,377],{"class":180,"line":351},9,[178,353,354],{"class":184},"pg_dump",[178,356,358],{"class":357},"sr1Ac"," ${",[178,360,289],{"class":288},[178,362,363],{"class":357},"}",[178,365,366],{"class":307}," > ",[178,368,369],{"class":187},"umami_dump_",[178,371,372],{"class":357},"${",[178,374,302],{"class":288},[178,376,363],{"class":357},[178,378,379],{"class":187},".sql\n",[178,381,383,386,389,392,394,396,398,401,404,406,408,410,413,415,417],{"class":180,"line":382},10,[178,384,385],{"class":184},"curl",[178,387,388],{"class":191}," -F",[178,390,391],{"class":187}," document=@umami_dump_",[178,393,372],{"class":357},[178,395,302],{"class":288},[178,397,363],{"class":357},[178,399,400],{"class":187},".sql",[178,402,403],{"class":187}," https://api.telegram.org/bot",[178,405,372],{"class":357},[178,407,327],{"class":288},[178,409,363],{"class":357},[178,411,412],{"class":187},"/sendDocument?chat_id=",[178,414,372],{"class":357},[178,416,338],{"class":288},[178,418,419],{"class":357},"}\n",[178,421,423,426,429,431,433,435],{"class":180,"line":422},11,[178,424,425],{"class":184},"rm",[178,427,428],{"class":187}," umami_dump_",[178,430,372],{"class":357},[178,432,302],{"class":288},[178,434,363],{"class":357},[178,436,379],{"class":187},[16,438,439,440,443,444,447],{},"将这段代码保存为 ",[27,441,442],{},"umami_db_dumper.sh","，随后 ",[27,445,446],{},"chmod +x ./umami_db_dumper.sh"," 授予可执行权限。",[16,449,450],{},"可以先在命令行中执行命令试一下这段脚本是否正常工作",[169,452,454],{"className":171,"code":453,"language":173,"meta":174,"style":174},"./umami_db_dumper.sh\n",[27,455,456],{"__ignoreMap":174},[178,457,458],{"class":180,"line":181},[178,459,453],{"class":184},[16,461,462],{},"这段代码在我本机正常工作，可惜在我的 Ubuntu VPS 上报错",[169,464,469],{"className":465,"code":467,"language":468},[466],"language-text","pg_dump: error: server version: 14.1; pg_dump version: 12.17 (Ubuntu 12.17-0ubuntu0.20.04.1)\npg_dump: error: aborting because of server version mismatch\n","text",[27,470,467],{"__ignoreMap":174},[16,472,473,474,479],{},"看上去是 VPS 上的 PostgreSQL 版本过低，Google 搜索一顿后，我在一篇",[32,475,478],{"href":476,"rel":477},"https://devopsworld.medium.com/upgrade-pg-dump-version-in-ubuntu-545d691d4695",[36],"「Upgrade pg_dump version in ubuntu | by Anushareddy」"," 文章中找到了方案，添加 PostgreSQL 官方提供的 apt 源将 VPS 上的 PostgreSQL 更新到新版即可解决。",[169,481,483],{"className":171,"code":482,"language":173,"meta":174,"style":174},"wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | apt-key add -\necho \"deb http://apt.postgresql.org/pub/repos/apt/ $(lsb_release -cs)-pgdg main\" > /etc/apt/sources.list.d/pgdg.list\napt update\napt install postgresql-client\n",[27,484,485,514,537,545],{"__ignoreMap":174},[178,486,487,490,493,496,499,502,505,508,511],{"class":180,"line":181},[178,488,489],{"class":184},"wget",[178,491,492],{"class":191}," --quiet",[178,494,495],{"class":191}," -O",[178,497,498],{"class":187}," -",[178,500,501],{"class":187}," https://www.postgresql.org/media/keys/ACCC4CF8.asc",[178,503,504],{"class":307}," | ",[178,506,507],{"class":184},"apt-key",[178,509,510],{"class":187}," add",[178,512,513],{"class":187}," -\n",[178,515,516,520,523,526,529,532,534],{"class":180,"line":224},[178,517,519],{"class":518},"s_Sar","echo",[178,521,522],{"class":187}," \"deb http://apt.postgresql.org/pub/repos/apt/ $(",[178,524,525],{"class":184},"lsb_release",[178,527,528],{"class":191}," -cs",[178,530,531],{"class":187},")-pgdg main\"",[178,533,366],{"class":307},[178,535,536],{"class":187},"/etc/apt/sources.list.d/pgdg.list\n",[178,538,539,542],{"class":180,"line":285},[178,540,541],{"class":184},"apt",[178,543,544],{"class":187}," update\n",[178,546,547,549,552],{"class":180,"line":299},[178,548,541],{"class":184},[178,550,551],{"class":187}," install",[178,553,554],{"class":187}," postgresql-client\n",[16,556,557,558,561],{},"确保脚本正常工作后，使用 ",[27,559,560],{},"crontab -e"," 设置自动任务",[169,563,565],{"className":171,"code":564,"language":173,"meta":174,"style":174},"0 2 * * * /root/umami_db_dumper.sh\n",[27,566,567],{"__ignoreMap":174},[178,568,569,572,575,579,581,583],{"class":180,"line":181},[178,570,571],{"class":184},"0",[178,573,574],{"class":191}," 2",[178,576,578],{"class":577},"s2QsP"," *",[178,580,578],{"class":577},[178,582,578],{"class":577},[178,584,585],{"class":187}," /root/umami_db_dumper.sh\n",[16,587,588],{},[256,589],{"alt":590,"src":591},"数据库备份","https://static.031130.xyz/uploads/2024/08/12/65c79455b2e40.webp",[220,593,594],{},"html pre.shiki code .sW2Sy, html code.shiki .sW2Sy{--shiki-default:#A0A1A7;--shiki-default-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic}html pre.shiki code .sJa8x, html code.shiki .sJa8x{--shiki-default:#E45649;--shiki-dark:#E06C75}html pre.shiki code .sknuh, html code.shiki .sknuh{--shiki-default:#383A42;--shiki-dark:#56B6C2}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .sr1Ac, html code.shiki .sr1Ac{--shiki-default:#E45649;--shiki-dark:#ABB2BF}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html pre.shiki code .s_Sar, html code.shiki .s_Sar{--shiki-default:#0184BC;--shiki-dark:#56B6C2}html pre.shiki code .s2QsP, html code.shiki .s2QsP{--shiki-default:#E45649;--shiki-dark:#E5C07B}",{"title":174,"searchDepth":224,"depth":224,"links":596},[],{"title":598,"date":599,"path":600,"tags":601,"body":603},"在 JavaScript 中，箭头函数中的 this 指针到底指向哪里？","2024-01-14 02:50:03","/2024/01/14/where-does-this-refer-in-arrow-function-in-js",[602],"JavaScript",{"type":13,"value":604,"toc":1041},[605,612,933,936,943,950,961,964,967,978,984,1000,1007,1013,1017,1024,1031,1038],[16,606,607,608,611],{},"这学期期末复习的时候，学校里负责上 JavaScript 的老师给我们提出了一个问题。下面这段代码中，",[27,609,610],{},"a.u2()"," 在 ES Module 下执行会抛出 TypeError 的异常，在 CommonJS 下运行则会输出 undefined，而 B 这个类的 u2 函数则能够在对象实例化以后正常运行。",[169,613,617],{"className":614,"code":615,"language":616,"meta":174,"style":174},"language-javascript shiki shiki-themes one-light one-dark-pro","const a = {\n    x: 3,\n    u1: function () {\n        console.log(this.x)\n    },\n    u2: () => {\n        console.log(this.x)\n    }\n}\n\nclass b {\n    x = 3\n\n    u1 = function () {\n        console.log(this.x)\n    }\n\n    u2 = () => {\n        console.log(this.x)\n    }\n}\n\na.u1()\n// 3\na.u2()\n// undefined\n\nnew b().u1()\n// 3\nnew b().u2()\n// 3\n","javascript",[27,618,619,635,650,663,688,693,708,726,731,735,739,750,761,766,777,796,801,806,819,838,843,848,853,866,872,884,890,895,910,915,928],{"__ignoreMap":174},[178,620,621,625,629,632],{"class":180,"line":181},[178,622,624],{"class":623},"sLKXg","const",[178,626,628],{"class":627},"sNmU0"," a",[178,630,631],{"class":518}," =",[178,633,634],{"class":307}," {\n",[178,636,637,640,644,647],{"class":180,"line":224},[178,638,639],{"class":288},"    x",[178,641,643],{"class":642},"st7oF",":",[178,645,646],{"class":191}," 3",[178,648,649],{"class":307},",\n",[178,651,652,655,657,660],{"class":180,"line":285},[178,653,654],{"class":184},"    u1",[178,656,643],{"class":642},[178,658,659],{"class":623}," function",[178,661,662],{"class":307}," () {\n",[178,664,665,669,672,675,678,681,683,686],{"class":180,"line":299},[178,666,668],{"class":667},"s7GmK","        console",[178,670,671],{"class":307},".",[178,673,674],{"class":184},"log",[178,676,677],{"class":307},"(",[178,679,680],{"class":577},"this",[178,682,671],{"class":307},[178,684,685],{"class":288},"x",[178,687,316],{"class":307},[178,689,690],{"class":180,"line":319},[178,691,692],{"class":307},"    },\n",[178,694,695,698,700,703,706],{"class":180,"line":324},[178,696,697],{"class":184},"    u2",[178,699,643],{"class":642},[178,701,702],{"class":307}," () ",[178,704,705],{"class":623},"=>",[178,707,634],{"class":307},[178,709,710,712,714,716,718,720,722,724],{"class":180,"line":335},[178,711,668],{"class":667},[178,713,671],{"class":307},[178,715,674],{"class":184},[178,717,677],{"class":307},[178,719,680],{"class":577},[178,721,671],{"class":307},[178,723,685],{"class":288},[178,725,316],{"class":307},[178,727,728],{"class":180,"line":346},[178,729,730],{"class":307},"    }\n",[178,732,733],{"class":180,"line":351},[178,734,419],{"class":307},[178,736,737],{"class":180,"line":382},[178,738,282],{"emptyLinePlaceholder":281},[178,740,741,744,748],{"class":180,"line":422},[178,742,743],{"class":623},"class",[178,745,747],{"class":746},"sC09Y"," b",[178,749,634],{"class":307},[178,751,753,756,758],{"class":180,"line":752},12,[178,754,639],{"class":755},"sz0mV",[178,757,631],{"class":518},[178,759,760],{"class":191}," 3\n",[178,762,764],{"class":180,"line":763},13,[178,765,282],{"emptyLinePlaceholder":281},[178,767,769,771,773,775],{"class":180,"line":768},14,[178,770,654],{"class":184},[178,772,631],{"class":518},[178,774,659],{"class":623},[178,776,662],{"class":307},[178,778,780,782,784,786,788,790,792,794],{"class":180,"line":779},15,[178,781,668],{"class":667},[178,783,671],{"class":307},[178,785,674],{"class":184},[178,787,677],{"class":307},[178,789,680],{"class":577},[178,791,671],{"class":307},[178,793,685],{"class":288},[178,795,316],{"class":307},[178,797,799],{"class":180,"line":798},16,[178,800,730],{"class":307},[178,802,804],{"class":180,"line":803},17,[178,805,282],{"emptyLinePlaceholder":281},[178,807,809,811,813,815,817],{"class":180,"line":808},18,[178,810,697],{"class":184},[178,812,631],{"class":518},[178,814,702],{"class":307},[178,816,705],{"class":623},[178,818,634],{"class":307},[178,820,822,824,826,828,830,832,834,836],{"class":180,"line":821},19,[178,823,668],{"class":667},[178,825,671],{"class":307},[178,827,674],{"class":184},[178,829,677],{"class":307},[178,831,680],{"class":577},[178,833,671],{"class":307},[178,835,685],{"class":288},[178,837,316],{"class":307},[178,839,841],{"class":180,"line":840},20,[178,842,730],{"class":307},[178,844,846],{"class":180,"line":845},21,[178,847,419],{"class":307},[178,849,851],{"class":180,"line":850},22,[178,852,282],{"emptyLinePlaceholder":281},[178,854,856,858,860,863],{"class":180,"line":855},23,[178,857,32],{"class":667},[178,859,671],{"class":307},[178,861,862],{"class":184},"u1",[178,864,865],{"class":307},"()\n",[178,867,869],{"class":180,"line":868},24,[178,870,871],{"class":275},"// 3\n",[178,873,875,877,879,882],{"class":180,"line":874},25,[178,876,32],{"class":667},[178,878,671],{"class":307},[178,880,881],{"class":184},"u2",[178,883,865],{"class":307},[178,885,887],{"class":180,"line":886},26,[178,888,889],{"class":275},"// undefined\n",[178,891,893],{"class":180,"line":892},27,[178,894,282],{"emptyLinePlaceholder":281},[178,896,898,901,903,906,908],{"class":180,"line":897},28,[178,899,900],{"class":623},"new",[178,902,747],{"class":184},[178,904,905],{"class":307},"().",[178,907,862],{"class":184},[178,909,865],{"class":307},[178,911,913],{"class":180,"line":912},29,[178,914,871],{"class":275},[178,916,918,920,922,924,926],{"class":180,"line":917},30,[178,919,900],{"class":623},[178,921,747],{"class":184},[178,923,905],{"class":307},[178,925,881],{"class":184},[178,927,865],{"class":307},[178,929,931],{"class":180,"line":930},31,[178,932,871],{"class":275},[16,934,935],{},"这个问题涉及到 JavaScript 中箭头函数的作用域以及 this 指向。",[16,937,938,939,942],{},"**在 JS 中使用 function 关键字定义的普通函数中，this 指针遵循一个规则：谁调用指向谁。**即 ",[27,940,941],{},"obj.func()"," 这种调用情况下，func 方法内部的this指向obj；如果没有调用者，则严格模式下 this 为 undefined，非严格模式下 this 指向window(浏览器)或者global(node环境)。",[16,944,945,946],{},"而箭头函数比较特殊，",[947,948,949],"strong",{},"箭头函数的 this 在定义时就被绑定，绑定的是定义时所在作用域中的 this。",[16,951,952,953,956,957,960],{},"在老师给的示例代码中，第一行定义了 a 这个对象字面量，而",[947,954,955],{},"定义对象字面量不会创建新的作用域","，因此 a 中定义的 u2 的 this 指向的是全局对象。因此在 Es Module 默认启用 strict mode 的情况下，全局对象的 this 指向 undefined，进而导致 a 的 u2 内 this 也指向 undefined，this.x 就抛了 TypeError；而在 ",[947,958,959],{},"CommonJS 未启用 strict mode 的情况下，全局对象的 this 指向全局对象","，因而 u2 内的 this 也指向全局对象，因此 this 存在，this.x 就不会抛 TypeError，只会报 undefined。",[16,962,963],{},"而 B 类在对象初始化阶段拥有一个新的作用域，因此箭头函数的 this 能够正确指向 B 被实例化出来的对象，因此也就能够正确读取到 this.x 的值。",[16,965,966],{},"理论上来说，我们可以给全局对象也赋一个不一样的 x 值，这样 a.u2() 就能够读取到全局对象中的 x 值，验证我们的结论。",[16,968,969,970,973,974,977],{},"在浏览器中，可以在代码的头部加一行 ",[27,971,972],{},"var x = 10"," 或者 ",[27,975,976],{},"window.x = 10","，可以看到a.u2() 顺利的输出了 10，验证了我的结论。",[16,979,980],{},[256,981],{"alt":982,"src":983},"浏览器控制台调试","https://static.031130.xyz/uploads/2024/08/12/65a2e1d093b78.webp",[16,985,986,987,973,989,992,993,995,996,999],{},"但在 Node.js 中，直接使用 ",[27,988,972],{},[27,990,991],{},"global.x = 10"," 并不能达到我们想要的效果。因为Node.js 中的每个 CommonJS 模块都有其自己的模块作用域，即模块的顶层作用域不是全局作用域。在模块内部，",[27,994,680],{}," 关键字不是指向 ",[27,997,998],{},"global"," 对象，而是指向模块的导出对象。这是为了确保模块内部的作用域隔离和模块的封装性。",[16,1001,1002,1003,1006],{},"那么我们可以通过为模块的导出对象添加一个 x 属性来验证我们的结论，我们可以使用 ",[27,1004,1005],{},"exports.x = 10"," 来为模块的顶层作用域添加一个值为 10 的 x 属性。",[16,1008,1009],{},[256,1010],{"alt":1011,"src":1012},"nodejs 环境运行","https://static.031130.xyz/uploads/2024/08/12/65a2e379ba89e.webp",[1014,1015,1016],"h2",{"id":1016},"参考文章",[16,1018,1019],{},[32,1020,1023],{"href":1021,"rel":1022},"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Functions/Arrow_functions",[36],"箭头函数表达式 - JavaScript | MDN",[16,1025,1026],{},[32,1027,1030],{"href":1028,"rel":1029},"https://segmentfault.com/q/1010000022948115",[36],"ES6箭头函数作用域的问题",[16,1032,1033],{},[32,1034,1037],{"href":1035,"rel":1036},"https://www.zhihu.com/tardis/zm/art/57204184",[36],"ES6箭头函数的this指向详解",[220,1039,1040],{},"html pre.shiki code .sLKXg, html code.shiki .sLKXg{--shiki-default:#A626A4;--shiki-dark:#C678DD}html pre.shiki code .sNmU0, html code.shiki .sNmU0{--shiki-default:#986801;--shiki-dark:#E5C07B}html pre.shiki code .s_Sar, html code.shiki .s_Sar{--shiki-default:#0184BC;--shiki-dark:#56B6C2}html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html pre.shiki code .sJa8x, html code.shiki .sJa8x{--shiki-default:#E45649;--shiki-dark:#E06C75}html pre.shiki code .st7oF, html code.shiki .st7oF{--shiki-default:#0184BC;--shiki-dark:#ABB2BF}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .s7GmK, html code.shiki .s7GmK{--shiki-default:#383A42;--shiki-dark:#E5C07B}html pre.shiki code .s2QsP, html code.shiki .s2QsP{--shiki-default:#E45649;--shiki-dark:#E5C07B}html pre.shiki code .sC09Y, html code.shiki .sC09Y{--shiki-default:#C18401;--shiki-dark:#E5C07B}html pre.shiki code .sz0mV, html code.shiki .sz0mV{--shiki-default:#383A42;--shiki-dark:#E06C75}html pre.shiki code .sW2Sy, html code.shiki .sW2Sy{--shiki-default:#A0A1A7;--shiki-default-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}",{"title":174,"searchDepth":224,"depth":224,"links":1042},[1043],{"id":1016,"depth":224,"text":1016},{"title":1045,"date":1046,"path":1047,"tags":1048,"body":1054},"结合 Vue.js 与 php 完成的 web 期末大作业，讲讲前后端分离站点开发与部署中可能遇到的 CORS 跨域问题","2024-01-10 23:55:36","/2024/01/10/cors-when-using-splited-frontend-and-backend",[1049,1050,1051,1052,1053],"Vue.js","PHP","Network","Notes","Web",{"type":13,"value":1055,"toc":1520},[1056,1064,1067,1071,1075,1082,1087,1098,1111,1114,1134,1137,1150,1159,1175,1181,1186,1189,1205,1208,1211,1224,1227,1230,1233,1236,1243,1286,1289,1491,1498,1505,1508,1517],[16,1057,1058,1059,1063],{},"在",[32,1060,1062],{"href":1061},"/2023/12/27/php-and-vuejs-project-deploy-on-caddy/","上一篇博客","中，我讲到了 web 期末大作业的上云部署。整个项目是使用 Vue.js 作为前端，php 作为后端，mysql 作为数据库实现的。",[16,1065,1066],{},"在使用 Vue.js 开发前端界面时，我选择了使用 vite 脚手架帮助开发，这意味着我的作品将使用前后端分离的架构实现。因此在开发部署过程中均遇到了跨域的问题，故写下这篇博客记录下解决方案。",[1014,1068,1070],{"id":1069},"基于后端返回对应-http-响应头的解决方案","基于后端返回对应 http 响应头的解决方案",[1072,1073,1074],"h3",{"id":1074},"开发阶段",[16,1076,1077,1078,1081],{},"在我完成前后端的开发，并且经过 Apifox 的 mock 测试后，第一次在浏览器尝试前后端对接，遇到了 ",[27,1079,1080],{},"CORS Missing Allow Origin"," 的报错。",[16,1083,1084],{},[256,1085],{"alt":1080,"src":1086},"https://static.031130.xyz/uploads/2024/08/12/659ec607c69af.webp",[16,1088,1089,1090,1093,1094,1097],{},"vite 启动的 dev 开发服务器使用的域是 ",[27,1091,1092],{},"http://localhost:5173"," ，而 php 后端我指定的是 ",[27,1095,1096],{},"http://127.0.0.1:8080"," ，前后端并不运行在一个域下，前端使用 Axios(AJAX) 向后端发送请求获取资源输入 CORS 跨域资源共享的范畴。",[16,1099,1100,1101,1106,1107,1110],{},"关于跨域资源共享 CORS 的相关内容，",[32,1102,1105],{"href":1103,"rel":1104},"https://www.ruanyifeng.com/blog/2016/04/cors.html",[36],"阮一峰老师在 2016 年就已经在他的博客中有过解释","，看了下也是全网中文内容中解释得比较通俗易懂的，因此本文在这方面不过多做解释。错误的提示信息是 Missing Allow Origin，结合阮一峰老师的博文，我们应该在后端向前端发送的 http 响应头中添加 ",[27,1108,1109],{},"Access-Control-Allow-Origin"," 这一字段。",[16,1112,1113],{},"在一般的前后端分离项目（不涉及 cookie 等 Credentials 属性）中，我们可以将这一字段设置为 * 通配符，默认允许所有的域向自己发起跨域资源请求。php 可以通过下面这行代码很方便地进行设置:",[169,1115,1119],{"className":1116,"code":1117,"language":1118,"meta":174,"style":174},"language-php shiki shiki-themes one-light one-dark-pro","header('Access-Control-Allow-Origin: *');\n","php",[27,1120,1121],{"__ignoreMap":174},[178,1122,1123,1126,1128,1131],{"class":180,"line":181},[178,1124,1125],{"class":518},"header",[178,1127,677],{"class":307},[178,1129,1130],{"class":187},"'Access-Control-Allow-Origin: *'",[178,1132,1133],{"class":307},");\n",[16,1135,1136],{},"但在用户的注册登录方面，我使用了 session 作为用户的登录凭据。阮一峰老师关于 CORS 的博文中有这样一句话:",[1138,1139,1140],"blockquote",{},[16,1141,1142,1143,1145,1146,1149],{},"需要注意的是，如果要发送Cookie，",[27,1144,1109],{},"就不能设为星号，必须指定明确的、与请求网页一致的域名。同时，Cookie依然遵循同源政策，只有用服务器域名设置的Cookie才会上传，其他域名的Cookie并不会上传，且（跨源）原网页代码中的",[27,1147,1148],{},"document.cookie","也无法读取服务器域名下的Cookie。",[16,1151,1152,1153,1155,1156,1158],{},"因此，我们必须明确指定 ",[27,1154,1109],{}," 字段为前端所使用的域，写上 ",[27,1157,1092],{}," 才行。",[169,1160,1162],{"className":1116,"code":1161,"language":1118,"meta":174,"style":174},"header('Access-Control-Allow-Origin: http://localhost:5173');\n",[27,1163,1164],{"__ignoreMap":174},[178,1165,1166,1168,1170,1173],{"class":180,"line":181},[178,1167,1125],{"class":518},[178,1169,677],{"class":307},[178,1171,1172],{"class":187},"'Access-Control-Allow-Origin: http://localhost:5173'",[178,1174,1133],{"class":307},[16,1176,1177,1178],{},"再次刷新网页，获得了新的错误 ",[27,1179,1180],{},"CORS Missing Allow Credentials",[16,1182,1183],{},[256,1184],{"alt":1180,"src":1185},"https://static.031130.xyz/uploads/2024/08/12/659ec95acc0bc.webp",[16,1187,1188],{},"这个问题处理起来也简单",[169,1190,1192],{"className":1116,"code":1191,"language":1118,"meta":174,"style":174},"header('Access-Control-Allow-Credentials: true');\n",[27,1193,1194],{"__ignoreMap":174},[178,1195,1196,1198,1200,1203],{"class":180,"line":181},[178,1197,1125],{"class":518},[178,1199,677],{"class":307},[178,1201,1202],{"class":187},"'Access-Control-Allow-Credentials: true'",[178,1204,1133],{"class":307},[16,1206,1207],{},"再次运行网页，跨域问题成功解决。",[1072,1209,1210],{"id":1210},"部署阶段",[16,1212,1213,1214,1216,1217,1220,1221,1223],{},"顺着这个思路进行下去，我们在部署阶段解决跨域问题需要做的事情很简单。提前将前端部署起来，将前端的域写到后端返回给前端的 http 相应头中即可。需要注意的是，",[27,1215,1109],{}," 字段仅允许填写一个值，如果需要同时允许来自多个不同域的跨域资源共享，后端部分需要根据前端发来的请求头中的 ",[27,1218,1219],{},"Origin"," 字段相应地设置响应头中的 ",[27,1222,1109],{}," 。当然，nginx 等先进的 static server 也支持劫持 http 请求，添加相关的 Access-Control 语句，也可以在这一层解决这个问题。",[1014,1225,1226],{"id":1226},"直接规避跨域的方案",[16,1228,1229],{},"上面通过后端返回带有 Access-Control 语句相应头的解决方案确实可以解决问题，却显得不够优雅。开发和部署阶段都要手动的去指定前端的域来允许跨域资源共享，这一点过于麻烦了，因此引出了下面的解决方案。",[1072,1231,1074],{"id":1232},"开发阶段-1",[16,1234,1235],{},"在 vite（或者其他同类开发服务器）的帮助下，我们可以使用前端的开发服务器去反向代理后端服务，也就是让前端的请求打到前端服务器上，由前端服务器去返回后端服务器返回的结果。",[16,1237,1238,1239,1242],{},"在 ",[27,1240,1241],{},"vite.config.ts"," 配置文件下，我将原本的",[169,1244,1248],{"className":1245,"code":1246,"language":1247,"meta":174,"style":174},"language-typescript shiki shiki-themes one-light one-dark-pro","export default defineConfig({\n  plugins: [vue()],\n})\n","typescript",[27,1249,1250,1265,1281],{"__ignoreMap":174},[178,1251,1252,1255,1259,1262],{"class":180,"line":181},[178,1253,1254],{"class":623},"export",[178,1256,1258],{"class":1257},"sq3v1"," default",[178,1260,1261],{"class":184}," defineConfig",[178,1263,1264],{"class":307},"({\n",[178,1266,1267,1270,1272,1275,1278],{"class":180,"line":224},[178,1268,1269],{"class":288},"  plugins",[178,1271,643],{"class":642},[178,1273,1274],{"class":307}," [",[178,1276,1277],{"class":184},"vue",[178,1279,1280],{"class":307},"()],\n",[178,1282,1283],{"class":180,"line":285},[178,1284,1285],{"class":307},"})\n",[16,1287,1288],{},"换成了",[169,1290,1292],{"className":1245,"code":1291,"language":1247,"meta":174,"style":174},"export default () => {\n  process.env = { ...process.env, ...loadEnv(process.cwd(),'') };\n\n  const config = {\n    plugins: [vue()],\n    server: {\n      proxy: {\n        '/api': {\n          target: http://127.0.0.1:8080,\n          changeOrigin: true,\n          secure: false,\n        }\n      }\n    }\n  }\n  return defineConfig(config)\n};\n",[27,1293,1294,1306,1357,1361,1373,1386,1395,1404,1413,1428,1441,1453,1458,1463,1467,1472,1486],{"__ignoreMap":174},[178,1295,1296,1298,1300,1302,1304],{"class":180,"line":181},[178,1297,1254],{"class":623},[178,1299,1258],{"class":1257},[178,1301,702],{"class":307},[178,1303,705],{"class":623},[178,1305,634],{"class":307},[178,1307,1308,1311,1313,1316,1318,1321,1324,1327,1329,1331,1334,1336,1339,1341,1343,1345,1348,1351,1354],{"class":180,"line":224},[178,1309,1310],{"class":667},"  process",[178,1312,671],{"class":307},[178,1314,1315],{"class":288},"env",[178,1317,631],{"class":518},[178,1319,1320],{"class":307}," { ",[178,1322,1323],{"class":642},"...",[178,1325,1326],{"class":667},"process",[178,1328,671],{"class":307},[178,1330,1315],{"class":288},[178,1332,1333],{"class":307},", ",[178,1335,1323],{"class":642},[178,1337,1338],{"class":184},"loadEnv",[178,1340,677],{"class":307},[178,1342,1326],{"class":667},[178,1344,671],{"class":307},[178,1346,1347],{"class":184},"cwd",[178,1349,1350],{"class":307},"(),",[178,1352,1353],{"class":187},"''",[178,1355,1356],{"class":307},") };\n",[178,1358,1359],{"class":180,"line":285},[178,1360,282],{"emptyLinePlaceholder":281},[178,1362,1363,1366,1369,1371],{"class":180,"line":299},[178,1364,1365],{"class":623},"  const",[178,1367,1368],{"class":627}," config",[178,1370,631],{"class":518},[178,1372,634],{"class":307},[178,1374,1375,1378,1380,1382,1384],{"class":180,"line":319},[178,1376,1377],{"class":288},"    plugins",[178,1379,643],{"class":642},[178,1381,1274],{"class":307},[178,1383,1277],{"class":184},[178,1385,1280],{"class":307},[178,1387,1388,1391,1393],{"class":180,"line":324},[178,1389,1390],{"class":288},"    server",[178,1392,643],{"class":642},[178,1394,634],{"class":307},[178,1396,1397,1400,1402],{"class":180,"line":335},[178,1398,1399],{"class":288},"      proxy",[178,1401,643],{"class":642},[178,1403,634],{"class":307},[178,1405,1406,1409,1411],{"class":180,"line":346},[178,1407,1408],{"class":187},"        '/api'",[178,1410,643],{"class":642},[178,1412,634],{"class":307},[178,1414,1415,1418,1420,1423,1425],{"class":180,"line":351},[178,1416,1417],{"class":288},"          target",[178,1419,643],{"class":642},[178,1421,1422],{"class":288}," http",[178,1424,643],{"class":307},[178,1426,1427],{"class":275},"//127.0.0.1:8080,\n",[178,1429,1430,1433,1436,1439],{"class":180,"line":382},[178,1431,1432],{"class":288},"          changeOrigin",[178,1434,1435],{"class":307},": ",[178,1437,1438],{"class":191},"true",[178,1440,649],{"class":307},[178,1442,1443,1446,1448,1451],{"class":180,"line":422},[178,1444,1445],{"class":288},"          secure",[178,1447,643],{"class":642},[178,1449,1450],{"class":191}," false",[178,1452,649],{"class":307},[178,1454,1455],{"class":180,"line":752},[178,1456,1457],{"class":307},"        }\n",[178,1459,1460],{"class":180,"line":763},[178,1461,1462],{"class":307},"      }\n",[178,1464,1465],{"class":180,"line":768},[178,1466,730],{"class":307},[178,1468,1469],{"class":180,"line":779},[178,1470,1471],{"class":307},"  }\n",[178,1473,1474,1477,1479,1481,1484],{"class":180,"line":798},[178,1475,1476],{"class":623},"  return",[178,1478,1261],{"class":184},[178,1480,677],{"class":307},[178,1482,1483],{"class":288},"config",[178,1485,316],{"class":307},[178,1487,1488],{"class":180,"line":803},[178,1489,1490],{"class":307},"};\n",[16,1492,1493,1494,1497],{},"同时将 Axios create 时的 ",[27,1495,1496],{},"baseURL"," 参数去除。",[16,1499,1500,1501,1504],{},"这样一套组合拳下来，将所有打向 ",[27,1502,1503],{},"/api*"," 的请求和响应通过前端的开发服务器作为中介做了中转，让浏览器以为并没有跨域（事实上也没有跨域），从而解决了相关的问题。",[1072,1506,1210],{"id":1507},"部署阶段-1",[16,1509,1510,1511,1516],{},"在开发阶段，我们通过 vite 的开发服务器做反向代理规避了跨域请求，但在部署阶段就用不了了。由于 vite 服务器的性能太弱，一般情况下我们是不会在生产环境中使用 vite 作为正式的服务器的，而是使用 vite build 出网站的静态网页资源，通过 nginx 等 static server 去向用户提供前端网页。而通过 vite build 出来的静态网页资源本身是不具备反向代理的能力的，这意味着没法在前端侧规避跨域问题。此时，我们应该配置 nginx 规避跨域问题。我一向不怎么使用 nginx，使用的是它的平替品 caddy，因此 nginx 的配置文件需要大家自行搜索，",[32,1512,1515],{"href":1513,"rel":1514},"https://zhul.in/2023/12/27/php-and-vuejs-project-deploy-on-caddy/#Caddy-%E9%85%8D%E7%BD%AE",[36],"我的 caddyfile 在上一篇博客中已经给出","，仅供参考。",[220,1518,1519],{},"html pre.shiki code .sLKXg, html code.shiki .sLKXg{--shiki-default:#A626A4;--shiki-dark:#C678DD}html pre.shiki code .sq3v1, html code.shiki .sq3v1{--shiki-default:#E45649;--shiki-dark:#C678DD}html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html pre.shiki code .sJa8x, html code.shiki .sJa8x{--shiki-default:#E45649;--shiki-dark:#E06C75}html pre.shiki code .st7oF, html code.shiki .st7oF{--shiki-default:#0184BC;--shiki-dark:#ABB2BF}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html pre.shiki code .s7GmK, html code.shiki .s7GmK{--shiki-default:#383A42;--shiki-dark:#E5C07B}html pre.shiki code .s_Sar, html code.shiki .s_Sar{--shiki-default:#0184BC;--shiki-dark:#56B6C2}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html pre.shiki code .sNmU0, html code.shiki .sNmU0{--shiki-default:#986801;--shiki-dark:#E5C07B}html pre.shiki code .sW2Sy, html code.shiki .sW2Sy{--shiki-default:#A0A1A7;--shiki-default-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}",{"title":174,"searchDepth":224,"depth":224,"links":1521},[1522,1526],{"id":1069,"depth":224,"text":1070,"children":1523},[1524,1525],{"id":1074,"depth":285,"text":1074},{"id":1210,"depth":285,"text":1210},{"id":1226,"depth":224,"text":1226,"children":1527},[1528,1529],{"id":1232,"depth":285,"text":1074},{"id":1507,"depth":285,"text":1210},{"title":1531,"date":1532,"path":1533,"tags":1534,"body":1537},"vuejs、php、caddy 与 docker —— web 期末大作业上云部署","2023-12-27 22:09:00","/2023/12/27/php-and-vuejs-project-deploy-on-caddy",[1050,1535,1049,1051,1536,1053],"Caddy","Docker",{"type":13,"value":1538,"toc":1846},[1539,1556,1559,1568,1571,1603,1611,1628,1635,1698,1713,1717,1720,1727,1733,1736,1739,1746,1772,1775,1778,1789,1793,1796,1802,1825,1829,1836,1843],[1138,1540,1541,1544,1550,1553],{},[16,1542,1543],{},"这学期修了一门叫《用HTML5 和 PHP编写JavaScript，jQuery 和 AJAX脚本》的 web 课（对，听起来很奇怪的名字）。期末大作业是写一个影评系统，前端允许使用框架，后端仅允许使用 php，具体的作业要求如下",[16,1545,1546],{},[256,1547],{"alt":1548,"src":1549},"作业要求","https://static.031130.xyz/uploads/2024/08/12/658c4c3128ae4.webp",[16,1551,1552],{},"（源码会在验收结束以后开源）",[16,1554,1555],{},"大作业写了得要有三个礼拜，工作时长加起来得有 30 个小时，想着验收之前上线一段时间积累一些评论数据，验收的时候也会更加顺利一些，于是就开始尝试在服务器上部署。部署的过程还是比较复杂的，所以写下这篇博客记录一下。",[1014,1557,1558],{"id":1558},"后端部分",[16,1560,1561,1562,1567],{},"早前有",[32,1563,1566],{"href":1564,"rel":1565},"https://zhul.in/2021/10/21/picuploader-on-archlinux-with-caddy/",[36],"《PicUploader使用系列（一）——在Archlinux上使用Caddy部署PicUploader》","的经验，便觉得使用 Caddy + php-fpm 部署的方式多少有点麻烦了，这次便尝试了使用 Docker 部署、Caddy 反代的方式。",[16,1569,1570],{},"Dockerfile 如下:",[169,1572,1576],{"className":1573,"code":1574,"language":1575,"meta":174,"style":174},"language-dockerfile shiki shiki-themes one-light one-dark-pro","FROM php:8-apache\nRUN docker-php-ext-install mysqli\nRUN a2enmod rewrite\nCOPY . /var/www/html\nEXPOSE 80\n","dockerfile",[27,1577,1578,1583,1588,1593,1598],{"__ignoreMap":174},[178,1579,1580],{"class":180,"line":181},[178,1581,1582],{},"FROM php:8-apache\n",[178,1584,1585],{"class":180,"line":224},[178,1586,1587],{},"RUN docker-php-ext-install mysqli\n",[178,1589,1590],{"class":180,"line":285},[178,1591,1592],{},"RUN a2enmod rewrite\n",[178,1594,1595],{"class":180,"line":299},[178,1596,1597],{},"COPY . /var/www/html\n",[178,1599,1600],{"class":180,"line":319},[178,1601,1602],{},"EXPOSE 80\n",[16,1604,1605,1606,1610],{},"在后端的根目录下有一个 .htaccess 文件，将所有的请求都交给 index.php 来处理，这样就可以根据我的",[32,1607,1062],{"href":1608,"rel":1609},"https://zhul.in/2023/12/12/php-simple-rest-api/",[36],"中所提到的方式去构建不使用任何 php 框架实现的简易 router 效果",[169,1612,1616],{"className":1613,"code":1614,"language":1615,"meta":174,"style":174},"language-htaccess shiki shiki-themes one-light one-dark-pro","RewriteEngine On\nRewriteRule ^(.*) index.php [QSA,L]\n","htaccess",[27,1617,1618,1623],{"__ignoreMap":174},[178,1619,1620],{"class":180,"line":181},[178,1621,1622],{},"RewriteEngine On\n",[178,1624,1625],{"class":180,"line":224},[178,1626,1627],{},"RewriteRule ^(.*) index.php [QSA,L]\n",[16,1629,1630,1631,1634],{},"构建 Docker 镜像时使用 ",[27,1632,1633],{},"docker build . -t mrs-php"," 命令，运行 docker 容器时使用命令",[169,1636,1638],{"className":171,"code":1637,"language":173,"meta":174,"style":174},"docker run -d \\\n    -p 7788:80 \\\n    --name mrs-php \\\n    -v /path/to/uploads:/var/www/html/uploads \\\n    --restart unless-stopped \\\n    mrs-php\n",[27,1639,1640,1653,1663,1673,1683,1693],{"__ignoreMap":174},[178,1641,1642,1645,1648,1650],{"class":180,"line":181},[178,1643,1644],{"class":184},"docker",[178,1646,1647],{"class":187}," run",[178,1649,204],{"class":191},[178,1651,1652],{"class":518}," \\\n",[178,1654,1655,1658,1661],{"class":180,"line":224},[178,1656,1657],{"class":191},"    -p",[178,1659,1660],{"class":187}," 7788:80",[178,1662,1652],{"class":518},[178,1664,1665,1668,1671],{"class":180,"line":285},[178,1666,1667],{"class":191},"    --name",[178,1669,1670],{"class":187}," mrs-php",[178,1672,1652],{"class":518},[178,1674,1675,1678,1681],{"class":180,"line":299},[178,1676,1677],{"class":191},"    -v",[178,1679,1680],{"class":187}," /path/to/uploads:/var/www/html/uploads",[178,1682,1652],{"class":518},[178,1684,1685,1688,1691],{"class":180,"line":319},[178,1686,1687],{"class":191},"    --restart",[178,1689,1690],{"class":187}," unless-stopped",[178,1692,1652],{"class":518},[178,1694,1695],{"class":180,"line":324},[178,1696,1697],{"class":187},"    mrs-php\n",[16,1699,1700,1701,1704,1705,1708,1709,1712],{},"这样，后端就在 7788 端口上开起来了，后续 Caddy 只要将打到 ",[27,1702,1703],{},"/api/*"," 和 ",[27,1706,1707],{},"/uploads/*"," 的请求转发到 7788 端口即可，避免了使用 php-fpm 时需要的配置。",[27,1710,1711],{},"uploads"," 目录是用来存放图片的，我将这个路径挂在在宿主机的目录下，方便备份导入等操作。",[1072,1714,1716],{"id":1715},"mysql-连接时的小插曲","mysql 连接时的小插曲",[16,1718,1719],{},"需要注意的是，在 Docker 容器中运行的 php 如果想要访问宿主机上的 mysql，需要注意修改 mysql 服务器的 ip 地址，并允许 mysql 接收来自非本机的请求。",[16,1721,1722,1723,1726],{},"在宿主机中运行 ",[27,1724,1725],{},"ip -br a"," 命令可以看到 docker 所采用的虚拟网卡的 ip 地址",[169,1728,1731],{"className":1729,"code":1730,"language":468},[466],"docker0          UP             172.17.0.1/16 fe80::42:eff:febf:b26c/64\n",[27,1732,1730],{"__ignoreMap":174},[16,1734,1735],{},"我这边得到的 ip 地址是 172.17.0.1，所以在 php 那边访问的数据库 ip 地址就应该是 172.17.0.1，而非 localhost 或者 127.0.0.1",[16,1737,1738],{},"此外，需要允许宿主机的 mysql 接收来自 Docker 容器的请求",[16,1740,1741,1742,1745],{},"使用 ",[27,1743,1744],{},"docker network inspect bridge"," 命令可以查到 docker 容器的 ip 地址，接着需要去允许来自这个 ip 的请求。建议去网上自行搜索，因为 mysql 语句我自己也不熟悉。我使用的 mysql 版本是 8，语句似乎和以前的版本不兼容？我使用下面三个命令轮着输就好了（有时候报错，有时侯又不报错），有大佬懂的话评论区讲讲。",[169,1747,1751],{"className":1748,"code":1749,"language":1750,"meta":174,"style":174},"language-mysql shiki shiki-themes one-light one-dark-pro","use mysql;\nGRANT ALL ON *.* TO 'root'@'%';\nupdate user set host='%' where user='root';\nGRANT ALL ON *.* TO 'root'@'%';\n","mysql",[27,1752,1753,1758,1763,1768],{"__ignoreMap":174},[178,1754,1755],{"class":180,"line":181},[178,1756,1757],{},"use mysql;\n",[178,1759,1760],{"class":180,"line":224},[178,1761,1762],{},"GRANT ALL ON *.* TO 'root'@'%';\n",[178,1764,1765],{"class":180,"line":285},[178,1766,1767],{},"update user set host='%' where user='root';\n",[178,1769,1770],{"class":180,"line":299},[178,1771,1762],{},[1014,1773,1774],{"id":1774},"前端部分",[16,1776,1777],{},"前端部分部署起来没什么难度",[16,1779,1780,1781,1784,1785,1788],{},"我使用的是 vite 开发的 vuejs 项目，直接使用 ",[27,1782,1783],{},"pnpm build"," 构建出静态文件，然后放入了 ",[27,1786,1787],{},"/var/www/mrs"," 目录，这部分没什么可说的",[1014,1790,1792],{"id":1791},"caddy-配置","Caddy 配置",[16,1794,1795],{},"Caddy 配置如下",[169,1797,1800],{"className":1798,"code":1799,"language":468},[466],"example.com {\n    handle /api/* {\n        reverse_proxy localhost:7788\n    }\n\n    handle /uploads/* {\n        reverse_proxy localhost:7788\n    }\n\n    handle /* {\n        root * /var/www/mrs\n        file_server\n        try_files {path} /\n    }\n}\n",[27,1801,1799],{"__ignoreMap":174},[16,1803,1804,1805,1704,1807,1809,1810,1813,1814,1817,1818,1821,1822,1824],{},"将打到 ",[27,1806,1703],{},[27,1808,1707],{}," 都交给 7788 端口的后端进行处理，前端部分要使用 ",[27,1811,1812],{},"try_files"," 将请求都指向 ",[27,1815,1816],{},"/"," 或 ",[27,1819,1820],{},"/index.html"," 交由 vue-router 处理，否则 caddy 就找不到对应的文件了。这里我尝试过使用 route 关键词代替 handle，但 ",[27,1823,1812],{}," 的功能没有生效，这两者的区别官方文档中有提到，但我没看懂，等我以后看看有没有机会去折腾了。",[1014,1826,1828],{"id":1827},"参考","参考:",[16,1830,1831],{},[32,1832,1835],{"href":1833,"rel":1834},"https://homeboyc.cn/blog/%E4%BD%BF%E7%94%A8caddy%E9%85%8D%E7%BD%AE%E5%90%8C%E4%B8%80%E5%9F%9F%E5%90%8D%E4%B8%8B%E7%9A%84%E5%89%8D%E5%90%8E%E5%88%86%E7%A6%BB/",[36],"使用Caddy配置同一域名下的前后分离",[16,1837,1838],{},[32,1839,1842],{"href":1840,"rel":1841},"https://blog.lyh543.cn/notes/linux/caddy.html",[36],"Caddy 2",[220,1844,1845],{},"html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html pre.shiki code .s_Sar, html code.shiki .s_Sar{--shiki-default:#0184BC;--shiki-dark:#56B6C2}",{"title":174,"searchDepth":224,"depth":224,"links":1847},[1848,1851,1852,1853],{"id":1558,"depth":224,"text":1558,"children":1849},[1850],{"id":1715,"depth":285,"text":1716},{"id":1774,"depth":224,"text":1774},{"id":1791,"depth":224,"text":1792},{"id":1827,"depth":224,"text":1828},{"title":1855,"date":1856,"path":1857,"tags":1858,"body":1860},"【翻译】使用 PHP 构建简单的 REST API","2023-12-12 13:07:32","/2023/12/12/php-simple-rest-api",[1859,1050],"Translation",{"type":13,"value":1861,"toc":4911},[1862,1871,1874,1883,1892,1895,1898,1911,1914,1917,1920,1928,1931,1935,1938,1941,1944,1947,1953,1956,1962,1965,1968,1976,1979,1982,1985,1988,1991,2020,2023,2026,2032,2035,2043,2047,2050,2053,2056,2139,2142,2145,2152,2155,2158,2161,2179,2182,2217,2220,2223,2241,2244,2623,2626,2633,2636,2639,2642,2680,2687,2690,2693,2710,2713,2734,2737,2740,2743,2811,2816,2819,3010,3016,3022,3027,3030,3231,3238,3243,3246,3525,3530,3533,3733,3738,3741,3744,3747,4789,4792,4795,4864,4867,4876,4879,4882,4885,4888,4891,4908],[1138,1863,1864],{},[16,1865,1866,1867],{},"我这学期有一门偏向前端的 WEB 课程，期末大作业要求使用 PHP 作为后端语言实现一个简单的影评系统，应该是不允许使用框架，使用中文关键字在搜索引擎上搜了一阵子似乎没有可供参考的案例，后来就找到了这篇博客，当中的许多观点与我不谋而合，因此我将这篇博客翻译成中文，原文戳这里: ",[32,1868,1869],{"href":1869,"rel":1870},"https://amirkamizi.com/blog/php-simple-rest-api",[36],[1014,1872,1873],{"id":1873},"介绍",[16,1875,1876,1877,1882],{},"上周 @rapid_api 发了一个非常好的关于",[32,1878,1881],{"href":1879,"rel":1880},"https://twitter.com/Rapid_API/status/1486423046424563714",[36],"使用 nodejs 和 express 创建 REST API"," 的教程帖子。我想要帮助你使用 PHP 开发同样简单的 REST API。",[16,1884,1885,1886,1891],{},"首先，如果你不了解 REST API，请务必查看这个 ",[32,1887,1890],{"href":1888,"rel":1889},"https://twitter.com/Rapid_API/status/1452932706967461890",[36],"Twitter 帖子","。",[1014,1893,1894],{"id":1894},"目标",[16,1896,1897],{},"在我们开始之前，我想提一句，当我写这篇帖子的时候，我想确保：",[1899,1900,1901,1905,1908],"ol",{},[1902,1903,1904],"li",{},"我使用单纯的 PHP，不使用框架",[1902,1906,1907],{},"我使用最简单的函数和结构体以便所有人都可以理解并跟上",[1902,1909,1910],{},"我将主体部分分开",[16,1912,1913],{},"现在让我们开始吧",[1014,1915,1916],{"id":1916},"准备",[16,1918,1919],{},"在我本地的机器上，我创建了一个叫 api 的文件夹于 xampp > htdocs，在里面有一个叫 index.php 的文件",[16,1921,1922,1923],{},"如果你没有 xampp 或者你不知道如何把 php 跑起来，请务必查看",[32,1924,1927],{"href":1925,"rel":1926},"https://amirkamizi.com/blog/introduction-to-php",[36],"这篇文章",[16,1929,1930],{},"现在，如果你尝试访问 localhost/api，你将得到一个空的响应，因为 index.php 文件是空的",[1014,1932,1934],{"id":1933},"优雅的-url","优雅的 URL",[16,1936,1937],{},"项目中，我们需要处理的第一件事是 url",[16,1939,1940],{},"REST API 的关键特性之一是每一个 url 负责一个资源和一个操作",[1072,1942,1943],{"id":1943},"问题",[16,1945,1946],{},"这时候如果我创建一个 users.php，我需要访问",[169,1948,1951],{"className":1949,"code":1950,"language":468},[466],"localhost/api/users.php\n",[27,1952,1950],{"__ignoreMap":174},[16,1954,1955],{},"我需要为每一个 user id 创建一个新的文件",[169,1957,1960],{"className":1958,"code":1959,"language":468},[466],"localhost/api/users/1.php\nlocalhost/api/users/2.php\n",[27,1961,1959],{"__ignoreMap":174},[16,1963,1964],{},"以此类推。",[16,1966,1967],{},"这种方案有两个问题",[1899,1969,1970,1973],{},[1902,1971,1972],{},"为每个用户创建一个新文件是非常无聊和耗时的",[1902,1974,1975],{},"路由不优雅，每个路径后面都带有 .php",[1072,1977,1978],{"id":1978},"解决方案",[16,1980,1981],{},"让我们解决这个问题。",[16,1983,1984],{},"正如我所提到的，我不想使用任何框架，并且我想使用最简单的、最让人能够理解的方案",[16,1986,1987],{},"让我们看看如何解决这个问题",[16,1989,1990],{},"在 api 文件夹下创建一个叫 .htaccess 的文件，并且将下面的文本复制进去",[169,1992,1994],{"className":1613,"code":1993,"language":1615,"meta":174,"style":174},"RewriteEngine On\nRewriteBase /api\nRewriteCond %{REQUEST_FILENAME} !-d\nRewriteCond %{REQUEST_FILENAME} !-f\nRewriteRule ^(.+)$ index.php [QSA,L]\n",[27,1995,1996,2000,2005,2010,2015],{"__ignoreMap":174},[178,1997,1998],{"class":180,"line":181},[178,1999,1622],{},[178,2001,2002],{"class":180,"line":224},[178,2003,2004],{},"RewriteBase /api\n",[178,2006,2007],{"class":180,"line":285},[178,2008,2009],{},"RewriteCond %{REQUEST_FILENAME} !-d\n",[178,2011,2012],{"class":180,"line":299},[178,2013,2014],{},"RewriteCond %{REQUEST_FILENAME} !-f\n",[178,2016,2017],{"class":180,"line":319},[178,2018,2019],{},"RewriteRule ^(.+)$ index.php [QSA,L]\n",[16,2021,2022],{},"我们告诉服务器，将所有指向 /api 的请求都转发到 index.php 文件",[16,2024,2025],{},"现在，所有的 url 都指向 index.php 了，比如下面的 url 都是指向 index.php 的",[169,2027,2030],{"className":2028,"code":2029,"language":468},[466],"api/users\napi/users/10\napi/users/5\n",[27,2031,2029],{"__ignoreMap":174},[16,2033,2034],{},"现在我们同时解决了这两个问题",[1899,2036,2037,2040],{},[1902,2038,2039],{},"所有的 url 都被一个文件处理",[1902,2041,2042],{},"url 都很优雅，结尾处没有 .php",[1014,2044,2046],{"id":2045},"uri","URI",[16,2048,2049],{},"但如何知道用户请求的是哪个 uri 呢？",[16,2051,2052],{},"很简单，使用 $_SERVER 超全局变量",[16,2054,2055],{},"让我们来看一些例子",[169,2057,2059],{"className":1116,"code":2058,"language":1118,"meta":174,"style":174},"// url api/users\necho $_SERVER['REQUEST_URI'];\n// /api/users\n\n// url api/users/5\necho $_SERVER['REQUEST_URI'];\n// /api/users/5\n\n// url api\necho $_SERVER['REQUEST_URI'];\n// /api\n",[27,2060,2061,2066,2082,2087,2091,2096,2108,2113,2117,2122,2134],{"__ignoreMap":174},[178,2062,2063],{"class":180,"line":181},[178,2064,2065],{"class":275},"// url api/users\n",[178,2067,2068,2070,2073,2076,2079],{"class":180,"line":224},[178,2069,519],{"class":518},[178,2071,2072],{"class":288}," $_SERVER",[178,2074,2075],{"class":307},"[",[178,2077,2078],{"class":187},"'REQUEST_URI'",[178,2080,2081],{"class":307},"];\n",[178,2083,2084],{"class":180,"line":285},[178,2085,2086],{"class":275},"// /api/users\n",[178,2088,2089],{"class":180,"line":299},[178,2090,282],{"emptyLinePlaceholder":281},[178,2092,2093],{"class":180,"line":319},[178,2094,2095],{"class":275},"// url api/users/5\n",[178,2097,2098,2100,2102,2104,2106],{"class":180,"line":324},[178,2099,519],{"class":518},[178,2101,2072],{"class":288},[178,2103,2075],{"class":307},[178,2105,2078],{"class":187},[178,2107,2081],{"class":307},[178,2109,2110],{"class":180,"line":335},[178,2111,2112],{"class":275},"// /api/users/5\n",[178,2114,2115],{"class":180,"line":346},[178,2116,282],{"emptyLinePlaceholder":281},[178,2118,2119],{"class":180,"line":351},[178,2120,2121],{"class":275},"// url api\n",[178,2123,2124,2126,2128,2130,2132],{"class":180,"line":382},[178,2125,519],{"class":518},[178,2127,2072],{"class":288},[178,2129,2075],{"class":307},[178,2131,2078],{"class":187},[178,2133,2081],{"class":307},[178,2135,2136],{"class":180,"line":422},[178,2137,2138],{"class":275},"// /api\n",[16,2140,2141],{},"看见了吗？这就是我们所需要的",[16,2143,2144],{},"现在，使用一个简单的 if 或者 switch 语句，我们就可以处理不同的路径了",[16,2146,2147,2148,1891],{},"如果你从来没有用过这些语句，去读",[32,2149,1927],{"href":2150,"rel":2151},"https://amirkamizi.com/blog/php-conditionals",[36],[1014,2153,2154],{"id":2154},"请求方法",[16,2156,2157],{},"接下来，我们需要从请求中获取请求的方法，以查看它是GET、POST、PUT、PATCH还是DELETE。",[16,2159,2160],{},"你可以从 $_SERVER 超全局数组中获取这个信息。",[169,2162,2164],{"className":1116,"code":2163,"language":1118,"meta":174,"style":174},"$_SERVER['REQUEST_METHOD']\n",[27,2165,2166],{"__ignoreMap":174},[178,2167,2168,2171,2173,2176],{"class":180,"line":181},[178,2169,2170],{"class":288},"$_SERVER",[178,2172,2075],{"class":307},[178,2174,2175],{"class":187},"'REQUEST_METHOD'",[178,2177,2178],{"class":307},"]\n",[16,2180,2181],{},"让我们将这两个值存储在变量中：",[169,2183,2185],{"className":1116,"code":2184,"language":1118,"meta":174,"style":174},"$uri = $_SERVER['REQUEST_URI'];\n$method = $_SERVER['REQUEST_METHOD'];\n",[27,2186,2187,2202],{"__ignoreMap":174},[178,2188,2189,2192,2194,2196,2198,2200],{"class":180,"line":181},[178,2190,2191],{"class":288},"$uri",[178,2193,631],{"class":292},[178,2195,2072],{"class":288},[178,2197,2075],{"class":307},[178,2199,2078],{"class":187},[178,2201,2081],{"class":307},[178,2203,2204,2207,2209,2211,2213,2215],{"class":180,"line":224},[178,2205,2206],{"class":288},"$method",[178,2208,631],{"class":292},[178,2210,2072],{"class":288},[178,2212,2075],{"class":307},[178,2214,2175],{"class":187},[178,2216,2081],{"class":307},[16,2218,2219],{},"我们可以在一个简单的 switch 语句中使用这两个变量来处理不同的请求。",[16,2221,2222],{},"我们需要判断以下请求",[2224,2225,2226,2229,2232,2235,2238],"ul",{},[1902,2227,2228],{},"api/users 的 GET 请求",[1902,2230,2231],{},"api/users/{id} 的 GET 请求",[1902,2233,2234],{},"api/users 的 POST 请求",[1902,2236,2237],{},"api/users/{id} 的 PUT 请求",[1902,2239,2240],{},"api/users/{id} 的 DELETE 请求",[16,2242,2243],{},"让我们编写针对上述请求的 switch 语句",[169,2245,2247],{"className":1116,"code":2246,"language":1118,"meta":174,"style":174},"switch ($method | $uri) {\n   /*\n   * Path: GET /api/users\n   * Task: show all the users\n   */\n   case ($method == 'GET' && $uri == '/api/users'):\n       break;\n   /*\n   * Path: GET /api/users/{id}\n   * Task: get one user\n   */\n   case ($method == 'GET' && preg_match('/\\/api\\/users\\/[1-9]/', $uri)):\n       break;\n   /*\n   * Path: POST /api/users\n   * Task: store one user\n   */\n   case ($method == 'POST' && $uri == '/api/users'):\n       break;\n   /*\n   * Path: PUT /api/users/{id}\n   * Task: update one user\n   */\n   case ($method == 'PUT' && preg_match('/\\/api\\/users\\/[1-9]/', $uri)):\n       break;\n   /*\n   * Path: DELETE /api/users/{id}\n   * Task: delete one user\n   */\n   case ($method == 'DELETE' && preg_match('/\\/api\\/users\\/[1-9]/', $uri)):\n       break;\n   /*\n   * Path: ?\n   * Task: this path doesn't match any of the defined paths\n   *      throw an error\n   */\n   default:\n       break;\n}\n",[27,2248,2249,2268,2273,2278,2283,2288,2316,2324,2328,2333,2338,2342,2389,2395,2399,2404,2409,2413,2436,2442,2446,2451,2456,2460,2499,2505,2509,2514,2519,2523,2568,2574,2579,2585,2591,2597,2602,2611,2618],{"__ignoreMap":174},[178,2250,2251,2254,2257,2259,2262,2265],{"class":180,"line":181},[178,2252,2253],{"class":623},"switch",[178,2255,2256],{"class":307}," (",[178,2258,2206],{"class":288},[178,2260,2261],{"class":292}," |",[178,2263,2264],{"class":288}," $uri",[178,2266,2267],{"class":307},") {\n",[178,2269,2270],{"class":180,"line":224},[178,2271,2272],{"class":275},"   /*\n",[178,2274,2275],{"class":180,"line":285},[178,2276,2277],{"class":275},"   * Path: GET /api/users\n",[178,2279,2280],{"class":180,"line":299},[178,2281,2282],{"class":275},"   * Task: show all the users\n",[178,2284,2285],{"class":180,"line":319},[178,2286,2287],{"class":275},"   */\n",[178,2289,2290,2293,2295,2297,2300,2303,2306,2308,2310,2313],{"class":180,"line":324},[178,2291,2292],{"class":623},"   case",[178,2294,2256],{"class":307},[178,2296,2206],{"class":288},[178,2298,2299],{"class":292}," ==",[178,2301,2302],{"class":187}," 'GET'",[178,2304,2305],{"class":292}," &&",[178,2307,2264],{"class":288},[178,2309,2299],{"class":292},[178,2311,2312],{"class":187}," '/api/users'",[178,2314,2315],{"class":307},"):\n",[178,2317,2318,2321],{"class":180,"line":335},[178,2319,2320],{"class":623},"       break",[178,2322,2323],{"class":307},";\n",[178,2325,2326],{"class":180,"line":346},[178,2327,2272],{"class":275},[178,2329,2330],{"class":180,"line":351},[178,2331,2332],{"class":275},"   * Path: GET /api/users/{id}\n",[178,2334,2335],{"class":180,"line":382},[178,2336,2337],{"class":275},"   * Task: get one user\n",[178,2339,2340],{"class":180,"line":422},[178,2341,2287],{"class":275},[178,2343,2344,2346,2348,2350,2352,2354,2356,2359,2361,2365,2368,2371,2373,2376,2378,2381,2384,2386],{"class":180,"line":752},[178,2345,2292],{"class":623},[178,2347,2256],{"class":307},[178,2349,2206],{"class":288},[178,2351,2299],{"class":292},[178,2353,2302],{"class":187},[178,2355,2305],{"class":292},[178,2357,2358],{"class":518}," preg_match",[178,2360,677],{"class":307},[178,2362,2364],{"class":2363},"sDaw7","'/",[178,2366,2367],{"class":518},"\\/",[178,2369,2370],{"class":2363},"api",[178,2372,2367],{"class":518},[178,2374,2375],{"class":2363},"users",[178,2377,2367],{"class":518},[178,2379,2380],{"class":2363},"[1-9]/'",[178,2382,2383],{"class":307},",",[178,2385,2264],{"class":288},[178,2387,2388],{"class":307},")):\n",[178,2390,2391,2393],{"class":180,"line":763},[178,2392,2320],{"class":623},[178,2394,2323],{"class":307},[178,2396,2397],{"class":180,"line":768},[178,2398,2272],{"class":275},[178,2400,2401],{"class":180,"line":779},[178,2402,2403],{"class":275},"   * Path: POST /api/users\n",[178,2405,2406],{"class":180,"line":798},[178,2407,2408],{"class":275},"   * Task: store one user\n",[178,2410,2411],{"class":180,"line":803},[178,2412,2287],{"class":275},[178,2414,2415,2417,2419,2421,2423,2426,2428,2430,2432,2434],{"class":180,"line":808},[178,2416,2292],{"class":623},[178,2418,2256],{"class":307},[178,2420,2206],{"class":288},[178,2422,2299],{"class":292},[178,2424,2425],{"class":187}," 'POST'",[178,2427,2305],{"class":292},[178,2429,2264],{"class":288},[178,2431,2299],{"class":292},[178,2433,2312],{"class":187},[178,2435,2315],{"class":307},[178,2437,2438,2440],{"class":180,"line":821},[178,2439,2320],{"class":623},[178,2441,2323],{"class":307},[178,2443,2444],{"class":180,"line":840},[178,2445,2272],{"class":275},[178,2447,2448],{"class":180,"line":845},[178,2449,2450],{"class":275},"   * Path: PUT /api/users/{id}\n",[178,2452,2453],{"class":180,"line":850},[178,2454,2455],{"class":275},"   * Task: update one user\n",[178,2457,2458],{"class":180,"line":855},[178,2459,2287],{"class":275},[178,2461,2462,2464,2466,2468,2470,2473,2475,2477,2479,2481,2483,2485,2487,2489,2491,2493,2495,2497],{"class":180,"line":868},[178,2463,2292],{"class":623},[178,2465,2256],{"class":307},[178,2467,2206],{"class":288},[178,2469,2299],{"class":292},[178,2471,2472],{"class":187}," 'PUT'",[178,2474,2305],{"class":292},[178,2476,2358],{"class":518},[178,2478,677],{"class":307},[178,2480,2364],{"class":2363},[178,2482,2367],{"class":518},[178,2484,2370],{"class":2363},[178,2486,2367],{"class":518},[178,2488,2375],{"class":2363},[178,2490,2367],{"class":518},[178,2492,2380],{"class":2363},[178,2494,2383],{"class":307},[178,2496,2264],{"class":288},[178,2498,2388],{"class":307},[178,2500,2501,2503],{"class":180,"line":874},[178,2502,2320],{"class":623},[178,2504,2323],{"class":307},[178,2506,2507],{"class":180,"line":886},[178,2508,2272],{"class":275},[178,2510,2511],{"class":180,"line":892},[178,2512,2513],{"class":275},"   * Path: DELETE /api/users/{id}\n",[178,2515,2516],{"class":180,"line":897},[178,2517,2518],{"class":275},"   * Task: delete one user\n",[178,2520,2521],{"class":180,"line":912},[178,2522,2287],{"class":275},[178,2524,2525,2527,2529,2531,2533,2536,2539,2542,2544,2546,2548,2550,2552,2554,2556,2558,2560,2562,2564,2566],{"class":180,"line":917},[178,2526,2292],{"class":623},[178,2528,2256],{"class":307},[178,2530,2206],{"class":288},[178,2532,2299],{"class":292},[178,2534,2535],{"class":187}," '",[178,2537,2538],{"class":623},"DELETE",[178,2540,2541],{"class":187},"'",[178,2543,2305],{"class":292},[178,2545,2358],{"class":518},[178,2547,677],{"class":307},[178,2549,2364],{"class":2363},[178,2551,2367],{"class":518},[178,2553,2370],{"class":2363},[178,2555,2367],{"class":518},[178,2557,2375],{"class":2363},[178,2559,2367],{"class":518},[178,2561,2380],{"class":2363},[178,2563,2383],{"class":307},[178,2565,2264],{"class":288},[178,2567,2388],{"class":307},[178,2569,2570,2572],{"class":180,"line":930},[178,2571,2320],{"class":623},[178,2573,2323],{"class":307},[178,2575,2577],{"class":180,"line":2576},32,[178,2578,2272],{"class":275},[178,2580,2582],{"class":180,"line":2581},33,[178,2583,2584],{"class":275},"   * Path: ?\n",[178,2586,2588],{"class":180,"line":2587},34,[178,2589,2590],{"class":275},"   * Task: this path doesn't match any of the defined paths\n",[178,2592,2594],{"class":180,"line":2593},35,[178,2595,2596],{"class":275},"   *      throw an error\n",[178,2598,2600],{"class":180,"line":2599},36,[178,2601,2287],{"class":275},[178,2603,2605,2608],{"class":180,"line":2604},37,[178,2606,2607],{"class":623},"   default",[178,2609,2610],{"class":307},":\n",[178,2612,2614,2616],{"class":180,"line":2613},38,[178,2615,2320],{"class":623},[178,2617,2323],{"class":307},[178,2619,2621],{"class":180,"line":2620},39,[178,2622,419],{"class":307},[16,2624,2625],{},"当我们想要在 switch 语句中使用两个变量，我们可以使用 | 符号",[16,2627,2628,2629,1891],{},"如果你想知道 preg_match 是如何工作的，看",[32,2630,1927],{"href":2631,"rel":2632},"https://amirkamizi.com/blog/php-regular-expressions",[36],[1014,2634,2635],{"id":2635},"数据库",[16,2637,2638],{},"现在是说说数据。储存数据的最好方法是将数据储存在数据库中。但在这篇教程中，我不想使用数据库。因此，我们使用一个 json 文件当作数据库来保证数据的持久性。",[16,2640,2641],{},"我的 json 文件看起来长成这个样子：",[169,2643,2647],{"className":2644,"code":2645,"language":2646,"meta":174,"style":174},"language-json shiki shiki-themes one-light one-dark-pro","{\n   \"1\": \"Pratham\",\n   \"2\": \"Amir\"\n}\n","json",[27,2648,2649,2654,2666,2676],{"__ignoreMap":174},[178,2650,2651],{"class":180,"line":181},[178,2652,2653],{"class":307},"{\n",[178,2655,2656,2659,2661,2664],{"class":180,"line":224},[178,2657,2658],{"class":288},"   \"1\"",[178,2660,1435],{"class":307},[178,2662,2663],{"class":187},"\"Pratham\"",[178,2665,649],{"class":307},[178,2667,2668,2671,2673],{"class":180,"line":285},[178,2669,2670],{"class":288},"   \"2\"",[178,2672,1435],{"class":307},[178,2674,2675],{"class":187},"\"Amir\"\n",[178,2677,2678],{"class":180,"line":299},[178,2679,419],{"class":307},[16,2681,2682,2683],{},"如果你想知道如何使用 json，看",[32,2684,1927],{"href":2685,"rel":2686},"https://amirkamizi.com/blog/php-xml-and-json",[36],[16,2688,2689],{},"我加载 json 数据并将其转换为数组，然后在 php 使用他们。如果我想要更改数据，我将数组转换回 json 并将其重新写入文件。",[16,2691,2692],{},"要将整个文件作为一个字符串读取并存储在变量中，我使用：",[169,2694,2696],{"className":1116,"code":2695,"language":1118,"meta":174,"style":174},"file_get_contents($jsonFile);\n",[27,2697,2698],{"__ignoreMap":174},[178,2699,2700,2703,2705,2708],{"class":180,"line":181},[178,2701,2702],{"class":518},"file_get_contents",[178,2704,677],{"class":307},[178,2706,2707],{"class":288},"$jsonFile",[178,2709,1133],{"class":307},[16,2711,2712],{},"而要将json写入文件，我使用：",[169,2714,2716],{"className":1116,"code":2715,"language":1118,"meta":174,"style":174},"file_put_contents($jsonFile, $data);\n",[27,2717,2718],{"__ignoreMap":174},[178,2719,2720,2723,2725,2727,2729,2732],{"class":180,"line":181},[178,2721,2722],{"class":518},"file_put_contents",[178,2724,677],{"class":307},[178,2726,2707],{"class":288},[178,2728,2383],{"class":307},[178,2730,2731],{"class":288}," $data",[178,2733,1133],{"class":307},[16,2735,2736],{},"好了，现在我们的数据库处理好了，让我们开始处理所有的路径。",[16,2738,2739],{},"我使用 Postman 发送请求并查看响应。",[1014,2741,2742],{"id":2742},"获取所有用户",[169,2744,2746],{"className":1116,"code":2745,"language":1118,"meta":174,"style":174},"case ($method == 'GET' && $uri == '/api/users'):\n   header('Content-Type: application/json');\n   echo json_encode($users, JSON_PRETTY_PRINT);\n   break;\n",[27,2747,2748,2771,2783,2804],{"__ignoreMap":174},[178,2749,2750,2753,2755,2757,2759,2761,2763,2765,2767,2769],{"class":180,"line":181},[178,2751,2752],{"class":623},"case",[178,2754,2256],{"class":307},[178,2756,2206],{"class":288},[178,2758,2299],{"class":292},[178,2760,2302],{"class":187},[178,2762,2305],{"class":292},[178,2764,2264],{"class":288},[178,2766,2299],{"class":292},[178,2768,2312],{"class":187},[178,2770,2315],{"class":307},[178,2772,2773,2776,2778,2781],{"class":180,"line":224},[178,2774,2775],{"class":518},"   header",[178,2777,677],{"class":307},[178,2779,2780],{"class":187},"'Content-Type: application/json'",[178,2782,1133],{"class":307},[178,2784,2785,2788,2791,2793,2796,2798,2802],{"class":180,"line":285},[178,2786,2787],{"class":518},"   echo",[178,2789,2790],{"class":518}," json_encode",[178,2792,677],{"class":307},[178,2794,2795],{"class":288},"$users",[178,2797,2383],{"class":307},[178,2799,2801],{"class":2800},"sxymB"," JSON_PRETTY_PRINT",[178,2803,1133],{"class":307},[178,2805,2806,2809],{"class":180,"line":299},[178,2807,2808],{"class":623},"   break",[178,2810,2323],{"class":307},[16,2812,2813],{},[256,2814],{"alt":174,"src":2815},"https://static.031130.xyz/uploads/2024/08/12/6577fcdf64a96.webp",[1014,2817,2818],{"id":2818},"获取单个用户",[169,2820,2822],{"className":1116,"code":2821,"language":1118,"meta":174,"style":174},"case ($method == 'GET' && preg_match('/\\/api\\/users\\/[1-9]/', $uri)):\n   header('Content-Type: application/json');\n   // get the id\n   $id = basename($uri);\n   if (!array_key_exists($id, $users)) {\n       http_response_code(404);\n       echo json_encode(['error' => 'user does not exist']);\n       break;\n   }\n   $responseData = [$id => $users[$id]];\n   echo json_encode($responseData, JSON_PRETTY_PRINT);\n   break;\n",[27,2823,2824,2862,2872,2877,2893,2919,2931,2953,2959,2964,2987,3004],{"__ignoreMap":174},[178,2825,2826,2828,2830,2832,2834,2836,2838,2840,2842,2844,2846,2848,2850,2852,2854,2856,2858,2860],{"class":180,"line":181},[178,2827,2752],{"class":623},[178,2829,2256],{"class":307},[178,2831,2206],{"class":288},[178,2833,2299],{"class":292},[178,2835,2302],{"class":187},[178,2837,2305],{"class":292},[178,2839,2358],{"class":518},[178,2841,677],{"class":307},[178,2843,2364],{"class":2363},[178,2845,2367],{"class":518},[178,2847,2370],{"class":2363},[178,2849,2367],{"class":518},[178,2851,2375],{"class":2363},[178,2853,2367],{"class":518},[178,2855,2380],{"class":2363},[178,2857,2383],{"class":307},[178,2859,2264],{"class":288},[178,2861,2388],{"class":307},[178,2863,2864,2866,2868,2870],{"class":180,"line":224},[178,2865,2775],{"class":518},[178,2867,677],{"class":307},[178,2869,2780],{"class":187},[178,2871,1133],{"class":307},[178,2873,2874],{"class":180,"line":285},[178,2875,2876],{"class":275},"   // get the id\n",[178,2878,2879,2882,2884,2887,2889,2891],{"class":180,"line":299},[178,2880,2881],{"class":288},"   $id",[178,2883,631],{"class":292},[178,2885,2886],{"class":518}," basename",[178,2888,677],{"class":307},[178,2890,2191],{"class":288},[178,2892,1133],{"class":307},[178,2894,2895,2898,2900,2903,2906,2908,2911,2913,2916],{"class":180,"line":319},[178,2896,2897],{"class":623},"   if",[178,2899,2256],{"class":307},[178,2901,2902],{"class":292},"!",[178,2904,2905],{"class":518},"array_key_exists",[178,2907,677],{"class":307},[178,2909,2910],{"class":288},"$id",[178,2912,2383],{"class":307},[178,2914,2915],{"class":288}," $users",[178,2917,2918],{"class":307},")) {\n",[178,2920,2921,2924,2926,2929],{"class":180,"line":324},[178,2922,2923],{"class":518},"       http_response_code",[178,2925,677],{"class":307},[178,2927,2928],{"class":191},"404",[178,2930,1133],{"class":307},[178,2932,2933,2936,2938,2941,2944,2947,2950],{"class":180,"line":335},[178,2934,2935],{"class":518},"       echo",[178,2937,2790],{"class":518},[178,2939,2940],{"class":307},"([",[178,2942,2943],{"class":187},"'error'",[178,2945,2946],{"class":307}," =>",[178,2948,2949],{"class":187}," 'user does not exist'",[178,2951,2952],{"class":307},"]);\n",[178,2954,2955,2957],{"class":180,"line":346},[178,2956,2320],{"class":623},[178,2958,2323],{"class":307},[178,2960,2961],{"class":180,"line":351},[178,2962,2963],{"class":307},"   }\n",[178,2965,2966,2969,2971,2973,2975,2978,2980,2982,2984],{"class":180,"line":382},[178,2967,2968],{"class":288},"   $responseData",[178,2970,631],{"class":292},[178,2972,1274],{"class":307},[178,2974,2910],{"class":288},[178,2976,2977],{"class":307}," => ",[178,2979,2795],{"class":288},[178,2981,2075],{"class":307},[178,2983,2910],{"class":288},[178,2985,2986],{"class":307},"]];\n",[178,2988,2989,2991,2993,2995,2998,3000,3002],{"class":180,"line":422},[178,2990,2787],{"class":518},[178,2992,2790],{"class":518},[178,2994,677],{"class":307},[178,2996,2997],{"class":288},"$responseData",[178,2999,2383],{"class":307},[178,3001,2801],{"class":2800},[178,3003,1133],{"class":307},[178,3005,3006,3008],{"class":180,"line":752},[178,3007,2808],{"class":623},[178,3009,2323],{"class":307},[16,3011,3012,3015],{},[947,3013,3014],{},"basename","($uri) 会将 uri 的最后一部分给我。比如一个 api/users/10 这样的路径，它会返回 10.",[16,3017,3018,3019,3021],{},"然后我使用 ",[947,3020,2905],{}," 检查是否存在一个 id 为 10 的用户",[16,3023,3024],{},[256,3025],{"alt":174,"src":3026},"https://static.031130.xyz/uploads/2024/08/12/6577fd77c3d06.webp",[1014,3028,3029],{"id":3029},"添加一个新用户",[169,3031,3033],{"className":1116,"code":3032,"language":1118,"meta":174,"style":174},"case ($method == 'POST' && $uri == '/api/users'):\n   header('Content-Type: application/json');\n   $requestBody = json_decode(file_get_contents('php://input'), true);\n   $name = $requestBody['name'];\n   if (empty($name)) {\n       http_response_code(404);\n       echo json_encode(['error' => 'Please add name of the user']);\n   }\n   $users[] = $name;\n   $data = json_encode($users, JSON_PRETTY_PRINT);\n   file_put_contents($jsonFile, $data);\n   echo json_encode(['message' => 'user added successfully']);\n   break;\n",[27,3034,3035,3057,3067,3094,3111,3127,3137,3154,3158,3173,3192,3207,3225],{"__ignoreMap":174},[178,3036,3037,3039,3041,3043,3045,3047,3049,3051,3053,3055],{"class":180,"line":181},[178,3038,2752],{"class":623},[178,3040,2256],{"class":307},[178,3042,2206],{"class":288},[178,3044,2299],{"class":292},[178,3046,2425],{"class":187},[178,3048,2305],{"class":292},[178,3050,2264],{"class":288},[178,3052,2299],{"class":292},[178,3054,2312],{"class":187},[178,3056,2315],{"class":307},[178,3058,3059,3061,3063,3065],{"class":180,"line":224},[178,3060,2775],{"class":518},[178,3062,677],{"class":307},[178,3064,2780],{"class":187},[178,3066,1133],{"class":307},[178,3068,3069,3072,3074,3077,3079,3081,3083,3086,3089,3092],{"class":180,"line":285},[178,3070,3071],{"class":288},"   $requestBody",[178,3073,631],{"class":292},[178,3075,3076],{"class":518}," json_decode",[178,3078,677],{"class":307},[178,3080,2702],{"class":518},[178,3082,677],{"class":307},[178,3084,3085],{"class":187},"'php://input'",[178,3087,3088],{"class":307},"),",[178,3090,3091],{"class":191}," true",[178,3093,1133],{"class":307},[178,3095,3096,3099,3101,3104,3106,3109],{"class":180,"line":299},[178,3097,3098],{"class":288},"   $name",[178,3100,631],{"class":292},[178,3102,3103],{"class":288}," $requestBody",[178,3105,2075],{"class":307},[178,3107,3108],{"class":187},"'name'",[178,3110,2081],{"class":307},[178,3112,3113,3115,3117,3120,3122,3125],{"class":180,"line":319},[178,3114,2897],{"class":623},[178,3116,2256],{"class":307},[178,3118,3119],{"class":518},"empty",[178,3121,677],{"class":307},[178,3123,3124],{"class":288},"$name",[178,3126,2918],{"class":307},[178,3128,3129,3131,3133,3135],{"class":180,"line":324},[178,3130,2923],{"class":518},[178,3132,677],{"class":307},[178,3134,2928],{"class":191},[178,3136,1133],{"class":307},[178,3138,3139,3141,3143,3145,3147,3149,3152],{"class":180,"line":335},[178,3140,2935],{"class":518},[178,3142,2790],{"class":518},[178,3144,2940],{"class":307},[178,3146,2943],{"class":187},[178,3148,2946],{"class":307},[178,3150,3151],{"class":187}," 'Please add name of the user'",[178,3153,2952],{"class":307},[178,3155,3156],{"class":180,"line":346},[178,3157,2963],{"class":307},[178,3159,3160,3163,3166,3168,3171],{"class":180,"line":351},[178,3161,3162],{"class":288},"   $users",[178,3164,3165],{"class":307},"[] ",[178,3167,293],{"class":292},[178,3169,3170],{"class":288}," $name",[178,3172,2323],{"class":307},[178,3174,3175,3178,3180,3182,3184,3186,3188,3190],{"class":180,"line":382},[178,3176,3177],{"class":288},"   $data",[178,3179,631],{"class":292},[178,3181,2790],{"class":518},[178,3183,677],{"class":307},[178,3185,2795],{"class":288},[178,3187,2383],{"class":307},[178,3189,2801],{"class":2800},[178,3191,1133],{"class":307},[178,3193,3194,3197,3199,3201,3203,3205],{"class":180,"line":422},[178,3195,3196],{"class":518},"   file_put_contents",[178,3198,677],{"class":307},[178,3200,2707],{"class":288},[178,3202,2383],{"class":307},[178,3204,2731],{"class":288},[178,3206,1133],{"class":307},[178,3208,3209,3211,3213,3215,3218,3220,3223],{"class":180,"line":752},[178,3210,2787],{"class":518},[178,3212,2790],{"class":518},[178,3214,2940],{"class":307},[178,3216,3217],{"class":187},"'message'",[178,3219,2946],{"class":307},[178,3221,3222],{"class":187}," 'user added successfully'",[178,3224,2952],{"class":307},[178,3226,3227,3229],{"class":180,"line":763},[178,3228,2808],{"class":623},[178,3230,2323],{"class":307},[16,3232,3233,3234,3237],{},"我使用 ",[947,3235,3236],{},"file_get_contents('php://input')"," 以获取请求的 body 部分。由于在这个例子中我使用的是 json，我将会解码 json 以便我可以获取到名字。",[16,3239,3240],{},[256,3241],{"alt":174,"src":3242},"https://static.031130.xyz/uploads/2024/08/12/6577fdca88f76.webp",[1014,3244,3245],{"id":3245},"更新一个用户",[169,3247,3249],{"className":1116,"code":3248,"language":1118,"meta":174,"style":174},"case ($method == 'PUT' && preg_match('/\\/api\\/users\\/[1-9]/', $uri)):\n   header('Content-Type: application/json');\n   // get the id\n   $id = basename($uri);\n   if (!array_key_exists($id, $users)) {\n       http_response_code(404);\n       echo json_encode(['error' => 'user does not exist']);\n       break;\n   }\n   $requestBody = json_decode(file_get_contents('php://input'), true);\n   $name = $requestBody['name'];\n   if (empty($name)) {\n       http_response_code(404);\n       echo json_encode(['error' => 'Please add name of the user']);\n   }\n   $users[$id] = $name;\n   $data = json_encode($users, JSON_PRETTY_PRINT);\n   file_put_contents($jsonFile, $data);\n   echo json_encode(['message' => 'user updated successfully']);\n   break;\n",[27,3250,3251,3289,3299,3303,3317,3337,3347,3363,3369,3373,3395,3409,3423,3433,3449,3453,3470,3488,3502,3519],{"__ignoreMap":174},[178,3252,3253,3255,3257,3259,3261,3263,3265,3267,3269,3271,3273,3275,3277,3279,3281,3283,3285,3287],{"class":180,"line":181},[178,3254,2752],{"class":623},[178,3256,2256],{"class":307},[178,3258,2206],{"class":288},[178,3260,2299],{"class":292},[178,3262,2472],{"class":187},[178,3264,2305],{"class":292},[178,3266,2358],{"class":518},[178,3268,677],{"class":307},[178,3270,2364],{"class":2363},[178,3272,2367],{"class":518},[178,3274,2370],{"class":2363},[178,3276,2367],{"class":518},[178,3278,2375],{"class":2363},[178,3280,2367],{"class":518},[178,3282,2380],{"class":2363},[178,3284,2383],{"class":307},[178,3286,2264],{"class":288},[178,3288,2388],{"class":307},[178,3290,3291,3293,3295,3297],{"class":180,"line":224},[178,3292,2775],{"class":518},[178,3294,677],{"class":307},[178,3296,2780],{"class":187},[178,3298,1133],{"class":307},[178,3300,3301],{"class":180,"line":285},[178,3302,2876],{"class":275},[178,3304,3305,3307,3309,3311,3313,3315],{"class":180,"line":299},[178,3306,2881],{"class":288},[178,3308,631],{"class":292},[178,3310,2886],{"class":518},[178,3312,677],{"class":307},[178,3314,2191],{"class":288},[178,3316,1133],{"class":307},[178,3318,3319,3321,3323,3325,3327,3329,3331,3333,3335],{"class":180,"line":319},[178,3320,2897],{"class":623},[178,3322,2256],{"class":307},[178,3324,2902],{"class":292},[178,3326,2905],{"class":518},[178,3328,677],{"class":307},[178,3330,2910],{"class":288},[178,3332,2383],{"class":307},[178,3334,2915],{"class":288},[178,3336,2918],{"class":307},[178,3338,3339,3341,3343,3345],{"class":180,"line":324},[178,3340,2923],{"class":518},[178,3342,677],{"class":307},[178,3344,2928],{"class":191},[178,3346,1133],{"class":307},[178,3348,3349,3351,3353,3355,3357,3359,3361],{"class":180,"line":335},[178,3350,2935],{"class":518},[178,3352,2790],{"class":518},[178,3354,2940],{"class":307},[178,3356,2943],{"class":187},[178,3358,2946],{"class":307},[178,3360,2949],{"class":187},[178,3362,2952],{"class":307},[178,3364,3365,3367],{"class":180,"line":346},[178,3366,2320],{"class":623},[178,3368,2323],{"class":307},[178,3370,3371],{"class":180,"line":351},[178,3372,2963],{"class":307},[178,3374,3375,3377,3379,3381,3383,3385,3387,3389,3391,3393],{"class":180,"line":382},[178,3376,3071],{"class":288},[178,3378,631],{"class":292},[178,3380,3076],{"class":518},[178,3382,677],{"class":307},[178,3384,2702],{"class":518},[178,3386,677],{"class":307},[178,3388,3085],{"class":187},[178,3390,3088],{"class":307},[178,3392,3091],{"class":191},[178,3394,1133],{"class":307},[178,3396,3397,3399,3401,3403,3405,3407],{"class":180,"line":422},[178,3398,3098],{"class":288},[178,3400,631],{"class":292},[178,3402,3103],{"class":288},[178,3404,2075],{"class":307},[178,3406,3108],{"class":187},[178,3408,2081],{"class":307},[178,3410,3411,3413,3415,3417,3419,3421],{"class":180,"line":752},[178,3412,2897],{"class":623},[178,3414,2256],{"class":307},[178,3416,3119],{"class":518},[178,3418,677],{"class":307},[178,3420,3124],{"class":288},[178,3422,2918],{"class":307},[178,3424,3425,3427,3429,3431],{"class":180,"line":763},[178,3426,2923],{"class":518},[178,3428,677],{"class":307},[178,3430,2928],{"class":191},[178,3432,1133],{"class":307},[178,3434,3435,3437,3439,3441,3443,3445,3447],{"class":180,"line":768},[178,3436,2935],{"class":518},[178,3438,2790],{"class":518},[178,3440,2940],{"class":307},[178,3442,2943],{"class":187},[178,3444,2946],{"class":307},[178,3446,3151],{"class":187},[178,3448,2952],{"class":307},[178,3450,3451],{"class":180,"line":779},[178,3452,2963],{"class":307},[178,3454,3455,3457,3459,3461,3464,3466,3468],{"class":180,"line":798},[178,3456,3162],{"class":288},[178,3458,2075],{"class":307},[178,3460,2910],{"class":288},[178,3462,3463],{"class":307},"] ",[178,3465,293],{"class":292},[178,3467,3170],{"class":288},[178,3469,2323],{"class":307},[178,3471,3472,3474,3476,3478,3480,3482,3484,3486],{"class":180,"line":803},[178,3473,3177],{"class":288},[178,3475,631],{"class":292},[178,3477,2790],{"class":518},[178,3479,677],{"class":307},[178,3481,2795],{"class":288},[178,3483,2383],{"class":307},[178,3485,2801],{"class":2800},[178,3487,1133],{"class":307},[178,3489,3490,3492,3494,3496,3498,3500],{"class":180,"line":808},[178,3491,3196],{"class":518},[178,3493,677],{"class":307},[178,3495,2707],{"class":288},[178,3497,2383],{"class":307},[178,3499,2731],{"class":288},[178,3501,1133],{"class":307},[178,3503,3504,3506,3508,3510,3512,3514,3517],{"class":180,"line":821},[178,3505,2787],{"class":518},[178,3507,2790],{"class":518},[178,3509,2940],{"class":307},[178,3511,3217],{"class":187},[178,3513,2946],{"class":307},[178,3515,3516],{"class":187}," 'user updated successfully'",[178,3518,2952],{"class":307},[178,3520,3521,3523],{"class":180,"line":840},[178,3522,2808],{"class":623},[178,3524,2323],{"class":307},[16,3526,3527],{},[256,3528],{"alt":174,"src":3529},"https://static.031130.xyz/uploads/2024/08/12/6577fdf646402.webp",[1014,3531,3532],{"id":3532},"删除一个用户",[169,3534,3536],{"className":1116,"code":3535,"language":1118,"meta":174,"style":174},"case ($method == 'DELETE' && preg_match('/\\/api\\/users\\/[1-9]/', $uri)):\n   header('Content-Type: application/json');\n   // get the id\n   $id = basename($uri);\n   if (empty($users[$id])) {\n       http_response_code(404);\n       echo json_encode(['error' => 'user does not exist']);\n       break;\n   }\n   unset($users[$id]);\n   $data = json_encode($users, JSON_PRETTY_PRINT);\n   file_put_contents($jsonFile, $data);\n   echo json_encode(['message' => 'user deleted successfully']);\n   break;\n",[27,3537,3538,3580,3590,3594,3608,3627,3637,3653,3659,3663,3678,3696,3710,3727],{"__ignoreMap":174},[178,3539,3540,3542,3544,3546,3548,3550,3552,3554,3556,3558,3560,3562,3564,3566,3568,3570,3572,3574,3576,3578],{"class":180,"line":181},[178,3541,2752],{"class":623},[178,3543,2256],{"class":307},[178,3545,2206],{"class":288},[178,3547,2299],{"class":292},[178,3549,2535],{"class":187},[178,3551,2538],{"class":623},[178,3553,2541],{"class":187},[178,3555,2305],{"class":292},[178,3557,2358],{"class":518},[178,3559,677],{"class":307},[178,3561,2364],{"class":2363},[178,3563,2367],{"class":518},[178,3565,2370],{"class":2363},[178,3567,2367],{"class":518},[178,3569,2375],{"class":2363},[178,3571,2367],{"class":518},[178,3573,2380],{"class":2363},[178,3575,2383],{"class":307},[178,3577,2264],{"class":288},[178,3579,2388],{"class":307},[178,3581,3582,3584,3586,3588],{"class":180,"line":224},[178,3583,2775],{"class":518},[178,3585,677],{"class":307},[178,3587,2780],{"class":187},[178,3589,1133],{"class":307},[178,3591,3592],{"class":180,"line":285},[178,3593,2876],{"class":275},[178,3595,3596,3598,3600,3602,3604,3606],{"class":180,"line":299},[178,3597,2881],{"class":288},[178,3599,631],{"class":292},[178,3601,2886],{"class":518},[178,3603,677],{"class":307},[178,3605,2191],{"class":288},[178,3607,1133],{"class":307},[178,3609,3610,3612,3614,3616,3618,3620,3622,3624],{"class":180,"line":319},[178,3611,2897],{"class":623},[178,3613,2256],{"class":307},[178,3615,3119],{"class":518},[178,3617,677],{"class":307},[178,3619,2795],{"class":288},[178,3621,2075],{"class":307},[178,3623,2910],{"class":288},[178,3625,3626],{"class":307},"])) {\n",[178,3628,3629,3631,3633,3635],{"class":180,"line":324},[178,3630,2923],{"class":518},[178,3632,677],{"class":307},[178,3634,2928],{"class":191},[178,3636,1133],{"class":307},[178,3638,3639,3641,3643,3645,3647,3649,3651],{"class":180,"line":335},[178,3640,2935],{"class":518},[178,3642,2790],{"class":518},[178,3644,2940],{"class":307},[178,3646,2943],{"class":187},[178,3648,2946],{"class":307},[178,3650,2949],{"class":187},[178,3652,2952],{"class":307},[178,3654,3655,3657],{"class":180,"line":346},[178,3656,2320],{"class":623},[178,3658,2323],{"class":307},[178,3660,3661],{"class":180,"line":351},[178,3662,2963],{"class":307},[178,3664,3665,3668,3670,3672,3674,3676],{"class":180,"line":382},[178,3666,3667],{"class":518},"   unset",[178,3669,677],{"class":307},[178,3671,2795],{"class":288},[178,3673,2075],{"class":307},[178,3675,2910],{"class":288},[178,3677,2952],{"class":307},[178,3679,3680,3682,3684,3686,3688,3690,3692,3694],{"class":180,"line":422},[178,3681,3177],{"class":288},[178,3683,631],{"class":292},[178,3685,2790],{"class":518},[178,3687,677],{"class":307},[178,3689,2795],{"class":288},[178,3691,2383],{"class":307},[178,3693,2801],{"class":2800},[178,3695,1133],{"class":307},[178,3697,3698,3700,3702,3704,3706,3708],{"class":180,"line":752},[178,3699,3196],{"class":518},[178,3701,677],{"class":307},[178,3703,2707],{"class":288},[178,3705,2383],{"class":307},[178,3707,2731],{"class":288},[178,3709,1133],{"class":307},[178,3711,3712,3714,3716,3718,3720,3722,3725],{"class":180,"line":763},[178,3713,2787],{"class":518},[178,3715,2790],{"class":518},[178,3717,2940],{"class":307},[178,3719,3217],{"class":187},[178,3721,2946],{"class":307},[178,3723,3724],{"class":187}," 'user deleted successfully'",[178,3726,2952],{"class":307},[178,3728,3729,3731],{"class":180,"line":768},[178,3730,2808],{"class":623},[178,3732,2323],{"class":307},[16,3734,3735],{},[256,3736],{"alt":174,"src":3737},"https://static.031130.xyz/uploads/2024/08/12/6577fe0c3a95b.webp",[1014,3739,3740],{"id":3740},"最终文件",[16,3742,3743],{},"现在我们的 index.php 文件看起来是这样的",[16,3745,3746],{},"在 70 行左右的代码中，我们使用 PHP 创建了一个 RESTful API，很神奇吧？",[169,3748,3750],{"className":1116,"code":3749,"language":1118,"meta":174,"style":174},"\u003C?php\n$jsonFile = 'users.json';\n$data = file_get_contents($jsonFile);\n$users = json_decode($data, true);\n$uri = $_SERVER['REQUEST_URI'];\n$method = $_SERVER['REQUEST_METHOD'];\nswitch ($method | $uri) {\n   case ($method == 'GET' && $uri == '/api/users'):\n       header('Content-Type: application/json');\n       echo json_encode($users, JSON_PRETTY_PRINT);\n       break;\n   case ($method == 'GET' && preg_match('/\\/api\\/users\\/[1-9]/', $uri)):\n       header('Content-Type: application/json');\n       $id = basename($uri);\n       if (!array_key_exists($id, $users)) {\n           http_response_code(404);\n           echo json_encode(['error' => 'user does not exist']);\n           break;\n       }\n       $responseData = [$id => $users[$id]];\n       echo json_encode($responseData, JSON_PRETTY_PRINT);\n       break;\n   case ($method == 'POST' && $uri == '/api/users'):\n       header('Content-Type: application/json');\n       $requestBody = json_decode(file_get_contents('php://input'), true);\n       $name = $requestBody['name'];\n       if (empty($name)) {\n           http_response_code(404);\n           echo json_encode(['error' => 'Please add name of the user']);\n       }\n       $users[] = $name;\n       $data = json_encode($users, JSON_PRETTY_PRINT);\n       file_put_contents($jsonFile, $data);\n       echo json_encode(['message' => 'user added successfully']);\n       break;\n   case ($method == 'PUT' && preg_match('/\\/api\\/users\\/[1-9]/', $uri)):\n       header('Content-Type: application/json');\n       $id = basename($uri);\n       if (!array_key_exists($id, $users)) {\n           http_response_code(404);\n           echo json_encode(['error' => 'user does not exist']);\n           break;\n       }\n       $requestBody = json_decode(file_get_contents('php://input'), true);\n       $name = $requestBody['name'];\n       if (empty($name)) {\n           http_response_code(404);\n           echo json_encode(['error' => 'Please add name of the user']);\n       }\n       $users[$id] = $name;\n       $data = json_encode($users, JSON_PRETTY_PRINT);\n       file_put_contents($jsonFile, $data);\n       echo json_encode(['message' => 'user updated successfully']);\n       break;\n   case ($method == 'DELETE' && preg_match('/\\/api\\/users\\/[1-9]/', $uri)):\n       header('Content-Type: application/json');\n       $id = basename($uri);\n       if (empty($users[$id])) {\n           http_response_code(404);\n           echo json_encode(['error' => 'user does not exist']);\n           break;\n       }\n       unset($users[$id]);\n       $data = json_encode($users, JSON_PRETTY_PRINT);\n       file_put_contents($jsonFile, $data);\n       echo json_encode(['message' => 'user deleted successfully']);\n       break;\n   default:\n       http_response_code(404);\n       echo json_encode(['error' => \"We cannot find what you're looking for.\"]);\n       break;\n}\n",[27,3751,3752,3764,3775,3791,3809,3823,3837,3851,3873,3884,3900,3906,3944,3954,3969,3990,4001,4018,4025,4030,4051,4067,4073,4095,4105,4128,4143,4157,4167,4183,4187,4200,4219,4234,4250,4256,4294,4304,4318,4338,4349,4366,4373,4378,4401,4416,4431,4442,4459,4464,4481,4500,4515,4532,4539,4582,4593,4608,4627,4638,4655,4662,4667,4683,4702,4717,4734,4741,4748,4759,4777,4784],{"__ignoreMap":174},[178,3753,3754,3757,3761],{"class":180,"line":181},[178,3755,3756],{"class":292},"\u003C",[178,3758,3760],{"class":3759},"sblXP","?",[178,3762,3763],{"class":2800},"php\n",[178,3765,3766,3768,3770,3773],{"class":180,"line":224},[178,3767,2707],{"class":288},[178,3769,631],{"class":292},[178,3771,3772],{"class":187}," 'users.json'",[178,3774,2323],{"class":307},[178,3776,3777,3780,3782,3785,3787,3789],{"class":180,"line":285},[178,3778,3779],{"class":288},"$data",[178,3781,631],{"class":292},[178,3783,3784],{"class":518}," file_get_contents",[178,3786,677],{"class":307},[178,3788,2707],{"class":288},[178,3790,1133],{"class":307},[178,3792,3793,3795,3797,3799,3801,3803,3805,3807],{"class":180,"line":299},[178,3794,2795],{"class":288},[178,3796,631],{"class":292},[178,3798,3076],{"class":518},[178,3800,677],{"class":307},[178,3802,3779],{"class":288},[178,3804,2383],{"class":307},[178,3806,3091],{"class":191},[178,3808,1133],{"class":307},[178,3810,3811,3813,3815,3817,3819,3821],{"class":180,"line":319},[178,3812,2191],{"class":288},[178,3814,631],{"class":292},[178,3816,2072],{"class":288},[178,3818,2075],{"class":307},[178,3820,2078],{"class":187},[178,3822,2081],{"class":307},[178,3824,3825,3827,3829,3831,3833,3835],{"class":180,"line":324},[178,3826,2206],{"class":288},[178,3828,631],{"class":292},[178,3830,2072],{"class":288},[178,3832,2075],{"class":307},[178,3834,2175],{"class":187},[178,3836,2081],{"class":307},[178,3838,3839,3841,3843,3845,3847,3849],{"class":180,"line":335},[178,3840,2253],{"class":623},[178,3842,2256],{"class":307},[178,3844,2206],{"class":288},[178,3846,2261],{"class":292},[178,3848,2264],{"class":288},[178,3850,2267],{"class":307},[178,3852,3853,3855,3857,3859,3861,3863,3865,3867,3869,3871],{"class":180,"line":346},[178,3854,2292],{"class":623},[178,3856,2256],{"class":307},[178,3858,2206],{"class":288},[178,3860,2299],{"class":292},[178,3862,2302],{"class":187},[178,3864,2305],{"class":292},[178,3866,2264],{"class":288},[178,3868,2299],{"class":292},[178,3870,2312],{"class":187},[178,3872,2315],{"class":307},[178,3874,3875,3878,3880,3882],{"class":180,"line":351},[178,3876,3877],{"class":518},"       header",[178,3879,677],{"class":307},[178,3881,2780],{"class":187},[178,3883,1133],{"class":307},[178,3885,3886,3888,3890,3892,3894,3896,3898],{"class":180,"line":382},[178,3887,2935],{"class":518},[178,3889,2790],{"class":518},[178,3891,677],{"class":307},[178,3893,2795],{"class":288},[178,3895,2383],{"class":307},[178,3897,2801],{"class":2800},[178,3899,1133],{"class":307},[178,3901,3902,3904],{"class":180,"line":422},[178,3903,2320],{"class":623},[178,3905,2323],{"class":307},[178,3907,3908,3910,3912,3914,3916,3918,3920,3922,3924,3926,3928,3930,3932,3934,3936,3938,3940,3942],{"class":180,"line":752},[178,3909,2292],{"class":623},[178,3911,2256],{"class":307},[178,3913,2206],{"class":288},[178,3915,2299],{"class":292},[178,3917,2302],{"class":187},[178,3919,2305],{"class":292},[178,3921,2358],{"class":518},[178,3923,677],{"class":307},[178,3925,2364],{"class":2363},[178,3927,2367],{"class":518},[178,3929,2370],{"class":2363},[178,3931,2367],{"class":518},[178,3933,2375],{"class":2363},[178,3935,2367],{"class":518},[178,3937,2380],{"class":2363},[178,3939,2383],{"class":307},[178,3941,2264],{"class":288},[178,3943,2388],{"class":307},[178,3945,3946,3948,3950,3952],{"class":180,"line":763},[178,3947,3877],{"class":518},[178,3949,677],{"class":307},[178,3951,2780],{"class":187},[178,3953,1133],{"class":307},[178,3955,3956,3959,3961,3963,3965,3967],{"class":180,"line":768},[178,3957,3958],{"class":288},"       $id",[178,3960,631],{"class":292},[178,3962,2886],{"class":518},[178,3964,677],{"class":307},[178,3966,2191],{"class":288},[178,3968,1133],{"class":307},[178,3970,3971,3974,3976,3978,3980,3982,3984,3986,3988],{"class":180,"line":779},[178,3972,3973],{"class":623},"       if",[178,3975,2256],{"class":307},[178,3977,2902],{"class":292},[178,3979,2905],{"class":518},[178,3981,677],{"class":307},[178,3983,2910],{"class":288},[178,3985,2383],{"class":307},[178,3987,2915],{"class":288},[178,3989,2918],{"class":307},[178,3991,3992,3995,3997,3999],{"class":180,"line":798},[178,3993,3994],{"class":518},"           http_response_code",[178,3996,677],{"class":307},[178,3998,2928],{"class":191},[178,4000,1133],{"class":307},[178,4002,4003,4006,4008,4010,4012,4014,4016],{"class":180,"line":803},[178,4004,4005],{"class":518},"           echo",[178,4007,2790],{"class":518},[178,4009,2940],{"class":307},[178,4011,2943],{"class":187},[178,4013,2946],{"class":307},[178,4015,2949],{"class":187},[178,4017,2952],{"class":307},[178,4019,4020,4023],{"class":180,"line":808},[178,4021,4022],{"class":623},"           break",[178,4024,2323],{"class":307},[178,4026,4027],{"class":180,"line":821},[178,4028,4029],{"class":307},"       }\n",[178,4031,4032,4035,4037,4039,4041,4043,4045,4047,4049],{"class":180,"line":840},[178,4033,4034],{"class":288},"       $responseData",[178,4036,631],{"class":292},[178,4038,1274],{"class":307},[178,4040,2910],{"class":288},[178,4042,2977],{"class":307},[178,4044,2795],{"class":288},[178,4046,2075],{"class":307},[178,4048,2910],{"class":288},[178,4050,2986],{"class":307},[178,4052,4053,4055,4057,4059,4061,4063,4065],{"class":180,"line":845},[178,4054,2935],{"class":518},[178,4056,2790],{"class":518},[178,4058,677],{"class":307},[178,4060,2997],{"class":288},[178,4062,2383],{"class":307},[178,4064,2801],{"class":2800},[178,4066,1133],{"class":307},[178,4068,4069,4071],{"class":180,"line":850},[178,4070,2320],{"class":623},[178,4072,2323],{"class":307},[178,4074,4075,4077,4079,4081,4083,4085,4087,4089,4091,4093],{"class":180,"line":855},[178,4076,2292],{"class":623},[178,4078,2256],{"class":307},[178,4080,2206],{"class":288},[178,4082,2299],{"class":292},[178,4084,2425],{"class":187},[178,4086,2305],{"class":292},[178,4088,2264],{"class":288},[178,4090,2299],{"class":292},[178,4092,2312],{"class":187},[178,4094,2315],{"class":307},[178,4096,4097,4099,4101,4103],{"class":180,"line":868},[178,4098,3877],{"class":518},[178,4100,677],{"class":307},[178,4102,2780],{"class":187},[178,4104,1133],{"class":307},[178,4106,4107,4110,4112,4114,4116,4118,4120,4122,4124,4126],{"class":180,"line":874},[178,4108,4109],{"class":288},"       $requestBody",[178,4111,631],{"class":292},[178,4113,3076],{"class":518},[178,4115,677],{"class":307},[178,4117,2702],{"class":518},[178,4119,677],{"class":307},[178,4121,3085],{"class":187},[178,4123,3088],{"class":307},[178,4125,3091],{"class":191},[178,4127,1133],{"class":307},[178,4129,4130,4133,4135,4137,4139,4141],{"class":180,"line":886},[178,4131,4132],{"class":288},"       $name",[178,4134,631],{"class":292},[178,4136,3103],{"class":288},[178,4138,2075],{"class":307},[178,4140,3108],{"class":187},[178,4142,2081],{"class":307},[178,4144,4145,4147,4149,4151,4153,4155],{"class":180,"line":892},[178,4146,3973],{"class":623},[178,4148,2256],{"class":307},[178,4150,3119],{"class":518},[178,4152,677],{"class":307},[178,4154,3124],{"class":288},[178,4156,2918],{"class":307},[178,4158,4159,4161,4163,4165],{"class":180,"line":897},[178,4160,3994],{"class":518},[178,4162,677],{"class":307},[178,4164,2928],{"class":191},[178,4166,1133],{"class":307},[178,4168,4169,4171,4173,4175,4177,4179,4181],{"class":180,"line":912},[178,4170,4005],{"class":518},[178,4172,2790],{"class":518},[178,4174,2940],{"class":307},[178,4176,2943],{"class":187},[178,4178,2946],{"class":307},[178,4180,3151],{"class":187},[178,4182,2952],{"class":307},[178,4184,4185],{"class":180,"line":917},[178,4186,4029],{"class":307},[178,4188,4189,4192,4194,4196,4198],{"class":180,"line":930},[178,4190,4191],{"class":288},"       $users",[178,4193,3165],{"class":307},[178,4195,293],{"class":292},[178,4197,3170],{"class":288},[178,4199,2323],{"class":307},[178,4201,4202,4205,4207,4209,4211,4213,4215,4217],{"class":180,"line":2576},[178,4203,4204],{"class":288},"       $data",[178,4206,631],{"class":292},[178,4208,2790],{"class":518},[178,4210,677],{"class":307},[178,4212,2795],{"class":288},[178,4214,2383],{"class":307},[178,4216,2801],{"class":2800},[178,4218,1133],{"class":307},[178,4220,4221,4224,4226,4228,4230,4232],{"class":180,"line":2581},[178,4222,4223],{"class":518},"       file_put_contents",[178,4225,677],{"class":307},[178,4227,2707],{"class":288},[178,4229,2383],{"class":307},[178,4231,2731],{"class":288},[178,4233,1133],{"class":307},[178,4235,4236,4238,4240,4242,4244,4246,4248],{"class":180,"line":2587},[178,4237,2935],{"class":518},[178,4239,2790],{"class":518},[178,4241,2940],{"class":307},[178,4243,3217],{"class":187},[178,4245,2946],{"class":307},[178,4247,3222],{"class":187},[178,4249,2952],{"class":307},[178,4251,4252,4254],{"class":180,"line":2593},[178,4253,2320],{"class":623},[178,4255,2323],{"class":307},[178,4257,4258,4260,4262,4264,4266,4268,4270,4272,4274,4276,4278,4280,4282,4284,4286,4288,4290,4292],{"class":180,"line":2599},[178,4259,2292],{"class":623},[178,4261,2256],{"class":307},[178,4263,2206],{"class":288},[178,4265,2299],{"class":292},[178,4267,2472],{"class":187},[178,4269,2305],{"class":292},[178,4271,2358],{"class":518},[178,4273,677],{"class":307},[178,4275,2364],{"class":2363},[178,4277,2367],{"class":518},[178,4279,2370],{"class":2363},[178,4281,2367],{"class":518},[178,4283,2375],{"class":2363},[178,4285,2367],{"class":518},[178,4287,2380],{"class":2363},[178,4289,2383],{"class":307},[178,4291,2264],{"class":288},[178,4293,2388],{"class":307},[178,4295,4296,4298,4300,4302],{"class":180,"line":2604},[178,4297,3877],{"class":518},[178,4299,677],{"class":307},[178,4301,2780],{"class":187},[178,4303,1133],{"class":307},[178,4305,4306,4308,4310,4312,4314,4316],{"class":180,"line":2613},[178,4307,3958],{"class":288},[178,4309,631],{"class":292},[178,4311,2886],{"class":518},[178,4313,677],{"class":307},[178,4315,2191],{"class":288},[178,4317,1133],{"class":307},[178,4319,4320,4322,4324,4326,4328,4330,4332,4334,4336],{"class":180,"line":2620},[178,4321,3973],{"class":623},[178,4323,2256],{"class":307},[178,4325,2902],{"class":292},[178,4327,2905],{"class":518},[178,4329,677],{"class":307},[178,4331,2910],{"class":288},[178,4333,2383],{"class":307},[178,4335,2915],{"class":288},[178,4337,2918],{"class":307},[178,4339,4341,4343,4345,4347],{"class":180,"line":4340},40,[178,4342,3994],{"class":518},[178,4344,677],{"class":307},[178,4346,2928],{"class":191},[178,4348,1133],{"class":307},[178,4350,4352,4354,4356,4358,4360,4362,4364],{"class":180,"line":4351},41,[178,4353,4005],{"class":518},[178,4355,2790],{"class":518},[178,4357,2940],{"class":307},[178,4359,2943],{"class":187},[178,4361,2946],{"class":307},[178,4363,2949],{"class":187},[178,4365,2952],{"class":307},[178,4367,4369,4371],{"class":180,"line":4368},42,[178,4370,4022],{"class":623},[178,4372,2323],{"class":307},[178,4374,4376],{"class":180,"line":4375},43,[178,4377,4029],{"class":307},[178,4379,4381,4383,4385,4387,4389,4391,4393,4395,4397,4399],{"class":180,"line":4380},44,[178,4382,4109],{"class":288},[178,4384,631],{"class":292},[178,4386,3076],{"class":518},[178,4388,677],{"class":307},[178,4390,2702],{"class":518},[178,4392,677],{"class":307},[178,4394,3085],{"class":187},[178,4396,3088],{"class":307},[178,4398,3091],{"class":191},[178,4400,1133],{"class":307},[178,4402,4404,4406,4408,4410,4412,4414],{"class":180,"line":4403},45,[178,4405,4132],{"class":288},[178,4407,631],{"class":292},[178,4409,3103],{"class":288},[178,4411,2075],{"class":307},[178,4413,3108],{"class":187},[178,4415,2081],{"class":307},[178,4417,4419,4421,4423,4425,4427,4429],{"class":180,"line":4418},46,[178,4420,3973],{"class":623},[178,4422,2256],{"class":307},[178,4424,3119],{"class":518},[178,4426,677],{"class":307},[178,4428,3124],{"class":288},[178,4430,2918],{"class":307},[178,4432,4434,4436,4438,4440],{"class":180,"line":4433},47,[178,4435,3994],{"class":518},[178,4437,677],{"class":307},[178,4439,2928],{"class":191},[178,4441,1133],{"class":307},[178,4443,4445,4447,4449,4451,4453,4455,4457],{"class":180,"line":4444},48,[178,4446,4005],{"class":518},[178,4448,2790],{"class":518},[178,4450,2940],{"class":307},[178,4452,2943],{"class":187},[178,4454,2946],{"class":307},[178,4456,3151],{"class":187},[178,4458,2952],{"class":307},[178,4460,4462],{"class":180,"line":4461},49,[178,4463,4029],{"class":307},[178,4465,4467,4469,4471,4473,4475,4477,4479],{"class":180,"line":4466},50,[178,4468,4191],{"class":288},[178,4470,2075],{"class":307},[178,4472,2910],{"class":288},[178,4474,3463],{"class":307},[178,4476,293],{"class":292},[178,4478,3170],{"class":288},[178,4480,2323],{"class":307},[178,4482,4484,4486,4488,4490,4492,4494,4496,4498],{"class":180,"line":4483},51,[178,4485,4204],{"class":288},[178,4487,631],{"class":292},[178,4489,2790],{"class":518},[178,4491,677],{"class":307},[178,4493,2795],{"class":288},[178,4495,2383],{"class":307},[178,4497,2801],{"class":2800},[178,4499,1133],{"class":307},[178,4501,4503,4505,4507,4509,4511,4513],{"class":180,"line":4502},52,[178,4504,4223],{"class":518},[178,4506,677],{"class":307},[178,4508,2707],{"class":288},[178,4510,2383],{"class":307},[178,4512,2731],{"class":288},[178,4514,1133],{"class":307},[178,4516,4518,4520,4522,4524,4526,4528,4530],{"class":180,"line":4517},53,[178,4519,2935],{"class":518},[178,4521,2790],{"class":518},[178,4523,2940],{"class":307},[178,4525,3217],{"class":187},[178,4527,2946],{"class":307},[178,4529,3516],{"class":187},[178,4531,2952],{"class":307},[178,4533,4535,4537],{"class":180,"line":4534},54,[178,4536,2320],{"class":623},[178,4538,2323],{"class":307},[178,4540,4542,4544,4546,4548,4550,4552,4554,4556,4558,4560,4562,4564,4566,4568,4570,4572,4574,4576,4578,4580],{"class":180,"line":4541},55,[178,4543,2292],{"class":623},[178,4545,2256],{"class":307},[178,4547,2206],{"class":288},[178,4549,2299],{"class":292},[178,4551,2535],{"class":187},[178,4553,2538],{"class":623},[178,4555,2541],{"class":187},[178,4557,2305],{"class":292},[178,4559,2358],{"class":518},[178,4561,677],{"class":307},[178,4563,2364],{"class":2363},[178,4565,2367],{"class":518},[178,4567,2370],{"class":2363},[178,4569,2367],{"class":518},[178,4571,2375],{"class":2363},[178,4573,2367],{"class":518},[178,4575,2380],{"class":2363},[178,4577,2383],{"class":307},[178,4579,2264],{"class":288},[178,4581,2388],{"class":307},[178,4583,4585,4587,4589,4591],{"class":180,"line":4584},56,[178,4586,3877],{"class":518},[178,4588,677],{"class":307},[178,4590,2780],{"class":187},[178,4592,1133],{"class":307},[178,4594,4596,4598,4600,4602,4604,4606],{"class":180,"line":4595},57,[178,4597,3958],{"class":288},[178,4599,631],{"class":292},[178,4601,2886],{"class":518},[178,4603,677],{"class":307},[178,4605,2191],{"class":288},[178,4607,1133],{"class":307},[178,4609,4611,4613,4615,4617,4619,4621,4623,4625],{"class":180,"line":4610},58,[178,4612,3973],{"class":623},[178,4614,2256],{"class":307},[178,4616,3119],{"class":518},[178,4618,677],{"class":307},[178,4620,2795],{"class":288},[178,4622,2075],{"class":307},[178,4624,2910],{"class":288},[178,4626,3626],{"class":307},[178,4628,4630,4632,4634,4636],{"class":180,"line":4629},59,[178,4631,3994],{"class":518},[178,4633,677],{"class":307},[178,4635,2928],{"class":191},[178,4637,1133],{"class":307},[178,4639,4641,4643,4645,4647,4649,4651,4653],{"class":180,"line":4640},60,[178,4642,4005],{"class":518},[178,4644,2790],{"class":518},[178,4646,2940],{"class":307},[178,4648,2943],{"class":187},[178,4650,2946],{"class":307},[178,4652,2949],{"class":187},[178,4654,2952],{"class":307},[178,4656,4658,4660],{"class":180,"line":4657},61,[178,4659,4022],{"class":623},[178,4661,2323],{"class":307},[178,4663,4665],{"class":180,"line":4664},62,[178,4666,4029],{"class":307},[178,4668,4670,4673,4675,4677,4679,4681],{"class":180,"line":4669},63,[178,4671,4672],{"class":518},"       unset",[178,4674,677],{"class":307},[178,4676,2795],{"class":288},[178,4678,2075],{"class":307},[178,4680,2910],{"class":288},[178,4682,2952],{"class":307},[178,4684,4686,4688,4690,4692,4694,4696,4698,4700],{"class":180,"line":4685},64,[178,4687,4204],{"class":288},[178,4689,631],{"class":292},[178,4691,2790],{"class":518},[178,4693,677],{"class":307},[178,4695,2795],{"class":288},[178,4697,2383],{"class":307},[178,4699,2801],{"class":2800},[178,4701,1133],{"class":307},[178,4703,4705,4707,4709,4711,4713,4715],{"class":180,"line":4704},65,[178,4706,4223],{"class":518},[178,4708,677],{"class":307},[178,4710,2707],{"class":288},[178,4712,2383],{"class":307},[178,4714,2731],{"class":288},[178,4716,1133],{"class":307},[178,4718,4720,4722,4724,4726,4728,4730,4732],{"class":180,"line":4719},66,[178,4721,2935],{"class":518},[178,4723,2790],{"class":518},[178,4725,2940],{"class":307},[178,4727,3217],{"class":187},[178,4729,2946],{"class":307},[178,4731,3724],{"class":187},[178,4733,2952],{"class":307},[178,4735,4737,4739],{"class":180,"line":4736},67,[178,4738,2320],{"class":623},[178,4740,2323],{"class":307},[178,4742,4744,4746],{"class":180,"line":4743},68,[178,4745,2607],{"class":623},[178,4747,2610],{"class":307},[178,4749,4751,4753,4755,4757],{"class":180,"line":4750},69,[178,4752,2923],{"class":518},[178,4754,677],{"class":307},[178,4756,2928],{"class":191},[178,4758,1133],{"class":307},[178,4760,4762,4764,4766,4768,4770,4772,4775],{"class":180,"line":4761},70,[178,4763,2935],{"class":518},[178,4765,2790],{"class":518},[178,4767,2940],{"class":307},[178,4769,2943],{"class":187},[178,4771,2946],{"class":307},[178,4773,4774],{"class":187}," \"We cannot find what you're looking for.\"",[178,4776,2952],{"class":307},[178,4778,4780,4782],{"class":180,"line":4779},71,[178,4781,2320],{"class":623},[178,4783,2323],{"class":307},[178,4785,4787],{"class":180,"line":4786},72,[178,4788,419],{"class":307},[1014,4790,4791],{"id":4791},"额外内容",[16,4793,4794],{},"在这种情况下，我不希望删除我的所有用户，所以我加了一个新的语句，如果只剩下最后一个用户，它将不会被删除，像这样",[169,4796,4798],{"className":1116,"code":4797,"language":1118,"meta":174,"style":174},"if (sizeof($users) == 1){\n   http_response_code(404);\n   echo json_encode(['error' => 'there is only one user left. you cannot delete it!']);\n   break;\n}\n",[27,4799,4800,4826,4837,4854,4860],{"__ignoreMap":174},[178,4801,4802,4805,4807,4810,4812,4814,4817,4820,4823],{"class":180,"line":181},[178,4803,4804],{"class":623},"if",[178,4806,2256],{"class":307},[178,4808,4809],{"class":518},"sizeof",[178,4811,677],{"class":307},[178,4813,2795],{"class":288},[178,4815,4816],{"class":307},") ",[178,4818,4819],{"class":292},"==",[178,4821,4822],{"class":191}," 1",[178,4824,4825],{"class":307},"){\n",[178,4827,4828,4831,4833,4835],{"class":180,"line":224},[178,4829,4830],{"class":518},"   http_response_code",[178,4832,677],{"class":307},[178,4834,2928],{"class":191},[178,4836,1133],{"class":307},[178,4838,4839,4841,4843,4845,4847,4849,4852],{"class":180,"line":285},[178,4840,2787],{"class":518},[178,4842,2790],{"class":518},[178,4844,2940],{"class":307},[178,4846,2943],{"class":187},[178,4848,2946],{"class":307},[178,4850,4851],{"class":187}," 'there is only one user left. you cannot delete it!'",[178,4853,2952],{"class":307},[178,4855,4856,4858],{"class":180,"line":299},[178,4857,2808],{"class":623},[178,4859,2323],{"class":307},[178,4861,4862],{"class":180,"line":319},[178,4863,419],{"class":307},[1014,4865,4866],{"id":4866},"源码",[16,4868,4869,4870,4875],{},"你可以在",[32,4871,4874],{"href":4872,"rel":4873},"https://github.com/amirkamizi/php-simple-restful-api",[36],"原作者的 github"," 上看到完整注释的源代码以及 post man 集合",[1014,4877,4878],{"id":4878},"总结",[16,4880,4881],{},"现在你知道如何在 PHP 中创建一个简单的 RESTful API。",[16,4883,4884],{},"我推荐你打开一个 PHP 文件并复习所有的这些我们进行的步骤，并且像本文一样添加一些额外的资源",[16,4886,4887],{},"如果你有任何的建议、问题或者观点，请联系文章原作者，他期待着听到你的声音。",[1014,4889,4890],{"id":4890},"要点",[2224,4892,4893,4896,4899,4902,4905],{},[1902,4894,4895],{},"不使用框架，用 PHP 创建一个 RESTful API",[1902,4897,4898],{},"在 PHP 中使用优雅的 URL",[1902,4900,4901],{},"处理请求的 body",[1902,4903,4904],{},"使用 Json 文件作为你的数据库",[1902,4906,4907],{},"使用多个变量作为 switch 的关键词",[220,4909,4910],{},"html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html pre.shiki code .sW2Sy, html code.shiki .sW2Sy{--shiki-default:#A0A1A7;--shiki-default-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic}html pre.shiki code .s_Sar, html code.shiki .s_Sar{--shiki-default:#0184BC;--shiki-dark:#56B6C2}html pre.shiki code .sJa8x, html code.shiki .sJa8x{--shiki-default:#E45649;--shiki-dark:#E06C75}html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html pre.shiki code .sknuh, html code.shiki .sknuh{--shiki-default:#383A42;--shiki-dark:#56B6C2}html pre.shiki code .sLKXg, html code.shiki .sLKXg{--shiki-default:#A626A4;--shiki-dark:#C678DD}html pre.shiki code .sDaw7, html code.shiki .sDaw7{--shiki-default:#0184BC;--shiki-dark:#E06C75}html pre.shiki code .sxymB, html code.shiki .sxymB{--shiki-default:#986801;--shiki-dark:#ABB2BF}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html pre.shiki code .sblXP, html code.shiki .sblXP{--shiki-default:#383A42;--shiki-dark:#C678DD}",{"title":174,"searchDepth":224,"depth":224,"links":4912},[4913,4914,4915,4916,4920,4921,4922,4923,4924,4925,4926,4927,4928,4929,4930,4931,4932],{"id":1873,"depth":224,"text":1873},{"id":1894,"depth":224,"text":1894},{"id":1916,"depth":224,"text":1916},{"id":1933,"depth":224,"text":1934,"children":4917},[4918,4919],{"id":1943,"depth":285,"text":1943},{"id":1978,"depth":285,"text":1978},{"id":2045,"depth":224,"text":2046},{"id":2154,"depth":224,"text":2154},{"id":2635,"depth":224,"text":2635},{"id":2742,"depth":224,"text":2742},{"id":2818,"depth":224,"text":2818},{"id":3029,"depth":224,"text":3029},{"id":3245,"depth":224,"text":3245},{"id":3532,"depth":224,"text":3532},{"id":3740,"depth":224,"text":3740},{"id":4791,"depth":224,"text":4791},{"id":4866,"depth":224,"text":4866},{"id":4878,"depth":224,"text":4878},{"id":4890,"depth":224,"text":4890},{"title":4934,"date":4935,"path":4936,"tags":4937,"body":4940},"在 Hexo Fluid 主题中使用霞鹜文楷","2023-11-28 00:16:23","/2023/11/28/use-lxgw-wenkai-in-hexo-fluid",[4938,4939,1053],"Hexo","CSS",{"type":13,"value":4941,"toc":5163},[4942,4945,4951,4959,4977,4986,5019,5030,5033,5059,5062,5075,5081,5090,5096,5142,5145,5160],[16,4943,4944],{},"我的博客换到 fluid 主题已经有两年了，期间一直有为博客更换字体的想法，但之前没有前端开发的相关知识支撑我换字体的需求。不过现在，我已经有了一些 Vue.js 的开发经验，相信能支撑我完成这个目标。",[16,4946,4947],{},[256,4948],{"alt":4949,"src":4950},"最终成品","https://static.031130.xyz/uploads/2024/08/12/6564d0f926e58.webp",[16,4952,4953,4954,1891],{},"我在谷歌搜索到了这篇文章——",[32,4955,4958],{"href":4956,"rel":4957},"https://penghh.fun/2023/05/07/2023-5-7-hexo_blog_font/",[36],"《Hexo博客Fluid主题，字体全局更改为霞鹜文楷体》",[16,4960,4961,4962,4965,4966,4969,4970,1704,4973,4976],{},"文章中直接修改了 ",[27,4963,4964],{},"themes/fluid/layout/_partial/head.ejs"," 让文章生成时在 html 的 head 标签中引入 lxgw-wenkai-screen-webfont 的 css 文件，并使用自定义 css 方案。但这种方案我不喜欢，我的 fluid 主题是通过 npm 安装 hexo-theme-fluid 的方式引入的，这意味着我不能直接编辑 ",[27,4967,4968],{},"themes/fluid"," 下的文件，包括文章中需要编辑的 ",[27,4971,4972],{},"head.ejs",[27,4974,4975],{},"_config.yml"," 。",[16,4978,4979,4980,4985],{},"我翻阅了 ",[32,4981,4984],{"href":4982,"rel":4983},"https://github.com/chawyehsu/lxgw-wenkai-webfont",[36],"lxgw-wenkai-webfont"," 的 README，找到了使用 cdn 引入的方式。我们需要在 html 的 head 标签中加上下面这段:",[169,4987,4991],{"className":4988,"code":4989,"language":4990,"meta":174,"style":174},"language-html shiki shiki-themes one-light one-dark-pro","\u003Clink rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/lxgw-wenkai-screen-webfont@1.1.0/style.css\" />\n","html",[27,4992,4993],{"__ignoreMap":174},[178,4994,4995,4997,5000,5003,5005,5008,5011,5013,5016],{"class":180,"line":181},[178,4996,3756],{"class":307},[178,4998,4999],{"class":288},"link",[178,5001,5002],{"class":191}," rel",[178,5004,293],{"class":307},[178,5006,5007],{"class":187},"\"stylesheet\"",[178,5009,5010],{"class":191}," href",[178,5012,293],{"class":307},[178,5014,5015],{"class":187},"\"https://cdn.jsdelivr.net/npm/lxgw-wenkai-screen-webfont@1.1.0/style.css\"",[178,5017,5018],{"class":307}," />\n",[16,5020,5021],{},[20,5022,5023,5024,5029],{},"但我注意到我想要的 lxgw-wenkai-screen-webfont 在 ",[32,5025,5028],{"href":5026,"rel":5027},"https://staticfile.org/",[36],"staticfile.org"," 上也有 cdn 提供，且该 cdn 有海外节点，是不错的选择，所以我要通过下面这段引入:",[16,5031,5032],{},"staticfile 已经因为供应链投毒被各 adblock 插件屏蔽，已改用 npmmirror",[169,5034,5036],{"className":4988,"code":5035,"language":4990,"meta":174,"style":174},"\u003Clink rel=\"stylesheet\" href=\"https://registry.npmmirror.com/lxgw-wenkai-screen-web/latest/files/style.min.css\" />\n",[27,5037,5038],{"__ignoreMap":174},[178,5039,5040,5042,5044,5046,5048,5050,5052,5054,5057],{"class":180,"line":181},[178,5041,3756],{"class":307},[178,5043,4999],{"class":288},[178,5045,5002],{"class":191},[178,5047,293],{"class":307},[178,5049,5007],{"class":187},[178,5051,5010],{"class":191},[178,5053,293],{"class":307},[178,5055,5056],{"class":187},"\"https://registry.npmmirror.com/lxgw-wenkai-screen-web/latest/files/style.min.css\"",[178,5058,5018],{"class":307},[16,5060,5061],{},"但要如何引入呢？",[16,5063,5064,5065,5070,5071,5074],{},"在 hexo 的",[32,5066,5069],{"href":5067,"rel":5068},"https://hexo.io/docs/plugins.html",[36],"官方文档","中，我找到了一个方案。可以在博客的 workdir 下创建一个 ",[27,5072,5073],{},"scripts"," 文件夹，在当中放入需要执行的 js 脚本。",[16,5076,5077],{},[256,5078],{"alt":5079,"src":5080},"hexo 文档","https://static.031130.xyz/uploads/2024/08/12/6564cea5c71ca.webp",[16,5082,5083,5084,5089],{},"在这篇名为",[32,5085,5088],{"href":5086,"rel":5087},"https://www.zywvvd.com/notes/hexo/theme/fluid/fluid-add-umami/fluid-add-umami/",[36],"《Fluid -23- 添加 Umami 统计》"," 的文章里，我找到了在 hexo 生成静态文件时直接注入的方式。",[16,5091,1238,5092,5095],{},[27,5093,5094],{},"scripts/font.js"," 中写入:",[169,5097,5099],{"className":614,"code":5098,"language":616,"meta":174,"style":174},"hexo.extend.injector.register('head_end',\n'\u003Clink rel=\"stylesheet\" href=\"https://registry.npmmirror.com/lxgw-wenkai-screen-web/latest/files/style.min.css\" />',\n'default');\n",[27,5100,5101,5128,5135],{"__ignoreMap":174},[178,5102,5103,5106,5108,5111,5113,5116,5118,5121,5123,5126],{"class":180,"line":181},[178,5104,5105],{"class":667},"hexo",[178,5107,671],{"class":307},[178,5109,5110],{"class":577},"extend",[178,5112,671],{"class":307},[178,5114,5115],{"class":577},"injector",[178,5117,671],{"class":307},[178,5119,5120],{"class":184},"register",[178,5122,677],{"class":307},[178,5124,5125],{"class":187},"'head_end'",[178,5127,649],{"class":307},[178,5129,5130,5133],{"class":180,"line":224},[178,5131,5132],{"class":187},"'\u003Clink rel=\"stylesheet\" href=\"https://registry.npmmirror.com/lxgw-wenkai-screen-web/latest/files/style.min.css\" />'",[178,5134,649],{"class":307},[178,5136,5137,5140],{"class":180,"line":285},[178,5138,5139],{"class":187},"'default'",[178,5141,1133],{"class":307},[16,5143,5144],{},"这样一来，字体文件的 css 便被我们成功引入了，我们还需要指定页面使用霞鹜文楷作为默认字体。",[16,5146,5147,5148,5151,5152,5155,5156,5159],{},"在 fluid 主题的配置文件 ",[27,5149,5150],{},"_config.fluid.yml"," 中，有一个名为 ",[27,5153,5154],{},"font-family"," 的配置项，直接写上 ",[27,5157,5158],{},"font-family: \"LXGW Wenkai Screen\""," 便可大功告成。",[220,5161,5162],{},"html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html pre.shiki code .sJa8x, html code.shiki .sJa8x{--shiki-default:#E45649;--shiki-dark:#E06C75}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html pre.shiki code .s7GmK, html code.shiki .s7GmK{--shiki-default:#383A42;--shiki-dark:#E5C07B}html pre.shiki code .s2QsP, html code.shiki .s2QsP{--shiki-default:#E45649;--shiki-dark:#E5C07B}html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}",{"title":174,"searchDepth":224,"depth":224,"links":5164},[],{"title":5166,"date":5167,"path":5168,"tags":5169,"body":5171},"【翻译】GLWTPL——祝你好运开源许可证","2023-11-12 01:09:09","/2023/11/12/a-introduce-of-glwtpl",[5170,1859],"Fun",{"type":13,"value":5172,"toc":5461},[5173,5182,5185,5191,5200,5203,5209,5218,5221,5238,5241,5432,5437,5440,5443,5446,5452,5455],[1138,5174,5175],{},[16,5176,5177,5178],{},"说实话，当我第一次看见 GLWTPL( Good Luck With That Public License ) 的时候，我差点把嘴里的饭给喷出来了，这是一个非常有意思的开源许可证。原文请直接戳原仓库 -> ",[32,5179,5180],{"href":5180,"rel":5181},"https://github.com/me-shaon/GLWTPL",[36],[16,5183,5184],{},"如果你对你的代码有这样的感觉:",[169,5186,5189],{"className":5187,"code":5188,"language":468},[466],"当我写下这段代码的时候，只有上帝和我知道我在写什么。\n现在只有上帝知道了。\n",[27,5190,5188],{"__ignoreMap":174},[16,5192,5193,5194,5199],{},"那不如来考虑一下将这份",[32,5195,5198],{"href":5196,"rel":5197},"https://github.com/me-shaon/GLWTPL/blob/master/LICENSE",[36],"开源许可证","添加到你的项目中！",[16,5201,5202],{},"并且，祝你未来的自己、人类同胞、外星人或人工智能机器人（可以编码并会毁灭人类）——实际上是任何敢于参与你的项目的人好运。",[16,5204,5205],{},[256,5206],{"alt":5207,"src":5208},"good-luck.gif","https://static.031130.xyz/uploads/2024/08/12/654fb6e4581bf.gif",[16,5210,5211,5212,5217],{},"当然，它还有一个",[32,5213,5216],{"href":5214,"rel":5215},"https://github.com/me-shaon/GLWTPL/blob/master/NSFW_LICENSE",[36],"脏话版本","。干杯！",[1014,5219,5220],{"id":5220},"可能的使用场景",[2224,5222,5223,5226,5229,5232,5235],{},[1902,5224,5225],{},"你写了一些你并不为此自豪的代码，但你想要将它开源。",[1902,5227,5228],{},"你想要将你写的代码“放生”，但不想为此负任何责任。",[1902,5230,5231],{},"“无论如何我都已经写完了”，并且你没有时间/意图对你的代码进行修复、修改或改进。",[1902,5233,5234],{},"想要将自己参加的黑客马拉松/代码竞赛的代码打造成一个爆火的仓库？该使用什么开源许可证？这就是为你量身打造的开源许可证！",[1902,5236,5237],{},"你的大学课设或科研工作与这份许可证是天作之合。",[1014,5239,5240],{"id":5240},"一些翻译版本",[2224,5242,5243,5250,5257,5264,5271,5278,5285,5292,5299,5306,5313,5320,5327,5334,5341,5348,5355,5362,5369,5376,5383,5390,5397,5404,5411,5418,5425],{},[1902,5244,5245],{},[32,5246,5249],{"href":5247,"rel":5248},"https://github.com/me-shaon/GLWTPL/blob/master/translations/LICENSE_al-AL",[36],"Albanian - Shqip",[1902,5251,5252],{},[32,5253,5256],{"href":5254,"rel":5255},"https://github.com/me-shaon/GLWTPL/blob/master/translations/LICENSE_ar-AR",[36],"Arabic - العربية",[1902,5258,5259],{},[32,5260,5263],{"href":5261,"rel":5262},"https://github.com/me-shaon/GLWTPL/blob/master/translations/LICENSE_bn-BN",[36],"Bangla - বাংলা",[1902,5265,5266],{},[32,5267,5270],{"href":5268,"rel":5269},"https://github.com/me-shaon/GLWTPL/blob/master/translations/LICENSE_zh-HK",[36],"Cantonese - 廣東話",[1902,5272,5273],{},[32,5274,5277],{"href":5275,"rel":5276},"https://github.com/me-shaon/GLWTPL/blob/master/translations/LICENSE_cat-CAT",[36],"Catalan - Català",[1902,5279,5280],{},[32,5281,5284],{"href":5282,"rel":5283},"https://github.com/me-shaon/GLWTPL/blob/master/translations/LICENSE_hr-HR",[36],"Croatian - Hrvatski",[1902,5286,5287],{},[32,5288,5291],{"href":5289,"rel":5290},"https://github.com/me-shaon/GLWTPL/blob/master/translations/LICENSE_da-DK",[36],"Danish - Dansk",[1902,5293,5294],{},[32,5295,5298],{"href":5296,"rel":5297},"https://github.com/me-shaon/GLWTPL/blob/master/translations/LICENSE_nl-NL",[36],"Dutch - Nederlands",[1902,5300,5301],{},[32,5302,5305],{"href":5303,"rel":5304},"https://github.com/me-shaon/GLWTPL/blob/master/translations/LICENSE_fr-FR",[36],"French - Français",[1902,5307,5308],{},[32,5309,5312],{"href":5310,"rel":5311},"https://github.com/me-shaon/GLWTPL/blob/master/translations/NSFW_LICENSE_gl-GL",[36],"Galician - Galego",[1902,5314,5315],{},[32,5316,5319],{"href":5317,"rel":5318},"https://github.com/me-shaon/GLWTPL/blob/master/translations/LICENSE_ka-GE",[36],"Georgian - ქართული",[1902,5321,5322],{},[32,5323,5326],{"href":5324,"rel":5325},"https://github.com/me-shaon/GLWTPL/blob/master/translations/LICENSE_de-DE",[36],"German - Deutsch",[1902,5328,5329],{},[32,5330,5333],{"href":5331,"rel":5332},"https://github.com/me-shaon/GLWTPL/blob/master/translations/LICENSE_gr-GR",[36],"Greek - Ελληνικά",[1902,5335,5336],{},[32,5337,5340],{"href":5338,"rel":5339},"https://github.com/me-shaon/GLWTPL/blob/master/translations/LICENSE_he-HE",[36],"Hebrew - עברית",[1902,5342,5343],{},[32,5344,5347],{"href":5345,"rel":5346},"https://github.com/me-shaon/GLWTPL/blob/master/translations/LICENSE_id-ID",[36],"Indonesian - Bahasa Indonesia",[1902,5349,5350],{},[32,5351,5354],{"href":5352,"rel":5353},"https://github.com/me-shaon/GLWTPL/blob/master/translations/LICENSE_it-IT",[36],"Italian - Italiano",[1902,5356,5357],{},[32,5358,5361],{"href":5359,"rel":5360},"https://github.com/me-shaon/GLWTPL/blob/master/translations/LICENSE_ja-JP",[36],"Japanese - 日本語",[1902,5363,5364],{},[32,5365,5368],{"href":5366,"rel":5367},"https://github.com/me-shaon/GLWTPL/blob/master/translations/LICENSE_ko-KR",[36],"Korea - 한국어",[1902,5370,5371],{},[32,5372,5375],{"href":5373,"rel":5374},"https://github.com/me-shaon/GLWTPL/blob/master/translations/LICENSE_lv-LV",[36],"Latvian - Latviski",[1902,5377,5378],{},[32,5379,5382],{"href":5380,"rel":5381},"https://github.com/me-shaon/GLWTPL/blob/master/translations/LICENSE_pt-BR",[36],"Portuguese - Português (BR)",[1902,5384,5385],{},[32,5386,5389],{"href":5387,"rel":5388},"https://github.com/me-shaon/GLWTPL/blob/master/translations/LICENSE_ru-RU",[36],"Russian - Русский",[1902,5391,5392],{},[32,5393,5396],{"href":5394,"rel":5395},"https://github.com/me-shaon/GLWTPL/blob/master/translations/LICENSE_zh-CN",[36],"Simplified Chinese - 简体中文",[1902,5398,5399],{},[32,5400,5403],{"href":5401,"rel":5402},"https://github.com/me-shaon/GLWTPL/blob/master/translations/LICENSE_es-ES",[36],"Spanish - Español",[1902,5405,5406],{},[32,5407,5410],{"href":5408,"rel":5409},"https://github.com/me-shaon/GLWTPL/blob/master/translations/LICENSE_sv-SE",[36],"Swedish - Svenska",[1902,5412,5413],{},[32,5414,5417],{"href":5415,"rel":5416},"https://github.com/me-shaon/GLWTPL/blob/master/translations/LICENSE_zh-TW",[36],"Traditional Chinese - 正體中文",[1902,5419,5420],{},[32,5421,5424],{"href":5422,"rel":5423},"https://github.com/me-shaon/GLWTPL/blob/master/translations/LICENSE_tr-TR",[36],"Turkish - Türkçe",[1902,5426,5427],{},[32,5428,5431],{"href":5429,"rel":5430},"https://github.com/me-shaon/GLWTPL/blob/master/translations/LICENSE_vn-VN",[36],"Vietnamese - Tiếng Việt",[1138,5433,5434],{},[16,5435,5436],{},"本译文翻译于 2023 年 11 月 12 日，日后大概率也不会对本文进行任何改进，故也采用 GLWTPL 向所有人授权。",[5438,5439],"hr",{},[1014,5441,5442],{"id":5442},"附",[16,5444,5445],{},"此协议的英文原版：",[169,5447,5450],{"className":5448,"code":5449,"language":468},[466],"               GLWT(Good Luck With That) Public License\n                 Copyright (c) Everyone, except Author\n\nEveryone is permitted to copy, distribute, modify, merge, sell, publish,\nsublicense or whatever they want with this software but at their OWN RISK.\n\n                            Preamble\n\nThe author has absolutely no clue what the code in this project does.\nIt might just work or not, there is no third option.\n\n\n                GOOD LUCK WITH THAT PUBLIC LICENSE\n   TERMS AND CONDITIONS FOR COPYING, DISTRIBUTION, AND MODIFICATION\n\n  0. You just DO WHATEVER YOU WANT TO as long as you NEVER LEAVE A\nTRACE TO TRACK THE AUTHOR of the original product to blame for or hold\nresponsible.\n\nIN NO EVENT SHALL THE AUTHORS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\nFROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\nDEALINGS IN THE SOFTWARE.\n\nGood luck and Godspeed.\n",[27,5451,5449],{"__ignoreMap":174},[16,5453,5454],{},"此协议在 Github 上的中文翻译版本：",[169,5456,5459],{"className":5457,"code":5458,"language":468},[466],"GLWT（Good Luck With That，祝你好运）公共许可证\n版权所有© 每个人，除了作者\n\n任何人都被允许复制、分发、修改、合并、销售、出版、再授权或\n任何其它操作，但风险自负。\n\n作者对这个项目中的代码一无所知。\n代码处于可用或不可用状态，没有第三种情况。\n\n\n                祝你好运公共许可证\n            复制、分发和修改的条款和条件\n\n0 ：在不导致作者被指责或承担责任的情况下，你可以做任何你想\n要做的事情。\n\n无论是在合同行为、侵权行为或其它因使用本软件产生的情形，作\n者不对任何索赔、损害承担责任。\n\n祖宗保佑。\n",[27,5460,5458],{"__ignoreMap":174},{"title":174,"searchDepth":224,"depth":224,"links":5462},[5463,5464,5465],{"id":5220,"depth":224,"text":5220},{"id":5240,"depth":224,"text":5240},{"id":5442,"depth":224,"text":5442},{"title":5467,"date":5468,"path":5469,"tags":5470,"body":5475},"通过巴法云将向日葵智能插座接入米家，实现小爱同学远程控制","2023-11-02 10:17:02","/2023/11/02/integrating-sunflower-smart-socket-with-mi-home-via-bemfa-cloud",[5471,5472,1051,10,5473,5474,5170],"IoT","MiAI","Python","Hardware",{"type":13,"value":5476,"toc":6214},[5477,5483,5492,5501,5510,5515,5518,5524,5527,5530,5570,5576,5579,5585,5588,5591,5594,6185,6188,6211],[16,5478,1058,5479,5482],{},[32,5480,1062],{"href":5481},"/2023/11/01/unveiling-sunflower-smart-adapter-api-intercepting-utilizing-api-android-packet-sniffing/","中，我们介绍了如何在本地局域网中通过发送 http 请求控制向日葵智能插座 C2 的开关状态。但这还远远不够，我自己是小米生态链的忠实用户，在宿舍里也接入了四五个米家的智能设备，因此我想把这个智能插座接入米家，实现离家时一键关闭。",[16,5484,5485,5486,5491],{},"在阅读",[32,5487,5490],{"href":5488,"rel":5489},"https://iot.mi.com/",[36],"小米IoT开发者平台","的接入文档后，我发现米家对于个人开发者并不友好，接入文档大部分要完成企业认证以后才能实现。在谷歌一番搜索过后，我发现了通过假设 Home Assistant 后通过巴法云接入米家的方案。但我眼下就这一个非米家的智能家具，暂时还不想去碰 Home Assistant 那套体系。",[16,5493,5494,5495,5500],{},"因此我便找上了",[32,5496,5499],{"href":5497,"rel":5498},"https://cloud.bemfa.com/",[36],"巴法云","。在巴法云的官网中提到，他们是「专注物联网设备接入&一站式解决方案」，对于个人开发者，目前平台免费使用。网站的文档虽然并不优雅美观，却透露出实用主义的气息，针对接入提供了 TCP 长连接和 MQTT 两种方案，看着就很适合实现我的需求。",[16,5502,5503,5504,5509],{},"在巴法云文档中的「",[32,5505,5508],{"href":5506,"rel":5507},"https://cloud.bemfa.com/docs/#/?id=_21-%e8%ae%a2%e9%98%85%e5%8f%91%e5%b8%83%e6%a8%a1%e5%bc%8f",[36],"五分钟入门","」那一栏介绍了远程控制的业务逻辑:",[1138,5511,5512],{},[16,5513,5514],{},"如果单片机订阅了一个主题，手机往这个主题推送个消息指令，单片机由于订阅了这个主题，就可以收到发往这个主题的消息，就可以达到手机控制单片机的目的。",[16,5516,5517],{},"所以我需要在巴法云的控制台创建一个针对于智能插座的主题，让我局域网内的一台设备订阅这个主题。接入米家以后，米家需要控制向日葵的智能插座时就向巴法云的这个主题推送一条消息，局域网内的设备就能接收到推送消息，进而调用智能插座的 api 实现远程开关。在这里，我选择使用一台刷了 Armbian 的 N1 作为局域网内的转发器。整个控制流程看上去是下面这个样子:",[16,5519,5520],{},[256,5521],{"alt":5522,"src":5523},"控制流程图","https://static.031130.xyz/uploads/2024/08/12/65430fbf56dee.webp",[16,5525,5526],{},"我并不知道 tcp 长连接的数据传输应该如何实现，但看起来 MQTT 是一个比较成熟的协议，因此我选择使用 MQTT 作为巴法云和 N1 之间的通讯协议。",[16,5528,5529],{},"在巴法云的控制台，选择 MQTT 设备云，创建一个新的主题，注意需要以 001~009 结尾，否则在米家里看不见创建的这个主题。",[1138,5531,5532,5537,5542,5547,5552,5557,5562,5567],{},[1138,5533,5534],{},[16,5535,5536],{},"当主题名字后三位是001时为插座设备。",[1138,5538,5539],{},[16,5540,5541],{},"当主题名字后三位是002时为灯泡设备。",[1138,5543,5544],{},[16,5545,5546],{},"当主题名字后三位是003时为风扇设备。",[1138,5548,5549],{},[16,5550,5551],{},"当主题名字后三位是004时为传感器设备。",[1138,5553,5554],{},[16,5555,5556],{},"当主题名字后三位是005时为空调设备。",[1138,5558,5559],{},[16,5560,5561],{},"当主题名字后三位是006时为开关设备。",[1138,5563,5564],{},[16,5565,5566],{},"当主题名字后三位是009时为窗帘设备。",[16,5568,5569],{},"当主题名字为其他时，默认为普通主题节点，不会同步到米家。",[16,5571,5572],{},[256,5573],{"alt":5574,"src":5575},"创建新主题","https://static.031130.xyz/uploads/2024/08/12/654310bb3133b.webp",[16,5577,5578],{},"此时，我便可以在手机的米家中找到巴法云并接入这个插座。",[16,5580,5581],{},[256,5582],{"alt":5583,"src":5584},"米家找连接巴法云","https://static.031130.xyz/uploads/2024/08/12/654312974e393.webp",[16,5586,5587],{},"至此，米家那边的接入已经完成了，虽然没法在米家中找到对应设备的卡片，但是可以在小爱同学的小爱训练计划中找到对应的设备。",[16,5589,5590],{},"我们还需要让本地的 N1 盒子使用 MQTT 协议订阅巴法云的消息。",[16,5592,5593],{},"参考代码如下:",[169,5595,5599],{"className":5596,"code":5597,"language":5598,"meta":174,"style":174},"language-python shiki shiki-themes one-light one-dark-pro","#!/usr/bin/python3\n\nimport paho.mqtt.client as mqtt\nimport requests\n\n# 智能插座相关\nhost = ''\nsn = ''\nkey = ''\ntime = ''\n\n# 巴法云相关\nclient_id = ''\ntheme = ''\n\ndef set_adapter_status(status: bool):\n    url = 'http://' + host + '/plug'\n    requests.get(url, params={\n        \"status\": 1 if status else 0,\n        \"sn\": sn,\n        \"key\": key,\n        \"_api\": \"set_plug_status\",\n        \"time\": time,\n        \"index\": 0\n    })\n\ndef on_connect(client, userdata, flags, rc):\n    print(\"Connection returned with result code:\" + str(rc))\n    client.subscribe(theme, qos=1)\n\ndef on_message(client, userdata, msg):\n    if msg.payload.decode(\"utf-8\") == 'on':\n        set_adapter_status(True)\n    elif msg.payload.decode(\"utf-8\") == 'off':\n        set_adapter_status(False)\n\ndef on_subscribe(client, userdata, mid, granted_qos):\n    print(\"Subscribed: \" + str(mid) + \" \" + str(granted_qos))\n    \nclient = mqtt.Client(client_id=client_id, clean_session=False, protocol=mqtt.MQTTv311)\nclient.on_connect = on_connect\nclient.on_message = on_message\nclient.on_subscribe = on_subscribe\n\nclient.connect(\"bemfa.com\", 9501, 60)\nclient.loop_forever()\n","python",[27,5600,5601,5606,5610,5624,5631,5635,5640,5650,5659,5668,5677,5681,5686,5695,5704,5708,5729,5751,5771,5795,5803,5811,5823,5831,5841,5846,5850,5879,5897,5917,5921,5943,5968,5980,6002,6013,6017,6044,6072,6077,6117,6127,6137,6147,6151,6176],{"__ignoreMap":174},[178,5602,5603],{"class":180,"line":181},[178,5604,5605],{"class":275},"#!/usr/bin/python3\n",[178,5607,5608],{"class":180,"line":224},[178,5609,282],{"emptyLinePlaceholder":281},[178,5611,5612,5615,5618,5621],{"class":180,"line":285},[178,5613,5614],{"class":623},"import",[178,5616,5617],{"class":307}," paho.mqtt.client ",[178,5619,5620],{"class":623},"as",[178,5622,5623],{"class":307}," mqtt\n",[178,5625,5626,5628],{"class":180,"line":299},[178,5627,5614],{"class":623},[178,5629,5630],{"class":307}," requests\n",[178,5632,5633],{"class":180,"line":319},[178,5634,282],{"emptyLinePlaceholder":281},[178,5636,5637],{"class":180,"line":324},[178,5638,5639],{"class":275},"# 智能插座相关\n",[178,5641,5642,5645,5647],{"class":180,"line":335},[178,5643,5644],{"class":307},"host ",[178,5646,293],{"class":292},[178,5648,5649],{"class":187}," ''\n",[178,5651,5652,5655,5657],{"class":180,"line":346},[178,5653,5654],{"class":307},"sn ",[178,5656,293],{"class":292},[178,5658,5649],{"class":187},[178,5660,5661,5664,5666],{"class":180,"line":351},[178,5662,5663],{"class":307},"key ",[178,5665,293],{"class":292},[178,5667,5649],{"class":187},[178,5669,5670,5673,5675],{"class":180,"line":382},[178,5671,5672],{"class":307},"time ",[178,5674,293],{"class":292},[178,5676,5649],{"class":187},[178,5678,5679],{"class":180,"line":422},[178,5680,282],{"emptyLinePlaceholder":281},[178,5682,5683],{"class":180,"line":752},[178,5684,5685],{"class":275},"# 巴法云相关\n",[178,5687,5688,5691,5693],{"class":180,"line":763},[178,5689,5690],{"class":307},"client_id ",[178,5692,293],{"class":292},[178,5694,5649],{"class":187},[178,5696,5697,5700,5702],{"class":180,"line":768},[178,5698,5699],{"class":307},"theme ",[178,5701,293],{"class":292},[178,5703,5649],{"class":187},[178,5705,5706],{"class":180,"line":779},[178,5707,282],{"emptyLinePlaceholder":281},[178,5709,5710,5713,5716,5718,5722,5724,5727],{"class":180,"line":798},[178,5711,5712],{"class":623},"def",[178,5714,5715],{"class":184}," set_adapter_status",[178,5717,677],{"class":307},[178,5719,5721],{"class":5720},"so_Uh","status",[178,5723,643],{"class":307},[178,5725,5726],{"class":518}," bool",[178,5728,2315],{"class":307},[178,5730,5731,5734,5736,5739,5742,5745,5748],{"class":180,"line":803},[178,5732,5733],{"class":307},"    url ",[178,5735,293],{"class":292},[178,5737,5738],{"class":187}," 'http://'",[178,5740,5741],{"class":292}," +",[178,5743,5744],{"class":307}," host ",[178,5746,5747],{"class":292},"+",[178,5749,5750],{"class":187}," '/plug'\n",[178,5752,5753,5756,5760,5763,5767,5769],{"class":180,"line":808},[178,5754,5755],{"class":307},"    requests.",[178,5757,5759],{"class":5758},"slOjB","get",[178,5761,5762],{"class":307},"(url, ",[178,5764,5766],{"class":5765},"sp7wS","params",[178,5768,293],{"class":292},[178,5770,2653],{"class":307},[178,5772,5773,5776,5778,5781,5784,5787,5790,5793],{"class":180,"line":821},[178,5774,5775],{"class":187},"        \"status\"",[178,5777,1435],{"class":307},[178,5779,5780],{"class":191},"1",[178,5782,5783],{"class":623}," if",[178,5785,5786],{"class":307}," status ",[178,5788,5789],{"class":623},"else",[178,5791,5792],{"class":191}," 0",[178,5794,649],{"class":307},[178,5796,5797,5800],{"class":180,"line":840},[178,5798,5799],{"class":187},"        \"sn\"",[178,5801,5802],{"class":307},": sn,\n",[178,5804,5805,5808],{"class":180,"line":845},[178,5806,5807],{"class":187},"        \"key\"",[178,5809,5810],{"class":307},": key,\n",[178,5812,5813,5816,5818,5821],{"class":180,"line":850},[178,5814,5815],{"class":187},"        \"_api\"",[178,5817,1435],{"class":307},[178,5819,5820],{"class":187},"\"set_plug_status\"",[178,5822,649],{"class":307},[178,5824,5825,5828],{"class":180,"line":855},[178,5826,5827],{"class":187},"        \"time\"",[178,5829,5830],{"class":307},": time,\n",[178,5832,5833,5836,5838],{"class":180,"line":868},[178,5834,5835],{"class":187},"        \"index\"",[178,5837,1435],{"class":307},[178,5839,5840],{"class":191},"0\n",[178,5842,5843],{"class":180,"line":874},[178,5844,5845],{"class":307},"    })\n",[178,5847,5848],{"class":180,"line":886},[178,5849,282],{"emptyLinePlaceholder":281},[178,5851,5852,5854,5857,5859,5862,5864,5867,5869,5872,5874,5877],{"class":180,"line":892},[178,5853,5712],{"class":623},[178,5855,5856],{"class":184}," on_connect",[178,5858,677],{"class":307},[178,5860,5861],{"class":5720},"client",[178,5863,2383],{"class":307},[178,5865,5866],{"class":5720}," userdata",[178,5868,2383],{"class":307},[178,5870,5871],{"class":5720}," flags",[178,5873,2383],{"class":307},[178,5875,5876],{"class":5720}," rc",[178,5878,2315],{"class":307},[178,5880,5881,5884,5886,5889,5891,5894],{"class":180,"line":897},[178,5882,5883],{"class":518},"    print",[178,5885,677],{"class":307},[178,5887,5888],{"class":187},"\"Connection returned with result code:\"",[178,5890,5741],{"class":292},[178,5892,5893],{"class":518}," str",[178,5895,5896],{"class":307},"(rc))\n",[178,5898,5899,5902,5905,5908,5911,5913,5915],{"class":180,"line":912},[178,5900,5901],{"class":307},"    client.",[178,5903,5904],{"class":5758},"subscribe",[178,5906,5907],{"class":307},"(theme, ",[178,5909,5910],{"class":5765},"qos",[178,5912,293],{"class":292},[178,5914,5780],{"class":191},[178,5916,316],{"class":307},[178,5918,5919],{"class":180,"line":917},[178,5920,282],{"emptyLinePlaceholder":281},[178,5922,5923,5925,5928,5930,5932,5934,5936,5938,5941],{"class":180,"line":930},[178,5924,5712],{"class":623},[178,5926,5927],{"class":184}," on_message",[178,5929,677],{"class":307},[178,5931,5861],{"class":5720},[178,5933,2383],{"class":307},[178,5935,5866],{"class":5720},[178,5937,2383],{"class":307},[178,5939,5940],{"class":5720}," msg",[178,5942,2315],{"class":307},[178,5944,5945,5948,5951,5954,5956,5959,5961,5963,5966],{"class":180,"line":2576},[178,5946,5947],{"class":623},"    if",[178,5949,5950],{"class":307}," msg.payload.",[178,5952,5953],{"class":5758},"decode",[178,5955,677],{"class":307},[178,5957,5958],{"class":187},"\"utf-8\"",[178,5960,4816],{"class":307},[178,5962,4819],{"class":292},[178,5964,5965],{"class":187}," 'on'",[178,5967,2610],{"class":307},[178,5969,5970,5973,5975,5978],{"class":180,"line":2581},[178,5971,5972],{"class":5758},"        set_adapter_status",[178,5974,677],{"class":307},[178,5976,5977],{"class":191},"True",[178,5979,316],{"class":307},[178,5981,5982,5985,5987,5989,5991,5993,5995,5997,6000],{"class":180,"line":2587},[178,5983,5984],{"class":623},"    elif",[178,5986,5950],{"class":307},[178,5988,5953],{"class":5758},[178,5990,677],{"class":307},[178,5992,5958],{"class":187},[178,5994,4816],{"class":307},[178,5996,4819],{"class":292},[178,5998,5999],{"class":187}," 'off'",[178,6001,2610],{"class":307},[178,6003,6004,6006,6008,6011],{"class":180,"line":2593},[178,6005,5972],{"class":5758},[178,6007,677],{"class":307},[178,6009,6010],{"class":191},"False",[178,6012,316],{"class":307},[178,6014,6015],{"class":180,"line":2599},[178,6016,282],{"emptyLinePlaceholder":281},[178,6018,6019,6021,6024,6026,6028,6030,6032,6034,6037,6039,6042],{"class":180,"line":2604},[178,6020,5712],{"class":623},[178,6022,6023],{"class":184}," on_subscribe",[178,6025,677],{"class":307},[178,6027,5861],{"class":5720},[178,6029,2383],{"class":307},[178,6031,5866],{"class":5720},[178,6033,2383],{"class":307},[178,6035,6036],{"class":5720}," mid",[178,6038,2383],{"class":307},[178,6040,6041],{"class":5720}," granted_qos",[178,6043,2315],{"class":307},[178,6045,6046,6048,6050,6053,6055,6057,6060,6062,6065,6067,6069],{"class":180,"line":2613},[178,6047,5883],{"class":518},[178,6049,677],{"class":307},[178,6051,6052],{"class":187},"\"Subscribed: \"",[178,6054,5741],{"class":292},[178,6056,5893],{"class":518},[178,6058,6059],{"class":307},"(mid) ",[178,6061,5747],{"class":292},[178,6063,6064],{"class":187}," \" \"",[178,6066,5741],{"class":292},[178,6068,5893],{"class":518},[178,6070,6071],{"class":307},"(granted_qos))\n",[178,6073,6074],{"class":180,"line":2620},[178,6075,6076],{"class":307},"    \n",[178,6078,6079,6082,6084,6087,6090,6092,6095,6097,6100,6103,6105,6107,6109,6112,6114],{"class":180,"line":4340},[178,6080,6081],{"class":307},"client ",[178,6083,293],{"class":292},[178,6085,6086],{"class":307}," mqtt.",[178,6088,6089],{"class":5758},"Client",[178,6091,677],{"class":307},[178,6093,6094],{"class":5765},"client_id",[178,6096,293],{"class":292},[178,6098,6099],{"class":307},"client_id, ",[178,6101,6102],{"class":5765},"clean_session",[178,6104,293],{"class":292},[178,6106,6010],{"class":191},[178,6108,1333],{"class":307},[178,6110,6111],{"class":5765},"protocol",[178,6113,293],{"class":292},[178,6115,6116],{"class":307},"mqtt.MQTTv311)\n",[178,6118,6119,6122,6124],{"class":180,"line":4351},[178,6120,6121],{"class":307},"client.on_connect ",[178,6123,293],{"class":292},[178,6125,6126],{"class":307}," on_connect\n",[178,6128,6129,6132,6134],{"class":180,"line":4368},[178,6130,6131],{"class":307},"client.on_message ",[178,6133,293],{"class":292},[178,6135,6136],{"class":307}," on_message\n",[178,6138,6139,6142,6144],{"class":180,"line":4375},[178,6140,6141],{"class":307},"client.on_subscribe ",[178,6143,293],{"class":292},[178,6145,6146],{"class":307}," on_subscribe\n",[178,6148,6149],{"class":180,"line":4380},[178,6150,282],{"emptyLinePlaceholder":281},[178,6152,6153,6156,6159,6161,6164,6166,6169,6171,6174],{"class":180,"line":4403},[178,6154,6155],{"class":307},"client.",[178,6157,6158],{"class":5758},"connect",[178,6160,677],{"class":307},[178,6162,6163],{"class":187},"\"bemfa.com\"",[178,6165,1333],{"class":307},[178,6167,6168],{"class":191},"9501",[178,6170,1333],{"class":307},[178,6172,6173],{"class":191},"60",[178,6175,316],{"class":307},[178,6177,6178,6180,6183],{"class":180,"line":4418},[178,6179,6155],{"class":307},[178,6181,6182],{"class":5758},"loop_forever",[178,6184,865],{"class":307},[1014,6186,6187],{"id":6187},"参考链接",[2224,6189,6190,6197,6204],{},[1902,6191,6192],{},[32,6193,6196],{"href":6194,"rel":6195},"https://cloud.bemfa.com/docs/#/",[36],"巴法开放平台",[1902,6198,6199],{},[32,6200,6203],{"href":6201,"rel":6202},"https://www.cnblogs.com/Mickey-7/p/17402095.html",[36],"Python MQTT客户端  paho-mqtt",[1902,6205,6206],{},[32,6207,6210],{"href":6208,"rel":6209},"https://www.emqx.com/zh/blog/comparision-of-python-mqtt-client",[36],"Python MQTT 客户端对比",[220,6212,6213],{},"html pre.shiki code .sW2Sy, html code.shiki .sW2Sy{--shiki-default:#A0A1A7;--shiki-default-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic}html pre.shiki code .sLKXg, html code.shiki .sLKXg{--shiki-default:#A626A4;--shiki-dark:#C678DD}html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html pre.shiki code .sknuh, html code.shiki .sknuh{--shiki-default:#383A42;--shiki-dark:#56B6C2}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .so_Uh, html code.shiki .so_Uh{--shiki-default:#986801;--shiki-default-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic}html pre.shiki code .s_Sar, html code.shiki .s_Sar{--shiki-default:#0184BC;--shiki-dark:#56B6C2}html pre.shiki code .slOjB, html code.shiki .slOjB{--shiki-default:#383A42;--shiki-dark:#61AFEF}html pre.shiki code .sp7wS, html code.shiki .sp7wS{--shiki-default:#986801;--shiki-default-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}",{"title":174,"searchDepth":224,"depth":224,"links":6215},[6216],{"id":6187,"depth":224,"text":6187},{"title":6218,"date":6219,"path":6220,"tags":6221,"body":6223},"使用 Root 后的安卓手机获取向日葵智能插座 C2 的开关 api","2023-11-01 23:46:28","/2023/11/01/unveiling-sunflower-smart-adapter-api-intercepting-utilizing-api-android-packet-sniffing",[6222,1051,5471,5170,5474],"Android",{"type":13,"value":6224,"toc":6332},[6225,6236,6239,6245,6248,6254,6257,6298,6301,6304,6310,6313,6319,6326],[1138,6226,6227],{},[16,6228,6229,6230,6235],{},"之前看到 ",[32,6231,6234],{"href":6232,"rel":6233},"https://https.gs/archives/338/",[36],"https.gs 上的一篇文章","，发现可以抓取向日葵智能插座 C1Pro 的开关 api，并实现局域网或公网的控制。这样一来，我们其实就不需要依赖于向日葵自己家的 App 去实现智能插座的开关操作，还是比较方便的。今年趁着双十一，直接低价拿下来带有计电功能的 C2，便也来试一试能不能抓到接口。",[16,6237,6238],{},"首先，拿到插座以后肯定还是下载向日葵的官方 App，完成 wifi 的链接，这里就不再赘述。",[16,6240,6241],{},[256,6242],{"alt":6243,"src":6244},"向日葵的操作界面","https://static.031130.xyz/uploads/2024/08/12/65427474ba54d.webp",[16,6246,6247],{},"然后就可以打开我们的抓包软件。需要注意的是，原博客中抓到的接口是 http 协议，但这个接口在新版的 App 上已经变为了 https 协议，因此我们需要找一台 Root 过后的安卓机去抓包。抓包的步骤没什么好说的，用 Root 权限给本地安装自己的 CA 证书，然后打开抓包模式，在向日葵的 App 那边开关几次插座，回来就能看到这一段时间内的请求。",[16,6249,6250],{},[256,6251],{"alt":6252,"src":6253},"HttpCanary 操作界面","https://static.031130.xyz/uploads/2024/08/12/654275e167583.webp",[16,6255,6256],{},"点开可以看到，这是一个 GET 请求，一共有如下几个参数",[2224,6258,6259,6264,6270,6276,6286,6292],{},[1902,6260,6261,6263],{},[27,6262,5721],{}," 这是状态设置，设置为 1 时为打开指令，0 为关闭指令",[1902,6265,6266,6269],{},[27,6267,6268],{},"sn"," 这个应该是设备码",[1902,6271,6272,6275],{},[27,6273,6274],{},"key"," 应该是用来操作设备的密钥",[1902,6277,6278,6281,6282,6285],{},[27,6279,6280],{},"_api"," 操作类型，我只关心插座的打开关闭，所以设为 ",[27,6283,6284],{},"set_plug_status"," 即可",[1902,6287,6288,6291],{},[27,6289,6290],{},"time"," 奇奇怪怪的而参数，也不是 unix 时间戳，反正照抄就行了",[1902,6293,6294,6297],{},[27,6295,6296],{},"index"," 原博说是用来给插排操作指定第几个孔位的，我们智能插座直接设置为 0 即可",[16,6299,6300],{},"理论上你用抓出来的 url 已经可以实现公网访问了，但我测试下来并不行，可能是向日葵那边的服务器做了别的校验，比如说判断了 ua 之类的？不过无所谓，我本来就是打算局域网内操作。",[16,6302,6303],{},"登陆路由器后台，寻找疑似智能插座的设备，一般很容易就能找到。",[16,6305,6306],{},[256,6307],{"alt":6308,"src":6309},"路由器后台管理界面","https://static.031130.xyz/uploads/2024/08/12/654277f0d5c2a.webp",[16,6311,6312],{},"使用 nmap 命令扫对应 ip 开放的端口。不知道是不是巧合，我和原博扫出来的端口都是 6767 端口。",[16,6314,6315],{},[256,6316],{"alt":6317,"src":6318},"扫描端口","https://static.031130.xyz/uploads/2024/08/12/654278685f137.webp",[16,6320,6321,6322,6325],{},"将上面抓到的 url 的域名换成 ",[27,6323,6324],{},"ip:port","，https 协议改成 http 协议，在浏览器中直接访问，获得了 0 的状态码，插座也正常开关。",[16,6327,6328],{},[256,6329],{"alt":6330,"src":6331},"浏览器操作测试","https://static.031130.xyz/uploads/2024/08/12/654279513c1f8.webp",{"title":174,"searchDepth":224,"depth":224,"links":6333},[],"/en/archives/",132,1766435598276]
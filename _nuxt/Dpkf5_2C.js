import{d as E,q as C,b as j,f as B,i as H,C as I,D as T,E as b,o as w,G as A,M as $,N as L,P as M,Q as N,I as O,_ as S}from"./t3YLDFC_.js";function m(e){return e?typeof e=="string"?e:Array.isArray(e)?e.length>=2&&typeof e[0]=="string"&&typeof e[1]=="object"?e.slice(2).map(m).join(""):e.map(m).join(""):e.value&&typeof e.value=="string"?e.value:e.children&&Array.isArray(e.children)?e.children.map(m).join(""):"":""}function V(e){if(!e)return[];const v=[],a=e.value||e;function i(t){if(t)if(Array.isArray(t))if(t.length>=2&&typeof t[0]=="string"&&typeof t[1]=="object"){const h=t[0],d=t[1],r=t.slice(2),n=h.match(/^h([1-6])$/);if(n?.[1]&&d.id){const s=parseInt(n[1]),l=r.map(m).join("").trim();l&&v.push({id:d.id,text:l,level:s})}r.forEach(i)}else t.forEach(i);else typeof t=="object"&&(t.children&&Array.isArray(t.children)&&t.children.forEach(i),t.value&&Array.isArray(t.value)&&t.value.forEach(i))}return i(a),v}const q={key:0,class:"toc"},D={class:"toc-list"},F=["href","onClick"],P=E({__name:"TableOfContents",props:{body:{}},setup(e){const v=e,a=C(()=>V(v.body)),i=j(""),t=r=>{if(!i.value)return!1;const n=a.value.findIndex(c=>c.id===i.value),s=a.value.findIndex(c=>c.id===r.id);if(n===-1||s===-1)return!1;const l=r;if(l.id===i.value||l.level<=2)return!1;const x=c=>{const o=[],u=a.value[c];if(!u)return o;let f=u.level,_=c-1;for(;_>=0;){const p=a.value[_];if(!p||p.level<f&&(o.push(p.id),f=p.level,p.level<=1))break;_--}return o},k=c=>{const o=a.value[c];if(!o)return null;let u=c-1;for(;u>=0;){const f=a.value[u];if(!f)break;if(f.level<o.level)return f.id;u--}return null},g=x(n);if(g.includes(l.id))return!1;const y=k(s);return!(!y||y===i.value||g.includes(y))},h=r=>{const n=document.getElementById(r);n&&(n.scrollIntoView({behavior:"smooth",block:"start"}),window.history.pushState(null,"",`#${r}`))},d=()=>{const r=a.value.map(l=>({id:l.id,element:document.getElementById(l.id)})).filter(l=>l.element!==null);if(r.length===0)return;const n=window.scrollY;let s=r[0];for(const l of r)if(l.element.getBoundingClientRect().top+n<=n+100)s=l;else break;s&&(i.value=s.id)};return B(()=>{d();let r=!1;const n=()=>{r||(window.requestAnimationFrame(()=>{d(),r=!1}),r=!0)};window.addEventListener("scroll",n,{passive:!0}),H(()=>{window.removeEventListener("scroll",n)})}),(r,n)=>b(a).length>0?(w(),I("nav",q,[n[0]||(n[0]=A("div",{class:"toc-title"},"目录",-1)),A("ul",D,[(w(!0),I($,null,L(b(a),s=>(w(),I("li",{key:s.id,class:M(["toc-item",`toc-level-${s.level}`,{active:b(i)===s.id,collapsed:t(s)}])},[A("a",{href:`#${s.id}`,onClick:N(l=>h(s.id),["prevent"])},O(s.text),9,F)],2))),128))])])):T("",!0)}}),z=Object.assign(S(P,[["__scopeId","data-v-ae70bcd1"]]),{__name:"TableOfContents"});export{z as _};

const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./Hh6HjGWZ.js","./5AyHum73.js","./entry.Cb3Jctur.css","./BC7mfSrw.js"])))=>i.map(i=>d[i]);
import{_ as V}from"./BNQYmZ6q.js";import{d as I,C as g,D as x,o as d,Q as T,E as c,y as B,G as u,I as j,_ as O,J as M,q as C,O as W,a as $,w as L,c as H,af as D,ag as q,ah as S,ai as z,R as F,b as Y,f as G,i as J,M as K,N as Q,P as U,K as N,L as X,H as Z}from"./5AyHum73.js";import{a as tt,_ as et,u as R}from"./BNFhrOFj.js";import{q as nt,b as st}from"./CaOVmcVg.js";import{t as at}from"./Dw9FZWsg.js";import"./DNZcqReJ.js";const ot={key:0,class:"post-navigation"},rt=["href"],it={class:"nav-content"},lt={class:"nav-title"},ct=["href"],ut={class:"nav-content"},ft={class:"nav-title"},vt=I({__name:"PostNavigation",props:{prevPost:{},nextPost:{}},setup(t){return(o,e)=>t.prevPost||t.nextPost?(d(),g("nav",ot,[t.prevPost?(d(),g("a",{key:0,class:"nav-button prev",href:t.prevPost.path+"/",onClick:e[0]||(e[0]=T(i=>("navigateTo"in o?o.navigateTo:c(B))(t.prevPost.path+"/"),["prevent"]))},[e[3]||(e[3]=u("div",{class:"nav-arrow"},"←",-1)),u("div",it,[e[2]||(e[2]=u("span",{class:"nav-label"},"上一篇",-1)),u("span",lt,j(t.prevPost.title),1)])],8,rt)):x("",!0),t.nextPost?(d(),g("a",{key:1,class:"nav-button next",href:t.nextPost.path+"/",onClick:e[1]||(e[1]=T(i=>("navigateTo"in o?o.navigateTo:c(B))(t.nextPost.path+"/"),["prevent"]))},[u("div",ut,[e[4]||(e[4]=u("span",{class:"nav-label"},"下一篇",-1)),u("span",ft,j(t.nextPost.title),1)]),e[5]||(e[5]=u("div",{class:"nav-arrow"},"→",-1))],8,ct)):x("",!0)])):x("",!0)}}),dt=Object.assign(O(vt,[["__scopeId","data-v-27f76087"]]),{__name:"PostNavigation"}),pt={key:1},mt=I({__name:"Waline",setup(t){const o=D(()=>F(()=>import("./Hh6HjGWZ.js"),__vite__mapDeps([0,1,2,3]),import.meta.url).then(f=>f.Waline)),e=M(),i=C(()=>({...W.waline,path:e.path.endsWith("/")?e.path:e.path+"/"})),{targetRef:s,isVisible:p}=tt({rootMargin:"200px",threshold:0});return(f,a)=>{const n=z;return d(),g("div",{id:"waline",ref_key:"walineRef",ref:s},[$(n,null,{default:L(()=>[c(p)?(d(),H(c(o),q(S({key:0},c(i))),null,16)):(d(),g("div",pt,"Waline Loading..."))]),_:1})],512)}}}),_t=Object.assign(mt,{__name:"Waline"});function k(t){return t?typeof t=="string"?t:Array.isArray(t)?t.length>=2&&typeof t[0]=="string"&&typeof t[1]=="object"?t.slice(2).map(k).join(""):t.map(k).join(""):t.value&&typeof t.value=="string"?t.value:t.children&&Array.isArray(t.children)?t.children.map(k).join(""):"":""}function ht(t){if(!t)return[];const o=[],e=t.value||t;function i(s){if(s)if(Array.isArray(s))if(s.length>=2&&typeof s[0]=="string"&&typeof s[1]=="object"){const p=s[0],f=s[1],a=s.slice(2),n=p.match(/^h([1-6])$/);if(n?.[1]&&f.id){const r=parseInt(n[1]),l=a.map(k).join("").trim();l&&o.push({id:f.id,text:l,level:r})}a.forEach(i)}else s.forEach(i);else typeof s=="object"&&(s.children&&Array.isArray(s.children)&&s.children.forEach(i),s.value&&Array.isArray(s.value)&&s.value.forEach(i))}return i(e),o}const gt={key:0,class:"toc"},yt={class:"toc-list"},bt=["href","onClick"],wt=I({__name:"TableOfContents",props:{body:{}},setup(t){const o=t,e=C(()=>ht(o.body)),i=Y(""),s=a=>{if(!i.value)return!1;const n=e.value.findIndex(v=>v.id===i.value),r=e.value.findIndex(v=>v.id===a.id);if(n===-1||r===-1)return!1;const l=a;if(l.id===i.value||l.level<=2)return!1;const P=v=>{const m=[],_=e.value[v];if(!_)return m;let h=_.level,E=v-1;for(;E>=0;){const w=e.value[E];if(!w||w.level<h&&(m.push(w.id),h=w.level,w.level<=1))break;E--}return m},A=v=>{const m=e.value[v];if(!m)return null;let _=v-1;for(;_>=0;){const h=e.value[_];if(!h)break;if(h.level<m.level)return h.id;_--}return null},y=P(n);if(y.includes(l.id))return!1;const b=A(r);return!(!b||b===i.value||y.includes(b))},p=a=>{const n=document.getElementById(a);n&&(n.scrollIntoView({behavior:"smooth",block:"start"}),window.history.pushState(null,"",`#${a}`))},f=()=>{const a=e.value.map(l=>({id:l.id,element:document.getElementById(l.id)})).filter(l=>l.element!==null);if(a.length===0)return;const n=window.scrollY;let r=a[0];for(const l of a)if(l.element.getBoundingClientRect().top+n<=n+100)r=l;else break;r&&(i.value=r.id)};return G(()=>{f();let a=!1;const n=()=>{a||(window.requestAnimationFrame(()=>{f(),a=!1}),a=!0)};window.addEventListener("scroll",n,{passive:!0}),J(()=>{window.removeEventListener("scroll",n)})}),(a,n)=>c(e).length>0?(d(),g("nav",gt,[n[0]||(n[0]=u("div",{class:"toc-title"},"目录",-1)),u("ul",yt,[(d(!0),g(K,null,Q(c(e),r=>(d(),g("li",{key:r.id,class:U(["toc-item",`toc-level-${r.level}`,{active:c(i)===r.id,collapsed:s(r)}])},[u("a",{href:`#${r.id}`,onClick:T(l=>p(r.id),["prevent"])},j(r.text),9,bt)],2))),128))])])):x("",!0)}}),xt=Object.assign(O(wt,[["__scopeId","data-v-61bd12f2"]]),{__name:"TableOfContents"}),Pt=I({__name:"[slug]",async setup(t){let o,e;const i=M(),{year:s,month:p,day:f,slug:a}=i.params,{data:n}=([o,e]=N(()=>R(`post-${s}-${p}-${f}-${a}`,()=>nt("posts").path(`/${s}/${p}/${f}/${a}`).first())),o=await o,e(),o);if(!n.value)throw X({statusCode:404,statusMessage:"Post not found",fatal:!0});const r=([o,e]=N(()=>R(`surround-${s}-${p}-${f}-${a}`,()=>st("posts",n.value.path,{before:1,after:1,fields:["title","path","date"]}).order("date","DESC"))),o=await o,e(),o).data,l=C(()=>r.value?.[0]||null),P=C(()=>r.value?.[1]||null);return Z({meta:[{name:"description",content:n.value?.description||""},{name:"keywords",content:at(n.value?.tags)?.join(",")||""}]}),(A,y)=>{const b=V,v=dt,m=_t,_=xt,h=et;return d(),H(h,{title:c(n)?.title},{AfterMain:L(()=>[u("aside",null,[$(_,{body:c(n)?.body},null,8,["body"])])]),default:L(()=>[c(n)?(d(),H(b,{key:0,value:c(n),tag:"article",class:"markdown-body"},null,8,["value"])):x("",!0),$(v,{prevPost:c(l),nextPost:c(P)},null,8,["prevPost","nextPost"]),y[0]||(y[0]=u("hr",null,null,-1)),$(m)]),_:1},8,["title"])}}}),Tt=O(Pt,[["__scopeId","data-v-483530c4"]]);export{Tt as default};

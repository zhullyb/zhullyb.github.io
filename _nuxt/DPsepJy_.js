import{_ as Z}from"./l3yPu17A.js";import{l as L,S as se,U as he,I as W,V as me,W as ve,X as pe,A as B,Y as ae,Z as ye,$ as oe,i as ge,k as p,E as be,a0 as De,a1 as Q,a2 as we,a3 as Ce,a4 as Se,a5 as Ee,a6 as Me,H as $e,f as F,c as b,o as y,a as d,F as q,r as Y,e as K,w as G,d as ee,t as I,_ as A,j as H,n as Te,B as te,C as xe,b as V,p as Oe,a7 as Pe,a8 as re,a9 as Ie,aa as ke,ab as Le,g as ie,q as Be,u as Ve,P as X}from"./D1HYyIOk.js";const Ne={trailing:!0};function Re(e,t=25,s={}){if(s={...Ne,...s},!Number.isFinite(t))throw new TypeError("Expected `wait` to be a finite number");let o,a,u=[],c,n;const T=(m,x)=>(c=Fe(e,m,x),c.finally(()=>{if(c=null,s.trailing&&n&&!a){const w=T(m,n);return n=null,w}}),c),E=function(...m){return s.trailing&&(n=m),c||new Promise(x=>{const w=!a&&s.leading;clearTimeout(a),a=setTimeout(()=>{a=null;const f=s.leading?o:T(this,m);n=null;for(const v of u)v(f);u=[]},t),w?(o=T(this,m),x(o)):u.push(x)})},l=m=>{m&&(clearTimeout(m),a=null)};return E.isPending=()=>!!a,E.cancel=()=>{l(a),u=[],n=null},E.flush=()=>{if(l(a),!n||c)return;const m=n;return n=null,T(this,m)},E}async function Fe(e,t,s){return await e.apply(t,s)}function ce(...e){const t=typeof e[e.length-1]=="string"?e.pop():void 0;le(e[0],e[1])&&e.unshift(t);let[s,o,a={}]=e,u=!1;const c=L(()=>ve(s));if(typeof c.value!="string")throw new TypeError("[nuxt] [useAsyncData] key must be a string.");if(typeof o!="function")throw new TypeError("[nuxt] [useAsyncData] handler must be a function.");const n=se();a.server??=!0,a.default??=He,a.getCachedData??=de,a.lazy??=!1,a.immediate??=!0,a.deep??=he.deep,a.dedupe??="cancel",a._functionName,n._asyncData[c.value];function T(){const f={cause:"initial",dedupe:a.dedupe};return n._asyncData[c.value]?._init||(f.cachedData=a.getCachedData(c.value,n,{cause:"initial"}),n._asyncData[c.value]=ne(n,c.value,o,a,f.cachedData)),()=>n._asyncData[c.value].execute(f)}const E=T(),l=n._asyncData[c.value];l._deps++;const m=a.server!==!1&&n.payload.serverRendered;{let f=function(h){const S=n._asyncData[h];S?._deps&&(S._deps--,S._deps===0&&S?._off())};const v=be();if(v&&m&&a.immediate&&!v.sp&&(v.sp=[]),v&&!v._nuxtOnBeforeMountCbs){v._nuxtOnBeforeMountCbs=[];const h=v._nuxtOnBeforeMountCbs;De(()=>{h.forEach(S=>{S()}),h.splice(0,h.length)}),Q(()=>h.splice(0,h.length))}const C=v&&(v._nuxtClientOnly||we(Ce,!1));m&&n.isHydrating&&(l.error.value||l.data.value!==void 0)?l.status.value=l.error.value?"error":"success":v&&(!C&&n.payload.serverRendered&&n.isHydrating||a.lazy)&&a.immediate?v._nuxtOnBeforeMountCbs.push(E):a.immediate&&l.status.value!=="success"&&E();const M=pe(),O=W(c,(h,S)=>{if((h||S)&&h!==S){u=!0;const z=n._asyncData[S]?.data.value!==void 0,r=n._asyncDataPromises[S]!==void 0,_={cause:"initial",dedupe:a.dedupe};if(!n._asyncData[h]?._init){let $;S&&z?$=n._asyncData[S].data.value:($=a.getCachedData(h,n,{cause:"initial"}),_.cachedData=$),n._asyncData[h]=ne(n,h,o,a,$)}n._asyncData[h]._deps++,S&&f(S),(a.immediate||z||r)&&n._asyncData[h].execute(_),Se(()=>{u=!1})}},{flush:"sync"}),k=a.watch?W(a.watch,()=>{u||l._execute({cause:"watch",dedupe:a.dedupe})}):()=>{};M&&me(()=>{O(),k(),f(c.value)})}const x={data:U(()=>n._asyncData[c.value]?.data),pending:U(()=>n._asyncData[c.value]?.pending),status:U(()=>n._asyncData[c.value]?.status),error:U(()=>n._asyncData[c.value]?.error),refresh:(...f)=>n._asyncData[c.value]?._init?n._asyncData[c.value].execute(...f):T()(),execute:(...f)=>x.refresh(...f),clear:()=>{const f=n._asyncData[c.value];if(f?._abortController)try{f._abortController.abort(new DOMException("AsyncData aborted by user.","AbortError"))}finally{f._abortController=void 0}ue(n,c.value)}},w=Promise.resolve(n._asyncDataPromises[c.value]).then(()=>x);return Object.assign(w,x),w}function U(e){return L({get(){return e()?.value},set(t){const s=e();s&&(s.value=t)}})}function Ae(...e){const t=typeof e[e.length-1]=="string"?e.pop():void 0;le(e[0],e[1])&&e.unshift(t);const[s,o,a={}]=e;return ce(s,o,{...a,lazy:!0},null)}function le(e,t){return!(typeof e=="string"||typeof e=="object"&&e!==null||typeof e=="function"&&typeof t=="function")}function ue(e,t){t in e.payload.data&&(e.payload.data[t]=void 0),t in e.payload._errors&&(e.payload._errors[t]=void 0),e._asyncData[t]&&(e._asyncData[t].data.value=p(e._asyncData[t]._default()),e._asyncData[t].error.value=void 0,e._asyncData[t].status.value="idle"),t in e._asyncDataPromises&&(e._asyncDataPromises[t]=void 0)}function je(e,t){const s={};for(const o of t)s[o]=e[o];return s}function ne(e,t,s,o,a){e.payload._errors[t]??=void 0;const u=o.getCachedData!==de,c=s,n=o.deep?B:ae,T=a!==void 0,E=e.hook("app:data:refresh",async m=>{(!m||m.includes(t))&&await l.execute({cause:"refresh:hook"})}),l={data:n(T?a:o.default()),pending:L(()=>l.status.value==="pending"),error:ye(e.payload._errors,t),status:ae("idle"),execute:(...m)=>{const[x,w=void 0]=m,f=x&&w===void 0&&typeof x=="object"?x:{};if(e._asyncDataPromises[t]&&(f.dedupe??o.dedupe)==="defer")return e._asyncDataPromises[t];{const C="cachedData"in f?f.cachedData:o.getCachedData(t,e,{cause:f.cause??"refresh:manual"});if(C!==void 0)return e.payload.data[t]=l.data.value=C,l.error.value=void 0,l.status.value="success",Promise.resolve(C)}l._abortController&&l._abortController.abort(new DOMException("AsyncData request cancelled by deduplication","AbortError")),l._abortController=new AbortController,l.status.value="pending";const v=new Promise((C,M)=>{try{const O=f.timeout??o.timeout,k=qe([l._abortController?.signal,f?.signal],O);if(k.aborted){const h=k.reason;M(h instanceof Error?h:new DOMException(String(h??"Aborted"),"AbortError"));return}return k.addEventListener("abort",()=>{const h=k.reason;M(h instanceof Error?h:new DOMException(String(h??"Aborted"),"AbortError"))},{once:!0}),Promise.resolve(c(e,{signal:k})).then(C,M)}catch(O){M(O)}}).then(async C=>{let M=C;o.transform&&(M=await o.transform(C)),o.pick&&(M=je(M,o.pick)),e.payload.data[t]=M,l.data.value=M,l.error.value=void 0,l.status.value="success"}).catch(C=>{if(!(e._asyncDataPromises[t]&&e._asyncDataPromises[t]!==v)&&!l._abortController?.signal.aborted){if(typeof DOMException<"u"&&C instanceof DOMException&&C.name==="AbortError"){l.status.value="idle";return}l.error.value=ge(C),l.data.value=p(o.default()),l.status.value="error"}}).finally(()=>{delete e._asyncDataPromises[t]});return e._asyncDataPromises[t]=v,e._asyncDataPromises[t]},_execute:Re((...m)=>l.execute(...m),0,{leading:!0}),_default:o.default,_deps:0,_init:!0,_hash:void 0,_off:()=>{E(),e._asyncData[t]?._init&&(e._asyncData[t]._init=!1),u||oe(()=>{e._asyncData[t]?._init||(ue(e,t),l.execute=()=>Promise.resolve())})}};return l}const He=()=>{},de=(e,t,s)=>{if(t.isHydrating)return t.payload.data[e];if(s.cause!=="refresh:manual"&&s.cause!=="refresh:hook")return t.static.data[e]};function qe(e,t){const s=e.filter(u=>!!u);if(typeof t=="number"&&t>=0){const u=AbortSignal.timeout?.(t);u&&s.push(u)}if(AbortSignal.any)return AbortSignal.any(s);const o=new AbortController;for(const u of s)if(u.aborted){const c=u.reason??new DOMException("Aborted","AbortError");try{o.abort(c)}catch{o.abort()}return o.signal}const a=()=>{const c=s.find(n=>n.aborted)?.reason??new DOMException("Aborted","AbortError");try{o.abort(c)}catch{o.abort()}};for(const u of s)u.addEventListener?.("abort",a,{once:!0});return o.signal}function ze(){return globalThis.$fetch}const Ue={nuxt:{}},We=Ee(Me,Ue);function fe(){const e=se();return e._appConfig||=$e(We),e._appConfig}const Ye={class:"pc-nav"},Ge={class:"container"},Je=F({__name:"HeaderNav",props:{navItems:{}},emits:["toggle"],setup(e,{emit:t}){const s=t,o=a=>{s("toggle",a)};return(a,u)=>{const c=Z;return y(),b("nav",null,[d("div",Ye,[(y(!0),b(q,null,Y(e.navItems,n=>(y(),K(c,{key:n.link,to:n.link},{default:G(()=>[ee(I(n.text),1)]),_:2},1032,["to"]))),128))]),d("div",{class:"mobile-nav",onClick:o},[d("div",Ge,[(y(),b(q,null,Y(3,n=>d("div",{class:"mobile-nav-item",key:n})),64))])])])}}}),Xe=Object.assign(A(Je,[["__scopeId","data-v-f0d77200"]]),{__name:"HeaderNav"}),Ze={class:"mask"},Qe={class:"title-container"},Ke={class:"title"},et={key:0},tt=F({__name:"Banner",props:{bannerImg:{},title:{},slogan:{}},setup(e){const t=e,s=L(()=>({background:`url(${t.bannerImg}) center center / cover no-repeat`}));return(o,a)=>(y(),b("div",{class:"banner",style:Te(p(s))},[d("div",Ze,[d("div",Qe,[d("div",Ke,[d("h1",null,I(e.title),1),e.slogan?(y(),b("p",et,I(e.slogan),1)):H("",!0)])])])],4))}}),at=Object.assign(A(tt,[["__scopeId","data-v-e76cd4ff"]]),{__name:"Banner"}),nt={class:"search-overlay__panel"},st={class:"search-overlay__header"},ot={key:0,class:"search-overlay__state"},rt={key:1,class:"search-overlay__body"},it={key:0,class:"search-overlay__state"},ct={key:1,class:"search-overlay__state"},lt={key:2,class:"search-overlay__count"},ut={key:3,class:"search-overlay__list"},dt={class:"search-overlay__item-title"},ft={class:"search-overlay__item-meta"},_t={key:0},ht={class:"search-overlay__item-snippet"},mt=50,vt=F({__name:"SearchOverlay",props:{modelValue:{type:Boolean}},emits:["update:modelValue"],setup(e,{emit:t}){const s=e,o=t,a=B(""),u=B(null),c=ze(),n=B(!1),T=async()=>{const r=await c("/search/sections.json");if(Array.isArray(r))return r;if(typeof r=="string")try{return JSON.parse(r)}catch(_){console.warn("[search] Failed to parse sections payload",_)}return[]},{data:E,pending:l,refresh:m}=Ae("posts-search-sections",T,{server:!1,immediate:!1,default:()=>[]}),x=L(()=>E.value??[]),w=L(()=>{const r=a.value.trim().toLowerCase();if(!r)return[];const _=Array.from(new Set(r.split(/\s+/).filter(Boolean)));if(!_.length)return[];const $=x.value.map(i=>{const g=(i.content??"").replace(/\s+/g," ").trim();if(!g)return null;const N=C(i),j=M(i),J=`${N} ${j} ${g}`.toLowerCase();if(!_.every(P=>J.includes(P)))return null;let R=0;return _.forEach(P=>{N.toLowerCase().includes(P)?R+=4:j.toLowerCase().includes(P)?R+=3:R+=1}),{id:i.id,baseId:O(i.id),documentTitle:N,sectionTitle:j,snippet:S(g,_),score:R}}).filter(i=>!!i).sort((i,g)=>g.score-i.score);if(!$.length)return[];const D=new Map;return $.forEach(i=>{const g=D.get(i.baseId);if(!g){D.set(i.baseId,{id:i.id,baseId:i.baseId,documentTitle:i.documentTitle,sectionTitles:i.sectionTitle?[i.sectionTitle]:[],snippets:[i.snippet],score:i.score,matchCount:1,bestScore:i.score});return}g.matchCount+=1,g.score+=i.score,g.snippets.push(i.snippet),i.sectionTitle&&!g.sectionTitles.includes(i.sectionTitle)&&g.sectionTitles.length<3&&g.sectionTitles.push(i.sectionTitle),i.score>g.bestScore&&(g.bestScore=i.score,g.id=i.id)}),Array.from(D.values()).map(i=>({id:i.id,documentTitle:i.documentTitle,sectionLabel:h(i.sectionTitles,i.matchCount),snippet:k(i.snippets),score:i.score,matchCount:i.matchCount})).sort((i,g)=>g.score-i.score).slice(0,mt)}),f=r=>{s.modelValue&&r.key==="Escape"&&(r.preventDefault(),v())};W(()=>s.modelValue,r=>{r?(n.value||(n.value=!0,m()),document.body.style.setProperty("overflow","hidden"),oe(()=>{a.value="",u.value?.focus()})):document.body.style.removeProperty("overflow")}),te(()=>{window.addEventListener("keydown",f)}),xe(()=>{window.removeEventListener("keydown",f),document.body.style.removeProperty("overflow")});function v(){o("update:modelValue",!1)}function C(r){return r.titles?.[0]??r.title??"未命名文章"}function M(r){return r.titles?.length?r.titles.slice(1).filter(Boolean).at(-1)??r.title??"":r.title??""}function O(r){const _=r.indexOf("#");return _===-1?r:r.slice(0,_)}function k(r){const _=[];if(r.forEach(D=>{const i=D.trim();i&&(_.includes(i)||_.push(i))}),!_.length)return"";const $=_.slice(0,2).join(" … ");return $.length>240?`${$.slice(0,240)}…`:$}function h(r,_){return _?_===1?r[0]??"":r.length?`涉及段落：${r.join("、")}${_>r.length?"…":""}`:"":""}function S(r,_){if(!r)return"";const $=r.toLowerCase(),D=_.map(P=>$.indexOf(P)).filter(P=>P>=0).sort((P,_e)=>P-_e)[0];if(D===void 0)return z(r);const i=60,g=Math.max(0,D-i),N=Math.min(r.length,D+i),j=r.slice(g,N),J=g>0?"…":"",R=N<r.length?"…":"";return`${J}${j}${R}`}function z(r){return r.length>140?`${r.slice(0,140)}…`:r}return(r,_)=>{const $=Z;return y(),K(Le,{to:"body"},[V(ke,{name:"search-overlay"},{default:G(()=>[e.modelValue?(y(),b("div",{key:0,class:"search-overlay",role:"dialog","aria-modal":"true",onMousedown:Oe(v,["self"])},[d("div",nt,[d("div",st,[Pe(d("input",{ref_key:"inputRef",ref:u,type:"search","onUpdate:modelValue":_[0]||(_[0]=D=>re(a)?a.value=D:null),class:"search-overlay__input",placeholder:"搜索文章，支持多个关键词"},null,512),[[Ie,p(a)]]),d("button",{class:"search-overlay__close",type:"button",onClick:v,"aria-label":"关闭搜索"}," × ")]),p(l)?(y(),b("div",ot,"正在准备索引…")):(y(),b("div",rt,[p(a).trim()?p(w).length?(y(),b("div",lt," 共找到 "+I(p(w).length)+" 条结果 ",1)):(y(),b("p",ct," 没有找到匹配内容，换个关键词试试？ ")):(y(),b("p",it," 输入关键词开始搜索。 ")),p(w).length?(y(),b("ul",ut,[(y(!0),b(q,null,Y(p(w),D=>(y(),b("li",{key:D.id,class:"search-overlay__item"},[V($,{to:D.id,class:"search-overlay__link",onClick:v},{default:G(()=>[d("h3",dt,I(D.documentTitle),1),d("p",ft,[ee(" 共 "+I(D.matchCount)+" 处匹配 ",1),D.sectionLabel?(y(),b("span",_t," · "+I(D.sectionLabel),1)):H("",!0)]),d("p",ht,I(D.snippet),1)]),_:2},1032,["to"])]))),128))])):H("",!0)]))])],32)):H("",!0)]),_:1})])}}}),pt=Object.assign(A(vt,[["__scopeId","data-v-62b29045"]]),{__name:"SearchOverlay"});function yt(){const e=B(!1);let t=!1;const s=()=>{t||(window.requestAnimationFrame(()=>{e.value=window.scrollY>0,t=!1}),t=!0)};return te(()=>{s(),window.addEventListener("scroll",s)}),Q(()=>{window.removeEventListener("scroll",s)}),{isScrolled:e}}function gt(){const e=B(!1),t=o=>{o.stopPropagation(),e.value=!e.value},s=()=>{e.value=!1};return te(()=>{document.addEventListener("click",s)}),Q(()=>{document.removeEventListener("click",s)}),{showMobileMenu:e,toggleMobileMenu:t,closeMobileMenu:s}}const bt={class:"header-container"},Dt={class:"header"},wt={href:"/",class:"header-title"},Ct={class:"header-right"},St={key:0,class:"mobile-menu-dropdown"},Et=F({__name:"Header",props:{bannerImg:{},title:{default:""}},setup(e){const t=fe(),s=ie(),o=L(()=>s.path==="/"||s.path.startsWith("/page/")?t.slogan:null),a=e,u=L(()=>a.title||t.title),{isScrolled:c}=yt(),{showMobileMenu:n,toggleMobileMenu:T,closeMobileMenu:E}=gt(),l=B(!1),m=()=>{E(),l.value=!0};return W(()=>s.fullPath,()=>{l.value=!1}),(x,w)=>{const f=Xe,v=Z,C=at,M=pt;return y(),b(q,null,[d("header",{class:Be({scrolled:p(c),"show-mobile-menu":p(n)})},[d("div",bt,[d("div",Dt,[d("a",wt,I(p(t).title),1),d("div",Ct,[V(f,{"nav-items":p(t).nav.items,onToggle:p(T)},null,8,["nav-items","onToggle"]),d("button",{type:"button",class:"search-trigger",onClick:m,"aria-label":"搜索文章"},[...w[1]||(w[1]=[d("span",{"aria-hidden":"true"},"🔍",-1),d("span",{class:"search-trigger__label"},"搜索",-1)])])])])]),p(n)?(y(),b("div",St,[(y(!0),b(q,null,Y(p(t).nav.items,O=>(y(),K(v,{key:O.link,to:O.link,onClick:p(E)},{default:G(()=>[ee(I(O.text),1)]),_:2},1032,["to","onClick"]))),128))])):H("",!0)],2),V(C,{"banner-img":e.bannerImg,title:p(u),slogan:p(o)},null,8,["banner-img","title","slogan"]),V(M,{modelValue:p(l),"onUpdate:modelValue":w[0]||(w[0]=O=>re(l)?l.value=O:null)},null,8,["modelValue"])],64)}}}),Mt=Object.assign(A(Et,[["__scopeId","data-v-995e7b74"]]),{__name:"Header"}),$t=F({__name:"Footer",props:{bannerImg:{}},setup(e){const s={background:`url(${e.bannerImg}) center bottom / cover no-repeat`,minHeight:"120px",color:"white"};return(o,a)=>(y(),b("footer",{style:s},[...a[0]||(a[0]=[d("div",{class:"footer-mask"},null,-1),d("div",{class:"footer-content"},"©2020 - 2025 By zhullyb",-1)])]))}}),Tt=Object.assign(A($t,[["__scopeId","data-v-3e1fa960"]]),{__name:"Footer"}),xt={class:"content-wrapper"},Ot={class:"before-main side"},Pt={class:"after-main side"},It=F({__name:"DefaultLayout",props:{title:{default:""}},setup(e){const t=ie(),s=e,o=fe(),{data:a}=ce("randomIndex"+t.path,async()=>Math.floor(Math.random()*o.imgs.length),"$RRY2fi8_v6"),u=L(()=>o.imgs[a.value??0]);return Ve({title:s.title||o.title,link:[{rel:"preload",as:"image",href:u.value,fetchpriority:"high"}]}),(c,n)=>{const T=Mt,E=Tt;return y(),b("div",null,[V(T,{"banner-img":p(u),title:e.title},null,8,["banner-img","title"]),d("div",xt,[d("div",Ot,[X(c.$slots,"BeforeMain",{},void 0,!0)]),d("main",null,[X(c.$slots,"default",{},void 0,!0)]),d("div",Pt,[X(c.$slots,"AfterMain",{},void 0,!0)])]),V(E,{"banner-img":p(u)},null,8,["banner-img"])])}}}),Bt=Object.assign(A(It,[["__scopeId","data-v-03b6b78b"]]),{__name:"DefaultLayout"});export{Bt as _,ce as u};

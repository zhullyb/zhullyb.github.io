[{"data":1,"prerenderedAt":8652},["ShallowReactive",2],{"randomIndex/archives/page/2/":3,"index-page-2-en":4,"language-switch-/en/archives/page/2/-zh":8651,"posts-nums-total-en":1144},3,[5,566,2522,3916,4789,5468,6196,6544,8031,8323],{"title":6,"date":7,"path":8,"tags":9,"body":16},"How DNS Resolution Latency Destroyed My Image Hosting Optimization","2025-08-11 00:06:40","/2025/08/11/dns-resolve-time-destroyed-my-optimization-for-pic-cdn",[10,11,12,13,14,15],"CDN","Image Hosting","DNS","Network","Cloudflare","Dnspod",{"type":17,"value":18,"toc":550},"minimark",[19,28,35,41,50,55,66,70,78,202,209,216,220,223,228,235,274,277,281,287,291,302,347,385,388,411,415,418,422,447,451,457,461,464,468,471,515,519,528,535,538,546],[20,21,22,23,27],"p",{},"Last summer, I spent considerable time setting up an image hosting solution for my blog. The core goal was ",[24,25,26],"strong",{},"geo-distributed DNS resolution"," to ensure fast image loading for visitors both inside and outside China. The technical approach seemed perfect—until recently, when fellow bloggers reported slow image loading on first visits. That's when I discovered the real problem.",[20,29,30],{},[31,32],"img",{"alt":33,"src":34},"","https://static.031130.xyz/uploads/2025/08/11/26306b2a483ba.webp",[20,36,37,40],{},[24,38,39],{},"955 milliseconds of DNS resolution time!"," This number shocked me. After visitors opened my blog, they had to wait nearly a full second just to determine the image server location—completely negating the benefits of CDN optimization.",[42,43,44],"blockquote",{},[20,45,46,49],{},[24,47,48],{},"Context Note:"," In China, there's a significant network divide between domestic and international internet access due to the Great Firewall. Many Chinese websites use geo-DNS to serve domestic users from servers within China and international users from overseas servers, optimizing for both speed and accessibility.",[51,52,54],"h2",{"id":53},"why-didnt-i-notice-earlier","Why Didn't I Notice Earlier?",[20,56,57,58,61,62,65],{},"The main culprit was ",[24,59,60],{},"DNS caching",". It remembers resolution results for subsequent visits, making both my local tests and return visitor tests appear normal. It wasn't until users reported issues—combined with my recent review of DNS resolution flows for job interview prep (recursive queries, authoritative queries, root domains, TLDs, etc.)—that I pinpointed the problem: ",[24,63,64],{},"first-visit DNS resolution latency",".",[51,67,69],{"id":68},"dns-resolution-flow-analysis","DNS Resolution Flow Analysis",[20,71,72,73,77],{},"Let's examine what happens when a visitor accesses ",[74,75,76],"code",{},"static.031130.xyz",":",[79,80,84],"pre",{"className":81,"code":82,"language":83,"meta":33,"style":33},"language-mermaid shiki shiki-themes one-light one-dark-pro","sequenceDiagram\n    participant User as Visitor Browser\n    participant Local as Local DNS\n    participant CF as Cloudflare\u003Cbr/>(Foreign Authority)\n    participant DP as DNSPod\u003Cbr/>(Domestic Authority)\n    participant CDN as CDN Node\n\n    User->>Local: Request static.031130.xyz\n    Local->>CF: Query 031130.xyz authority\n    Note over Local,CF: Cross-border query, high latency\n    CF->>Local: CNAME: cdn-cname.zhul.in\n    Local->>DP: Query zhul.in authority\n    DP->>Local: CNAME: small-storage-cdn.b0.aicdn.com\n    Local->>DP: Query aicdn.com\n    DP->>Local: CNAME: nm.aicdn.com\n    Local->>DP: Query final IP\n    DP->>Local: Return CDN IP\n    Local->>User: Return resolution result\n    User->>CDN: Connect and download images\n","mermaid",[74,85,86,94,100,105,111,117,123,130,136,142,148,154,160,166,172,178,184,190,196],{"__ignoreMap":33},[87,88,91],"span",{"class":89,"line":90},"line",1,[87,92,93],{},"sequenceDiagram\n",[87,95,97],{"class":89,"line":96},2,[87,98,99],{},"    participant User as Visitor Browser\n",[87,101,102],{"class":89,"line":3},[87,103,104],{},"    participant Local as Local DNS\n",[87,106,108],{"class":89,"line":107},4,[87,109,110],{},"    participant CF as Cloudflare\u003Cbr/>(Foreign Authority)\n",[87,112,114],{"class":89,"line":113},5,[87,115,116],{},"    participant DP as DNSPod\u003Cbr/>(Domestic Authority)\n",[87,118,120],{"class":89,"line":119},6,[87,121,122],{},"    participant CDN as CDN Node\n",[87,124,126],{"class":89,"line":125},7,[87,127,129],{"emptyLinePlaceholder":128},true,"\n",[87,131,133],{"class":89,"line":132},8,[87,134,135],{},"    User->>Local: Request static.031130.xyz\n",[87,137,139],{"class":89,"line":138},9,[87,140,141],{},"    Local->>CF: Query 031130.xyz authority\n",[87,143,145],{"class":89,"line":144},10,[87,146,147],{},"    Note over Local,CF: Cross-border query, high latency\n",[87,149,151],{"class":89,"line":150},11,[87,152,153],{},"    CF->>Local: CNAME: cdn-cname.zhul.in\n",[87,155,157],{"class":89,"line":156},12,[87,158,159],{},"    Local->>DP: Query zhul.in authority\n",[87,161,163],{"class":89,"line":162},13,[87,164,165],{},"    DP->>Local: CNAME: small-storage-cdn.b0.aicdn.com\n",[87,167,169],{"class":89,"line":168},14,[87,170,171],{},"    Local->>DP: Query aicdn.com\n",[87,173,175],{"class":89,"line":174},15,[87,176,177],{},"    DP->>Local: CNAME: nm.aicdn.com\n",[87,179,181],{"class":89,"line":180},16,[87,182,183],{},"    Local->>DP: Query final IP\n",[87,185,187],{"class":89,"line":186},17,[87,188,189],{},"    DP->>Local: Return CDN IP\n",[87,191,193],{"class":89,"line":192},18,[87,194,195],{},"    Local->>User: Return resolution result\n",[87,197,199],{"class":89,"line":198},19,[87,200,201],{},"    User->>CDN: Connect and download images\n",[20,203,204,205,208],{},"Here's the problem: ",[24,206,207],{},"the first two query steps point to Cloudflare's authoritative servers overseas",". For domestic Chinese users, even though the final resolved CDN node is within China, the cross-border DNS queries are enough to cripple the first-visit experience. That 955ms latency is mostly spent communicating with foreign DNS servers.",[42,210,211],{},[20,212,213,215],{},[24,214,48],{}," DNSPod is Tencent's DNS service provider, widely used in China for its domestic infrastructure and reliability.",[51,217,219],{"id":218},"optimization-solutions","Optimization Solutions",[20,221,222],{},"To address this issue, I implemented three measures:",[224,225,227],"h3",{"id":226},"_1-dns-prefetch","1. DNS Prefetch",[20,229,230,231,234],{},"Added to the blog's HTML ",[74,232,233],{},"\u003Chead>"," section:",[79,236,240],{"className":237,"code":238,"language":239,"meta":33,"style":33},"language-html shiki shiki-themes one-light one-dark-pro","\u003Clink rel=\"dns-prefetch\" href=\"//static.031130.xyz\">\n","html",[74,241,242],{"__ignoreMap":33},[87,243,244,248,252,256,259,263,266,268,271],{"class":89,"line":90},[87,245,247],{"class":246},"s5ixo","\u003C",[87,249,251],{"class":250},"sJa8x","link",[87,253,255],{"class":254},"sAGMh"," rel",[87,257,258],{"class":246},"=",[87,260,262],{"class":261},"sDhpE","\"dns-prefetch\"",[87,264,265],{"class":254}," href",[87,267,258],{"class":246},[87,269,270],{"class":261},"\"//static.031130.xyz\"",[87,272,273],{"class":246},">\n",[20,275,276],{},"This way, the browser performs DNS resolution for the image hosting domain while rendering the page. By the time images actually need to load, the DNS results may already be ready.",[224,278,280],{"id":279},"_2-extended-ttl","2. Extended TTL",[20,282,283,284,286],{},"Increased the TTL (Time To Live) value for the ",[74,285,76],{}," CNAME record from a few minutes to several hours or even a day. This allows local DNS servers to cache results longer, enabling subsequent users to directly use cached results and skip authoritative queries.",[224,288,290],{"id":289},"_3-migrate-authoritative-dns-core-solution","3. Migrate Authoritative DNS (Core Solution)",[20,292,293,294,297,298,301],{},"Migrated the ",[24,295,296],{},"authoritative DNS servers"," for the ",[74,299,300],{},"031130.xyz"," domain from Cloudflare to DNSPod in China:",[79,303,305],{"className":81,"code":304,"language":83,"meta":33,"style":33},"graph TB\n    subgraph \"Before Optimization\"\n        A1[Visitor] --> B1[Local DNS]\n        B1 --> C1[Cloudflare Authority\u003Cbr/>Overseas]\n        C1 --> D1[DNSPod Authority\u003Cbr/>Domestic]\n        D1 --> E1[CDN Node]\n        style C1 fill:#ffcccc\n    end\n",[74,306,307,312,317,322,327,332,337,342],{"__ignoreMap":33},[87,308,309],{"class":89,"line":90},[87,310,311],{},"graph TB\n",[87,313,314],{"class":89,"line":96},[87,315,316],{},"    subgraph \"Before Optimization\"\n",[87,318,319],{"class":89,"line":3},[87,320,321],{},"        A1[Visitor] --> B1[Local DNS]\n",[87,323,324],{"class":89,"line":107},[87,325,326],{},"        B1 --> C1[Cloudflare Authority\u003Cbr/>Overseas]\n",[87,328,329],{"class":89,"line":113},[87,330,331],{},"        C1 --> D1[DNSPod Authority\u003Cbr/>Domestic]\n",[87,333,334],{"class":89,"line":119},[87,335,336],{},"        D1 --> E1[CDN Node]\n",[87,338,339],{"class":89,"line":125},[87,340,341],{},"        style C1 fill:#ffcccc\n",[87,343,344],{"class":89,"line":132},[87,345,346],{},"    end\n",[79,348,350],{"className":81,"code":349,"language":83,"meta":33,"style":33},"graph TB\n    subgraph \"After Optimization\"\n        A2[Visitor] --> B2[Local DNS]\n        B2 --> D2[DNSPod Authority\u003Cbr/>Domestic]\n        D2 --> E2[CDN Node]\n        style D2 fill:#ccffcc\n    end\n",[74,351,352,356,361,366,371,376,381],{"__ignoreMap":33},[87,353,354],{"class":89,"line":90},[87,355,311],{},[87,357,358],{"class":89,"line":96},[87,359,360],{},"    subgraph \"After Optimization\"\n",[87,362,363],{"class":89,"line":3},[87,364,365],{},"        A2[Visitor] --> B2[Local DNS]\n",[87,367,368],{"class":89,"line":107},[87,369,370],{},"        B2 --> D2[DNSPod Authority\u003Cbr/>Domestic]\n",[87,372,373],{"class":89,"line":113},[87,374,375],{},"        D2 --> E2[CDN Node]\n",[87,377,378],{"class":89,"line":119},[87,379,380],{},"        style D2 fill:#ccffcc\n",[87,382,383],{"class":89,"line":125},[87,384,346],{},[20,386,387],{},"Benefits after migration:",[389,390,391,398,408],"ul",{},[392,393,394,395,397],"li",{},"When recursive DNS queries ",[74,396,300],{},", it directly reaches DNSPod in China with fast response",[392,399,400,401,403,404,407],{},"DNSPod directly returns ",[74,402,76],{}," -> ",[74,405,406],{},"small-storage-cdn.b0.aicdn.com"," without intermediate hops",[392,409,410],{},"The entire DNS resolution chain completes domestically, dramatically reducing first-visit latency",[51,412,414],{"id":413},"optimization-results","Optimization Results",[20,416,417],{},"While DNS caching makes testing difficult, after migrating the authoritative DNS + adjusting TTL + adding prefetch, first-visit DNS resolution time dropped to an acceptable range.",[51,419,421],{"id":420},"lessons-learned","Lessons Learned",[423,424,425,431,441],"ol",{},[392,426,427,430],{},[24,428,429],{},"DNS Location Matters",": When optimizing for multiple regions, the geographic location of authoritative DNS servers significantly impacts first-visit latency. Prioritize using domestic authoritative servers for your target audience.",[392,432,433,436,437,440],{},[24,434,435],{},"First Visits Are Critical",": While caching helps subsequent visits, the first-visit experience directly affects user impression. Make good use of ",[74,438,439],{},"dns-prefetch"," and reasonable TTL settings.",[392,442,443,446],{},[24,444,445],{},"Monitoring and Feedback Are Important",": Local test environments often benefit from caching; real first-visit experiences need to be discovered through monitoring and user feedback.",[51,448,450],{"id":449},"important-warning-beware-of-cname-flattening","Important Warning: Beware of CNAME Flattening",[20,452,453,454,65],{},"If you need geo-distributed resolution to connect visitors to the nearest CDN node, ",[24,455,456],{},"absolutely avoid CNAME Flattening",[224,458,460],{"id":459},"what-is-cname-flattening","What Is CNAME Flattening?",[20,462,463],{},"When an authoritative DNS server (like Cloudflare) sees a CNAME record, it proactively queries the final IP address of the target domain and then directly returns the IP instead of the CNAME.",[224,465,467],{"id":466},"why-does-this-cause-problems","Why Does This Cause Problems?",[20,469,470],{},"Geo-distributed resolution (GeoDNS) is implemented at the authoritative DNS server level. When the authoritative server performs CNAME flattening, it queries the target domain's IP from its own location. If the authoritative DNS is in the US, it gets the optimal US node IP, then returns this IP to all regional queries, including Chinese users. This completely breaks your domestic CDN IP strategy configured for Chinese users.",[79,472,474],{"className":81,"code":473,"language":83,"meta":33,"style":33},"graph LR\n    subgraph \"CNAME Flattening Problem\"\n        A[Chinese User] --> B[Cloudflare Authority\u003Cbr/>US Node]\n        B --> C[Query Target CNAME]\n        C --> D[Return US CDN IP]\n        D --> A\n        style D fill:#ffcccc\n    end\n",[74,475,476,481,486,491,496,501,506,511],{"__ignoreMap":33},[87,477,478],{"class":89,"line":90},[87,479,480],{},"graph LR\n",[87,482,483],{"class":89,"line":96},[87,484,485],{},"    subgraph \"CNAME Flattening Problem\"\n",[87,487,488],{"class":89,"line":3},[87,489,490],{},"        A[Chinese User] --> B[Cloudflare Authority\u003Cbr/>US Node]\n",[87,492,493],{"class":89,"line":107},[87,494,495],{},"        B --> C[Query Target CNAME]\n",[87,497,498],{"class":89,"line":113},[87,499,500],{},"        C --> D[Return US CDN IP]\n",[87,502,503],{"class":89,"line":119},[87,504,505],{},"        D --> A\n",[87,507,508],{"class":89,"line":125},[87,509,510],{},"        style D fill:#ffcccc\n",[87,512,513],{"class":89,"line":132},[87,514,346],{},[224,516,518],{"id":517},"the-correct-approach","The Correct Approach",[20,520,521,522,403,524,527],{},"Honestly use CNAME to point to another domain that supports GeoDNS (such as ",[74,523,76],{},[74,525,526],{},"cdn-cname.zhul.in",", with the latter doing geo-distributed resolution on DNSPod). Only this way can you ensure the routing strategy executes correctly.",[20,529,530,531,534],{},"If you need geo-distributed resolution functionality, ",[24,532,533],{},"do not"," enable CNAME Flattening (or similar features like ALIAS, ANAME, etc.) on related domains.",[536,537],"hr",{},[42,539,540],{},[20,541,542,545],{},[24,543,544],{},"Author's Note:"," This article reflects the unique challenges of optimizing web services for the Chinese internet landscape, where the network infrastructure divide between domestic and international access requires careful DNS and CDN configuration to provide optimal performance for all users.",[547,548,549],"style",{},"html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html pre.shiki code .sJa8x, html code.shiki .sJa8x{--shiki-default:#E45649;--shiki-dark:#E06C75}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}",{"title":33,"searchDepth":96,"depth":96,"links":551},[552,553,554,559,560,561],{"id":53,"depth":96,"text":54},{"id":68,"depth":96,"text":69},{"id":218,"depth":96,"text":219,"children":555},[556,557,558],{"id":226,"depth":3,"text":227},{"id":279,"depth":3,"text":280},{"id":289,"depth":3,"text":290},{"id":413,"depth":96,"text":414},{"id":420,"depth":96,"text":421},{"id":449,"depth":96,"text":450,"children":562},[563,564,565],{"id":459,"depth":3,"text":460},{"id":466,"depth":3,"text":467},{"id":517,"depth":3,"text":518},{"title":567,"date":568,"path":569,"tags":570,"body":577},"Vue Markdown Rendering Optimization in Practice (Part 2): Farewell to DOM Manipulation, Embrace AST and Functional Rendering","2025-07-13 00:01:35","/2025/07/13/vue-markdown-render-improvement-2",[571,572,573,574,575,576],"Vue.js","Markdown","AST","JavaScript","Web","unified",{"type":17,"value":578,"toc":2509},[579,587,603,606,609,612,623,633,637,646,663,673,676,691,695,716,719,723,733,763,767,770,792,795,974,977,1227,1231,1238,1250,1253,1895,1899,1906,2240,2243,2357,2361,2364,2469,2473,2476,2500,2503,2506],[51,580,582,583,586],{"id":581},"recap-when-morphdom-meets-vue","Recap: When ",[74,584,585],{},"morphdom"," Meets Vue",[20,588,589,590,595,596,599,600,602],{},"In ",[591,592,594],"a",{"href":593},"/2025/07/12/vue-markdown-render-improvement-1/","the previous article",", we embarked on a performance optimization journey for Markdown rendering. From the most primitive full refresh with ",[74,597,598],{},"v-html",", to block-by-block updates, we eventually brought out the \"ultimate weapon\" - ",[74,601,585],{},". By directly comparing and manipulating the real DOM, it updates the view with minimal cost, perfectly solving the performance bottleneck and interaction state loss issues in real-time rendering.",[20,604,605],{},"However, a fundamental problem has always existed: in Vue's territory, bypassing Vue's Virtual DOM and Diff algorithm to let a third-party library directly \"operate\" on the real DOM always feels somewhat \"unorthodox.\" It's like introducing an old master with a hammer and wrench for manual repairs in a precision automated factory. Although the job is done well, it always feels like it disrupts the original workflow and isn't \"Vue\" enough.",[20,607,608],{},"So, is there a more elegant, more \"native\" approach that allows us to enjoy precise updates while fully integrating with Vue's ecosystem?",[20,610,611],{},"With this question in mind, I consulted friends in frontend development groups.",[42,613,614],{},[20,615,616,617],{},"If you're building a renderer, your approach isn't the best practice. Each time you update, you generate the full virtual HTML, then optimize performance by subtracting from the HTML. However, the incremental part of each update is clear - why not directly use this incremental part for addition? The incremental part cannot be directly obtained through markdown-it, but a better approach is to transform at this step: first parse the Markdown structure, then use Vue's dynamic rendering capabilities to generate the DOM. This way, DOM reuse can leverage Vue's own abilities. — ",[591,618,622],{"href":619,"rel":620},"https://site.j10c.cc/",[621],"nofollow","j10c",[42,624,625],{},[20,626,627,628],{},"You can use unified with the remark-parse plugin to parse markdown strings into AST, then render based on the AST using render functions. — bii & ",[591,629,632],{"href":630,"rel":631},"https://github.com/nekomeowww",[621],"nekomeowww",[51,634,636],{"id":635},"new-approach-from-string-conversion-to-structured-rendering","New Approach: From \"String Conversion\" to \"Structured Rendering\"",[20,638,639,640,642,643,645],{},"Our previous solutions, whether ",[74,641,598],{}," or ",[74,644,585],{},", shared a core approach:",[20,647,648,403,651,403,654,403,657,403,660],{},[74,649,650],{},"Markdown String",[74,652,653],{},"markdown-it",[74,655,656],{},"HTML String",[74,658,659],{},"Browser/morphdom",[74,661,662],{},"DOM",[20,664,665,666,668,669,672],{},"The problem with this pipeline is that starting from the ",[74,667,656],{}," step, we lose the ",[24,670,671],{},"original structural information"," of Markdown. We get a bunch of unstructured text that Vue cannot understand its internal logic and can only swallow it whole.",[20,674,675],{},"The new approach transforms the process into:",[20,677,678,403,680,403,683,403,686,403,689],{},[74,679,650],{},[74,681,682],{},"AST (Abstract Syntax Tree)",[74,684,685],{},"Vue VNodes (Virtual Nodes)",[74,687,688],{},"Vue",[74,690,662],{},[224,692,694],{"id":693},"what-is-ast","What is AST?",[20,696,697,699,700,703,704,707,708,711,712,715],{},[24,698,682],{}," is a structured representation of source code or markup language. It parses a long string of text into a hierarchical tree-like object. For Markdown, a level-1 heading becomes a node with ",[74,701,702],{},"type: 'heading', depth: 1",", a paragraph becomes a node with ",[74,705,706],{},"type: 'paragraph'",", and the text within the paragraph becomes the ",[74,709,710],{},"children"," of the ",[74,713,714],{},"paragraph"," node.",[20,717,718],{},"Once we convert Markdown into an AST, we essentially have a \"structural blueprint\" of the entire document. We're no longer facing a pile of ambiguous HTML strings, but rather a clear, programmable JavaScript object.",[224,720,722],{"id":721},"our-new-tools-unified-and-remark","Our New Tools: unified and remark",[20,724,725,726,729,730,732],{},"To implement the ",[74,727,728],{},"Markdown -> AST"," conversion, we introduce the ",[74,731,576],{}," ecosystem.",[389,734,735,744],{},[392,736,737,743],{},[24,738,739],{},[591,740,576],{"href":741,"rel":742},"https://github.com/unifiedjs/unified",[621],": A powerful content processing engine. Think of it as an assembly line where raw text is the raw material, and you process it through parsing, transformation, and serialization by adding different \"plugins.\"",[392,745,746,753,754,756,757,762],{},[24,747,748],{},[591,749,752],{"href":750,"rel":751},"https://github.com/remarkjs/remark",[621],"remark-parse",": A ",[74,755,576],{}," plugin specifically responsible for parsing Markdown text into AST (specifically in ",[591,758,761],{"href":759,"rel":760},"https://github.com/syntax-tree/mdast",[621],"mdast"," format).",[51,764,766],{"id":765},"step-1-parse-markdown-into-ast","Step 1: Parse Markdown into AST",[20,768,769],{},"First, we need to install the dependencies:",[79,771,775],{"className":772,"code":773,"language":774,"meta":33,"style":33},"language-bash shiki shiki-themes one-light one-dark-pro","npm install unified remark-parse\n","bash",[74,776,777],{"__ignoreMap":33},[87,778,779,783,786,789],{"class":89,"line":90},[87,780,782],{"class":781},"sAdtL","npm",[87,784,785],{"class":261}," install",[87,787,788],{"class":261}," unified",[87,790,791],{"class":261}," remark-parse\n",[20,793,794],{},"Then, we can easily convert a Markdown string into an AST:",[79,796,800],{"className":797,"code":798,"language":799,"meta":33,"style":33},"language-javascript shiki shiki-themes one-light one-dark-pro","import { unified } from 'unified'\nimport remarkParse from 'remark-parse'\n\nconst markdownContent = '# Hello, AST!\\n\\nThis is a paragraph.'\n\n// Create a processor instance\nconst processor = unified().use(remarkParse)\n\n// Parse Markdown content\nconst ast = processor.parse(markdownContent)\n\nconsole.log(JSON.stringify(ast, null, 2))\n","javascript",[74,801,802,822,835,839,861,865,871,898,902,907,931,935],{"__ignoreMap":33},[87,803,804,808,811,813,816,819],{"class":89,"line":90},[87,805,807],{"class":806},"sLKXg","import",[87,809,810],{"class":246}," { ",[87,812,576],{"class":250},[87,814,815],{"class":246}," } ",[87,817,818],{"class":806},"from",[87,820,821],{"class":261}," 'unified'\n",[87,823,824,826,829,832],{"class":89,"line":96},[87,825,807],{"class":806},[87,827,828],{"class":250}," remarkParse",[87,830,831],{"class":806}," from",[87,833,834],{"class":261}," 'remark-parse'\n",[87,836,837],{"class":89,"line":3},[87,838,129],{"emptyLinePlaceholder":128},[87,840,841,844,848,852,855,858],{"class":89,"line":107},[87,842,843],{"class":806},"const",[87,845,847],{"class":846},"sNmU0"," markdownContent",[87,849,851],{"class":850},"s_Sar"," =",[87,853,854],{"class":261}," '# Hello, AST!",[87,856,857],{"class":850},"\\n\\n",[87,859,860],{"class":261},"This is a paragraph.'\n",[87,862,863],{"class":89,"line":113},[87,864,129],{"emptyLinePlaceholder":128},[87,866,867],{"class":89,"line":119},[87,868,870],{"class":869},"sW2Sy","// Create a processor instance\n",[87,872,873,875,878,880,882,885,888,891,895],{"class":89,"line":125},[87,874,843],{"class":806},[87,876,877],{"class":846}," processor",[87,879,851],{"class":850},[87,881,788],{"class":781},[87,883,884],{"class":246},"().",[87,886,887],{"class":781},"use",[87,889,890],{"class":246},"(",[87,892,894],{"class":893},"sz0mV","remarkParse",[87,896,897],{"class":246},")\n",[87,899,900],{"class":89,"line":132},[87,901,129],{"emptyLinePlaceholder":128},[87,903,904],{"class":89,"line":138},[87,905,906],{"class":869},"// Parse Markdown content\n",[87,908,909,911,914,916,919,921,924,926,929],{"class":89,"line":144},[87,910,843],{"class":806},[87,912,913],{"class":846}," ast",[87,915,851],{"class":850},[87,917,877],{"class":918},"s7GmK",[87,920,65],{"class":246},[87,922,923],{"class":781},"parse",[87,925,890],{"class":246},[87,927,928],{"class":893},"markdownContent",[87,930,897],{"class":246},[87,932,933],{"class":89,"line":150},[87,934,129],{"emptyLinePlaceholder":128},[87,936,937,940,942,945,947,950,952,955,957,960,963,966,968,971],{"class":89,"line":156},[87,938,939],{"class":918},"console",[87,941,65],{"class":246},[87,943,944],{"class":781},"log",[87,946,890],{"class":246},[87,948,949],{"class":846},"JSON",[87,951,65],{"class":246},[87,953,954],{"class":781},"stringify",[87,956,890],{"class":246},[87,958,959],{"class":893},"ast",[87,961,962],{"class":246},", ",[87,964,965],{"class":254},"null",[87,967,962],{"class":246},[87,969,970],{"class":254},"2",[87,972,973],{"class":246},"))\n",[20,975,976],{},"Running the above code will give us a JSON object like the following, which is our coveted AST:",[79,978,982],{"className":979,"code":980,"language":981,"meta":33,"style":33},"language-json shiki shiki-themes one-light one-dark-pro","{\n  \"type\": \"root\",\n  \"children\": [\n    {\n      \"type\": \"heading\",\n      \"depth\": 1,\n      \"children\": [\n        {\n          \"type\": \"text\",\n          \"value\": \"Hello, AST!\",\n          \"position\": { ... }\n        }\n      ],\n      \"position\": { ... }\n    },\n    {\n      \"type\": \"paragraph\",\n      \"children\": [\n        {\n          \"type\": \"text\",\n          \"value\": \"This is a paragraph.\",\n          \"position\": { ... }\n        }\n      ],\n      \"position\": { ... }\n    }\n  ],\n  \"position\": { ... }\n}\n","json",[74,983,984,989,1003,1011,1016,1028,1040,1047,1052,1064,1076,1091,1096,1101,1112,1117,1121,1132,1138,1142,1153,1165,1176,1181,1186,1197,1203,1209,1221],{"__ignoreMap":33},[87,985,986],{"class":89,"line":90},[87,987,988],{"class":246},"{\n",[87,990,991,994,997,1000],{"class":89,"line":96},[87,992,993],{"class":250},"  \"type\"",[87,995,996],{"class":246},": ",[87,998,999],{"class":261},"\"root\"",[87,1001,1002],{"class":246},",\n",[87,1004,1005,1008],{"class":89,"line":3},[87,1006,1007],{"class":250},"  \"children\"",[87,1009,1010],{"class":246},": [\n",[87,1012,1013],{"class":89,"line":107},[87,1014,1015],{"class":246},"    {\n",[87,1017,1018,1021,1023,1026],{"class":89,"line":113},[87,1019,1020],{"class":250},"      \"type\"",[87,1022,996],{"class":246},[87,1024,1025],{"class":261},"\"heading\"",[87,1027,1002],{"class":246},[87,1029,1030,1033,1035,1038],{"class":89,"line":119},[87,1031,1032],{"class":250},"      \"depth\"",[87,1034,996],{"class":246},[87,1036,1037],{"class":254},"1",[87,1039,1002],{"class":246},[87,1041,1042,1045],{"class":89,"line":125},[87,1043,1044],{"class":250},"      \"children\"",[87,1046,1010],{"class":246},[87,1048,1049],{"class":89,"line":132},[87,1050,1051],{"class":246},"        {\n",[87,1053,1054,1057,1059,1062],{"class":89,"line":138},[87,1055,1056],{"class":250},"          \"type\"",[87,1058,996],{"class":246},[87,1060,1061],{"class":261},"\"text\"",[87,1063,1002],{"class":246},[87,1065,1066,1069,1071,1074],{"class":89,"line":144},[87,1067,1068],{"class":250},"          \"value\"",[87,1070,996],{"class":246},[87,1072,1073],{"class":261},"\"Hello, AST!\"",[87,1075,1002],{"class":246},[87,1077,1078,1081,1084,1088],{"class":89,"line":150},[87,1079,1080],{"class":250},"          \"position\"",[87,1082,1083],{"class":246},": { ",[87,1085,1087],{"class":1086},"sUNH4","...",[87,1089,1090],{"class":246}," }\n",[87,1092,1093],{"class":89,"line":156},[87,1094,1095],{"class":246},"        }\n",[87,1097,1098],{"class":89,"line":162},[87,1099,1100],{"class":246},"      ],\n",[87,1102,1103,1106,1108,1110],{"class":89,"line":168},[87,1104,1105],{"class":250},"      \"position\"",[87,1107,1083],{"class":246},[87,1109,1087],{"class":1086},[87,1111,1090],{"class":246},[87,1113,1114],{"class":89,"line":174},[87,1115,1116],{"class":246},"    },\n",[87,1118,1119],{"class":89,"line":180},[87,1120,1015],{"class":246},[87,1122,1123,1125,1127,1130],{"class":89,"line":186},[87,1124,1020],{"class":250},[87,1126,996],{"class":246},[87,1128,1129],{"class":261},"\"paragraph\"",[87,1131,1002],{"class":246},[87,1133,1134,1136],{"class":89,"line":192},[87,1135,1044],{"class":250},[87,1137,1010],{"class":246},[87,1139,1140],{"class":89,"line":198},[87,1141,1051],{"class":246},[87,1143,1145,1147,1149,1151],{"class":89,"line":1144},20,[87,1146,1056],{"class":250},[87,1148,996],{"class":246},[87,1150,1061],{"class":261},[87,1152,1002],{"class":246},[87,1154,1156,1158,1160,1163],{"class":89,"line":1155},21,[87,1157,1068],{"class":250},[87,1159,996],{"class":246},[87,1161,1162],{"class":261},"\"This is a paragraph.\"",[87,1164,1002],{"class":246},[87,1166,1168,1170,1172,1174],{"class":89,"line":1167},22,[87,1169,1080],{"class":250},[87,1171,1083],{"class":246},[87,1173,1087],{"class":1086},[87,1175,1090],{"class":246},[87,1177,1179],{"class":89,"line":1178},23,[87,1180,1095],{"class":246},[87,1182,1184],{"class":89,"line":1183},24,[87,1185,1100],{"class":246},[87,1187,1189,1191,1193,1195],{"class":89,"line":1188},25,[87,1190,1105],{"class":250},[87,1192,1083],{"class":246},[87,1194,1087],{"class":1086},[87,1196,1090],{"class":246},[87,1198,1200],{"class":89,"line":1199},26,[87,1201,1202],{"class":246},"    }\n",[87,1204,1206],{"class":89,"line":1205},27,[87,1207,1208],{"class":246},"  ],\n",[87,1210,1212,1215,1217,1219],{"class":89,"line":1211},28,[87,1213,1214],{"class":250},"  \"position\"",[87,1216,1083],{"class":246},[87,1218,1087],{"class":1086},[87,1220,1090],{"class":246},[87,1222,1224],{"class":89,"line":1223},29,[87,1225,1226],{"class":246},"}\n",[51,1228,1230],{"id":1229},"step-2-from-ast-to-vue-vnodes","Step 2: From AST to Vue VNodes",[20,1232,1233,1234,1237],{},"Having obtained the AST, the next step is to actually \"construct\" this \"structural blueprint\" into a user-visible interface. In Vue's world, the blueprint for describing UI is the Virtual Node (VNode), and the ",[74,1235,1236],{},"h()"," function (i.e., hyperscript) is the brush for creating VNodes.",[20,1239,1240,1241,962,1244,962,1246,1249],{},"Our task is to write a render function that can recursively traverse the AST and generate corresponding VNodes for each node type (",[74,1242,1243],{},"heading",[74,1245,714],{},[74,1247,1248],{},"text",", etc.).",[20,1251,1252],{},"Here's a simple render function implementation:",[79,1254,1256],{"className":797,"code":1255,"language":799,"meta":33,"style":33},"function renderAst(node) {\n  if (!node) return null\n  switch (node.type) {\n    case 'root':\n      return h('div', {}, node.children.map(renderAst))\n    case 'paragraph':\n      return h('p', {}, node.children.map(renderAst))\n    case 'text':\n      return node.value\n    case 'emphasis':\n      return h('em', {}, node.children.map(renderAst))\n    case 'strong':\n      return h('strong', {}, node.children.map(renderAst))\n    case 'inlineCode':\n      return h('code', {}, node.value)\n    case 'heading':\n      return h('h' + node.depth, {}, node.children.map(renderAst))\n    case 'code':\n      return h('pre', {}, [h('code', {}, node.value)])\n    case 'list':\n      return h(node.ordered ? 'ol' : 'ul', {}, node.children.map(renderAst))\n    case 'listItem':\n      return h('li', {}, node.children.map(renderAst))\n    case 'thematicBreak':\n      return h('hr')\n    case 'blockquote':\n      return h('blockquote', {}, node.children.map(renderAst))\n    case 'link':\n      return h('a', { href: node.url, target: '_blank' }, node.children.map(renderAst))\n    default:\n      // Other unimplemented types\n      return h('span', { }, `[${node.type}]`)\n  }\n}\n",[74,1257,1258,1275,1297,1313,1324,1359,1368,1397,1406,1418,1427,1456,1465,1494,1503,1525,1534,1573,1582,1615,1624,1670,1679,1708,1717,1730,1739,1768,1777,1833,1841,1847,1884,1890],{"__ignoreMap":33},[87,1259,1260,1263,1266,1268,1272],{"class":89,"line":90},[87,1261,1262],{"class":806},"function",[87,1264,1265],{"class":781}," renderAst",[87,1267,890],{"class":246},[87,1269,1271],{"class":1270},"s8iYz","node",[87,1273,1274],{"class":246},") {\n",[87,1276,1277,1280,1283,1286,1288,1291,1294],{"class":89,"line":96},[87,1278,1279],{"class":806},"  if",[87,1281,1282],{"class":246}," (",[87,1284,1285],{"class":850},"!",[87,1287,1271],{"class":893},[87,1289,1290],{"class":246},") ",[87,1292,1293],{"class":806},"return",[87,1295,1296],{"class":254}," null\n",[87,1298,1299,1302,1304,1306,1308,1311],{"class":89,"line":3},[87,1300,1301],{"class":806},"  switch",[87,1303,1282],{"class":246},[87,1305,1271],{"class":918},[87,1307,65],{"class":246},[87,1309,1310],{"class":250},"type",[87,1312,1274],{"class":246},[87,1314,1315,1318,1321],{"class":89,"line":107},[87,1316,1317],{"class":806},"    case",[87,1319,1320],{"class":261}," 'root'",[87,1322,1323],{"class":246},":\n",[87,1325,1326,1329,1332,1334,1337,1340,1342,1344,1347,1349,1352,1354,1357],{"class":89,"line":113},[87,1327,1328],{"class":806},"      return",[87,1330,1331],{"class":781}," h",[87,1333,890],{"class":246},[87,1335,1336],{"class":261},"'div'",[87,1338,1339],{"class":246},", {}, ",[87,1341,1271],{"class":918},[87,1343,65],{"class":246},[87,1345,710],{"class":1346},"s2QsP",[87,1348,65],{"class":246},[87,1350,1351],{"class":781},"map",[87,1353,890],{"class":246},[87,1355,1356],{"class":893},"renderAst",[87,1358,973],{"class":246},[87,1360,1361,1363,1366],{"class":89,"line":119},[87,1362,1317],{"class":806},[87,1364,1365],{"class":261}," 'paragraph'",[87,1367,1323],{"class":246},[87,1369,1370,1372,1374,1376,1379,1381,1383,1385,1387,1389,1391,1393,1395],{"class":89,"line":125},[87,1371,1328],{"class":806},[87,1373,1331],{"class":781},[87,1375,890],{"class":246},[87,1377,1378],{"class":261},"'p'",[87,1380,1339],{"class":246},[87,1382,1271],{"class":918},[87,1384,65],{"class":246},[87,1386,710],{"class":1346},[87,1388,65],{"class":246},[87,1390,1351],{"class":781},[87,1392,890],{"class":246},[87,1394,1356],{"class":893},[87,1396,973],{"class":246},[87,1398,1399,1401,1404],{"class":89,"line":132},[87,1400,1317],{"class":806},[87,1402,1403],{"class":261}," 'text'",[87,1405,1323],{"class":246},[87,1407,1408,1410,1413,1415],{"class":89,"line":138},[87,1409,1328],{"class":806},[87,1411,1412],{"class":918}," node",[87,1414,65],{"class":246},[87,1416,1417],{"class":250},"value\n",[87,1419,1420,1422,1425],{"class":89,"line":144},[87,1421,1317],{"class":806},[87,1423,1424],{"class":261}," 'emphasis'",[87,1426,1323],{"class":246},[87,1428,1429,1431,1433,1435,1438,1440,1442,1444,1446,1448,1450,1452,1454],{"class":89,"line":150},[87,1430,1328],{"class":806},[87,1432,1331],{"class":781},[87,1434,890],{"class":246},[87,1436,1437],{"class":261},"'em'",[87,1439,1339],{"class":246},[87,1441,1271],{"class":918},[87,1443,65],{"class":246},[87,1445,710],{"class":1346},[87,1447,65],{"class":246},[87,1449,1351],{"class":781},[87,1451,890],{"class":246},[87,1453,1356],{"class":893},[87,1455,973],{"class":246},[87,1457,1458,1460,1463],{"class":89,"line":156},[87,1459,1317],{"class":806},[87,1461,1462],{"class":261}," 'strong'",[87,1464,1323],{"class":246},[87,1466,1467,1469,1471,1473,1476,1478,1480,1482,1484,1486,1488,1490,1492],{"class":89,"line":162},[87,1468,1328],{"class":806},[87,1470,1331],{"class":781},[87,1472,890],{"class":246},[87,1474,1475],{"class":261},"'strong'",[87,1477,1339],{"class":246},[87,1479,1271],{"class":918},[87,1481,65],{"class":246},[87,1483,710],{"class":1346},[87,1485,65],{"class":246},[87,1487,1351],{"class":781},[87,1489,890],{"class":246},[87,1491,1356],{"class":893},[87,1493,973],{"class":246},[87,1495,1496,1498,1501],{"class":89,"line":168},[87,1497,1317],{"class":806},[87,1499,1500],{"class":261}," 'inlineCode'",[87,1502,1323],{"class":246},[87,1504,1505,1507,1509,1511,1514,1516,1518,1520,1523],{"class":89,"line":174},[87,1506,1328],{"class":806},[87,1508,1331],{"class":781},[87,1510,890],{"class":246},[87,1512,1513],{"class":261},"'code'",[87,1515,1339],{"class":246},[87,1517,1271],{"class":918},[87,1519,65],{"class":246},[87,1521,1522],{"class":250},"value",[87,1524,897],{"class":246},[87,1526,1527,1529,1532],{"class":89,"line":180},[87,1528,1317],{"class":806},[87,1530,1531],{"class":261}," 'heading'",[87,1533,1323],{"class":246},[87,1535,1536,1538,1540,1542,1545,1548,1550,1552,1555,1557,1559,1561,1563,1565,1567,1569,1571],{"class":89,"line":186},[87,1537,1328],{"class":806},[87,1539,1331],{"class":781},[87,1541,890],{"class":246},[87,1543,1544],{"class":261},"'h'",[87,1546,1547],{"class":850}," +",[87,1549,1412],{"class":918},[87,1551,65],{"class":246},[87,1553,1554],{"class":250},"depth",[87,1556,1339],{"class":246},[87,1558,1271],{"class":918},[87,1560,65],{"class":246},[87,1562,710],{"class":1346},[87,1564,65],{"class":246},[87,1566,1351],{"class":781},[87,1568,890],{"class":246},[87,1570,1356],{"class":893},[87,1572,973],{"class":246},[87,1574,1575,1577,1580],{"class":89,"line":192},[87,1576,1317],{"class":806},[87,1578,1579],{"class":261}," 'code'",[87,1581,1323],{"class":246},[87,1583,1584,1586,1588,1590,1593,1596,1599,1601,1603,1605,1607,1609,1612],{"class":89,"line":198},[87,1585,1328],{"class":806},[87,1587,1331],{"class":781},[87,1589,890],{"class":246},[87,1591,1592],{"class":261},"'pre'",[87,1594,1595],{"class":246},", {}, [",[87,1597,1598],{"class":781},"h",[87,1600,890],{"class":246},[87,1602,1513],{"class":261},[87,1604,1339],{"class":246},[87,1606,1271],{"class":918},[87,1608,65],{"class":246},[87,1610,1522],{"class":1611},"sj4iG",[87,1613,1614],{"class":246},")])\n",[87,1616,1617,1619,1622],{"class":89,"line":1144},[87,1618,1317],{"class":806},[87,1620,1621],{"class":261}," 'list'",[87,1623,1323],{"class":246},[87,1625,1626,1628,1630,1632,1634,1636,1639,1643,1646,1649,1652,1654,1656,1658,1660,1662,1664,1666,1668],{"class":89,"line":1155},[87,1627,1328],{"class":806},[87,1629,1331],{"class":781},[87,1631,890],{"class":246},[87,1633,1271],{"class":918},[87,1635,65],{"class":246},[87,1637,1638],{"class":250},"ordered",[87,1640,1642],{"class":1641},"s7DPa"," ?",[87,1644,1645],{"class":261}," 'ol'",[87,1647,1648],{"class":1641}," :",[87,1650,1651],{"class":261}," 'ul'",[87,1653,1339],{"class":246},[87,1655,1271],{"class":918},[87,1657,65],{"class":246},[87,1659,710],{"class":1346},[87,1661,65],{"class":246},[87,1663,1351],{"class":781},[87,1665,890],{"class":246},[87,1667,1356],{"class":893},[87,1669,973],{"class":246},[87,1671,1672,1674,1677],{"class":89,"line":1167},[87,1673,1317],{"class":806},[87,1675,1676],{"class":261}," 'listItem'",[87,1678,1323],{"class":246},[87,1680,1681,1683,1685,1687,1690,1692,1694,1696,1698,1700,1702,1704,1706],{"class":89,"line":1178},[87,1682,1328],{"class":806},[87,1684,1331],{"class":781},[87,1686,890],{"class":246},[87,1688,1689],{"class":261},"'li'",[87,1691,1339],{"class":246},[87,1693,1271],{"class":918},[87,1695,65],{"class":246},[87,1697,710],{"class":1346},[87,1699,65],{"class":246},[87,1701,1351],{"class":781},[87,1703,890],{"class":246},[87,1705,1356],{"class":893},[87,1707,973],{"class":246},[87,1709,1710,1712,1715],{"class":89,"line":1183},[87,1711,1317],{"class":806},[87,1713,1714],{"class":261}," 'thematicBreak'",[87,1716,1323],{"class":246},[87,1718,1719,1721,1723,1725,1728],{"class":89,"line":1188},[87,1720,1328],{"class":806},[87,1722,1331],{"class":781},[87,1724,890],{"class":246},[87,1726,1727],{"class":261},"'hr'",[87,1729,897],{"class":246},[87,1731,1732,1734,1737],{"class":89,"line":1199},[87,1733,1317],{"class":806},[87,1735,1736],{"class":261}," 'blockquote'",[87,1738,1323],{"class":246},[87,1740,1741,1743,1745,1747,1750,1752,1754,1756,1758,1760,1762,1764,1766],{"class":89,"line":1205},[87,1742,1328],{"class":806},[87,1744,1331],{"class":781},[87,1746,890],{"class":246},[87,1748,1749],{"class":261},"'blockquote'",[87,1751,1339],{"class":246},[87,1753,1271],{"class":918},[87,1755,65],{"class":246},[87,1757,710],{"class":1346},[87,1759,65],{"class":246},[87,1761,1351],{"class":781},[87,1763,890],{"class":246},[87,1765,1356],{"class":893},[87,1767,973],{"class":246},[87,1769,1770,1772,1775],{"class":89,"line":1211},[87,1771,1317],{"class":806},[87,1773,1774],{"class":261}," 'link'",[87,1776,1323],{"class":246},[87,1778,1779,1781,1783,1785,1788,1791,1794,1797,1799,1801,1804,1806,1809,1811,1814,1817,1819,1821,1823,1825,1827,1829,1831],{"class":89,"line":1223},[87,1780,1328],{"class":806},[87,1782,1331],{"class":781},[87,1784,890],{"class":246},[87,1786,1787],{"class":261},"'a'",[87,1789,1790],{"class":246},", { ",[87,1792,1793],{"class":250},"href",[87,1795,77],{"class":1796},"st7oF",[87,1798,1412],{"class":918},[87,1800,65],{"class":246},[87,1802,1803],{"class":250},"url",[87,1805,962],{"class":246},[87,1807,1808],{"class":250},"target",[87,1810,77],{"class":1796},[87,1812,1813],{"class":261}," '_blank'",[87,1815,1816],{"class":246}," }, ",[87,1818,1271],{"class":918},[87,1820,65],{"class":246},[87,1822,710],{"class":1346},[87,1824,65],{"class":246},[87,1826,1351],{"class":781},[87,1828,890],{"class":246},[87,1830,1356],{"class":893},[87,1832,973],{"class":246},[87,1834,1836,1839],{"class":89,"line":1835},30,[87,1837,1838],{"class":806},"    default",[87,1840,1323],{"class":246},[87,1842,1844],{"class":89,"line":1843},31,[87,1845,1846],{"class":869},"      // Other unimplemented types\n",[87,1848,1850,1852,1854,1856,1859,1862,1865,1869,1871,1874,1876,1879,1882],{"class":89,"line":1849},32,[87,1851,1328],{"class":806},[87,1853,1331],{"class":781},[87,1855,890],{"class":246},[87,1857,1858],{"class":261},"'span'",[87,1860,1861],{"class":246},", { }, ",[87,1863,1864],{"class":261},"`[",[87,1866,1868],{"class":1867},"sAOjX","${",[87,1870,1271],{"class":918},[87,1872,65],{"class":1873},"sMj0N",[87,1875,1310],{"class":250},[87,1877,1878],{"class":1867},"}",[87,1880,1881],{"class":261},"]`",[87,1883,897],{"class":246},[87,1885,1887],{"class":89,"line":1886},33,[87,1888,1889],{"class":246},"  }\n",[87,1891,1893],{"class":89,"line":1892},34,[87,1894,1226],{"class":246},[51,1896,1898],{"id":1897},"step-3-encapsulate-vue-component","Step 3: Encapsulate Vue Component",[20,1900,1901,1902,1905],{},"Integrating the above logic, we can build a Vue component. Given the characteristic of directly generating VNodes, using a functional component or explicit ",[74,1903,1904],{},"render"," function is most appropriate.",[79,1907,1911],{"className":1908,"code":1909,"language":1910,"meta":33,"style":33},"language-vue shiki shiki-themes one-light one-dark-pro","\u003Ctemplate>\n  \u003Ccomponent :is=\"VNodeTree\" />\n\u003C/template>\n\n\u003Cscript setup>\nimport { computed, h, shallowRef, watchEffect } from 'vue'\nimport { unified } from 'unified'\nimport remarkParse from 'remark-parse'\n\nconst props = defineProps({\n  mdText: {\n    type: String,\n    default: ''\n  }\n})\n\nconst ast = shallowRef(null)\nconst parser = unified().use(remarkParse)\n\nwatchEffect(() => {\n  ast.value = parser.parse(props.mdText)\n})\n\n// AST render function (same as renderAst function above)\nfunction renderAst(node) { ... }\n\nconst VNodeTree = computed(() => renderAst(ast.value))\n\n\u003C/script>\n","vue",[74,1912,1913,1922,1941,1950,1954,1966,1996,2010,2020,2024,2039,2049,2061,2070,2074,2079,2083,2100,2121,2125,2137,2166,2170,2174,2179,2196,2200,2228,2232],{"__ignoreMap":33},[87,1914,1915,1917,1920],{"class":89,"line":90},[87,1916,247],{"class":246},[87,1918,1919],{"class":250},"template",[87,1921,273],{"class":246},[87,1923,1924,1927,1930,1933,1935,1938],{"class":89,"line":96},[87,1925,1926],{"class":246},"  \u003C",[87,1928,1929],{"class":250},"component",[87,1931,1932],{"class":254}," :is",[87,1934,258],{"class":246},[87,1936,1937],{"class":261},"\"VNodeTree\"",[87,1939,1940],{"class":246}," />\n",[87,1942,1943,1946,1948],{"class":89,"line":3},[87,1944,1945],{"class":246},"\u003C/",[87,1947,1919],{"class":250},[87,1949,273],{"class":246},[87,1951,1952],{"class":89,"line":107},[87,1953,129],{"emptyLinePlaceholder":128},[87,1955,1956,1958,1961,1964],{"class":89,"line":113},[87,1957,247],{"class":246},[87,1959,1960],{"class":250},"script",[87,1962,1963],{"class":254}," setup",[87,1965,273],{"class":246},[87,1967,1968,1970,1972,1975,1977,1979,1981,1984,1986,1989,1991,1993],{"class":89,"line":119},[87,1969,807],{"class":806},[87,1971,810],{"class":246},[87,1973,1974],{"class":250},"computed",[87,1976,962],{"class":246},[87,1978,1598],{"class":250},[87,1980,962],{"class":246},[87,1982,1983],{"class":250},"shallowRef",[87,1985,962],{"class":246},[87,1987,1988],{"class":250},"watchEffect",[87,1990,815],{"class":246},[87,1992,818],{"class":806},[87,1994,1995],{"class":261}," 'vue'\n",[87,1997,1998,2000,2002,2004,2006,2008],{"class":89,"line":125},[87,1999,807],{"class":806},[87,2001,810],{"class":246},[87,2003,576],{"class":250},[87,2005,815],{"class":246},[87,2007,818],{"class":806},[87,2009,821],{"class":261},[87,2011,2012,2014,2016,2018],{"class":89,"line":132},[87,2013,807],{"class":806},[87,2015,828],{"class":250},[87,2017,831],{"class":806},[87,2019,834],{"class":261},[87,2021,2022],{"class":89,"line":138},[87,2023,129],{"emptyLinePlaceholder":128},[87,2025,2026,2028,2031,2033,2036],{"class":89,"line":144},[87,2027,843],{"class":806},[87,2029,2030],{"class":846}," props",[87,2032,851],{"class":850},[87,2034,2035],{"class":781}," defineProps",[87,2037,2038],{"class":246},"({\n",[87,2040,2041,2044,2046],{"class":89,"line":150},[87,2042,2043],{"class":250},"  mdText",[87,2045,77],{"class":1796},[87,2047,2048],{"class":246}," {\n",[87,2050,2051,2054,2056,2059],{"class":89,"line":156},[87,2052,2053],{"class":250},"    type",[87,2055,77],{"class":1796},[87,2057,2058],{"class":893}," String",[87,2060,1002],{"class":246},[87,2062,2063,2065,2067],{"class":89,"line":162},[87,2064,1838],{"class":250},[87,2066,77],{"class":1796},[87,2068,2069],{"class":261}," ''\n",[87,2071,2072],{"class":89,"line":168},[87,2073,1889],{"class":246},[87,2075,2076],{"class":89,"line":174},[87,2077,2078],{"class":246},"})\n",[87,2080,2081],{"class":89,"line":180},[87,2082,129],{"emptyLinePlaceholder":128},[87,2084,2085,2087,2089,2091,2094,2096,2098],{"class":89,"line":186},[87,2086,843],{"class":806},[87,2088,913],{"class":846},[87,2090,851],{"class":850},[87,2092,2093],{"class":781}," shallowRef",[87,2095,890],{"class":246},[87,2097,965],{"class":254},[87,2099,897],{"class":246},[87,2101,2102,2104,2107,2109,2111,2113,2115,2117,2119],{"class":89,"line":192},[87,2103,843],{"class":806},[87,2105,2106],{"class":846}," parser",[87,2108,851],{"class":850},[87,2110,788],{"class":781},[87,2112,884],{"class":246},[87,2114,887],{"class":781},[87,2116,890],{"class":246},[87,2118,894],{"class":893},[87,2120,897],{"class":246},[87,2122,2123],{"class":89,"line":198},[87,2124,129],{"emptyLinePlaceholder":128},[87,2126,2127,2129,2132,2135],{"class":89,"line":1144},[87,2128,1988],{"class":781},[87,2130,2131],{"class":246},"(() ",[87,2133,2134],{"class":806},"=>",[87,2136,2048],{"class":246},[87,2138,2139,2142,2144,2146,2148,2150,2152,2154,2156,2159,2161,2164],{"class":89,"line":1155},[87,2140,2141],{"class":918},"  ast",[87,2143,65],{"class":246},[87,2145,1522],{"class":250},[87,2147,851],{"class":850},[87,2149,2106],{"class":918},[87,2151,65],{"class":246},[87,2153,923],{"class":781},[87,2155,890],{"class":246},[87,2157,2158],{"class":918},"props",[87,2160,65],{"class":246},[87,2162,2163],{"class":250},"mdText",[87,2165,897],{"class":246},[87,2167,2168],{"class":89,"line":1167},[87,2169,2078],{"class":246},[87,2171,2172],{"class":89,"line":1178},[87,2173,129],{"emptyLinePlaceholder":128},[87,2175,2176],{"class":89,"line":1183},[87,2177,2178],{"class":869},"// AST render function (same as renderAst function above)\n",[87,2180,2181,2183,2185,2187,2189,2192,2194],{"class":89,"line":1188},[87,2182,1262],{"class":806},[87,2184,1265],{"class":781},[87,2186,890],{"class":246},[87,2188,1271],{"class":1270},[87,2190,2191],{"class":246},") { ",[87,2193,1087],{"class":1796},[87,2195,1090],{"class":246},[87,2197,2198],{"class":89,"line":1199},[87,2199,129],{"emptyLinePlaceholder":128},[87,2201,2202,2204,2207,2209,2212,2214,2216,2218,2220,2222,2224,2226],{"class":89,"line":1205},[87,2203,843],{"class":806},[87,2205,2206],{"class":846}," VNodeTree",[87,2208,851],{"class":850},[87,2210,2211],{"class":781}," computed",[87,2213,2131],{"class":246},[87,2215,2134],{"class":806},[87,2217,1265],{"class":781},[87,2219,890],{"class":246},[87,2221,959],{"class":918},[87,2223,65],{"class":246},[87,2225,1522],{"class":250},[87,2227,973],{"class":246},[87,2229,2230],{"class":89,"line":1211},[87,2231,129],{"emptyLinePlaceholder":128},[87,2233,2234,2236,2238],{"class":89,"line":1223},[87,2235,1945],{"class":246},[87,2237,1960],{"class":250},[87,2239,273],{"class":246},[20,2241,2242],{},"Now it can be used like a regular component:",[79,2244,2246],{"className":1908,"code":2245,"language":1910,"meta":33,"style":33},"\u003Ctemplate>\n  \u003CMarkdownRenderer :mdText=\"markdownContent\" />\n\u003C/template>\n\n\u003Cscript setup>\nimport { ref } from 'vue'\nimport MarkdownRenderer from './MarkdownRenderer.vue'\n\nconst markdownContent = ref('# Hello Vue\\n\\nThis is rendered via AST!')\n\u003C/script>\n",[74,2247,2248,2256,2273,2281,2285,2295,2310,2322,2326,2349],{"__ignoreMap":33},[87,2249,2250,2252,2254],{"class":89,"line":90},[87,2251,247],{"class":246},[87,2253,1919],{"class":250},[87,2255,273],{"class":246},[87,2257,2258,2260,2263,2266,2268,2271],{"class":89,"line":96},[87,2259,1926],{"class":246},[87,2261,2262],{"class":250},"MarkdownRenderer",[87,2264,2265],{"class":254}," :mdText",[87,2267,258],{"class":246},[87,2269,2270],{"class":261},"\"markdownContent\"",[87,2272,1940],{"class":246},[87,2274,2275,2277,2279],{"class":89,"line":3},[87,2276,1945],{"class":246},[87,2278,1919],{"class":250},[87,2280,273],{"class":246},[87,2282,2283],{"class":89,"line":107},[87,2284,129],{"emptyLinePlaceholder":128},[87,2286,2287,2289,2291,2293],{"class":89,"line":113},[87,2288,247],{"class":246},[87,2290,1960],{"class":250},[87,2292,1963],{"class":254},[87,2294,273],{"class":246},[87,2296,2297,2299,2301,2304,2306,2308],{"class":89,"line":119},[87,2298,807],{"class":806},[87,2300,810],{"class":246},[87,2302,2303],{"class":250},"ref",[87,2305,815],{"class":246},[87,2307,818],{"class":806},[87,2309,1995],{"class":261},[87,2311,2312,2314,2317,2319],{"class":89,"line":125},[87,2313,807],{"class":806},[87,2315,2316],{"class":250}," MarkdownRenderer",[87,2318,831],{"class":806},[87,2320,2321],{"class":261}," './MarkdownRenderer.vue'\n",[87,2323,2324],{"class":89,"line":132},[87,2325,129],{"emptyLinePlaceholder":128},[87,2327,2328,2330,2332,2334,2337,2339,2342,2344,2347],{"class":89,"line":138},[87,2329,843],{"class":806},[87,2331,847],{"class":846},[87,2333,851],{"class":850},[87,2335,2336],{"class":781}," ref",[87,2338,890],{"class":246},[87,2340,2341],{"class":261},"'# Hello Vue",[87,2343,857],{"class":850},[87,2345,2346],{"class":261},"This is rendered via AST!'",[87,2348,897],{"class":246},[87,2350,2351,2353,2355],{"class":89,"line":144},[87,2352,1945],{"class":246},[87,2354,1960],{"class":250},[87,2356,273],{"class":246},[51,2358,2360],{"id":2359},"huge-advantages-of-the-ast-approach","Huge Advantages of the AST Approach",[20,2362,2363],{},"After switching to the AST track, we gained unprecedented superpowers:",[423,2365,2366,2378,2450,2463],{},[392,2367,2368,2371,2372,2374,2375,2377],{},[24,2369,2370],{},"Native Integration, Excellent Performance",": We no longer need the brute force refresh of ",[74,2373,598],{},", nor do we need \"external help\" like ",[74,2376,585],{},". All updates are handled by Vue's own Diff algorithm, which is not only highly performant but also fully aligned with Vue's design philosophy - truly \"one of our own.\"",[392,2379,2380,2383,2384],{},[24,2381,2382],{},"High Flexibility and Extensibility",": AST, as a programmable JavaScript object, provides a solid foundation for customized processing:",[389,2385,2386,2407,2429],{},[392,2387,2388,2391,2392,2395,2396,2399,2400,2403,2404,2406],{},[24,2389,2390],{},"Element Replacement",": Native elements (like ",[74,2393,2394],{},"\u003Ch2>",") can be seamlessly replaced with custom Vue components (like ",[74,2397,2398],{},"\u003CFancyHeading>","), only requiring adjustments to the corresponding ",[74,2401,2402],{},"case"," logic in the ",[74,2405,1356],{}," function.",[392,2408,2409,2412,2413,2416,2417,2420,2421,2424,2425,2428],{},[24,2410,2411],{},"Logic Injection",": Attributes like ",[74,2414,2415],{},"target=\"_blank\""," and ",[74,2418,2419],{},"rel=\"noopener noreferrer\""," can be conveniently added to external links ",[74,2422,2423],{},"\u003Ca>",", or lazy-load components can wrap images ",[74,2426,2427],{},"\u003Cimg>"," - such operations are easy to implement at the AST level.",[392,2430,2431,2434,2435,2437,2438,2441,2442,2445,2446,2449],{},[24,2432,2433],{},"Ecosystem Integration",": Fully leverage ",[74,2436,576],{},"'s rich plugin ecosystem (such as ",[74,2439,2440],{},"remark-gfm"," for GFM syntax support, ",[74,2443,2444],{},"remark-prism"," for code highlighting), only requiring the introduction of corresponding plugins in the processor chain (",[74,2447,2448],{},".use(pluginName)",").",[392,2451,2452,2455,2456,2459,2460,2462],{},[24,2453,2454],{},"Separation of Concerns",": Parsing logic (",[74,2457,2458],{},"remark","), rendering logic (",[74,2461,1356],{},"), and business logic (Vue components) are clearly separated, resulting in clearer code structure and stronger maintainability.",[392,2464,2465,2468],{},[24,2466,2467],{},"Type Safety and Predictability",": Compared to manipulating strings or raw HTML, rendering logic based on structured AST is easier to type-check and reason about.",[51,2470,2472],{"id":2471},"conclusion-evolution-from-functional-implementation-to-architectural-optimization","Conclusion: Evolution from Functional Implementation to Architectural Optimization",[20,2474,2475],{},"Reviewing the optimization journey:",[389,2477,2478,2483,2489,2494],{},[392,2479,2480,2482],{},[24,2481,598],{},": Simple implementation, but with performance and security concerns.",[392,2484,2485,2488],{},[24,2486,2487],{},"Block updates",": Alleviated some performance issues, but the solution had limitations.",[392,2490,2491,2493],{},[24,2492,585],{},": Effectively improved performance and user experience, but existed in isolation from Vue's core mechanisms.",[392,2495,2496,2499],{},[24,2497,2498],{},"AST + Functional Rendering",": Returns to Vue's native paradigm, providing an ultimate solution with excellent performance, flexibility, and maintainability.",[20,2501,2502],{},"By adopting AST, we not only solved specific technical challenges but, more importantly, achieved a paradigm shift - from result-oriented programming (HTML strings) to process and structure-oriented programming (AST). This enables us to dive deep into the essence of content, thereby achieving precise control over the rendering process.",[20,2504,2505],{},"This optimization practice from \"full refresh\" to \"structured rendering\" is not only a technical process of performance improvement but also a systematic exploration of deeply understanding modern frontend engineering thinking. The final Markdown rendering solution achieved high standards in performance, functionality, and architectural elegance.",[547,2507,2508],{},"html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html pre.shiki code .sLKXg, html code.shiki .sLKXg{--shiki-default:#A626A4;--shiki-dark:#C678DD}html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html pre.shiki code .sJa8x, html code.shiki .sJa8x{--shiki-default:#E45649;--shiki-dark:#E06C75}html pre.shiki code .sNmU0, html code.shiki .sNmU0{--shiki-default:#986801;--shiki-dark:#E5C07B}html pre.shiki code .s_Sar, html code.shiki .s_Sar{--shiki-default:#0184BC;--shiki-dark:#56B6C2}html pre.shiki code .sW2Sy, html code.shiki .sW2Sy{--shiki-default:#A0A1A7;--shiki-default-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic}html pre.shiki code .sz0mV, html code.shiki .sz0mV{--shiki-default:#383A42;--shiki-dark:#E06C75}html pre.shiki code .s7GmK, html code.shiki .s7GmK{--shiki-default:#383A42;--shiki-dark:#E5C07B}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html pre.shiki code .sUNH4, html code.shiki .sUNH4{--shiki-default:white;--shiki-dark:#FFFFFF}html pre.shiki code .s8iYz, html code.shiki .s8iYz{--shiki-default:#383A42;--shiki-default-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic}html pre.shiki code .s2QsP, html code.shiki .s2QsP{--shiki-default:#E45649;--shiki-dark:#E5C07B}html pre.shiki code .sj4iG, html code.shiki .sj4iG{--shiki-default:#C18401;--shiki-dark:#E06C75}html pre.shiki code .s7DPa, html code.shiki .s7DPa{--shiki-default:#0184BC;--shiki-dark:#C678DD}html pre.shiki code .st7oF, html code.shiki .st7oF{--shiki-default:#0184BC;--shiki-dark:#ABB2BF}html pre.shiki code .sAOjX, html code.shiki .sAOjX{--shiki-default:#CA1243;--shiki-dark:#C678DD}html pre.shiki code .sMj0N, html code.shiki .sMj0N{--shiki-default:#50A14F;--shiki-dark:#ABB2BF}",{"title":33,"searchDepth":96,"depth":96,"links":2510},[2511,2513,2517,2518,2519,2520,2521],{"id":581,"depth":96,"text":2512},"Recap: When morphdom Meets Vue",{"id":635,"depth":96,"text":636,"children":2514},[2515,2516],{"id":693,"depth":3,"text":694},{"id":721,"depth":3,"text":722},{"id":765,"depth":96,"text":766},{"id":1229,"depth":96,"text":1230},{"id":1897,"depth":96,"text":1898},{"id":2359,"depth":96,"text":2360},{"id":2471,"depth":96,"text":2472},{"title":2523,"date":2524,"path":2525,"tags":2526,"body":2528},"Vue Markdown Rendering Optimization in Practice (Part 1): From Brute Force Refresh, Chunked Updates to Morphdom's Elegant Transformation","2025-07-12 20:48:56","/2025/07/12/vue-markdown-render-improvement-1",[571,572,574,575,2527],"HTML",{"type":17,"value":2529,"toc":3905},[2530,2534,2537,2564,2568,2571,2574,2584,2587,2790,2794,2801,2818,2830,2838,2841,3393,3397,3400,3404,3412,3418,3429,3439,3442,3446,3855,3859,3862,3868,3873,3880,3884,3890,3896,3902],[51,2531,2533],{"id":2532},"background","Background",[20,2535,2536],{},"In a recent AI project I took over, I needed to implement a ChatGPT-like conversational interface. The core workflow is: the backend continuously pushes AI-generated Markdown text fragments to the frontend via SSE (Server-Sent Events) protocol. The frontend is responsible for dynamically receiving and concatenating these Markdown fragments, ultimately rendering and displaying the complete Markdown text in real-time on the user interface.",[20,2538,2539,2540,2545,2546,2551,2552,2557,2558,2563],{},"Markdown rendering isn't an uncommon requirement, especially in today's world flooded with LLM-based products. Unlike the React ecosystem, which has a popular third-party library with 14k+ stars—",[591,2541,2544],{"href":2542,"rel":2543},"https://github.com/remarkjs/react-markdown",[621],"react-markdown","—Vue doesn't seem to have an actively maintained Markdown rendering library with significant popularity (at least 2k+ stars). ",[591,2547,2550],{"href":2548,"rel":2549},"https://github.com/cloudacy/vue-markdown-render#readme",[621],"cloudacy/vue-markdown-render"," last released a year ago but has only 103 stars as of this writing; ",[591,2553,2556],{"href":2554,"rel":2555},"https://github.com/miaolz123/vue-markdown",[621],"miaolz123/vue-markdown"," has 2k stars but its last commit was 7 years ago; ",[591,2559,2562],{"href":2560,"rel":2561},"https://github.com/zhaoxuhui1122/vue-markdown",[621],"zhaoxuhui1122/vue-markdown"," is even archived.",[51,2565,2567],{"id":2566},"first-version-simple-and-brute-force-v-html","First Version: Simple and Brute Force v-html",[20,2569,2570],{},"After a quick survey, I confirmed that the Vue ecosystem indeed lacks a robust Markdown rendering library. Since there's no ready-made solution, let's build our own!",[20,2572,2573],{},"Based on most articles and LLM recommendations, we first adopted the markdown-it third-party library to convert Markdown to HTML strings, then passed it through v-html.",[20,2575,2576,2579,2580,2583],{},[24,2577,2578],{},"PS:"," We assume here that the Markdown content is trusted (e.g., generated by our own AI). If the content comes from user input, you must use libraries like ",[74,2581,2582],{},"DOMPurify"," to prevent XSS attacks and avoid \"opening a window\" in your website!",[20,2585,2586],{},"Example code:",[79,2588,2590],{"className":1908,"code":2589,"language":1910,"meta":33,"style":33},"\u003Ctemplate>\n  \u003Cdiv v-html=\"renderedHtml\">\u003C/div>\n\u003C/template>\n\n\u003Cscript setup>\nimport { computed, onMounted, ref } from 'vue';\nimport MarkdownIt from 'markdown-it';\n\nconst markdownContent = ref('');\nconst md = new MarkdownIt();\n\nconst renderedHtml = computed(() => md.render(markdownContent.value))\n\nonMounted(() => {\n  // markdownContent.value = await fetch() ...\n})\n\u003C/script>\n",[74,2591,2592,2600,2622,2630,2634,2644,2671,2685,2689,2707,2724,2728,2759,2763,2773,2778,2782],{"__ignoreMap":33},[87,2593,2594,2596,2598],{"class":89,"line":90},[87,2595,247],{"class":246},[87,2597,1919],{"class":250},[87,2599,273],{"class":246},[87,2601,2602,2604,2607,2610,2612,2615,2618,2620],{"class":89,"line":96},[87,2603,1926],{"class":246},[87,2605,2606],{"class":250},"div",[87,2608,2609],{"class":254}," v-html",[87,2611,258],{"class":246},[87,2613,2614],{"class":261},"\"renderedHtml\"",[87,2616,2617],{"class":246},">\u003C/",[87,2619,2606],{"class":250},[87,2621,273],{"class":246},[87,2623,2624,2626,2628],{"class":89,"line":3},[87,2625,1945],{"class":246},[87,2627,1919],{"class":250},[87,2629,273],{"class":246},[87,2631,2632],{"class":89,"line":107},[87,2633,129],{"emptyLinePlaceholder":128},[87,2635,2636,2638,2640,2642],{"class":89,"line":113},[87,2637,247],{"class":246},[87,2639,1960],{"class":250},[87,2641,1963],{"class":254},[87,2643,273],{"class":246},[87,2645,2646,2648,2650,2652,2654,2657,2659,2661,2663,2665,2668],{"class":89,"line":119},[87,2647,807],{"class":806},[87,2649,810],{"class":246},[87,2651,1974],{"class":250},[87,2653,962],{"class":246},[87,2655,2656],{"class":250},"onMounted",[87,2658,962],{"class":246},[87,2660,2303],{"class":250},[87,2662,815],{"class":246},[87,2664,818],{"class":806},[87,2666,2667],{"class":261}," 'vue'",[87,2669,2670],{"class":246},";\n",[87,2672,2673,2675,2678,2680,2683],{"class":89,"line":125},[87,2674,807],{"class":806},[87,2676,2677],{"class":250}," MarkdownIt",[87,2679,831],{"class":806},[87,2681,2682],{"class":261}," 'markdown-it'",[87,2684,2670],{"class":246},[87,2686,2687],{"class":89,"line":132},[87,2688,129],{"emptyLinePlaceholder":128},[87,2690,2691,2693,2695,2697,2699,2701,2704],{"class":89,"line":138},[87,2692,843],{"class":806},[87,2694,847],{"class":846},[87,2696,851],{"class":850},[87,2698,2336],{"class":781},[87,2700,890],{"class":246},[87,2702,2703],{"class":261},"''",[87,2705,2706],{"class":246},");\n",[87,2708,2709,2711,2714,2716,2719,2721],{"class":89,"line":144},[87,2710,843],{"class":806},[87,2712,2713],{"class":846}," md",[87,2715,851],{"class":850},[87,2717,2718],{"class":806}," new",[87,2720,2677],{"class":781},[87,2722,2723],{"class":246},"();\n",[87,2725,2726],{"class":89,"line":150},[87,2727,129],{"emptyLinePlaceholder":128},[87,2729,2730,2732,2735,2737,2739,2741,2743,2745,2747,2749,2751,2753,2755,2757],{"class":89,"line":156},[87,2731,843],{"class":806},[87,2733,2734],{"class":846}," renderedHtml",[87,2736,851],{"class":850},[87,2738,2211],{"class":781},[87,2740,2131],{"class":246},[87,2742,2134],{"class":806},[87,2744,2713],{"class":918},[87,2746,65],{"class":246},[87,2748,1904],{"class":781},[87,2750,890],{"class":246},[87,2752,928],{"class":918},[87,2754,65],{"class":246},[87,2756,1522],{"class":250},[87,2758,973],{"class":246},[87,2760,2761],{"class":89,"line":162},[87,2762,129],{"emptyLinePlaceholder":128},[87,2764,2765,2767,2769,2771],{"class":89,"line":168},[87,2766,2656],{"class":781},[87,2768,2131],{"class":246},[87,2770,2134],{"class":806},[87,2772,2048],{"class":246},[87,2774,2775],{"class":89,"line":174},[87,2776,2777],{"class":869},"  // markdownContent.value = await fetch() ...\n",[87,2779,2780],{"class":89,"line":180},[87,2781,2078],{"class":246},[87,2783,2784,2786,2788],{"class":89,"line":186},[87,2785,1945],{"class":246},[87,2787,1960],{"class":250},[87,2789,273],{"class":246},[51,2791,2793],{"id":2792},"evolution-chunked-updates-for-markdown","Evolution: Chunked Updates for Markdown",[20,2795,2796,2797,2800],{},"While the above approach achieves basic rendering, it has obvious flaws in real-time update scenarios: ",[24,2798,2799],{},"every time a new Markdown fragment is received, the entire document triggers a full re-render",". Even if only the last line is new content, the entire document's DOM gets completely replaced. This leads to two core problems:",[423,2802,2803,2812],{},[392,2804,2805,2808,2809,2811],{},[24,2806,2807],{},"Performance bottleneck:"," As Markdown content grows, the overhead of ",[74,2810,653],{}," parsing and DOM reconstruction increases linearly.",[392,2813,2814,2817],{},[24,2815,2816],{},"Lost interaction state:"," Full refresh wipes out the user's current operation state. Most notably, if you've selected some text, one refresh and the selection is gone!",[20,2819,2820,2821,2826,2827,2829],{},"To solve these two problems, ",[591,2822,2825],{"href":2823,"rel":2824},"https://juejin.cn/post/7480900772386734143",[621],"we found a chunked rendering solution online","—splitting Markdown by two consecutive newlines (",[74,2828,857],{},") into chunks. This way, each update only re-renders the last new chunk, while previous chunks reuse the cache. The benefits are obvious:",[389,2831,2832,2835],{},[392,2833,2834],{},"If the user has selected text in a previous chunk, the selection state won't be lost on the next update (because that chunk hasn't changed).",[392,2836,2837],{},"Fewer DOM nodes need re-rendering, naturally improving performance.",[20,2839,2840],{},"The adjusted code looks like this:",[79,2842,2844],{"className":1908,"code":2843,"language":1910,"meta":33,"style":33},"\u003Ctemplate>\n  \u003Cdiv>\n    \u003Cdiv\n      v-for=\"(block, idx) in renderedBlocks\"\n      :key=\"idx\"\n      v-html=\"block\"\n      class=\"markdown-block\"\n    >\u003C/div>\n  \u003C/div>\n\u003C/template>\n\n\u003Cscript setup>\nimport { ref, computed, watch } from 'vue'\nimport MarkdownIt from 'markdown-it'\n\nconst markdownContent = ref('')\nconst md = new MarkdownIt()\n\nconst renderedBlocks = ref([])\nconst blockCache = ref([])\n\nwatch(\n  markdownContent,\n  (newContent, oldContent) => {\n    const blocks = newContent.split(/\\n{2,}/)\n    // Only re-render the last block, reuse cache for others\n    // Handle cases where blocks decrease or increase\n    blockCache.value.length = blocks.length\n    for (let i = 0; i \u003C blocks.length; i++) {\n      // Only render the last one, or new blocks\n      if (i === blocks.length - 1 || !blockCache.value[i]) {\n        blockCache.value[i] = md.render(blocks[i] || '')\n      }\n      // Reuse other blocks directly\n    }\n    renderedBlocks.value = blockCache.value.slice()\n  },\n  { immediate: true }\n)\n\nonMounted(() => {\n  // markdownContent.value = await fetch() ...\n})\n\u003C/script>\n",[74,2845,2846,2854,2862,2870,2880,2890,2900,2910,2919,2928,2936,2940,2950,2973,2984,2988,3004,3019,3023,3037,3050,3054,3061,3068,3087,3123,3128,3133,3156,3198,3203,3248,3291,3296,3301,3306,3331,3337,3353,3358,3363,3374,3379,3384],{"__ignoreMap":33},[87,2847,2848,2850,2852],{"class":89,"line":90},[87,2849,247],{"class":246},[87,2851,1919],{"class":250},[87,2853,273],{"class":246},[87,2855,2856,2858,2860],{"class":89,"line":96},[87,2857,1926],{"class":246},[87,2859,2606],{"class":250},[87,2861,273],{"class":246},[87,2863,2864,2867],{"class":89,"line":3},[87,2865,2866],{"class":246},"    \u003C",[87,2868,2869],{"class":250},"div\n",[87,2871,2872,2875,2877],{"class":89,"line":107},[87,2873,2874],{"class":254},"      v-for",[87,2876,258],{"class":246},[87,2878,2879],{"class":261},"\"(block, idx) in renderedBlocks\"\n",[87,2881,2882,2885,2887],{"class":89,"line":113},[87,2883,2884],{"class":254},"      :key",[87,2886,258],{"class":246},[87,2888,2889],{"class":261},"\"idx\"\n",[87,2891,2892,2895,2897],{"class":89,"line":119},[87,2893,2894],{"class":254},"      v-html",[87,2896,258],{"class":246},[87,2898,2899],{"class":261},"\"block\"\n",[87,2901,2902,2905,2907],{"class":89,"line":125},[87,2903,2904],{"class":254},"      class",[87,2906,258],{"class":246},[87,2908,2909],{"class":261},"\"markdown-block\"\n",[87,2911,2912,2915,2917],{"class":89,"line":132},[87,2913,2914],{"class":246},"    >\u003C/",[87,2916,2606],{"class":250},[87,2918,273],{"class":246},[87,2920,2921,2924,2926],{"class":89,"line":138},[87,2922,2923],{"class":246},"  \u003C/",[87,2925,2606],{"class":250},[87,2927,273],{"class":246},[87,2929,2930,2932,2934],{"class":89,"line":144},[87,2931,1945],{"class":246},[87,2933,1919],{"class":250},[87,2935,273],{"class":246},[87,2937,2938],{"class":89,"line":150},[87,2939,129],{"emptyLinePlaceholder":128},[87,2941,2942,2944,2946,2948],{"class":89,"line":156},[87,2943,247],{"class":246},[87,2945,1960],{"class":250},[87,2947,1963],{"class":254},[87,2949,273],{"class":246},[87,2951,2952,2954,2956,2958,2960,2962,2964,2967,2969,2971],{"class":89,"line":162},[87,2953,807],{"class":806},[87,2955,810],{"class":246},[87,2957,2303],{"class":250},[87,2959,962],{"class":246},[87,2961,1974],{"class":250},[87,2963,962],{"class":246},[87,2965,2966],{"class":250},"watch",[87,2968,815],{"class":246},[87,2970,818],{"class":806},[87,2972,1995],{"class":261},[87,2974,2975,2977,2979,2981],{"class":89,"line":168},[87,2976,807],{"class":806},[87,2978,2677],{"class":250},[87,2980,831],{"class":806},[87,2982,2983],{"class":261}," 'markdown-it'\n",[87,2985,2986],{"class":89,"line":174},[87,2987,129],{"emptyLinePlaceholder":128},[87,2989,2990,2992,2994,2996,2998,3000,3002],{"class":89,"line":180},[87,2991,843],{"class":806},[87,2993,847],{"class":846},[87,2995,851],{"class":850},[87,2997,2336],{"class":781},[87,2999,890],{"class":246},[87,3001,2703],{"class":261},[87,3003,897],{"class":246},[87,3005,3006,3008,3010,3012,3014,3016],{"class":89,"line":186},[87,3007,843],{"class":806},[87,3009,2713],{"class":846},[87,3011,851],{"class":850},[87,3013,2718],{"class":806},[87,3015,2677],{"class":781},[87,3017,3018],{"class":246},"()\n",[87,3020,3021],{"class":89,"line":192},[87,3022,129],{"emptyLinePlaceholder":128},[87,3024,3025,3027,3030,3032,3034],{"class":89,"line":198},[87,3026,843],{"class":806},[87,3028,3029],{"class":846}," renderedBlocks",[87,3031,851],{"class":850},[87,3033,2336],{"class":781},[87,3035,3036],{"class":246},"([])\n",[87,3038,3039,3041,3044,3046,3048],{"class":89,"line":1144},[87,3040,843],{"class":806},[87,3042,3043],{"class":846}," blockCache",[87,3045,851],{"class":850},[87,3047,2336],{"class":781},[87,3049,3036],{"class":246},[87,3051,3052],{"class":89,"line":1155},[87,3053,129],{"emptyLinePlaceholder":128},[87,3055,3056,3058],{"class":89,"line":1167},[87,3057,2966],{"class":781},[87,3059,3060],{"class":246},"(\n",[87,3062,3063,3066],{"class":89,"line":1178},[87,3064,3065],{"class":893},"  markdownContent",[87,3067,1002],{"class":246},[87,3069,3070,3073,3076,3078,3081,3083,3085],{"class":89,"line":1183},[87,3071,3072],{"class":246},"  (",[87,3074,3075],{"class":1270},"newContent",[87,3077,962],{"class":246},[87,3079,3080],{"class":1270},"oldContent",[87,3082,1290],{"class":246},[87,3084,2134],{"class":806},[87,3086,2048],{"class":246},[87,3088,3089,3092,3095,3097,3100,3102,3105,3107,3111,3115,3119,3121],{"class":89,"line":1188},[87,3090,3091],{"class":806},"    const",[87,3093,3094],{"class":846}," blocks",[87,3096,851],{"class":850},[87,3098,3099],{"class":918}," newContent",[87,3101,65],{"class":246},[87,3103,3104],{"class":781},"split",[87,3106,890],{"class":246},[87,3108,3110],{"class":3109},"sDaw7","/",[87,3112,3114],{"class":3113},"sRZ4U","\\n",[87,3116,3118],{"class":3117},"sYoRg","{2,}",[87,3120,3110],{"class":3109},[87,3122,897],{"class":246},[87,3124,3125],{"class":89,"line":1199},[87,3126,3127],{"class":869},"    // Only re-render the last block, reuse cache for others\n",[87,3129,3130],{"class":89,"line":1205},[87,3131,3132],{"class":869},"    // Handle cases where blocks decrease or increase\n",[87,3134,3135,3138,3140,3142,3144,3147,3149,3151,3153],{"class":89,"line":1211},[87,3136,3137],{"class":918},"    blockCache",[87,3139,65],{"class":246},[87,3141,1522],{"class":1346},[87,3143,65],{"class":246},[87,3145,3146],{"class":250},"length",[87,3148,851],{"class":850},[87,3150,3094],{"class":918},[87,3152,65],{"class":246},[87,3154,3155],{"class":250},"length\n",[87,3157,3158,3161,3163,3166,3169,3171,3174,3177,3180,3183,3185,3187,3189,3191,3193,3196],{"class":89,"line":1223},[87,3159,3160],{"class":806},"    for",[87,3162,1282],{"class":246},[87,3164,3165],{"class":806},"let",[87,3167,3168],{"class":893}," i",[87,3170,851],{"class":850},[87,3172,3173],{"class":254}," 0",[87,3175,3176],{"class":246},"; ",[87,3178,3179],{"class":893},"i",[87,3181,3182],{"class":850}," \u003C",[87,3184,3094],{"class":918},[87,3186,65],{"class":246},[87,3188,3146],{"class":250},[87,3190,3176],{"class":246},[87,3192,3179],{"class":893},[87,3194,3195],{"class":850},"++",[87,3197,1274],{"class":246},[87,3199,3200],{"class":89,"line":1835},[87,3201,3202],{"class":869},"      // Only render the last one, or new blocks\n",[87,3204,3205,3208,3210,3212,3215,3217,3219,3221,3224,3227,3230,3233,3236,3238,3240,3243,3245],{"class":89,"line":1843},[87,3206,3207],{"class":806},"      if",[87,3209,1282],{"class":246},[87,3211,3179],{"class":893},[87,3213,3214],{"class":850}," ===",[87,3216,3094],{"class":918},[87,3218,65],{"class":246},[87,3220,3146],{"class":250},[87,3222,3223],{"class":850}," -",[87,3225,3226],{"class":254}," 1",[87,3228,3229],{"class":850}," ||",[87,3231,3232],{"class":850}," !",[87,3234,3235],{"class":918},"blockCache",[87,3237,65],{"class":246},[87,3239,1522],{"class":250},[87,3241,3242],{"class":246},"[",[87,3244,3179],{"class":893},[87,3246,3247],{"class":246},"]) {\n",[87,3249,3250,3253,3255,3257,3259,3261,3264,3266,3268,3270,3272,3274,3277,3279,3281,3283,3286,3289],{"class":89,"line":1849},[87,3251,3252],{"class":918},"        blockCache",[87,3254,65],{"class":246},[87,3256,1522],{"class":250},[87,3258,3242],{"class":246},[87,3260,3179],{"class":893},[87,3262,3263],{"class":246},"] ",[87,3265,258],{"class":850},[87,3267,2713],{"class":918},[87,3269,65],{"class":246},[87,3271,1904],{"class":781},[87,3273,890],{"class":246},[87,3275,3276],{"class":893},"blocks",[87,3278,3242],{"class":246},[87,3280,3179],{"class":893},[87,3282,3263],{"class":246},[87,3284,3285],{"class":850},"||",[87,3287,3288],{"class":261}," ''",[87,3290,897],{"class":246},[87,3292,3293],{"class":89,"line":1886},[87,3294,3295],{"class":246},"      }\n",[87,3297,3298],{"class":89,"line":1892},[87,3299,3300],{"class":869},"      // Reuse other blocks directly\n",[87,3302,3304],{"class":89,"line":3303},35,[87,3305,1202],{"class":246},[87,3307,3309,3312,3314,3316,3318,3320,3322,3324,3326,3329],{"class":89,"line":3308},36,[87,3310,3311],{"class":918},"    renderedBlocks",[87,3313,65],{"class":246},[87,3315,1522],{"class":250},[87,3317,851],{"class":850},[87,3319,3043],{"class":918},[87,3321,65],{"class":246},[87,3323,1522],{"class":1346},[87,3325,65],{"class":246},[87,3327,3328],{"class":781},"slice",[87,3330,3018],{"class":246},[87,3332,3334],{"class":89,"line":3333},37,[87,3335,3336],{"class":246},"  },\n",[87,3338,3340,3343,3346,3348,3351],{"class":89,"line":3339},38,[87,3341,3342],{"class":246},"  { ",[87,3344,3345],{"class":250},"immediate",[87,3347,77],{"class":1796},[87,3349,3350],{"class":254}," true",[87,3352,1090],{"class":246},[87,3354,3356],{"class":89,"line":3355},39,[87,3357,897],{"class":246},[87,3359,3361],{"class":89,"line":3360},40,[87,3362,129],{"emptyLinePlaceholder":128},[87,3364,3366,3368,3370,3372],{"class":89,"line":3365},41,[87,3367,2656],{"class":781},[87,3369,2131],{"class":246},[87,3371,2134],{"class":806},[87,3373,2048],{"class":246},[87,3375,3377],{"class":89,"line":3376},42,[87,3378,2777],{"class":869},[87,3380,3382],{"class":89,"line":3381},43,[87,3383,2078],{"class":246},[87,3385,3387,3389,3391],{"class":89,"line":3386},44,[87,3388,1945],{"class":246},[87,3390,1960],{"class":250},[87,3392,273],{"class":246},[51,3394,3396],{"id":3395},"ultimate-weapon-precise-updates-with-morphdom","Ultimate Weapon: Precise Updates with morphdom",[20,3398,3399],{},"While chunked rendering solves most problems, it struggles with Markdown lists. Because in Markdown syntax, list items are usually separated by only one newline, so the entire list is treated as one large chunk. Imagine a list with hundreds of items—even if only the last item is updated, the entire list chunk must be completely re-rendered, and we're back to square one.",[224,3401,3403],{"id":3402},"what-is-morphdom","What is morphdom?",[20,3405,3406,3408,3409,65],{},[74,3407,585],{}," is a JavaScript library of only 5KB (gzipped), with the core functionality of: ",[24,3410,3411],{},"receiving two DOM nodes (or HTML strings), calculating the minimal DOM operations needed, and \"morphing\" the first node into the second, rather than directly replacing it",[20,3413,3414,3415,77],{},"Its working principle is similar to Virtual DOM's Diff algorithm, but ",[24,3416,3417],{},"operates directly on the real DOM",[423,3419,3420,3423,3426],{},[392,3421,3422],{},"Compare tag names, attributes, text content, etc., between old and new DOM;",[392,3424,3425],{},"Execute only add/delete/modify operations on the differences (like modifying text, updating attributes, moving node positions);",[392,3427,3428],{},"Unchanged DOM nodes are completely preserved, including their event listeners, scroll positions, selection states, etc.",[20,3430,3431,3432,3435,3436,3438],{},"Markdown treats lists as a whole, but in the generated HTML, each list item (",[74,3433,3434],{},"\u003Cli>",") is independent! When ",[74,3437,585],{}," updates later list items, it ensures earlier list items remain untouched, naturally preserving their state.",[20,3440,3441],{},"Isn't this exactly what we've been dreaming of? Real-time Markdown updates while maximally preserving user operation state, and saving a bunch of unnecessary DOM operations!",[224,3443,3445],{"id":3444},"example-code","Example Code",[79,3447,3449],{"className":1908,"code":3448,"language":1910,"meta":33,"style":33},"\u003Ctemplate>\n  \u003Cdiv ref=\"markdownContainer\" class=\"markdown-container\">\n    \u003Cdiv id=\"md-root\">\u003C/div>\n  \u003C/div>\n\u003C/template>\n\n\u003Cscript setup>\nimport { nextTick, ref, watch } from 'vue';\nimport MarkdownIt from 'markdown-it';\nimport morphdom from 'morphdom';\n\nconst markdownContent = ref('');\nconst markdownContainer = ref(null);\nconst md = new MarkdownIt();\n\nconst render = () => {\n  if (!markdownContainer.value.querySelector('#md-root')) return;\n\n  const newHtml = `\u003Cdiv id=\"md-root\">` + md.render(markdownContent.value) + `\u003C/div>`\n\n  morphdom(markdownContainer.value, newHtml, {\n    childrenOnly: true\n  });\n}\n\nwatch(markdownContent, () => {\n    render()\n});\n\nonMounted(async () => {\n  // Wait for DOM to be mounted\n  await nextTick()\n  render()\n})\n\u003C/script>\n\n",[74,3450,3451,3459,3482,3502,3510,3518,3522,3532,3557,3569,3583,3587,3603,3620,3634,3638,3654,3686,3690,3727,3731,3752,3762,3767,3771,3775,3790,3797,3802,3806,3821,3826,3836,3843,3847],{"__ignoreMap":33},[87,3452,3453,3455,3457],{"class":89,"line":90},[87,3454,247],{"class":246},[87,3456,1919],{"class":250},[87,3458,273],{"class":246},[87,3460,3461,3463,3465,3467,3469,3472,3475,3477,3480],{"class":89,"line":96},[87,3462,1926],{"class":246},[87,3464,2606],{"class":250},[87,3466,2336],{"class":254},[87,3468,258],{"class":246},[87,3470,3471],{"class":261},"\"markdownContainer\"",[87,3473,3474],{"class":254}," class",[87,3476,258],{"class":246},[87,3478,3479],{"class":261},"\"markdown-container\"",[87,3481,273],{"class":246},[87,3483,3484,3486,3488,3491,3493,3496,3498,3500],{"class":89,"line":3},[87,3485,2866],{"class":246},[87,3487,2606],{"class":250},[87,3489,3490],{"class":254}," id",[87,3492,258],{"class":246},[87,3494,3495],{"class":261},"\"md-root\"",[87,3497,2617],{"class":246},[87,3499,2606],{"class":250},[87,3501,273],{"class":246},[87,3503,3504,3506,3508],{"class":89,"line":107},[87,3505,2923],{"class":246},[87,3507,2606],{"class":250},[87,3509,273],{"class":246},[87,3511,3512,3514,3516],{"class":89,"line":113},[87,3513,1945],{"class":246},[87,3515,1919],{"class":250},[87,3517,273],{"class":246},[87,3519,3520],{"class":89,"line":119},[87,3521,129],{"emptyLinePlaceholder":128},[87,3523,3524,3526,3528,3530],{"class":89,"line":125},[87,3525,247],{"class":246},[87,3527,1960],{"class":250},[87,3529,1963],{"class":254},[87,3531,273],{"class":246},[87,3533,3534,3536,3538,3541,3543,3545,3547,3549,3551,3553,3555],{"class":89,"line":132},[87,3535,807],{"class":806},[87,3537,810],{"class":246},[87,3539,3540],{"class":250},"nextTick",[87,3542,962],{"class":246},[87,3544,2303],{"class":250},[87,3546,962],{"class":246},[87,3548,2966],{"class":250},[87,3550,815],{"class":246},[87,3552,818],{"class":806},[87,3554,2667],{"class":261},[87,3556,2670],{"class":246},[87,3558,3559,3561,3563,3565,3567],{"class":89,"line":138},[87,3560,807],{"class":806},[87,3562,2677],{"class":250},[87,3564,831],{"class":806},[87,3566,2682],{"class":261},[87,3568,2670],{"class":246},[87,3570,3571,3573,3576,3578,3581],{"class":89,"line":144},[87,3572,807],{"class":806},[87,3574,3575],{"class":250}," morphdom",[87,3577,831],{"class":806},[87,3579,3580],{"class":261}," 'morphdom'",[87,3582,2670],{"class":246},[87,3584,3585],{"class":89,"line":150},[87,3586,129],{"emptyLinePlaceholder":128},[87,3588,3589,3591,3593,3595,3597,3599,3601],{"class":89,"line":156},[87,3590,843],{"class":806},[87,3592,847],{"class":846},[87,3594,851],{"class":850},[87,3596,2336],{"class":781},[87,3598,890],{"class":246},[87,3600,2703],{"class":261},[87,3602,2706],{"class":246},[87,3604,3605,3607,3610,3612,3614,3616,3618],{"class":89,"line":162},[87,3606,843],{"class":806},[87,3608,3609],{"class":846}," markdownContainer",[87,3611,851],{"class":850},[87,3613,2336],{"class":781},[87,3615,890],{"class":246},[87,3617,965],{"class":254},[87,3619,2706],{"class":246},[87,3621,3622,3624,3626,3628,3630,3632],{"class":89,"line":168},[87,3623,843],{"class":806},[87,3625,2713],{"class":846},[87,3627,851],{"class":850},[87,3629,2718],{"class":806},[87,3631,2677],{"class":781},[87,3633,2723],{"class":246},[87,3635,3636],{"class":89,"line":174},[87,3637,129],{"emptyLinePlaceholder":128},[87,3639,3640,3642,3645,3647,3650,3652],{"class":89,"line":180},[87,3641,843],{"class":806},[87,3643,3644],{"class":781}," render",[87,3646,851],{"class":850},[87,3648,3649],{"class":246}," () ",[87,3651,2134],{"class":806},[87,3653,2048],{"class":246},[87,3655,3656,3658,3660,3662,3665,3667,3669,3671,3674,3676,3679,3682,3684],{"class":89,"line":186},[87,3657,1279],{"class":806},[87,3659,1282],{"class":246},[87,3661,1285],{"class":850},[87,3663,3664],{"class":918},"markdownContainer",[87,3666,65],{"class":246},[87,3668,1522],{"class":1346},[87,3670,65],{"class":246},[87,3672,3673],{"class":781},"querySelector",[87,3675,890],{"class":246},[87,3677,3678],{"class":261},"'#md-root'",[87,3680,3681],{"class":246},")) ",[87,3683,1293],{"class":806},[87,3685,2670],{"class":246},[87,3687,3688],{"class":89,"line":192},[87,3689,129],{"emptyLinePlaceholder":128},[87,3691,3692,3695,3698,3700,3703,3705,3707,3709,3711,3713,3715,3717,3719,3721,3724],{"class":89,"line":198},[87,3693,3694],{"class":806},"  const",[87,3696,3697],{"class":846}," newHtml",[87,3699,851],{"class":850},[87,3701,3702],{"class":261}," `\u003Cdiv id=\"md-root\">`",[87,3704,1547],{"class":850},[87,3706,2713],{"class":918},[87,3708,65],{"class":246},[87,3710,1904],{"class":781},[87,3712,890],{"class":246},[87,3714,928],{"class":918},[87,3716,65],{"class":246},[87,3718,1522],{"class":250},[87,3720,1290],{"class":246},[87,3722,3723],{"class":850},"+",[87,3725,3726],{"class":261}," `\u003C/div>`\n",[87,3728,3729],{"class":89,"line":1144},[87,3730,129],{"emptyLinePlaceholder":128},[87,3732,3733,3736,3738,3740,3742,3744,3746,3749],{"class":89,"line":1155},[87,3734,3735],{"class":781},"  morphdom",[87,3737,890],{"class":246},[87,3739,3664],{"class":918},[87,3741,65],{"class":246},[87,3743,1522],{"class":250},[87,3745,962],{"class":246},[87,3747,3748],{"class":893},"newHtml",[87,3750,3751],{"class":246},", {\n",[87,3753,3754,3757,3759],{"class":89,"line":1167},[87,3755,3756],{"class":250},"    childrenOnly",[87,3758,77],{"class":1796},[87,3760,3761],{"class":254}," true\n",[87,3763,3764],{"class":89,"line":1178},[87,3765,3766],{"class":246},"  });\n",[87,3768,3769],{"class":89,"line":1183},[87,3770,1226],{"class":246},[87,3772,3773],{"class":89,"line":1188},[87,3774,129],{"emptyLinePlaceholder":128},[87,3776,3777,3779,3781,3783,3786,3788],{"class":89,"line":1199},[87,3778,2966],{"class":781},[87,3780,890],{"class":246},[87,3782,928],{"class":893},[87,3784,3785],{"class":246},", () ",[87,3787,2134],{"class":806},[87,3789,2048],{"class":246},[87,3791,3792,3795],{"class":89,"line":1205},[87,3793,3794],{"class":781},"    render",[87,3796,3018],{"class":246},[87,3798,3799],{"class":89,"line":1211},[87,3800,3801],{"class":246},"});\n",[87,3803,3804],{"class":89,"line":1223},[87,3805,129],{"emptyLinePlaceholder":128},[87,3807,3808,3810,3812,3815,3817,3819],{"class":89,"line":1835},[87,3809,2656],{"class":781},[87,3811,890],{"class":246},[87,3813,3814],{"class":806},"async",[87,3816,3649],{"class":246},[87,3818,2134],{"class":806},[87,3820,2048],{"class":246},[87,3822,3823],{"class":89,"line":1843},[87,3824,3825],{"class":869},"  // Wait for DOM to be mounted\n",[87,3827,3828,3831,3834],{"class":89,"line":1849},[87,3829,3830],{"class":806},"  await",[87,3832,3833],{"class":781}," nextTick",[87,3835,3018],{"class":246},[87,3837,3838,3841],{"class":89,"line":1886},[87,3839,3840],{"class":781},"  render",[87,3842,3018],{"class":246},[87,3844,3845],{"class":89,"line":1892},[87,3846,2078],{"class":246},[87,3848,3849,3851,3853],{"class":89,"line":3303},[87,3850,1945],{"class":246},[87,3852,1960],{"class":250},[87,3854,273],{"class":246},[224,3856,3858],{"id":3857},"seeing-is-believing-demo-comparison","Seeing is Believing: Demo Comparison",[20,3860,3861],{},"The iframe below contains a comparison demo showing the performance differences between different approaches.",[20,3863,3864,3867],{},[24,3865,3866],{},"Tip:"," If you're using Chromium-based browsers like Chrome or Edge, open Developer Tools (DevTools), find the \"Rendering\" tab, and check \"Paint flashing.\" This way you can visually see which parts get repainted with each update—fewer repainted areas mean better performance!",[20,3869,3870],{},[31,3871],{"alt":33,"src":3872},"https://static.031130.xyz/uploads/2025/07/12/d5721c40fb076.webp",[3874,3875],"iframe",{"src":3876,"width":3877,"height":3878,"allowFullScreen":128,"loading":3879},"https://static.031130.xyz/demo/morphdom-vs-markdown-chunk.html","100%",500,"lazy",[51,3881,3883],{"id":3882},"progress-so-far","Progress So Far",[20,3885,3886,3887,3889],{},"From the initial \"brute force full refresh,\" to the \"smarter chunked updates,\" and now to the \"surgical precision of ",[74,3888,585],{}," updates,\" we've progressively eliminated unnecessary rendering overhead, ultimately creating a Markdown real-time rendering solution that's both fast and preserves user state.",[20,3891,3892,3893,3895],{},"However, using ",[74,3894,585],{},", a third-party library to directly manipulate DOM in Vue components, feels somewhat... not quite \"Vue\"? While it solves the core performance and state issues, playing this way in the Vue world feels a bit like taking the back door.",[20,3897,3898,3901],{},[24,3899,3900],{},"Next Episode Preview:"," In the next article, we'll discuss whether there's a more elegant, more \"native\" solution in the Vue world to achieve precise Markdown updates. Stay tuned!",[547,3903,3904],{},"html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html pre.shiki code .sJa8x, html code.shiki .sJa8x{--shiki-default:#E45649;--shiki-dark:#E06C75}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html pre.shiki code .sLKXg, html code.shiki .sLKXg{--shiki-default:#A626A4;--shiki-dark:#C678DD}html pre.shiki code .sNmU0, html code.shiki .sNmU0{--shiki-default:#986801;--shiki-dark:#E5C07B}html pre.shiki code .s_Sar, html code.shiki .s_Sar{--shiki-default:#0184BC;--shiki-dark:#56B6C2}html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .s7GmK, html code.shiki .s7GmK{--shiki-default:#383A42;--shiki-dark:#E5C07B}html pre.shiki code .sW2Sy, html code.shiki .sW2Sy{--shiki-default:#A0A1A7;--shiki-default-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html pre.shiki code .sz0mV, html code.shiki .sz0mV{--shiki-default:#383A42;--shiki-dark:#E06C75}html pre.shiki code .s8iYz, html code.shiki .s8iYz{--shiki-default:#383A42;--shiki-default-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic}html pre.shiki code .sDaw7, html code.shiki .sDaw7{--shiki-default:#0184BC;--shiki-dark:#E06C75}html pre.shiki code .sRZ4U, html code.shiki .sRZ4U{--shiki-default:#986801;--shiki-dark:#E06C75}html pre.shiki code .sYoRg, html code.shiki .sYoRg{--shiki-default:#0184BC;--shiki-dark:#D19A66}html pre.shiki code .s2QsP, html code.shiki .s2QsP{--shiki-default:#E45649;--shiki-dark:#E5C07B}html pre.shiki code .st7oF, html code.shiki .st7oF{--shiki-default:#0184BC;--shiki-dark:#ABB2BF}",{"title":33,"searchDepth":96,"depth":96,"links":3906},[3907,3908,3909,3910,3915],{"id":2532,"depth":96,"text":2533},{"id":2566,"depth":96,"text":2567},{"id":2792,"depth":96,"text":2793},{"id":3395,"depth":96,"text":3396,"children":3911},[3912,3913,3914],{"id":3402,"depth":3,"text":3403},{"id":3444,"depth":3,"text":3445},{"id":3857,"depth":3,"text":3858},{"id":3882,"depth":96,"text":3883},{"title":3917,"date":3918,"path":3919,"tags":3920,"body":3923},"Migration from node-sass to dart-sass: A Troubleshooting Chronicle","2025-07-05 17:57:02","/2025/07/05/node-sass-migration-to-dart-sass",[575,571,3921,3922,574],"Sass","CSS",{"type":17,"value":3924,"toc":4767},[3925,3929,3940,3944,3959,3963,3995,3999,4003,4006,4010,4019,4022,4030,4077,4080,4083,4086,4116,4125,4128,4132,4136,4160,4164,4280,4284,4293,4331,4335,4338,4404,4408,4412,4415,4418,4444,4447,4488,4497,4502,4506,4515,4522,4574,4577,4632,4636,4659,4662,4666,4764],[51,3926,3928],{"id":3927},"update-goals","Update Goals",[389,3930,3931,3934,3937],{},[392,3932,3933],{},"node-sass -> sass (dart-sass)",[392,3935,3936],{},"Minimize impact, avoid updating other dependency versions unless necessary",[392,3938,3939],{},"Based on the above two conditions, see if we can upgrade the node.js version",[51,3941,3943],{"id":3942},"reasons-to-abandon-node-sass","Reasons to Abandon node-sass",[389,3945,3946,3953,3956],{},[392,3947,3948],{},[591,3949,3952],{"href":3950,"rel":3951},"https://sass-lang.com/blog/libsass-is-deprecated/",[621],"node-sass has been deprecated, dart-sass is the officially recommended successor by Sass",[392,3954,3955],{},"node-sass installation on Windows is very troublesome, requiring both Python 2 and Microsoft Visual C++ on the development machine during npm installation",[392,3957,3958],{},"When installing node-sass, resources need to be pulled from GitHub, which has a low success rate in certain network environments",[51,3960,3962],{"id":3961},"current-project-dependency-versions","Current Project Dependency Versions",[389,3964,3965,3970,3975,3980,3985,3990],{},[392,3966,3967],{},[74,3968,3969],{},"node@^12",[392,3971,3972],{},[74,3973,3974],{},"vue@^2",[392,3976,3977],{},[74,3978,3979],{},"webpack@^3",[392,3981,3982],{},[74,3983,3984],{},"vue-loader@^14",[392,3986,3987],{},[74,3988,3989],{},"sass-loader@^7.0.3",[392,3991,3992],{},[74,3993,3994],{},"node-sass@^4",[51,3996,3998],{"id":3997},"update-strategy","Update Strategy",[224,4000,4002],{"id":4001},"nodejs","node.js",[20,4004,4005],{},"Webpack officially doesn't provide the maximum node version supported by webpack 3, and even if webpack officially supports it, related webpack plugins may not. Therefore, whether the node version can be updated can only be determined through testing. Fortunately, although this project's CI/CD runs on node 12, I've been using node 14 for daily development, so I'll take this opportunity to upgrade the node version to 14.",[224,4007,4009],{"id":4008},"webpack-sass-loader","webpack, sass-loader",[20,4011,4012,4013,4018],{},"The webpack version is currently in a \"ticking time bomb\" state of not updating unless necessary. Based on the current webpack 3 limitation, the maximum supported sass-loader version is ^7 (sass-loader's ",[591,4014,4017],{"href":4015,"rel":4016},"https://github.com/webpack-contrib/sass-loader/blob/v8.0.0/CHANGELOG.md",[621],"8.0.0 version changelog"," explicitly states that version 8.0.0 requires webpack 4.36.0).",[20,4020,4021],{},"If sass-loader@^7 in the project supports using dart-sass, then there's no need to update sass-loader, and consequently no need to update webpack; otherwise, webpack would need to be updated to 4, and then determine the sass-loader version accordingly.",[20,4023,4024,4025,77],{},"So does it support it or not? I found this package.json snippet on the ",[591,4026,4029],{"href":4027,"rel":4028},"https://www.webpackjs.com/loaders/sass-loader/",[621],"webpack official documentation page introducing sass-loader",[79,4031,4033],{"className":979,"code":4032,"language":981,"meta":33,"style":33},"{\n  \"devDependencies\": {\n    \"sass-loader\": \"^7.2.0\",\n    \"sass\": \"^1.22.10\"\n  }\n}\n",[74,4034,4035,4039,4047,4059,4069,4073],{"__ignoreMap":33},[87,4036,4037],{"class":89,"line":90},[87,4038,988],{"class":246},[87,4040,4041,4044],{"class":89,"line":96},[87,4042,4043],{"class":250},"  \"devDependencies\"",[87,4045,4046],{"class":246},": {\n",[87,4048,4049,4052,4054,4057],{"class":89,"line":3},[87,4050,4051],{"class":250},"    \"sass-loader\"",[87,4053,996],{"class":246},[87,4055,4056],{"class":261},"\"^7.2.0\"",[87,4058,1002],{"class":246},[87,4060,4061,4064,4066],{"class":89,"line":107},[87,4062,4063],{"class":250},"    \"sass\"",[87,4065,996],{"class":246},[87,4067,4068],{"class":261},"\"^1.22.10\"\n",[87,4070,4071],{"class":89,"line":113},[87,4072,1889],{"class":246},[87,4074,4075],{"class":89,"line":119},[87,4076,1226],{"class":246},[20,4078,4079],{},"This proves that at least sass-loader@7.2.0 already supported dart-sass, so the webpack version can stay at ^3, and sass-loader can temporarily stay at version 7.0.3. If there are issues later, it can be updated to the latest version 7.3.1 in the ^7 range.",[224,4081,4082],{"id":4082},"dart-sass",[20,4084,4085],{},"I couldn't find the maximum sass version supported by sass-loader@^7. GitHub Copilot confidently told me:",[42,4087,4088,4093,4098,4103],{},[20,4089,4090],{},[24,4091,4092],{},"Official documentation quote:",[42,4094,4095],{},[20,4096,4097],{},"sass-loader@^7.0.0 requires node-sass >=4.0.0 or sass >=1.3.0, \u003C=1.26.5.",[20,4099,4100],{},[24,4101,4102],{},"Suggestion:",[389,4104,4105],{},[392,4106,4107,4108,4111,4112,4115],{},"If you need to use a higher version of ",[74,4109,4110],{},"sass",", please upgrade to ",[74,4113,4114],{},"sass-loader"," 8 or higher.",[20,4117,4118,4119,4124],{},"However, I couldn't find any trace of this text on the internet. Moreover, the last version in sass's ~1.26 range is 1.26.11, not 1.26.5. ",[591,4120,4123],{"href":4121,"rel":4122},"https://docs.npmjs.com/about-semantic-versioning",[621],"According to common npm versioning principles",", releases that only change the patch version while keeping the major and minor versions the same generally only contain bugfixes without breaking changes. It's unlikely that updating from 1.26.5 to 1.26.11 would suddenly become incompatible with sass-loader 7, so this is more likely an AI hallucination or limited training data.",[20,4126,4127],{},"Out of caution, I ultimately decided to use the last version of sass 1.22 mentioned in the webpack official documentation, which is 1.22.12.",[51,4129,4131],{"id":4130},"analysis-complete-lets-update","Analysis Complete, Let's Update",[224,4133,4135],{"id":4134},"step-1-uninstall-node-sass-install-sass12212","Step 1: Uninstall node-sass, Install sass@^1.22.12",[79,4137,4139],{"className":772,"code":4138,"language":774,"meta":33,"style":33},"npm uninstall node-sass\nnpm install sass@^1.22.12\n",[74,4140,4141,4151],{"__ignoreMap":33},[87,4142,4143,4145,4148],{"class":89,"line":90},[87,4144,782],{"class":781},[87,4146,4147],{"class":261}," uninstall",[87,4149,4150],{"class":261}," node-sass\n",[87,4152,4153,4155,4157],{"class":89,"line":96},[87,4154,782],{"class":781},[87,4156,785],{"class":261},[87,4158,4159],{"class":261}," sass@^1.22.12\n",[224,4161,4163],{"id":4162},"step-2-update-webpack-configuration-optional","Step 2: Update webpack Configuration (Optional)",[79,4165,4169],{"className":4166,"code":4167,"language":4168,"meta":33,"style":33},"language-diff shiki shiki-themes one-light one-dark-pro","module.exports = {\n  // ...\n  module: {\n    rules: [\n      {\n        test: /\\.(scss|sass)$/,\n        use: [\n          'style-loader',\n          'css-loader',\n          {\n            loader: 'sass-loader',\n+            options: {\n+                // In fact, this line doesn't need to be added in most sass-loader versions, sass-loader can automatically detect whether it's sass or node-sass\n+                implementation: require('sass')\n+              },\n            },\n          },\n        ],\n      },\n    ],\n  },\n};\n","diff",[74,4170,4171,4176,4181,4186,4191,4196,4201,4206,4211,4216,4221,4226,4231,4236,4241,4246,4251,4256,4261,4266,4271,4275],{"__ignoreMap":33},[87,4172,4173],{"class":89,"line":90},[87,4174,4175],{"class":246},"module.exports = {\n",[87,4177,4178],{"class":89,"line":96},[87,4179,4180],{"class":246},"  // ...\n",[87,4182,4183],{"class":89,"line":3},[87,4184,4185],{"class":246},"  module: {\n",[87,4187,4188],{"class":89,"line":107},[87,4189,4190],{"class":246},"    rules: [\n",[87,4192,4193],{"class":89,"line":113},[87,4194,4195],{"class":246},"      {\n",[87,4197,4198],{"class":89,"line":119},[87,4199,4200],{"class":246},"        test: /\\.(scss|sass)$/,\n",[87,4202,4203],{"class":89,"line":125},[87,4204,4205],{"class":246},"        use: [\n",[87,4207,4208],{"class":89,"line":132},[87,4209,4210],{"class":246},"          'style-loader',\n",[87,4212,4213],{"class":89,"line":138},[87,4214,4215],{"class":246},"          'css-loader',\n",[87,4217,4218],{"class":89,"line":144},[87,4219,4220],{"class":246},"          {\n",[87,4222,4223],{"class":89,"line":150},[87,4224,4225],{"class":246},"            loader: 'sass-loader',\n",[87,4227,4228],{"class":89,"line":156},[87,4229,4230],{"class":261},"+            options: {\n",[87,4232,4233],{"class":89,"line":162},[87,4234,4235],{"class":261},"+                // In fact, this line doesn't need to be added in most sass-loader versions, sass-loader can automatically detect whether it's sass or node-sass\n",[87,4237,4238],{"class":89,"line":168},[87,4239,4240],{"class":261},"+                implementation: require('sass')\n",[87,4242,4243],{"class":89,"line":174},[87,4244,4245],{"class":261},"+              },\n",[87,4247,4248],{"class":89,"line":180},[87,4249,4250],{"class":246},"            },\n",[87,4252,4253],{"class":89,"line":186},[87,4254,4255],{"class":246},"          },\n",[87,4257,4258],{"class":89,"line":192},[87,4259,4260],{"class":246},"        ],\n",[87,4262,4263],{"class":89,"line":198},[87,4264,4265],{"class":246},"      },\n",[87,4267,4268],{"class":89,"line":1144},[87,4269,4270],{"class":246},"    ],\n",[87,4272,4273],{"class":89,"line":1155},[87,4274,3336],{"class":246},[87,4276,4277],{"class":89,"line":1167},[87,4278,4279],{"class":246},"};\n",[224,4281,4283],{"id":4282},"step-3-batch-replace-deep-syntax-with-v-deep","Step 3: Batch Replace /deep/ Syntax with ::v-deep",[20,4285,4286,4287,4292],{},"Because ",[591,4288,4291],{"href":4289,"rel":4290},"https://chromestatus.com/feature/4964279606312960",[621],"the /deep/ syntax was deprecated in 2017",", /deep/ became an unsupported deep selector. node-sass, with its excellent error tolerance, could continue to provide compatibility, but dart-sass doesn't support this syntax. So we need to batch replace the /deep/ syntax with ::v-deep, which, although abandoned in Vue's subsequent RFC, is still effectively supported to this day.",[79,4294,4296],{"className":772,"code":4295,"language":774,"meta":33,"style":33},"# Something like this, using VSCode's batch replace also works\nsed -i 's#\\s*/deep/\\s*# ::v-deep #g' $(grep -rl '/deep/' .)\n",[74,4297,4298,4303],{"__ignoreMap":33},[87,4299,4300],{"class":89,"line":90},[87,4301,4302],{"class":869},"# Something like this, using VSCode's batch replace also works\n",[87,4304,4305,4308,4311,4314,4317,4320,4323,4326,4329],{"class":89,"line":96},[87,4306,4307],{"class":781},"sed",[87,4309,4310],{"class":254}," -i",[87,4312,4313],{"class":261}," 's#\\s*/deep/\\s*# ::v-deep #g'",[87,4315,4316],{"class":246}," $(",[87,4318,4319],{"class":781},"grep",[87,4321,4322],{"class":254}," -rl",[87,4324,4325],{"class":261}," '/deep/'",[87,4327,4328],{"class":261}," .",[87,4330,897],{"class":246},[224,4332,4334],{"id":4333},"step-4-fix-other-sass-syntax-errors","Step 4: Fix Other Sass Syntax Errors",[20,4336,4337],{},"During the migration, I found some non-standard syntax in the project. node-sass, with its excellent robustness, silently forced parsing, while dart-sass can't handle this rough work. Therefore, these syntax errors need to be manually fixed based on compilation errors. I encountered two types:",[79,4339,4341],{"className":4166,"code":4340,"language":4168,"meta":33,"style":33},"// Extra colon\n.foo {\n-  color:: #fff;\n+  color: #fff;\n}\n\n// :nth-last-child without specified number\n.bar {\n-  &:nth-last-child() {\n+  &:nth-last-child(1) {\n      margin-bottom: 0;\n  }\n}\n",[74,4342,4343,4348,4353,4358,4363,4367,4371,4376,4381,4386,4391,4396,4400],{"__ignoreMap":33},[87,4344,4345],{"class":89,"line":90},[87,4346,4347],{"class":246},"// Extra colon\n",[87,4349,4350],{"class":89,"line":96},[87,4351,4352],{"class":246},".foo {\n",[87,4354,4355],{"class":89,"line":3},[87,4356,4357],{"class":250},"-  color:: #fff;\n",[87,4359,4360],{"class":89,"line":107},[87,4361,4362],{"class":261},"+  color: #fff;\n",[87,4364,4365],{"class":89,"line":113},[87,4366,1226],{"class":246},[87,4368,4369],{"class":89,"line":119},[87,4370,129],{"emptyLinePlaceholder":128},[87,4372,4373],{"class":89,"line":125},[87,4374,4375],{"class":246},"// :nth-last-child without specified number\n",[87,4377,4378],{"class":89,"line":132},[87,4379,4380],{"class":246},".bar {\n",[87,4382,4383],{"class":89,"line":138},[87,4384,4385],{"class":250},"-  &:nth-last-child() {\n",[87,4387,4388],{"class":89,"line":144},[87,4389,4390],{"class":261},"+  &:nth-last-child(1) {\n",[87,4392,4393],{"class":89,"line":150},[87,4394,4395],{"class":246},"      margin-bottom: 0;\n",[87,4397,4398],{"class":89,"line":156},[87,4399,1889],{"class":246},[87,4401,4402],{"class":89,"line":162},[87,4403,1226],{"class":246},[51,4405,4407],{"id":4406},"pitfalls","Pitfalls",[224,4409,4411],{"id":4410},"v-deep-styles-not-taking-effect","::v-deep Styles Not Taking Effect",[20,4413,4414],{},"After updating dependencies, everything seemed fine at first glance, so I pushed to the test environment. Less than a day later, a colleague called me - the ::v-deep deep selector wasn't working?",[20,4416,4417],{},"Trying my luck, GPT gave the following answer:",[42,4419,4420],{},[20,4421,4422,4423,4426,4427,962,4430,4437,4438,4441,4442,2449],{},"In the ",[24,4424,4425],{},"Vue 2 + vue-loader + Sass"," combination, ",[24,4428,4429],{},"this syntax is correct",[24,4431,4432,4433,4436],{},"provided that your build toolchain supports the ",[74,4434,4435],{},"::v-deep"," syntax"," (such as ",[74,4439,4440],{},"vue-loader@15"," and above + ",[74,4443,4114],{},[20,4445,4446],{},"Although I still haven't verified why updating to vue-loader@15 is required to use ::v-deep syntax, after updating vue-loader, the ::v-deep syntax did work. While writing this article, I found some clues that might explain this issue:",[423,4448,4449,4463],{},[392,4450,4451,4452,4457,4458,65],{},"The vue-loader ",[591,4453,4456],{"href":4454,"rel":4455},"https://vue-loader-v14.vuejs.org/en/features/scoped-css.html#deep-selectors",[621],"version 14 official documentation"," simply doesn't have examples of ::v-deep syntax. ",[591,4459,4462],{"href":4460,"rel":4461},"https://github.com/vuejs/vue-loader/commit/2585d254fc774386a898887467fbdd30eb864b53",[621],"This example was only added after vue-loader 15.7.0 was released",[392,4464,4465,4466,4473,4476,4477,4482,4483,65],{},"Someone mentioned in a vue-cli GitHub Issue comment:",[42,4467,4468],{},[20,4469,4470,4472],{},[74,4471,4435],{}," implemented in @vue/component-compiler-utils v2.6.0, should work after you reinstall the deps.",[4474,4475],"br",{},"And vue-loader only ",[591,4478,4481],{"href":4479,"rel":4480},"https://github.com/vuejs/vue-loader/commit/e32cd0e4372fcc6f13b6c307402713807516d71c#diff-7ae45ad102eab3b6d7e7896acd08c427a9b25b346470d7bc6507b6481575d519",[621],"added @vue/component-compiler-utils to its dependencies in version 15.0.0-beta.1",", and didn't ",[591,4484,4487],{"href":4485,"rel":4486},"https://github.com/vuejs/vue-loader/commit/c359a38db0fbb4135fc97114baec3cd557d4123a",[621],"update its @vue/component-compiler-utils version to the required ^3.0.0 until vue-loader 15.7.1",[20,4489,4490,4491,4496],{},"Can we upgrade to vue-loader 16 or even 17? No. The ",[591,4492,4495],{"href":4493,"rel":4494},"https://github.com/vuejs/vue-loader/releases/tag/v16.1.2",[621],"vue-loader v16.1.2 changelog"," clearly states:",[42,4498,4499],{},[20,4500,4501],{},"Note: vue-loader v16 is for Vue 3 only.",[224,4503,4505],{"id":4504},"vue-loader-14-15-breaking-changes","vue-loader 14 -> 15 Breaking Changes",[20,4507,4508,4509,4514],{},"When migrating vue-loader from 14 upward, running directly without modifying the webpack configuration will encounter Vue syntax recognition issues. Specifically, even though .vue file naming uses correct and valid syntax, the compiler just won't recognize it during build/development, reporting syntax errors. vue-loader officially has a ",[591,4510,4513],{"href":4511,"rel":4512},"https://vue-loader.vuejs.org/migrating.html",[621],"migration document"," that needs attention.",[79,4516,4520],{"className":4517,"code":4519,"language":1248},[4518],"language-text","ERROR in ./src/......\nModule parse failed: Unexpected token(1:0)\nYou may need an appropriate loader to handle this file type.\n",[74,4521,4519],{"__ignoreMap":33},[79,4523,4525],{"className":4166,"code":4524,"language":4168,"meta":33,"style":33},"// ...\nimport path from 'path'\n+const VueLoaderPlugin = require('vue-loader/lib/plugin')\n\n// ...\n\n  plugins: [\n+    new VueLoaderPlugin()\n    // ...\n  ]\n",[74,4526,4527,4532,4537,4542,4546,4550,4554,4559,4564,4569],{"__ignoreMap":33},[87,4528,4529],{"class":89,"line":90},[87,4530,4531],{"class":246},"// ...\n",[87,4533,4534],{"class":89,"line":96},[87,4535,4536],{"class":246},"import path from 'path'\n",[87,4538,4539],{"class":89,"line":3},[87,4540,4541],{"class":261},"+const VueLoaderPlugin = require('vue-loader/lib/plugin')\n",[87,4543,4544],{"class":89,"line":107},[87,4545,129],{"emptyLinePlaceholder":128},[87,4547,4548],{"class":89,"line":113},[87,4549,4531],{"class":246},[87,4551,4552],{"class":89,"line":119},[87,4553,129],{"emptyLinePlaceholder":128},[87,4555,4556],{"class":89,"line":125},[87,4557,4558],{"class":246},"  plugins: [\n",[87,4560,4561],{"class":89,"line":132},[87,4562,4563],{"class":261},"+    new VueLoaderPlugin()\n",[87,4565,4566],{"class":89,"line":138},[87,4567,4568],{"class":246},"    // ...\n",[87,4570,4571],{"class":89,"line":144},[87,4572,4573],{"class":246},"  ]\n",[20,4575,4576],{},"Additionally, in my project, I needed to remove the babel-loader for .vue files in the webpack configuration:",[79,4578,4580],{"className":4166,"code":4579,"language":4168,"meta":33,"style":33},"{\n  test: /\\.vue$/,\n  use: [\n-    {\n-      loader: 'babel-loader'\n-    },\n    {\n      loader: 'vue-loader',\n    }\n  ]\n}\n",[74,4581,4582,4586,4591,4596,4601,4606,4611,4615,4620,4624,4628],{"__ignoreMap":33},[87,4583,4584],{"class":89,"line":90},[87,4585,988],{"class":246},[87,4587,4588],{"class":89,"line":96},[87,4589,4590],{"class":246},"  test: /\\.vue$/,\n",[87,4592,4593],{"class":89,"line":3},[87,4594,4595],{"class":246},"  use: [\n",[87,4597,4598],{"class":89,"line":107},[87,4599,4600],{"class":250},"-    {\n",[87,4602,4603],{"class":89,"line":113},[87,4604,4605],{"class":250},"-      loader: 'babel-loader'\n",[87,4607,4608],{"class":89,"line":119},[87,4609,4610],{"class":250},"-    },\n",[87,4612,4613],{"class":89,"line":125},[87,4614,1015],{"class":246},[87,4616,4617],{"class":89,"line":132},[87,4618,4619],{"class":246},"      loader: 'vue-loader',\n",[87,4621,4622],{"class":89,"line":138},[87,4623,1202],{"class":246},[87,4625,4626],{"class":89,"line":144},[87,4627,4573],{"class":246},[87,4629,4630],{"class":89,"line":150},[87,4631,1226],{"class":246},[51,4633,4635],{"id":4634},"final-update-status","Final Update Status",[389,4637,4638,4645,4652],{},[392,4639,4640,403,4642],{},[74,4641,3969],{},[74,4643,4644],{},"node@^14",[392,4646,4647,403,4649],{},[74,4648,3984],{},[74,4650,4651],{},"vue-loader@^15",[392,4653,4654,403,4656],{},[74,4655,3994],{},[74,4657,4658],{},"sass@^1.22.12",[20,4660,4661],{},"All other dependency versions remain unchanged",[51,4663,4665],{"id":4664},"references","References",[389,4667,4668,4675,4682,4688,4694,4701,4708,4714,4720,4726,4732,4738,4744,4751,4758],{},[392,4669,4670],{},[591,4671,4674],{"href":4672,"rel":4673},"https://juejin.cn/post/7327094228350500914",[621],"Switching from node-sass to dart-sass - Juejin",[392,4676,4677],{},[591,4678,4681],{"href":4679,"rel":4680},"https://sunchenggit.github.io/2021/01/13/node-sass%E8%BF%81%E7%A7%BBdart-sass/",[621],"node-sass migration to dart-sass | Bolg",[392,4683,4684],{},[591,4685,4687],{"href":4027,"rel":4686},[621],"sass-loader | webpack Documentation",[392,4689,4690],{},[591,4691,4693],{"href":3950,"rel":4692},[621],"Sass: LibSass is Deprecated",[392,4695,4696],{},[591,4697,4700],{"href":4698,"rel":4699},"https://www.npmjs.com/package/sass?activeTab=versions",[621],"sass - npm",[392,4702,4703],{},[591,4704,4707],{"href":4705,"rel":4706},"https://www.npmjs.com/package/node-sass",[621],"node-sass - npm",[392,4709,4710],{},[591,4711,4713],{"href":4121,"rel":4712},[621],"About semantic versioning | npm Docs",[392,4715,4716],{},[591,4717,4719],{"href":4289,"rel":4718},[621],"Make /deep/ behave like the descendant combinator \" \" in CSS live profile - Chrome Platform Status",[392,4721,4722],{},[591,4723,4725],{"href":4015,"rel":4724},[621],"sass-loader/CHANGELOG.md at v8.0.0 · webpack-contrib/sass-loader",[392,4727,4728],{},[591,4729,4731],{"href":4493,"rel":4730},[621],"Release v16.1.2 · vuejs/vue-loader",[392,4733,4734],{},[591,4735,4737],{"href":4479,"rel":4736},[621],"refactor: use @vue/component-compiler-utils · vuejs/vue-loader@e32cd0e",[392,4739,4740],{},[591,4741,4743],{"href":4485,"rel":4742},[621],"chore: update @vue/component-compiler-utils to v3 · vuejs/vue-loader@c359a38",[392,4745,4746],{},[591,4747,4750],{"href":4748,"rel":4749},"https://github.com/vuejs/vue-cli/issues/3399#issuecomment-466319019",[621],"dart-sass does not support /deep/ selector · Issue #3399 · vuejs/vue-cli",[392,4752,4753],{},[591,4754,4757],{"href":4755,"rel":4756},"https://vue-loader-v14.vuejs.org/en/features/scoped-css.html",[621],"Scoped CSS · vue-loader v14",[392,4759,4760],{},[591,4761,4763],{"href":4511,"rel":4762},[621],"Migrating from v14 | Vue Loader",[547,4765,4766],{},"html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html pre.shiki code .sJa8x, html code.shiki .sJa8x{--shiki-default:#E45649;--shiki-dark:#E06C75}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .sW2Sy, html code.shiki .sW2Sy{--shiki-default:#A0A1A7;--shiki-default-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}",{"title":33,"searchDepth":96,"depth":96,"links":4768},[4769,4770,4771,4772,4777,4783,4787,4788],{"id":3927,"depth":96,"text":3928},{"id":3942,"depth":96,"text":3943},{"id":3961,"depth":96,"text":3962},{"id":3997,"depth":96,"text":3998,"children":4773},[4774,4775,4776],{"id":4001,"depth":3,"text":4002},{"id":4008,"depth":3,"text":4009},{"id":4082,"depth":3,"text":4082},{"id":4130,"depth":96,"text":4131,"children":4778},[4779,4780,4781,4782],{"id":4134,"depth":3,"text":4135},{"id":4162,"depth":3,"text":4163},{"id":4282,"depth":3,"text":4283},{"id":4333,"depth":3,"text":4334},{"id":4406,"depth":96,"text":4407,"children":4784},[4785,4786],{"id":4410,"depth":3,"text":4411},{"id":4504,"depth":3,"text":4505},{"id":4634,"depth":96,"text":4635},{"id":4664,"depth":96,"text":4665},{"title":4790,"date":4791,"path":4792,"tags":4793,"body":4795},"Quantum Mechanics in Frontend Development — The Bug That Vanishes as Soon as You Open F12","2025-06-08 01:22:13","/2025/06/08/front-end-bug-gone-when-open-devtool",[575,2527,3922,574,4794],"Debug",{"type":17,"value":4796,"toc":5460},[4797,4801,4813,4824,4826,4832,4839,4857,4861,4864,5019,5026,5032,5042,5045,5051,5054,5096,5104,5117,5120,5187,5193,5364,5384,5387,5391,5397,5412,5419,5426,5430,5457],[51,4798,4800],{"id":4799},"first-observation-of-the-frontend-quantum-state-phenomenon","First Observation of the Frontend \"Quantum State\" Phenomenon",[20,4802,4803,4804,4808,4809,4812],{},"This story sounds bizarre—even surreal. Half a month ago, while happily coding at my desk (with hotpot and songs in the background 🍲🎤), I stumbled upon a truly uncanny bug. As a bona fide human software engineer, writing bugs is normal—but this one defied all intuition: the moment I opened DevTools (F12) to inspect the relevant DOM structure, the bug ",[4805,4806,4807],"em",{},"vanished",". Close DevTools, hit Ctrl+F5 to hard-refresh, and ",[4805,4810,4811],{},"bam","—the bug reappeared.",[20,4814,4815,4816,1323,4819],{},"Below is a live demo embedded via ",[74,4817,4818],{},"\u003Ciframe>",[591,4820,4823],{"href":4821,"rel":4822},"https://static.031130.xyz/demo/scroll-jump-bug.html",[621],"demo",[3874,4825],{"src":4821,"width":3877,"height":3878,"allowFullScreen":128,"loading":3879},[20,4827,4828],{},[31,4829],{"alt":4830,"src":4831},"“How to Observe” Guide","https://static.031130.xyz/uploads/2025/06/08/65620d31fce6f.webp",[20,4833,4834,4835,4838],{},"This bug left me utterly bewildered. I’m no physicist—why did ",[24,4836,4837],{},"observer effect"," from quantum mechanics show up in my frontend code?! 🤯",[42,4840,4841,4851,4854],{},[20,4842,4843,4846,4847,4850],{},[24,4844,4845],{},"Observer effect",": the act of ",[4805,4848,4849],{},"observation"," inevitably influences the phenomenon being observed.",[20,4852,4853],{},"In quantum experiments—for example, to measure an electron’s velocity—you might fire two photons at it over a time interval. But the first photon already disturbs the electron’s motion, making the original velocity impossible to determine (Heisenberg’s uncertainty principle). Similarly, rapidly observing a decaying particle can apparently slow its decay rate.",[20,4855,4856],{},"— Wikipedia",[51,4858,4860],{"id":4859},"quantum-fog-browser-mechanics","Quantum Fog ❌ → Browser Mechanics ✅",[20,4862,4863],{},"Let’s briefly examine the problematic code snippet from the demo:",[79,4865,4867],{"className":797,"code":4866,"language":799,"meta":33,"style":33},"if (scrollIndex >= groupLength) {\n  setTimeout(() => {\n    wrapper.style.transition = \"none\";\n    scrollIndex = 0;\n    wrapper.style.transform = `translateY(-${scrollIndex * itemHeight}px)`;\n\n    requestAnimationFrame(() => {\n      wrapper.style.transition = \"transform 0.5s cubic-bezier(0.25, 0.1, 0.25, 1)\";\n    });\n  }, 500);\n}\n",[74,4868,4869,4887,4898,4919,4930,4965,4969,4980,5000,5005,5015],{"__ignoreMap":33},[87,4870,4871,4874,4876,4879,4882,4885],{"class":89,"line":90},[87,4872,4873],{"class":806},"if",[87,4875,1282],{"class":246},[87,4877,4878],{"class":893},"scrollIndex",[87,4880,4881],{"class":850}," >=",[87,4883,4884],{"class":893}," groupLength",[87,4886,1274],{"class":246},[87,4888,4889,4892,4894,4896],{"class":89,"line":96},[87,4890,4891],{"class":781},"  setTimeout",[87,4893,2131],{"class":246},[87,4895,2134],{"class":806},[87,4897,2048],{"class":246},[87,4899,4900,4903,4905,4907,4909,4912,4914,4917],{"class":89,"line":3},[87,4901,4902],{"class":918},"    wrapper",[87,4904,65],{"class":246},[87,4906,547],{"class":1346},[87,4908,65],{"class":246},[87,4910,4911],{"class":250},"transition",[87,4913,851],{"class":850},[87,4915,4916],{"class":261}," \"none\"",[87,4918,2670],{"class":246},[87,4920,4921,4924,4926,4928],{"class":89,"line":107},[87,4922,4923],{"class":893},"    scrollIndex",[87,4925,851],{"class":850},[87,4927,3173],{"class":254},[87,4929,2670],{"class":246},[87,4931,4932,4934,4936,4938,4940,4943,4945,4948,4950,4952,4955,4958,4960,4963],{"class":89,"line":113},[87,4933,4902],{"class":918},[87,4935,65],{"class":246},[87,4937,547],{"class":1346},[87,4939,65],{"class":246},[87,4941,4942],{"class":250},"transform",[87,4944,851],{"class":850},[87,4946,4947],{"class":261}," `translateY(-",[87,4949,1868],{"class":1867},[87,4951,4878],{"class":893},[87,4953,4954],{"class":850}," *",[87,4956,4957],{"class":893}," itemHeight",[87,4959,1878],{"class":1867},[87,4961,4962],{"class":261},"px)`",[87,4964,2670],{"class":246},[87,4966,4967],{"class":89,"line":119},[87,4968,129],{"emptyLinePlaceholder":128},[87,4970,4971,4974,4976,4978],{"class":89,"line":125},[87,4972,4973],{"class":781},"    requestAnimationFrame",[87,4975,2131],{"class":246},[87,4977,2134],{"class":806},[87,4979,2048],{"class":246},[87,4981,4982,4985,4987,4989,4991,4993,4995,4998],{"class":89,"line":132},[87,4983,4984],{"class":918},"      wrapper",[87,4986,65],{"class":246},[87,4988,547],{"class":1346},[87,4990,65],{"class":246},[87,4992,4911],{"class":250},[87,4994,851],{"class":850},[87,4996,4997],{"class":261}," \"transform 0.5s cubic-bezier(0.25, 0.1, 0.25, 1)\"",[87,4999,2670],{"class":246},[87,5001,5002],{"class":89,"line":138},[87,5003,5004],{"class":246},"    });\n",[87,5006,5007,5010,5013],{"class":89,"line":144},[87,5008,5009],{"class":246},"  }, ",[87,5011,5012],{"class":254},"500",[87,5014,2706],{"class":246},[87,5016,5017],{"class":89,"line":150},[87,5018,1226],{"class":246},[20,5020,5021,5022,5025],{},"The requirement was to implement an ",[4805,5023,5024],{},"infinite vertical scrolling"," title list. Three titles are shown at a time; every 2 seconds, the list scrolls up as a group—the top item exits view, and a new item enters from below (again, the demo clarifies this visually).",[20,5027,5028,5029,5031],{},"When reaching the bottom, we disable CSS transitions, instantly relocate (",[74,5030,4942],{},") the wrapper back to the “top” of the logical loop (i.e., visually reset to the same three titles), then re-enable transitions—creating a seamless infinite loop illusion.",[20,5033,5034,5035,5038,5039,65],{},"But here’s the twist: even though we explicitly set ",[74,5036,5037],{},"transition: none",", the jump ",[4805,5040,5041],{},"still exhibited a transition animation",[20,5043,5044],{},"Frankly, this was the most despair-inducing bug in my short dev career. Not only was the behavior seemingly supernatural, but searching online felt hopeless—I didn’t even know how to phrase the issue!",[20,5046,5047],{},[31,5048],{"alt":5049,"src":5050},"This is Xiao Maicha, the senior who got me into frontend development","https://static.031130.xyz/uploads/2025/06/08/475a61b332454.webp",[20,5052,5053],{},"Out of desperation, I fed the code to ChatGPT-4o—and got a lifeline:",[42,5055,5056,5075],{},[20,5057,5058,5059,5062,5063,5066,5067,5070,5071,5074],{},"The phenomenon you describe — “",[24,5060,5061],{},"a jarring upward jump on the 9th scroll",", which ",[24,5064,5065],{},"disappears when DevTools is open","” — is almost certainly due to ",[24,5068,5069],{},"frame skipping"," (frame rate fluctuations) or ",[24,5072,5073],{},"timer precision issues"," in the browser’s rendering pipeline.",[20,5076,5077,5078,5081,5082,5084,5085,5088,5089,642,5092,5095],{},"Such bugs commonly arise when combining ",[74,5079,5080],{},"setInterval","-driven animation with improperly timed style switches (e.g., ",[74,5083,4911],{}," toggles), causing ",[4805,5086,5087],{},"transition frame skips",". Opening DevTools often ",[24,5090,5091],{},"forces frame redraws",[24,5093,5094],{},"increases timer resolution",", thereby masking the issue.",[51,5097,5099,5100,5103],{"id":5098},"great-news-requestanimationframe-to-the-rescue","Great News: ",[74,5101,5102],{},"requestAnimationFrame"," to the Rescue! 🎉",[42,5105,5106,5114],{},[20,5107,5108,5113],{},[24,5109,5110],{},[74,5111,5112],{},"window.requestAnimationFrame()"," tells the browser you wish to perform an animation and requests that the browser call a specified function to update an animation before the next repaint.",[20,5115,5116],{},"— MDN",[20,5118,5119],{},"Here’s the fix suggested by GPT—simple yet highly effective:",[79,5121,5123],{"className":4166,"code":5122,"language":4168,"meta":33,"style":33},"if (scrollIndex >= groupLength) {\n  setTimeout(() => {\n    wrapper.style.transition = \"none\";\n    scrollIndex = 0;\n    wrapper.style.transform = `translateY(-${scrollIndex * itemHeight}px)`;\n\n    requestAnimationFrame(() => {\n+     requestAnimationFrame(() => {\n        wrapper.style.transition = \"transform 0.5s cubic-bezier(0.25, 0.1, 0.25, 1)\";\n+     });\n    });\n  }, 500);\n}\n",[74,5124,5125,5130,5135,5140,5145,5150,5154,5159,5164,5169,5174,5178,5183],{"__ignoreMap":33},[87,5126,5127],{"class":89,"line":90},[87,5128,5129],{"class":246},"if (scrollIndex >= groupLength) {\n",[87,5131,5132],{"class":89,"line":96},[87,5133,5134],{"class":246},"  setTimeout(() => {\n",[87,5136,5137],{"class":89,"line":3},[87,5138,5139],{"class":246},"    wrapper.style.transition = \"none\";\n",[87,5141,5142],{"class":89,"line":107},[87,5143,5144],{"class":246},"    scrollIndex = 0;\n",[87,5146,5147],{"class":89,"line":113},[87,5148,5149],{"class":246},"    wrapper.style.transform = `translateY(-${scrollIndex * itemHeight}px)`;\n",[87,5151,5152],{"class":89,"line":119},[87,5153,129],{"emptyLinePlaceholder":128},[87,5155,5156],{"class":89,"line":125},[87,5157,5158],{"class":246},"    requestAnimationFrame(() => {\n",[87,5160,5161],{"class":89,"line":132},[87,5162,5163],{"class":261},"+     requestAnimationFrame(() => {\n",[87,5165,5166],{"class":89,"line":138},[87,5167,5168],{"class":246},"        wrapper.style.transition = \"transform 0.5s cubic-bezier(0.25, 0.1, 0.25, 1)\";\n",[87,5170,5171],{"class":89,"line":144},[87,5172,5173],{"class":261},"+     });\n",[87,5175,5176],{"class":89,"line":150},[87,5177,5004],{"class":246},[87,5179,5180],{"class":89,"line":156},[87,5181,5182],{"class":246},"  }, 500);\n",[87,5184,5185],{"class":89,"line":162},[87,5186,1226],{"class":246},[20,5188,5189,5190,5192],{},"If nested ",[74,5191,5102],{}," calls feel confusing, here’s an equivalent—but clearer—version:",[79,5194,5196],{"className":797,"code":5195,"language":799,"meta":33,"style":33},"if (scrollIndex >= groupLength) {\n  setTimeout(() => {\n    scrollIndex = 0;\n\n    requestAnimationFrame(() => {\n      // Frame 1: Apply instant jump (no transition)\n      wrapper.style.transition = \"none\";\n      wrapper.style.transform = `translateY(-${scrollIndex * itemHeight}px)`;\n\n      // Enqueue next frame\n      requestAnimationFrame(() => {\n        // Frame 2: Re-enable smooth transition\n        wrapper.style.transition = \"transform 0.5s cubic-bezier(0.25, 0.1, 0.25, 1)\";\n      });\n    });\n  }, 500);\n}\n",[74,5197,5198,5212,5222,5232,5236,5246,5251,5269,5299,5303,5308,5319,5324,5343,5348,5352,5360],{"__ignoreMap":33},[87,5199,5200,5202,5204,5206,5208,5210],{"class":89,"line":90},[87,5201,4873],{"class":806},[87,5203,1282],{"class":246},[87,5205,4878],{"class":893},[87,5207,4881],{"class":850},[87,5209,4884],{"class":893},[87,5211,1274],{"class":246},[87,5213,5214,5216,5218,5220],{"class":89,"line":96},[87,5215,4891],{"class":781},[87,5217,2131],{"class":246},[87,5219,2134],{"class":806},[87,5221,2048],{"class":246},[87,5223,5224,5226,5228,5230],{"class":89,"line":3},[87,5225,4923],{"class":893},[87,5227,851],{"class":850},[87,5229,3173],{"class":254},[87,5231,2670],{"class":246},[87,5233,5234],{"class":89,"line":107},[87,5235,129],{"emptyLinePlaceholder":128},[87,5237,5238,5240,5242,5244],{"class":89,"line":113},[87,5239,4973],{"class":781},[87,5241,2131],{"class":246},[87,5243,2134],{"class":806},[87,5245,2048],{"class":246},[87,5247,5248],{"class":89,"line":119},[87,5249,5250],{"class":869},"      // Frame 1: Apply instant jump (no transition)\n",[87,5252,5253,5255,5257,5259,5261,5263,5265,5267],{"class":89,"line":125},[87,5254,4984],{"class":918},[87,5256,65],{"class":246},[87,5258,547],{"class":1346},[87,5260,65],{"class":246},[87,5262,4911],{"class":250},[87,5264,851],{"class":850},[87,5266,4916],{"class":261},[87,5268,2670],{"class":246},[87,5270,5271,5273,5275,5277,5279,5281,5283,5285,5287,5289,5291,5293,5295,5297],{"class":89,"line":132},[87,5272,4984],{"class":918},[87,5274,65],{"class":246},[87,5276,547],{"class":1346},[87,5278,65],{"class":246},[87,5280,4942],{"class":250},[87,5282,851],{"class":850},[87,5284,4947],{"class":261},[87,5286,1868],{"class":1867},[87,5288,4878],{"class":893},[87,5290,4954],{"class":850},[87,5292,4957],{"class":893},[87,5294,1878],{"class":1867},[87,5296,4962],{"class":261},[87,5298,2670],{"class":246},[87,5300,5301],{"class":89,"line":138},[87,5302,129],{"emptyLinePlaceholder":128},[87,5304,5305],{"class":89,"line":144},[87,5306,5307],{"class":869},"      // Enqueue next frame\n",[87,5309,5310,5313,5315,5317],{"class":89,"line":150},[87,5311,5312],{"class":781},"      requestAnimationFrame",[87,5314,2131],{"class":246},[87,5316,2134],{"class":806},[87,5318,2048],{"class":246},[87,5320,5321],{"class":89,"line":156},[87,5322,5323],{"class":869},"        // Frame 2: Re-enable smooth transition\n",[87,5325,5326,5329,5331,5333,5335,5337,5339,5341],{"class":89,"line":162},[87,5327,5328],{"class":918},"        wrapper",[87,5330,65],{"class":246},[87,5332,547],{"class":1346},[87,5334,65],{"class":246},[87,5336,4911],{"class":250},[87,5338,851],{"class":850},[87,5340,4997],{"class":261},[87,5342,2670],{"class":246},[87,5344,5345],{"class":89,"line":168},[87,5346,5347],{"class":246},"      });\n",[87,5349,5350],{"class":89,"line":174},[87,5351,5004],{"class":246},[87,5353,5354,5356,5358],{"class":89,"line":180},[87,5355,5009],{"class":246},[87,5357,5012],{"class":254},[87,5359,2706],{"class":246},[87,5361,5362],{"class":89,"line":186},[87,5363,1226],{"class":246},[20,5365,5366,5367,5370,5371,5373,5374,5376,5377,5380,5381,5383],{},"The core idea: we must ",[4805,5368,5369],{},"guarantee"," that setting the new ",[74,5372,4942],{}," (the “teleport”) and re-enabling ",[74,5375,4911],{}," happen in ",[4805,5378,5379],{},"separate animation frames",". Two nested ",[74,5382,5102],{}," calls ensure exactly that.",[3874,5385],{"src":5386,"width":3877,"height":3878,"allowFullScreen":128,"loading":3879},"https://static.031130.xyz/demo/scroll-jump-bug-fixed.html",[51,5388,5390],{"id":5389},"taming-the-quantum-state-a-new-skill-for-frontend-developers","Taming the Quantum State: A New Skill for Frontend Developers",[20,5392,5393,5394,5396],{},"With double ",[74,5395,5102],{},", we’ve successfully tamed this “quantum” bug. Now, regardless of whether DevTools is open, the animation behaves consistently—no more vanishing acts.",[20,5398,5399,5400,5404,5405,5408,5409,5411],{},"So it turns out: in frontend development, we need not just JavaScript expertise—",[5401,5402,5403],"del",{},"but perhaps a dash of quantum mechanics, too",". 😉\nNext time you encounter a bug that “collapses upon observation”, try this ",[24,5406,5407],{},"“quantum entanglement solution”",": double ",[74,5410,5102],{},"—it might just decohere your bug from a probabilistic “quantum state” into a deterministic “classical state”.",[20,5413,5414,5415,5418],{},"And if you’ve battled even weirder bugs—please share! After all, in the universe of code, we never know what exotic form the next bug will take. Perhaps, that’s precisely where the ",[4805,5416,5417],{},"fun"," of programming lies. 🐛✨",[42,5420,5421],{},[20,5422,5423],{},[4805,5424,5425],{},"This article was co-authored with assistance from ChatGPT and DeepSeek—but the bug? Sadly, 100% real (and tearful).",[51,5427,5429],{"id":5428},"see-also","See Also",[389,5431,5432,5439,5449],{},[392,5433,5434],{},[591,5435,5438],{"href":5436,"rel":5437},"https://en.wikipedia.org/wiki/Observer_effect_(physics)",[621],"Observer Effect — Wikipedia",[392,5440,5441],{},[591,5442,5445,5448],{"href":5443,"rel":5444},"https://developer.mozilla.org/en-US/docs/Web/API/Window/requestAnimationFrame",[621],[74,5446,5447],{},"Window.requestAnimationFrame()"," — MDN Web Docs",[392,5450,5451,5456],{},[591,5452,5455],{"href":5453,"rel":5454},"https://www.ruanyifeng.com/blog/2015/09/web-page-performance-in-depth.html",[621],"A Deep Dive into Web Page Performance — Ruan Yifeng’s Blog","\"",[547,5458,5459],{},"html pre.shiki code .sLKXg, html code.shiki .sLKXg{--shiki-default:#A626A4;--shiki-dark:#C678DD}html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html pre.shiki code .sz0mV, html code.shiki .sz0mV{--shiki-default:#383A42;--shiki-dark:#E06C75}html pre.shiki code .s_Sar, html code.shiki .s_Sar{--shiki-default:#0184BC;--shiki-dark:#56B6C2}html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .s7GmK, html code.shiki .s7GmK{--shiki-default:#383A42;--shiki-dark:#E5C07B}html pre.shiki code .s2QsP, html code.shiki .s2QsP{--shiki-default:#E45649;--shiki-dark:#E5C07B}html pre.shiki code .sJa8x, html code.shiki .sJa8x{--shiki-default:#E45649;--shiki-dark:#E06C75}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html pre.shiki code .sAOjX, html code.shiki .sAOjX{--shiki-default:#CA1243;--shiki-dark:#C678DD}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html pre.shiki code .sW2Sy, html code.shiki .sW2Sy{--shiki-default:#A0A1A7;--shiki-default-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic}",{"title":33,"searchDepth":96,"depth":96,"links":5461},[5462,5463,5464,5466,5467],{"id":4799,"depth":96,"text":4800},{"id":4859,"depth":96,"text":4860},{"id":5098,"depth":96,"text":5465},"Great News: requestAnimationFrame to the Rescue! 🎉",{"id":5389,"depth":96,"text":5390},{"id":5428,"depth":96,"text":5429},{"title":5469,"date":5470,"path":5471,"tags":5472,"body":5473},"In 2025, How to Choose the Right Video Compression Algorithm for Web Pages?","2025-06-02 20:59:10","/2025/06/02/choosing-the-right-video-compression-format-for-web-in-2025",[2527,575,13],{"type":17,"value":5474,"toc":6180},[5475,5478,5482,5486,5489,5497,5511,5517,5535,5540,5544,5547,5561,5564,5570,5574,5584,5589,5592,5598,5616,5620,5623,5637,5640,5647,5650,5654,5657,5805,5809,5812,5818,5831,5835,5846,5931,5934,5937,5956,5960,5966,5974,5980,5984,5994,6000,6003,6007,6010,6020,6041,6043,6177],[20,5476,5477],{},"The issue arose from the need to display a ~5‑minute product showcase video on a webpage. The original H.264-encoded file weighed 60 MB, with a bitrate of 1646 kbps—impractical for network delivery: not only does it inflate CDN bandwidth costs, but it also severely degrades the user experience under weak network conditions. Thus, we must compress the video using more modern codecs while ensuring broad browser compatibility (fortunately, IE is no longer a concern).",[51,5479,5481],{"id":5480},"what-are-the-mainstream-compression-algorithms-today","What Are the Mainstream Compression Algorithms Today?",[224,5483,5485],{"id":5484},"av1","AV1",[20,5487,5488],{},"As of 2025, AV1 stands as the most compression-efficient mainstream video codec. It has been fully adopted by major platforms such as YouTube, Netflix, and Bilibili, making it the top choice for new deployments. Beyond its superior compression, AV1’s royalty-free status encourages hardware vendors and browser developers to integrate support freely—both in hardware and software.",[20,5490,5491,5494],{},[31,5492],{"alt":33,"src":5493},"https://static.031130.xyz/uploads/2025/06/02/aec1af1718064.webp",[31,5495],{"alt":33,"src":5496},"https://static.031130.xyz/uploads/2025/06/02/76a312b5a668b.webp",[20,5498,5499,5500,5503,5504,5507,5508],{},"Unfortunately, Safari still lacks ",[4805,5501,5502],{},"software"," decoding for AV1. Only Apple devices with M3 (or later) chips and iPhone 15 Pro (or later) support ",[4805,5505,5506],{},"hardware"," AV1 decoding. Older Apple devices simply cannot play AV1 videos in Safari.\n",[4805,5509,5510],{},"(Let’s just say Safari has become the modern-day IE—a clear roadblock to Web advancement.)",[20,5512,5513],{},[31,5514],{"alt":5515,"src":5516},"Safari fails outright on a MacBook Pro with an M2 Pro chip.","https://static.031130.xyz/uploads/2025/06/02/01ddcc3948406.webp",[20,5518,5519,5520,5522,5523,5526,5527,5530,5531,5534],{},"Beyond playback compatibility, AV1 encoding is demanding. Among consumer GPUs, only NVIDIA RTX 40-series, AMD RX 7000-series, and Intel Arc A380 (and newer) support ",[4805,5521,5506],{}," AV1 ",[4805,5524,5525],{},"encoding",". Apple’s M-series chips still offer ",[4805,5528,5529],{},"no"," AV1 encoding hardware acceleration whatsoever. On my ThinkPad with an Intel Core i7‑1165G7, software encoding via ",[74,5532,5533],{},"libaom-av1"," crawls at ~0.0025× real-time speed—compressing a 5‑minute 1080p video takes over a full day.",[20,5536,5537],{},[31,5538],{"alt":33,"src":5539},"https://static.031130.xyz/uploads/2025/06/02/923ca02e1d835.webp",[224,5541,5543],{"id":5542},"h265-hevc","H.265 / HEVC",[20,5545,5546],{},"As the official successor to H.264, HEVC (H.265) has arguably squandered its potential. It is governed by multiple patent pools (e.g., MPEG LA, HEVC Advance, Velos Media), resulting in fragmented and costly licensing terms. These high licensing fees have drastically limited its adoption—especially in open ecosystems and web contexts.",[20,5548,5549,5550,5553,5554,5556,5557,5560],{},"Chromium and Firefox refuse to shoulder HEVC licensing costs, so they do ",[4805,5551,5552],{},"not"," ship with built-in HEVC ",[4805,5555,5502],{}," decoders. Browsers today generally follow a ",[24,5558,5559],{},"“hardware decode if possible; otherwise, give up”"," policy. Firefox on Linux, however, tries a workaround: if hardware decode fails, it leverages system-installed FFmpeg for software decoding. Fortunately, HEVC—standardized in 2013—has now gained near-universal hardware decode support: Apple treats HEVC as a first-class citizen, supporting it across its entire product lineup.",[20,5562,5563],{},"Uncovered edge cases remain: Chromium/Firefox on Windows 7, and Chromium on Linux (including domestic Chinese distros like UOS and Kylin).",[20,5565,5566],{},[31,5567],{"alt":5568,"src":5569},"Chrome on Linux, lacking HEVC hardware decode, mistakenly treats the video as audio-only.","https://static.031130.xyz/uploads/2025/06/02/2e8e5100f645a.webp",[224,5571,5573],{"id":5572},"vp9","VP9",[20,5575,5576,5577,5580,5581],{},"VP9, introduced by Google in 2013, serves as one of H.264’s successors. Its compression efficiency rivals HEVC—yet its biggest advantage is being ",[24,5578,5579],{},"completely royalty-free",". VP9 was Google’s defiant response to HEVC’s licensing hurdles: ",[4805,5582,5583],{},"“You keep feasting on royalties; I’ll host a free buffet.”",[20,5585,5586],{},[31,5587],{"alt":33,"src":5588},"https://static.031130.xyz/uploads/2025/06/03/a9b473a3bd120.webp",[20,5590,5591],{},"Thanks to its zero-cost licensing and aggressive promotion across Google’s ecosystem (YouTube, WebRTC, Chrome), VP9 quickly became the de facto standard for web video—especially before AV1’s rise. In fact, it even pressured Apple—longtime gatekeeper of proprietary codecs—to add VP9 support to Safari in macOS 11 (Big Sur) and iOS 14 (though WebM container support arrived slightly later).",[20,5593,5594,5595,5597],{},"VP9 enjoys near-universal ",[4805,5596,5502],{}," decode support: Chromium, Firefox, Edge, and even Safari include native support. Hardware decode support is also widespread: Intel Skylake (6th Gen Core) and later, NVIDIA GTX 950+, and AMD Vega/RDNA GPUs all support full VP9 decode. Unless you're running museum-grade hardware, VP9 playback “just works.”",[20,5599,5600,5601,5604,5605,3110,5608,5611,5612,5615],{},"Encoding remains VP9’s weak point—Google’s reference encoder, ",[74,5602,5603],{},"libvpx",", lags behind ",[74,5606,5607],{},"x264",[74,5609,5610],{},"x265"," in speed. Without hardware acceleration, VP9 encoding can still take hours. Still, compared to AV1, VP9 is far more usable: Intel introduced VP9 ",[4805,5613,5614],{},"hardware encoding"," as early as Kaby Lake (7th Gen Core), and vendor support has matured significantly since.",[224,5617,5619],{"id":5618},"h264-avc","H.264 / AVC",[20,5621,5622],{},"H.264—the venerable veteran—remains the undisputed champion of video codecs over the past two decades. Since its standardization in 2003, it has dominated everything: web streaming, Blu-ray, live broadcasts, surveillance, and smartphone recording.",[20,5624,5625,5626,5629,5630,5633,5634,5636],{},"Its unbeatable strength? ",[24,5627,5628],{},"Universal compatibility",". Almost any screen-equipped device can decode H.264. ",[4805,5631,5632],{},"Software"," decode has been standard in browsers and players for well over a decade; ",[4805,5635,5506],{}," decode dates back to Intel Sandy Bridge, NVIDIA Fermi, AMD VLIW4—and even Raspberry Pis or smart refrigerators can handle it.",[20,5638,5639],{},"While H.264 does involve patents, its licensing is comparatively pragmatic: MPEG LA’s pool is affordable, and free online video streaming incurs no fees. Thus, Chromium, Firefox, Safari, and Edge all ship with H.264 software decode built in.",[20,5641,5642,5643,5646],{},"That said, as a 20‑year‑old codec, H.264 lags far behind VP9, HEVC, and AV1 in compression efficiency. At equivalent quality, H.264 typically needs 30–50% higher bitrates than AV1—making it suboptimal for bandwidth- or storage-constrained scenarios. Yet in today’s pragmatic world—where ",[4805,5644,5645],{},"playability beats perfection","—H.264 remains the default fallback, the “reliable old workhorse”.",[20,5648,5649],{},"So even as AV1, HEVC, and VP9 gain ground, H.264 retains its central role in the video ecosystem—so long as some browsers lack AV1 support (looking at you, Safari), servers want to avoid costly transcoding, or users still run legacy devices.",[224,5651,5653],{"id":5652},"summary","Summary",[20,5655,5656],{},"Browsers can no longer singlehandedly abstract away hardware and OS discrepancies. Real-world edge cases persist beyond what compatibility tables can capture.",[5658,5659,5660,5685],"table",{},[5661,5662,5663],"thead",{},[5664,5665,5666,5670,5673,5676,5679,5682],"tr",{},[5667,5668,5669],"th",{},"Codec",[5667,5671,5672],{},"Compression Efficiency",[5667,5674,5675],{},"Browser Support",[5667,5677,5678],{},"Desktop Support",[5667,5680,5681],{},"Mobile Support",[5667,5683,5684],{},"Notes",[5686,5687,5688,5713,5728,5749,5765,5784],"tbody",{},[5664,5689,5690,5695,5698,5701,5704,5707],{},[5691,5692,5693],"td",{},[24,5694,5485],{},[5691,5696,5697],{},"★★★",[5691,5699,5700],{},"Chrome / Chromium: ✅ v70+ (Oct 2018)",[5691,5702,5703],{},"✅ (hardware preferred, software fallback)",[5691,5705,5706],{},"✅",[5691,5708,5709,5710],{},"Safari: hardware-only (M3/A17 Pro+); ",[24,5711,5712],{},"no software decode",[5664,5714,5715,5717,5719,5722,5724,5726],{},[5691,5716],{},[5691,5718],{},[5691,5720,5721],{},"Firefox: ✅ v67+ (May 2019) desktop; ✅ v113+ (May 2023) Android",[5691,5723],{},[5691,5725],{},[5691,5727],{},[5664,5729,5730,5735,5738,5741,5744,5746],{},[5691,5731,5732],{},[24,5733,5734],{},"HEVC (H.265)",[5691,5736,5737],{},"★★☆",[5691,5739,5740],{},"Chrome / Chromium: ⚠️ hardware decode only (no software, unless via MS Store plugin on Windows)",[5691,5742,5743],{},"⚠️",[5691,5745,5743],{},[5691,5747,5748],{},"Firefox: hardware decode only; Linux may fall back to system FFmpeg",[5664,5750,5751,5753,5755,5758,5760,5762],{},[5691,5752],{},[5691,5754],{},[5691,5756,5757],{},"Safari: ✅ full support (macOS 10.13+/iOS 11+, 2017)",[5691,5759],{},[5691,5761],{},[5691,5763,5764],{},"Apple is HEVC’s strongest advocate",[5664,5766,5767,5771,5773,5776,5779,5781],{},[5691,5768,5769],{},[24,5770,5573],{},[5691,5772,5737],{},[5691,5774,5775],{},"Chrome / Chromium / Firefox / Edge: ✅",[5691,5777,5778],{},"✅ (Intel Skylake+, NVIDIA GTX 950+, AMD Vega/RDNA)",[5691,5780,5706],{},[5691,5782,5783],{},"Safari: ✅ (v14.1+/iOS 17.4+, 2021–2024; WebM support slightly later)",[5664,5785,5786,5791,5794,5797,5800,5802],{},[5691,5787,5788],{},[24,5789,5790],{},"H.264 (AVC)",[5691,5792,5793],{},"★☆☆",[5691,5795,5796],{},"✅ All major browsers (desktop & mobile)",[5691,5798,5799],{},"✅ (Intel Sandy Bridge+, NVIDIA Fermi+, AMD VLIW4+, Raspberry Pi, etc.)",[5691,5801,5706],{},[5691,5803,5804],{},"Universal fallback; “if it plays anywhere, it’s H.264”",[51,5806,5808],{"id":5807},"how-to-choose","How to Choose?",[20,5810,5811],{},"We aren’t a professional video platform like YouTube or Bilibili, capable of offering users multiple resolutions and codec options.",[20,5813,5814],{},[31,5815],{"alt":5816,"src":5817},"Bilibili offers three codec options for the same video.","https://static.031130.xyz/uploads/2025/06/03/096484dbc0f3a.webp",[20,5819,5820,5821,962,5824,5827,5828,65],{},"Our final strategy must balance ",[24,5822,5823],{},"compression efficiency",[24,5825,5826],{},"playback compatibility",", and ",[24,5829,5830],{},"encoding time",[224,5832,5834],{"id":5833},"option-1-av1-as-primary-h264-as-fallback","Option 1: AV1 as Primary, H.264 as Fallback",[20,5836,5837,5838,5841,5842,5845],{},"Modern browsers support multiple ",[74,5839,5840],{},"\u003Csource>"," elements inside ",[74,5843,5844],{},"\u003Cvideo>",", letting the browser pick the first playable one:",[79,5847,5849],{"className":237,"code":5848,"language":239,"meta":33,"style":33},"\u003Cvideo controls poster=\"preview.jpg\">\n  \u003Csource src=\"video.av1.webm\" type='video/webm; codecs=\"av01\"' />\n  \u003Csource src=\"video.h264.mp4\" type='video/mp4; codecs=\"avc1\"' />\n  Your browser does not support video playback.\n\u003C/video>\n",[74,5850,5851,5871,5896,5918,5923],{"__ignoreMap":33},[87,5852,5853,5855,5858,5861,5864,5866,5869],{"class":89,"line":90},[87,5854,247],{"class":246},[87,5856,5857],{"class":250},"video",[87,5859,5860],{"class":254}," controls",[87,5862,5863],{"class":254}," poster",[87,5865,258],{"class":246},[87,5867,5868],{"class":261},"\"preview.jpg\"",[87,5870,273],{"class":246},[87,5872,5873,5875,5878,5881,5883,5886,5889,5891,5894],{"class":89,"line":96},[87,5874,1926],{"class":246},[87,5876,5877],{"class":250},"source",[87,5879,5880],{"class":254}," src",[87,5882,258],{"class":246},[87,5884,5885],{"class":261},"\"video.av1.webm\"",[87,5887,5888],{"class":254}," type",[87,5890,258],{"class":246},[87,5892,5893],{"class":261},"'video/webm; codecs=\"av01\"'",[87,5895,1940],{"class":246},[87,5897,5898,5900,5902,5904,5906,5909,5911,5913,5916],{"class":89,"line":3},[87,5899,1926],{"class":246},[87,5901,5877],{"class":250},[87,5903,5880],{"class":254},[87,5905,258],{"class":246},[87,5907,5908],{"class":261},"\"video.h264.mp4\"",[87,5910,5888],{"class":254},[87,5912,258],{"class":246},[87,5914,5915],{"class":261},"'video/mp4; codecs=\"avc1\"'",[87,5917,1940],{"class":246},[87,5919,5920],{"class":89,"line":107},[87,5921,5922],{"class":246},"  Your browser does not support video playback.\n",[87,5924,5925,5927,5929],{"class":89,"line":113},[87,5926,1945],{"class":246},[87,5928,5857],{"class":250},[87,5930,273],{"class":246},[20,5932,5933],{},"This approach leverages AV1 for bandwidth savings on modern devices, while H.264 ensures compatibility on older browsers (e.g., legacy Safari). No JavaScript or complex detection logic is needed.",[20,5935,5936],{},"However, this may not be ideal for us:",[389,5938,5939,5946,5949],{},[392,5940,5941,5942,5945],{},"My top-end Apple M4 MacBook still lacks ",[4805,5943,5944],{},"AV1 hardware encoding","—a 5‑minute encode takes ~3 hours via software.",[392,5947,5948],{},"Iterative tuning (adjusting CRF, bitrate, etc.) would be painfully slow.",[392,5950,5951,5952,5955],{},"Even with AV1 ",[4805,5953,5954],{},"decode"," supported in Chromium/Firefox, older hardware may suffer high CPU usage—leading to fan noise and complaints (as seen during YouTube’s AV1 rollout).",[224,5957,5959],{"id":5958},"option-2-vp9-as-the-sole-choice","Option 2: VP9 as the Sole Choice",[20,5961,5962,5963,5965],{},"Given AV1’s encoding costs and playback burdens, VP9 emerges as a compelling alternative. Its browser support is robust, eliminating the need for an H.264 fallback. Moreover, VP9 ",[4805,5964,5614],{}," is now widely available on recent CPUs/GPUs—enabling rapid iteration to find the optimal trade-off between file size and visual quality.",[42,5967,5968],{},[20,5969,5970,5973],{},[4805,5971,5972],{},"Note",": While VP9 is most commonly packaged in WebM, the Opus audio codec (standard in WebM) still has spotty Safari support (only since Safari 17.4, March 2024). Consider using AAC audio in an MP4 container for broader compatibility.",[20,5975,5976],{},[31,5977],{"alt":5978,"src":5979},"Opus audio codec browser support (Can I Use)","https://static.031130.xyz/uploads/2025/06/03/ec3b5dbcbcc29.webp",[51,5981,5983],{"id":5982},"audio-bitrate-too-high-trim-it-further","Audio Bitrate Too High? Trim It Further",[20,5985,5986,5987,5989,5990,5993],{},"So far, we’ve focused on ",[4805,5988,5857],{}," compression, but the ",[4805,5991,5992],{},"audio"," track offers room for savings too.",[79,5995,5998],{"className":5996,"code":5997,"language":1248},[4518],"Stream #0:1[0x2](und): Audio: aac (LC) (mp4a / 0x6134706D), 48000 Hz, stereo, fltp, 128 kb/s (default)\n",[74,5999,5997],{"__ignoreMap":33},[20,6001,6002],{},"For a product demo video, 128 kbps stereo AAC is excessive. Switching to 64 kbps mono saved an additional ~2 MB—without perceptible quality loss in narration-heavy content.",[51,6004,6006],{"id":6005},"final-thoughts","Final Thoughts",[20,6008,6009],{},"For frontend developers, selecting a video codec is no longer just about “smallest file size”. It’s a balancing act among device capabilities, browser support, user experience, and development overhead.",[20,6011,6012,6013,6016,6017,6019],{},"We must embrace modern codecs like AV1 and VP9 ",[4805,6014,6015],{},"where feasible",", yet remain grounded in real-world constraints. HTML5’s ",[74,6018,5840],{}," fallback mechanism empowers us to deliver elegant, resilient video experiences—even as the underlying codec landscape fragments.",[20,6021,6022,6023,6026,6027,6030,6031,6033,6034,6036,6037,6040],{},"After all, the Web has never lacked ",[4805,6024,6025],{},"possibility","—what’s rare is ",[4805,6028,6029],{},"elegance in execution",". If codec development is the domain of hardware engineers and video platforms, then those few lines of ",[74,6032,5840],{}," within a ",[74,6035,5844],{}," tag?\nThat’s ",[4805,6038,6039],{},"our"," trench—the frontend engineer’s battlefield.",[51,6042,4665],{"id":4664},[389,6044,6045,6052,6059,6066,6073,6080,6087,6094,6101,6108,6115,6122,6129,6136,6143,6150,6160,6167,6174],{},[392,6046,6047],{},[591,6048,6051],{"href":6049,"rel":6050},"https://developer.mozilla.org/zh-CN/docs/Web/Media/Guides/Formats/Video_codecs",[621],"网页视频编码指南 - Web 媒体技术 | MDN",[392,6053,6054],{},[591,6055,6058],{"href":6056,"rel":6057},"https://research.netflix.com/research-area/video-encoding-and-quality",[621],"Encoding & Quality - Netflix Research",[392,6060,6061],{},[591,6062,6065],{"href":6063,"rel":6064},"https://optiview.dolby.com/resources/blog/playback/how-the-vp9-codec-supports-now-streaming-to-apple-devices-more/",[621],"How the VP9 Codec Supports Now Streaming to Apple Devices & More | dolby.io",[392,6067,6068],{},[591,6069,6072],{"href":6070,"rel":6071},"https://www.chromium.org/audio-video/",[621],"Audio/Video | The Chromium Project",[392,6074,6075],{},[591,6076,6079],{"href":6077,"rel":6078},"https://caniuse.com/av1",[621],"AV1 video format | Can I use... Support tables for HTML5, CSS3, etc",[392,6081,6082],{},[591,6083,6086],{"href":6084,"rel":6085},"https://caniuse.com/webm",[621],"WebM video format | Can I use... Support tables for HTML5, CSS3, etc",[392,6088,6089],{},[591,6090,6093],{"href":6091,"rel":6092},"https://caniuse.com/hevc",[621],"HEVC/H.265 video format | Can I use... Support tables for HTML5, CSS3, etc",[392,6095,6096],{},[591,6097,6100],{"href":6098,"rel":6099},"https://caniuse.com/opus",[621],"Opus audio format | Can I use... Support tables for HTML5, CSS3, etc",[392,6102,6103],{},[591,6104,6107],{"href":6105,"rel":6106},"https://caniuse.com/mpeg4",[621],"MPEG-4/H.264 video format | Can I use... Support tables for HTML5, CSS3, etc",[392,6109,6110],{},[591,6111,6114],{"href":6112,"rel":6113},"https://en.wikipedia.org/wiki/AV1",[621],"AV1 - Wikipedia",[392,6116,6117],{},[591,6118,6121],{"href":6119,"rel":6120},"https://en.wikipedia.org/wiki/High_Efficiency_Video_Coding",[621],"High Efficiency Video Coding - Wikipedia",[392,6123,6124],{},[591,6125,6128],{"href":6126,"rel":6127},"https://en.wikipedia.org/wiki/VP9",[621],"VP9 - Wikipedia",[392,6130,6131],{},[591,6132,6135],{"href":6133,"rel":6134},"https://en.wikipedia.org/wiki/Advanced_Video_Coding",[621],"Advanced Video Coding - Wikipedia",[392,6137,6138],{},[591,6139,6142],{"href":6140,"rel":6141},"https://www.intel.com/content/www/us/en/developer/articles/technical/encode-and-decode-capabilities-for-7th-generation-intel-core-processors-and-newer.html",[621],"Encode and Decode Capabilities for 7th Generation Intel® Core™...",[392,6144,6145],{},[591,6146,6149],{"href":6147,"rel":6148},"https://zh.wikipedia.org/zh-cn/MacOS_High_Sierra",[621],"macOS High Sierra - 维基百科，自由的百科全书",[392,6151,6152],{},[591,6153,6156,6157],{"href":6154,"rel":6155},"https://www.androidpolice.com/2018/10/17/chrome-70-adds-av1-video-support-improves-pwas-windows-apk-download/",[621],"Chrome 70 adds AV1 video support, improves PWAs on Windows, and more ",[87,6158,6159],{},"APK Download",[392,6161,6162],{},[591,6163,6166],{"href":6164,"rel":6165},"https://www.mozilla.org/en-US/firefox/android/113.0/releasenotes/",[621],"Firefox for Android 113.0, See All New Features, Updates and Fixes",[392,6168,6169],{},[591,6170,6173],{"href":6171,"rel":6172},"https://www.bilibili.com/video/BV1nW4y1V7kR/",[621],"视频网站的“蓝光”是怎么骗你的？——视频画质全解析【柴知道】_哔哩哔哩_bilibili",[392,6175,6176],{},"“Why 4K Today Looks Worse Than 4 Years Ago” (original video unavailable)",[547,6178,6179],{},"html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html pre.shiki code .sJa8x, html code.shiki .sJa8x{--shiki-default:#E45649;--shiki-dark:#E06C75}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}",{"title":33,"searchDepth":96,"depth":96,"links":6181},[6182,6189,6193,6194,6195],{"id":5480,"depth":96,"text":5481,"children":6183},[6184,6185,6186,6187,6188],{"id":5484,"depth":3,"text":5485},{"id":5542,"depth":3,"text":5543},{"id":5572,"depth":3,"text":5573},{"id":5618,"depth":3,"text":5619},{"id":5652,"depth":3,"text":5653},{"id":5807,"depth":96,"text":5808,"children":6190},[6191,6192],{"id":5833,"depth":3,"text":5834},{"id":5958,"depth":3,"text":5959},{"id":5982,"depth":96,"text":5983},{"id":6005,"depth":96,"text":6006},{"id":4664,"depth":96,"text":4665},{"title":6197,"date":6198,"path":6199,"tags":6200,"body":6201},"Why Do el-image and el-table Clash? What Is a Stacking Context?","2025-05-31 00:29:40","/2025/05/31/el-image-and-el-table-why-the-fight-and-what-is-a-stacking-context",[571,574,3922,2527,575],{"type":17,"value":6202,"toc":6533},[6203,6213,6219,6222,6228,6230,6246,6251,6257,6262,6301,6308,6312,6324,6331,6348,6351,6360,6363,6419,6423,6430,6443,6447,6457,6460,6475,6491,6493,6530],[20,6204,6205,6206,2416,6209,6212],{},"This happened during the internal development of Jinghong’s image hosting service. A freshman reported that ",[74,6207,6208],{},"el-image",[74,6210,6211],{},"el-table"," were “clashing.”",[20,6214,6215],{},[31,6216],{"alt":6217,"src":6218},"Screenshot","https://static.031130.xyz/uploads/2025/05/31/c6674f6f13955.webp",[20,6220,6221],{},"Demo iframe:",[20,6223,6224],{},[591,6225,4823],{"href":6226,"rel":6227},"https://static.031130.xyz/demo/el-image-el-table-conflict.html",[621],[3874,6229],{"src":6226,"width":3877,"height":3878,"allowFullScreen":128,"loading":3879},[20,6231,6232,6233,6235,6236,6239,6240,6242,6243,6245],{},"When I saw that the table behind was showing through the ",[74,6234,6208],{}," preview overlay, my first reaction was to ask the student to check whether the ",[74,6237,6238],{},"z-index"," was correct—specifically whether the ",[74,6241,6208],{}," mask overlay had a higher ",[74,6244,6238],{}," than the table.",[20,6247,6248],{},[31,6249],{"alt":33,"src":6250},"https://static.031130.xyz/uploads/2025/05/31/1c20b4ea0b37e.webp",[20,6252,6253,6254,6256],{},"After testing locally, I confirmed that the ",[74,6255,6238],{}," was indeed set correctly. So why were the elements behind showing through? A quick Google search led me to this article:",[20,6258,6259],{},[31,6260],{"alt":33,"src":6261},"https://static.031130.xyz/uploads/2025/05/31/99845899e3524.webp",[42,6263,6264,6269],{},[20,6265,6266,6267,77],{},"Simply add the following CSS to ",[74,6268,6211],{},[79,6270,6274],{"className":6271,"code":6272,"language":6273,"meta":33,"style":33},"language-css shiki shiki-themes one-light one-dark-pro",".el-table__cell {\n    position: static !important;\n}\n","css",[74,6275,6276,6283,6297],{"__ignoreMap":33},[87,6277,6278,6281],{"class":89,"line":90},[87,6279,6280],{"class":254},".el-table__cell",[87,6282,2048],{"class":246},[87,6284,6285,6288,6292,6295],{"class":89,"line":96},[87,6286,6287],{"class":246},"    position: ",[87,6289,6291],{"class":6290},"sYebD","static",[87,6293,6294],{"class":806}," !important",[87,6296,2670],{"class":246},[87,6298,6299],{"class":89,"line":3},[87,6300,1226],{"class":246},[20,6302,6303,6304,6307],{},"Testing locally confirmed that this solution works. But why? This is where ",[24,6305,6306],{},"Stacking Context"," comes into play.",[51,6309,6311],{"id":6310},"what-exactly-is-a-stacking-context","What Exactly Is a Stacking Context?",[20,6313,6314,6315,6317,6318,6320,6321,65],{},"Simply put, a Stacking Context is like a canvas. On the same canvas, elements with higher ",[74,6316,6238],{}," values appear on top of those with lower values, which is why I initially suggested checking ",[74,6319,6238],{},". But the catch is that ",[24,6322,6323],{},"Stacking Contexts themselves have a hierarchy",[20,6325,6326,6327,6330],{},"Imagine we have two canvases, A and B. On A, there’s an element with ",[74,6328,6329],{},"z-index: 1145141919810",". This element has a very high priority and should appear at the very top of the browser window. But if canvas B has higher priority than canvas A, all elements on B will be displayed above A (essentially “winning by default”). So how is a canvas’s priority determined?",[389,6332,6333,6340],{},[392,6334,6335],{},[24,6336,6337,6338,65],{},"Between sibling Stacking Contexts, priority is determined by ",[74,6339,6238],{},[392,6341,6342],{},[24,6343,6344,6345,6347],{},"For Stacking Contexts with the same ",[74,6346,6238],{},", elements appearing later in the HTML document have higher priority.",[20,6349,6350],{},"The second rule explains why in the demo, only elements that come after the image cell in the table are showing through.",[51,6352,6354,6355,2416,6357,6359],{"id":6353},"so-why-do-el-image-and-el-table-clash","So Why Do ",[74,6356,6208],{},[74,6358,6211],{}," Clash?",[20,6361,6362],{},"This conflict is mainly caused by two factors:",[423,6364,6365,6395],{},[392,6366,6367,6369,6370,6373,6374,6377,6378,6381,6382,6384,6388,6390,6391,6394],{},[74,6368,6211],{}," sets ",[74,6371,6372],{},"position: relative"," for each cell. When ",[74,6375,6376],{},"position"," is set to ",[74,6379,6380],{},"relative",", the element creates a new Stacking Context.",[4474,6383],{},[31,6385],{"alt":6386,"src":6387},"image-20250531013029154","https://static.031130.xyz/uploads/2025/05/31/9df43b865b3c6.webp",[4474,6389],{},"So a table with ten cells actually generates ten canvases, each with ",[74,6392,6393],{},"z-index: 1",". According to the rules above, table cells that appear later in the HTML document have higher priority than the earlier image cell.",[392,6396,6397,6398,6400,6401,65,6407,6409,6412,6414,6415,6418],{},"The overlay used by ",[74,6399,6208],{},"’s preview feature is placed ",[24,6402,6403,6404,6406],{},"inside the ",[74,6405,6208],{}," element itself",[4474,6408],{},[31,6410],{"alt":33,"src":6411},"https://static.031130.xyz/uploads/2025/05/31/f18a2b54afd63.webp",[4474,6413],{},"The orange area in the image above is the overlay used during preview. The default behavior of Element Plus is to insert the preview overlay inside the ",[74,6416,6417],{},"\u003Cel-image>"," tag. This traps the overlay inside a low-priority Stacking Context, allowing content from later table cells to appear on top.",[51,6420,6422],{"id":6421},"so-whats-the-solution","So What’s the Solution?",[224,6424,6426,6427,6429],{"id":6425},"changing-the-position-value-works","Changing the ",[74,6428,6376],{}," value works",[20,6431,6432,6433,6436,6437,6439,6440,6442],{},"The solution found online, forcing ",[74,6434,6435],{},"position: static"," on table cells, works because ",[74,6438,6291],{}," does ",[24,6441,5552],{}," create a new Stacking Context, avoiding the current problem.",[224,6444,6446],{"id":6445},"placing-top-layer-elements-in-the-highest-priority-context-is-more-common","Placing top-layer elements in the highest-priority context is more common",[20,6448,6449,6450,6453,6454,6456],{},"Other component libraries usually handle this by inserting the overlay directly into the ",[74,6451,6452],{},"body"," element and giving it a high ",[74,6455,6238],{},". This ensures it always appears on top of the screen (same principle used for dialogs, popovers, etc.).",[20,6458,6459],{},"In fact, Element Plus supports this feature:",[42,6461,6462],{},[20,6463,6464,6467,6468,6470,6471,6474],{},[24,6465,6466],{},"preview-teleported:"," Determines whether the image viewer overlay is inserted into the ",[74,6469,6452],{},". Should be set to ",[74,6472,6473],{},"true"," if the parent element may modify its properties.",[20,6476,6477,6478,6481,6482,6484,6485,6487,6488,6490],{},"So using ",[74,6479,6480],{},":preview-teleported=\"true\""," with ",[74,6483,6208],{}," is a more robust approach, because we cannot guarantee that the parent of ",[74,6486,6208],{}," (besides ",[74,6489,6211],{}," cells) won’t create another Stacking Context.",[51,6492,4665],{"id":4664},[389,6494,6495,6502,6509,6516,6523],{},[392,6496,6497],{},[591,6498,6501],{"href":6499,"rel":6500},"https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_positioned_layout/Stacking_context",[621],"Stacking Context - CSS | MDN",[392,6503,6504],{},[591,6505,6508],{"href":6506,"rel":6507},"https://juejin.cn/post/6844903667175260174",[621],"Completely Understand CSS Stacking Contexts, Levels, Order, and z-index",[392,6510,6511],{},[591,6512,6515],{"href":6513,"rel":6514},"https://www.zhangxinxu.com/wordpress/2016/01/understand-css-stacking-context-order-z-index/",[621],"Deep Dive into CSS Stacking Context and Stacking Order",[392,6517,6518],{},[591,6519,6522],{"href":6520,"rel":6521},"https://element-plus.org/zh-CN/component/image.html",[621],"Image | Element Plus",[392,6524,6525],{},[591,6526,6529],{"href":6527,"rel":6528},"https://blog.csdn.net/qq_61402485/article/details/131202117",[621],"el-image and el-table display issue",[547,6531,6532],{},"html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html pre.shiki code .sYebD, html code.shiki .sYebD{--shiki-default:#383A42;--shiki-dark:#D19A66}html pre.shiki code .sLKXg, html code.shiki .sLKXg{--shiki-default:#A626A4;--shiki-dark:#C678DD}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}",{"title":33,"searchDepth":96,"depth":96,"links":6534},[6535,6536,6538,6543],{"id":6310,"depth":96,"text":6311},{"id":6353,"depth":96,"text":6537},"So Why Do el-image and el-table Clash?",{"id":6421,"depth":96,"text":6422,"children":6539},[6540,6542],{"id":6425,"depth":3,"text":6541},"Changing the position value works",{"id":6445,"depth":3,"text":6446},{"id":4664,"depth":96,"text":4665},{"title":6545,"date":6546,"path":6547,"tags":6548,"body":6549},"How to Copy Text to Clipboard with JavaScript in 2025","2025-04-21 19:48:05","/2025/04/21/how-we-copy-text-to-clipboard-with-js-in-2025",[574],{"type":17,"value":6550,"toc":8014},[6551,6555,6561,6569,6584,6587,6809,6832,6835,6843,6846,6851,6872,6893,6898,6909,6920,7210,7222,7225,7234,7241,7244,7248,7253,7256,7288,7292,7295,7318,7323,7327,7330,7338,7341,7354,7357,7463,7466,7469,7476,7488,7491,7526,7529,7537,7553,7772,7776,7779,7787,7794,7869,7877,7884,7892,7898,7906,7916,7920,7923,7926,7929,7931,8011],[51,6552,6554],{"id":6553},"fundamental-principles","Fundamental Principles",[20,6556,6557,6558],{},"If you try searching for this article's title on a search engine, the articles you find will likely suggest using the following two APIs. ",[5401,6559,6560],{},"I hope your search engine isn't so outdated that it's still recommending Flash-based ZeroClipboard solutions in 2025",[224,6562,6564],{"id":6563},"documentexeccommand",[591,6565,6568],{"href":6566,"rel":6567},"https://developer.mozilla.org/en-US/docs/Web/API/Document/execCommand",[621],"document.execCommand",[20,6570,6571,6572,6577,6578,6583],{},"2012 brought us not only the supposed end of the world, but also IE 10. With IE 10's release on September 4th of that year, the execCommand family welcomed two new members—the copy/cut commands (this claim comes from ",[591,6573,6576],{"href":6574,"rel":6575},"https://developer.chrome.com/blog/cut-and-copy-commands",[621],"Chrome's blog",", while ",[591,6579,6582],{"href":6580,"rel":6581},"https://web.archive.org/web/20160315042044/https://developer.mozilla.org/en-US/docs/Web/API/Document/execCommand",[621],"MDN believes IE 9 already supported it","). Three years later, when Google Chrome version 42 (released April 14, 2015) added support for execCommand's copy/cut, more and more browser vendors began implementing this standard. Finally, with Safari 10 on iOS released on September 13, 2016, web developers at last obtained the first non-Flash JavaScript solution for copying to clipboard in history.",[20,6585,6586],{},"When document.execCommand's first parameter is \"copy\", it can copy user-selected text to the clipboard. Based on this API implementation, someone quickly developed what became the most common JavaScript implementation on the web today—first create an invisible DOM element, use JavaScript to simulate user text selection, and call execCommand('copy') to copy the text to the user's clipboard. The rough code implementation is as follows:",[79,6588,6590],{"className":797,"code":6589,"language":799,"meta":33,"style":33},"// From the article \"Pitfalls and Complete Solution for JS Copy Text to Clipboard\", with a link at the end of this article\n\nconst textArea = document.createElement(\"textArea\");\ntextArea.value = val;\ntextArea.style.width = 0;\ntextArea.style.position = \"fixed\";\ntextArea.style.left = \"-999px\";\ntextArea.style.top = \"10px\";\ntextArea.setAttribute(\"readonly\", \"readonly\");\ndocument.body.appendChild(textArea);\n\ntextArea.select();\ndocument.execCommand(\"copy\");\ndocument.body.removeChild(textArea);\n",[74,6591,6592,6597,6601,6625,6641,6660,6679,6699,6719,6739,6759,6763,6774,6790],{"__ignoreMap":33},[87,6593,6594],{"class":89,"line":90},[87,6595,6596],{"class":869},"// From the article \"Pitfalls and Complete Solution for JS Copy Text to Clipboard\", with a link at the end of this article\n",[87,6598,6599],{"class":89,"line":96},[87,6600,129],{"emptyLinePlaceholder":128},[87,6602,6603,6605,6608,6610,6613,6615,6618,6620,6623],{"class":89,"line":3},[87,6604,843],{"class":806},[87,6606,6607],{"class":846}," textArea",[87,6609,851],{"class":850},[87,6611,6612],{"class":918}," document",[87,6614,65],{"class":246},[87,6616,6617],{"class":781},"createElement",[87,6619,890],{"class":246},[87,6621,6622],{"class":261},"\"textArea\"",[87,6624,2706],{"class":246},[87,6626,6627,6630,6632,6634,6636,6639],{"class":89,"line":107},[87,6628,6629],{"class":918},"textArea",[87,6631,65],{"class":246},[87,6633,1522],{"class":250},[87,6635,851],{"class":850},[87,6637,6638],{"class":893}," val",[87,6640,2670],{"class":246},[87,6642,6643,6645,6647,6649,6651,6654,6656,6658],{"class":89,"line":113},[87,6644,6629],{"class":918},[87,6646,65],{"class":246},[87,6648,547],{"class":1346},[87,6650,65],{"class":246},[87,6652,6653],{"class":250},"width",[87,6655,851],{"class":850},[87,6657,3173],{"class":254},[87,6659,2670],{"class":246},[87,6661,6662,6664,6666,6668,6670,6672,6674,6677],{"class":89,"line":119},[87,6663,6629],{"class":918},[87,6665,65],{"class":246},[87,6667,547],{"class":1346},[87,6669,65],{"class":246},[87,6671,6376],{"class":250},[87,6673,851],{"class":850},[87,6675,6676],{"class":261}," \"fixed\"",[87,6678,2670],{"class":246},[87,6680,6681,6683,6685,6687,6689,6692,6694,6697],{"class":89,"line":125},[87,6682,6629],{"class":918},[87,6684,65],{"class":246},[87,6686,547],{"class":1346},[87,6688,65],{"class":246},[87,6690,6691],{"class":250},"left",[87,6693,851],{"class":850},[87,6695,6696],{"class":261}," \"-999px\"",[87,6698,2670],{"class":246},[87,6700,6701,6703,6705,6707,6709,6712,6714,6717],{"class":89,"line":132},[87,6702,6629],{"class":918},[87,6704,65],{"class":246},[87,6706,547],{"class":1346},[87,6708,65],{"class":246},[87,6710,6711],{"class":250},"top",[87,6713,851],{"class":850},[87,6715,6716],{"class":261}," \"10px\"",[87,6718,2670],{"class":246},[87,6720,6721,6723,6725,6728,6730,6733,6735,6737],{"class":89,"line":138},[87,6722,6629],{"class":918},[87,6724,65],{"class":246},[87,6726,6727],{"class":781},"setAttribute",[87,6729,890],{"class":246},[87,6731,6732],{"class":261},"\"readonly\"",[87,6734,962],{"class":246},[87,6736,6732],{"class":261},[87,6738,2706],{"class":246},[87,6740,6741,6744,6746,6748,6750,6753,6755,6757],{"class":89,"line":144},[87,6742,6743],{"class":918},"document",[87,6745,65],{"class":246},[87,6747,6452],{"class":1346},[87,6749,65],{"class":246},[87,6751,6752],{"class":781},"appendChild",[87,6754,890],{"class":246},[87,6756,6629],{"class":893},[87,6758,2706],{"class":246},[87,6760,6761],{"class":89,"line":150},[87,6762,129],{"emptyLinePlaceholder":128},[87,6764,6765,6767,6769,6772],{"class":89,"line":156},[87,6766,6629],{"class":918},[87,6768,65],{"class":246},[87,6770,6771],{"class":781},"select",[87,6773,2723],{"class":246},[87,6775,6776,6778,6780,6783,6785,6788],{"class":89,"line":162},[87,6777,6743],{"class":918},[87,6779,65],{"class":246},[87,6781,6782],{"class":781},"execCommand",[87,6784,890],{"class":246},[87,6786,6787],{"class":261},"\"copy\"",[87,6789,2706],{"class":246},[87,6791,6792,6794,6796,6798,6800,6803,6805,6807],{"class":89,"line":168},[87,6793,6743],{"class":918},[87,6795,65],{"class":246},[87,6797,6452],{"class":1346},[87,6799,65],{"class":246},[87,6801,6802],{"class":781},"removeChild",[87,6804,890],{"class":246},[87,6806,6629],{"class":893},[87,6808,2706],{"class":246},[20,6810,6811,6812,6815,6816,6821,6822,6827,6828,6831],{},"Although ",[24,6813,6814],{},"this API has long been deprecated by W3C"," and is marked as Deprecated on MDN, it remains the most common solution in the market. While writing this article, I examined MDN's English original page on archive.org and its change history on Github. This API was first marked as Obsolete in ",[591,6817,6820],{"href":6818,"rel":6819},"https://web.archive.org/web/20200221235207/https://developer.mozilla.org/en-US/docs/Web/API/Document/execCommand",[621],"January-February 2020",", then first marked as Deprecated in ",[591,6823,6826],{"href":6824,"rel":6825},"https://github.com/mdn/content/commit/0c31e2bc4d6601a079bc57521e79529539c8cf68#diff-85ef9d1e72565f0ae2ffd8199d10b34c11c615aec5d116057ac2a33c21cc072f",[621],"January 2021",", with a red background color warning developers that the API ",[24,6829,6830],{},"may stop working at any time",". However, as of this article's publication, all commonly used browsers still maintain compatibility with this API, at least for the copy command.",[20,6833,6834],{},"This API has been widely used on so many sites that removing support for it would cause massive site failures. I believe all browser engines likely have no motivation in the short term to remove this API at the cost of losing compatibility. This means that this (seemingly bizarre) workaround of creating an invisible DOM to replace user text selection and executing execCommand to copy to the user's clipboard has left a significant mark in the history of frontend development.",[224,6836,6838],{"id":6837},"clipboardwritetext",[591,6839,6842],{"href":6840,"rel":6841},"https://developer.mozilla.org/en-US/docs/Web/API/Clipboard/writeText",[621],"Clipboard.writeText()",[20,6844,6845],{},"As native JavaScript was gradually enhanced, developers finally completed the Clipboard piece of the puzzle. On April 17, 2018, Chrome 66 took the first step; on October 23 of the same year, Firefox followed with the Clipboard API implementation. Finally, on March 24, 2020, with Apple's Safari 13.4 belatedly joining, frontend developers could finally breathe a sigh of relief, once again obtaining a copying solution that works across mainstream browsers.",[20,6847,6848],{},[24,6849,6850],{},"So if execCommand already achieved pure JavaScript text copying to clipboard, why do we still need the Clipboard API? Or rather, what advantages does this deliberately implemented Clipboard API actually have?",[423,6852,6853,6856,6859,6869],{},[392,6854,6855],{},"The traditional execCommand solution typically requires creating a temporary invisible DOM, placing text, selecting text with JS, and executing the copy command. Setting aside how inelegant this hacky approach is when writing code, the operation of using JS to select text modifies the user's current text selection state, sometimes leading to decreased user experience.",[392,6857,6858],{},"The Clipboard API is asynchronous, meaning it won't block the main thread when copying large amounts of text.",[392,6860,6861,6862,2416,6865,6868],{},"The Clipboard API provides more capabilities, such as ",[74,6863,6864],{},"write()",[74,6866,6867],{},"read()"," allowing reading and writing more complex data to the clipboard, like rich text or images.",[392,6870,6871],{},"The Clipboard API has more modern, explicit permission controls—write operations need to be called by active user actions, while read operations require users to explicitly grant permission in the browser UI. These permission controls give users greater control, so when execCommand exits the historical stage, web security will be further improved.",[20,6873,6874,6875,6877,6878,6881,6882,6885,6886,6888,6889,6892],{},"However, at the current stage, ",[74,6876,6842],{}," may not solve all problems. Setting aside old browser compatibility issues, ",[74,6879,6880],{},"navigator.clipboard"," ",[24,6883,6884],{},"is only available on pages accessed via HTTPS"," (or localhost). If your project is deployed on a LAN and you try to access it directly via 192.18.1.x IP + port, then ",[74,6887,6880],{}," will be in an ",[74,6890,6891],{},"undefined"," state.",[20,6894,6895],{},[31,6896],{"alt":33,"src":6897},"https://static.031130.xyz/uploads/2025/04/19/3437b1c022853.webp",[20,6899,6900,6901,6904,6905,6908],{},"Additionally, ",[24,6902,6903],{},"Android native WebView"," has the problem of ",[24,6906,6907],{},"not being able to use"," the Clipboard API because the Permissions API isn't implemented.",[20,6910,6911,6912,6915,6916,6919],{},"For these reasons, many websites now prioritize trying to use ",[74,6913,6914],{},"navigator.clipboard.writeText()",", then fall back to using ",[74,6917,6918],{},"execCommand('copy')"," if that fails. The rough code implementation is as follows:",[79,6921,6923],{"className":797,"code":6922,"language":799,"meta":33,"style":33},"// From the article \"Pitfalls and Complete Solution for JS Copy Text to Clipboard\", with a link at the end of this article\n\nconst copyText = async val => {\n  if (navigator.clipboard && navigator.permissions) {\n    await navigator.clipboard.writeText(val);\n  } else {\n    const textArea = document.createElement(\"textArea\");\n    textArea.value = val;\n    textArea.style.width = 0;\n    textArea.style.position = \"fixed\";\n    textArea.style.left = \"-999px\";\n    textArea.style.top = \"10px\";\n    textArea.setAttribute(\"readonly\", \"readonly\");\n    document.body.appendChild(textArea);\n\n    textArea.select();\n    document.execCommand(\"copy\");\n    document.body.removeChild(textArea);\n  }\n};\n",[74,6924,6925,6929,6933,6952,6979,7002,7012,7032,7047,7065,7083,7101,7119,7137,7156,7160,7170,7184,7202,7206],{"__ignoreMap":33},[87,6926,6927],{"class":89,"line":90},[87,6928,6596],{"class":869},[87,6930,6931],{"class":89,"line":96},[87,6932,129],{"emptyLinePlaceholder":128},[87,6934,6935,6937,6940,6942,6945,6947,6950],{"class":89,"line":3},[87,6936,843],{"class":806},[87,6938,6939],{"class":781}," copyText",[87,6941,851],{"class":850},[87,6943,6944],{"class":806}," async",[87,6946,6638],{"class":1270},[87,6948,6949],{"class":806}," =>",[87,6951,2048],{"class":246},[87,6953,6954,6956,6958,6961,6963,6966,6969,6972,6974,6977],{"class":89,"line":107},[87,6955,1279],{"class":806},[87,6957,1282],{"class":246},[87,6959,6960],{"class":918},"navigator",[87,6962,65],{"class":246},[87,6964,6965],{"class":250},"clipboard",[87,6967,6968],{"class":850}," &&",[87,6970,6971],{"class":918}," navigator",[87,6973,65],{"class":246},[87,6975,6976],{"class":250},"permissions",[87,6978,1274],{"class":246},[87,6980,6981,6984,6986,6988,6990,6992,6995,6997,7000],{"class":89,"line":113},[87,6982,6983],{"class":806},"    await",[87,6985,6971],{"class":918},[87,6987,65],{"class":246},[87,6989,6965],{"class":1346},[87,6991,65],{"class":246},[87,6993,6994],{"class":781},"writeText",[87,6996,890],{"class":246},[87,6998,6999],{"class":893},"val",[87,7001,2706],{"class":246},[87,7003,7004,7007,7010],{"class":89,"line":119},[87,7005,7006],{"class":246},"  } ",[87,7008,7009],{"class":806},"else",[87,7011,2048],{"class":246},[87,7013,7014,7016,7018,7020,7022,7024,7026,7028,7030],{"class":89,"line":125},[87,7015,3091],{"class":806},[87,7017,6607],{"class":846},[87,7019,851],{"class":850},[87,7021,6612],{"class":918},[87,7023,65],{"class":246},[87,7025,6617],{"class":781},[87,7027,890],{"class":246},[87,7029,6622],{"class":261},[87,7031,2706],{"class":246},[87,7033,7034,7037,7039,7041,7043,7045],{"class":89,"line":132},[87,7035,7036],{"class":918},"    textArea",[87,7038,65],{"class":246},[87,7040,1522],{"class":250},[87,7042,851],{"class":850},[87,7044,6638],{"class":893},[87,7046,2670],{"class":246},[87,7048,7049,7051,7053,7055,7057,7059,7061,7063],{"class":89,"line":138},[87,7050,7036],{"class":918},[87,7052,65],{"class":246},[87,7054,547],{"class":1346},[87,7056,65],{"class":246},[87,7058,6653],{"class":250},[87,7060,851],{"class":850},[87,7062,3173],{"class":254},[87,7064,2670],{"class":246},[87,7066,7067,7069,7071,7073,7075,7077,7079,7081],{"class":89,"line":144},[87,7068,7036],{"class":918},[87,7070,65],{"class":246},[87,7072,547],{"class":1346},[87,7074,65],{"class":246},[87,7076,6376],{"class":250},[87,7078,851],{"class":850},[87,7080,6676],{"class":261},[87,7082,2670],{"class":246},[87,7084,7085,7087,7089,7091,7093,7095,7097,7099],{"class":89,"line":150},[87,7086,7036],{"class":918},[87,7088,65],{"class":246},[87,7090,547],{"class":1346},[87,7092,65],{"class":246},[87,7094,6691],{"class":250},[87,7096,851],{"class":850},[87,7098,6696],{"class":261},[87,7100,2670],{"class":246},[87,7102,7103,7105,7107,7109,7111,7113,7115,7117],{"class":89,"line":156},[87,7104,7036],{"class":918},[87,7106,65],{"class":246},[87,7108,547],{"class":1346},[87,7110,65],{"class":246},[87,7112,6711],{"class":250},[87,7114,851],{"class":850},[87,7116,6716],{"class":261},[87,7118,2670],{"class":246},[87,7120,7121,7123,7125,7127,7129,7131,7133,7135],{"class":89,"line":162},[87,7122,7036],{"class":918},[87,7124,65],{"class":246},[87,7126,6727],{"class":781},[87,7128,890],{"class":246},[87,7130,6732],{"class":261},[87,7132,962],{"class":246},[87,7134,6732],{"class":261},[87,7136,2706],{"class":246},[87,7138,7139,7142,7144,7146,7148,7150,7152,7154],{"class":89,"line":168},[87,7140,7141],{"class":918},"    document",[87,7143,65],{"class":246},[87,7145,6452],{"class":1346},[87,7147,65],{"class":246},[87,7149,6752],{"class":781},[87,7151,890],{"class":246},[87,7153,6629],{"class":893},[87,7155,2706],{"class":246},[87,7157,7158],{"class":89,"line":174},[87,7159,129],{"emptyLinePlaceholder":128},[87,7161,7162,7164,7166,7168],{"class":89,"line":180},[87,7163,7036],{"class":918},[87,7165,65],{"class":246},[87,7167,6771],{"class":781},[87,7169,2723],{"class":246},[87,7171,7172,7174,7176,7178,7180,7182],{"class":89,"line":186},[87,7173,7141],{"class":918},[87,7175,65],{"class":246},[87,7177,6782],{"class":781},[87,7179,890],{"class":246},[87,7181,6787],{"class":261},[87,7183,2706],{"class":246},[87,7185,7186,7188,7190,7192,7194,7196,7198,7200],{"class":89,"line":192},[87,7187,7141],{"class":918},[87,7189,65],{"class":246},[87,7191,6452],{"class":1346},[87,7193,65],{"class":246},[87,7195,6802],{"class":781},[87,7197,890],{"class":246},[87,7199,6629],{"class":893},[87,7201,2706],{"class":246},[87,7203,7204],{"class":89,"line":198},[87,7205,1889],{"class":246},[87,7207,7208],{"class":89,"line":1144},[87,7209,4279],{"class":246},[224,7211,7213],{"id":7212},"flash-solution-zeroclipboard",[5401,7214,7215,7216,7221],{},"Flash Solution (",[591,7217,7220],{"href":7218,"rel":7219},"https://github.com/zeroclipboard/zeroclipboard",[621],"ZeroClipboard",")",[20,7223,7224],{},"Actually, the two APIs above pretty much cover the fundamental principles, but while researching, I discovered that before the execCommand solution, the frontend mostly relied on Flash to implement copying text to clipboard. How could I not mention this?",[20,7226,7227,7228,7233],{},"Currently, the oldest tag that can be found in the ZeroClipboard Github repository is ",[591,7229,7232],{"href":7230,"rel":7231},"https://github.com/zeroclipboard/zeroclipboard/releases/tag/v1.0.7",[621],"v1.0.7",", released on June 9, 2012. I bet this project wasn't the first to implement copying text to clipboard through Flash. Someone must have implemented this functionality using Flash before, just not open-sourced as a separate library.",[20,7235,7236,7237,7240],{},"ZeroClipboard worked by creating a transparent Flash Movie overlaying the trigger button. When users clicked the button, they actually clicked on the Flash Movie. JavaScript then communicated with the Flash Movie through ",[74,7238,7239],{},"ExternalInterface",", passing the text to be copied to Flash, which then wrote the text to the user's clipboard via Flash's API.",[20,7242,7243],{},"In that era's context, this was the only solution that could implement cross-browser text copying to clipboard (although not every computer had Flash installed, and iOS didn't support Flash). The 6.6k star Github repository witnessed that chaotic era when each browser held onto its own private APIs, ultimately falling along with Flash as the execCommand solution rose.",[224,7245,7247],{"id":7246},"other-imperfect-solutions","Other Imperfect Solutions",[7249,7250,7252],"h4",{"id":7251},"windowclipboarddatasetdata","window.clipboardData.setData",[20,7254,7255],{},"This API was mainly used around 2000-2010 and only worked in IE browsers. Firefox didn't support pure JavaScript copying to browser during this period; Chrome's first version wasn't released until 2008 and hadn't yet become mainstream.",[79,7257,7259],{"className":797,"code":7258,"language":799,"meta":33,"style":33},"window.clipboardData.setData(\"Text\", text2copy);\n",[74,7260,7261],{"__ignoreMap":33},[87,7262,7263,7266,7268,7271,7273,7276,7278,7281,7283,7286],{"class":89,"line":90},[87,7264,7265],{"class":918},"window",[87,7267,65],{"class":246},[87,7269,7270],{"class":1346},"clipboardData",[87,7272,65],{"class":246},[87,7274,7275],{"class":781},"setData",[87,7277,890],{"class":246},[87,7279,7280],{"class":261},"\"Text\"",[87,7282,962],{"class":246},[87,7284,7285],{"class":893},"text2copy",[87,7287,2706],{"class":246},[7249,7289,7291],{"id":7290},"giving-up-prompt","Giving Up (prompt)",[20,7293,7294],{},"Call a prompt popup to let users copy themselves.",[79,7296,7298],{"className":797,"code":7297,"language":799,"meta":33,"style":33},"prompt('Press Ctrl + C, then Enter to copy to clipboard','copy me')\n",[74,7299,7300],{"__ignoreMap":33},[87,7301,7302,7305,7307,7310,7313,7316],{"class":89,"line":90},[87,7303,7304],{"class":781},"prompt",[87,7306,890],{"class":246},[87,7308,7309],{"class":261},"'Press Ctrl + C, then Enter to copy to clipboard'",[87,7311,7312],{"class":246},",",[87,7314,7315],{"class":261},"'copy me'",[87,7317,897],{"class":246},[20,7319,7320],{},[31,7321],{"alt":33,"src":7322},"https://static.031130.xyz/uploads/2025/04/19/7f5310ca03c80.webp",[51,7324,7326],{"id":7325},"third-party-library-wrappers","Third-Party Library Wrappers",[20,7328,7329],{},"Since the execCommand solution is too abstract and not elegant enough, we have some ready-made third-party libraries that wrap the clipboard copying code.",[224,7331,7333],{"id":7332},"clipboardjs",[591,7334,7337],{"href":7335,"rel":7336},"https://github.com/zenorocha/clipboard.js/",[621],"clipboard.js",[20,7339,7340],{},"clipboard.js is the most renowned third-party library, with 34.1k stars on Github as of this article's completion. The earliest tag version was released on October 28, 2015, one month after Firefox supported execCommand and all three major PC browsers achieved full compatibility.",[20,7342,7343,7344,7349,7350,7353],{},"clipboard.js ",[591,7345,7348],{"href":7346,"rel":7347},"https://github.com/zenorocha/clipboard.js/blob/master/src/common/command.js",[621],"only uses execCommand"," to implement clipboard copying. The project owner expects developers to use ",[74,7351,7352],{},"ClipboardJS.isSupported()"," to determine whether the user's browser supports the execCommand solution, and arrange success/failure actions based on the command execution's return value.",[20,7355,7356],{},"However, what I find strange is that clipboard.js requires developers to pass a DOM selector (or HTML element/element list) when instantiating. It must have an actual HTML element to set event listeners to trigger the copy operation, rather than providing a JavaScript function for developers to call—although this isn't a limitation from execCommand. Example as follows:",[79,7358,7360],{"className":237,"code":7359,"language":239,"meta":33,"style":33},"\u003C!-- Target -->\n\u003Cinput id=\"foo\" value=\"text2copy\" />\n\n\u003C!-- Trigger -->\n\u003Cbutton class=\"btn\" data-clipboard-target=\"#foo\">\u003C/button>\n\n\u003Cscript>\n    new ClipboardJS('.btn');\n\u003C/script>\n",[74,7361,7362,7367,7391,7395,7400,7428,7432,7440,7455],{"__ignoreMap":33},[87,7363,7364],{"class":89,"line":90},[87,7365,7366],{"class":869},"\u003C!-- Target -->\n",[87,7368,7369,7371,7374,7376,7378,7381,7384,7386,7389],{"class":89,"line":96},[87,7370,247],{"class":246},[87,7372,7373],{"class":250},"input",[87,7375,3490],{"class":254},[87,7377,258],{"class":246},[87,7379,7380],{"class":261},"\"foo\"",[87,7382,7383],{"class":254}," value",[87,7385,258],{"class":246},[87,7387,7388],{"class":261},"\"text2copy\"",[87,7390,1940],{"class":246},[87,7392,7393],{"class":89,"line":3},[87,7394,129],{"emptyLinePlaceholder":128},[87,7396,7397],{"class":89,"line":107},[87,7398,7399],{"class":869},"\u003C!-- Trigger -->\n",[87,7401,7402,7404,7407,7409,7411,7414,7417,7419,7422,7424,7426],{"class":89,"line":113},[87,7403,247],{"class":246},[87,7405,7406],{"class":250},"button",[87,7408,3474],{"class":254},[87,7410,258],{"class":246},[87,7412,7413],{"class":261},"\"btn\"",[87,7415,7416],{"class":254}," data-clipboard-target",[87,7418,258],{"class":246},[87,7420,7421],{"class":261},"\"#foo\"",[87,7423,2617],{"class":246},[87,7425,7406],{"class":250},[87,7427,273],{"class":246},[87,7429,7430],{"class":89,"line":119},[87,7431,129],{"emptyLinePlaceholder":128},[87,7433,7434,7436,7438],{"class":89,"line":125},[87,7435,247],{"class":246},[87,7437,1960],{"class":250},[87,7439,273],{"class":246},[87,7441,7442,7445,7448,7450,7453],{"class":89,"line":132},[87,7443,7444],{"class":806},"    new",[87,7446,7447],{"class":781}," ClipboardJS",[87,7449,890],{"class":246},[87,7451,7452],{"class":261},"'.btn'",[87,7454,2706],{"class":246},[87,7456,7457,7459,7461],{"class":89,"line":138},[87,7458,1945],{"class":246},[87,7460,1960],{"class":250},[87,7462,273],{"class":246},[20,7464,7465],{},"Yes, just one line of JavaScript can add listeners to all DOMs with the btn class. Perhaps this is why this repository got 34.1k stars. In 2015, when most people were still writing frontends with vanilla HTML/CSS/JS, clipboard.js could reduce code volume without requiring developers to set up listeners themselves.",[20,7467,7468],{},"clipboard.js also provides many advanced options to meet different developers' needs, such as allowing you to pass a function to get the text you need users to copy, or use Event listeners to provide feedback on whether copying succeeded. In short, the flexibility is sufficient.",[224,7470,7472],{"id":7471},"copy-to-clipboard",[591,7473,7471],{"href":7474,"rel":7475},"https://github.com/sudodoki/copy-to-clipboard",[621],[20,7477,7478,7479,7484,7485,7487],{},"Another third-party library ",[591,7480,7483],{"href":7481,"rel":7482},"https://github.com/sudodoki/copy-to-clipboard/blob/main/index.js#L79",[621],"using execCommand",", though with only 1.3k stars. The first tag version was released on May 24, 2015, even earlier than clipboard.js. Compared to clipboard.js, copy-to-clipboard doesn't depend on HTML elements and can be called directly in JavaScript, which I personally prefer. In modern frontend frameworks like Vue/React, we generally don't directly manipulate the DOM, so clipboard.js isn't very suitable, but this copy-to-clipboard works well. Additionally, besides the execCommand solution, copy-to-clipboard specifically adapts the ",[74,7486,7252],{}," solution for older IE browsers, and calls a prompt window to let users copy manually as a final fallback when both fail.",[20,7489,7490],{},"Example as follows:",[79,7492,7494],{"className":797,"code":7493,"language":799,"meta":33,"style":33},"import copy from 'copy-to-clipboard';\n\ncopy('Text');\n",[74,7495,7496,7510,7514],{"__ignoreMap":33},[87,7497,7498,7500,7503,7505,7508],{"class":89,"line":90},[87,7499,807],{"class":806},[87,7501,7502],{"class":250}," copy",[87,7504,831],{"class":806},[87,7506,7507],{"class":261}," 'copy-to-clipboard'",[87,7509,2670],{"class":246},[87,7511,7512],{"class":89,"line":96},[87,7513,129],{"emptyLinePlaceholder":128},[87,7515,7516,7519,7521,7524],{"class":89,"line":3},[87,7517,7518],{"class":781},"copy",[87,7520,890],{"class":246},[87,7522,7523],{"class":261},"'Text'",[87,7525,2706],{"class":246},[20,7527,7528],{},"Compared to clipboard.js, the usage approach is more intuitive, but unfortunately it was born at the wrong time and isn't as famous as clipboard.js (naming might also be a factor).",[224,7530,7532],{"id":7531},"vueuse-useclipboard",[591,7533,7536],{"href":7534,"rel":7535},"https://vueuse.org/core/useClipboard/",[621],"VueUse - useClipboard",[20,7538,7539,7540,7545,7546,7549,7550,7552],{},"VueUse's implementation of useClipboard is the one I'm most satisfied with. useClipboard fully considers browser compatibility, ",[24,7541,7542,7543],{},"prioritizing ",[74,7544,6914],{}," when conditions for using navigator.clipboard are met, then ",[24,7547,7548],{},"falling back to execCommand-implemented legacyCopy"," when navigator.clipboard isn't supported or ",[74,7551,6914],{}," fails. It also leverages Vue3's Composables to implement a copied variable that automatically resets to its initial state after 1.5 seconds, which is quite thoughtful.",[79,7554,7556],{"className":1908,"code":7555,"language":1910,"meta":33,"style":33},"const { text, copy, copied, isSupported } = useClipboard({ source })\n\u003C/script>\n\n\u003Ctemplate>\n  \u003Cdiv v-if=\"isSupported\">\n    \u003Cbutton @click=\"copy(source)\">\n      \u003C!-- by default, `copied` will be reset in 1.5s -->\n      \u003Cspan v-if=\"!copied\">Copy\u003C/span>\n      \u003Cspan v-else>Copied!\u003C/span>\n    \u003C/button>\n    \u003Cp>Current copied: \u003Ccode>{{ text || 'none' }}\u003C/code>\u003C/p>\n  \u003C/div>\n  \u003Cp v-else>\n    Your browser does not support Clipboard API\n  \u003C/p>\n\u003C/template>\n",[74,7557,7558,7563,7571,7575,7583,7603,7631,7642,7669,7685,7694,7733,7741,7751,7756,7764],{"__ignoreMap":33},[87,7559,7560],{"class":89,"line":90},[87,7561,7562],{"class":246},"const { text, copy, copied, isSupported } = useClipboard({ source })\n",[87,7564,7565,7567,7569],{"class":89,"line":96},[87,7566,1945],{"class":246},[87,7568,1960],{"class":250},[87,7570,273],{"class":246},[87,7572,7573],{"class":89,"line":3},[87,7574,129],{"emptyLinePlaceholder":128},[87,7576,7577,7579,7581],{"class":89,"line":107},[87,7578,247],{"class":246},[87,7580,1919],{"class":250},[87,7582,273],{"class":246},[87,7584,7585,7587,7589,7592,7594,7596,7599,7601],{"class":89,"line":113},[87,7586,1926],{"class":246},[87,7588,2606],{"class":250},[87,7590,7591],{"class":806}," v-if",[87,7593,258],{"class":246},[87,7595,5456],{"class":246},[87,7597,7598],{"class":893},"isSupported",[87,7600,5456],{"class":246},[87,7602,273],{"class":246},[87,7604,7605,7607,7609,7612,7615,7617,7619,7621,7623,7625,7627,7629],{"class":89,"line":119},[87,7606,2866],{"class":246},[87,7608,7406],{"class":250},[87,7610,7611],{"class":246}," @",[87,7613,7614],{"class":254},"click",[87,7616,258],{"class":246},[87,7618,5456],{"class":246},[87,7620,7518],{"class":781},[87,7622,890],{"class":246},[87,7624,5877],{"class":893},[87,7626,7221],{"class":246},[87,7628,5456],{"class":246},[87,7630,273],{"class":246},[87,7632,7633,7636,7639],{"class":89,"line":125},[87,7634,7635],{"class":246},"      \u003C!-- by default, `copied` will be reset in 1.",[87,7637,7638],{"class":254},"5s",[87,7640,7641],{"class":246}," -->\n",[87,7643,7644,7647,7649,7651,7653,7655,7657,7660,7662,7665,7667],{"class":89,"line":132},[87,7645,7646],{"class":246},"      \u003C",[87,7648,87],{"class":250},[87,7650,7591],{"class":806},[87,7652,258],{"class":246},[87,7654,5456],{"class":246},[87,7656,1285],{"class":850},[87,7658,7659],{"class":893},"copied",[87,7661,5456],{"class":246},[87,7663,7664],{"class":246},">Copy\u003C/",[87,7666,87],{"class":250},[87,7668,273],{"class":246},[87,7670,7671,7673,7675,7678,7681,7683],{"class":89,"line":138},[87,7672,7646],{"class":246},[87,7674,87],{"class":250},[87,7676,7677],{"class":806}," v-else",[87,7679,7680],{"class":246},">Copied!\u003C/",[87,7682,87],{"class":250},[87,7684,273],{"class":246},[87,7686,7687,7690,7692],{"class":89,"line":144},[87,7688,7689],{"class":246},"    \u003C/",[87,7691,7406],{"class":250},[87,7693,273],{"class":246},[87,7695,7696,7698,7700,7703,7705,7708,7712,7715,7718,7721,7723,7725,7727,7729,7731],{"class":89,"line":150},[87,7697,2866],{"class":246},[87,7699,20],{"class":250},[87,7701,7702],{"class":246},">Current copied: \u003C",[87,7704,74],{"class":250},[87,7706,7707],{"class":246},">",[87,7709,7711],{"class":7710},"sblXP","{",[87,7713,7714],{"class":246},"{ text || ",[87,7716,7717],{"class":261},"'none'",[87,7719,7720],{"class":246}," }",[87,7722,1878],{"class":7710},[87,7724,1945],{"class":246},[87,7726,74],{"class":250},[87,7728,2617],{"class":246},[87,7730,20],{"class":250},[87,7732,273],{"class":246},[87,7734,7735,7737,7739],{"class":89,"line":156},[87,7736,2923],{"class":246},[87,7738,2606],{"class":250},[87,7740,273],{"class":246},[87,7742,7743,7745,7747,7749],{"class":89,"line":162},[87,7744,1926],{"class":246},[87,7746,20],{"class":250},[87,7748,7677],{"class":806},[87,7750,273],{"class":246},[87,7752,7753],{"class":89,"line":168},[87,7754,7755],{"class":246},"    Your browser does not support Clipboard API\n",[87,7757,7758,7760,7762],{"class":89,"line":174},[87,7759,2923],{"class":246},[87,7761,20],{"class":250},[87,7763,273],{"class":246},[87,7765,7766,7768,7770],{"class":89,"line":180},[87,7767,1945],{"class":246},[87,7769,1919],{"class":250},[87,7771,273],{"class":246},[224,7773,7775],{"id":7774},"react-related-ecosystem","React-Related Ecosystem",[20,7777,7778],{},"Unlike Vue's VueUse dominating the scene, React has many available hooks libraries, so let's go through them all.",[7249,7780,7782],{"id":7781},"react-use-usecopytoclipboard",[591,7783,7786],{"href":7784,"rel":7785},"https://github.com/streamich/react-use",[621],"react-use - useCopyToClipboard",[20,7788,7789,7790,7793],{},"react-use is the largest React Hooks library I could find, with 42.9k stars. The copying solution directly depends on ",[591,7791,7471],{"href":7474,"rel":7792},[621]," mentioned above, which is the execCommand solution.",[79,7795,7799],{"className":7796,"code":7797,"language":7798,"meta":33,"style":33},"language-jsx shiki shiki-themes one-light one-dark-pro","const Demo = () => {\n  const [text, setText] = React.useState('');\n  const [state, copyToClipboard] = useCopyToClipboard();\n\n  return (\n    \u003Cdiv>\n      \u003Cinput value={text} onChange={e => setText(e.target.value)} />\n      \u003Cbutton type=\"button\" onClick={() => copyToClipboard(text)}>copy text\u003C/button>\n      {state.error\n        ? \u003Cp>Unable to copy value: {state.error.message}\u003C/p>\n        : state.value && \u003Cp>Copied {state.value}\u003C/p>}\n    \u003C/div>\n  )\n}\n","jsx",[74,7800,7801,7806,7811,7816,7820,7825,7830,7835,7840,7845,7850,7855,7860,7865],{"__ignoreMap":33},[87,7802,7803],{"class":89,"line":90},[87,7804,7805],{},"const Demo = () => {\n",[87,7807,7808],{"class":89,"line":96},[87,7809,7810],{},"  const [text, setText] = React.useState('');\n",[87,7812,7813],{"class":89,"line":3},[87,7814,7815],{},"  const [state, copyToClipboard] = useCopyToClipboard();\n",[87,7817,7818],{"class":89,"line":107},[87,7819,129],{"emptyLinePlaceholder":128},[87,7821,7822],{"class":89,"line":113},[87,7823,7824],{},"  return (\n",[87,7826,7827],{"class":89,"line":119},[87,7828,7829],{},"    \u003Cdiv>\n",[87,7831,7832],{"class":89,"line":125},[87,7833,7834],{},"      \u003Cinput value={text} onChange={e => setText(e.target.value)} />\n",[87,7836,7837],{"class":89,"line":132},[87,7838,7839],{},"      \u003Cbutton type=\"button\" onClick={() => copyToClipboard(text)}>copy text\u003C/button>\n",[87,7841,7842],{"class":89,"line":138},[87,7843,7844],{},"      {state.error\n",[87,7846,7847],{"class":89,"line":144},[87,7848,7849],{},"        ? \u003Cp>Unable to copy value: {state.error.message}\u003C/p>\n",[87,7851,7852],{"class":89,"line":150},[87,7853,7854],{},"        : state.value && \u003Cp>Copied {state.value}\u003C/p>}\n",[87,7856,7857],{"class":89,"line":156},[87,7858,7859],{},"    \u003C/div>\n",[87,7861,7862],{"class":89,"line":162},[87,7863,7864],{},"  )\n",[87,7866,7867],{"class":89,"line":168},[87,7868,1226],{},[7249,7870,7872],{"id":7871},"ant-design-typography",[591,7873,7876],{"href":7874,"rel":7875},"https://ant.design/components/typography#typography-demo-copyable",[621],"Ant Design - Typography",[20,7878,7879,7880,7883],{},"ahooks was the first React hooks library mentioned to me. It's maintained by the Ant Design team. However, it doesn't have clipboard encapsulation in the repository, so I looked into Ant Design's Typography implementation of copying capability. Like react-use above, it directly uses ",[591,7881,7471],{"href":7474,"rel":7882},[621],", which is the execCommand solution.",[7249,7885,7887],{"id":7886},"usehooks-usecopytoclipboard",[591,7888,7891],{"href":7889,"rel":7890},"https://usehooks.com/usecopytoclipboard",[621],"usehooks - useCopyToClipboard",[20,7893,7894,7895,7897],{},"I learned about this library from an LLM, and it now has 10.5k stars. What's quite absurd is that all its logic code is implemented in a single file called index.js, which is truly baffling. It first attempts to write using ",[74,7896,6914],{},", then switches to the execCommand solution if that fails. The hooks usage is similar to react-use above.",[7249,7899,7901],{"id":7900},"usehooks-ts-usecopytoclipboard",[591,7902,7905],{"href":7903,"rel":7904},"https://usehooks-ts.com/react-hook/use-copy-to-clipboard",[621],"usehooks-ts - useCopyToClipboard",[20,7907,7908,7909,7911,7912,7915],{},"I wonder if this library was created to solve the lack of TypeScript support in the above one. It only uses ",[74,7910,6914],{}," to attempt writing to the clipboard, and directly logs a ",[74,7913,7914],{},"console.warn"," error if it fails, with no fallback solution.",[51,7917,7919],{"id":7918},"conclusion","Conclusion",[20,7921,7922],{},"From a results perspective, VueUse's encapsulation is undoubtedly the most satisfying to me. It prioritizes trying the best-performing Clipboard API, then falls back to execCommand, while providing multiple reactive variables to assist development, but doesn't presumptuously use prompt as a guarantee, maximizing the operational space left to developers.",[20,7924,7925],{},"Looking back from the vantage point of 2025, the evolution trajectory of frontend clipboard operation technology is clearly visible: from early fragile Flash-dependent solutions, to execCommand's workaround, and finally moving toward the elegant implementation of standardized Clipboard API. This journey is not only a microcosm of technological iteration, but also reflects the unique \"art of compromise\" in frontend development.",[20,7927,7928],{},"For a long time to come, we may still be finding balance between \"elegant implementation\" and \"backward compatibility,\" dancing ballet in shackles within the browser sandbox. But those temporary solutions born for compatibility will eventually become precious footnotes witnessing the evolution of frontend history.",[51,7930,4665],{"id":4664},[389,7932,7933,7940,7947,7953,7960,7966,7972,7978,7985,7991,7997,8004],{},[392,7934,7935],{},[591,7936,7939],{"href":7937,"rel":7938},"https://liruifengv.com/posts/copy-text/",[621],"Pitfalls and Complete Solution for JS Copy Text to Clipboard",[392,7941,7942],{},[591,7943,7946],{"href":7944,"rel":7945},"https://jiongks.name/blog/zeroclipboard-intro",[621],"ZeroClipboard Study Notes | Jiongks",[392,7948,7949],{},[591,7950,7952],{"href":6574,"rel":7951},[621],"Cut and copy commands | Blog | Chrome for Developers",[392,7954,7955],{},[591,7956,7959],{"href":7957,"rel":7958},"https://learn.microsoft.com/en-us/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms536419(v=vs.85)",[621],"execCommand method (Internet Explorer) | Microsoft Learn",[392,7961,7962],{},[591,7963,7965],{"href":7474,"rel":7964},[621],"sudodoki/copy-to-clipboard",[392,7967,7968],{},[591,7969,7971],{"href":7335,"rel":7970},[621],"zenorocha/clipboard.js",[392,7973,7974],{},[591,7975,7977],{"href":7534,"rel":7976},[621],"useClipboard | VueUse",[392,7979,7980],{},[591,7981,7984],{"href":7982,"rel":7983},"https://streamich.github.io/react-use/?path=/story/side-effects-usecopytoclipboard--docs",[621],"Side-effects / useCopyToClipboard - Docs ⋅ Storybook",[392,7986,7987],{},[591,7988,7990],{"href":6566,"rel":7989},[621],"document.execCommand - Web API | MDN",[392,7992,7993],{},[591,7994,7996],{"href":6840,"rel":7995},[621],"Clipboard.writeText() - Web API | MDN",[392,7998,7999],{},[591,8000,8003],{"href":8001,"rel":8002},"https://www.sitepoint.com/community/t/onclick-select-all-and-copy-to-clipboard/3837/2",[621],"Onclick Select All and Copy to Clipboard? - JavaScript - SitePoint Forums | Web Development & Design Community",[392,8005,8006],{},[591,8007,8010],{"href":8008,"rel":8009},"https://stackoverflow.com/questions/16526814/how-would-i-implement-copy-url-to-clipboard-from-a-link-or-button-using-javasc",[621],"How would I implement 'copy url to clipboard' from a link or button using javascript or dojo without flash - Stack Overflow",[547,8012,8013],{},"html pre.shiki code .sW2Sy, html code.shiki .sW2Sy{--shiki-default:#A0A1A7;--shiki-default-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic}html pre.shiki code .sLKXg, html code.shiki .sLKXg{--shiki-default:#A626A4;--shiki-dark:#C678DD}html pre.shiki code .sNmU0, html code.shiki .sNmU0{--shiki-default:#986801;--shiki-dark:#E5C07B}html pre.shiki code .s_Sar, html code.shiki .s_Sar{--shiki-default:#0184BC;--shiki-dark:#56B6C2}html pre.shiki code .s7GmK, html code.shiki .s7GmK{--shiki-default:#383A42;--shiki-dark:#E5C07B}html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html pre.shiki code .sJa8x, html code.shiki .sJa8x{--shiki-default:#E45649;--shiki-dark:#E06C75}html pre.shiki code .sz0mV, html code.shiki .sz0mV{--shiki-default:#383A42;--shiki-dark:#E06C75}html pre.shiki code .s2QsP, html code.shiki .s2QsP{--shiki-default:#E45649;--shiki-dark:#E5C07B}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html pre.shiki code .s8iYz, html code.shiki .s8iYz{--shiki-default:#383A42;--shiki-default-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic}html pre.shiki code .sblXP, html code.shiki .sblXP{--shiki-default:#383A42;--shiki-dark:#C678DD}",{"title":33,"searchDepth":96,"depth":96,"links":8015},[8016,8023,8029,8030],{"id":6553,"depth":96,"text":6554,"children":8017},[8018,8019,8020,8022],{"id":6563,"depth":3,"text":6568},{"id":6837,"depth":3,"text":6842},{"id":7212,"depth":3,"text":8021},"Flash Solution (ZeroClipboard)",{"id":7246,"depth":3,"text":7247},{"id":7325,"depth":96,"text":7326,"children":8024},[8025,8026,8027,8028],{"id":7332,"depth":3,"text":7337},{"id":7471,"depth":3,"text":7471},{"id":7531,"depth":3,"text":7536},{"id":7774,"depth":3,"text":7775},{"id":7918,"depth":96,"text":7919},{"id":4664,"depth":96,"text":4665},{"title":8032,"date":8033,"path":8034,"tags":8035,"body":8041},"SSH to the Rescue - Running APT Updates on Internal Network Servers via SSH Tunnels","2025-03-30 21:45:24","/2025/03/30/apt-upgrade-on-internal-server-via-ssh-tunnel-and-reverse-proxy",[8036,13,8037,8038,8039,8040],"Apt","OpenSSH","Caddy","Linux","Debian",{"type":17,"value":8042,"toc":8317},[8043,8052,8057,8060,8064,8075,8079,8088,8091,8131,8134,8153,8158,8161,8166,8171,8175,8178,8197,8206,8209,8212,8225,8230,8234,8237,8249,8254,8266,8291,8297,8303,8306,8311,8314],[20,8044,8045,8046,8051],{},"This all started when Jinghong's ",[591,8047,8050],{"href":8048,"rel":8049},"https://blog.cnpatrickstar.com/",[621],"former technical director"," complained that the school's internal network servers couldn't connect to the external network, making APT installation and updates extremely difficult. He had to manually download packages from the source, along with their dependencies, and the dependencies of those dependencies... and then transfer all these packages to the server via sftp/rsync or similar methods for manual installation.",[20,8053,8054],{},[31,8055],{"alt":33,"src":8056},"https://static.031130.xyz/uploads/2025/03/30/0447b7d64886a.webp",[20,8058,8059],{},"Thus, this article was born. We can use Caddy (Nginx works too, of course) on our local machine to reverse proxy an APT mirror site, establish port forwarding through an SSH tunnel, allowing the internal network server to access the local Caddy server and thereby reach the external mirror site.",[51,8061,8063],{"id":8062},"prerequisites","Prerequisites",[389,8065,8066,8069],{},[392,8067,8068],{},"Your control machine (your own computer) can directly connect to the computer via SSH (possibly using some network tools), rather than first logging into a jump host via SSH and then logging into the target server from there. The latter situation can certainly achieve our goal using similar methods, but would be more complex.",[392,8070,8071,8072,2449],{},"Your control machine (your own computer) can connect to public mirror sites while connected to the internal network server (",[5401,8073,8074],{},"if not, you might want to sync a local mirror in advance to create an offline mirror site",[51,8076,8078],{"id":8077},"reverse-proxying-the-mirror-site","Reverse Proxying the Mirror Site",[20,8080,8081,8082,8087],{},"I chose Caddy over Nginx here - on one hand, Caddy's configuration files are simpler to write, and on the other hand, Caddy is written in Golang, so it's a single binary that works everywhere, and Windows can directly ",[591,8083,8086],{"href":8084,"rel":8085},"https://caddyserver.com/download",[621],"download"," and run it.",[20,8089,8090],{},"Using the most common Tsinghua TUNA mirror site as an example, a simple Caddy configuration file looks like this:",[79,8092,8096],{"className":8093,"code":8094,"language":8095,"meta":33,"style":33},"language-nginx shiki shiki-themes one-light one-dark-pro",":8080 {\n    reverse_proxy https://mirrors.tuna.tsinghua.edu.cn {\n        header_up Host {http.reverse_proxy.upstream.hostport}\n    }\n}\n","nginx",[74,8097,8098,8107,8115,8123,8127],{"__ignoreMap":33},[87,8099,8100,8102,8105],{"class":89,"line":90},[87,8101,77],{"class":246},[87,8103,8104],{"class":806},"8080",[87,8106,2048],{"class":246},[87,8108,8109,8112],{"class":89,"line":96},[87,8110,8111],{"class":806},"    reverse_proxy",[87,8113,8114],{"class":246}," https://mirrors.tuna.tsinghua.edu.cn {\n",[87,8116,8117,8120],{"class":89,"line":3},[87,8118,8119],{"class":806},"        header_up",[87,8121,8122],{"class":246}," Host {http.reverse_proxy.upstream.hostport}\n",[87,8124,8125],{"class":89,"line":107},[87,8126,1202],{"class":246},[87,8128,8129],{"class":89,"line":113},[87,8130,1226],{"class":246},[20,8132,8133],{},"Save the above code as a file named Caddyfile, then run it using the caddy command in the saved path:",[79,8135,8137],{"className":772,"code":8136,"language":774,"meta":33,"style":33},"caddy run --config ./Caddyfile\n",[74,8138,8139],{"__ignoreMap":33},[87,8140,8141,8144,8147,8150],{"class":89,"line":90},[87,8142,8143],{"class":781},"caddy",[87,8145,8146],{"class":261}," run",[87,8148,8149],{"class":254}," --config",[87,8151,8152],{"class":261}," ./Caddyfile\n",[20,8154,8155],{},[31,8156],{"alt":33,"src":8157},"https://static.031130.xyz/uploads/2025/03/30/8ef15a08e4852.webp",[20,8159,8160],{},"If there are no errors, you should be able to see the Tsinghua mirror site on your local port 8080:",[20,8162,8163],{},[31,8164],{"alt":33,"src":8165},"https://static.031130.xyz/uploads/2025/03/30/a9083c95c07a2.webp",[42,8167,8168],{},[20,8169,8170],{},"You may notice that the reverse proxied page differs slightly from Tsinghua's mirror site - it doesn't have Tsinghua's logo. This is probably because the page's JavaScript checks the host, and if it's not Tsinghua or BFSU's page, it won't add the school name. But this doesn't affect our ability to fetch updates from these mirror sites.",[51,8172,8174],{"id":8173},"establishing-the-ssh-tunnel","Establishing the SSH Tunnel",[20,8176,8177],{},"To establish the tunnel, use the following command:",[79,8179,8181],{"className":772,"code":8180,"language":774,"meta":33,"style":33},"ssh -R 8085:localhost:8080 root@remote.example.com\n",[74,8182,8183],{"__ignoreMap":33},[87,8184,8185,8188,8191,8194],{"class":89,"line":90},[87,8186,8187],{"class":781},"ssh",[87,8189,8190],{"class":254}," -R",[87,8192,8193],{"class":261}," 8085:localhost:8080",[87,8195,8196],{"class":261}," root@remote.example.com\n",[20,8198,8199,8200,8205],{},"The -R flag indicates establishing a reverse tunnel. For other parameter options, you can refer to this blog post \"",[591,8201,8204],{"href":8202,"rel":8203},"https://www.entropy-tree.top/2024/04/18/ssh-tunneling-techniques/",[621],"SSH Tunneling Techniques","\", also written by a Jinghong senior.",[20,8207,8208],{},"At this point, we've established SSH port forwarding from the internal network server's port 8085 to our local machine's port 8080. (I used port 8085 to distinguish it from port 8080; in practice, you can use any available port)",[20,8210,8211],{},"We can test whether we can access it normally on the server using curl. Here I simply accessed a README file in the Debian source root directory:",[79,8213,8215],{"className":772,"code":8214,"language":774,"meta":33,"style":33},"curl http://localhost:8085/debian/README\n",[74,8216,8217],{"__ignoreMap":33},[87,8218,8219,8222],{"class":89,"line":90},[87,8220,8221],{"class":781},"curl",[87,8223,8224],{"class":261}," http://localhost:8085/debian/README\n",[20,8226,8227],{},[31,8228],{"alt":33,"src":8229},"https://static.031130.xyz/uploads/2025/03/30/597c4af0d398d.webp",[51,8231,8233],{"id":8232},"changing-sources","Changing Sources",[20,8235,8236],{},"So now we have a reverse proxy of the Tsinghua open source mirror site on the internal network server's port 8085, and we can access all content in the mirror site through port 8085.",[20,8238,8239,8240,8245,8246,65],{},"First, follow the ",[591,8241,8244],{"href":8242,"rel":8243},"https://mirrors.tuna.tsinghua.edu.cn/help/debian/",[621],"instructions from Tsinghua Open Source Mirror Site"," to change sources. ",[24,8247,8248],{},"Remember to check \"Force security updates to use mirror\"",[20,8250,8251],{},[31,8252],{"alt":33,"src":8253},"https://static.031130.xyz/uploads/2025/03/30/46e3c7030ded4.webp",[20,8255,8256,8257,8261,8262,77],{},"Then, we replace all instances of ",[591,8258,8259],{"href":8259,"rel":8260},"https://mirrors.tuna.tsinghua.edu.cn",[621]," in the sources with ",[591,8263,8264],{"href":8264,"rel":8265},"http://localhost:8085",[621],[79,8267,8269],{"className":772,"code":8268,"language":774,"meta":33,"style":33},"sed -i 's|https\\?://mirrors\\.tuna\\.tsinghua\\.edu\\.cn|http://localhost:8085|g' `grep -rlE 'http(s)?://mirrors\\.tuna\\.tsinghua\\.edu\\.cn' /etc/apt/`\n",[74,8270,8271],{"__ignoreMap":33},[87,8272,8273,8275,8277,8280,8283,8285,8288],{"class":89,"line":90},[87,8274,4307],{"class":781},[87,8276,4310],{"class":254},[87,8278,8279],{"class":261}," 's|https\\?://mirrors\\.tuna\\.tsinghua\\.edu\\.cn|http://localhost:8085|g'",[87,8281,8282],{"class":261}," `",[87,8284,4319],{"class":781},[87,8286,8287],{"class":254}," -rlE",[87,8289,8290],{"class":261}," 'http(s)?://mirrors\\.tuna\\.tsinghua\\.edu\\.cn' /etc/apt/`\n",[20,8292,8293],{},[31,8294],{"alt":8295,"src":8296},"Running apt update","https://static.031130.xyz/uploads/2025/03/30/a8f0c70d48f5b.webp",[20,8298,8299],{},[31,8300],{"alt":8301,"src":8302},"Installing unzip using apt","https://static.031130.xyz/uploads/2025/03/30/07919bf939e92.webp",[20,8304,8305],{},"As you can see, we've successfully implemented APT updates and software installation on the internal network server through an SSH tunnel.",[42,8307,8308],{},[20,8309,8310],{},"Friendly reminder: SSH tunnels were frequently used in the early 2010s to establish cross-border access, but quickly faded from the scene due to their distinctive traffic characteristics. Therefore, don't use SSH for large amounts of cross-border network transmission, as it's easy to get blocked.",[20,8312,8313],{},"Of course, there are many ways to achieve this goal. Other tools like frp can achieve the same effect, but the SSH tunnel solution can be started and stopped on demand without additional configuration, which is why I primarily recommend it.",[547,8315,8316],{},"html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html pre.shiki code .sLKXg, html code.shiki .sLKXg{--shiki-default:#A626A4;--shiki-dark:#C678DD}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}",{"title":33,"searchDepth":96,"depth":96,"links":8318},[8319,8320,8321,8322],{"id":8062,"depth":96,"text":8063},{"id":8077,"depth":96,"text":8078},{"id":8173,"depth":96,"text":8174},{"id":8232,"depth":96,"text":8233},{"title":8324,"date":8325,"path":8326,"tags":8327,"body":8333},"Cudy TR3000 daed Installation Guide","2025-02-28 21:18:34","/2025/02/28/cudy-tr3000-daed-install-record",[8328,8329,13,8330,8331,8332],"OpenSource Project","Hardware","Router","OpenWRT","ImmortalWRT",{"type":17,"value":8334,"toc":8640},[8335,8337,8340,8345,8348,8354,8363,8365,8369,8376,8381,8385,8388,8391,8397,8400,8405,8409,8412,8417,8420,8425,8428,8434,8437,8442,8447,8451,8457,8462,8468,8474,8479,8482,8501,8506,8510,8513,8520,8526,8531,8534,8539,8549,8554,8557,8562,8565,8570,8576,8582,8586,8592,8598,8600,8637],[51,8336,2533],{"id":2532},[20,8338,8339],{},"Not long ago, I spotted the Cudy TR3000 router I'd been eyeing for a while at a discount price of ¥153 on JD.com. While it wasn't quite the all-time low of ¥130 (or even ¥110 with bundled deals), it was within my acceptable range. So I immediately ordered this Cudy TR3000 mini router I'd been longing for, to help ease my pre-semester anxiety (a mental condition).",[20,8341,8342],{},[31,8343],{"alt":33,"src":8344},"https://static.031130.xyz/uploads/2025/02/23/8b0a4d5812179.webp",[20,8346,8347],{},"This router is powered by Type-C and features one 2.5Gbps WAN port and one 1Gbps LAN port. Additionally, it has a USB port that can be used for printer sharing, mounting external storage, Android phone USB network sharing, and various other purposes. What really attracted me was its compact size, making it perfect for business trips, travel, short-term rentals, and similar scenarios. Considering I might need to rent a place for an upcoming internship, I seized this opportunity to order it.",[20,8349,8350],{},[31,8351],{"alt":8352,"src":8353},"Size comparison with a Xiaomi 8 phone","https://static.031130.xyz/uploads/2025/02/23/ef2b394e6fc0d.webp",[20,8355,8356,8357,8362],{},"The official firmware is a customized version of OpenWRT with limited functionality, so I decided to flash the original OpenWRT system to increase its capabilities. On the Enshan wireless forum, I found that someone had already compiled ",[591,8358,8361],{"href":8359,"rel":8360},"https://www.right.com.cn/forum/forum.php?mod=viewthread&tid=8418091",[621],"an OpenWRT system based on Linux kernel 6.6",". This meets the kernel version requirement (>= 5.17) for dae's Bind to LAN feature, and the 512MB memory size just reaches the recommended minimum. So I definitely had to give dae a try. If successful, this would be my first hardware router running dae.",[536,8364],{},[51,8366,8368],{"id":8367},"starting-the-flashing-process","Starting the Flashing Process",[20,8370,8371,8372,8375],{},"The router's official system management interface is at 192.168.10.1. On first access, you'll be asked to set a password, then just click through the initialization process to reach the main page. My unit has firmware version ",[74,8373,8374],{},"2.3.2-20241226",". I'm not sure if later versions can still use this method.",[20,8377,8378],{},[31,8379],{"alt":33,"src":8380},"https://static.031130.xyz/uploads/2025/02/28/1c066cb1dab3f.webp",[224,8382,8384],{"id":8383},"transition-firmware","Transition Firmware",[20,8386,8387],{},"First, we need to flash the so-called \"transition firmware\". The purpose of flashing transition firmware is that it can be recognized by the official system's upgrade program, allowing us to proceed with subsequent operations.",[20,8389,8390],{},"The transition firmware filename and MD5 hash:",[79,8392,8395],{"className":8393,"code":8394,"language":1248},[4518],"b8333d8eebd067fcb43bec855ac22364  cudy_tr3000-v1-sysupgrade.bin\n",[74,8396,8394],{"__ignoreMap":33},[20,8398,8399],{},"Then we can find the firmware upgrade section in the basic settings of the router's management page, and select the transition firmware to upload and update in the local update section.",[20,8401,8402],{},[31,8403],{"alt":33,"src":8404},"https://static.031130.xyz/uploads/2025/02/28/3582e569954a6.webp",[224,8406,8408],{"id":8407},"flash-firmware-to-unlock-fip-partition-write-permission","Flash Firmware to Unlock FIP Partition Write Permission",[20,8410,8411],{},"After flashing the transition firmware, wait about one minute for the router's DHCP to restart, and we can access the transition firmware's management page at 192.168.1.1.",[20,8413,8414],{},[31,8415],{"alt":33,"src":8416},"https://static.031130.xyz/uploads/2025/02/28/6fe8107a87e87.webp",[20,8418,8419],{},"There's no password on first login - you can enter anything to log in successfully. Considering we might need to restore factory settings later, it's recommended to back up the FIP partition at this step.",[20,8421,8422],{},[31,8423],{"alt":33,"src":8424},"https://static.031130.xyz/uploads/2025/02/28/79caf5f643689.webp",[20,8426,8427],{},"This time we need to flash the following LEDE firmware to unlock FIP partition write permission. The filename and MD5 are provided below:",[79,8429,8432],{"className":8430,"code":8431,"language":1248},[4518],"4af5129368cbf0d556061f682b1614f2  openwrt-mediatek-filogic-cudy_tr3000-v1-squashfs-sysupgrade.bin\n",[74,8433,8431],{"__ignoreMap":33},[20,8435,8436],{},"Select flash firmware below, upload the firmware we need to flash, and proceed.",[20,8438,8439],{},[31,8440],{"alt":33,"src":8441},"https://static.031130.xyz/uploads/2025/02/28/79d300bb33d21.webp",[20,8443,8444],{},[31,8445],{"alt":33,"src":8446},"https://static.031130.xyz/uploads/2025/02/28/bc29dc9cad24a.webp",[224,8448,8450],{"id":8449},"flash-u-boot","Flash U-Boot",[20,8452,8453,8454,65],{},"After waiting about another minute for the computer to reconnect to the router, we can access this firmware with unlocked FIP partition write permission. The default password is ",[74,8455,8456],{},"password",[20,8458,8459],{},[31,8460],{"alt":33,"src":8461},"https://static.031130.xyz/uploads/2025/02/28/f98051faba608.webp",[20,8463,8464,8465],{},"Select File Transfer in the sidebar and upload the U-Boot to be flashed. The filename and MD5 are below. ",[24,8466,8467],{},"Note: Extract the zip file first",[79,8469,8472],{"className":8470,"code":8471,"language":1248},[4518],"e5ff31bac07108b6ac6cd63189b4d113  dhcp-mt7981_cudy_tr3000-fip-fixed-parts-multi-layout.bin\n",[74,8473,8471],{"__ignoreMap":33},[20,8475,8476],{},[31,8477],{"alt":33,"src":8478},"https://static.031130.xyz/uploads/2025/02/28/547c5d324f0a0.webp",[20,8480,8481],{},"Then access the TTYD terminal from the sidebar, enter the default username/password root / password, and execute the command to flash U-Boot:",[79,8483,8485],{"className":772,"code":8484,"language":774,"meta":33,"style":33},"mtd write /tmp/upload/dhcp-mt7981_cudy_tr3000-fip-fixed-parts-multi-layout.bin FIP\n",[74,8486,8487],{"__ignoreMap":33},[87,8488,8489,8492,8495,8498],{"class":89,"line":90},[87,8490,8491],{"class":781},"mtd",[87,8493,8494],{"class":261}," write",[87,8496,8497],{"class":261}," /tmp/upload/dhcp-mt7981_cudy_tr3000-fip-fixed-parts-multi-layout.bin",[87,8499,8500],{"class":261}," FIP\n",[20,8502,8503],{},[31,8504],{"alt":33,"src":8505},"https://static.031130.xyz/uploads/2025/02/28/46b4fc5be8c82.webp",[224,8507,8509],{"id":8508},"flash-self-compiled-immortalwrt","Flash Self-Compiled ImmortalWRT",[20,8511,8512],{},"After flashing U-Boot, power off the router. Ensure the ethernet cable connects the computer to the router's LAN port, then press and hold the reset button while plugging in the power. Hold until the white light blinks four times and turns red, then release the reset button to enter U-Boot.",[20,8514,8515,8516,8519],{},"I compiled a 112m layout, so I need to select the ",[74,8517,8518],{},"mod-112m"," MTD layout before uploading and flashing the firmware.",[79,8521,8524],{"className":8522,"code":8523,"language":1248},[4518],"8c9a44f29c8c5a0617e61d49bf8ad45d  112m-immortalwrt-cudy_tr3000-ebpf_by_zhullyb_20250325-squashfs-sysupgrade.bin\n",[74,8525,8523],{"__ignoreMap":33},[20,8527,8528],{},[31,8529],{"alt":33,"src":8530},"https://static.031130.xyz/uploads/2025/02/28/41c250db91756.webp",[20,8532,8533],{},"Wait again for the computer to reconnect to the router. This is the final system with daed support. Again, there's no default password - just enter anything to access. After connecting to the network, go to System - Software Packages page and update the package list.",[20,8535,8536],{},[31,8537],{"alt":33,"src":8538},"https://static.031130.xyz/uploads/2025/02/28/e56084ff09a5d.webp",[20,8540,8541,8542,642,8545,8548],{},"Then you can install dae/daed related software. Choose ",[74,8543,8544],{},"luci-i18n-dae-zh-cn",[74,8546,8547],{},"luci-i18n-daed-zh-cn"," based on your needs. Other packages will be installed as dependencies. I installed daed here.",[20,8550,8551],{},[31,8552],{"alt":33,"src":8553},"https://static.031130.xyz/uploads/2025/02/28/dc4fa4a688cf5.webp",[20,8555,8556],{},"After installation, refresh the page and you'll see daed in the Services section of the top bar.",[20,8558,8559],{},[31,8560],{"alt":33,"src":8561},"https://static.031130.xyz/uploads/2025/02/28/551f1f2eb9ab4.webp",[20,8563,8564],{},"Daed runs normally and can fully utilize my home's 300Mbps downstream bandwidth (single-thread actual test: 250Mbps). CPU usage graph at peak speed is shown below.",[20,8566,8567],{},[31,8568],{"alt":33,"src":8569},"https://static.031130.xyz/uploads/2025/02/28/651bed7ad4aba.webp",[20,8571,8572],{},[31,8573],{"alt":8574,"src":8575},"Multi-thread speed test","https://static.031130.xyz/uploads/2025/03/01/9fcee79afa63b.png",[20,8577,8578],{},[31,8579],{"alt":8580,"src":8581},"Single-thread speed test","https://static.031130.xyz/uploads/2025/03/01/6716d723a2b0d.png",[51,8583,8585],{"id":8584},"files-mentioned-in-this-article","Files Mentioned in This Article",[20,8587,8588],{},[591,8589,8590],{"href":8590,"rel":8591},"https://www.123684.com/s/gfprVv-wEQ8d",[621],[20,8593,8594],{},[591,8595,8596],{"href":8596,"rel":8597},"https://www.123912.com/s/gfprVv-wEQ8d",[621],[51,8599,4665],{"id":4664},[389,8601,8602,8609,8616,8623,8630],{},[392,8603,8604],{},[591,8605,8608],{"href":8606,"rel":8607},"https://www.right.com.cn/forum/forum.php?mod=viewthread&tid=8410353",[621],"Cudy TR3000 Flashing Tutorial Guide",[392,8610,8611],{},[591,8612,8615],{"href":8613,"rel":8614},"https://abxy.fun/post/immortalwrt-dae/",[621],"Using ImmortalWrt+Dae to Configure Transparent Proxy for Windows",[392,8617,8618],{},[591,8619,8622],{"href":8620,"rel":8621},"https://www.right.com.cn/forum/forum.php?mod=viewthread&tid=8415351",[621],"Cudy TR3000 v1 Chinese Three-Partition DHCP U-Boot Second Edition",[392,8624,8625],{},[591,8626,8629],{"href":8627,"rel":8628},"https://blog.imouto.in/#/posts/10",[621],"Booting Mainline OpenWrt Firmware Using hanwckf/bl-mt798x",[392,8631,8632],{},[591,8633,8636],{"href":8634,"rel":8635},"https://github.com/QiuSimons/luci-app-daed",[621],"QiuSimons/luci-app-daed",[547,8638,8639],{},"html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}",{"title":33,"searchDepth":96,"depth":96,"links":8641},[8642,8643,8649,8650],{"id":2532,"depth":96,"text":2533},{"id":8367,"depth":96,"text":8368,"children":8644},[8645,8646,8647,8648],{"id":8383,"depth":3,"text":8384},{"id":8407,"depth":3,"text":8408},{"id":8449,"depth":3,"text":8450},{"id":8508,"depth":3,"text":8509},{"id":8584,"depth":96,"text":8585},{"id":4664,"depth":96,"text":4665},"/archives/",1771553317502]
[{"data":1,"prerenderedAt":515},["ShallowReactive",2],{"post-2026-01-31-mihomo-tun-fail-to-visit-dl-google-com-en":3,"surround-2026-01-31-mihomo-tun-fail-to-visit-dl-google-com-en":501,"randomIndex/2026/01/31/mihomo-tun-fail-to-visit-dl-google-com/":513,"language-switch-/en/2026/01/31/mihomo-tun-fail-to-visit-dl-google-com/-zh":514},{"title":4,"date":5,"path":6,"tags":7,"body":10,"description":500},"I Can’t Access dl.google.com — A Network Debugging Story Under TUN","2026-01-31","/2026/01/31/mihomo-tun-fail-to-visit-dl-google-com",[8,9],"Network","DNS",{"type":11,"value":12,"toc":490},"minimark",[13,43,52,59,65,71,81,86,95,101,104,116,119,123,137,143,150,156,172,183,191,195,198,225,236,242,249,252,256,259,285,291,294,302,307,314,328,331,354,357,363,370,378,382,389,397,411,464,473,477,486],[14,15,16,17,21,22,26,27,30,31,33,40,41,26],"p",{},"If you’re familiar enough with the current network environment in mainland China, you probably know that ",[18,19,20],"code",{},"dl.google.com"," is ",[23,24,25],"strong",{},"often directly accessible without a proxy",".",[28,29],"br",{},"\nFor example, you can download the Chrome offline installer directly from",[28,32],{},[34,35,39],"a",{"href":36,"rel":37},"https://google.cn/chrome/?standalone=1",[38],"nofollow","google.cn/chrome/?standalone=1"," on a domestic network, and the final download domain is ",[18,42,20],{},[14,44,45,46,49,50,26],{},"My usual setup is to keep my proxy tool’s TUN mode enabled 24/7. All traffic goes through a virtual network interface first, and then routing rules decide automatically whether it should go through the proxy or connect directly. Most of the time this setup is pretty hassle-free — until recently, when I was rolling updates on Arch Linux with ",[18,47,48],{},"yay"," and suddenly ran into an SSL connection failure with ",[18,51,20],{},[14,53,54],{},[55,56],"img",{"alt":57,"src":58},"yay update failed","https://static.031130.xyz/uploads/2026/01/31/df5e547511070.webp",[14,60,61,62,64],{},"It wasn’t just ",[18,63,48],{},". My browser showed the exact same result:",[14,66,67],{},[55,68],{"alt":69,"src":70},"Firefox access failed","https://static.031130.xyz/uploads/2026/01/31/8ada158510aba.webp",[14,72,73,74,78,80],{},"My first instinct was: ",[75,76,77],"em",{},"did my routing rules break again?",[28,79],{},"\n(They’re not written by me, so blaming them first is perfectly reasonable.)",[82,83,85],"h2",{"id":84},"the-rule-is-direct-no-one-else-to-blame","The Rule Is DIRECT — No One Else to Blame",[14,87,88,89,91,92,26],{},"I double-checked the routing rules. Traffic with SNI ",[18,90,20],{}," was explicitly configured as ",[23,93,94],{},"DIRECT",[14,96,97],{},[55,98],{"alt":99,"src":100},"Mihomo routing rules","https://static.031130.xyz/uploads/2026/01/31/96d27a20f2bf3.webp",[14,102,103],{},"That made things strange. Logically:",[105,106,107,113],"ul",{},[108,109,110,112],"li",{},[18,111,20],{}," itself is often directly reachable from domestic networks",[108,114,115],{},"The rule clearly says DIRECT",[14,117,118],{},"To be honest, I’d seen this issue before. Back then I had higher-priority tasks, so I just turned off the proxy tool, finished the update, and moved on. This time, though, I had nothing urgent on my plate — so I decided to finally dig into it properly.",[82,120,122],{"id":121},"it-resolved-to-an-overseas-ip","It Resolved to an Overseas IP",[14,124,125,126,129,130,133,134,136],{},"First, I disabled the proxy tool’s ",[18,127,128],{},"fake-ip"," mode and switched back to real IP resolution to avoid introducing extra variables. Then I used ",[18,131,132],{},"curl -vv"," to access a ",[18,135,20],{}," download URL and see where it was actually trying to connect.",[14,138,139],{},[55,140],{"alt":141,"src":142},"curl -vv output","https://static.031130.xyz/uploads/2026/01/31/d3dbfc513de9f.webp",[14,144,145,146,149],{},"Looking back now, I can say with confidence: the resolved IP belonged to Google’s ",[23,147,148],{},"overseas CDN",", not a domestic or domestically reachable data center.",[14,151,152],{},[55,153],{"alt":154,"src":155},"IP geolocation","https://static.031130.xyz/uploads/2026/01/31/7ba8a0b8a2579.webp",[14,157,158,159,161,162,165,166,168,169,171],{},"For those unfamiliar: when resolving ",[18,160,20],{}," for users in mainland China, DNS often returns ",[23,163,164],{},"domestically reachable IPs"," (otherwise direct downloads wouldn’t work at all).",[28,167],{},"\nThe overseas IP returned here was unreachable on my connection. Combined with the fact that I had configured ",[18,170,20],{}," as DIRECT, the result was:",[173,174,175,178],"blockquote",{},[14,176,177],{},"DNS returned an “overseas IP”",[105,179,180],{},[108,181,182],{},"Rules enforced DIRECT\n= Direct connection to an unreachable destination\n= TLS handshake failure",[14,184,185,186,188],{},"So this wasn’t a case of “the direct rule didn’t work”. It was more like:",[28,187],{},[23,189,190],{},"the rule worked perfectly, but DNS led me straight into a ditch.",[82,192,194],{"id":193},"who-is-answering-for-dlgooglecom","Who Is Answering for dl.google.com?",[14,196,197],{},"In the Mihomo core, the main DNS-related configuration options are:",[199,200,201,207,213,219],"ol",{},[108,202,203,206],{},[18,204,205],{},"nameserver",": default resolvers (most domains use these)",[108,208,209,212],{},[18,210,211],{},"direct-nameserver",": resolvers for DIRECT domains (only available in newer versions)",[108,214,215,218],{},[18,216,217],{},"proxy-server-nameserver",": resolvers for proxy node hostnames (irrelevant here)",[108,220,221,224],{},[18,222,223],{},"default-nameserver",": used to resolve “domain-form” nameservers in the DNS config itself (not expanded here)",[14,226,227,228,230,231,233,234,26],{},"Since ",[18,229,20],{}," was marked as a DIRECT domain, Mihomo should theoretically prefer ",[18,232,211],{},". If that isn’t set, it falls back to ",[18,235,205],{},[14,237,238,239,241],{},"At the time, my ",[18,240,205],{}," configuration was:",[105,243,244],{},[108,245,246],{},[18,247,248],{},"https://dns.alidns.com/dns-query",[14,250,251],{},"My intuition was simple: if the resolution looked like it came from an overseas CDN pool, I should verify whether AliDNS (DoH) itself was returning that overseas IP.",[82,253,255],{"id":254},"querying-alidns-doh-directly-overseas-pool-confirmed","Querying AliDNS DoH Directly — Overseas Pool Confirmed",[14,257,258],{},"AliDNS provides a JSON-based query interface, so I tested it directly with curl:",[260,261,266],"pre",{"className":262,"code":263,"language":264,"meta":265,"style":265},"language-bash shiki shiki-themes one-light one-dark-pro","curl -s 'https://dns.alidns.com/resolve?name=dl.google.com&type=A'\n","bash","",[18,267,268],{"__ignoreMap":265},[269,270,273,277,281],"span",{"class":271,"line":272},"line",1,[269,274,276],{"class":275},"sAdtL","curl",[269,278,280],{"class":279},"sAGMh"," -s",[269,282,284],{"class":283},"sDhpE"," 'https://dns.alidns.com/resolve?name=dl.google.com&type=A'\n",[14,286,287],{},[55,288],{"alt":289,"src":290},"DoH response","https://static.031130.xyz/uploads/2026/01/31/b457af9299330.webp",[14,292,293],{},"The returned IP was exactly the overseas one I’d seen earlier. At this point, I could confidently conclude:",[14,295,296],{},[23,297,298,299,301],{},"At least on my current network exit, AliDNS resolves ",[18,300,20],{}," to an overseas IP that is unreachable for me.",[303,304,306],"h3",{"id":305},"this-requires-two-conditions-both-are-necessary","This Requires Two Conditions (Both Are Necessary)",[14,308,309,310,313],{},"It’s important to emphasize something here: this is ",[75,311,312],{},"not"," simply “AliDNS always resolves it wrong”. After running a bunch of comparisons, I found the conditions to be surprisingly strict:",[173,315,316],{},[14,317,318,325,327],{},[23,319,320,321,324],{},"The issue reliably reproduces only when ",[75,322,323],{},"both"," “China Mobile broadband” and “AliDNS (including 223.5.5.5 or AliDNS DoH)” are used together.",[28,326],{},"\nRemove either condition, and the problem usually disappears.",[14,329,330],{},"More specifically:",[105,332,333,342,348],{},[108,334,335,338,339,341],{},[23,336,337],{},"Switch to China Telecom or China Unicom broadband",": with the same AliDNS, ",[18,340,20],{}," usually resolves correctly",[108,343,344,347],{},[23,345,346],{},"Stay on China Mobile broadband, but don’t use AliDNS",": resolution is usually fine",[108,349,350,353],{},[23,351,352],{},"China Mobile broadband + AliDNS",": high probability of getting an overseas IP pool, and DIRECT connections fail",[14,355,356],{},"I also ran nationwide resolution tests on itdog, and the reproduction rate was indeed much higher on China Mobile networks.",[14,358,359],{},[55,360],{"alt":361,"src":362},"itdog test results","https://static.031130.xyz/uploads/2026/01/31/d93222096f005.webp",[14,364,365,366,369],{},"Why does this happen? Honestly, I can’t provide a single authoritative explanation. What I ",[75,367,368],{},"can"," say is that the behavior is extremely consistent, and consistent enough for me to conclude:",[14,371,372],{},[23,373,374,375,377],{},"The problem isn’t TUN itself — it’s that, under TUN, my DNS choice sent ",[18,376,20],{}," to an address pool that’s unreachable on China Mobile.",[82,379,381],{"id":380},"how-did-i-finally-fix-it","How Did I Finally Fix It?",[14,383,384,385,388],{},"Since the issue was the combination of ",[23,386,387],{},"China Mobile + AliDNS",", the solution was straightforward:",[14,390,391],{},[23,392,393,394,396],{},"Stop letting ",[18,395,20],{}," be resolved by AliDNS.",[14,398,399,400,402,403,406,407,410],{},"You can do this by configuring ",[18,401,211],{},", using ",[18,404,405],{},"nameserver-policy",", switching to another public DNS like ",[18,408,409],{},"119.29.29.29",", or even delegating DNS resolution to your home router.",[260,412,416],{"className":413,"code":414,"language":415,"meta":265,"style":265},"language-yaml shiki shiki-themes one-light one-dark-pro","direct-nameserver:\n  - 192.168.8.1\n\nnameserver-policy:\n  \"dl.google.com\": [119.29.29.29]\n","yaml",[18,417,418,427,436,443,450],{"__ignoreMap":265},[269,419,420,423],{"class":271,"line":272},[269,421,211],{"class":422},"sJa8x",[269,424,426],{"class":425},"s5ixo",":\n",[269,428,430,433],{"class":271,"line":429},2,[269,431,432],{"class":425},"  - ",[269,434,435],{"class":279},"192.168.8.1\n",[269,437,439],{"class":271,"line":438},3,[269,440,442],{"emptyLinePlaceholder":441},true,"\n",[269,444,446,448],{"class":271,"line":445},4,[269,447,405],{"class":422},[269,449,426],{"class":425},[269,451,453,456,459,461],{"class":271,"line":452},5,[269,454,455],{"class":283},"  \"dl.google.com\"",[269,457,458],{"class":425},": [",[269,460,409],{"class":279},[269,462,463],{"class":425},"]\n",[14,465,466,467,469,470,472],{},"After this change, ",[18,468,48],{}," updates worked normally again, and browsers could directly access ",[18,471,20],{}," without issues.",[82,474,476],{"id":475},"references","References",[105,478,479],{},[108,480,481],{},[34,482,485],{"href":483,"rel":484},"https://linux.do/t/topic/1061825",[38],"Minimal anti–DNS-leak configuration for the mihomo core (2025) – Development & Tuning – LINUX DO",[487,488,489],"style",{},"html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html pre.shiki code .sJa8x, html code.shiki .sJa8x{--shiki-default:#E45649;--shiki-dark:#E06C75}html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}",{"title":265,"searchDepth":429,"depth":429,"links":491},[492,493,494,495,498,499],{"id":84,"depth":429,"text":85},{"id":121,"depth":429,"text":122},{"id":193,"depth":429,"text":194},{"id":254,"depth":429,"text":255,"children":496},[497],{"id":305,"depth":438,"text":306},{"id":380,"depth":429,"text":381},{"id":475,"depth":429,"text":476},"If you’re familiar enough with the current network environment in mainland China, you probably know that dl.google.com is often directly accessible without a proxy.\nFor example, you can download the Chrome offline installer directly fromgoogle.cn/chrome/?standalone=1 on a domestic network, and the final download domain is dl.google.com.",[502,508],{"title":503,"path":504,"stem":505,"date":506,"lang":507,"children":-1},"Mainland China Xiaomi FCM Screen-Off Disconnection: Attempts and Possible Solutions in a Rootless Environment","/2026/02/20/xiaomi-china-version-fcm-push-debug","posts/en/xiaomi-china-version-fcm-push-debug","2026-02-20","en",{"title":509,"path":510,"stem":511,"date":512,"lang":507,"children":-1},"Have You Noticed Vercel's Cache Control?","/2025/12/23/vercel-cache-control","posts/en/vercel-cache-control","2025-12-23",6,"/2026/01/31/mihomo-tun-fail-to-visit-dl-google-com/",1771555478208]
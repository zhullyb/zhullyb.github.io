[{"data":1,"prerenderedAt":968},["ShallowReactive",2],{"post-2025-07-05-node-sass-migration-to-dart-sass-en":3,"surround-2025-07-05-node-sass-migration-to-dart-sass-en":956,"randomIndex/2025/07/05/node-sass-migration-to-dart-sass/":169,"language-switch-/en/2025/07/05/node-sass-migration-to-dart-sass/-zh":967},{"id":4,"title":5,"body":6,"date":940,"description":129,"extension":941,"lang":942,"meta":943,"navigation":511,"path":944,"rawbody":945,"seo":946,"stem":947,"sticky":948,"tags":949,"__hash__":955},"posts/posts/en/node-sass-migration-to-dart-sass.md","Migration from node-sass to dart-sass: A Troubleshooting Chronicle",{"type":7,"value":8,"toc":918},"minimark",[9,14,27,31,48,52,85,89,94,98,102,111,114,123,190,193,196,199,231,240,243,247,251,280,284,417,421,430,471,475,478,546,550,554,557,560,588,591,634,643,648,652,661,669,721,724,781,785,809,812,816,914],[10,11,13],"h2",{"id":12},"update-goals","Update Goals",[15,16,17,21,24],"ul",{},[18,19,20],"li",{},"node-sass -> sass (dart-sass)",[18,22,23],{},"Minimize impact, avoid updating other dependency versions unless necessary",[18,25,26],{},"Based on the above two conditions, see if we can upgrade the node.js version",[10,28,30],{"id":29},"reasons-to-abandon-node-sass","Reasons to Abandon node-sass",[15,32,33,42,45],{},[18,34,35],{},[36,37,41],"a",{"href":38,"rel":39},"https://sass-lang.com/blog/libsass-is-deprecated/",[40],"nofollow","node-sass has been deprecated, dart-sass is the officially recommended successor by Sass",[18,43,44],{},"node-sass installation on Windows is very troublesome, requiring both Python 2 and Microsoft Visual C++ on the development machine during npm installation",[18,46,47],{},"When installing node-sass, resources need to be pulled from GitHub, which has a low success rate in certain network environments",[10,49,51],{"id":50},"current-project-dependency-versions","Current Project Dependency Versions",[15,53,54,60,65,70,75,80],{},[18,55,56],{},[57,58,59],"code",{},"node@^12",[18,61,62],{},[57,63,64],{},"vue@^2",[18,66,67],{},[57,68,69],{},"webpack@^3",[18,71,72],{},[57,73,74],{},"vue-loader@^14",[18,76,77],{},[57,78,79],{},"sass-loader@^7.0.3",[18,81,82],{},[57,83,84],{},"node-sass@^4",[10,86,88],{"id":87},"update-strategy","Update Strategy",[90,91,93],"h3",{"id":92},"nodejs","node.js",[95,96,97],"p",{},"Webpack officially doesn't provide the maximum node version supported by webpack 3, and even if webpack officially supports it, related webpack plugins may not. Therefore, whether the node version can be updated can only be determined through testing. Fortunately, although this project's CI/CD runs on node 12, I've been using node 14 for daily development, so I'll take this opportunity to upgrade the node version to 14.",[90,99,101],{"id":100},"webpack-sass-loader","webpack, sass-loader",[95,103,104,105,110],{},"The webpack version is currently in a \"ticking time bomb\" state of not updating unless necessary. Based on the current webpack 3 limitation, the maximum supported sass-loader version is ^7 (sass-loader's ",[36,106,109],{"href":107,"rel":108},"https://github.com/webpack-contrib/sass-loader/blob/v8.0.0/CHANGELOG.md",[40],"8.0.0 version changelog"," explicitly states that version 8.0.0 requires webpack 4.36.0).",[95,112,113],{},"If sass-loader@^7 in the project supports using dart-sass, then there's no need to update sass-loader, and consequently no need to update webpack; otherwise, webpack would need to be updated to 4, and then determine the sass-loader version accordingly.",[95,115,116,117,122],{},"So does it support it or not? I found this package.json snippet on the ",[36,118,121],{"href":119,"rel":120},"https://www.webpackjs.com/loaders/sass-loader/",[40],"webpack official documentation page introducing sass-loader",":",[124,125,130],"pre",{"className":126,"code":127,"language":128,"meta":129,"style":129},"language-json shiki shiki-themes one-light one-dark-pro","{\n  \"devDependencies\": {\n    \"sass-loader\": \"^7.2.0\",\n    \"sass\": \"^1.22.10\"\n  }\n}\n","json","",[57,131,132,141,151,167,178,184],{"__ignoreMap":129},[133,134,137],"span",{"class":135,"line":136},"line",1,[133,138,140],{"class":139},"s5ixo","{\n",[133,142,144,148],{"class":135,"line":143},2,[133,145,147],{"class":146},"sJa8x","  \"devDependencies\"",[133,149,150],{"class":139},": {\n",[133,152,154,157,160,164],{"class":135,"line":153},3,[133,155,156],{"class":146},"    \"sass-loader\"",[133,158,159],{"class":139},": ",[133,161,163],{"class":162},"sDhpE","\"^7.2.0\"",[133,165,166],{"class":139},",\n",[133,168,170,173,175],{"class":135,"line":169},4,[133,171,172],{"class":146},"    \"sass\"",[133,174,159],{"class":139},[133,176,177],{"class":162},"\"^1.22.10\"\n",[133,179,181],{"class":135,"line":180},5,[133,182,183],{"class":139},"  }\n",[133,185,187],{"class":135,"line":186},6,[133,188,189],{"class":139},"}\n",[95,191,192],{},"This proves that at least sass-loader@7.2.0 already supported dart-sass, so the webpack version can stay at ^3, and sass-loader can temporarily stay at version 7.0.3. If there are issues later, it can be updated to the latest version 7.3.1 in the ^7 range.",[90,194,195],{"id":195},"dart-sass",[95,197,198],{},"I couldn't find the maximum sass version supported by sass-loader@^7. GitHub Copilot confidently told me:",[200,201,202,208,213,218],"blockquote",{},[95,203,204],{},[205,206,207],"strong",{},"Official documentation quote:",[200,209,210],{},[95,211,212],{},"sass-loader@^7.0.0 requires node-sass >=4.0.0 or sass >=1.3.0, \u003C=1.26.5.",[95,214,215],{},[205,216,217],{},"Suggestion:",[15,219,220],{},[18,221,222,223,226,227,230],{},"If you need to use a higher version of ",[57,224,225],{},"sass",", please upgrade to ",[57,228,229],{},"sass-loader"," 8 or higher.",[95,232,233,234,239],{},"However, I couldn't find any trace of this text on the internet. Moreover, the last version in sass's ~1.26 range is 1.26.11, not 1.26.5. ",[36,235,238],{"href":236,"rel":237},"https://docs.npmjs.com/about-semantic-versioning",[40],"According to common npm versioning principles",", releases that only change the patch version while keeping the major and minor versions the same generally only contain bugfixes without breaking changes. It's unlikely that updating from 1.26.5 to 1.26.11 would suddenly become incompatible with sass-loader 7, so this is more likely an AI hallucination or limited training data.",[95,241,242],{},"Out of caution, I ultimately decided to use the last version of sass 1.22 mentioned in the webpack official documentation, which is 1.22.12.",[10,244,246],{"id":245},"analysis-complete-lets-update","Analysis Complete, Let's Update",[90,248,250],{"id":249},"step-1-uninstall-node-sass-install-sass12212","Step 1: Uninstall node-sass, Install sass@^1.22.12",[124,252,256],{"className":253,"code":254,"language":255,"meta":129,"style":129},"language-bash shiki shiki-themes one-light one-dark-pro","npm uninstall node-sass\nnpm install sass@^1.22.12\n","bash",[57,257,258,270],{"__ignoreMap":129},[133,259,260,264,267],{"class":135,"line":136},[133,261,263],{"class":262},"sAdtL","npm",[133,265,266],{"class":162}," uninstall",[133,268,269],{"class":162}," node-sass\n",[133,271,272,274,277],{"class":135,"line":143},[133,273,263],{"class":262},[133,275,276],{"class":162}," install",[133,278,279],{"class":162}," sass@^1.22.12\n",[90,281,283],{"id":282},"step-2-update-webpack-configuration-optional","Step 2: Update webpack Configuration (Optional)",[124,285,289],{"className":286,"code":287,"language":288,"meta":129,"style":129},"language-diff shiki shiki-themes one-light one-dark-pro","module.exports = {\n  // ...\n  module: {\n    rules: [\n      {\n        test: /\\.(scss|sass)$/,\n        use: [\n          'style-loader',\n          'css-loader',\n          {\n            loader: 'sass-loader',\n+            options: {\n+                // In fact, this line doesn't need to be added in most sass-loader versions, sass-loader can automatically detect whether it's sass or node-sass\n+                implementation: require('sass')\n+              },\n            },\n          },\n        ],\n      },\n    ],\n  },\n};\n","diff",[57,290,291,296,301,306,311,316,321,327,333,339,345,351,357,363,369,375,381,387,393,399,405,411],{"__ignoreMap":129},[133,292,293],{"class":135,"line":136},[133,294,295],{"class":139},"module.exports = {\n",[133,297,298],{"class":135,"line":143},[133,299,300],{"class":139},"  // ...\n",[133,302,303],{"class":135,"line":153},[133,304,305],{"class":139},"  module: {\n",[133,307,308],{"class":135,"line":169},[133,309,310],{"class":139},"    rules: [\n",[133,312,313],{"class":135,"line":180},[133,314,315],{"class":139},"      {\n",[133,317,318],{"class":135,"line":186},[133,319,320],{"class":139},"        test: /\\.(scss|sass)$/,\n",[133,322,324],{"class":135,"line":323},7,[133,325,326],{"class":139},"        use: [\n",[133,328,330],{"class":135,"line":329},8,[133,331,332],{"class":139},"          'style-loader',\n",[133,334,336],{"class":135,"line":335},9,[133,337,338],{"class":139},"          'css-loader',\n",[133,340,342],{"class":135,"line":341},10,[133,343,344],{"class":139},"          {\n",[133,346,348],{"class":135,"line":347},11,[133,349,350],{"class":139},"            loader: 'sass-loader',\n",[133,352,354],{"class":135,"line":353},12,[133,355,356],{"class":162},"+            options: {\n",[133,358,360],{"class":135,"line":359},13,[133,361,362],{"class":162},"+                // In fact, this line doesn't need to be added in most sass-loader versions, sass-loader can automatically detect whether it's sass or node-sass\n",[133,364,366],{"class":135,"line":365},14,[133,367,368],{"class":162},"+                implementation: require('sass')\n",[133,370,372],{"class":135,"line":371},15,[133,373,374],{"class":162},"+              },\n",[133,376,378],{"class":135,"line":377},16,[133,379,380],{"class":139},"            },\n",[133,382,384],{"class":135,"line":383},17,[133,385,386],{"class":139},"          },\n",[133,388,390],{"class":135,"line":389},18,[133,391,392],{"class":139},"        ],\n",[133,394,396],{"class":135,"line":395},19,[133,397,398],{"class":139},"      },\n",[133,400,402],{"class":135,"line":401},20,[133,403,404],{"class":139},"    ],\n",[133,406,408],{"class":135,"line":407},21,[133,409,410],{"class":139},"  },\n",[133,412,414],{"class":135,"line":413},22,[133,415,416],{"class":139},"};\n",[90,418,420],{"id":419},"step-3-batch-replace-deep-syntax-with-v-deep","Step 3: Batch Replace /deep/ Syntax with ::v-deep",[95,422,423,424,429],{},"Because ",[36,425,428],{"href":426,"rel":427},"https://chromestatus.com/feature/4964279606312960",[40],"the /deep/ syntax was deprecated in 2017",", /deep/ became an unsupported deep selector. node-sass, with its excellent error tolerance, could continue to provide compatibility, but dart-sass doesn't support this syntax. So we need to batch replace the /deep/ syntax with ::v-deep, which, although abandoned in Vue's subsequent RFC, is still effectively supported to this day.",[124,431,433],{"className":253,"code":432,"language":255,"meta":129,"style":129},"# Something like this, using VSCode's batch replace also works\nsed -i 's#\\s*/deep/\\s*# ::v-deep #g' $(grep -rl '/deep/' .)\n",[57,434,435,441],{"__ignoreMap":129},[133,436,437],{"class":135,"line":136},[133,438,440],{"class":439},"sW2Sy","# Something like this, using VSCode's batch replace also works\n",[133,442,443,446,450,453,456,459,462,465,468],{"class":135,"line":143},[133,444,445],{"class":262},"sed",[133,447,449],{"class":448},"sAGMh"," -i",[133,451,452],{"class":162}," 's#\\s*/deep/\\s*# ::v-deep #g'",[133,454,455],{"class":139}," $(",[133,457,458],{"class":262},"grep",[133,460,461],{"class":448}," -rl",[133,463,464],{"class":162}," '/deep/'",[133,466,467],{"class":162}," .",[133,469,470],{"class":139},")\n",[90,472,474],{"id":473},"step-4-fix-other-sass-syntax-errors","Step 4: Fix Other Sass Syntax Errors",[95,476,477],{},"During the migration, I found some non-standard syntax in the project. node-sass, with its excellent robustness, silently forced parsing, while dart-sass can't handle this rough work. Therefore, these syntax errors need to be manually fixed based on compilation errors. I encountered two types:",[124,479,481],{"className":286,"code":480,"language":288,"meta":129,"style":129},"// Extra colon\n.foo {\n-  color:: #fff;\n+  color: #fff;\n}\n\n// :nth-last-child without specified number\n.bar {\n-  &:nth-last-child() {\n+  &:nth-last-child(1) {\n      margin-bottom: 0;\n  }\n}\n",[57,482,483,488,493,498,503,507,513,518,523,528,533,538,542],{"__ignoreMap":129},[133,484,485],{"class":135,"line":136},[133,486,487],{"class":139},"// Extra colon\n",[133,489,490],{"class":135,"line":143},[133,491,492],{"class":139},".foo {\n",[133,494,495],{"class":135,"line":153},[133,496,497],{"class":146},"-  color:: #fff;\n",[133,499,500],{"class":135,"line":169},[133,501,502],{"class":162},"+  color: #fff;\n",[133,504,505],{"class":135,"line":180},[133,506,189],{"class":139},[133,508,509],{"class":135,"line":186},[133,510,512],{"emptyLinePlaceholder":511},true,"\n",[133,514,515],{"class":135,"line":323},[133,516,517],{"class":139},"// :nth-last-child without specified number\n",[133,519,520],{"class":135,"line":329},[133,521,522],{"class":139},".bar {\n",[133,524,525],{"class":135,"line":335},[133,526,527],{"class":146},"-  &:nth-last-child() {\n",[133,529,530],{"class":135,"line":341},[133,531,532],{"class":162},"+  &:nth-last-child(1) {\n",[133,534,535],{"class":135,"line":347},[133,536,537],{"class":139},"      margin-bottom: 0;\n",[133,539,540],{"class":135,"line":353},[133,541,183],{"class":139},[133,543,544],{"class":135,"line":359},[133,545,189],{"class":139},[10,547,549],{"id":548},"pitfalls","Pitfalls",[90,551,553],{"id":552},"v-deep-styles-not-taking-effect","::v-deep Styles Not Taking Effect",[95,555,556],{},"After updating dependencies, everything seemed fine at first glance, so I pushed to the test environment. Less than a day later, a colleague called me - the ::v-deep deep selector wasn't working?",[95,558,559],{},"Trying my luck, GPT gave the following answer:",[200,561,562],{},[95,563,564,565,568,569,572,573,580,581,584,585,587],{},"In the ",[205,566,567],{},"Vue 2 + vue-loader + Sass"," combination, ",[205,570,571],{},"this syntax is correct",", ",[205,574,575,576,579],{},"provided that your build toolchain supports the ",[57,577,578],{},"::v-deep"," syntax"," (such as ",[57,582,583],{},"vue-loader@15"," and above + ",[57,586,229],{},").",[95,589,590],{},"Although I still haven't verified why updating to vue-loader@15 is required to use ::v-deep syntax, after updating vue-loader, the ::v-deep syntax did work. While writing this article, I found some clues that might explain this issue:",[592,593,594,609],"ol",{},[18,595,596,597,602,603,608],{},"The vue-loader ",[36,598,601],{"href":599,"rel":600},"https://vue-loader-v14.vuejs.org/en/features/scoped-css.html#deep-selectors",[40],"version 14 official documentation"," simply doesn't have examples of ::v-deep syntax. ",[36,604,607],{"href":605,"rel":606},"https://github.com/vuejs/vue-loader/commit/2585d254fc774386a898887467fbdd30eb864b53",[40],"This example was only added after vue-loader 15.7.0 was released",".",[18,610,611,612,619,622,623,628,629,608],{},"Someone mentioned in a vue-cli GitHub Issue comment:",[200,613,614],{},[95,615,616,618],{},[57,617,578],{}," implemented in @vue/component-compiler-utils v2.6.0, should work after you reinstall the deps.",[620,621],"br",{},"And vue-loader only ",[36,624,627],{"href":625,"rel":626},"https://github.com/vuejs/vue-loader/commit/e32cd0e4372fcc6f13b6c307402713807516d71c#diff-7ae45ad102eab3b6d7e7896acd08c427a9b25b346470d7bc6507b6481575d519",[40],"added @vue/component-compiler-utils to its dependencies in version 15.0.0-beta.1",", and didn't ",[36,630,633],{"href":631,"rel":632},"https://github.com/vuejs/vue-loader/commit/c359a38db0fbb4135fc97114baec3cd557d4123a",[40],"update its @vue/component-compiler-utils version to the required ^3.0.0 until vue-loader 15.7.1",[95,635,636,637,642],{},"Can we upgrade to vue-loader 16 or even 17? No. The ",[36,638,641],{"href":639,"rel":640},"https://github.com/vuejs/vue-loader/releases/tag/v16.1.2",[40],"vue-loader v16.1.2 changelog"," clearly states:",[200,644,645],{},[95,646,647],{},"Note: vue-loader v16 is for Vue 3 only.",[90,649,651],{"id":650},"vue-loader-14-15-breaking-changes","vue-loader 14 -> 15 Breaking Changes",[95,653,654,655,660],{},"When migrating vue-loader from 14 upward, running directly without modifying the webpack configuration will encounter Vue syntax recognition issues. Specifically, even though .vue file naming uses correct and valid syntax, the compiler just won't recognize it during build/development, reporting syntax errors. vue-loader officially has a ",[36,656,659],{"href":657,"rel":658},"https://vue-loader.vuejs.org/migrating.html",[40],"migration document"," that needs attention.",[124,662,667],{"className":663,"code":665,"language":666},[664],"language-text","ERROR in ./src/......\nModule parse failed: Unexpected token(1:0)\nYou may need an appropriate loader to handle this file type.\n","text",[57,668,665],{"__ignoreMap":129},[124,670,672],{"className":286,"code":671,"language":288,"meta":129,"style":129},"// ...\nimport path from 'path'\n+const VueLoaderPlugin = require('vue-loader/lib/plugin')\n\n// ...\n\n  plugins: [\n+    new VueLoaderPlugin()\n    // ...\n  ]\n",[57,673,674,679,684,689,693,697,701,706,711,716],{"__ignoreMap":129},[133,675,676],{"class":135,"line":136},[133,677,678],{"class":139},"// ...\n",[133,680,681],{"class":135,"line":143},[133,682,683],{"class":139},"import path from 'path'\n",[133,685,686],{"class":135,"line":153},[133,687,688],{"class":162},"+const VueLoaderPlugin = require('vue-loader/lib/plugin')\n",[133,690,691],{"class":135,"line":169},[133,692,512],{"emptyLinePlaceholder":511},[133,694,695],{"class":135,"line":180},[133,696,678],{"class":139},[133,698,699],{"class":135,"line":186},[133,700,512],{"emptyLinePlaceholder":511},[133,702,703],{"class":135,"line":323},[133,704,705],{"class":139},"  plugins: [\n",[133,707,708],{"class":135,"line":329},[133,709,710],{"class":162},"+    new VueLoaderPlugin()\n",[133,712,713],{"class":135,"line":335},[133,714,715],{"class":139},"    // ...\n",[133,717,718],{"class":135,"line":341},[133,719,720],{"class":139},"  ]\n",[95,722,723],{},"Additionally, in my project, I needed to remove the babel-loader for .vue files in the webpack configuration:",[124,725,727],{"className":286,"code":726,"language":288,"meta":129,"style":129},"{\n  test: /\\.vue$/,\n  use: [\n-    {\n-      loader: 'babel-loader'\n-    },\n    {\n      loader: 'vue-loader',\n    }\n  ]\n}\n",[57,728,729,733,738,743,748,753,758,763,768,773,777],{"__ignoreMap":129},[133,730,731],{"class":135,"line":136},[133,732,140],{"class":139},[133,734,735],{"class":135,"line":143},[133,736,737],{"class":139},"  test: /\\.vue$/,\n",[133,739,740],{"class":135,"line":153},[133,741,742],{"class":139},"  use: [\n",[133,744,745],{"class":135,"line":169},[133,746,747],{"class":146},"-    {\n",[133,749,750],{"class":135,"line":180},[133,751,752],{"class":146},"-      loader: 'babel-loader'\n",[133,754,755],{"class":135,"line":186},[133,756,757],{"class":146},"-    },\n",[133,759,760],{"class":135,"line":323},[133,761,762],{"class":139},"    {\n",[133,764,765],{"class":135,"line":329},[133,766,767],{"class":139},"      loader: 'vue-loader',\n",[133,769,770],{"class":135,"line":335},[133,771,772],{"class":139},"    }\n",[133,774,775],{"class":135,"line":341},[133,776,720],{"class":139},[133,778,779],{"class":135,"line":347},[133,780,189],{"class":139},[10,782,784],{"id":783},"final-update-status","Final Update Status",[15,786,787,795,802],{},[18,788,789,791,792],{},[57,790,59],{}," -> ",[57,793,794],{},"node@^14",[18,796,797,791,799],{},[57,798,74],{},[57,800,801],{},"vue-loader@^15",[18,803,804,791,806],{},[57,805,84],{},[57,807,808],{},"sass@^1.22.12",[95,810,811],{},"All other dependency versions remain unchanged",[10,813,815],{"id":814},"references","References",[15,817,818,825,832,838,844,851,858,864,870,876,882,888,894,901,908],{},[18,819,820],{},[36,821,824],{"href":822,"rel":823},"https://juejin.cn/post/7327094228350500914",[40],"Switching from node-sass to dart-sass - Juejin",[18,826,827],{},[36,828,831],{"href":829,"rel":830},"https://sunchenggit.github.io/2021/01/13/node-sass%E8%BF%81%E7%A7%BBdart-sass/",[40],"node-sass migration to dart-sass | Bolg",[18,833,834],{},[36,835,837],{"href":119,"rel":836},[40],"sass-loader | webpack Documentation",[18,839,840],{},[36,841,843],{"href":38,"rel":842},[40],"Sass: LibSass is Deprecated",[18,845,846],{},[36,847,850],{"href":848,"rel":849},"https://www.npmjs.com/package/sass?activeTab=versions",[40],"sass - npm",[18,852,853],{},[36,854,857],{"href":855,"rel":856},"https://www.npmjs.com/package/node-sass",[40],"node-sass - npm",[18,859,860],{},[36,861,863],{"href":236,"rel":862},[40],"About semantic versioning | npm Docs",[18,865,866],{},[36,867,869],{"href":426,"rel":868},[40],"Make /deep/ behave like the descendant combinator \" \" in CSS live profile - Chrome Platform Status",[18,871,872],{},[36,873,875],{"href":107,"rel":874},[40],"sass-loader/CHANGELOG.md at v8.0.0 · webpack-contrib/sass-loader",[18,877,878],{},[36,879,881],{"href":639,"rel":880},[40],"Release v16.1.2 · vuejs/vue-loader",[18,883,884],{},[36,885,887],{"href":625,"rel":886},[40],"refactor: use @vue/component-compiler-utils · vuejs/vue-loader@e32cd0e",[18,889,890],{},[36,891,893],{"href":631,"rel":892},[40],"chore: update @vue/component-compiler-utils to v3 · vuejs/vue-loader@c359a38",[18,895,896],{},[36,897,900],{"href":898,"rel":899},"https://github.com/vuejs/vue-cli/issues/3399#issuecomment-466319019",[40],"dart-sass does not support /deep/ selector · Issue #3399 · vuejs/vue-cli",[18,902,903],{},[36,904,907],{"href":905,"rel":906},"https://vue-loader-v14.vuejs.org/en/features/scoped-css.html",[40],"Scoped CSS · vue-loader v14",[18,909,910],{},[36,911,913],{"href":657,"rel":912},[40],"Migrating from v14 | Vue Loader",[915,916,917],"style",{},"html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html pre.shiki code .sJa8x, html code.shiki .sJa8x{--shiki-default:#E45649;--shiki-dark:#E06C75}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .sW2Sy, html code.shiki .sW2Sy{--shiki-default:#A0A1A7;--shiki-default-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}",{"title":129,"searchDepth":143,"depth":143,"links":919},[920,921,922,923,928,934,938,939],{"id":12,"depth":143,"text":13},{"id":29,"depth":143,"text":30},{"id":50,"depth":143,"text":51},{"id":87,"depth":143,"text":88,"children":924},[925,926,927],{"id":92,"depth":153,"text":93},{"id":100,"depth":153,"text":101},{"id":195,"depth":153,"text":195},{"id":245,"depth":143,"text":246,"children":929},[930,931,932,933],{"id":249,"depth":153,"text":250},{"id":282,"depth":153,"text":283},{"id":419,"depth":153,"text":420},{"id":473,"depth":153,"text":474},{"id":548,"depth":143,"text":549,"children":935},[936,937],{"id":552,"depth":153,"text":553},{"id":650,"depth":153,"text":651},{"id":783,"depth":143,"text":784},{"id":814,"depth":143,"text":815},"2025-07-05 17:57:02","md","en",{},"/2025/07/05/node-sass-migration-to-dart-sass","---\ntitle: \"Migration from node-sass to dart-sass: A Troubleshooting Chronicle\"\ndate: 2025-07-05 17:57:02\nsticky:\ntags:\n- Web\n- Vue.js\n- Sass\n- CSS\n- JavaScript\n---\n\n## Update Goals\n\n- node-sass -> sass (dart-sass)\n- Minimize impact, avoid updating other dependency versions unless necessary\n- Based on the above two conditions, see if we can upgrade the node.js version\n\n## Reasons to Abandon node-sass\n\n- [node-sass has been deprecated, dart-sass is the officially recommended successor by Sass](https://sass-lang.com/blog/libsass-is-deprecated/)\n- node-sass installation on Windows is very troublesome, requiring both Python 2 and Microsoft Visual C++ on the development machine during npm installation\n- When installing node-sass, resources need to be pulled from GitHub, which has a low success rate in certain network environments\n\n## Current Project Dependency Versions\n\n- `node@^12`\n- `vue@^2`\n- `webpack@^3`\n- `vue-loader@^14`\n- `sass-loader@^7.0.3`\n- `node-sass@^4`\n\n## Update Strategy\n\n### node.js\n\nWebpack officially doesn't provide the maximum node version supported by webpack 3, and even if webpack officially supports it, related webpack plugins may not. Therefore, whether the node version can be updated can only be determined through testing. Fortunately, although this project's CI/CD runs on node 12, I've been using node 14 for daily development, so I'll take this opportunity to upgrade the node version to 14.\n\n### webpack, sass-loader\n\nThe webpack version is currently in a \"ticking time bomb\" state of not updating unless necessary. Based on the current webpack 3 limitation, the maximum supported sass-loader version is ^7 (sass-loader's [8.0.0 version changelog](https://github.com/webpack-contrib/sass-loader/blob/v8.0.0/CHANGELOG.md) explicitly states that version 8.0.0 requires webpack 4.36.0).\n\nIf sass-loader@^7 in the project supports using dart-sass, then there's no need to update sass-loader, and consequently no need to update webpack; otherwise, webpack would need to be updated to 4, and then determine the sass-loader version accordingly.\n\nSo does it support it or not? I found this package.json snippet on the [webpack official documentation page introducing sass-loader](https://www.webpackjs.com/loaders/sass-loader/):\n\n```json\n{\n  \"devDependencies\": {\n    \"sass-loader\": \"^7.2.0\",\n    \"sass\": \"^1.22.10\"\n  }\n}\n```\n\nThis proves that at least sass-loader@7.2.0 already supported dart-sass, so the webpack version can stay at ^3, and sass-loader can temporarily stay at version 7.0.3. If there are issues later, it can be updated to the latest version 7.3.1 in the ^7 range.\n\n### dart-sass\n\nI couldn't find the maximum sass version supported by sass-loader@^7. GitHub Copilot confidently told me:\n\n> **Official documentation quote:**\n>\n> > sass-loader@^7.0.0 requires node-sass >=4.0.0 or sass >=1.3.0, \u003C=1.26.5.\n>\n> **Suggestion:**\n>\n> - If you need to use a higher version of `sass`, please upgrade to `sass-loader` 8 or higher.\n\nHowever, I couldn't find any trace of this text on the internet. Moreover, the last version in sass's ~1.26 range is 1.26.11, not 1.26.5. [According to common npm versioning principles](https://docs.npmjs.com/about-semantic-versioning), releases that only change the patch version while keeping the major and minor versions the same generally only contain bugfixes without breaking changes. It's unlikely that updating from 1.26.5 to 1.26.11 would suddenly become incompatible with sass-loader 7, so this is more likely an AI hallucination or limited training data.\n\nOut of caution, I ultimately decided to use the last version of sass 1.22 mentioned in the webpack official documentation, which is 1.22.12.\n\n## Analysis Complete, Let's Update\n\n### Step 1: Uninstall node-sass, Install sass@^1.22.12\n\n```bash\nnpm uninstall node-sass\nnpm install sass@^1.22.12\n```\n\n### Step 2: Update webpack Configuration (Optional)\n\n```diff\nmodule.exports = {\n  // ...\n  module: {\n    rules: [\n      {\n        test: /\\.(scss|sass)$/,\n        use: [\n          'style-loader',\n          'css-loader',\n          {\n            loader: 'sass-loader',\n+            options: {\n+                // In fact, this line doesn't need to be added in most sass-loader versions, sass-loader can automatically detect whether it's sass or node-sass\n+                implementation: require('sass')\n+              },\n            },\n          },\n        ],\n      },\n    ],\n  },\n};\n```\n\n### Step 3: Batch Replace /deep/ Syntax with ::v-deep\n\nBecause [the /deep/ syntax was deprecated in 2017](https://chromestatus.com/feature/4964279606312960), /deep/ became an unsupported deep selector. node-sass, with its excellent error tolerance, could continue to provide compatibility, but dart-sass doesn't support this syntax. So we need to batch replace the /deep/ syntax with ::v-deep, which, although abandoned in Vue's subsequent RFC, is still effectively supported to this day.\n\n```bash\n# Something like this, using VSCode's batch replace also works\nsed -i 's#\\s*/deep/\\s*# ::v-deep #g' $(grep -rl '/deep/' .)\n```\n\n### Step 4: Fix Other Sass Syntax Errors\n\nDuring the migration, I found some non-standard syntax in the project. node-sass, with its excellent robustness, silently forced parsing, while dart-sass can't handle this rough work. Therefore, these syntax errors need to be manually fixed based on compilation errors. I encountered two types:\n\n```diff\n// Extra colon\n.foo {\n-  color:: #fff;\n+  color: #fff;\n}\n\n// :nth-last-child without specified number\n.bar {\n-  &:nth-last-child() {\n+  &:nth-last-child(1) {\n      margin-bottom: 0;\n  }\n}\n```\n\n## Pitfalls\n\n### ::v-deep Styles Not Taking Effect\n\nAfter updating dependencies, everything seemed fine at first glance, so I pushed to the test environment. Less than a day later, a colleague called me - the ::v-deep deep selector wasn't working?\n\nTrying my luck, GPT gave the following answer:\n\n> In the **Vue 2 + vue-loader + Sass** combination, **this syntax is correct**, **provided that your build toolchain supports the `::v-deep` syntax** (such as `vue-loader@15` and above + `sass-loader`).\n\nAlthough I still haven't verified why updating to vue-loader@15 is required to use ::v-deep syntax, after updating vue-loader, the ::v-deep syntax did work. While writing this article, I found some clues that might explain this issue:\n\n1. The vue-loader [version 14 official documentation](https://vue-loader-v14.vuejs.org/en/features/scoped-css.html#deep-selectors) simply doesn't have examples of ::v-deep syntax. [This example was only added after vue-loader 15.7.0 was released](https://github.com/vuejs/vue-loader/commit/2585d254fc774386a898887467fbdd30eb864b53).\n\n2. Someone mentioned in a vue-cli GitHub Issue comment:\n\n   > `::v-deep` implemented in @vue/component-compiler-utils v2.6.0, should work after you reinstall the deps.\n\n   And vue-loader only [added @vue/component-compiler-utils to its dependencies in version 15.0.0-beta.1](https://github.com/vuejs/vue-loader/commit/e32cd0e4372fcc6f13b6c307402713807516d71c#diff-7ae45ad102eab3b6d7e7896acd08c427a9b25b346470d7bc6507b6481575d519), and didn't [update its @vue/component-compiler-utils version to the required ^3.0.0 until vue-loader 15.7.1](https://github.com/vuejs/vue-loader/commit/c359a38db0fbb4135fc97114baec3cd557d4123a).\n\nCan we upgrade to vue-loader 16 or even 17? No. The [vue-loader v16.1.2 changelog](https://github.com/vuejs/vue-loader/releases/tag/v16.1.2) clearly states:\n\n> Note: vue-loader v16 is for Vue 3 only.\n\n### vue-loader 14 -> 15 Breaking Changes\n\nWhen migrating vue-loader from 14 upward, running directly without modifying the webpack configuration will encounter Vue syntax recognition issues. Specifically, even though .vue file naming uses correct and valid syntax, the compiler just won't recognize it during build/development, reporting syntax errors. vue-loader officially has a [migration document](https://vue-loader.vuejs.org/migrating.html) that needs attention.\n\n```\nERROR in ./src/......\nModule parse failed: Unexpected token(1:0)\nYou may need an appropriate loader to handle this file type.\n```\n\n```diff\n// ...\nimport path from 'path'\n+const VueLoaderPlugin = require('vue-loader/lib/plugin')\n\n// ...\n\n  plugins: [\n+    new VueLoaderPlugin()\n    // ...\n  ]\n```\n\nAdditionally, in my project, I needed to remove the babel-loader for .vue files in the webpack configuration:\n\n```diff\n{\n  test: /\\.vue$/,\n  use: [\n-    {\n-      loader: 'babel-loader'\n-    },\n    {\n      loader: 'vue-loader',\n    }\n  ]\n}\n```\n\n## Final Update Status\n\n- `node@^12` -> `node@^14`\n- `vue-loader@^14` -> `vue-loader@^15`\n- `node-sass@^4` -> `sass@^1.22.12`\n\nAll other dependency versions remain unchanged\n\n## References\n\n- [Switching from node-sass to dart-sass - Juejin](https://juejin.cn/post/7327094228350500914)\n- [node-sass migration to dart-sass | Bolg](https://sunchenggit.github.io/2021/01/13/node-sass%E8%BF%81%E7%A7%BBdart-sass/)\n- [sass-loader | webpack Documentation](https://www.webpackjs.com/loaders/sass-loader/)\n- [Sass: LibSass is Deprecated](https://sass-lang.com/blog/libsass-is-deprecated/)\n- [sass - npm](https://www.npmjs.com/package/sass?activeTab=versions)\n- [node-sass - npm](https://www.npmjs.com/package/node-sass)\n- [About semantic versioning | npm Docs](https://docs.npmjs.com/about-semantic-versioning)\n- [Make /deep/ behave like the descendant combinator \" \" in CSS live profile - Chrome Platform Status](https://chromestatus.com/feature/4964279606312960)\n- [sass-loader/CHANGELOG.md at v8.0.0 · webpack-contrib/sass-loader](https://github.com/webpack-contrib/sass-loader/blob/v8.0.0/CHANGELOG.md)\n- [Release v16.1.2 · vuejs/vue-loader](https://github.com/vuejs/vue-loader/releases/tag/v16.1.2)\n- [refactor: use @vue/component-compiler-utils · vuejs/vue-loader@e32cd0e](https://github.com/vuejs/vue-loader/commit/e32cd0e4372fcc6f13b6c307402713807516d71c#diff-7ae45ad102eab3b6d7e7896acd08c427a9b25b346470d7bc6507b6481575d519)\n- [chore: update @vue/component-compiler-utils to v3 · vuejs/vue-loader@c359a38](https://github.com/vuejs/vue-loader/commit/c359a38db0fbb4135fc97114baec3cd557d4123a)\n- [dart-sass does not support /deep/ selector · Issue #3399 · vuejs/vue-cli](https://github.com/vuejs/vue-cli/issues/3399#issuecomment-466319019)\n- [Scoped CSS · vue-loader v14](https://vue-loader-v14.vuejs.org/en/features/scoped-css.html)\n- [Migrating from v14 | Vue Loader](https://vue-loader.vuejs.org/migrating.html)\n",{"title":5,"description":129},"posts/en/node-sass-migration-to-dart-sass",false,[950,951,952,953,954],"Web","Vue.js","Sass","CSS","JavaScript","ZEe7rrwEwdbsUWEcgo1bP2hCy5FU3JQKZGyIIbJMnEs",[957,962],{"title":958,"path":959,"stem":960,"date":961,"lang":942,"children":-1},"Vue Markdown Rendering Optimization in Practice (Part 1): From Brute Force Refresh, Chunked Updates to Morphdom's Elegant Transformation","/2025/07/12/vue-markdown-render-improvement-1","posts/en/vue-markdown-render-improvement-1","2025-07-12 20:48:56",{"title":963,"path":964,"stem":965,"date":966,"lang":942,"children":-1},"Quantum Mechanics in Frontend Development — The Bug That Vanishes as Soon as You Open F12","/2025/06/08/front-end-bug-gone-when-open-devtool","posts/en/front-end-bug-gone-when-open-devtool","2025-06-08 01:22:13","/2025/07/05/node-sass-migration-to-dart-sass/",1763668762044]
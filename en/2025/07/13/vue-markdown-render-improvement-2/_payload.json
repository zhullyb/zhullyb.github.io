[{"data":1,"prerenderedAt":2037},["ShallowReactive",2],{"post-2025-07-13-vue-markdown-render-improvement-2-en":3,"surround-2025-07-13-vue-markdown-render-improvement-2-en":2025,"randomIndex/2025/07/13/vue-markdown-render-improvement-2/":286,"language-switch-/en/2025/07/13/vue-markdown-render-improvement-2/-zh":2036},{"id":4,"title":5,"body":6,"date":2009,"description":216,"extension":2010,"lang":2011,"meta":2012,"navigation":289,"path":2013,"rawbody":2014,"seo":2015,"stem":2016,"sticky":2017,"tags":2018,"__hash__":2024},"posts/posts/en/vue-markdown-render-improvement-2.md","Vue Markdown Rendering Optimization in Practice (Part 2): Farewell to DOM Manipulation, Embrace AST and Functional Rendering",{"type":7,"value":8,"toc":1996},"minimark",[9,19,36,39,42,45,57,67,71,80,98,109,112,127,132,153,156,160,171,203,207,210,238,241,437,440,697,701,708,720,723,1366,1370,1377,1721,1724,1842,1846,1849,1955,1959,1962,1986,1989,1992],[10,11,13,14,18],"h2",{"id":12},"recap-when-morphdom-meets-vue","Recap: When ",[15,16,17],"code",{},"morphdom"," Meets Vue",[20,21,22,23,28,29,32,33,35],"p",{},"In ",[24,25,27],"a",{"href":26},"/2025/07/12/vue-markdown-render-improvement-1/","the previous article",", we embarked on a performance optimization journey for Markdown rendering. From the most primitive full refresh with ",[15,30,31],{},"v-html",", to block-by-block updates, we eventually brought out the \"ultimate weapon\" - ",[15,34,17],{},". By directly comparing and manipulating the real DOM, it updates the view with minimal cost, perfectly solving the performance bottleneck and interaction state loss issues in real-time rendering.",[20,37,38],{},"However, a fundamental problem has always existed: in Vue's territory, bypassing Vue's Virtual DOM and Diff algorithm to let a third-party library directly \"operate\" on the real DOM always feels somewhat \"unorthodox.\" It's like introducing an old master with a hammer and wrench for manual repairs in a precision automated factory. Although the job is done well, it always feels like it disrupts the original workflow and isn't \"Vue\" enough.",[20,40,41],{},"So, is there a more elegant, more \"native\" approach that allows us to enjoy precise updates while fully integrating with Vue's ecosystem?",[20,43,44],{},"With this question in mind, I consulted friends in frontend development groups.",[46,47,48],"blockquote",{},[20,49,50,51],{},"If you're building a renderer, your approach isn't the best practice. Each time you update, you generate the full virtual HTML, then optimize performance by subtracting from the HTML. However, the incremental part of each update is clear - why not directly use this incremental part for addition? The incremental part cannot be directly obtained through markdown-it, but a better approach is to transform at this step: first parse the Markdown structure, then use Vue's dynamic rendering capabilities to generate the DOM. This way, DOM reuse can leverage Vue's own abilities. — ",[24,52,56],{"href":53,"rel":54},"https://site.j10c.cc/",[55],"nofollow","j10c",[46,58,59],{},[20,60,61,62],{},"You can use unified with the remark-parse plugin to parse markdown strings into AST, then render based on the AST using render functions. — bii & ",[24,63,66],{"href":64,"rel":65},"https://github.com/nekomeowww",[55],"nekomeowww",[10,68,70],{"id":69},"new-approach-from-string-conversion-to-structured-rendering","New Approach: From \"String Conversion\" to \"Structured Rendering\"",[20,72,73,74,76,77,79],{},"Our previous solutions, whether ",[15,75,31],{}," or ",[15,78,17],{},", shared a core approach:",[20,81,82,85,86,85,89,85,92,85,95],{},[15,83,84],{},"Markdown String"," -> ",[15,87,88],{},"markdown-it",[15,90,91],{},"HTML String",[15,93,94],{},"Browser/morphdom",[15,96,97],{},"DOM",[20,99,100,101,103,104,108],{},"The problem with this pipeline is that starting from the ",[15,102,91],{}," step, we lose the ",[105,106,107],"strong",{},"original structural information"," of Markdown. We get a bunch of unstructured text that Vue cannot understand its internal logic and can only swallow it whole.",[20,110,111],{},"The new approach transforms the process into:",[20,113,114,85,116,85,119,85,122,85,125],{},[15,115,84],{},[15,117,118],{},"AST (Abstract Syntax Tree)",[15,120,121],{},"Vue VNodes (Virtual Nodes)",[15,123,124],{},"Vue",[15,126,97],{},[128,129,131],"h3",{"id":130},"what-is-ast","What is AST?",[20,133,134,136,137,140,141,144,145,148,149,152],{},[105,135,118],{}," is a structured representation of source code or markup language. It parses a long string of text into a hierarchical tree-like object. For Markdown, a level-1 heading becomes a node with ",[15,138,139],{},"type: 'heading', depth: 1",", a paragraph becomes a node with ",[15,142,143],{},"type: 'paragraph'",", and the text within the paragraph becomes the ",[15,146,147],{},"children"," of the ",[15,150,151],{},"paragraph"," node.",[20,154,155],{},"Once we convert Markdown into an AST, we essentially have a \"structural blueprint\" of the entire document. We're no longer facing a pile of ambiguous HTML strings, but rather a clear, programmable JavaScript object.",[128,157,159],{"id":158},"our-new-tools-unified-and-remark","Our New Tools: unified and remark",[20,161,162,163,166,167,170],{},"To implement the ",[15,164,165],{},"Markdown -> AST"," conversion, we introduce the ",[15,168,169],{},"unified"," ecosystem.",[172,173,174,184],"ul",{},[175,176,177,183],"li",{},[105,178,179],{},[24,180,169],{"href":181,"rel":182},"https://github.com/unifiedjs/unified",[55],": A powerful content processing engine. Think of it as an assembly line where raw text is the raw material, and you process it through parsing, transformation, and serialization by adding different \"plugins.\"",[175,185,186,193,194,196,197,202],{},[105,187,188],{},[24,189,192],{"href":190,"rel":191},"https://github.com/remarkjs/remark",[55],"remark-parse",": A ",[15,195,169],{}," plugin specifically responsible for parsing Markdown text into AST (specifically in ",[24,198,201],{"href":199,"rel":200},"https://github.com/syntax-tree/mdast",[55],"mdast"," format).",[10,204,206],{"id":205},"step-1-parse-markdown-into-ast","Step 1: Parse Markdown into AST",[20,208,209],{},"First, we need to install the dependencies:",[211,212,217],"pre",{"className":213,"code":214,"language":215,"meta":216,"style":216},"language-bash shiki shiki-themes one-light one-dark-pro","npm install unified remark-parse\n","bash","",[15,218,219],{"__ignoreMap":216},[220,221,224,228,232,235],"span",{"class":222,"line":223},"line",1,[220,225,227],{"class":226},"sAdtL","npm",[220,229,231],{"class":230},"sDhpE"," install",[220,233,234],{"class":230}," unified",[220,236,237],{"class":230}," remark-parse\n",[20,239,240],{},"Then, we can easily convert a Markdown string into an AST:",[211,242,246],{"className":243,"code":244,"language":245,"meta":216,"style":216},"language-javascript shiki shiki-themes one-light one-dark-pro","import { unified } from 'unified'\nimport remarkParse from 'remark-parse'\n\nconst markdownContent = '# Hello, AST!\\n\\nThis is a paragraph.'\n\n// Create a processor instance\nconst processor = unified().use(remarkParse)\n\n// Parse Markdown content\nconst ast = processor.parse(markdownContent)\n\nconsole.log(JSON.stringify(ast, null, 2))\n","javascript",[15,247,248,270,284,291,314,319,326,354,359,365,391,396],{"__ignoreMap":216},[220,249,250,254,258,261,264,267],{"class":222,"line":223},[220,251,253],{"class":252},"sLKXg","import",[220,255,257],{"class":256},"s5ixo"," { ",[220,259,169],{"class":260},"sJa8x",[220,262,263],{"class":256}," } ",[220,265,266],{"class":252},"from",[220,268,269],{"class":230}," 'unified'\n",[220,271,273,275,278,281],{"class":222,"line":272},2,[220,274,253],{"class":252},[220,276,277],{"class":260}," remarkParse",[220,279,280],{"class":252}," from",[220,282,283],{"class":230}," 'remark-parse'\n",[220,285,287],{"class":222,"line":286},3,[220,288,290],{"emptyLinePlaceholder":289},true,"\n",[220,292,294,297,301,305,308,311],{"class":222,"line":293},4,[220,295,296],{"class":252},"const",[220,298,300],{"class":299},"sNmU0"," markdownContent",[220,302,304],{"class":303},"s_Sar"," =",[220,306,307],{"class":230}," '# Hello, AST!",[220,309,310],{"class":303},"\\n\\n",[220,312,313],{"class":230},"This is a paragraph.'\n",[220,315,317],{"class":222,"line":316},5,[220,318,290],{"emptyLinePlaceholder":289},[220,320,322],{"class":222,"line":321},6,[220,323,325],{"class":324},"sW2Sy","// Create a processor instance\n",[220,327,329,331,334,336,338,341,344,347,351],{"class":222,"line":328},7,[220,330,296],{"class":252},[220,332,333],{"class":299}," processor",[220,335,304],{"class":303},[220,337,234],{"class":226},[220,339,340],{"class":256},"().",[220,342,343],{"class":226},"use",[220,345,346],{"class":256},"(",[220,348,350],{"class":349},"sz0mV","remarkParse",[220,352,353],{"class":256},")\n",[220,355,357],{"class":222,"line":356},8,[220,358,290],{"emptyLinePlaceholder":289},[220,360,362],{"class":222,"line":361},9,[220,363,364],{"class":324},"// Parse Markdown content\n",[220,366,368,370,373,375,378,381,384,386,389],{"class":222,"line":367},10,[220,369,296],{"class":252},[220,371,372],{"class":299}," ast",[220,374,304],{"class":303},[220,376,333],{"class":377},"s7GmK",[220,379,380],{"class":256},".",[220,382,383],{"class":226},"parse",[220,385,346],{"class":256},[220,387,388],{"class":349},"markdownContent",[220,390,353],{"class":256},[220,392,394],{"class":222,"line":393},11,[220,395,290],{"emptyLinePlaceholder":289},[220,397,399,402,404,407,409,412,414,417,419,422,425,429,431,434],{"class":222,"line":398},12,[220,400,401],{"class":377},"console",[220,403,380],{"class":256},[220,405,406],{"class":226},"log",[220,408,346],{"class":256},[220,410,411],{"class":299},"JSON",[220,413,380],{"class":256},[220,415,416],{"class":226},"stringify",[220,418,346],{"class":256},[220,420,421],{"class":349},"ast",[220,423,424],{"class":256},", ",[220,426,428],{"class":427},"sAGMh","null",[220,430,424],{"class":256},[220,432,433],{"class":427},"2",[220,435,436],{"class":256},"))\n",[20,438,439],{},"Running the above code will give us a JSON object like the following, which is our coveted AST:",[211,441,445],{"className":442,"code":443,"language":444,"meta":216,"style":216},"language-json shiki shiki-themes one-light one-dark-pro","{\n  \"type\": \"root\",\n  \"children\": [\n    {\n      \"type\": \"heading\",\n      \"depth\": 1,\n      \"children\": [\n        {\n          \"type\": \"text\",\n          \"value\": \"Hello, AST!\",\n          \"position\": { ... }\n        }\n      ],\n      \"position\": { ... }\n    },\n    {\n      \"type\": \"paragraph\",\n      \"children\": [\n        {\n          \"type\": \"text\",\n          \"value\": \"This is a paragraph.\",\n          \"position\": { ... }\n        }\n      ],\n      \"position\": { ... }\n    }\n  ],\n  \"position\": { ... }\n}\n","json",[15,446,447,452,466,474,479,491,503,510,515,527,539,554,559,565,577,583,588,600,607,612,623,635,646,651,656,667,673,679,691],{"__ignoreMap":216},[220,448,449],{"class":222,"line":223},[220,450,451],{"class":256},"{\n",[220,453,454,457,460,463],{"class":222,"line":272},[220,455,456],{"class":260},"  \"type\"",[220,458,459],{"class":256},": ",[220,461,462],{"class":230},"\"root\"",[220,464,465],{"class":256},",\n",[220,467,468,471],{"class":222,"line":286},[220,469,470],{"class":260},"  \"children\"",[220,472,473],{"class":256},": [\n",[220,475,476],{"class":222,"line":293},[220,477,478],{"class":256},"    {\n",[220,480,481,484,486,489],{"class":222,"line":316},[220,482,483],{"class":260},"      \"type\"",[220,485,459],{"class":256},[220,487,488],{"class":230},"\"heading\"",[220,490,465],{"class":256},[220,492,493,496,498,501],{"class":222,"line":321},[220,494,495],{"class":260},"      \"depth\"",[220,497,459],{"class":256},[220,499,500],{"class":427},"1",[220,502,465],{"class":256},[220,504,505,508],{"class":222,"line":328},[220,506,507],{"class":260},"      \"children\"",[220,509,473],{"class":256},[220,511,512],{"class":222,"line":356},[220,513,514],{"class":256},"        {\n",[220,516,517,520,522,525],{"class":222,"line":361},[220,518,519],{"class":260},"          \"type\"",[220,521,459],{"class":256},[220,523,524],{"class":230},"\"text\"",[220,526,465],{"class":256},[220,528,529,532,534,537],{"class":222,"line":367},[220,530,531],{"class":260},"          \"value\"",[220,533,459],{"class":256},[220,535,536],{"class":230},"\"Hello, AST!\"",[220,538,465],{"class":256},[220,540,541,544,547,551],{"class":222,"line":393},[220,542,543],{"class":260},"          \"position\"",[220,545,546],{"class":256},": { ",[220,548,550],{"class":549},"sUNH4","...",[220,552,553],{"class":256}," }\n",[220,555,556],{"class":222,"line":398},[220,557,558],{"class":256},"        }\n",[220,560,562],{"class":222,"line":561},13,[220,563,564],{"class":256},"      ],\n",[220,566,568,571,573,575],{"class":222,"line":567},14,[220,569,570],{"class":260},"      \"position\"",[220,572,546],{"class":256},[220,574,550],{"class":549},[220,576,553],{"class":256},[220,578,580],{"class":222,"line":579},15,[220,581,582],{"class":256},"    },\n",[220,584,586],{"class":222,"line":585},16,[220,587,478],{"class":256},[220,589,591,593,595,598],{"class":222,"line":590},17,[220,592,483],{"class":260},[220,594,459],{"class":256},[220,596,597],{"class":230},"\"paragraph\"",[220,599,465],{"class":256},[220,601,603,605],{"class":222,"line":602},18,[220,604,507],{"class":260},[220,606,473],{"class":256},[220,608,610],{"class":222,"line":609},19,[220,611,514],{"class":256},[220,613,615,617,619,621],{"class":222,"line":614},20,[220,616,519],{"class":260},[220,618,459],{"class":256},[220,620,524],{"class":230},[220,622,465],{"class":256},[220,624,626,628,630,633],{"class":222,"line":625},21,[220,627,531],{"class":260},[220,629,459],{"class":256},[220,631,632],{"class":230},"\"This is a paragraph.\"",[220,634,465],{"class":256},[220,636,638,640,642,644],{"class":222,"line":637},22,[220,639,543],{"class":260},[220,641,546],{"class":256},[220,643,550],{"class":549},[220,645,553],{"class":256},[220,647,649],{"class":222,"line":648},23,[220,650,558],{"class":256},[220,652,654],{"class":222,"line":653},24,[220,655,564],{"class":256},[220,657,659,661,663,665],{"class":222,"line":658},25,[220,660,570],{"class":260},[220,662,546],{"class":256},[220,664,550],{"class":549},[220,666,553],{"class":256},[220,668,670],{"class":222,"line":669},26,[220,671,672],{"class":256},"    }\n",[220,674,676],{"class":222,"line":675},27,[220,677,678],{"class":256},"  ],\n",[220,680,682,685,687,689],{"class":222,"line":681},28,[220,683,684],{"class":260},"  \"position\"",[220,686,546],{"class":256},[220,688,550],{"class":549},[220,690,553],{"class":256},[220,692,694],{"class":222,"line":693},29,[220,695,696],{"class":256},"}\n",[10,698,700],{"id":699},"step-2-from-ast-to-vue-vnodes","Step 2: From AST to Vue VNodes",[20,702,703,704,707],{},"Having obtained the AST, the next step is to actually \"construct\" this \"structural blueprint\" into a user-visible interface. In Vue's world, the blueprint for describing UI is the Virtual Node (VNode), and the ",[15,705,706],{},"h()"," function (i.e., hyperscript) is the brush for creating VNodes.",[20,709,710,711,424,714,424,716,719],{},"Our task is to write a render function that can recursively traverse the AST and generate corresponding VNodes for each node type (",[15,712,713],{},"heading",[15,715,151],{},[15,717,718],{},"text",", etc.).",[20,721,722],{},"Here's a simple render function implementation:",[211,724,726],{"className":243,"code":725,"language":245,"meta":216,"style":216},"function renderAst(node) {\n  if (!node) return null\n  switch (node.type) {\n    case 'root':\n      return h('div', {}, node.children.map(renderAst))\n    case 'paragraph':\n      return h('p', {}, node.children.map(renderAst))\n    case 'text':\n      return node.value\n    case 'emphasis':\n      return h('em', {}, node.children.map(renderAst))\n    case 'strong':\n      return h('strong', {}, node.children.map(renderAst))\n    case 'inlineCode':\n      return h('code', {}, node.value)\n    case 'heading':\n      return h('h' + node.depth, {}, node.children.map(renderAst))\n    case 'code':\n      return h('pre', {}, [h('code', {}, node.value)])\n    case 'list':\n      return h(node.ordered ? 'ol' : 'ul', {}, node.children.map(renderAst))\n    case 'listItem':\n      return h('li', {}, node.children.map(renderAst))\n    case 'thematicBreak':\n      return h('hr')\n    case 'blockquote':\n      return h('blockquote', {}, node.children.map(renderAst))\n    case 'link':\n      return h('a', { href: node.url, target: '_blank' }, node.children.map(renderAst))\n    default:\n      // Other unimplemented types\n      return h('span', { }, `[${node.type}]`)\n  }\n}\n",[15,727,728,745,767,783,794,829,838,867,876,888,897,926,935,964,973,995,1004,1043,1052,1085,1094,1140,1149,1178,1187,1200,1209,1238,1247,1304,1312,1318,1355,1361],{"__ignoreMap":216},[220,729,730,733,736,738,742],{"class":222,"line":223},[220,731,732],{"class":252},"function",[220,734,735],{"class":226}," renderAst",[220,737,346],{"class":256},[220,739,741],{"class":740},"s8iYz","node",[220,743,744],{"class":256},") {\n",[220,746,747,750,753,756,758,761,764],{"class":222,"line":272},[220,748,749],{"class":252},"  if",[220,751,752],{"class":256}," (",[220,754,755],{"class":303},"!",[220,757,741],{"class":349},[220,759,760],{"class":256},") ",[220,762,763],{"class":252},"return",[220,765,766],{"class":427}," null\n",[220,768,769,772,774,776,778,781],{"class":222,"line":286},[220,770,771],{"class":252},"  switch",[220,773,752],{"class":256},[220,775,741],{"class":377},[220,777,380],{"class":256},[220,779,780],{"class":260},"type",[220,782,744],{"class":256},[220,784,785,788,791],{"class":222,"line":293},[220,786,787],{"class":252},"    case",[220,789,790],{"class":230}," 'root'",[220,792,793],{"class":256},":\n",[220,795,796,799,802,804,807,810,812,814,817,819,822,824,827],{"class":222,"line":316},[220,797,798],{"class":252},"      return",[220,800,801],{"class":226}," h",[220,803,346],{"class":256},[220,805,806],{"class":230},"'div'",[220,808,809],{"class":256},", {}, ",[220,811,741],{"class":377},[220,813,380],{"class":256},[220,815,147],{"class":816},"s2QsP",[220,818,380],{"class":256},[220,820,821],{"class":226},"map",[220,823,346],{"class":256},[220,825,826],{"class":349},"renderAst",[220,828,436],{"class":256},[220,830,831,833,836],{"class":222,"line":321},[220,832,787],{"class":252},[220,834,835],{"class":230}," 'paragraph'",[220,837,793],{"class":256},[220,839,840,842,844,846,849,851,853,855,857,859,861,863,865],{"class":222,"line":328},[220,841,798],{"class":252},[220,843,801],{"class":226},[220,845,346],{"class":256},[220,847,848],{"class":230},"'p'",[220,850,809],{"class":256},[220,852,741],{"class":377},[220,854,380],{"class":256},[220,856,147],{"class":816},[220,858,380],{"class":256},[220,860,821],{"class":226},[220,862,346],{"class":256},[220,864,826],{"class":349},[220,866,436],{"class":256},[220,868,869,871,874],{"class":222,"line":356},[220,870,787],{"class":252},[220,872,873],{"class":230}," 'text'",[220,875,793],{"class":256},[220,877,878,880,883,885],{"class":222,"line":361},[220,879,798],{"class":252},[220,881,882],{"class":377}," node",[220,884,380],{"class":256},[220,886,887],{"class":260},"value\n",[220,889,890,892,895],{"class":222,"line":367},[220,891,787],{"class":252},[220,893,894],{"class":230}," 'emphasis'",[220,896,793],{"class":256},[220,898,899,901,903,905,908,910,912,914,916,918,920,922,924],{"class":222,"line":393},[220,900,798],{"class":252},[220,902,801],{"class":226},[220,904,346],{"class":256},[220,906,907],{"class":230},"'em'",[220,909,809],{"class":256},[220,911,741],{"class":377},[220,913,380],{"class":256},[220,915,147],{"class":816},[220,917,380],{"class":256},[220,919,821],{"class":226},[220,921,346],{"class":256},[220,923,826],{"class":349},[220,925,436],{"class":256},[220,927,928,930,933],{"class":222,"line":398},[220,929,787],{"class":252},[220,931,932],{"class":230}," 'strong'",[220,934,793],{"class":256},[220,936,937,939,941,943,946,948,950,952,954,956,958,960,962],{"class":222,"line":561},[220,938,798],{"class":252},[220,940,801],{"class":226},[220,942,346],{"class":256},[220,944,945],{"class":230},"'strong'",[220,947,809],{"class":256},[220,949,741],{"class":377},[220,951,380],{"class":256},[220,953,147],{"class":816},[220,955,380],{"class":256},[220,957,821],{"class":226},[220,959,346],{"class":256},[220,961,826],{"class":349},[220,963,436],{"class":256},[220,965,966,968,971],{"class":222,"line":567},[220,967,787],{"class":252},[220,969,970],{"class":230}," 'inlineCode'",[220,972,793],{"class":256},[220,974,975,977,979,981,984,986,988,990,993],{"class":222,"line":579},[220,976,798],{"class":252},[220,978,801],{"class":226},[220,980,346],{"class":256},[220,982,983],{"class":230},"'code'",[220,985,809],{"class":256},[220,987,741],{"class":377},[220,989,380],{"class":256},[220,991,992],{"class":260},"value",[220,994,353],{"class":256},[220,996,997,999,1002],{"class":222,"line":585},[220,998,787],{"class":252},[220,1000,1001],{"class":230}," 'heading'",[220,1003,793],{"class":256},[220,1005,1006,1008,1010,1012,1015,1018,1020,1022,1025,1027,1029,1031,1033,1035,1037,1039,1041],{"class":222,"line":590},[220,1007,798],{"class":252},[220,1009,801],{"class":226},[220,1011,346],{"class":256},[220,1013,1014],{"class":230},"'h'",[220,1016,1017],{"class":303}," +",[220,1019,882],{"class":377},[220,1021,380],{"class":256},[220,1023,1024],{"class":260},"depth",[220,1026,809],{"class":256},[220,1028,741],{"class":377},[220,1030,380],{"class":256},[220,1032,147],{"class":816},[220,1034,380],{"class":256},[220,1036,821],{"class":226},[220,1038,346],{"class":256},[220,1040,826],{"class":349},[220,1042,436],{"class":256},[220,1044,1045,1047,1050],{"class":222,"line":602},[220,1046,787],{"class":252},[220,1048,1049],{"class":230}," 'code'",[220,1051,793],{"class":256},[220,1053,1054,1056,1058,1060,1063,1066,1069,1071,1073,1075,1077,1079,1082],{"class":222,"line":609},[220,1055,798],{"class":252},[220,1057,801],{"class":226},[220,1059,346],{"class":256},[220,1061,1062],{"class":230},"'pre'",[220,1064,1065],{"class":256},", {}, [",[220,1067,1068],{"class":226},"h",[220,1070,346],{"class":256},[220,1072,983],{"class":230},[220,1074,809],{"class":256},[220,1076,741],{"class":377},[220,1078,380],{"class":256},[220,1080,992],{"class":1081},"sj4iG",[220,1083,1084],{"class":256},")])\n",[220,1086,1087,1089,1092],{"class":222,"line":614},[220,1088,787],{"class":252},[220,1090,1091],{"class":230}," 'list'",[220,1093,793],{"class":256},[220,1095,1096,1098,1100,1102,1104,1106,1109,1113,1116,1119,1122,1124,1126,1128,1130,1132,1134,1136,1138],{"class":222,"line":625},[220,1097,798],{"class":252},[220,1099,801],{"class":226},[220,1101,346],{"class":256},[220,1103,741],{"class":377},[220,1105,380],{"class":256},[220,1107,1108],{"class":260},"ordered",[220,1110,1112],{"class":1111},"s7DPa"," ?",[220,1114,1115],{"class":230}," 'ol'",[220,1117,1118],{"class":1111}," :",[220,1120,1121],{"class":230}," 'ul'",[220,1123,809],{"class":256},[220,1125,741],{"class":377},[220,1127,380],{"class":256},[220,1129,147],{"class":816},[220,1131,380],{"class":256},[220,1133,821],{"class":226},[220,1135,346],{"class":256},[220,1137,826],{"class":349},[220,1139,436],{"class":256},[220,1141,1142,1144,1147],{"class":222,"line":637},[220,1143,787],{"class":252},[220,1145,1146],{"class":230}," 'listItem'",[220,1148,793],{"class":256},[220,1150,1151,1153,1155,1157,1160,1162,1164,1166,1168,1170,1172,1174,1176],{"class":222,"line":648},[220,1152,798],{"class":252},[220,1154,801],{"class":226},[220,1156,346],{"class":256},[220,1158,1159],{"class":230},"'li'",[220,1161,809],{"class":256},[220,1163,741],{"class":377},[220,1165,380],{"class":256},[220,1167,147],{"class":816},[220,1169,380],{"class":256},[220,1171,821],{"class":226},[220,1173,346],{"class":256},[220,1175,826],{"class":349},[220,1177,436],{"class":256},[220,1179,1180,1182,1185],{"class":222,"line":653},[220,1181,787],{"class":252},[220,1183,1184],{"class":230}," 'thematicBreak'",[220,1186,793],{"class":256},[220,1188,1189,1191,1193,1195,1198],{"class":222,"line":658},[220,1190,798],{"class":252},[220,1192,801],{"class":226},[220,1194,346],{"class":256},[220,1196,1197],{"class":230},"'hr'",[220,1199,353],{"class":256},[220,1201,1202,1204,1207],{"class":222,"line":669},[220,1203,787],{"class":252},[220,1205,1206],{"class":230}," 'blockquote'",[220,1208,793],{"class":256},[220,1210,1211,1213,1215,1217,1220,1222,1224,1226,1228,1230,1232,1234,1236],{"class":222,"line":675},[220,1212,798],{"class":252},[220,1214,801],{"class":226},[220,1216,346],{"class":256},[220,1218,1219],{"class":230},"'blockquote'",[220,1221,809],{"class":256},[220,1223,741],{"class":377},[220,1225,380],{"class":256},[220,1227,147],{"class":816},[220,1229,380],{"class":256},[220,1231,821],{"class":226},[220,1233,346],{"class":256},[220,1235,826],{"class":349},[220,1237,436],{"class":256},[220,1239,1240,1242,1245],{"class":222,"line":681},[220,1241,787],{"class":252},[220,1243,1244],{"class":230}," 'link'",[220,1246,793],{"class":256},[220,1248,1249,1251,1253,1255,1258,1261,1264,1268,1270,1272,1275,1277,1280,1282,1285,1288,1290,1292,1294,1296,1298,1300,1302],{"class":222,"line":693},[220,1250,798],{"class":252},[220,1252,801],{"class":226},[220,1254,346],{"class":256},[220,1256,1257],{"class":230},"'a'",[220,1259,1260],{"class":256},", { ",[220,1262,1263],{"class":260},"href",[220,1265,1267],{"class":1266},"st7oF",":",[220,1269,882],{"class":377},[220,1271,380],{"class":256},[220,1273,1274],{"class":260},"url",[220,1276,424],{"class":256},[220,1278,1279],{"class":260},"target",[220,1281,1267],{"class":1266},[220,1283,1284],{"class":230}," '_blank'",[220,1286,1287],{"class":256}," }, ",[220,1289,741],{"class":377},[220,1291,380],{"class":256},[220,1293,147],{"class":816},[220,1295,380],{"class":256},[220,1297,821],{"class":226},[220,1299,346],{"class":256},[220,1301,826],{"class":349},[220,1303,436],{"class":256},[220,1305,1307,1310],{"class":222,"line":1306},30,[220,1308,1309],{"class":252},"    default",[220,1311,793],{"class":256},[220,1313,1315],{"class":222,"line":1314},31,[220,1316,1317],{"class":324},"      // Other unimplemented types\n",[220,1319,1321,1323,1325,1327,1330,1333,1336,1340,1342,1345,1347,1350,1353],{"class":222,"line":1320},32,[220,1322,798],{"class":252},[220,1324,801],{"class":226},[220,1326,346],{"class":256},[220,1328,1329],{"class":230},"'span'",[220,1331,1332],{"class":256},", { }, ",[220,1334,1335],{"class":230},"`[",[220,1337,1339],{"class":1338},"sAOjX","${",[220,1341,741],{"class":377},[220,1343,380],{"class":1344},"sMj0N",[220,1346,780],{"class":260},[220,1348,1349],{"class":1338},"}",[220,1351,1352],{"class":230},"]`",[220,1354,353],{"class":256},[220,1356,1358],{"class":222,"line":1357},33,[220,1359,1360],{"class":256},"  }\n",[220,1362,1364],{"class":222,"line":1363},34,[220,1365,696],{"class":256},[10,1367,1369],{"id":1368},"step-3-encapsulate-vue-component","Step 3: Encapsulate Vue Component",[20,1371,1372,1373,1376],{},"Integrating the above logic, we can build a Vue component. Given the characteristic of directly generating VNodes, using a functional component or explicit ",[15,1374,1375],{},"render"," function is most appropriate.",[211,1378,1382],{"className":1379,"code":1380,"language":1381,"meta":216,"style":216},"language-vue shiki shiki-themes one-light one-dark-pro","\u003Ctemplate>\n  \u003Ccomponent :is=\"VNodeTree\" />\n\u003C/template>\n\n\u003Cscript setup>\nimport { computed, h, shallowRef, watchEffect } from 'vue'\nimport { unified } from 'unified'\nimport remarkParse from 'remark-parse'\n\nconst props = defineProps({\n  mdText: {\n    type: String,\n    default: ''\n  }\n})\n\nconst ast = shallowRef(null)\nconst parser = unified().use(remarkParse)\n\nwatchEffect(() => {\n  ast.value = parser.parse(props.mdText)\n})\n\n// AST render function (same as renderAst function above)\nfunction renderAst(node) { ... }\n\nconst VNodeTree = computed(() => renderAst(ast.value))\n\n\u003C/script>\n","vue",[15,1383,1384,1395,1422,1431,1435,1447,1477,1491,1501,1505,1520,1530,1542,1551,1555,1560,1564,1581,1602,1606,1618,1647,1651,1655,1660,1677,1681,1709,1713],{"__ignoreMap":216},[220,1385,1386,1389,1392],{"class":222,"line":223},[220,1387,1388],{"class":256},"\u003C",[220,1390,1391],{"class":260},"template",[220,1393,1394],{"class":256},">\n",[220,1396,1397,1400,1403,1405,1408,1411,1414,1417,1419],{"class":222,"line":272},[220,1398,1399],{"class":256},"  \u003C",[220,1401,1402],{"class":260},"component",[220,1404,1118],{"class":256},[220,1406,1407],{"class":427},"is",[220,1409,1410],{"class":256},"=",[220,1412,1413],{"class":256},"\"",[220,1415,1416],{"class":349},"VNodeTree",[220,1418,1413],{"class":256},[220,1420,1421],{"class":256}," />\n",[220,1423,1424,1427,1429],{"class":222,"line":286},[220,1425,1426],{"class":256},"\u003C/",[220,1428,1391],{"class":260},[220,1430,1394],{"class":256},[220,1432,1433],{"class":222,"line":293},[220,1434,290],{"emptyLinePlaceholder":289},[220,1436,1437,1439,1442,1445],{"class":222,"line":316},[220,1438,1388],{"class":256},[220,1440,1441],{"class":260},"script",[220,1443,1444],{"class":427}," setup",[220,1446,1394],{"class":256},[220,1448,1449,1451,1453,1456,1458,1460,1462,1465,1467,1470,1472,1474],{"class":222,"line":321},[220,1450,253],{"class":252},[220,1452,257],{"class":256},[220,1454,1455],{"class":260},"computed",[220,1457,424],{"class":256},[220,1459,1068],{"class":260},[220,1461,424],{"class":256},[220,1463,1464],{"class":260},"shallowRef",[220,1466,424],{"class":256},[220,1468,1469],{"class":260},"watchEffect",[220,1471,263],{"class":256},[220,1473,266],{"class":252},[220,1475,1476],{"class":230}," 'vue'\n",[220,1478,1479,1481,1483,1485,1487,1489],{"class":222,"line":328},[220,1480,253],{"class":252},[220,1482,257],{"class":256},[220,1484,169],{"class":260},[220,1486,263],{"class":256},[220,1488,266],{"class":252},[220,1490,269],{"class":230},[220,1492,1493,1495,1497,1499],{"class":222,"line":356},[220,1494,253],{"class":252},[220,1496,277],{"class":260},[220,1498,280],{"class":252},[220,1500,283],{"class":230},[220,1502,1503],{"class":222,"line":361},[220,1504,290],{"emptyLinePlaceholder":289},[220,1506,1507,1509,1512,1514,1517],{"class":222,"line":367},[220,1508,296],{"class":252},[220,1510,1511],{"class":299}," props",[220,1513,304],{"class":303},[220,1515,1516],{"class":226}," defineProps",[220,1518,1519],{"class":256},"({\n",[220,1521,1522,1525,1527],{"class":222,"line":393},[220,1523,1524],{"class":260},"  mdText",[220,1526,1267],{"class":1266},[220,1528,1529],{"class":256}," {\n",[220,1531,1532,1535,1537,1540],{"class":222,"line":398},[220,1533,1534],{"class":260},"    type",[220,1536,1267],{"class":1266},[220,1538,1539],{"class":349}," String",[220,1541,465],{"class":256},[220,1543,1544,1546,1548],{"class":222,"line":561},[220,1545,1309],{"class":260},[220,1547,1267],{"class":1266},[220,1549,1550],{"class":230}," ''\n",[220,1552,1553],{"class":222,"line":567},[220,1554,1360],{"class":256},[220,1556,1557],{"class":222,"line":579},[220,1558,1559],{"class":256},"})\n",[220,1561,1562],{"class":222,"line":585},[220,1563,290],{"emptyLinePlaceholder":289},[220,1565,1566,1568,1570,1572,1575,1577,1579],{"class":222,"line":590},[220,1567,296],{"class":252},[220,1569,372],{"class":299},[220,1571,304],{"class":303},[220,1573,1574],{"class":226}," shallowRef",[220,1576,346],{"class":256},[220,1578,428],{"class":427},[220,1580,353],{"class":256},[220,1582,1583,1585,1588,1590,1592,1594,1596,1598,1600],{"class":222,"line":602},[220,1584,296],{"class":252},[220,1586,1587],{"class":299}," parser",[220,1589,304],{"class":303},[220,1591,234],{"class":226},[220,1593,340],{"class":256},[220,1595,343],{"class":226},[220,1597,346],{"class":256},[220,1599,350],{"class":349},[220,1601,353],{"class":256},[220,1603,1604],{"class":222,"line":609},[220,1605,290],{"emptyLinePlaceholder":289},[220,1607,1608,1610,1613,1616],{"class":222,"line":614},[220,1609,1469],{"class":226},[220,1611,1612],{"class":256},"(() ",[220,1614,1615],{"class":252},"=>",[220,1617,1529],{"class":256},[220,1619,1620,1623,1625,1627,1629,1631,1633,1635,1637,1640,1642,1645],{"class":222,"line":625},[220,1621,1622],{"class":377},"  ast",[220,1624,380],{"class":256},[220,1626,992],{"class":260},[220,1628,304],{"class":303},[220,1630,1587],{"class":377},[220,1632,380],{"class":256},[220,1634,383],{"class":226},[220,1636,346],{"class":256},[220,1638,1639],{"class":377},"props",[220,1641,380],{"class":256},[220,1643,1644],{"class":260},"mdText",[220,1646,353],{"class":256},[220,1648,1649],{"class":222,"line":637},[220,1650,1559],{"class":256},[220,1652,1653],{"class":222,"line":648},[220,1654,290],{"emptyLinePlaceholder":289},[220,1656,1657],{"class":222,"line":653},[220,1658,1659],{"class":324},"// AST render function (same as renderAst function above)\n",[220,1661,1662,1664,1666,1668,1670,1673,1675],{"class":222,"line":658},[220,1663,732],{"class":252},[220,1665,735],{"class":226},[220,1667,346],{"class":256},[220,1669,741],{"class":740},[220,1671,1672],{"class":256},") { ",[220,1674,550],{"class":1266},[220,1676,553],{"class":256},[220,1678,1679],{"class":222,"line":669},[220,1680,290],{"emptyLinePlaceholder":289},[220,1682,1683,1685,1688,1690,1693,1695,1697,1699,1701,1703,1705,1707],{"class":222,"line":675},[220,1684,296],{"class":252},[220,1686,1687],{"class":299}," VNodeTree",[220,1689,304],{"class":303},[220,1691,1692],{"class":226}," computed",[220,1694,1612],{"class":256},[220,1696,1615],{"class":252},[220,1698,735],{"class":226},[220,1700,346],{"class":256},[220,1702,421],{"class":377},[220,1704,380],{"class":256},[220,1706,992],{"class":260},[220,1708,436],{"class":256},[220,1710,1711],{"class":222,"line":681},[220,1712,290],{"emptyLinePlaceholder":289},[220,1714,1715,1717,1719],{"class":222,"line":693},[220,1716,1426],{"class":256},[220,1718,1441],{"class":260},[220,1720,1394],{"class":256},[20,1722,1723],{},"Now it can be used like a regular component:",[211,1725,1727],{"className":1379,"code":1726,"language":1381,"meta":216,"style":216},"\u003Ctemplate>\n  \u003CMarkdownRenderer :mdText=\"markdownContent\" />\n\u003C/template>\n\n\u003Cscript setup>\nimport { ref } from 'vue'\nimport MarkdownRenderer from './MarkdownRenderer.vue'\n\nconst markdownContent = ref('# Hello Vue\\n\\nThis is rendered via AST!')\n\u003C/script>\n",[15,1728,1729,1737,1758,1766,1770,1780,1795,1807,1811,1834],{"__ignoreMap":216},[220,1730,1731,1733,1735],{"class":222,"line":223},[220,1732,1388],{"class":256},[220,1734,1391],{"class":260},[220,1736,1394],{"class":256},[220,1738,1739,1741,1744,1746,1748,1750,1752,1754,1756],{"class":222,"line":272},[220,1740,1399],{"class":256},[220,1742,1743],{"class":260},"MarkdownRenderer",[220,1745,1118],{"class":256},[220,1747,1644],{"class":427},[220,1749,1410],{"class":256},[220,1751,1413],{"class":256},[220,1753,388],{"class":349},[220,1755,1413],{"class":256},[220,1757,1421],{"class":256},[220,1759,1760,1762,1764],{"class":222,"line":286},[220,1761,1426],{"class":256},[220,1763,1391],{"class":260},[220,1765,1394],{"class":256},[220,1767,1768],{"class":222,"line":293},[220,1769,290],{"emptyLinePlaceholder":289},[220,1771,1772,1774,1776,1778],{"class":222,"line":316},[220,1773,1388],{"class":256},[220,1775,1441],{"class":260},[220,1777,1444],{"class":427},[220,1779,1394],{"class":256},[220,1781,1782,1784,1786,1789,1791,1793],{"class":222,"line":321},[220,1783,253],{"class":252},[220,1785,257],{"class":256},[220,1787,1788],{"class":260},"ref",[220,1790,263],{"class":256},[220,1792,266],{"class":252},[220,1794,1476],{"class":230},[220,1796,1797,1799,1802,1804],{"class":222,"line":328},[220,1798,253],{"class":252},[220,1800,1801],{"class":260}," MarkdownRenderer",[220,1803,280],{"class":252},[220,1805,1806],{"class":230}," './MarkdownRenderer.vue'\n",[220,1808,1809],{"class":222,"line":356},[220,1810,290],{"emptyLinePlaceholder":289},[220,1812,1813,1815,1817,1819,1822,1824,1827,1829,1832],{"class":222,"line":361},[220,1814,296],{"class":252},[220,1816,300],{"class":299},[220,1818,304],{"class":303},[220,1820,1821],{"class":226}," ref",[220,1823,346],{"class":256},[220,1825,1826],{"class":230},"'# Hello Vue",[220,1828,310],{"class":303},[220,1830,1831],{"class":230},"This is rendered via AST!'",[220,1833,353],{"class":256},[220,1835,1836,1838,1840],{"class":222,"line":367},[220,1837,1426],{"class":256},[220,1839,1441],{"class":260},[220,1841,1394],{"class":256},[10,1843,1845],{"id":1844},"huge-advantages-of-the-ast-approach","Huge Advantages of the AST Approach",[20,1847,1848],{},"After switching to the AST track, we gained unprecedented superpowers:",[1850,1851,1852,1864,1936,1949],"ol",{},[175,1853,1854,1857,1858,1860,1861,1863],{},[105,1855,1856],{},"Native Integration, Excellent Performance",": We no longer need the brute force refresh of ",[15,1859,31],{},", nor do we need \"external help\" like ",[15,1862,17],{},". All updates are handled by Vue's own Diff algorithm, which is not only highly performant but also fully aligned with Vue's design philosophy - truly \"one of our own.\"",[175,1865,1866,1869,1870],{},[105,1867,1868],{},"High Flexibility and Extensibility",": AST, as a programmable JavaScript object, provides a solid foundation for customized processing:",[172,1871,1872,1893,1915],{},[175,1873,1874,1877,1878,1881,1882,1885,1886,1889,1890,1892],{},[105,1875,1876],{},"Element Replacement",": Native elements (like ",[15,1879,1880],{},"\u003Ch2>",") can be seamlessly replaced with custom Vue components (like ",[15,1883,1884],{},"\u003CFancyHeading>","), only requiring adjustments to the corresponding ",[15,1887,1888],{},"case"," logic in the ",[15,1891,826],{}," function.",[175,1894,1895,1898,1899,1902,1903,1906,1907,1910,1911,1914],{},[105,1896,1897],{},"Logic Injection",": Attributes like ",[15,1900,1901],{},"target=\"_blank\""," and ",[15,1904,1905],{},"rel=\"noopener noreferrer\""," can be conveniently added to external links ",[15,1908,1909],{},"\u003Ca>",", or lazy-load components can wrap images ",[15,1912,1913],{},"\u003Cimg>"," - such operations are easy to implement at the AST level.",[175,1916,1917,1920,1921,1923,1924,1927,1928,1931,1932,1935],{},[105,1918,1919],{},"Ecosystem Integration",": Fully leverage ",[15,1922,169],{},"'s rich plugin ecosystem (such as ",[15,1925,1926],{},"remark-gfm"," for GFM syntax support, ",[15,1929,1930],{},"remark-prism"," for code highlighting), only requiring the introduction of corresponding plugins in the processor chain (",[15,1933,1934],{},".use(pluginName)",").",[175,1937,1938,1941,1942,1945,1946,1948],{},[105,1939,1940],{},"Separation of Concerns",": Parsing logic (",[15,1943,1944],{},"remark","), rendering logic (",[15,1947,826],{},"), and business logic (Vue components) are clearly separated, resulting in clearer code structure and stronger maintainability.",[175,1950,1951,1954],{},[105,1952,1953],{},"Type Safety and Predictability",": Compared to manipulating strings or raw HTML, rendering logic based on structured AST is easier to type-check and reason about.",[10,1956,1958],{"id":1957},"conclusion-evolution-from-functional-implementation-to-architectural-optimization","Conclusion: Evolution from Functional Implementation to Architectural Optimization",[20,1960,1961],{},"Reviewing the optimization journey:",[172,1963,1964,1969,1975,1980],{},[175,1965,1966,1968],{},[105,1967,31],{},": Simple implementation, but with performance and security concerns.",[175,1970,1971,1974],{},[105,1972,1973],{},"Block updates",": Alleviated some performance issues, but the solution had limitations.",[175,1976,1977,1979],{},[105,1978,17],{},": Effectively improved performance and user experience, but existed in isolation from Vue's core mechanisms.",[175,1981,1982,1985],{},[105,1983,1984],{},"AST + Functional Rendering",": Returns to Vue's native paradigm, providing an ultimate solution with excellent performance, flexibility, and maintainability.",[20,1987,1988],{},"By adopting AST, we not only solved specific technical challenges but, more importantly, achieved a paradigm shift - from result-oriented programming (HTML strings) to process and structure-oriented programming (AST). This enables us to dive deep into the essence of content, thereby achieving precise control over the rendering process.",[20,1990,1991],{},"This optimization practice from \"full refresh\" to \"structured rendering\" is not only a technical process of performance improvement but also a systematic exploration of deeply understanding modern frontend engineering thinking. The final Markdown rendering solution achieved high standards in performance, functionality, and architectural elegance.",[1993,1994,1995],"style",{},"html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html pre.shiki code .sLKXg, html code.shiki .sLKXg{--shiki-default:#A626A4;--shiki-dark:#C678DD}html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html pre.shiki code .sJa8x, html code.shiki .sJa8x{--shiki-default:#E45649;--shiki-dark:#E06C75}html pre.shiki code .sNmU0, html code.shiki .sNmU0{--shiki-default:#986801;--shiki-dark:#E5C07B}html pre.shiki code .s_Sar, html code.shiki .s_Sar{--shiki-default:#0184BC;--shiki-dark:#56B6C2}html pre.shiki code .sW2Sy, html code.shiki .sW2Sy{--shiki-default:#A0A1A7;--shiki-default-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic}html pre.shiki code .sz0mV, html code.shiki .sz0mV{--shiki-default:#383A42;--shiki-dark:#E06C75}html pre.shiki code .s7GmK, html code.shiki .s7GmK{--shiki-default:#383A42;--shiki-dark:#E5C07B}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html pre.shiki code .sUNH4, html code.shiki .sUNH4{--shiki-default:white;--shiki-dark:#FFFFFF}html pre.shiki code .s8iYz, html code.shiki .s8iYz{--shiki-default:#383A42;--shiki-default-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic}html pre.shiki code .s2QsP, html code.shiki .s2QsP{--shiki-default:#E45649;--shiki-dark:#E5C07B}html pre.shiki code .sj4iG, html code.shiki .sj4iG{--shiki-default:#C18401;--shiki-dark:#E06C75}html pre.shiki code .s7DPa, html code.shiki .s7DPa{--shiki-default:#0184BC;--shiki-dark:#C678DD}html pre.shiki code .st7oF, html code.shiki .st7oF{--shiki-default:#0184BC;--shiki-dark:#ABB2BF}html pre.shiki code .sAOjX, html code.shiki .sAOjX{--shiki-default:#CA1243;--shiki-dark:#C678DD}html pre.shiki code .sMj0N, html code.shiki .sMj0N{--shiki-default:#50A14F;--shiki-dark:#ABB2BF}",{"title":216,"searchDepth":272,"depth":272,"links":1997},[1998,2000,2004,2005,2006,2007,2008],{"id":12,"depth":272,"text":1999},"Recap: When morphdom Meets Vue",{"id":69,"depth":272,"text":70,"children":2001},[2002,2003],{"id":130,"depth":286,"text":131},{"id":158,"depth":286,"text":159},{"id":205,"depth":272,"text":206},{"id":699,"depth":272,"text":700},{"id":1368,"depth":272,"text":1369},{"id":1844,"depth":272,"text":1845},{"id":1957,"depth":272,"text":1958},"2025-07-13 00:01:35","md","en",{},"/2025/07/13/vue-markdown-render-improvement-2","---\ntitle: \"Vue Markdown Rendering Optimization in Practice (Part 2): Farewell to DOM Manipulation, Embrace AST and Functional Rendering\"\ndate: 2025-07-13 00:01:35\nsticky:\ntags:\n- Vue.js\n- Markdown\n- AST\n- JavaScript\n- Web\n- unified\n---\n\n## Recap: When `morphdom` Meets Vue\n\nIn [the previous article](/2025/07/12/vue-markdown-render-improvement-1/), we embarked on a performance optimization journey for Markdown rendering. From the most primitive full refresh with `v-html`, to block-by-block updates, we eventually brought out the \"ultimate weapon\" - `morphdom`. By directly comparing and manipulating the real DOM, it updates the view with minimal cost, perfectly solving the performance bottleneck and interaction state loss issues in real-time rendering.\n\nHowever, a fundamental problem has always existed: in Vue's territory, bypassing Vue's Virtual DOM and Diff algorithm to let a third-party library directly \"operate\" on the real DOM always feels somewhat \"unorthodox.\" It's like introducing an old master with a hammer and wrench for manual repairs in a precision automated factory. Although the job is done well, it always feels like it disrupts the original workflow and isn't \"Vue\" enough.\n\nSo, is there a more elegant, more \"native\" approach that allows us to enjoy precise updates while fully integrating with Vue's ecosystem?\n\nWith this question in mind, I consulted friends in frontend development groups.\n\n> If you're building a renderer, your approach isn't the best practice. Each time you update, you generate the full virtual HTML, then optimize performance by subtracting from the HTML. However, the incremental part of each update is clear - why not directly use this incremental part for addition? The incremental part cannot be directly obtained through markdown-it, but a better approach is to transform at this step: first parse the Markdown structure, then use Vue's dynamic rendering capabilities to generate the DOM. This way, DOM reuse can leverage Vue's own abilities. — [j10c](https://site.j10c.cc/)\n\n> You can use unified with the remark-parse plugin to parse markdown strings into AST, then render based on the AST using render functions. — bii & [nekomeowww](https://github.com/nekomeowww)\n\n## New Approach: From \"String Conversion\" to \"Structured Rendering\"\n\nOur previous solutions, whether `v-html` or `morphdom`, shared a core approach:\n\n`Markdown String` -> `markdown-it` -> `HTML String` -> `Browser/morphdom` -> `DOM`\n\nThe problem with this pipeline is that starting from the `HTML String` step, we lose the **original structural information** of Markdown. We get a bunch of unstructured text that Vue cannot understand its internal logic and can only swallow it whole.\n\nThe new approach transforms the process into:\n\n`Markdown String` -> `AST (Abstract Syntax Tree)` -> `Vue VNodes (Virtual Nodes)` -> `Vue` -> `DOM`\n\n### What is AST?\n\n**AST (Abstract Syntax Tree)** is a structured representation of source code or markup language. It parses a long string of text into a hierarchical tree-like object. For Markdown, a level-1 heading becomes a node with `type: 'heading', depth: 1`, a paragraph becomes a node with `type: 'paragraph'`, and the text within the paragraph becomes the `children` of the `paragraph` node.\n\nOnce we convert Markdown into an AST, we essentially have a \"structural blueprint\" of the entire document. We're no longer facing a pile of ambiguous HTML strings, but rather a clear, programmable JavaScript object.\n\n### Our New Tools: unified and remark\n\nTo implement the `Markdown -> AST` conversion, we introduce the `unified` ecosystem.\n\n- **[unified](https://github.com/unifiedjs/unified)**: A powerful content processing engine. Think of it as an assembly line where raw text is the raw material, and you process it through parsing, transformation, and serialization by adding different \"plugins.\"\n- **[remark-parse](https://github.com/remarkjs/remark)**: A `unified` plugin specifically responsible for parsing Markdown text into AST (specifically in [mdast](https://github.com/syntax-tree/mdast) format).\n\n## Step 1: Parse Markdown into AST\n\nFirst, we need to install the dependencies:\n\n```bash\nnpm install unified remark-parse\n```\n\nThen, we can easily convert a Markdown string into an AST:\n\n```javascript\nimport { unified } from 'unified'\nimport remarkParse from 'remark-parse'\n\nconst markdownContent = '# Hello, AST!\\n\\nThis is a paragraph.'\n\n// Create a processor instance\nconst processor = unified().use(remarkParse)\n\n// Parse Markdown content\nconst ast = processor.parse(markdownContent)\n\nconsole.log(JSON.stringify(ast, null, 2))\n```\n\nRunning the above code will give us a JSON object like the following, which is our coveted AST:\n\n```json\n{\n  \"type\": \"root\",\n  \"children\": [\n    {\n      \"type\": \"heading\",\n      \"depth\": 1,\n      \"children\": [\n        {\n          \"type\": \"text\",\n          \"value\": \"Hello, AST!\",\n          \"position\": { ... }\n        }\n      ],\n      \"position\": { ... }\n    },\n    {\n      \"type\": \"paragraph\",\n      \"children\": [\n        {\n          \"type\": \"text\",\n          \"value\": \"This is a paragraph.\",\n          \"position\": { ... }\n        }\n      ],\n      \"position\": { ... }\n    }\n  ],\n  \"position\": { ... }\n}\n```\n\n## Step 2: From AST to Vue VNodes\n\nHaving obtained the AST, the next step is to actually \"construct\" this \"structural blueprint\" into a user-visible interface. In Vue's world, the blueprint for describing UI is the Virtual Node (VNode), and the `h()` function (i.e., hyperscript) is the brush for creating VNodes.\n\nOur task is to write a render function that can recursively traverse the AST and generate corresponding VNodes for each node type (`heading`, `paragraph`, `text`, etc.).\n\nHere's a simple render function implementation:\n\n```javascript\nfunction renderAst(node) {\n  if (!node) return null\n  switch (node.type) {\n    case 'root':\n      return h('div', {}, node.children.map(renderAst))\n    case 'paragraph':\n      return h('p', {}, node.children.map(renderAst))\n    case 'text':\n      return node.value\n    case 'emphasis':\n      return h('em', {}, node.children.map(renderAst))\n    case 'strong':\n      return h('strong', {}, node.children.map(renderAst))\n    case 'inlineCode':\n      return h('code', {}, node.value)\n    case 'heading':\n      return h('h' + node.depth, {}, node.children.map(renderAst))\n    case 'code':\n      return h('pre', {}, [h('code', {}, node.value)])\n    case 'list':\n      return h(node.ordered ? 'ol' : 'ul', {}, node.children.map(renderAst))\n    case 'listItem':\n      return h('li', {}, node.children.map(renderAst))\n    case 'thematicBreak':\n      return h('hr')\n    case 'blockquote':\n      return h('blockquote', {}, node.children.map(renderAst))\n    case 'link':\n      return h('a', { href: node.url, target: '_blank' }, node.children.map(renderAst))\n    default:\n      // Other unimplemented types\n      return h('span', { }, `[${node.type}]`)\n  }\n}\n```\n\n## Step 3: Encapsulate Vue Component\n\nIntegrating the above logic, we can build a Vue component. Given the characteristic of directly generating VNodes, using a functional component or explicit `render` function is most appropriate.\n\n```vue\n\u003Ctemplate>\n  \u003Ccomponent :is=\"VNodeTree\" />\n\u003C/template>\n\n\u003Cscript setup>\nimport { computed, h, shallowRef, watchEffect } from 'vue'\nimport { unified } from 'unified'\nimport remarkParse from 'remark-parse'\n\nconst props = defineProps({\n  mdText: {\n    type: String,\n    default: ''\n  }\n})\n\nconst ast = shallowRef(null)\nconst parser = unified().use(remarkParse)\n\nwatchEffect(() => {\n  ast.value = parser.parse(props.mdText)\n})\n\n// AST render function (same as renderAst function above)\nfunction renderAst(node) { ... }\n\nconst VNodeTree = computed(() => renderAst(ast.value))\n\n\u003C/script>\n```\n\nNow it can be used like a regular component:\n\n```vue\n\u003Ctemplate>\n  \u003CMarkdownRenderer :mdText=\"markdownContent\" />\n\u003C/template>\n\n\u003Cscript setup>\nimport { ref } from 'vue'\nimport MarkdownRenderer from './MarkdownRenderer.vue'\n\nconst markdownContent = ref('# Hello Vue\\n\\nThis is rendered via AST!')\n\u003C/script>\n```\n\n## Huge Advantages of the AST Approach\n\nAfter switching to the AST track, we gained unprecedented superpowers:\n\n1. **Native Integration, Excellent Performance**: We no longer need the brute force refresh of `v-html`, nor do we need \"external help\" like `morphdom`. All updates are handled by Vue's own Diff algorithm, which is not only highly performant but also fully aligned with Vue's design philosophy - truly \"one of our own.\"\n\n2. **High Flexibility and Extensibility**: AST, as a programmable JavaScript object, provides a solid foundation for customized processing:\n   - **Element Replacement**: Native elements (like `\u003Ch2>`) can be seamlessly replaced with custom Vue components (like `\u003CFancyHeading>`), only requiring adjustments to the corresponding `case` logic in the `renderAst` function.\n   - **Logic Injection**: Attributes like `target=\"_blank\"` and `rel=\"noopener noreferrer\"` can be conveniently added to external links `\u003Ca>`, or lazy-load components can wrap images `\u003Cimg>` - such operations are easy to implement at the AST level.\n   - **Ecosystem Integration**: Fully leverage `unified`'s rich plugin ecosystem (such as `remark-gfm` for GFM syntax support, `remark-prism` for code highlighting), only requiring the introduction of corresponding plugins in the processor chain (`.use(pluginName)`).\n\n3. **Separation of Concerns**: Parsing logic (`remark`), rendering logic (`renderAst`), and business logic (Vue components) are clearly separated, resulting in clearer code structure and stronger maintainability.\n\n4. **Type Safety and Predictability**: Compared to manipulating strings or raw HTML, rendering logic based on structured AST is easier to type-check and reason about.\n\n## Conclusion: Evolution from Functional Implementation to Architectural Optimization\n\nReviewing the optimization journey:\n\n- **v-html**: Simple implementation, but with performance and security concerns.\n- **Block updates**: Alleviated some performance issues, but the solution had limitations.\n- **morphdom**: Effectively improved performance and user experience, but existed in isolation from Vue's core mechanisms.\n- **AST + Functional Rendering**: Returns to Vue's native paradigm, providing an ultimate solution with excellent performance, flexibility, and maintainability.\n\nBy adopting AST, we not only solved specific technical challenges but, more importantly, achieved a paradigm shift - from result-oriented programming (HTML strings) to process and structure-oriented programming (AST). This enables us to dive deep into the essence of content, thereby achieving precise control over the rendering process.\n\nThis optimization practice from \"full refresh\" to \"structured rendering\" is not only a technical process of performance improvement but also a systematic exploration of deeply understanding modern frontend engineering thinking. The final Markdown rendering solution achieved high standards in performance, functionality, and architectural elegance.\n",{"title":5,"description":216},"posts/en/vue-markdown-render-improvement-2",false,[2019,2020,2021,2022,2023,169],"Vue.js","Markdown","AST","JavaScript","Web","PDHNVQDsZg7xs0G0d_3Sc3oueu_Zxp4-KPJOnaK6K7E",[2026,2031],{"title":2027,"path":2028,"stem":2029,"date":2030,"lang":2011,"children":-1},"How DNS Resolution Latency Destroyed My Image Hosting Optimization","/2025/08/11/dns-resolve-time-destroyed-my-optimization-for-pic-cdn","posts/en/dns-resolve-time-destroyed-my-optimization-for-pic-cdn","2025-08-11 00:06:40",{"title":2032,"path":2033,"stem":2034,"date":2035,"lang":2011,"children":-1},"Vue Markdown Rendering Optimization in Practice (Part 1): From Brute Force Refresh, Chunked Updates to Morphdom's Elegant Transformation","/2025/07/12/vue-markdown-render-improvement-1","posts/en/vue-markdown-render-improvement-1","2025-07-12 20:48:56","/2025/07/13/vue-markdown-render-improvement-2/",1764139096695]
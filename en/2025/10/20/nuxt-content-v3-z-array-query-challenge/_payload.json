[{"data":1,"prerenderedAt":1099},["ShallowReactive",2],{"post-2025-10-20-nuxt-content-v3-z-array-query-challenge-en":3,"surround-2025-10-20-nuxt-content-v3-z-array-query-challenge-en":1087,"randomIndex/2025/10/20/nuxt-content-v3-z-array-query-challenge/":73,"language-switch-/en/2025/10/20/nuxt-content-v3-z-array-query-challenge/-zh":1098},{"id":4,"title":5,"body":6,"date":1072,"description":1073,"extension":1074,"lang":1075,"meta":1076,"navigation":177,"path":1077,"rawbody":1078,"seo":1079,"stem":1080,"sticky":1081,"tags":1082,"__hash__":1086},"posts/posts/en/nuxt-content-v3-z-array-query-challenge.md","Array Field Filtering Challenges and Performance Optimization in Nuxt Content v3",{"type":7,"value":8,"toc":1066},"minimark",[9,27,30,94,101,106,116,247,262,440,449,459,463,466,749,759,776,783,788,792,805,822,828,842,1012,1015,1025,1031,1037,1042,1046,1053,1062],[10,11,12,13,17,18,21,22,26],"p",{},"Nuxt Content is a powerful module in the Nuxt ecosystem for handling Markdown, YAML, and other content types. Recently, while migrating my blog from Hexo to ",[14,15,16],"strong",{},"Nuxt v4 + Nuxt Content v3",", I encountered a tricky issue: the v3 default query API ",[14,19,20],{},"does not directly provide"," support for \"contains\" (",[23,24,25],"code",{},"$contains",") operations on array fields.",[10,28,29],{},"For example, here's the Front Matter of the blog post I'm currently writing:",[31,32,37],"pre",{"className":33,"code":34,"language":35,"meta":36,"style":36},"language-markdown shiki shiki-themes one-light one-dark-pro","---\ntitle: Array Field Filtering Challenges in Nuxt Content v3\ndate: 2025-10-20 21:52:59\nsticky:\ntags:\n- Nuxt\n- Nuxt Content\n- JavaScript\n---\n","markdown","",[23,38,39,47,53,59,65,71,77,83,89],{"__ignoreMap":36},[40,41,44],"span",{"class":42,"line":43},"line",1,[40,45,46],{},"---\n",[40,48,50],{"class":42,"line":49},2,[40,51,52],{},"title: Array Field Filtering Challenges in Nuxt Content v3\n",[40,54,56],{"class":42,"line":55},3,[40,57,58],{},"date: 2025-10-20 21:52:59\n",[40,60,62],{"class":42,"line":61},4,[40,63,64],{},"sticky:\n",[40,66,68],{"class":42,"line":67},5,[40,69,70],{},"tags:\n",[40,72,74],{"class":42,"line":73},6,[40,75,76],{},"- Nuxt\n",[40,78,80],{"class":42,"line":79},7,[40,81,82],{},"- Nuxt Content\n",[40,84,86],{"class":42,"line":85},8,[40,87,88],{},"- JavaScript\n",[40,90,92],{"class":42,"line":91},9,[40,93,46],{},[10,95,96,97,100],{},"My goal was to create a ",[14,98,99],{},"Tag page"," that lists all articles containing a specific tag (e.g., 'Nuxt').",[102,103,105],"h2",{"id":104},"the-convenience-of-v2-and-the-limitations-of-v3","The Convenience of v2 and the Limitations of v3",[10,107,108,109,112,113,115],{},"In Nuxt Content v2, data was stored based on the file system, and the query approach abstracted file content with a syntax similar to ",[14,110,111],{},"MongoDB's JSON document queries",". We could easily use the ",[23,114,25],{}," method to retrieve all articles with the \"Nuxt\" tag:",[31,117,121],{"className":118,"code":119,"language":120,"meta":36,"style":36},"language-typescript shiki shiki-themes one-light one-dark-pro","const tag = decodeURIComponent(route.params.tag as string)\n\nconst articles = await queryContent('posts')\n  .where({ tags: { $contains: tag } })  // ✅ MongoDB-style queries in v2\n  .find()\n","typescript",[23,122,123,173,179,202,237],{"__ignoreMap":36},[40,124,125,129,133,137,141,145,149,152,156,158,162,166,170],{"class":42,"line":43},[40,126,128],{"class":127},"sLKXg","const",[40,130,132],{"class":131},"sNmU0"," tag",[40,134,136],{"class":135},"s_Sar"," =",[40,138,140],{"class":139},"sAdtL"," decodeURIComponent",[40,142,144],{"class":143},"s5ixo","(",[40,146,148],{"class":147},"s7GmK","route",[40,150,151],{"class":143},".",[40,153,155],{"class":154},"s2QsP","params",[40,157,151],{"class":143},[40,159,161],{"class":160},"sJa8x","tag",[40,163,165],{"class":164},"sblXP"," as",[40,167,169],{"class":168},"sN9Y4"," string",[40,171,172],{"class":143},")\n",[40,174,175],{"class":42,"line":49},[40,176,178],{"emptyLinePlaceholder":177},true,"\n",[40,180,181,183,186,188,191,194,196,200],{"class":42,"line":55},[40,182,128],{"class":127},[40,184,185],{"class":131}," articles",[40,187,136],{"class":135},[40,189,190],{"class":127}," await",[40,192,193],{"class":139}," queryContent",[40,195,144],{"class":143},[40,197,199],{"class":198},"sDhpE","'posts'",[40,201,172],{"class":143},[40,203,204,207,210,213,216,220,223,225,227,230,233],{"class":42,"line":61},[40,205,206],{"class":143},"  .",[40,208,209],{"class":139},"where",[40,211,212],{"class":143},"({ ",[40,214,215],{"class":160},"tags",[40,217,219],{"class":218},"st7oF",":",[40,221,222],{"class":143}," { ",[40,224,25],{"class":160},[40,226,219],{"class":218},[40,228,132],{"class":229},"sz0mV",[40,231,232],{"class":143}," } })  ",[40,234,236],{"class":235},"sW2Sy","// ✅ MongoDB-style queries in v2\n",[40,238,239,241,244],{"class":42,"line":67},[40,240,206],{"class":143},[40,242,243],{"class":139},"find",[40,245,246],{"class":143},"()\n",[10,248,249,250,257,258,261],{},"However, when using ",[14,251,252,253,256],{},"Nuxt Content v3's ",[23,254,255],{},"queryCollection"," API",", we naturally try to use the ",[23,259,260],{},".where()"," method for filtering:",[31,263,265],{"className":118,"code":264,"language":120,"meta":36,"style":36},"const tag = decodeURIComponent(route.params.tag as string)\n\nconst { data } = await useAsyncData(`tag-${tag}`, () =>\n    queryCollection('posts')\n        .where(tag, 'in', 'tags')  // ❌ This will error because the first parameter must be a field name\n        .order('date', 'DESC')\n        .select('title', 'date', 'path', 'tags')\n        .all()\n)\n",[23,266,267,295,299,342,353,381,400,427,436],{"__ignoreMap":36},[40,268,269,271,273,275,277,279,281,283,285,287,289,291,293],{"class":42,"line":43},[40,270,128],{"class":127},[40,272,132],{"class":131},[40,274,136],{"class":135},[40,276,140],{"class":139},[40,278,144],{"class":143},[40,280,148],{"class":147},[40,282,151],{"class":143},[40,284,155],{"class":154},[40,286,151],{"class":143},[40,288,161],{"class":160},[40,290,165],{"class":164},[40,292,169],{"class":168},[40,294,172],{"class":143},[40,296,297],{"class":42,"line":49},[40,298,178],{"emptyLinePlaceholder":177},[40,300,301,303,305,308,311,314,316,319,321,324,328,330,333,336,339],{"class":42,"line":55},[40,302,128],{"class":127},[40,304,222],{"class":143},[40,306,307],{"class":131},"data",[40,309,310],{"class":143}," } ",[40,312,313],{"class":135},"=",[40,315,190],{"class":127},[40,317,318],{"class":139}," useAsyncData",[40,320,144],{"class":143},[40,322,323],{"class":198},"`tag-",[40,325,327],{"class":326},"sAOjX","${",[40,329,161],{"class":229},[40,331,332],{"class":326},"}",[40,334,335],{"class":198},"`",[40,337,338],{"class":143},", () ",[40,340,341],{"class":127},"=>\n",[40,343,344,347,349,351],{"class":42,"line":61},[40,345,346],{"class":139},"    queryCollection",[40,348,144],{"class":143},[40,350,199],{"class":198},[40,352,172],{"class":143},[40,354,355,358,360,362,364,367,370,372,375,378],{"class":42,"line":67},[40,356,357],{"class":143},"        .",[40,359,209],{"class":139},[40,361,144],{"class":143},[40,363,161],{"class":229},[40,365,366],{"class":143},", ",[40,368,369],{"class":198},"'in'",[40,371,366],{"class":143},[40,373,374],{"class":198},"'tags'",[40,376,377],{"class":143},")  ",[40,379,380],{"class":235},"// ❌ This will error because the first parameter must be a field name\n",[40,382,383,385,388,390,393,395,398],{"class":42,"line":73},[40,384,357],{"class":143},[40,386,387],{"class":139},"order",[40,389,144],{"class":143},[40,391,392],{"class":198},"'date'",[40,394,366],{"class":143},[40,396,397],{"class":198},"'DESC'",[40,399,172],{"class":143},[40,401,402,404,407,409,412,414,416,418,421,423,425],{"class":42,"line":79},[40,403,357],{"class":143},[40,405,406],{"class":139},"select",[40,408,144],{"class":143},[40,410,411],{"class":198},"'title'",[40,413,366],{"class":143},[40,415,392],{"class":198},[40,417,366],{"class":143},[40,419,420],{"class":198},"'path'",[40,422,366],{"class":143},[40,424,374],{"class":198},[40,426,172],{"class":143},[40,428,429,431,434],{"class":42,"line":85},[40,430,357],{"class":143},[40,432,433],{"class":139},"all",[40,435,246],{"class":143},[40,437,438],{"class":42,"line":91},[40,439,172],{"class":143},[10,441,442,443,445,446,151],{},"Unfortunately, this approach doesn't work. The ",[23,444,260],{}," method signature requires the field name as the first parameter: ",[23,447,448],{},"where(field: keyof Collection | string, operator: SqlOperator, value?: unknown)",[10,450,451,452,455,456,458],{},"Since Nuxt Content v3 ",[14,453,454],{},"uses SQLite as its underlying local database",", all queries must follow SQL-like syntax. If the design doesn't provide built-in operators for array fields (such as an SQL equivalent of ",[23,457,25],{},"), the eventual solution often feels somewhat \"awkward.\"",[102,460,462],{"id":461},"initial-implementation-sacrificing-performance-with-fetch-all","Initial Implementation: Sacrificing Performance with \"Fetch All\"",[10,464,465],{},"Following a \"migrate quickly, optimize later\" approach, I wrote the following code:",[31,467,469],{"className":118,"code":468,"language":120,"meta":36,"style":36},"// Initial implementation: fetch all and filter with JS\nconst allPosts = (\n    await useAsyncData(`tag-${route.params.tag}`, () =>\n        queryCollection('posts')\n            .order('date', 'DESC')\n            .select('title', 'date', 'path', 'tags')\n            .all()\n    )\n).data as Ref\u003CPost[]>\n\nconst Posts = computed(() => {\n    return allPosts.value.filter(post =>\n        typeof post.tags?.map === 'function'\n            ? post.tags?.includes(decodeURIComponent(route.params.tag as string))\n            : false\n    )\n})\n",[23,470,471,476,488,520,531,548,572,580,585,607,612,634,661,687,728,738,743],{"__ignoreMap":36},[40,472,473],{"class":42,"line":43},[40,474,475],{"class":235},"// Initial implementation: fetch all and filter with JS\n",[40,477,478,480,483,485],{"class":42,"line":49},[40,479,128],{"class":127},[40,481,482],{"class":139}," allPosts",[40,484,136],{"class":135},[40,486,487],{"class":143}," (\n",[40,489,490,493,495,497,499,501,503,506,508,510,512,514,516,518],{"class":42,"line":55},[40,491,492],{"class":127},"    await",[40,494,318],{"class":139},[40,496,144],{"class":143},[40,498,323],{"class":198},[40,500,327],{"class":326},[40,502,148],{"class":147},[40,504,151],{"class":505},"sMj0N",[40,507,155],{"class":154},[40,509,151],{"class":505},[40,511,161],{"class":160},[40,513,332],{"class":326},[40,515,335],{"class":198},[40,517,338],{"class":143},[40,519,341],{"class":127},[40,521,522,525,527,529],{"class":42,"line":61},[40,523,524],{"class":139},"        queryCollection",[40,526,144],{"class":143},[40,528,199],{"class":198},[40,530,172],{"class":143},[40,532,533,536,538,540,542,544,546],{"class":42,"line":67},[40,534,535],{"class":143},"            .",[40,537,387],{"class":139},[40,539,144],{"class":143},[40,541,392],{"class":198},[40,543,366],{"class":143},[40,545,397],{"class":198},[40,547,172],{"class":143},[40,549,550,552,554,556,558,560,562,564,566,568,570],{"class":42,"line":73},[40,551,535],{"class":143},[40,553,406],{"class":139},[40,555,144],{"class":143},[40,557,411],{"class":198},[40,559,366],{"class":143},[40,561,392],{"class":198},[40,563,366],{"class":143},[40,565,420],{"class":198},[40,567,366],{"class":143},[40,569,374],{"class":198},[40,571,172],{"class":143},[40,573,574,576,578],{"class":42,"line":79},[40,575,535],{"class":143},[40,577,433],{"class":139},[40,579,246],{"class":143},[40,581,582],{"class":42,"line":85},[40,583,584],{"class":143},"    )\n",[40,586,587,590,592,594,598,601,604],{"class":42,"line":91},[40,588,589],{"class":143},").",[40,591,307],{"class":160},[40,593,165],{"class":164},[40,595,597],{"class":596},"sC09Y"," Ref",[40,599,600],{"class":143},"\u003C",[40,602,603],{"class":596},"Post",[40,605,606],{"class":143},"[]>\n",[40,608,610],{"class":42,"line":609},10,[40,611,178],{"emptyLinePlaceholder":177},[40,613,615,617,620,622,625,628,631],{"class":42,"line":614},11,[40,616,128],{"class":127},[40,618,619],{"class":131}," Posts",[40,621,136],{"class":135},[40,623,624],{"class":139}," computed",[40,626,627],{"class":143},"(() ",[40,629,630],{"class":127},"=>",[40,632,633],{"class":143}," {\n",[40,635,637,640,642,644,647,649,652,654,658],{"class":42,"line":636},12,[40,638,639],{"class":127},"    return",[40,641,482],{"class":147},[40,643,151],{"class":143},[40,645,646],{"class":154},"value",[40,648,151],{"class":143},[40,650,651],{"class":139},"filter",[40,653,144],{"class":143},[40,655,657],{"class":656},"s8iYz","post",[40,659,660],{"class":127}," =>\n",[40,662,664,668,671,673,675,678,681,684],{"class":42,"line":663},13,[40,665,667],{"class":666},"s7DPa","        typeof",[40,669,670],{"class":147}," post",[40,672,151],{"class":143},[40,674,215],{"class":154},[40,676,677],{"class":143},"?.",[40,679,680],{"class":160},"map",[40,682,683],{"class":135}," ===",[40,685,686],{"class":198}," 'function'\n",[40,688,690,693,695,697,699,701,704,706,709,711,713,715,717,719,721,723,725],{"class":42,"line":689},14,[40,691,692],{"class":666},"            ?",[40,694,670],{"class":147},[40,696,151],{"class":143},[40,698,215],{"class":154},[40,700,677],{"class":143},[40,702,703],{"class":139},"includes",[40,705,144],{"class":143},[40,707,708],{"class":139},"decodeURIComponent",[40,710,144],{"class":143},[40,712,148],{"class":147},[40,714,151],{"class":143},[40,716,155],{"class":154},[40,718,151],{"class":143},[40,720,161],{"class":160},[40,722,165],{"class":164},[40,724,169],{"class":168},[40,726,727],{"class":143},"))\n",[40,729,731,734],{"class":42,"line":730},15,[40,732,733],{"class":666},"            :",[40,735,737],{"class":736},"sAGMh"," false\n",[40,739,741],{"class":42,"line":740},16,[40,742,584],{"class":143},[40,744,746],{"class":42,"line":745},17,[40,747,748],{"class":143},"})\n",[10,750,751,752],{},"While this method met the requirements, it came with obvious performance costs: ",[14,753,754,755,758],{},"bloated ",[23,756,757],{},"_payload.json"," file sizes.",[10,760,761,762,764,765,768,769,772,773,775],{},"In Nuxt projects, ",[23,763,757],{}," stores dynamic data such as ",[23,766,767],{},"useAsyncData"," results. With the fetch-all approach, ",[14,770,771],{},"every Tag page"," loads a ",[23,774,757],{}," containing information for all articles, causing data redundancy. Many tag pages only need data for one or two articles but are forced to load information for all articles, severely impacting performance.",[10,777,778],{},[779,780],"img",{"alt":781,"src":782},"The tags directory occupies 2.9MiB, the largest of all directories","https://static.031130.xyz/uploads/2025/10/20/a748878c03c64.webp",[10,784,785],{},[779,786],{"alt":757,"src":787},"https://static.031130.xyz/uploads/2025/10/20/8ef786d873da1.webp",[102,789,791],{"id":790},"a-clever-solution-leveraging-sqlites-storage-characteristics-for-optimization","A Clever Solution: Leveraging SQLite's Storage Characteristics for Optimization",[10,793,794,795,797,798,151],{},"To reduce the query results returned by ",[23,796,767],{},", I searched through Nuxt Content's GitHub Discussions and found ",[799,800,804],"a",{"href":801,"rel":802},"https://github.com/nuxt/content/discussions/2955",[803],"nofollow","a \"clever\" solution proposed during v3.alpha.8",[10,806,807,808,817,818,821],{},"Since Nuxt Content v3 uses an SQLite database, the ",[14,809,810,812,813,816],{},[23,811,215],{}," array originally defined in Front Matter (via ",[23,814,815],{},"z.array()",") is ultimately stored as a JSON string"," in the database (you can view the exact format in the ",[23,819,820],{},".nuxt/content/sql_dump.txt"," file).",[10,823,824],{},[779,825],{"alt":826,"src":827},"sql_dump.txt","https://static.031130.xyz/uploads/2025/10/20/b70036c55bb29.webp",[10,829,830,831,834,835,841],{},"This means we can leverage SQLite's ",[14,832,833],{},"string operation"," features by using the ",[14,836,837,840],{},[23,838,839],{},"LIKE"," operator with wildcards"," to perform array containment filtering, essentially querying whether the JSON string contains a specific substring:",[31,843,845],{"className":118,"code":844,"language":120,"meta":36,"style":36},"const tag = decodeURIComponent(route.params.tag as string)\n\nconst { data } = await useAsyncData(`tag-${route.params.tag}`, () =>\n    queryCollection('posts')\n        .where('tags', 'LIKE', `%\"${tag}\"%`)\n        .order('date', 'DESC')\n        .select('title', 'date', 'path', 'tags')\n        .all()\n)\n",[23,846,847,875,879,919,929,960,976,1000,1008],{"__ignoreMap":36},[40,848,849,851,853,855,857,859,861,863,865,867,869,871,873],{"class":42,"line":43},[40,850,128],{"class":127},[40,852,132],{"class":131},[40,854,136],{"class":135},[40,856,140],{"class":139},[40,858,144],{"class":143},[40,860,148],{"class":147},[40,862,151],{"class":143},[40,864,155],{"class":154},[40,866,151],{"class":143},[40,868,161],{"class":160},[40,870,165],{"class":164},[40,872,169],{"class":168},[40,874,172],{"class":143},[40,876,877],{"class":42,"line":49},[40,878,178],{"emptyLinePlaceholder":177},[40,880,881,883,885,887,889,891,893,895,897,899,901,903,905,907,909,911,913,915,917],{"class":42,"line":55},[40,882,128],{"class":127},[40,884,222],{"class":143},[40,886,307],{"class":131},[40,888,310],{"class":143},[40,890,313],{"class":135},[40,892,190],{"class":127},[40,894,318],{"class":139},[40,896,144],{"class":143},[40,898,323],{"class":198},[40,900,327],{"class":326},[40,902,148],{"class":147},[40,904,151],{"class":505},[40,906,155],{"class":154},[40,908,151],{"class":505},[40,910,161],{"class":160},[40,912,332],{"class":326},[40,914,335],{"class":198},[40,916,338],{"class":143},[40,918,341],{"class":127},[40,920,921,923,925,927],{"class":42,"line":61},[40,922,346],{"class":139},[40,924,144],{"class":143},[40,926,199],{"class":198},[40,928,172],{"class":143},[40,930,931,933,935,937,939,941,944,946,949,951,953,955,958],{"class":42,"line":67},[40,932,357],{"class":143},[40,934,209],{"class":139},[40,936,144],{"class":143},[40,938,374],{"class":198},[40,940,366],{"class":143},[40,942,943],{"class":198},"'LIKE'",[40,945,366],{"class":143},[40,947,948],{"class":198},"`%\"",[40,950,327],{"class":326},[40,952,161],{"class":229},[40,954,332],{"class":326},[40,956,957],{"class":198},"\"%`",[40,959,172],{"class":143},[40,961,962,964,966,968,970,972,974],{"class":42,"line":73},[40,963,357],{"class":143},[40,965,387],{"class":139},[40,967,144],{"class":143},[40,969,392],{"class":198},[40,971,366],{"class":143},[40,973,397],{"class":198},[40,975,172],{"class":143},[40,977,978,980,982,984,986,988,990,992,994,996,998],{"class":42,"line":79},[40,979,357],{"class":143},[40,981,406],{"class":139},[40,983,144],{"class":143},[40,985,411],{"class":198},[40,987,366],{"class":143},[40,989,392],{"class":198},[40,991,366],{"class":143},[40,993,420],{"class":198},[40,995,366],{"class":143},[40,997,374],{"class":198},[40,999,172],{"class":143},[40,1001,1002,1004,1006],{"class":42,"line":85},[40,1003,357],{"class":143},[40,1005,433],{"class":139},[40,1007,246],{"class":143},[40,1009,1010],{"class":42,"line":91},[40,1011,172],{"class":143},[10,1013,1014],{},"Below are the file sizes after optimization and regeneration - the reduction is quite significant:",[1016,1017,1018,1022],"ul",{},[1019,1020,1021],"li",{},"Tags directory size: 2.9MiB → 1.4MiB",[1019,1023,1024],{},"Individual _payload.json size: 23.1KiB → 1.01 KiB",[10,1026,1027,1028,1030],{},"Through this method, we successfully pushed the query logic down to the database layer, avoided unnecessary full data transfers, significantly reduced the size of ",[23,1029,757],{}," in individual directories, and achieved performance optimization.",[10,1032,1033],{},[779,1034],{"alt":1035,"src":1036},"Tags directory size reduction","https://static.031130.xyz/uploads/2025/10/20/007e72e7b476d.webp",[10,1038,1039],{},[779,1040],{"alt":757,"src":1041},"https://static.031130.xyz/uploads/2025/10/20/17ba3ccbbdf9e.webp",[102,1043,1045],{"id":1044},"see-also","See Also",[10,1047,1048],{},[799,1049,1052],{"href":1050,"rel":1051},"https://content.nuxt.com/docs/utils/query-collection#wherefield-keyof-collection-string-operator-sqloperator-value-unknown",[803],"queryCollection - Nuxt Content",[10,1054,1055],{},[799,1056,1058,1059,1061],{"href":801,"rel":1057},[803],"How do you query ",[23,1060,815],{}," fields (e.g. tags) in the latest nuxt-content module (v3.alpha.8) · nuxt/content · Discussion #2955",[1063,1064,1065],"style",{},"html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html pre.shiki code .sLKXg, html code.shiki .sLKXg{--shiki-default:#A626A4;--shiki-dark:#C678DD}html pre.shiki code .sNmU0, html code.shiki .sNmU0{--shiki-default:#986801;--shiki-dark:#E5C07B}html pre.shiki code .s_Sar, html code.shiki .s_Sar{--shiki-default:#0184BC;--shiki-dark:#56B6C2}html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html pre.shiki code .s7GmK, html code.shiki .s7GmK{--shiki-default:#383A42;--shiki-dark:#E5C07B}html pre.shiki code .s2QsP, html code.shiki .s2QsP{--shiki-default:#E45649;--shiki-dark:#E5C07B}html pre.shiki code .sJa8x, html code.shiki .sJa8x{--shiki-default:#E45649;--shiki-dark:#E06C75}html pre.shiki code .sblXP, html code.shiki .sblXP{--shiki-default:#383A42;--shiki-dark:#C678DD}html pre.shiki code .sN9Y4, html code.shiki .sN9Y4{--shiki-default:#0184BC;--shiki-dark:#E5C07B}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html pre.shiki code .st7oF, html code.shiki .st7oF{--shiki-default:#0184BC;--shiki-dark:#ABB2BF}html pre.shiki code .sz0mV, html code.shiki .sz0mV{--shiki-default:#383A42;--shiki-dark:#E06C75}html pre.shiki code .sW2Sy, html code.shiki .sW2Sy{--shiki-default:#A0A1A7;--shiki-default-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic}html pre.shiki code .sAOjX, html code.shiki .sAOjX{--shiki-default:#CA1243;--shiki-dark:#C678DD}html pre.shiki code .sMj0N, html code.shiki .sMj0N{--shiki-default:#50A14F;--shiki-dark:#ABB2BF}html pre.shiki code .sC09Y, html code.shiki .sC09Y{--shiki-default:#C18401;--shiki-dark:#E5C07B}html pre.shiki code .s8iYz, html code.shiki .s8iYz{--shiki-default:#383A42;--shiki-default-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic}html pre.shiki code .s7DPa, html code.shiki .s7DPa{--shiki-default:#0184BC;--shiki-dark:#C678DD}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}",{"title":36,"searchDepth":49,"depth":49,"links":1067},[1068,1069,1070,1071],{"id":104,"depth":49,"text":105},{"id":461,"depth":49,"text":462},{"id":790,"depth":49,"text":791},{"id":1044,"depth":49,"text":1045},"2025-10-20 21:52:59","Nuxt Content is a powerful module in the Nuxt ecosystem for handling Markdown, YAML, and other content types. Recently, while migrating my blog from Hexo to Nuxt v4 + Nuxt Content v3, I encountered a tricky issue: the v3 default query API does not directly provide support for \"contains\" ($contains) operations on array fields.","md","en",{},"/2025/10/20/nuxt-content-v3-z-array-query-challenge","---\ntitle: Array Field Filtering Challenges and Performance Optimization in Nuxt Content v3\ndate: 2025-10-20 21:52:59\nsticky:\ntags:\n- Nuxt\n- Nuxt Content\n- JavaScript\n---\n\nNuxt Content is a powerful module in the Nuxt ecosystem for handling Markdown, YAML, and other content types. Recently, while migrating my blog from Hexo to **Nuxt v4 + Nuxt Content v3**, I encountered a tricky issue: the v3 default query API **does not directly provide** support for \"contains\" (`$contains`) operations on array fields.\n\nFor example, here's the Front Matter of the blog post I'm currently writing:\n\n```markdown\n---\ntitle: Array Field Filtering Challenges in Nuxt Content v3\ndate: 2025-10-20 21:52:59\nsticky:\ntags:\n- Nuxt\n- Nuxt Content\n- JavaScript\n---\n```\n\nMy goal was to create a **Tag page** that lists all articles containing a specific tag (e.g., 'Nuxt').\n\n## The Convenience of v2 and the Limitations of v3\n\nIn Nuxt Content v2, data was stored based on the file system, and the query approach abstracted file content with a syntax similar to **MongoDB's JSON document queries**. We could easily use the `$contains` method to retrieve all articles with the \"Nuxt\" tag:\n\n```typescript\nconst tag = decodeURIComponent(route.params.tag as string)\n\nconst articles = await queryContent('posts')\n  .where({ tags: { $contains: tag } })  // ✅ MongoDB-style queries in v2\n  .find()\n```\n\nHowever, when using **Nuxt Content v3's `queryCollection` API**, we naturally try to use the `.where()` method for filtering:\n\n```typescript\nconst tag = decodeURIComponent(route.params.tag as string)\n\nconst { data } = await useAsyncData(`tag-${tag}`, () =>\n    queryCollection('posts')\n        .where(tag, 'in', 'tags')  // ❌ This will error because the first parameter must be a field name\n        .order('date', 'DESC')\n        .select('title', 'date', 'path', 'tags')\n        .all()\n)\n```\n\nUnfortunately, this approach doesn't work. The `.where()` method signature requires the field name as the first parameter: `where(field: keyof Collection | string, operator: SqlOperator, value?: unknown)`.\n\nSince Nuxt Content v3 **uses SQLite as its underlying local database**, all queries must follow SQL-like syntax. If the design doesn't provide built-in operators for array fields (such as an SQL equivalent of `$contains`), the eventual solution often feels somewhat \"awkward.\"\n\n## Initial Implementation: Sacrificing Performance with \"Fetch All\"\n\nFollowing a \"migrate quickly, optimize later\" approach, I wrote the following code:\n\n```typescript\n// Initial implementation: fetch all and filter with JS\nconst allPosts = (\n    await useAsyncData(`tag-${route.params.tag}`, () =>\n        queryCollection('posts')\n            .order('date', 'DESC')\n            .select('title', 'date', 'path', 'tags')\n            .all()\n    )\n).data as Ref\u003CPost[]>\n\nconst Posts = computed(() => {\n    return allPosts.value.filter(post =>\n        typeof post.tags?.map === 'function'\n            ? post.tags?.includes(decodeURIComponent(route.params.tag as string))\n            : false\n    )\n})\n```\n\nWhile this method met the requirements, it came with obvious performance costs: **bloated `_payload.json` file sizes.**\n\nIn Nuxt projects, `_payload.json` stores dynamic data such as `useAsyncData` results. With the fetch-all approach, **every Tag page** loads a `_payload.json` containing information for all articles, causing data redundancy. Many tag pages only need data for one or two articles but are forced to load information for all articles, severely impacting performance.\n\n![The tags directory occupies 2.9MiB, the largest of all directories](https://static.031130.xyz/uploads/2025/10/20/a748878c03c64.webp)\n\n![_payload.json](https://static.031130.xyz/uploads/2025/10/20/8ef786d873da1.webp)\n\n## A Clever Solution: Leveraging SQLite's Storage Characteristics for Optimization\n\nTo reduce the query results returned by `useAsyncData`, I searched through Nuxt Content's GitHub Discussions and found [a \"clever\" solution proposed during v3.alpha.8](https://github.com/nuxt/content/discussions/2955).\n\nSince Nuxt Content v3 uses an SQLite database, the **`tags` array originally defined in Front Matter (via `z.array()`) is ultimately stored as a JSON string** in the database (you can view the exact format in the `.nuxt/content/sql_dump.txt` file).\n\n![sql_dump.txt](https://static.031130.xyz/uploads/2025/10/20/b70036c55bb29.webp)\n\nThis means we can leverage SQLite's **string operation** features by using the **`LIKE` operator with wildcards** to perform array containment filtering, essentially querying whether the JSON string contains a specific substring:\n\n```typescript\nconst tag = decodeURIComponent(route.params.tag as string)\n\nconst { data } = await useAsyncData(`tag-${route.params.tag}`, () =>\n    queryCollection('posts')\n        .where('tags', 'LIKE', `%\"${tag}\"%`)\n        .order('date', 'DESC')\n        .select('title', 'date', 'path', 'tags')\n        .all()\n)\n```\n\nBelow are the file sizes after optimization and regeneration - the reduction is quite significant:\n\n- Tags directory size: 2.9MiB → 1.4MiB\n- Individual _payload.json size: 23.1KiB → 1.01 KiB\n\nThrough this method, we successfully pushed the query logic down to the database layer, avoided unnecessary full data transfers, significantly reduced the size of `_payload.json` in individual directories, and achieved performance optimization.\n\n![Tags directory size reduction](https://static.031130.xyz/uploads/2025/10/20/007e72e7b476d.webp)\n\n![_payload.json](https://static.031130.xyz/uploads/2025/10/20/17ba3ccbbdf9e.webp)\n\n## See Also\n\n[queryCollection - Nuxt Content](https://content.nuxt.com/docs/utils/query-collection#wherefield-keyof-collection-string-operator-sqloperator-value-unknown)\n\n[How do you query `z.array()` fields (e.g. tags) in the latest nuxt-content module (v3.alpha.8) · nuxt/content · Discussion #2955](https://github.com/nuxt/content/discussions/2955)\n",{"title":5,"description":1073},"posts/en/nuxt-content-v3-z-array-query-challenge",false,[1083,1084,1085],"Nuxt","Nuxt Content","JavaScript","N9QR-XpqIh8HoXtGo8Zzb1gDvMx9ALIoiOtrSKS9AeI",[1088,1093],{"title":1089,"path":1090,"stem":1091,"date":1092,"lang":1075,"children":-1},"HTTP/2 Server Push Has Effectively \"Died\" - I Miss It","/2025/11/05/http-2-server-push-is-practically-obsolete","posts/en/http-2-server-push-is-practically-obsolete","2025-11-05",{"title":1094,"path":1095,"stem":1096,"date":1097,"lang":1075,"children":-1},"Post-OCSP Era: How Browsers Address New Certificate Revocation Challenges","/2025/10/16/how-s-mozilla-crlite-going-now","posts/en/how-s-mozilla-crlite-going-now","2025-10-16 15:38:50","/2025/10/20/nuxt-content-v3-z-array-query-challenge/",1763690630126]
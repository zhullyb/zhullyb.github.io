[{"data":1,"prerenderedAt":150},["ShallowReactive",2],{"post-2023-11-01-unveiling-sunflower-smart-adapter-api-intercepting-utilizing-api-android-packet-sniffing-zh":3,"surround-2023-11-01-unveiling-sunflower-smart-adapter-api-intercepting-utilizing-api-android-packet-sniffing-zh":136,"randomIndex/2023/11/01/unveiling-sunflower-smart-adapter-api-intercepting-utilizing-api-android-packet-sniffing/":148,"language-switch-/2023/11/01/unveiling-sunflower-smart-adapter-api-intercepting-utilizing-api-android-packet-sniffing/-en":149},{"title":4,"date":5,"path":6,"tags":7,"body":13,"description":133},"使用 Root 后的安卓手机获取向日葵智能插座 C2 的开关 api","2023-11-01 23:46:28","/2023/11/01/unveiling-sunflower-smart-adapter-api-intercepting-utilizing-api-android-packet-sniffing",[8,9,10,11,12],"Android","Network","IoT","Fun","Hardware",{"type":14,"value":15,"toc":132},"minimark",[16,31,34,41,44,50,53,98,101,104,110,113,119,126],[17,18,19],"blockquote",{},[20,21,22,23,30],"p",{},"之前看到 ",[24,25,29],"a",{"href":26,"rel":27},"https://https.gs/archives/338/",[28],"nofollow","https.gs 上的一篇文章","，发现可以抓取向日葵智能插座 C1Pro 的开关 api，并实现局域网或公网的控制。这样一来，我们其实就不需要依赖于向日葵自己家的 App 去实现智能插座的开关操作，还是比较方便的。今年趁着双十一，直接低价拿下来带有计电功能的 C2，便也来试一试能不能抓到接口。",[20,32,33],{},"首先，拿到插座以后肯定还是下载向日葵的官方 App，完成 wifi 的链接，这里就不再赘述。",[20,35,36],{},[37,38],"img",{"alt":39,"src":40},"向日葵的操作界面","https://static.031130.xyz/uploads/2024/08/12/65427474ba54d.webp",[20,42,43],{},"然后就可以打开我们的抓包软件。需要注意的是，原博客中抓到的接口是 http 协议，但这个接口在新版的 App 上已经变为了 https 协议，因此我们需要找一台 Root 过后的安卓机去抓包。抓包的步骤没什么好说的，用 Root 权限给本地安装自己的 CA 证书，然后打开抓包模式，在向日葵的 App 那边开关几次插座，回来就能看到这一段时间内的请求。",[20,45,46],{},[37,47],{"alt":48,"src":49},"HttpCanary 操作界面","https://static.031130.xyz/uploads/2024/08/12/654275e167583.webp",[20,51,52],{},"点开可以看到，这是一个 GET 请求，一共有如下几个参数",[54,55,56,64,70,76,86,92],"ul",{},[57,58,59,63],"li",{},[60,61,62],"code",{},"status"," 这是状态设置，设置为 1 时为打开指令，0 为关闭指令",[57,65,66,69],{},[60,67,68],{},"sn"," 这个应该是设备码",[57,71,72,75],{},[60,73,74],{},"key"," 应该是用来操作设备的密钥",[57,77,78,81,82,85],{},[60,79,80],{},"_api"," 操作类型，我只关心插座的打开关闭，所以设为 ",[60,83,84],{},"set_plug_status"," 即可",[57,87,88,91],{},[60,89,90],{},"time"," 奇奇怪怪的而参数，也不是 unix 时间戳，反正照抄就行了",[57,93,94,97],{},[60,95,96],{},"index"," 原博说是用来给插排操作指定第几个孔位的，我们智能插座直接设置为 0 即可",[20,99,100],{},"理论上你用抓出来的 url 已经可以实现公网访问了，但我测试下来并不行，可能是向日葵那边的服务器做了别的校验，比如说判断了 ua 之类的？不过无所谓，我本来就是打算局域网内操作。",[20,102,103],{},"登陆路由器后台，寻找疑似智能插座的设备，一般很容易就能找到。",[20,105,106],{},[37,107],{"alt":108,"src":109},"路由器后台管理界面","https://static.031130.xyz/uploads/2024/08/12/654277f0d5c2a.webp",[20,111,112],{},"使用 nmap 命令扫对应 ip 开放的端口。不知道是不是巧合，我和原博扫出来的端口都是 6767 端口。",[20,114,115],{},[37,116],{"alt":117,"src":118},"扫描端口","https://static.031130.xyz/uploads/2024/08/12/654278685f137.webp",[20,120,121,122,125],{},"将上面抓到的 url 的域名换成 ",[60,123,124],{},"ip:port","，https 协议改成 http 协议，在浏览器中直接访问，获得了 0 的状态码，插座也正常开关。",[20,127,128],{},[37,129],{"alt":130,"src":131},"浏览器操作测试","https://static.031130.xyz/uploads/2024/08/12/654279513c1f8.webp",{"title":133,"searchDepth":134,"depth":134,"links":135},"",2,[],[137,143],{"title":138,"path":139,"stem":140,"date":141,"lang":142,"children":-1},"通过巴法云将向日葵智能插座接入米家，实现小爱同学远程控制","/2023/11/02/integrating-sunflower-smart-socket-with-mi-home-via-bemfa-cloud","posts/zh/integrating-sunflower-smart-socket-with-mi-home-via-bemfa-cloud","2023-11-02 10:17:02","zh-CN",{"title":144,"path":145,"stem":146,"date":147,"lang":142,"children":-1},"创建 b23.tv 追踪参数移除 bot","/2023/10/29/create-b23tv-remover-bot","posts/zh/create-b23tv-remover-bot","2023-10-29 00:35:48",7,null,1765307575613]
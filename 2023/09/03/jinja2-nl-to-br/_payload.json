[{"data":1,"prerenderedAt":404},["ShallowReactive",2],{"post-2023-09-03-jinja2-nl-to-br-zh":3,"has-other-2023-09-03-jinja2-nl-to-br-zh":386,"surround-2023-09-03-jinja2-nl-to-br-zh":393,"randomIndex/2023/09/03/jinja2-nl-to-br/":49},{"id":4,"title":5,"body":6,"date":377,"description":378,"extension":379,"lang":380,"meta":381,"navigation":90,"path":382,"rawbody":383,"seo":384,"stem":385,"sticky":386,"tags":387,"__hash__":392},"posts/posts/zh/jinja2-nl-to-br.md","jinja2 中如何优雅地实现换行",{"type":7,"value":8,"toc":375},"minimark",[9,21,33,341,344,353,364,371],[10,11,12,13,17,18,20],"p",{},"在使用 python 的 jinja2 模板引擎生成 html 的时候，会遇到 ",[14,15,16],"code",{},"\\n"," 换行符无法被正常换行的问题。我本能的想法就是将 ",[14,19,16],{}," 替换成 html 标签 \u003Cbr />，但失败了，jinja2 有自动转义的功能，直接将标签原模原样地渲染了出来，并没有生效。而为这一段代码块关闭自动转义则会有被 js 注入的风险，因此这也不是上策。",[10,22,23,24,26,27],{},"在 jinja2 的官方文档中，提出了使用 filter 的方案。也就是说，filter 将 ",[14,25,16],{}," 识别出来，并自动替换成 \u003Cbr /> 标签，并且使用 Markup 函数将这一段 html 文本标记成安全且无需转义的。见: ",[28,29,30],"a",{"href":30,"rel":31},"https://jinja.palletsprojects.com/en/3.1.x/api/#custom-filters",[32],"nofollow",[34,35,36],"blockquote",{},[37,38,43],"pre",{"className":39,"code":40,"language":41,"meta":42,"style":42},"language-python shiki shiki-themes one-light one-dark-pro","import re\nfrom jinja2 import pass_eval_context\nfrom markupsafe import Markup, escape\n\n@pass_eval_context\ndef nl2br(eval_ctx, value):\n    br = \"\u003Cbr>\\n\"\n\n    if eval_ctx.autoescape:\n        value = escape(value)\n        br = Markup(br)\n\n    result = \"\\n\\n\".join(\n        f\"\u003Cp>{br.join(p.splitlines())}\u003C\\p>\"\n        for p in re.split(r\"(?:\\r\\n|\\r(?!\\n)|\\n){2,}\", value)\n    )\n    return Markup(result) if autoescape else result\n","python","",[14,44,45,58,72,85,92,99,124,144,149,158,173,187,192,218,251,312,318],{"__ignoreMap":42},[46,47,50,54],"span",{"class":48,"line":49},"line",1,[46,51,53],{"class":52},"sLKXg","import",[46,55,57],{"class":56},"s5ixo"," re\n",[46,59,61,64,67,69],{"class":48,"line":60},2,[46,62,63],{"class":52},"from",[46,65,66],{"class":56}," jinja2 ",[46,68,53],{"class":52},[46,70,71],{"class":56}," pass_eval_context\n",[46,73,75,77,80,82],{"class":48,"line":74},3,[46,76,63],{"class":52},[46,78,79],{"class":56}," markupsafe ",[46,81,53],{"class":52},[46,83,84],{"class":56}," Markup, escape\n",[46,86,88],{"class":48,"line":87},4,[46,89,91],{"emptyLinePlaceholder":90},true,"\n",[46,93,95],{"class":48,"line":94},5,[46,96,98],{"class":97},"sAdtL","@pass_eval_context\n",[46,100,102,105,108,111,115,118,121],{"class":48,"line":101},6,[46,103,104],{"class":52},"def",[46,106,107],{"class":97}," nl2br",[46,109,110],{"class":56},"(",[46,112,114],{"class":113},"so_Uh","eval_ctx",[46,116,117],{"class":56},",",[46,119,120],{"class":113}," value",[46,122,123],{"class":56},"):\n",[46,125,127,130,134,138,141],{"class":48,"line":126},7,[46,128,129],{"class":56},"    br ",[46,131,133],{"class":132},"sknuh","=",[46,135,137],{"class":136},"sDhpE"," \"\u003Cbr>",[46,139,16],{"class":140},"s_Sar",[46,142,143],{"class":136},"\"\n",[46,145,147],{"class":48,"line":146},8,[46,148,91],{"emptyLinePlaceholder":90},[46,150,152,155],{"class":48,"line":151},9,[46,153,154],{"class":52},"    if",[46,156,157],{"class":56}," eval_ctx.autoescape:\n",[46,159,161,164,166,170],{"class":48,"line":160},10,[46,162,163],{"class":56},"        value ",[46,165,133],{"class":132},[46,167,169],{"class":168},"slOjB"," escape",[46,171,172],{"class":56},"(value)\n",[46,174,176,179,181,184],{"class":48,"line":175},11,[46,177,178],{"class":56},"        br ",[46,180,133],{"class":132},[46,182,183],{"class":168}," Markup",[46,185,186],{"class":56},"(br)\n",[46,188,190],{"class":48,"line":189},12,[46,191,91],{"emptyLinePlaceholder":90},[46,193,195,198,200,203,206,209,212,215],{"class":48,"line":194},13,[46,196,197],{"class":56},"    result ",[46,199,133],{"class":132},[46,201,202],{"class":136}," \"",[46,204,205],{"class":140},"\\n\\n",[46,207,208],{"class":136},"\"",[46,210,211],{"class":56},".",[46,213,214],{"class":168},"join",[46,216,217],{"class":56},"(\n",[46,219,221,224,227,231,234,236,239,242,245,248],{"class":48,"line":220},14,[46,222,223],{"class":52},"        f",[46,225,226],{"class":136},"\"\u003Cp>",[46,228,230],{"class":229},"sAGMh","{",[46,232,233],{"class":56},"br.",[46,235,214],{"class":168},[46,237,238],{"class":56},"(p.",[46,240,241],{"class":168},"splitlines",[46,243,244],{"class":56},"())",[46,246,247],{"class":229},"}",[46,249,250],{"class":136},"\u003C\\p>\"\n",[46,252,254,257,260,263,266,269,271,274,277,281,284,287,290,293,295,298,300,303,307,309],{"class":48,"line":253},15,[46,255,256],{"class":52},"        for",[46,258,259],{"class":56}," p ",[46,261,262],{"class":52},"in",[46,264,265],{"class":56}," re.",[46,267,268],{"class":168},"split",[46,270,110],{"class":56},[46,272,273],{"class":52},"r",[46,275,208],{"class":276},"sDaw7",[46,278,280],{"class":279},"sYoRg","(?:",[46,282,283],{"class":140},"\\r\\n",[46,285,286],{"class":56},"|",[46,288,289],{"class":140},"\\r",[46,291,292],{"class":56},"(?!",[46,294,16],{"class":140},[46,296,297],{"class":56},")|",[46,299,16],{"class":140},[46,301,302],{"class":279},")",[46,304,306],{"class":305},"sYebD","{2,}",[46,308,208],{"class":276},[46,310,311],{"class":56},", value)\n",[46,313,315],{"class":48,"line":314},16,[46,316,317],{"class":56},"    )\n",[46,319,321,324,326,329,332,335,338],{"class":48,"line":320},17,[46,322,323],{"class":52},"    return",[46,325,183],{"class":168},[46,327,328],{"class":56},"(result) ",[46,330,331],{"class":52},"if",[46,333,334],{"class":56}," autoescape ",[46,336,337],{"class":52},"else",[46,339,340],{"class":56}," result\n",[10,342,343],{},"使用这段代码后，我遇到了连续两个换行符被识别成一个换行符的问题，依然不满意。",[10,345,346,347,352],{},"在 ",[28,348,351],{"href":349,"rel":350},"https://github.com/pallets/flask/issues/2628",[32],"issue#2628"," 中，我找到了一个相对优雅的解决方案——使用 css 样式来完成这个任务。",[10,354,355,356,359,360,363],{},"通过设置 ",[14,357,358],{},"white-space: pre-line;"," 的 css 样式，html 在被渲染时将会不再忽略换行符，浏览器就能够在没有 br 标签标注的情况下实现自动换行。而如果设置为 ",[14,361,362],{},"white-space: pre-wrap;"," 则多个空格将不会再被合并成一个空格，直接治好了我在入门 html 时的各种不适。",[10,365,366,367,370],{},"此外，通过 ",[14,368,369],{},"word-break: break-word;"," 的 css 样式可以实现只有当一个单词一整行都显示不下时，才会拆分换行该单词的效果，可以避免 break-all 拆分所有单词或者 normal 时遇到长单词直接元素溢出的问题。",[372,373,374],"style",{},"html pre.shiki code .sLKXg, html code.shiki .sLKXg{--shiki-default:#A626A4;--shiki-dark:#C678DD}html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .so_Uh, html code.shiki .so_Uh{--shiki-default:#986801;--shiki-default-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic}html pre.shiki code .sknuh, html code.shiki .sknuh{--shiki-default:#383A42;--shiki-dark:#56B6C2}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html pre.shiki code .s_Sar, html code.shiki .s_Sar{--shiki-default:#0184BC;--shiki-dark:#56B6C2}html pre.shiki code .slOjB, html code.shiki .slOjB{--shiki-default:#383A42;--shiki-dark:#61AFEF}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html pre.shiki code .sDaw7, html code.shiki .sDaw7{--shiki-default:#0184BC;--shiki-dark:#E06C75}html pre.shiki code .sYoRg, html code.shiki .sYoRg{--shiki-default:#0184BC;--shiki-dark:#D19A66}html pre.shiki code .sYebD, html code.shiki .sYebD{--shiki-default:#383A42;--shiki-dark:#D19A66}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}",{"title":42,"searchDepth":60,"depth":60,"links":376},[],"2023-09-03 13:37:35","在使用 python 的 jinja2 模板引擎生成 html 的时候，会遇到 \\n 换行符无法被正常换行的问题。我本能的想法就是将 \\n 替换成 html 标签 \u003Cbr />，但失败了，jinja2 有自动转义的功能，直接将标签原模原样地渲染了出来，并没有生效。而为这一段代码块关闭自动转义则会有被 js 注入的风险，因此这也不是上策。","md","zh-CN",{},"/2023/09/03/jinja2-nl-to-br","---\ntitle: jinja2 中如何优雅地实现换行\ndate: 2023-09-03 13:37:35\nsticky:\ntags:\n- Linux\n- Python\n- jinja2\n- CSS\n---\n\n在使用 python 的 jinja2 模板引擎生成 html 的时候，会遇到 `\\n` 换行符无法被正常换行的问题。我本能的想法就是将 `\\n` 替换成 html 标签 \\\u003Cbr />，但失败了，jinja2 有自动转义的功能，直接将标签原模原样地渲染了出来，并没有生效。而为这一段代码块关闭自动转义则会有被 js 注入的风险，因此这也不是上策。\n\n在 jinja2 的官方文档中，提出了使用 filter 的方案。也就是说，filter 将 `\\n` 识别出来，并自动替换成 \\\u003Cbr /> 标签，并且使用 Markup 函数将这一段 html 文本标记成安全且无需转义的。见: https://jinja.palletsprojects.com/en/3.1.x/api/#custom-filters\n\n> ```python\n> import re\n> from jinja2 import pass_eval_context\n> from markupsafe import Markup, escape\n> \n> @pass_eval_context\n> def nl2br(eval_ctx, value):\n>     br = \"\u003Cbr>\\n\"\n> \n>     if eval_ctx.autoescape:\n>         value = escape(value)\n>         br = Markup(br)\n> \n>     result = \"\\n\\n\".join(\n>         f\"\u003Cp>{br.join(p.splitlines())}\u003C\\p>\"\n>         for p in re.split(r\"(?:\\r\\n|\\r(?!\\n)|\\n){2,}\", value)\n>     )\n>     return Markup(result) if autoescape else result\n> ```\n\n使用这段代码后，我遇到了连续两个换行符被识别成一个换行符的问题，依然不满意。\n\n在 [issue#2628](https://github.com/pallets/flask/issues/2628) 中，我找到了一个相对优雅的解决方案——使用 css 样式来完成这个任务。\n\n通过设置 `white-space: pre-line;` 的 css 样式，html 在被渲染时将会不再忽略换行符，浏览器就能够在没有 br 标签标注的情况下实现自动换行。而如果设置为 `white-space: pre-wrap;` 则多个空格将不会再被合并成一个空格，直接治好了我在入门 html 时的各种不适。\n\n此外，通过 `word-break: break-word;` 的 css 样式可以实现只有当一个单词一整行都显示不下时，才会拆分换行该单词的效果，可以避免 break-all 拆分所有单词或者 normal 时遇到长单词直接元素溢出的问题。\n",{"title":5,"description":378},"posts/zh/jinja2-nl-to-br",false,[388,389,390,391],"Linux","Python","jinja2","CSS","TbuDG4GPsUtEciU5RP9EOsdFREDlb309nQhkHK32OUg",[394,399],{"title":395,"path":396,"stem":397,"date":398,"children":-1},"创建 b23.tv 追踪参数移除 bot","/2023/10/29/create-b23tv-remover-bot","posts/zh/create-b23tv-remover-bot","2023-10-29 00:35:48",{"title":400,"path":401,"stem":402,"date":403,"children":-1},"手动指定 python-selenium 的 driver path 以解决在中国大陆网络环境下启动卡住的问题","/2023/09/02/python-selenium-start-difficult-in-china-mainland","posts/zh/python-selenium-start-difficult-in-china-mainland","2023-09-02 01:59:18",1763567128076]
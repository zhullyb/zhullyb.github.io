[{"data":1,"prerenderedAt":397},["ShallowReactive",2],{"post-2023-09-03-jinja2-nl-to-br-zh":3,"surround-2023-09-03-jinja2-nl-to-br-zh":384,"randomIndex/2023/09/03/jinja2-nl-to-br/":80,"language-switch-/2023/09/03/jinja2-nl-to-br/-en":396},{"title":4,"date":5,"path":6,"tags":7,"body":12,"description":383},"jinja2 中如何优雅地实现换行","2023-09-03 13:37:35","/2023/09/03/jinja2-nl-to-br",[8,9,10,11],"Linux","Python","jinja2","CSS",{"type":13,"value":14,"toc":381},"minimark",[15,27,39,347,350,359,370,377],[16,17,18,19,23,24,26],"p",{},"在使用 python 的 jinja2 模板引擎生成 html 的时候，会遇到 ",[20,21,22],"code",{},"\\n"," 换行符无法被正常换行的问题。我本能的想法就是将 ",[20,25,22],{}," 替换成 html 标签 \u003Cbr />，但失败了，jinja2 有自动转义的功能，直接将标签原模原样地渲染了出来，并没有生效。而为这一段代码块关闭自动转义则会有被 js 注入的风险，因此这也不是上策。",[16,28,29,30,32,33],{},"在 jinja2 的官方文档中，提出了使用 filter 的方案。也就是说，filter 将 ",[20,31,22],{}," 识别出来，并自动替换成 \u003Cbr /> 标签，并且使用 Markup 函数将这一段 html 文本标记成安全且无需转义的。见: ",[34,35,36],"a",{"href":36,"rel":37},"https://jinja.palletsprojects.com/en/3.1.x/api/#custom-filters",[38],"nofollow",[40,41,42],"blockquote",{},[43,44,49],"pre",{"className":45,"code":46,"language":47,"meta":48,"style":48},"language-python shiki shiki-themes one-light one-dark-pro","import re\nfrom jinja2 import pass_eval_context\nfrom markupsafe import Markup, escape\n\n@pass_eval_context\ndef nl2br(eval_ctx, value):\n    br = \"\u003Cbr>\\n\"\n\n    if eval_ctx.autoescape:\n        value = escape(value)\n        br = Markup(br)\n\n    result = \"\\n\\n\".join(\n        f\"\u003Cp>{br.join(p.splitlines())}\u003C\\p>\"\n        for p in re.split(r\"(?:\\r\\n|\\r(?!\\n)|\\n){2,}\", value)\n    )\n    return Markup(result) if autoescape else result\n","python","",[20,50,51,64,78,91,98,105,130,150,155,164,179,193,198,224,257,318,324],{"__ignoreMap":48},[52,53,56,60],"span",{"class":54,"line":55},"line",1,[52,57,59],{"class":58},"sLKXg","import",[52,61,63],{"class":62},"s5ixo"," re\n",[52,65,67,70,73,75],{"class":54,"line":66},2,[52,68,69],{"class":58},"from",[52,71,72],{"class":62}," jinja2 ",[52,74,59],{"class":58},[52,76,77],{"class":62}," pass_eval_context\n",[52,79,81,83,86,88],{"class":54,"line":80},3,[52,82,69],{"class":58},[52,84,85],{"class":62}," markupsafe ",[52,87,59],{"class":58},[52,89,90],{"class":62}," Markup, escape\n",[52,92,94],{"class":54,"line":93},4,[52,95,97],{"emptyLinePlaceholder":96},true,"\n",[52,99,101],{"class":54,"line":100},5,[52,102,104],{"class":103},"sAdtL","@pass_eval_context\n",[52,106,108,111,114,117,121,124,127],{"class":54,"line":107},6,[52,109,110],{"class":58},"def",[52,112,113],{"class":103}," nl2br",[52,115,116],{"class":62},"(",[52,118,120],{"class":119},"so_Uh","eval_ctx",[52,122,123],{"class":62},",",[52,125,126],{"class":119}," value",[52,128,129],{"class":62},"):\n",[52,131,133,136,140,144,147],{"class":54,"line":132},7,[52,134,135],{"class":62},"    br ",[52,137,139],{"class":138},"sknuh","=",[52,141,143],{"class":142},"sDhpE"," \"\u003Cbr>",[52,145,22],{"class":146},"s_Sar",[52,148,149],{"class":142},"\"\n",[52,151,153],{"class":54,"line":152},8,[52,154,97],{"emptyLinePlaceholder":96},[52,156,158,161],{"class":54,"line":157},9,[52,159,160],{"class":58},"    if",[52,162,163],{"class":62}," eval_ctx.autoescape:\n",[52,165,167,170,172,176],{"class":54,"line":166},10,[52,168,169],{"class":62},"        value ",[52,171,139],{"class":138},[52,173,175],{"class":174},"slOjB"," escape",[52,177,178],{"class":62},"(value)\n",[52,180,182,185,187,190],{"class":54,"line":181},11,[52,183,184],{"class":62},"        br ",[52,186,139],{"class":138},[52,188,189],{"class":174}," Markup",[52,191,192],{"class":62},"(br)\n",[52,194,196],{"class":54,"line":195},12,[52,197,97],{"emptyLinePlaceholder":96},[52,199,201,204,206,209,212,215,218,221],{"class":54,"line":200},13,[52,202,203],{"class":62},"    result ",[52,205,139],{"class":138},[52,207,208],{"class":142}," \"",[52,210,211],{"class":146},"\\n\\n",[52,213,214],{"class":142},"\"",[52,216,217],{"class":62},".",[52,219,220],{"class":174},"join",[52,222,223],{"class":62},"(\n",[52,225,227,230,233,237,240,242,245,248,251,254],{"class":54,"line":226},14,[52,228,229],{"class":58},"        f",[52,231,232],{"class":142},"\"\u003Cp>",[52,234,236],{"class":235},"sAGMh","{",[52,238,239],{"class":62},"br.",[52,241,220],{"class":174},[52,243,244],{"class":62},"(p.",[52,246,247],{"class":174},"splitlines",[52,249,250],{"class":62},"())",[52,252,253],{"class":235},"}",[52,255,256],{"class":142},"\u003C\\p>\"\n",[52,258,260,263,266,269,272,275,277,280,283,287,290,293,296,299,301,304,306,309,313,315],{"class":54,"line":259},15,[52,261,262],{"class":58},"        for",[52,264,265],{"class":62}," p ",[52,267,268],{"class":58},"in",[52,270,271],{"class":62}," re.",[52,273,274],{"class":174},"split",[52,276,116],{"class":62},[52,278,279],{"class":58},"r",[52,281,214],{"class":282},"sDaw7",[52,284,286],{"class":285},"sYoRg","(?:",[52,288,289],{"class":146},"\\r\\n",[52,291,292],{"class":62},"|",[52,294,295],{"class":146},"\\r",[52,297,298],{"class":62},"(?!",[52,300,22],{"class":146},[52,302,303],{"class":62},")|",[52,305,22],{"class":146},[52,307,308],{"class":285},")",[52,310,312],{"class":311},"sYebD","{2,}",[52,314,214],{"class":282},[52,316,317],{"class":62},", value)\n",[52,319,321],{"class":54,"line":320},16,[52,322,323],{"class":62},"    )\n",[52,325,327,330,332,335,338,341,344],{"class":54,"line":326},17,[52,328,329],{"class":58},"    return",[52,331,189],{"class":174},[52,333,334],{"class":62},"(result) ",[52,336,337],{"class":58},"if",[52,339,340],{"class":62}," autoescape ",[52,342,343],{"class":58},"else",[52,345,346],{"class":62}," result\n",[16,348,349],{},"使用这段代码后，我遇到了连续两个换行符被识别成一个换行符的问题，依然不满意。",[16,351,352,353,358],{},"在 ",[34,354,357],{"href":355,"rel":356},"https://github.com/pallets/flask/issues/2628",[38],"issue#2628"," 中，我找到了一个相对优雅的解决方案——使用 css 样式来完成这个任务。",[16,360,361,362,365,366,369],{},"通过设置 ",[20,363,364],{},"white-space: pre-line;"," 的 css 样式，html 在被渲染时将会不再忽略换行符，浏览器就能够在没有 br 标签标注的情况下实现自动换行。而如果设置为 ",[20,367,368],{},"white-space: pre-wrap;"," 则多个空格将不会再被合并成一个空格，直接治好了我在入门 html 时的各种不适。",[16,371,372,373,376],{},"此外，通过 ",[20,374,375],{},"word-break: break-word;"," 的 css 样式可以实现只有当一个单词一整行都显示不下时，才会拆分换行该单词的效果，可以避免 break-all 拆分所有单词或者 normal 时遇到长单词直接元素溢出的问题。",[378,379,380],"style",{},"html pre.shiki code .sLKXg, html code.shiki .sLKXg{--shiki-default:#A626A4;--shiki-dark:#C678DD}html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .so_Uh, html code.shiki .so_Uh{--shiki-default:#986801;--shiki-default-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic}html pre.shiki code .sknuh, html code.shiki .sknuh{--shiki-default:#383A42;--shiki-dark:#56B6C2}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html pre.shiki code .s_Sar, html code.shiki .s_Sar{--shiki-default:#0184BC;--shiki-dark:#56B6C2}html pre.shiki code .slOjB, html code.shiki .slOjB{--shiki-default:#383A42;--shiki-dark:#61AFEF}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html pre.shiki code .sDaw7, html code.shiki .sDaw7{--shiki-default:#0184BC;--shiki-dark:#E06C75}html pre.shiki code .sYoRg, html code.shiki .sYoRg{--shiki-default:#0184BC;--shiki-dark:#D19A66}html pre.shiki code .sYebD, html code.shiki .sYebD{--shiki-default:#383A42;--shiki-dark:#D19A66}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}",{"title":48,"searchDepth":66,"depth":66,"links":382},[],"在使用 python 的 jinja2 模板引擎生成 html 的时候，会遇到 \\n 换行符无法被正常换行的问题。我本能的想法就是将 \\n 替换成 html 标签 \u003Cbr />，但失败了，jinja2 有自动转义的功能，直接将标签原模原样地渲染了出来，并没有生效。而为这一段代码块关闭自动转义则会有被 js 注入的风险，因此这也不是上策。",[385,391],{"title":386,"path":387,"stem":388,"date":389,"lang":390,"children":-1},"创建 b23.tv 追踪参数移除 bot","/2023/10/29/create-b23tv-remover-bot","posts/zh/create-b23tv-remover-bot","2023-10-29 00:35:48","zh-CN",{"title":392,"path":393,"stem":394,"date":395,"lang":390,"children":-1},"手动指定 python-selenium 的 driver path 以解决在中国大陆网络环境下启动卡住的问题","/2023/09/02/python-selenium-start-difficult-in-china-mainland","posts/zh/python-selenium-start-difficult-in-china-mainland","2023-09-02 01:59:18",null,1765307312622]
[{"data":1,"prerenderedAt":1046},["ShallowReactive",2],{"post-2023-06-24-connect-china-mobile-with-router-in-zjut-dormitory":3,"surround-2023-06-24-connect-china-mobile-with-router-in-zjut-dormitory":1035,"randomIndex/2023/06/24/connect-china-mobile-with-router-in-zjut-dormitory/":187},{"id":4,"title":5,"body":6,"date":1023,"description":15,"extension":1024,"meta":1025,"navigation":183,"path":1026,"rawbody":1027,"seo":1028,"stem":1029,"sticky":1030,"tags":1031,"__hash__":1034},"posts/posts/connect-china-mobile-with-router-in-zjut-dormitory.md","在浙工大宿舍使用路由器连接移动网络(校园网)",{"type":7,"value":8,"toc":1019},"minimark",[9,16,27,30,33,38,41,43,48,55,64,66,71,77,84,86,92,108,113,116,122,125,128,134,137,142,151,154,160,911,914,920,927,933,936,949,952,955,970,976,983,988,994,997,1003,1009,1015],[10,11,12],"p",{},[13,14,15],"strong",{},"2025.09.01 Updates:",[10,17,18,19,26],{},"最近看到这篇博客的热度还挺高，应该是最近新生开学有不少都在看。但移动的认证方式于今年的 8 月 15 日发生了变更，具体可以看",[20,21,25],"a",{"href":22,"rel":23},"https://mp.weixin.qq.com/s/KtaP62A3h96FETerPdnQmw",[24],"nofollow","这篇微信公众号文章","。我近期不在学校，没有环境去研究新的认证方式，但据我身边的人说不再需要什么 l2tp 了，找台常见的路由器直接走 dhcp 以后过一遍网页验证就好了。",[10,28,29],{},"祝各位新生在工大能渡过愉快的四年！",[31,32],"hr",{},[10,34,35],{},[13,36,37],{},"2024.04.09 Updates:",[10,39,40],{},"几天前移动对网页认证的页面进行了更新，原有的脚本失效，本博客已更新适配新版网页认证的脚本。",[31,42],{},[10,44,45],{},[13,46,47],{},"2023.7.10 Updates:",[10,49,50,51,54],{},"首先，",[13,52,53],{},"搬到屏峰校区以后，l2tp 服务器确实依然为 192.168.115.1","，这点挺奇怪的。",[10,56,57,58,63],{},"然后我发现 6.26 我的那个解决方案过于复杂，原先写的认证脚本完全可以胜任这项工作，之前失败的原因是因为我在朝晖抓的脚本参数不适用于屏峰校区，目前已经修复。脚本的变动情况可以看",[20,59,62],{"href":60,"rel":61},"https://gist.github.com/zhullyb/4c8708df5724c42f913d3d86ed49d929/revisions#diff-c33ee93215d3dddc16517dae8107b3473f7abc77f56ff5afedc1f263e7e22b27",[24],"这里","。",[31,65],{},[10,67,68],{},[13,69,70],{},"2023.6.26 Updates:",[10,72,73],{},[74,75,76],"del",{},"在我于 2023 年 6 月 26 日搬去屏峰校区以后，发生了连不上网的情况。目前一个可行的方案: 在 192.168.210.100 将自己的 MAC 地址全部解绑，然后使用自己的一台设备连接网线接口，正常通过网页验证。随后在 192.168.210.100 查看刚才通过网页验证的设备的 MAC 地址，将这一串 MAC 地址复制到 Padavan 的「外部网络（WAN）- MAC 地址」中，且将 l2tp 服务器改为 192.168.115.1 （没错，填朝晖的可以用）并重新连接 l2tp。",[10,78,79],{},[80,81],"img",{"alt":82,"src":83},"MAC 地址设置","https://static.031130.xyz/uploads/2024/08/12/649987173e542.webp",[31,85],{},[10,87,88],{},[80,89],{"alt":90,"src":91},"这是我们上一篇博客的成果","https://static.031130.xyz/uploads/2024/08/12/6496ac4f3170f.webp",[93,94,95],"blockquote",{},[10,96,97,101,102,107],{},[20,98,100],{"href":99},"/2023/06/24/redmi-ac2100-router-with-padavan/","上一篇博客","中，我为 Redmi AC2100 刷入了 Padavan，接下来就打算使用这台路由器进行联网。其实",[20,103,106],{"href":104,"rel":105},"https://static.031130.xyz/uploads/2024/08/12/6496ab42d74bf.webp",[24],"小米大多数路由器都是支持 l2tp 的协议的","，只需要在路由器后台稍微设置一下就能上网，服务器 ip 填 192.168.113.1，账号密码就是 hxzha+手机尾号后8位，密码就是手机尾号后6位。我使用 Padavan 是我个人有一些别的官方固件所不能提供的功能。",[109,110,112],"h2",{"id":111},"l2tp-相关设置","l2tp 相关设置",[10,114,115],{},"我们将 WAN 口插上墙壁一侧的网口，左侧菜单栏点击外部网络，将外网连接类型改为 l2tp",[10,117,118],{},[80,119],{"alt":120,"src":121},"外网连接类型","https://static.031130.xyz/uploads/2024/08/12/6496acaf4435b.webp",[10,123,124],{},"DNS 建议前两个填写学校的内网 DNS 地址( 172.16.7.10 ， 172.16.7.30)，最后一个填一个稳定的公共 DNS 即可，由于这一步是可选项，所以就不提供截图了。",[10,126,127],{},"往下拉，设置 l2tp 相关的设置项，只需要设置红色框框内的设置项即可。朝晖的 l2tp 服务器 ip 是 192.168.115.1 ， 屏峰校区是 192.168.113.1 ，这里不要填错了。",[10,129,130],{},[80,131],{"alt":132,"src":133},"Screenshot_20230623_213510.webp","https://static.031130.xyz/uploads/2024/08/12/6496ae85a4d4f.webp",[109,135,136],{"id":136},"网页认证脚本",[93,138,139],{},[10,140,141],{},"做完这些步骤，其实就可以正常上网了，只不过每次断网以后可能都需要重新过一遍验证，所以我专门写了一个脚本去过这个验证。",[10,143,144,145,150],{},"这份脚本我已经开源到 ",[20,146,149],{"href":147,"rel":148},"https://gist.github.com/zhullyb/4c8708df5724c42f913d3d86ed49d929",[24],"github gist"," 了，在顶部填好自己网页认证时的账号密码以后就可以用了。",[10,152,153],{},"顶部 TODO 处要写的账号密码就是那个有图书馆背景的网页认证密码。",[10,155,156],{},[80,157],{"alt":158,"src":159},"","https://static.031130.xyz/uploads/2024/08/12/6506a036d0f55.webp",[161,162,166],"pre",{"className":163,"code":164,"language":165,"meta":158,"style":158},"language-bash shiki shiki-themes one-light one-dark-pro","#!/bin/bash\n\n# Login webpage identify for China Mobile in Zhejiang University of Technology automatically\n# Author: zhullyb\n# Email: zhullyb@outlook.com\n\n\n# TODO: Fill Your Account and Password for 192.168.210.112/192.168.210.111 here\nuser_account=\nuser_password=\n\nif `ip route | grep -q 10.129.0.1`; then\n  gateway=10.129.0.1\nelif `ip route | grep -q 10.136.0.1`; then\n  gateway=10.136.0.1\nfi\n\nif whoami | grep -q \"admin\\|root\" && [ -n \"$gateway\" ]; then\n  route add -net 192.168.210.111 netmask 255.255.255.255 gw ${gateway}\n  route add -net 192.168.210.112 netmask 255.255.255.255 gw ${gateway}\n  route add -net 192.168.210.100 netmask 255.255.255.255 gw ${gateway}\n  route add -net 172.16.0.0 netmask 255.255.0.0 gw ${gateway}\nfi\n\n# 尝试访问内网服务器，如果未通过网页认证则会获得 url 跳转信息，用于判断用户为朝晖校区或屏峰校区，并获取用户 ip\ntest_curl=$(curl -s http://172.16.19.160)\nwlan_user_ip=$(echo ${test_curl} | grep -oE 'wlanuserip=[0-9\\.]+' | grep -oE '[0-9\\.]+')\nwlan_ac_ip=$(echo ${test_curl} | grep -oE 'wlanacip=[0-9\\.]+' | grep -oE '[0-9\\.]+')\nwlan_user_mac=$(echo ${test_curl} | grep -oE 'usermac=[[:xdigit:]-]+' | cut -d'=' -f2 | tr -d '-')\nwlan_ac_name=$(echo ${test_curl} | grep -o \"wlanacname=[^&]*\" | cut -d'=' -f2)\n\n# 朝晖校区宿舍楼内的移动宽带的认证请求\nif echo \"${test_curl}\" | grep -q \"192.168.210.112\"; then \\\ncurl \"http://192.168.210.112:801/eportal/portal/login?callback=dr1003&login_method=1&user_account=%2C0%2C${user_account}%40cmcczhyx&user_password=${user_password}&wlan_user_ip=${wlan_user_ip}&wlan_user_ipv6=&wlan_user_mac=${wlan_user_mac}&wlan_ac_ip=${wlan_ac_ip}&wlan_ac_name=${wlan_ac_name}&jsVersion=4.2.1&terminal_type=1&lang=zh-cn&v=5099&lang=zh\"\n# 屏峰校区宿舍楼内的移动宽带的认证请求\nelif echo \"${test_curl}\" | grep -q \"192.168.210.111\"; then \\\ncurl \"http://192.168.210.111:801/eportal/portal/login?callback=dr1003&login_method=1&user_account=%2C0%2C${user_account}%40cmccpfyx&user_password=${user_password}&wlan_user_ip=${wlan_user_ip}&wlan_user_ipv6=&wlan_user_mac=${wlan_user_mac}&wlan_ac_ip=${wlan_ac_ip}&wlan_ac_name=${wlan_ac_name}&jsVersion=4.2.1&terminal_type=1&lang=zh-cn&v=5099&lang=zh\"\nfi\n","bash",[167,168,169,178,185,191,197,203,208,213,219,230,238,243,284,296,323,333,339,344,383,417,441,465,490,495,500,506,529,571,608,661,701,706,712,749,811,817,849,906],"code",{"__ignoreMap":158},[170,171,174],"span",{"class":172,"line":173},"line",1,[170,175,177],{"class":176},"sW2Sy","#!/bin/bash\n",[170,179,181],{"class":172,"line":180},2,[170,182,184],{"emptyLinePlaceholder":183},true,"\n",[170,186,188],{"class":172,"line":187},3,[170,189,190],{"class":176},"# Login webpage identify for China Mobile in Zhejiang University of Technology automatically\n",[170,192,194],{"class":172,"line":193},4,[170,195,196],{"class":176},"# Author: zhullyb\n",[170,198,200],{"class":172,"line":199},5,[170,201,202],{"class":176},"# Email: zhullyb@outlook.com\n",[170,204,206],{"class":172,"line":205},6,[170,207,184],{"emptyLinePlaceholder":183},[170,209,211],{"class":172,"line":210},7,[170,212,184],{"emptyLinePlaceholder":183},[170,214,216],{"class":172,"line":215},8,[170,217,218],{"class":176},"# TODO: Fill Your Account and Password for 192.168.210.112/192.168.210.111 here\n",[170,220,222,226],{"class":172,"line":221},9,[170,223,225],{"class":224},"sJa8x","user_account",[170,227,229],{"class":228},"sknuh","=\n",[170,231,233,236],{"class":172,"line":232},10,[170,234,235],{"class":224},"user_password",[170,237,229],{"class":228},[170,239,241],{"class":172,"line":240},11,[170,242,184],{"emptyLinePlaceholder":183},[170,244,246,250,254,258,261,265,268,272,275,278,281],{"class":172,"line":245},12,[170,247,249],{"class":248},"sLKXg","if",[170,251,253],{"class":252},"sDhpE"," `",[170,255,257],{"class":256},"sAdtL","ip",[170,259,260],{"class":252}," route ",[170,262,264],{"class":263},"s5ixo","|",[170,266,267],{"class":256}," grep",[170,269,271],{"class":270},"sAGMh"," -q",[170,273,274],{"class":270}," 10.129.0.1",[170,276,277],{"class":252},"`",[170,279,280],{"class":263},"; ",[170,282,283],{"class":248},"then\n",[170,285,287,290,293],{"class":172,"line":286},13,[170,288,289],{"class":224},"  gateway",[170,291,292],{"class":228},"=",[170,294,295],{"class":252},"10.129.0.1\n",[170,297,299,302,304,306,308,310,312,314,317,319,321],{"class":172,"line":298},14,[170,300,301],{"class":248},"elif",[170,303,253],{"class":252},[170,305,257],{"class":256},[170,307,260],{"class":252},[170,309,264],{"class":263},[170,311,267],{"class":256},[170,313,271],{"class":270},[170,315,316],{"class":270}," 10.136.0.1",[170,318,277],{"class":252},[170,320,280],{"class":263},[170,322,283],{"class":248},[170,324,326,328,330],{"class":172,"line":325},15,[170,327,289],{"class":224},[170,329,292],{"class":228},[170,331,332],{"class":252},"10.136.0.1\n",[170,334,336],{"class":172,"line":335},16,[170,337,338],{"class":248},"fi\n",[170,340,342],{"class":172,"line":341},17,[170,343,184],{"emptyLinePlaceholder":183},[170,345,347,349,352,355,358,360,363,366,369,372,375,378,381],{"class":172,"line":346},18,[170,348,249],{"class":248},[170,350,351],{"class":256}," whoami",[170,353,354],{"class":263}," | ",[170,356,357],{"class":256},"grep",[170,359,271],{"class":270},[170,361,362],{"class":252}," \"admin\\|root\"",[170,364,365],{"class":263}," && [ ",[170,367,368],{"class":228},"-n",[170,370,371],{"class":252}," \"",[170,373,374],{"class":224},"$gateway",[170,376,377],{"class":252},"\"",[170,379,380],{"class":263}," ]; ",[170,382,283],{"class":248},[170,384,386,389,392,395,398,401,404,407,411,414],{"class":172,"line":385},19,[170,387,388],{"class":256},"  route",[170,390,391],{"class":252}," add",[170,393,394],{"class":270}," -net",[170,396,397],{"class":270}," 192.168.210.111",[170,399,400],{"class":252}," netmask",[170,402,403],{"class":270}," 255.255.255.255",[170,405,406],{"class":252}," gw",[170,408,410],{"class":409},"sr1Ac"," ${",[170,412,413],{"class":224},"gateway",[170,415,416],{"class":409},"}\n",[170,418,420,422,424,426,429,431,433,435,437,439],{"class":172,"line":419},20,[170,421,388],{"class":256},[170,423,391],{"class":252},[170,425,394],{"class":270},[170,427,428],{"class":270}," 192.168.210.112",[170,430,400],{"class":252},[170,432,403],{"class":270},[170,434,406],{"class":252},[170,436,410],{"class":409},[170,438,413],{"class":224},[170,440,416],{"class":409},[170,442,444,446,448,450,453,455,457,459,461,463],{"class":172,"line":443},21,[170,445,388],{"class":256},[170,447,391],{"class":252},[170,449,394],{"class":270},[170,451,452],{"class":270}," 192.168.210.100",[170,454,400],{"class":252},[170,456,403],{"class":270},[170,458,406],{"class":252},[170,460,410],{"class":409},[170,462,413],{"class":224},[170,464,416],{"class":409},[170,466,468,470,472,474,477,479,482,484,486,488],{"class":172,"line":467},22,[170,469,388],{"class":256},[170,471,391],{"class":252},[170,473,394],{"class":270},[170,475,476],{"class":270}," 172.16.0.0",[170,478,400],{"class":252},[170,480,481],{"class":270}," 255.255.0.0",[170,483,406],{"class":252},[170,485,410],{"class":409},[170,487,413],{"class":224},[170,489,416],{"class":409},[170,491,493],{"class":172,"line":492},23,[170,494,338],{"class":248},[170,496,498],{"class":172,"line":497},24,[170,499,184],{"emptyLinePlaceholder":183},[170,501,503],{"class":172,"line":502},25,[170,504,505],{"class":176},"# 尝试访问内网服务器，如果未通过网页认证则会获得 url 跳转信息，用于判断用户为朝晖校区或屏峰校区，并获取用户 ip\n",[170,507,509,512,514,517,520,523,526],{"class":172,"line":508},26,[170,510,511],{"class":224},"test_curl",[170,513,292],{"class":228},[170,515,516],{"class":263},"$(",[170,518,519],{"class":256},"curl",[170,521,522],{"class":270}," -s",[170,524,525],{"class":252}," http://172.16.19.160",[170,527,528],{"class":263},")\n",[170,530,532,535,537,539,543,545,547,550,552,554,557,560,562,564,566,569],{"class":172,"line":531},27,[170,533,534],{"class":224},"wlan_user_ip",[170,536,292],{"class":228},[170,538,516],{"class":263},[170,540,542],{"class":541},"s_Sar","echo",[170,544,410],{"class":409},[170,546,511],{"class":224},[170,548,549],{"class":409},"}",[170,551,354],{"class":263},[170,553,357],{"class":256},[170,555,556],{"class":270}," -oE",[170,558,559],{"class":252}," 'wlanuserip=[0-9\\.]+'",[170,561,354],{"class":263},[170,563,357],{"class":256},[170,565,556],{"class":270},[170,567,568],{"class":252}," '[0-9\\.]+'",[170,570,528],{"class":263},[170,572,574,577,579,581,583,585,587,589,591,593,595,598,600,602,604,606],{"class":172,"line":573},28,[170,575,576],{"class":224},"wlan_ac_ip",[170,578,292],{"class":228},[170,580,516],{"class":263},[170,582,542],{"class":541},[170,584,410],{"class":409},[170,586,511],{"class":224},[170,588,549],{"class":409},[170,590,354],{"class":263},[170,592,357],{"class":256},[170,594,556],{"class":270},[170,596,597],{"class":252}," 'wlanacip=[0-9\\.]+'",[170,599,354],{"class":263},[170,601,357],{"class":256},[170,603,556],{"class":270},[170,605,568],{"class":252},[170,607,528],{"class":263},[170,609,611,614,616,618,620,622,624,626,628,630,632,635,637,640,643,646,649,651,654,656,659],{"class":172,"line":610},29,[170,612,613],{"class":224},"wlan_user_mac",[170,615,292],{"class":228},[170,617,516],{"class":263},[170,619,542],{"class":541},[170,621,410],{"class":409},[170,623,511],{"class":224},[170,625,549],{"class":409},[170,627,354],{"class":263},[170,629,357],{"class":256},[170,631,556],{"class":270},[170,633,634],{"class":252}," 'usermac=[[:xdigit:]-]+'",[170,636,354],{"class":263},[170,638,639],{"class":256},"cut",[170,641,642],{"class":270}," -d",[170,644,645],{"class":252},"'='",[170,647,648],{"class":270}," -f2",[170,650,354],{"class":263},[170,652,653],{"class":256},"tr",[170,655,642],{"class":270},[170,657,658],{"class":252}," '-'",[170,660,528],{"class":263},[170,662,664,667,669,671,673,675,677,679,681,683,686,689,691,693,695,697,699],{"class":172,"line":663},30,[170,665,666],{"class":224},"wlan_ac_name",[170,668,292],{"class":228},[170,670,516],{"class":263},[170,672,542],{"class":541},[170,674,410],{"class":409},[170,676,511],{"class":224},[170,678,549],{"class":409},[170,680,354],{"class":263},[170,682,357],{"class":256},[170,684,685],{"class":270}," -o",[170,687,688],{"class":252}," \"wlanacname=[^&]*\"",[170,690,354],{"class":263},[170,692,639],{"class":256},[170,694,642],{"class":270},[170,696,645],{"class":252},[170,698,648],{"class":270},[170,700,528],{"class":263},[170,702,704],{"class":172,"line":703},31,[170,705,184],{"emptyLinePlaceholder":183},[170,707,709],{"class":172,"line":708},32,[170,710,711],{"class":176},"# 朝晖校区宿舍楼内的移动宽带的认证请求\n",[170,713,715,717,720,722,726,728,730,732,734,736,738,741,743,746],{"class":172,"line":714},33,[170,716,249],{"class":248},[170,718,719],{"class":541}," echo",[170,721,371],{"class":252},[170,723,725],{"class":724},"sTIpt","${",[170,727,511],{"class":224},[170,729,549],{"class":724},[170,731,377],{"class":252},[170,733,354],{"class":263},[170,735,357],{"class":256},[170,737,271],{"class":270},[170,739,740],{"class":252}," \"192.168.210.112\"",[170,742,280],{"class":263},[170,744,745],{"class":248},"then",[170,747,748],{"class":541}," \\\n",[170,750,752,754,757,759,761,763,766,768,770,772,775,777,779,781,784,786,788,790,793,795,797,799,802,804,806,808],{"class":172,"line":751},34,[170,753,519],{"class":256},[170,755,756],{"class":252}," \"http://192.168.210.112:801/eportal/portal/login?callback=dr1003&login_method=1&user_account=%2C0%2C",[170,758,725],{"class":724},[170,760,225],{"class":224},[170,762,549],{"class":724},[170,764,765],{"class":252},"%40cmcczhyx&user_password=",[170,767,725],{"class":724},[170,769,235],{"class":224},[170,771,549],{"class":724},[170,773,774],{"class":252},"&wlan_user_ip=",[170,776,725],{"class":724},[170,778,534],{"class":224},[170,780,549],{"class":724},[170,782,783],{"class":252},"&wlan_user_ipv6=&wlan_user_mac=",[170,785,725],{"class":724},[170,787,613],{"class":224},[170,789,549],{"class":724},[170,791,792],{"class":252},"&wlan_ac_ip=",[170,794,725],{"class":724},[170,796,576],{"class":224},[170,798,549],{"class":724},[170,800,801],{"class":252},"&wlan_ac_name=",[170,803,725],{"class":724},[170,805,666],{"class":224},[170,807,549],{"class":724},[170,809,810],{"class":252},"&jsVersion=4.2.1&terminal_type=1&lang=zh-cn&v=5099&lang=zh\"\n",[170,812,814],{"class":172,"line":813},35,[170,815,816],{"class":176},"# 屏峰校区宿舍楼内的移动宽带的认证请求\n",[170,818,820,822,824,826,828,830,832,834,836,838,840,843,845,847],{"class":172,"line":819},36,[170,821,301],{"class":248},[170,823,719],{"class":541},[170,825,371],{"class":252},[170,827,725],{"class":724},[170,829,511],{"class":224},[170,831,549],{"class":724},[170,833,377],{"class":252},[170,835,354],{"class":263},[170,837,357],{"class":256},[170,839,271],{"class":270},[170,841,842],{"class":252}," \"192.168.210.111\"",[170,844,280],{"class":263},[170,846,745],{"class":248},[170,848,748],{"class":541},[170,850,852,854,857,859,861,863,866,868,870,872,874,876,878,880,882,884,886,888,890,892,894,896,898,900,902,904],{"class":172,"line":851},37,[170,853,519],{"class":256},[170,855,856],{"class":252}," \"http://192.168.210.111:801/eportal/portal/login?callback=dr1003&login_method=1&user_account=%2C0%2C",[170,858,725],{"class":724},[170,860,225],{"class":224},[170,862,549],{"class":724},[170,864,865],{"class":252},"%40cmccpfyx&user_password=",[170,867,725],{"class":724},[170,869,235],{"class":224},[170,871,549],{"class":724},[170,873,774],{"class":252},[170,875,725],{"class":724},[170,877,534],{"class":224},[170,879,549],{"class":724},[170,881,783],{"class":252},[170,883,725],{"class":724},[170,885,613],{"class":224},[170,887,549],{"class":724},[170,889,792],{"class":252},[170,891,725],{"class":724},[170,893,576],{"class":224},[170,895,549],{"class":724},[170,897,801],{"class":252},[170,899,725],{"class":724},[170,901,666],{"class":224},[170,903,549],{"class":724},[170,905,810],{"class":252},[170,907,909],{"class":172,"line":908},38,[170,910,338],{"class":248},[10,912,913],{},"在 Padavan 的设置界面中，我们去打开 ssh 服务",[10,915,916],{},[80,917],{"alt":918,"src":919},"打开 ssh 服务","https://static.031130.xyz/uploads/2024/08/12/6496afd695464.webp",[10,921,922,923,926],{},"在自己的电脑上通过 ssh 连接到路由器的终端 ",[167,924,925],{},"ssh admin@192.168.123.1","，默认密码也是 admin，就和进入 Padavan 后台的默认管理密码一样。",[10,928,929],{},[80,930],{"alt":931,"src":932},"进入路由器终端","https://static.031130.xyz/uploads/2024/08/12/6496b029dfe3f.webp",[10,934,935],{},"看了一下 Padavan 并没有自带 nano 这个方便的 tui 编辑器，只好用自带的 vi 将就一下将认证代码复制到路由器中。",[161,937,939],{"className":163,"code":938,"language":165,"meta":158,"style":158},"vi /etc/storage/login_edu.sh\n",[167,940,941],{"__ignoreMap":158},[170,942,943,946],{"class":172,"line":173},[170,944,945],{"class":256},"vi",[170,947,948],{"class":252}," /etc/storage/login_edu.sh\n",[10,950,951],{},"关于 vi 的使用方法我在这里也不展开讲，我个人也不熟悉这款编辑器。",[10,953,954],{},"将脚本复制进去后，记得输入自己网页认证的账号密码，然后保存离开，给这个脚本赋予 x 权限。",[161,956,958],{"className":163,"code":957,"language":165,"meta":158,"style":158},"chmod a+x /etc/storage/login_edu.sh\n",[167,959,960],{"__ignoreMap":158},[170,961,962,965,968],{"class":172,"line":173},[170,963,964],{"class":256},"chmod",[170,966,967],{"class":252}," a+x",[170,969,948],{"class":252},[10,971,972],{},[80,973],{"alt":974,"src":975},"保存认证脚本","https://static.031130.xyz/uploads/2024/08/12/6496b11b7c541.webp",[10,977,978,979,982],{},"随后运行 ",[167,980,981],{},"crontab -e"," ，设置运行脚本为每天早上 6 点 01 分执行一次（因为工作日凌晨 00:30 断网，早上网络恢复以后有可能会要求你通过网页认证后才能再次联网）",[10,984,985],{},[167,986,987],{},"1 6 * * * /etc/storage/login_edu.sh",[10,989,990],{},[80,991],{"alt":992,"src":993},"设置 crontab","https://static.031130.xyz/uploads/2024/08/12/6496b1132f497.webp",[10,995,996],{},"随后来到路由器的设置界面，设置「在 WAN 上行/下行启动后执行」和「在防火墙规则启动后执行」这两个地方分别调用我们的网页认证脚本，防止因停电、网线接口松动等故障恢复后依然没法联网的问题。图中的 logger 命令是给我自己排错看的，不需要设置。",[10,998,999],{},[80,1000],{"alt":1001,"src":1002},"脚本设置界面","https://static.031130.xyz/uploads/2024/08/12/6496b36585000.webp",[10,1004,1005],{},[80,1006],{"alt":1007,"src":1008},"WAN上下行","https://static.031130.xyz/uploads/2024/08/12/6496b369bbd70.webp",[10,1010,1011],{},[80,1012],{"alt":1013,"src":1014},"防火墙规则","https://static.031130.xyz/uploads/2024/08/12/6496b3703197f.webp",[1016,1017,1018],"style",{},"html pre.shiki code .sW2Sy, html code.shiki .sW2Sy{--shiki-default:#A0A1A7;--shiki-default-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic}html pre.shiki code .sJa8x, html code.shiki .sJa8x{--shiki-default:#E45649;--shiki-dark:#E06C75}html pre.shiki code .sknuh, html code.shiki .sknuh{--shiki-default:#383A42;--shiki-dark:#56B6C2}html pre.shiki code .sLKXg, html code.shiki .sLKXg{--shiki-default:#A626A4;--shiki-dark:#C678DD}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html pre.shiki code .sr1Ac, html code.shiki .sr1Ac{--shiki-default:#E45649;--shiki-dark:#ABB2BF}html pre.shiki code .s_Sar, html code.shiki .s_Sar{--shiki-default:#0184BC;--shiki-dark:#56B6C2}html pre.shiki code .sTIpt, html code.shiki .sTIpt{--shiki-default:#E45649;--shiki-dark:#98C379}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}",{"title":158,"searchDepth":180,"depth":180,"links":1020},[1021,1022],{"id":111,"depth":180,"text":112},{"id":136,"depth":180,"text":136},"2023-06-24 14:30:24","md",{},"/2023/06/24/connect-china-mobile-with-router-in-zjut-dormitory","---\ntitle: 在浙工大宿舍使用路由器连接移动网络(校园网)\ndate: 2023-06-24 14:30:24\nsticky:\ntags:\n- Network\n- Router\n---\n\n**2025.09.01 Updates:**\n\n最近看到这篇博客的热度还挺高，应该是最近新生开学有不少都在看。但移动的认证方式于今年的 8 月 15 日发生了变更，具体可以看[这篇微信公众号文章](https://mp.weixin.qq.com/s/KtaP62A3h96FETerPdnQmw)。我近期不在学校，没有环境去研究新的认证方式，但据我身边的人说不再需要什么 l2tp 了，找台常见的路由器直接走 dhcp 以后过一遍网页验证就好了。\n\n祝各位新生在工大能渡过愉快的四年！\n\n***\n\n**2024.04.09 Updates:**\n\n几天前移动对网页认证的页面进行了更新，原有的脚本失效，本博客已更新适配新版网页认证的脚本。\n\n***\n\n**2023.7.10 Updates:**\n\n首先，**搬到屏峰校区以后，l2tp 服务器确实依然为 192.168.115.1**，这点挺奇怪的。\n\n然后我发现 6.26 我的那个解决方案过于复杂，原先写的认证脚本完全可以胜任这项工作，之前失败的原因是因为我在朝晖抓的脚本参数不适用于屏峰校区，目前已经修复。脚本的变动情况可以看[这里](https://gist.github.com/zhullyb/4c8708df5724c42f913d3d86ed49d929/revisions#diff-c33ee93215d3dddc16517dae8107b3473f7abc77f56ff5afedc1f263e7e22b27)。\n\n***\n\n**2023.6.26 Updates:** \n\n~~在我于 2023 年 6 月 26 日搬去屏峰校区以后，发生了连不上网的情况。目前一个可行的方案: 在 192.168.210.100 将自己的 MAC 地址全部解绑，然后使用自己的一台设备连接网线接口，正常通过网页验证。随后在 192.168.210.100 查看刚才通过网页验证的设备的 MAC 地址，将这一串 MAC 地址复制到 Padavan 的「外部网络（WAN）- MAC 地址」中，且将 l2tp 服务器改为 192.168.115.1 （没错，填朝晖的可以用）并重新连接 l2tp。~~\n\n![MAC 地址设置](https://static.031130.xyz/uploads/2024/08/12/649987173e542.webp)\n\n***\n\n![这是我们上一篇博客的成果](https://static.031130.xyz/uploads/2024/08/12/6496ac4f3170f.webp)\n\n> [上一篇博客](/2023/06/24/redmi-ac2100-router-with-padavan/)中，我为 Redmi AC2100 刷入了 Padavan，接下来就打算使用这台路由器进行联网。其实[小米大多数路由器都是支持 l2tp 的协议的](https://static.031130.xyz/uploads/2024/08/12/6496ab42d74bf.webp)，只需要在路由器后台稍微设置一下就能上网，服务器 ip 填 192.168.113.1，账号密码就是 hxzha+手机尾号后8位，密码就是手机尾号后6位。我使用 Padavan 是我个人有一些别的官方固件所不能提供的功能。\n\n## l2tp 相关设置\n\n我们将 WAN 口插上墙壁一侧的网口，左侧菜单栏点击外部网络，将外网连接类型改为 l2tp\n\n![外网连接类型](https://static.031130.xyz/uploads/2024/08/12/6496acaf4435b.webp)\n\nDNS 建议前两个填写学校的内网 DNS 地址( 172.16.7.10 ， 172.16.7.30)，最后一个填一个稳定的公共 DNS 即可，由于这一步是可选项，所以就不提供截图了。\n\n往下拉，设置 l2tp 相关的设置项，只需要设置红色框框内的设置项即可。朝晖的 l2tp 服务器 ip 是 192.168.115.1 ， 屏峰校区是 192.168.113.1 ，这里不要填错了。\n\n![Screenshot_20230623_213510.webp](https://static.031130.xyz/uploads/2024/08/12/6496ae85a4d4f.webp)\n\n## 网页认证脚本\n\n> 做完这些步骤，其实就可以正常上网了，只不过每次断网以后可能都需要重新过一遍验证，所以我专门写了一个脚本去过这个验证。\n\n这份脚本我已经开源到 [github gist](https://gist.github.com/zhullyb/4c8708df5724c42f913d3d86ed49d929) 了，在顶部填好自己网页认证时的账号密码以后就可以用了。\n\n顶部 TODO 处要写的账号密码就是那个有图书馆背景的网页认证密码。\n\n![](https://static.031130.xyz/uploads/2024/08/12/6506a036d0f55.webp)\n\n```bash\n#!/bin/bash\n\n# Login webpage identify for China Mobile in Zhejiang University of Technology automatically\n# Author: zhullyb\n# Email: zhullyb@outlook.com\n\n\n# TODO: Fill Your Account and Password for 192.168.210.112/192.168.210.111 here\nuser_account=\nuser_password=\n\nif `ip route | grep -q 10.129.0.1`; then\n  gateway=10.129.0.1\nelif `ip route | grep -q 10.136.0.1`; then\n  gateway=10.136.0.1\nfi\n\nif whoami | grep -q \"admin\\|root\" && [ -n \"$gateway\" ]; then\n  route add -net 192.168.210.111 netmask 255.255.255.255 gw ${gateway}\n  route add -net 192.168.210.112 netmask 255.255.255.255 gw ${gateway}\n  route add -net 192.168.210.100 netmask 255.255.255.255 gw ${gateway}\n  route add -net 172.16.0.0 netmask 255.255.0.0 gw ${gateway}\nfi\n\n# 尝试访问内网服务器，如果未通过网页认证则会获得 url 跳转信息，用于判断用户为朝晖校区或屏峰校区，并获取用户 ip\ntest_curl=$(curl -s http://172.16.19.160)\nwlan_user_ip=$(echo ${test_curl} | grep -oE 'wlanuserip=[0-9\\.]+' | grep -oE '[0-9\\.]+')\nwlan_ac_ip=$(echo ${test_curl} | grep -oE 'wlanacip=[0-9\\.]+' | grep -oE '[0-9\\.]+')\nwlan_user_mac=$(echo ${test_curl} | grep -oE 'usermac=[[:xdigit:]-]+' | cut -d'=' -f2 | tr -d '-')\nwlan_ac_name=$(echo ${test_curl} | grep -o \"wlanacname=[^&]*\" | cut -d'=' -f2)\n\n# 朝晖校区宿舍楼内的移动宽带的认证请求\nif echo \"${test_curl}\" | grep -q \"192.168.210.112\"; then \\\ncurl \"http://192.168.210.112:801/eportal/portal/login?callback=dr1003&login_method=1&user_account=%2C0%2C${user_account}%40cmcczhyx&user_password=${user_password}&wlan_user_ip=${wlan_user_ip}&wlan_user_ipv6=&wlan_user_mac=${wlan_user_mac}&wlan_ac_ip=${wlan_ac_ip}&wlan_ac_name=${wlan_ac_name}&jsVersion=4.2.1&terminal_type=1&lang=zh-cn&v=5099&lang=zh\"\n# 屏峰校区宿舍楼内的移动宽带的认证请求\nelif echo \"${test_curl}\" | grep -q \"192.168.210.111\"; then \\\ncurl \"http://192.168.210.111:801/eportal/portal/login?callback=dr1003&login_method=1&user_account=%2C0%2C${user_account}%40cmccpfyx&user_password=${user_password}&wlan_user_ip=${wlan_user_ip}&wlan_user_ipv6=&wlan_user_mac=${wlan_user_mac}&wlan_ac_ip=${wlan_ac_ip}&wlan_ac_name=${wlan_ac_name}&jsVersion=4.2.1&terminal_type=1&lang=zh-cn&v=5099&lang=zh\"\nfi\n```\n\n在 Padavan 的设置界面中，我们去打开 ssh 服务\n\n![打开 ssh 服务](https://static.031130.xyz/uploads/2024/08/12/6496afd695464.webp)\n\n在自己的电脑上通过 ssh 连接到路由器的终端 `ssh admin@192.168.123.1`，默认密码也是 admin，就和进入 Padavan 后台的默认管理密码一样。\n\n![进入路由器终端](https://static.031130.xyz/uploads/2024/08/12/6496b029dfe3f.webp)\n\n看了一下 Padavan 并没有自带 nano 这个方便的 tui 编辑器，只好用自带的 vi 将就一下将认证代码复制到路由器中。\n\n```bash\nvi /etc/storage/login_edu.sh\n```\n\n关于 vi 的使用方法我在这里也不展开讲，我个人也不熟悉这款编辑器。\n\n将脚本复制进去后，记得输入自己网页认证的账号密码，然后保存离开，给这个脚本赋予 x 权限。\n\n```bash\nchmod a+x /etc/storage/login_edu.sh\n```\n\n![保存认证脚本](https://static.031130.xyz/uploads/2024/08/12/6496b11b7c541.webp)\n\n随后运行 `crontab -e` ，设置运行脚本为每天早上 6 点 01 分执行一次（因为工作日凌晨 00:30 断网，早上网络恢复以后有可能会要求你通过网页认证后才能再次联网）\n\n`1 6 * * * /etc/storage/login_edu.sh`\n\n![设置 crontab](https://static.031130.xyz/uploads/2024/08/12/6496b1132f497.webp)\n\n随后来到路由器的设置界面，设置「在 WAN 上行/下行启动后执行」和「在防火墙规则启动后执行」这两个地方分别调用我们的网页认证脚本，防止因停电、网线接口松动等故障恢复后依然没法联网的问题。图中的 logger 命令是给我自己排错看的，不需要设置。\n\n![脚本设置界面](https://static.031130.xyz/uploads/2024/08/12/6496b36585000.webp)\n\n![WAN上下行](https://static.031130.xyz/uploads/2024/08/12/6496b369bbd70.webp)\n\n![防火墙规则](https://static.031130.xyz/uploads/2024/08/12/6496b3703197f.webp)\n",{"title":5,"description":15},"posts/connect-china-mobile-with-router-in-zjut-dormitory",false,[1032,1033],"Network","Router","b8VtIDYYufv53i1JpkrhKmOf4x_KEXoPuomZvIpLyvM",[1036,1041],{"title":1037,"path":1038,"stem":1039,"date":1040,"children":-1},"在运行OpenWRT的N1盒子上部署 QQBot","/2023/07/31/run-qq-bot-on-phicomm-n1-openwrt","posts/run-qq-bot-on-phicomm-n1-openwrt","2023-07-31 04:11:31",{"title":1042,"path":1043,"stem":1044,"date":1045,"children":-1},"为红米 Redmi AC2100 路由器刷入 Padavan","/2023/06/24/redmi-ac2100-router-with-padavan","posts/redmi-ac2100-router-with-padavan","2023-06-24 00:22:53",1761897610880]
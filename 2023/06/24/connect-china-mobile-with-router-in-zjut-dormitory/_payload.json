[{"data":1,"prerenderedAt":951},["ShallowReactive",2],{"post-2023-06-24-connect-china-mobile-with-router-in-zjut-dormitory":3,"surround-2023-06-24-connect-china-mobile-with-router-in-zjut-dormitory":940,"randomIndex/2023/06/24/connect-china-mobile-with-router-in-zjut-dormitory/":449},{"id":4,"title":5,"body":6,"date":928,"description":15,"extension":929,"meta":930,"navigation":183,"path":931,"rawbody":932,"seo":933,"stem":934,"sticky":935,"tags":936,"__hash__":939},"posts/posts/connect-china-mobile-with-router-in-zjut-dormitory.md","在浙工大宿舍使用路由器连接移动网络(校园网)",{"type":7,"value":8,"toc":924},"minimark",[9,16,27,30,33,38,41,43,48,55,64,66,71,77,84,86,92,108,113,116,122,125,128,134,137,142,151,154,160,816,819,825,832,838,841,854,857,860,875,881,888,893,899,902,908,914,920],[10,11,12],"p",{},[13,14,15],"strong",{},"2025.09.01 Updates:",[10,17,18,19,26],{},"最近看到这篇博客的热度还挺高，应该是最近新生开学有不少都在看。但移动的认证方式于今年的 8 月 15 日发生了变更，具体可以看",[20,21,25],"a",{"href":22,"rel":23},"https://mp.weixin.qq.com/s/KtaP62A3h96FETerPdnQmw",[24],"nofollow","这篇微信公众号文章","。我近期不在学校，没有环境去研究新的认证方式，但据我身边的人说不再需要什么 l2tp 了，找台常见的路由器直接走 dhcp 以后过一遍网页验证就好了。",[10,28,29],{},"祝各位新生在工大能渡过愉快的四年！",[31,32],"hr",{},[10,34,35],{},[13,36,37],{},"2024.04.09 Updates:",[10,39,40],{},"几天前移动对网页认证的页面进行了更新，原有的脚本失效，本博客已更新适配新版网页认证的脚本。",[31,42],{},[10,44,45],{},[13,46,47],{},"2023.7.10 Updates:",[10,49,50,51,54],{},"首先，",[13,52,53],{},"搬到屏峰校区以后，l2tp 服务器确实依然为 192.168.115.1","，这点挺奇怪的。",[10,56,57,58,63],{},"然后我发现 6.26 我的那个解决方案过于复杂，原先写的认证脚本完全可以胜任这项工作，之前失败的原因是因为我在朝晖抓的脚本参数不适用于屏峰校区，目前已经修复。脚本的变动情况可以看",[20,59,62],{"href":60,"rel":61},"https://gist.github.com/zhullyb/4c8708df5724c42f913d3d86ed49d929/revisions#diff-c33ee93215d3dddc16517dae8107b3473f7abc77f56ff5afedc1f263e7e22b27",[24],"这里","。",[31,65],{},[10,67,68],{},[13,69,70],{},"2023.6.26 Updates:",[10,72,73],{},[74,75,76],"del",{},"在我于 2023 年 6 月 26 日搬去屏峰校区以后，发生了连不上网的情况。目前一个可行的方案: 在 192.168.210.100 将自己的 MAC 地址全部解绑，然后使用自己的一台设备连接网线接口，正常通过网页验证。随后在 192.168.210.100 查看刚才通过网页验证的设备的 MAC 地址，将这一串 MAC 地址复制到 Padavan 的「外部网络（WAN）- MAC 地址」中，且将 l2tp 服务器改为 192.168.115.1 （没错，填朝晖的可以用）并重新连接 l2tp。",[10,78,79],{},[80,81],"img",{"alt":82,"src":83},"MAC 地址设置","https://static.031130.xyz/uploads/2024/08/12/649987173e542.webp",[31,85],{},[10,87,88],{},[80,89],{"alt":90,"src":91},"这是我们上一篇博客的成果","https://static.031130.xyz/uploads/2024/08/12/6496ac4f3170f.webp",[93,94,95],"blockquote",{},[10,96,97,101,102,107],{},[20,98,100],{"href":99},"/2023/06/24/redmi-ac2100-router-with-padavan/","上一篇博客","中，我为 Redmi AC2100 刷入了 Padavan，接下来就打算使用这台路由器进行联网。其实",[20,103,106],{"href":104,"rel":105},"https://static.031130.xyz/uploads/2024/08/12/6496ab42d74bf.webp",[24],"小米大多数路由器都是支持 l2tp 的协议的","，只需要在路由器后台稍微设置一下就能上网，服务器 ip 填 192.168.113.1，账号密码就是 hxzha+手机尾号后8位，密码就是手机尾号后6位。我使用 Padavan 是我个人有一些别的官方固件所不能提供的功能。",[109,110,112],"h2",{"id":111},"l2tp-相关设置","l2tp 相关设置",[10,114,115],{},"我们将 WAN 口插上墙壁一侧的网口，左侧菜单栏点击外部网络，将外网连接类型改为 l2tp",[10,117,118],{},[80,119],{"alt":120,"src":121},"外网连接类型","https://static.031130.xyz/uploads/2024/08/12/6496acaf4435b.webp",[10,123,124],{},"DNS 建议前两个填写学校的内网 DNS 地址( 172.16.7.10 ， 172.16.7.30)，最后一个填一个稳定的公共 DNS 即可，由于这一步是可选项，所以就不提供截图了。",[10,126,127],{},"往下拉，设置 l2tp 相关的设置项，只需要设置红色框框内的设置项即可。朝晖的 l2tp 服务器 ip 是 192.168.115.1 ， 屏峰校区是 192.168.113.1 ，这里不要填错了。",[10,129,130],{},[80,131],{"alt":132,"src":133},"Screenshot_20230623_213510.webp","https://static.031130.xyz/uploads/2024/08/12/6496ae85a4d4f.webp",[109,135,136],{"id":136},"网页认证脚本",[93,138,139],{},[10,140,141],{},"做完这些步骤，其实就可以正常上网了，只不过每次断网以后可能都需要重新过一遍验证，所以我专门写了一个脚本去过这个验证。",[10,143,144,145,150],{},"这份脚本我已经开源到 ",[20,146,149],{"href":147,"rel":148},"https://gist.github.com/zhullyb/4c8708df5724c42f913d3d86ed49d929",[24],"github gist"," 了，在顶部填好自己网页认证时的账号密码以后就可以用了。",[10,152,153],{},"顶部 TODO 处要写的账号密码就是那个有图书馆背景的网页认证密码。",[10,155,156],{},[80,157],{"alt":158,"src":159},"","https://static.031130.xyz/uploads/2024/08/12/6506a036d0f55.webp",[161,162,166],"pre",{"className":163,"code":164,"language":165,"meta":158,"style":158},"language-bash shiki shiki-themes github-light github-dark","#!/bin/bash\n\n# Login webpage identify for China Mobile in Zhejiang University of Technology automatically\n# Author: zhullyb\n# Email: zhullyb@outlook.com\n\n\n# TODO: Fill Your Account and Password for 192.168.210.112/192.168.210.111 here\nuser_account=\nuser_password=\n\nif `ip route | grep -q 10.129.0.1`; then\n  gateway=10.129.0.1\nelif `ip route | grep -q 10.136.0.1`; then\n  gateway=10.136.0.1\nfi\n\nif whoami | grep -q \"admin\\|root\" && [ -n \"$gateway\" ]; then\n  route add -net 192.168.210.111 netmask 255.255.255.255 gw ${gateway}\n  route add -net 192.168.210.112 netmask 255.255.255.255 gw ${gateway}\n  route add -net 192.168.210.100 netmask 255.255.255.255 gw ${gateway}\n  route add -net 172.16.0.0 netmask 255.255.0.0 gw ${gateway}\nfi\n\n# 尝试访问内网服务器，如果未通过网页认证则会获得 url 跳转信息，用于判断用户为朝晖校区或屏峰校区，并获取用户 ip\ntest_curl=$(curl -s http://172.16.19.160)\nwlan_user_ip=$(echo ${test_curl} | grep -oE 'wlanuserip=[0-9\\.]+' | grep -oE '[0-9\\.]+')\nwlan_ac_ip=$(echo ${test_curl} | grep -oE 'wlanacip=[0-9\\.]+' | grep -oE '[0-9\\.]+')\nwlan_user_mac=$(echo ${test_curl} | grep -oE 'usermac=[[:xdigit:]-]+' | cut -d'=' -f2 | tr -d '-')\nwlan_ac_name=$(echo ${test_curl} | grep -o \"wlanacname=[^&]*\" | cut -d'=' -f2)\n\n# 朝晖校区宿舍楼内的移动宽带的认证请求\nif echo \"${test_curl}\" | grep -q \"192.168.210.112\"; then \\\ncurl \"http://192.168.210.112:801/eportal/portal/login?callback=dr1003&login_method=1&user_account=%2C0%2C${user_account}%40cmcczhyx&user_password=${user_password}&wlan_user_ip=${wlan_user_ip}&wlan_user_ipv6=&wlan_user_mac=${wlan_user_mac}&wlan_ac_ip=${wlan_ac_ip}&wlan_ac_name=${wlan_ac_name}&jsVersion=4.2.1&terminal_type=1&lang=zh-cn&v=5099&lang=zh\"\n# 屏峰校区宿舍楼内的移动宽带的认证请求\nelif echo \"${test_curl}\" | grep -q \"192.168.210.111\"; then \\\ncurl \"http://192.168.210.111:801/eportal/portal/login?callback=dr1003&login_method=1&user_account=%2C0%2C${user_account}%40cmccpfyx&user_password=${user_password}&wlan_user_ip=${wlan_user_ip}&wlan_user_ipv6=&wlan_user_mac=${wlan_user_mac}&wlan_ac_ip=${wlan_ac_ip}&wlan_ac_name=${wlan_ac_name}&jsVersion=4.2.1&terminal_type=1&lang=zh-cn&v=5099&lang=zh\"\nfi\n","bash",[167,168,169,178,185,191,197,203,208,213,219,230,238,243,282,294,321,331,337,342,380,407,427,447,468,473,478,484,507,544,577,626,662,667,673,706,744,750,778,811],"code",{"__ignoreMap":158},[170,171,174],"span",{"class":172,"line":173},"line",1,[170,175,177],{"class":176},"sJ8bj","#!/bin/bash\n",[170,179,181],{"class":172,"line":180},2,[170,182,184],{"emptyLinePlaceholder":183},true,"\n",[170,186,188],{"class":172,"line":187},3,[170,189,190],{"class":176},"# Login webpage identify for China Mobile in Zhejiang University of Technology automatically\n",[170,192,194],{"class":172,"line":193},4,[170,195,196],{"class":176},"# Author: zhullyb\n",[170,198,200],{"class":172,"line":199},5,[170,201,202],{"class":176},"# Email: zhullyb@outlook.com\n",[170,204,206],{"class":172,"line":205},6,[170,207,184],{"emptyLinePlaceholder":183},[170,209,211],{"class":172,"line":210},7,[170,212,184],{"emptyLinePlaceholder":183},[170,214,216],{"class":172,"line":215},8,[170,217,218],{"class":176},"# TODO: Fill Your Account and Password for 192.168.210.112/192.168.210.111 here\n",[170,220,222,226],{"class":172,"line":221},9,[170,223,225],{"class":224},"sVt8B","user_account",[170,227,229],{"class":228},"szBVR","=\n",[170,231,233,236],{"class":172,"line":232},10,[170,234,235],{"class":224},"user_password",[170,237,229],{"class":228},[170,239,241],{"class":172,"line":240},11,[170,242,184],{"emptyLinePlaceholder":183},[170,244,246,249,253,257,260,263,266,270,273,276,279],{"class":172,"line":245},12,[170,247,248],{"class":228},"if",[170,250,252],{"class":251},"sZZnC"," `",[170,254,256],{"class":255},"sScJk","ip",[170,258,259],{"class":251}," route ",[170,261,262],{"class":228},"|",[170,264,265],{"class":255}," grep",[170,267,269],{"class":268},"sj4cs"," -q",[170,271,272],{"class":268}," 10.129.0.1",[170,274,275],{"class":251},"`",[170,277,278],{"class":224},"; ",[170,280,281],{"class":228},"then\n",[170,283,285,288,291],{"class":172,"line":284},13,[170,286,287],{"class":224},"  gateway",[170,289,290],{"class":228},"=",[170,292,293],{"class":251},"10.129.0.1\n",[170,295,297,300,302,304,306,308,310,312,315,317,319],{"class":172,"line":296},14,[170,298,299],{"class":228},"elif",[170,301,252],{"class":251},[170,303,256],{"class":255},[170,305,259],{"class":251},[170,307,262],{"class":228},[170,309,265],{"class":255},[170,311,269],{"class":268},[170,313,314],{"class":268}," 10.136.0.1",[170,316,275],{"class":251},[170,318,278],{"class":224},[170,320,281],{"class":228},[170,322,324,326,328],{"class":172,"line":323},15,[170,325,287],{"class":224},[170,327,290],{"class":228},[170,329,330],{"class":251},"10.136.0.1\n",[170,332,334],{"class":172,"line":333},16,[170,335,336],{"class":228},"fi\n",[170,338,340],{"class":172,"line":339},17,[170,341,184],{"emptyLinePlaceholder":183},[170,343,345,347,350,353,355,357,360,363,366,369,372,375,378],{"class":172,"line":344},18,[170,346,248],{"class":228},[170,348,349],{"class":255}," whoami",[170,351,352],{"class":228}," |",[170,354,265],{"class":255},[170,356,269],{"class":268},[170,358,359],{"class":251}," \"admin\\|root\"",[170,361,362],{"class":224}," && [ ",[170,364,365],{"class":228},"-n",[170,367,368],{"class":251}," \"",[170,370,371],{"class":224},"$gateway",[170,373,374],{"class":251},"\"",[170,376,377],{"class":224}," ]; ",[170,379,281],{"class":228},[170,381,383,386,389,392,395,398,401,404],{"class":172,"line":382},19,[170,384,385],{"class":255},"  route",[170,387,388],{"class":251}," add",[170,390,391],{"class":268}," -net",[170,393,394],{"class":268}," 192.168.210.111",[170,396,397],{"class":251}," netmask",[170,399,400],{"class":268}," 255.255.255.255",[170,402,403],{"class":251}," gw",[170,405,406],{"class":224}," ${gateway}\n",[170,408,410,412,414,416,419,421,423,425],{"class":172,"line":409},20,[170,411,385],{"class":255},[170,413,388],{"class":251},[170,415,391],{"class":268},[170,417,418],{"class":268}," 192.168.210.112",[170,420,397],{"class":251},[170,422,400],{"class":268},[170,424,403],{"class":251},[170,426,406],{"class":224},[170,428,430,432,434,436,439,441,443,445],{"class":172,"line":429},21,[170,431,385],{"class":255},[170,433,388],{"class":251},[170,435,391],{"class":268},[170,437,438],{"class":268}," 192.168.210.100",[170,440,397],{"class":251},[170,442,400],{"class":268},[170,444,403],{"class":251},[170,446,406],{"class":224},[170,448,450,452,454,456,459,461,464,466],{"class":172,"line":449},22,[170,451,385],{"class":255},[170,453,388],{"class":251},[170,455,391],{"class":268},[170,457,458],{"class":268}," 172.16.0.0",[170,460,397],{"class":251},[170,462,463],{"class":268}," 255.255.0.0",[170,465,403],{"class":251},[170,467,406],{"class":224},[170,469,471],{"class":172,"line":470},23,[170,472,336],{"class":228},[170,474,476],{"class":172,"line":475},24,[170,477,184],{"emptyLinePlaceholder":183},[170,479,481],{"class":172,"line":480},25,[170,482,483],{"class":176},"# 尝试访问内网服务器，如果未通过网页认证则会获得 url 跳转信息，用于判断用户为朝晖校区或屏峰校区，并获取用户 ip\n",[170,485,487,490,492,495,498,501,504],{"class":172,"line":486},26,[170,488,489],{"class":224},"test_curl",[170,491,290],{"class":228},[170,493,494],{"class":224},"$(",[170,496,497],{"class":255},"curl",[170,499,500],{"class":268}," -s",[170,502,503],{"class":251}," http://172.16.19.160",[170,505,506],{"class":224},")\n",[170,508,510,513,515,517,520,523,525,527,530,533,535,537,539,542],{"class":172,"line":509},27,[170,511,512],{"class":224},"wlan_user_ip",[170,514,290],{"class":228},[170,516,494],{"class":224},[170,518,519],{"class":268},"echo",[170,521,522],{"class":224}," ${test_curl} ",[170,524,262],{"class":228},[170,526,265],{"class":255},[170,528,529],{"class":268}," -oE",[170,531,532],{"class":251}," 'wlanuserip=[0-9\\.]+'",[170,534,352],{"class":228},[170,536,265],{"class":255},[170,538,529],{"class":268},[170,540,541],{"class":251}," '[0-9\\.]+'",[170,543,506],{"class":224},[170,545,547,550,552,554,556,558,560,562,564,567,569,571,573,575],{"class":172,"line":546},28,[170,548,549],{"class":224},"wlan_ac_ip",[170,551,290],{"class":228},[170,553,494],{"class":224},[170,555,519],{"class":268},[170,557,522],{"class":224},[170,559,262],{"class":228},[170,561,265],{"class":255},[170,563,529],{"class":268},[170,565,566],{"class":251}," 'wlanacip=[0-9\\.]+'",[170,568,352],{"class":228},[170,570,265],{"class":255},[170,572,529],{"class":268},[170,574,541],{"class":251},[170,576,506],{"class":224},[170,578,580,583,585,587,589,591,593,595,597,600,602,605,608,611,614,616,619,621,624],{"class":172,"line":579},29,[170,581,582],{"class":224},"wlan_user_mac",[170,584,290],{"class":228},[170,586,494],{"class":224},[170,588,519],{"class":268},[170,590,522],{"class":224},[170,592,262],{"class":228},[170,594,265],{"class":255},[170,596,529],{"class":268},[170,598,599],{"class":251}," 'usermac=[[:xdigit:]-]+'",[170,601,352],{"class":228},[170,603,604],{"class":255}," cut",[170,606,607],{"class":268}," -d",[170,609,610],{"class":251},"'='",[170,612,613],{"class":268}," -f2",[170,615,352],{"class":228},[170,617,618],{"class":255}," tr",[170,620,607],{"class":268},[170,622,623],{"class":251}," '-'",[170,625,506],{"class":224},[170,627,629,632,634,636,638,640,642,644,647,650,652,654,656,658,660],{"class":172,"line":628},30,[170,630,631],{"class":224},"wlan_ac_name",[170,633,290],{"class":228},[170,635,494],{"class":224},[170,637,519],{"class":268},[170,639,522],{"class":224},[170,641,262],{"class":228},[170,643,265],{"class":255},[170,645,646],{"class":268}," -o",[170,648,649],{"class":251}," \"wlanacname=[^&]*\"",[170,651,352],{"class":228},[170,653,604],{"class":255},[170,655,607],{"class":268},[170,657,610],{"class":251},[170,659,613],{"class":268},[170,661,506],{"class":224},[170,663,665],{"class":172,"line":664},31,[170,666,184],{"emptyLinePlaceholder":183},[170,668,670],{"class":172,"line":669},32,[170,671,672],{"class":176},"# 朝晖校区宿舍楼内的移动宽带的认证请求\n",[170,674,676,678,681,684,686,689,691,693,695,698,700,703],{"class":172,"line":675},33,[170,677,248],{"class":228},[170,679,680],{"class":268}," echo",[170,682,683],{"class":251}," \"${",[170,685,489],{"class":224},[170,687,688],{"class":251},"}\"",[170,690,352],{"class":228},[170,692,265],{"class":255},[170,694,269],{"class":268},[170,696,697],{"class":251}," \"192.168.210.112\"",[170,699,278],{"class":224},[170,701,702],{"class":228},"then",[170,704,705],{"class":268}," \\\n",[170,707,709,711,714,716,719,721,724,726,729,731,734,736,739,741],{"class":172,"line":708},34,[170,710,497],{"class":255},[170,712,713],{"class":251}," \"http://192.168.210.112:801/eportal/portal/login?callback=dr1003&login_method=1&user_account=%2C0%2C${",[170,715,225],{"class":224},[170,717,718],{"class":251},"}%40cmcczhyx&user_password=${",[170,720,235],{"class":224},[170,722,723],{"class":251},"}&wlan_user_ip=${",[170,725,512],{"class":224},[170,727,728],{"class":251},"}&wlan_user_ipv6=&wlan_user_mac=${",[170,730,582],{"class":224},[170,732,733],{"class":251},"}&wlan_ac_ip=${",[170,735,549],{"class":224},[170,737,738],{"class":251},"}&wlan_ac_name=${",[170,740,631],{"class":224},[170,742,743],{"class":251},"}&jsVersion=4.2.1&terminal_type=1&lang=zh-cn&v=5099&lang=zh\"\n",[170,745,747],{"class":172,"line":746},35,[170,748,749],{"class":176},"# 屏峰校区宿舍楼内的移动宽带的认证请求\n",[170,751,753,755,757,759,761,763,765,767,769,772,774,776],{"class":172,"line":752},36,[170,754,299],{"class":228},[170,756,680],{"class":268},[170,758,683],{"class":251},[170,760,489],{"class":224},[170,762,688],{"class":251},[170,764,352],{"class":228},[170,766,265],{"class":255},[170,768,269],{"class":268},[170,770,771],{"class":251}," \"192.168.210.111\"",[170,773,278],{"class":224},[170,775,702],{"class":228},[170,777,705],{"class":268},[170,779,781,783,786,788,791,793,795,797,799,801,803,805,807,809],{"class":172,"line":780},37,[170,782,497],{"class":255},[170,784,785],{"class":251}," \"http://192.168.210.111:801/eportal/portal/login?callback=dr1003&login_method=1&user_account=%2C0%2C${",[170,787,225],{"class":224},[170,789,790],{"class":251},"}%40cmccpfyx&user_password=${",[170,792,235],{"class":224},[170,794,723],{"class":251},[170,796,512],{"class":224},[170,798,728],{"class":251},[170,800,582],{"class":224},[170,802,733],{"class":251},[170,804,549],{"class":224},[170,806,738],{"class":251},[170,808,631],{"class":224},[170,810,743],{"class":251},[170,812,814],{"class":172,"line":813},38,[170,815,336],{"class":228},[10,817,818],{},"在 Padavan 的设置界面中，我们去打开 ssh 服务",[10,820,821],{},[80,822],{"alt":823,"src":824},"打开 ssh 服务","https://static.031130.xyz/uploads/2024/08/12/6496afd695464.webp",[10,826,827,828,831],{},"在自己的电脑上通过 ssh 连接到路由器的终端 ",[167,829,830],{},"ssh admin@192.168.123.1","，默认密码也是 admin，就和进入 Padavan 后台的默认管理密码一样。",[10,833,834],{},[80,835],{"alt":836,"src":837},"进入路由器终端","https://static.031130.xyz/uploads/2024/08/12/6496b029dfe3f.webp",[10,839,840],{},"看了一下 Padavan 并没有自带 nano 这个方便的 tui 编辑器，只好用自带的 vi 将就一下将认证代码复制到路由器中。",[161,842,844],{"className":163,"code":843,"language":165,"meta":158,"style":158},"vi /etc/storage/login_edu.sh\n",[167,845,846],{"__ignoreMap":158},[170,847,848,851],{"class":172,"line":173},[170,849,850],{"class":255},"vi",[170,852,853],{"class":251}," /etc/storage/login_edu.sh\n",[10,855,856],{},"关于 vi 的使用方法我在这里也不展开讲，我个人也不熟悉这款编辑器。",[10,858,859],{},"将脚本复制进去后，记得输入自己网页认证的账号密码，然后保存离开，给这个脚本赋予 x 权限。",[161,861,863],{"className":163,"code":862,"language":165,"meta":158,"style":158},"chmod a+x /etc/storage/login_edu.sh\n",[167,864,865],{"__ignoreMap":158},[170,866,867,870,873],{"class":172,"line":173},[170,868,869],{"class":255},"chmod",[170,871,872],{"class":251}," a+x",[170,874,853],{"class":251},[10,876,877],{},[80,878],{"alt":879,"src":880},"保存认证脚本","https://static.031130.xyz/uploads/2024/08/12/6496b11b7c541.webp",[10,882,883,884,887],{},"随后运行 ",[167,885,886],{},"crontab -e"," ，设置运行脚本为每天早上 6 点 01 分执行一次（因为工作日凌晨 00:30 断网，早上网络恢复以后有可能会要求你通过网页认证后才能再次联网）",[10,889,890],{},[167,891,892],{},"1 6 * * * /etc/storage/login_edu.sh",[10,894,895],{},[80,896],{"alt":897,"src":898},"设置 crontab","https://static.031130.xyz/uploads/2024/08/12/6496b1132f497.webp",[10,900,901],{},"随后来到路由器的设置界面，设置「在 WAN 上行/下行启动后执行」和「在防火墙规则启动后执行」这两个地方分别调用我们的网页认证脚本，防止因停电、网线接口松动等故障恢复后依然没法联网的问题。图中的 logger 命令是给我自己排错看的，不需要设置。",[10,903,904],{},[80,905],{"alt":906,"src":907},"脚本设置界面","https://static.031130.xyz/uploads/2024/08/12/6496b36585000.webp",[10,909,910],{},[80,911],{"alt":912,"src":913},"WAN上下行","https://static.031130.xyz/uploads/2024/08/12/6496b369bbd70.webp",[10,915,916],{},[80,917],{"alt":918,"src":919},"防火墙规则","https://static.031130.xyz/uploads/2024/08/12/6496b3703197f.webp",[921,922,923],"style",{},"html pre.shiki code .sJ8bj, html code.shiki .sJ8bj{--shiki-default:#6A737D;--shiki-dark:#6A737D}html pre.shiki code .sVt8B, html code.shiki .sVt8B{--shiki-default:#24292E;--shiki-dark:#E1E4E8}html pre.shiki code .szBVR, html code.shiki .szBVR{--shiki-default:#D73A49;--shiki-dark:#F97583}html pre.shiki code .sZZnC, html code.shiki .sZZnC{--shiki-default:#032F62;--shiki-dark:#9ECBFF}html pre.shiki code .sScJk, html code.shiki .sScJk{--shiki-default:#6F42C1;--shiki-dark:#B392F0}html pre.shiki code .sj4cs, html code.shiki .sj4cs{--shiki-default:#005CC5;--shiki-dark:#79B8FF}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}",{"title":158,"searchDepth":180,"depth":180,"links":925},[926,927],{"id":111,"depth":180,"text":112},{"id":136,"depth":180,"text":136},"2023-06-24 14:30:24","md",{},"/2023/06/24/connect-china-mobile-with-router-in-zjut-dormitory","---\ntitle: 在浙工大宿舍使用路由器连接移动网络(校园网)\ndate: 2023-06-24 14:30:24\nsticky:\ntags:\n- Network\n- Router\n---\n\n**2025.09.01 Updates:**\n\n最近看到这篇博客的热度还挺高，应该是最近新生开学有不少都在看。但移动的认证方式于今年的 8 月 15 日发生了变更，具体可以看[这篇微信公众号文章](https://mp.weixin.qq.com/s/KtaP62A3h96FETerPdnQmw)。我近期不在学校，没有环境去研究新的认证方式，但据我身边的人说不再需要什么 l2tp 了，找台常见的路由器直接走 dhcp 以后过一遍网页验证就好了。\n\n祝各位新生在工大能渡过愉快的四年！\n\n***\n\n**2024.04.09 Updates:**\n\n几天前移动对网页认证的页面进行了更新，原有的脚本失效，本博客已更新适配新版网页认证的脚本。\n\n***\n\n**2023.7.10 Updates:**\n\n首先，**搬到屏峰校区以后，l2tp 服务器确实依然为 192.168.115.1**，这点挺奇怪的。\n\n然后我发现 6.26 我的那个解决方案过于复杂，原先写的认证脚本完全可以胜任这项工作，之前失败的原因是因为我在朝晖抓的脚本参数不适用于屏峰校区，目前已经修复。脚本的变动情况可以看[这里](https://gist.github.com/zhullyb/4c8708df5724c42f913d3d86ed49d929/revisions#diff-c33ee93215d3dddc16517dae8107b3473f7abc77f56ff5afedc1f263e7e22b27)。\n\n***\n\n**2023.6.26 Updates:** \n\n~~在我于 2023 年 6 月 26 日搬去屏峰校区以后，发生了连不上网的情况。目前一个可行的方案: 在 192.168.210.100 将自己的 MAC 地址全部解绑，然后使用自己的一台设备连接网线接口，正常通过网页验证。随后在 192.168.210.100 查看刚才通过网页验证的设备的 MAC 地址，将这一串 MAC 地址复制到 Padavan 的「外部网络（WAN）- MAC 地址」中，且将 l2tp 服务器改为 192.168.115.1 （没错，填朝晖的可以用）并重新连接 l2tp。~~\n\n![MAC 地址设置](https://static.031130.xyz/uploads/2024/08/12/649987173e542.webp)\n\n***\n\n![这是我们上一篇博客的成果](https://static.031130.xyz/uploads/2024/08/12/6496ac4f3170f.webp)\n\n> [上一篇博客](/2023/06/24/redmi-ac2100-router-with-padavan/)中，我为 Redmi AC2100 刷入了 Padavan，接下来就打算使用这台路由器进行联网。其实[小米大多数路由器都是支持 l2tp 的协议的](https://static.031130.xyz/uploads/2024/08/12/6496ab42d74bf.webp)，只需要在路由器后台稍微设置一下就能上网，服务器 ip 填 192.168.113.1，账号密码就是 hxzha+手机尾号后8位，密码就是手机尾号后6位。我使用 Padavan 是我个人有一些别的官方固件所不能提供的功能。\n\n## l2tp 相关设置\n\n我们将 WAN 口插上墙壁一侧的网口，左侧菜单栏点击外部网络，将外网连接类型改为 l2tp\n\n![外网连接类型](https://static.031130.xyz/uploads/2024/08/12/6496acaf4435b.webp)\n\nDNS 建议前两个填写学校的内网 DNS 地址( 172.16.7.10 ， 172.16.7.30)，最后一个填一个稳定的公共 DNS 即可，由于这一步是可选项，所以就不提供截图了。\n\n往下拉，设置 l2tp 相关的设置项，只需要设置红色框框内的设置项即可。朝晖的 l2tp 服务器 ip 是 192.168.115.1 ， 屏峰校区是 192.168.113.1 ，这里不要填错了。\n\n![Screenshot_20230623_213510.webp](https://static.031130.xyz/uploads/2024/08/12/6496ae85a4d4f.webp)\n\n## 网页认证脚本\n\n> 做完这些步骤，其实就可以正常上网了，只不过每次断网以后可能都需要重新过一遍验证，所以我专门写了一个脚本去过这个验证。\n\n这份脚本我已经开源到 [github gist](https://gist.github.com/zhullyb/4c8708df5724c42f913d3d86ed49d929) 了，在顶部填好自己网页认证时的账号密码以后就可以用了。\n\n顶部 TODO 处要写的账号密码就是那个有图书馆背景的网页认证密码。\n\n![](https://static.031130.xyz/uploads/2024/08/12/6506a036d0f55.webp)\n\n```bash\n#!/bin/bash\n\n# Login webpage identify for China Mobile in Zhejiang University of Technology automatically\n# Author: zhullyb\n# Email: zhullyb@outlook.com\n\n\n# TODO: Fill Your Account and Password for 192.168.210.112/192.168.210.111 here\nuser_account=\nuser_password=\n\nif `ip route | grep -q 10.129.0.1`; then\n  gateway=10.129.0.1\nelif `ip route | grep -q 10.136.0.1`; then\n  gateway=10.136.0.1\nfi\n\nif whoami | grep -q \"admin\\|root\" && [ -n \"$gateway\" ]; then\n  route add -net 192.168.210.111 netmask 255.255.255.255 gw ${gateway}\n  route add -net 192.168.210.112 netmask 255.255.255.255 gw ${gateway}\n  route add -net 192.168.210.100 netmask 255.255.255.255 gw ${gateway}\n  route add -net 172.16.0.0 netmask 255.255.0.0 gw ${gateway}\nfi\n\n# 尝试访问内网服务器，如果未通过网页认证则会获得 url 跳转信息，用于判断用户为朝晖校区或屏峰校区，并获取用户 ip\ntest_curl=$(curl -s http://172.16.19.160)\nwlan_user_ip=$(echo ${test_curl} | grep -oE 'wlanuserip=[0-9\\.]+' | grep -oE '[0-9\\.]+')\nwlan_ac_ip=$(echo ${test_curl} | grep -oE 'wlanacip=[0-9\\.]+' | grep -oE '[0-9\\.]+')\nwlan_user_mac=$(echo ${test_curl} | grep -oE 'usermac=[[:xdigit:]-]+' | cut -d'=' -f2 | tr -d '-')\nwlan_ac_name=$(echo ${test_curl} | grep -o \"wlanacname=[^&]*\" | cut -d'=' -f2)\n\n# 朝晖校区宿舍楼内的移动宽带的认证请求\nif echo \"${test_curl}\" | grep -q \"192.168.210.112\"; then \\\ncurl \"http://192.168.210.112:801/eportal/portal/login?callback=dr1003&login_method=1&user_account=%2C0%2C${user_account}%40cmcczhyx&user_password=${user_password}&wlan_user_ip=${wlan_user_ip}&wlan_user_ipv6=&wlan_user_mac=${wlan_user_mac}&wlan_ac_ip=${wlan_ac_ip}&wlan_ac_name=${wlan_ac_name}&jsVersion=4.2.1&terminal_type=1&lang=zh-cn&v=5099&lang=zh\"\n# 屏峰校区宿舍楼内的移动宽带的认证请求\nelif echo \"${test_curl}\" | grep -q \"192.168.210.111\"; then \\\ncurl \"http://192.168.210.111:801/eportal/portal/login?callback=dr1003&login_method=1&user_account=%2C0%2C${user_account}%40cmccpfyx&user_password=${user_password}&wlan_user_ip=${wlan_user_ip}&wlan_user_ipv6=&wlan_user_mac=${wlan_user_mac}&wlan_ac_ip=${wlan_ac_ip}&wlan_ac_name=${wlan_ac_name}&jsVersion=4.2.1&terminal_type=1&lang=zh-cn&v=5099&lang=zh\"\nfi\n```\n\n在 Padavan 的设置界面中，我们去打开 ssh 服务\n\n![打开 ssh 服务](https://static.031130.xyz/uploads/2024/08/12/6496afd695464.webp)\n\n在自己的电脑上通过 ssh 连接到路由器的终端 `ssh admin@192.168.123.1`，默认密码也是 admin，就和进入 Padavan 后台的默认管理密码一样。\n\n![进入路由器终端](https://static.031130.xyz/uploads/2024/08/12/6496b029dfe3f.webp)\n\n看了一下 Padavan 并没有自带 nano 这个方便的 tui 编辑器，只好用自带的 vi 将就一下将认证代码复制到路由器中。\n\n```bash\nvi /etc/storage/login_edu.sh\n```\n\n关于 vi 的使用方法我在这里也不展开讲，我个人也不熟悉这款编辑器。\n\n将脚本复制进去后，记得输入自己网页认证的账号密码，然后保存离开，给这个脚本赋予 x 权限。\n\n```bash\nchmod a+x /etc/storage/login_edu.sh\n```\n\n![保存认证脚本](https://static.031130.xyz/uploads/2024/08/12/6496b11b7c541.webp)\n\n随后运行 `crontab -e` ，设置运行脚本为每天早上 6 点 01 分执行一次（因为工作日凌晨 00:30 断网，早上网络恢复以后有可能会要求你通过网页认证后才能再次联网）\n\n`1 6 * * * /etc/storage/login_edu.sh`\n\n![设置 crontab](https://static.031130.xyz/uploads/2024/08/12/6496b1132f497.webp)\n\n随后来到路由器的设置界面，设置「在 WAN 上行/下行启动后执行」和「在防火墙规则启动后执行」这两个地方分别调用我们的网页认证脚本，防止因停电、网线接口松动等故障恢复后依然没法联网的问题。图中的 logger 命令是给我自己排错看的，不需要设置。\n\n![脚本设置界面](https://static.031130.xyz/uploads/2024/08/12/6496b36585000.webp)\n\n![WAN上下行](https://static.031130.xyz/uploads/2024/08/12/6496b369bbd70.webp)\n\n![防火墙规则](https://static.031130.xyz/uploads/2024/08/12/6496b3703197f.webp)\n",{"title":5,"description":15},"posts/connect-china-mobile-with-router-in-zjut-dormitory",false,[937,938],"Network","Router","zq7aqNQQKwNOomOG3aSI_AtELbW1uNjsS66al95j224",[941,946],{"title":942,"path":943,"stem":944,"date":945,"children":-1},"在运行OpenWRT的N1盒子上部署 QQBot","/2023/07/31/run-qq-bot-on-phicomm-n1-openwrt","posts/run-qq-bot-on-phicomm-n1-openwrt","2023-07-31 04:11:31",{"title":947,"path":948,"stem":949,"date":950,"children":-1},"为红米 Redmi AC2100 路由器刷入 Padavan","/2023/06/24/redmi-ac2100-router-with-padavan","posts/redmi-ac2100-router-with-padavan","2023-06-24 00:22:53",1761699275271]
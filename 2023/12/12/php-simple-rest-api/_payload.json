[{"data":1,"prerenderedAt":3176},["ShallowReactive",2],{"post-2023-12-12-php-simple-rest-api-zh":3,"surround-2023-12-12-php-simple-rest-api-zh":3164,"randomIndex/2023/12/12/php-simple-rest-api/":295,"language-switch-/2023/12/12/php-simple-rest-api/-en":3175},{"id":4,"title":5,"body":6,"date":3151,"description":110,"extension":3152,"lang":3153,"meta":3154,"navigation":267,"path":3155,"rawbody":3156,"seo":3157,"stem":3158,"sticky":3159,"tags":3160,"__hash__":3163},"posts/posts/zh/php-simple-rest-api.md","【翻译】使用 PHP 构建简单的 REST API",{"type":7,"value":8,"toc":3129},"minimark",[9,22,26,35,44,47,50,63,66,69,72,80,83,87,90,93,97,100,111,114,120,123,126,134,137,140,143,146,149,188,191,194,200,203,211,215,218,221,224,323,326,329,336,339,342,345,363,366,403,406,409,427,430,832,835,842,845,848,851,891,898,901,904,922,925,946,949,952,955,1023,1029,1032,1225,1232,1238,1243,1246,1448,1455,1460,1463,1742,1747,1750,1950,1955,1958,1961,1964,3006,3009,3012,3081,3084,3093,3096,3099,3102,3105,3108,3125],[10,11,12],"blockquote",{},[13,14,15,16],"p",{},"我这学期有一门偏向前端的 WEB 课程，期末大作业要求使用 PHP 作为后端语言实现一个简单的影评系统，应该是不允许使用框架，使用中文关键字在搜索引擎上搜了一阵子似乎没有可供参考的案例，后来就找到了这篇博客，当中的许多观点与我不谋而合，因此我将这篇博客翻译成中文，原文戳这里: ",[17,18,19],"a",{"href":19,"rel":20},"https://amirkamizi.com/blog/php-simple-rest-api",[21],"nofollow",[23,24,25],"h2",{"id":25},"介绍",[13,27,28,29,34],{},"上周 @rapid_api 发了一个非常好的关于",[17,30,33],{"href":31,"rel":32},"https://twitter.com/Rapid_API/status/1486423046424563714",[21],"使用 nodejs 和 express 创建 REST API"," 的教程帖子。我想要帮助你使用 PHP 开发同样简单的 REST API。",[13,36,37,38,43],{},"首先，如果你不了解 REST API，请务必查看这个 ",[17,39,42],{"href":40,"rel":41},"https://twitter.com/Rapid_API/status/1452932706967461890",[21],"Twitter 帖子","。",[23,45,46],{"id":46},"目标",[13,48,49],{},"在我们开始之前，我想提一句，当我写这篇帖子的时候，我想确保：",[51,52,53,57,60],"ol",{},[54,55,56],"li",{},"我使用单纯的 PHP，不使用框架",[54,58,59],{},"我使用最简单的函数和结构体以便所有人都可以理解并跟上",[54,61,62],{},"我将主体部分分开",[13,64,65],{},"现在让我们开始吧",[23,67,68],{"id":68},"准备",[13,70,71],{},"在我本地的机器上，我创建了一个叫 api 的文件夹于 xampp > htdocs，在里面有一个叫 index.php 的文件",[13,73,74,75],{},"如果你没有 xampp 或者你不知道如何把 php 跑起来，请务必查看",[17,76,79],{"href":77,"rel":78},"https://amirkamizi.com/blog/introduction-to-php",[21],"这篇文章",[13,81,82],{},"现在，如果你尝试访问 localhost/api，你将得到一个空的响应，因为 index.php 文件是空的",[23,84,86],{"id":85},"优雅的-url","优雅的 URL",[13,88,89],{},"项目中，我们需要处理的第一件事是 url",[13,91,92],{},"REST API 的关键特性之一是每一个 url 负责一个资源和一个操作",[94,95,96],"h3",{"id":96},"问题",[13,98,99],{},"这时候如果我创建一个 users.php，我需要访问",[101,102,107],"pre",{"className":103,"code":105,"language":106},[104],"language-text","localhost/api/users.php\n","text",[108,109,105],"code",{"__ignoreMap":110},"",[13,112,113],{},"我需要为每一个 user id 创建一个新的文件",[101,115,118],{"className":116,"code":117,"language":106},[104],"localhost/api/users/1.php\nlocalhost/api/users/2.php\n",[108,119,117],{"__ignoreMap":110},[13,121,122],{},"以此类推。",[13,124,125],{},"这种方案有两个问题",[51,127,128,131],{},[54,129,130],{},"为每个用户创建一个新文件是非常无聊和耗时的",[54,132,133],{},"路由不优雅，每个路径后面都带有 .php",[94,135,136],{"id":136},"解决方案",[13,138,139],{},"让我们解决这个问题。",[13,141,142],{},"正如我所提到的，我不想使用任何框架，并且我想使用最简单的、最让人能够理解的方案",[13,144,145],{},"让我们看看如何解决这个问题",[13,147,148],{},"在 api 文件夹下创建一个叫 .htaccess 的文件，并且将下面的文本复制进去",[101,150,154],{"className":151,"code":152,"language":153,"meta":110,"style":110},"language-htaccess shiki shiki-themes one-light one-dark-pro","RewriteEngine On\nRewriteBase /api\nRewriteCond %{REQUEST_FILENAME} !-d\nRewriteCond %{REQUEST_FILENAME} !-f\nRewriteRule ^(.+)$ index.php [QSA,L]\n","htaccess",[108,155,156,164,170,176,182],{"__ignoreMap":110},[157,158,161],"span",{"class":159,"line":160},"line",1,[157,162,163],{},"RewriteEngine On\n",[157,165,167],{"class":159,"line":166},2,[157,168,169],{},"RewriteBase /api\n",[157,171,173],{"class":159,"line":172},3,[157,174,175],{},"RewriteCond %{REQUEST_FILENAME} !-d\n",[157,177,179],{"class":159,"line":178},4,[157,180,181],{},"RewriteCond %{REQUEST_FILENAME} !-f\n",[157,183,185],{"class":159,"line":184},5,[157,186,187],{},"RewriteRule ^(.+)$ index.php [QSA,L]\n",[13,189,190],{},"我们告诉服务器，将所有指向 /api 的请求都转发到 index.php 文件",[13,192,193],{},"现在，所有的 url 都指向 index.php 了，比如下面的 url 都是指向 index.php 的",[101,195,198],{"className":196,"code":197,"language":106},[104],"api/users\napi/users/10\napi/users/5\n",[108,199,197],{"__ignoreMap":110},[13,201,202],{},"现在我们同时解决了这两个问题",[51,204,205,208],{},[54,206,207],{},"所有的 url 都被一个文件处理",[54,209,210],{},"url 都很优雅，结尾处没有 .php",[23,212,214],{"id":213},"uri","URI",[13,216,217],{},"但如何知道用户请求的是哪个 uri 呢？",[13,219,220],{},"很简单，使用 $_SERVER 超全局变量",[13,222,223],{},"让我们来看一些例子",[101,225,229],{"className":226,"code":227,"language":228,"meta":110,"style":110},"language-php shiki shiki-themes one-light one-dark-pro","// url api/users\necho $_SERVER['REQUEST_URI'];\n// /api/users\n\n// url api/users/5\necho $_SERVER['REQUEST_URI'];\n// /api/users/5\n\n// url api\necho $_SERVER['REQUEST_URI'];\n// /api\n","php",[108,230,231,237,258,263,269,274,287,293,298,304,317],{"__ignoreMap":110},[157,232,233],{"class":159,"line":160},[157,234,236],{"class":235},"sW2Sy","// url api/users\n",[157,238,239,243,247,251,255],{"class":159,"line":166},[157,240,242],{"class":241},"s_Sar","echo",[157,244,246],{"class":245},"sJa8x"," $_SERVER",[157,248,250],{"class":249},"s5ixo","[",[157,252,254],{"class":253},"sDhpE","'REQUEST_URI'",[157,256,257],{"class":249},"];\n",[157,259,260],{"class":159,"line":172},[157,261,262],{"class":235},"// /api/users\n",[157,264,265],{"class":159,"line":178},[157,266,268],{"emptyLinePlaceholder":267},true,"\n",[157,270,271],{"class":159,"line":184},[157,272,273],{"class":235},"// url api/users/5\n",[157,275,277,279,281,283,285],{"class":159,"line":276},6,[157,278,242],{"class":241},[157,280,246],{"class":245},[157,282,250],{"class":249},[157,284,254],{"class":253},[157,286,257],{"class":249},[157,288,290],{"class":159,"line":289},7,[157,291,292],{"class":235},"// /api/users/5\n",[157,294,296],{"class":159,"line":295},8,[157,297,268],{"emptyLinePlaceholder":267},[157,299,301],{"class":159,"line":300},9,[157,302,303],{"class":235},"// url api\n",[157,305,307,309,311,313,315],{"class":159,"line":306},10,[157,308,242],{"class":241},[157,310,246],{"class":245},[157,312,250],{"class":249},[157,314,254],{"class":253},[157,316,257],{"class":249},[157,318,320],{"class":159,"line":319},11,[157,321,322],{"class":235},"// /api\n",[13,324,325],{},"看见了吗？这就是我们所需要的",[13,327,328],{},"现在，使用一个简单的 if 或者 switch 语句，我们就可以处理不同的路径了",[13,330,331,332,43],{},"如果你从来没有用过这些语句，去读",[17,333,79],{"href":334,"rel":335},"https://amirkamizi.com/blog/php-conditionals",[21],[23,337,338],{"id":338},"请求方法",[13,340,341],{},"接下来，我们需要从请求中获取请求的方法，以查看它是GET、POST、PUT、PATCH还是DELETE。",[13,343,344],{},"你可以从 $_SERVER 超全局数组中获取这个信息。",[101,346,348],{"className":226,"code":347,"language":228,"meta":110,"style":110},"$_SERVER['REQUEST_METHOD']\n",[108,349,350],{"__ignoreMap":110},[157,351,352,355,357,360],{"class":159,"line":160},[157,353,354],{"class":245},"$_SERVER",[157,356,250],{"class":249},[157,358,359],{"class":253},"'REQUEST_METHOD'",[157,361,362],{"class":249},"]\n",[13,364,365],{},"让我们将这两个值存储在变量中：",[101,367,369],{"className":226,"code":368,"language":228,"meta":110,"style":110},"$uri = $_SERVER['REQUEST_URI'];\n$method = $_SERVER['REQUEST_METHOD'];\n",[108,370,371,388],{"__ignoreMap":110},[157,372,373,376,380,382,384,386],{"class":159,"line":160},[157,374,375],{"class":245},"$uri",[157,377,379],{"class":378},"sknuh"," =",[157,381,246],{"class":245},[157,383,250],{"class":249},[157,385,254],{"class":253},[157,387,257],{"class":249},[157,389,390,393,395,397,399,401],{"class":159,"line":166},[157,391,392],{"class":245},"$method",[157,394,379],{"class":378},[157,396,246],{"class":245},[157,398,250],{"class":249},[157,400,359],{"class":253},[157,402,257],{"class":249},[13,404,405],{},"我们可以在一个简单的 switch 语句中使用这两个变量来处理不同的请求。",[13,407,408],{},"我们需要判断以下请求",[410,411,412,415,418,421,424],"ul",{},[54,413,414],{},"api/users 的 GET 请求",[54,416,417],{},"api/users/{id} 的 GET 请求",[54,419,420],{},"api/users 的 POST 请求",[54,422,423],{},"api/users/{id} 的 PUT 请求",[54,425,426],{},"api/users/{id} 的 DELETE 请求",[13,428,429],{},"让我们编写针对上述请求的 switch 语句",[101,431,433],{"className":226,"code":432,"language":228,"meta":110,"style":110},"switch ($method | $uri) {\n   /*\n   * Path: GET /api/users\n   * Task: show all the users\n   */\n   case ($method == 'GET' && $uri == '/api/users'):\n       break;\n   /*\n   * Path: GET /api/users/{id}\n   * Task: get one user\n   */\n   case ($method == 'GET' && preg_match('/\\/api\\/users\\/[1-9]/', $uri)):\n       break;\n   /*\n   * Path: POST /api/users\n   * Task: store one user\n   */\n   case ($method == 'POST' && $uri == '/api/users'):\n       break;\n   /*\n   * Path: PUT /api/users/{id}\n   * Task: update one user\n   */\n   case ($method == 'PUT' && preg_match('/\\/api\\/users\\/[1-9]/', $uri)):\n       break;\n   /*\n   * Path: DELETE /api/users/{id}\n   * Task: delete one user\n   */\n   case ($method == 'DELETE' && preg_match('/\\/api\\/users\\/[1-9]/', $uri)):\n       break;\n   /*\n   * Path: ?\n   * Task: this path doesn't match any of the defined paths\n   *      throw an error\n   */\n   default:\n       break;\n}\n",[108,434,435,455,460,465,470,475,503,511,515,520,525,529,578,585,590,596,602,607,631,638,643,649,655,660,700,707,712,718,724,729,775,782,787,793,799,805,810,819,826],{"__ignoreMap":110},[157,436,437,441,444,446,449,452],{"class":159,"line":160},[157,438,440],{"class":439},"sLKXg","switch",[157,442,443],{"class":249}," (",[157,445,392],{"class":245},[157,447,448],{"class":378}," |",[157,450,451],{"class":245}," $uri",[157,453,454],{"class":249},") {\n",[157,456,457],{"class":159,"line":166},[157,458,459],{"class":235},"   /*\n",[157,461,462],{"class":159,"line":172},[157,463,464],{"class":235},"   * Path: GET /api/users\n",[157,466,467],{"class":159,"line":178},[157,468,469],{"class":235},"   * Task: show all the users\n",[157,471,472],{"class":159,"line":184},[157,473,474],{"class":235},"   */\n",[157,476,477,480,482,484,487,490,493,495,497,500],{"class":159,"line":276},[157,478,479],{"class":439},"   case",[157,481,443],{"class":249},[157,483,392],{"class":245},[157,485,486],{"class":378}," ==",[157,488,489],{"class":253}," 'GET'",[157,491,492],{"class":378}," &&",[157,494,451],{"class":245},[157,496,486],{"class":378},[157,498,499],{"class":253}," '/api/users'",[157,501,502],{"class":249},"):\n",[157,504,505,508],{"class":159,"line":289},[157,506,507],{"class":439},"       break",[157,509,510],{"class":249},";\n",[157,512,513],{"class":159,"line":295},[157,514,459],{"class":235},[157,516,517],{"class":159,"line":300},[157,518,519],{"class":235},"   * Path: GET /api/users/{id}\n",[157,521,522],{"class":159,"line":306},[157,523,524],{"class":235},"   * Task: get one user\n",[157,526,527],{"class":159,"line":319},[157,528,474],{"class":235},[157,530,532,534,536,538,540,542,544,547,550,554,557,560,562,565,567,570,573,575],{"class":159,"line":531},12,[157,533,479],{"class":439},[157,535,443],{"class":249},[157,537,392],{"class":245},[157,539,486],{"class":378},[157,541,489],{"class":253},[157,543,492],{"class":378},[157,545,546],{"class":241}," preg_match",[157,548,549],{"class":249},"(",[157,551,553],{"class":552},"sDaw7","'/",[157,555,556],{"class":241},"\\/",[157,558,559],{"class":552},"api",[157,561,556],{"class":241},[157,563,564],{"class":552},"users",[157,566,556],{"class":241},[157,568,569],{"class":552},"[1-9]/'",[157,571,572],{"class":249},",",[157,574,451],{"class":245},[157,576,577],{"class":249},")):\n",[157,579,581,583],{"class":159,"line":580},13,[157,582,507],{"class":439},[157,584,510],{"class":249},[157,586,588],{"class":159,"line":587},14,[157,589,459],{"class":235},[157,591,593],{"class":159,"line":592},15,[157,594,595],{"class":235},"   * Path: POST /api/users\n",[157,597,599],{"class":159,"line":598},16,[157,600,601],{"class":235},"   * Task: store one user\n",[157,603,605],{"class":159,"line":604},17,[157,606,474],{"class":235},[157,608,610,612,614,616,618,621,623,625,627,629],{"class":159,"line":609},18,[157,611,479],{"class":439},[157,613,443],{"class":249},[157,615,392],{"class":245},[157,617,486],{"class":378},[157,619,620],{"class":253}," 'POST'",[157,622,492],{"class":378},[157,624,451],{"class":245},[157,626,486],{"class":378},[157,628,499],{"class":253},[157,630,502],{"class":249},[157,632,634,636],{"class":159,"line":633},19,[157,635,507],{"class":439},[157,637,510],{"class":249},[157,639,641],{"class":159,"line":640},20,[157,642,459],{"class":235},[157,644,646],{"class":159,"line":645},21,[157,647,648],{"class":235},"   * Path: PUT /api/users/{id}\n",[157,650,652],{"class":159,"line":651},22,[157,653,654],{"class":235},"   * Task: update one user\n",[157,656,658],{"class":159,"line":657},23,[157,659,474],{"class":235},[157,661,663,665,667,669,671,674,676,678,680,682,684,686,688,690,692,694,696,698],{"class":159,"line":662},24,[157,664,479],{"class":439},[157,666,443],{"class":249},[157,668,392],{"class":245},[157,670,486],{"class":378},[157,672,673],{"class":253}," 'PUT'",[157,675,492],{"class":378},[157,677,546],{"class":241},[157,679,549],{"class":249},[157,681,553],{"class":552},[157,683,556],{"class":241},[157,685,559],{"class":552},[157,687,556],{"class":241},[157,689,564],{"class":552},[157,691,556],{"class":241},[157,693,569],{"class":552},[157,695,572],{"class":249},[157,697,451],{"class":245},[157,699,577],{"class":249},[157,701,703,705],{"class":159,"line":702},25,[157,704,507],{"class":439},[157,706,510],{"class":249},[157,708,710],{"class":159,"line":709},26,[157,711,459],{"class":235},[157,713,715],{"class":159,"line":714},27,[157,716,717],{"class":235},"   * Path: DELETE /api/users/{id}\n",[157,719,721],{"class":159,"line":720},28,[157,722,723],{"class":235},"   * Task: delete one user\n",[157,725,727],{"class":159,"line":726},29,[157,728,474],{"class":235},[157,730,732,734,736,738,740,743,746,749,751,753,755,757,759,761,763,765,767,769,771,773],{"class":159,"line":731},30,[157,733,479],{"class":439},[157,735,443],{"class":249},[157,737,392],{"class":245},[157,739,486],{"class":378},[157,741,742],{"class":253}," '",[157,744,745],{"class":439},"DELETE",[157,747,748],{"class":253},"'",[157,750,492],{"class":378},[157,752,546],{"class":241},[157,754,549],{"class":249},[157,756,553],{"class":552},[157,758,556],{"class":241},[157,760,559],{"class":552},[157,762,556],{"class":241},[157,764,564],{"class":552},[157,766,556],{"class":241},[157,768,569],{"class":552},[157,770,572],{"class":249},[157,772,451],{"class":245},[157,774,577],{"class":249},[157,776,778,780],{"class":159,"line":777},31,[157,779,507],{"class":439},[157,781,510],{"class":249},[157,783,785],{"class":159,"line":784},32,[157,786,459],{"class":235},[157,788,790],{"class":159,"line":789},33,[157,791,792],{"class":235},"   * Path: ?\n",[157,794,796],{"class":159,"line":795},34,[157,797,798],{"class":235},"   * Task: this path doesn't match any of the defined paths\n",[157,800,802],{"class":159,"line":801},35,[157,803,804],{"class":235},"   *      throw an error\n",[157,806,808],{"class":159,"line":807},36,[157,809,474],{"class":235},[157,811,813,816],{"class":159,"line":812},37,[157,814,815],{"class":439},"   default",[157,817,818],{"class":249},":\n",[157,820,822,824],{"class":159,"line":821},38,[157,823,507],{"class":439},[157,825,510],{"class":249},[157,827,829],{"class":159,"line":828},39,[157,830,831],{"class":249},"}\n",[13,833,834],{},"当我们想要在 switch 语句中使用两个变量，我们可以使用 | 符号",[13,836,837,838,43],{},"如果你想知道 preg_match 是如何工作的，看",[17,839,79],{"href":840,"rel":841},"https://amirkamizi.com/blog/php-regular-expressions",[21],[23,843,844],{"id":844},"数据库",[13,846,847],{},"现在是说说数据。储存数据的最好方法是将数据储存在数据库中。但在这篇教程中，我不想使用数据库。因此，我们使用一个 json 文件当作数据库来保证数据的持久性。",[13,849,850],{},"我的 json 文件看起来长成这个样子：",[101,852,856],{"className":853,"code":854,"language":855,"meta":110,"style":110},"language-json shiki shiki-themes one-light one-dark-pro","{\n   \"1\": \"Pratham\",\n   \"2\": \"Amir\"\n}\n","json",[108,857,858,863,877,887],{"__ignoreMap":110},[157,859,860],{"class":159,"line":160},[157,861,862],{"class":249},"{\n",[157,864,865,868,871,874],{"class":159,"line":166},[157,866,867],{"class":245},"   \"1\"",[157,869,870],{"class":249},": ",[157,872,873],{"class":253},"\"Pratham\"",[157,875,876],{"class":249},",\n",[157,878,879,882,884],{"class":159,"line":172},[157,880,881],{"class":245},"   \"2\"",[157,883,870],{"class":249},[157,885,886],{"class":253},"\"Amir\"\n",[157,888,889],{"class":159,"line":178},[157,890,831],{"class":249},[13,892,893,894],{},"如果你想知道如何使用 json，看",[17,895,79],{"href":896,"rel":897},"https://amirkamizi.com/blog/php-xml-and-json",[21],[13,899,900],{},"我加载 json 数据并将其转换为数组，然后在 php 使用他们。如果我想要更改数据，我将数组转换回 json 并将其重新写入文件。",[13,902,903],{},"要将整个文件作为一个字符串读取并存储在变量中，我使用：",[101,905,907],{"className":226,"code":906,"language":228,"meta":110,"style":110},"file_get_contents($jsonFile);\n",[108,908,909],{"__ignoreMap":110},[157,910,911,914,916,919],{"class":159,"line":160},[157,912,913],{"class":241},"file_get_contents",[157,915,549],{"class":249},[157,917,918],{"class":245},"$jsonFile",[157,920,921],{"class":249},");\n",[13,923,924],{},"而要将json写入文件，我使用：",[101,926,928],{"className":226,"code":927,"language":228,"meta":110,"style":110},"file_put_contents($jsonFile, $data);\n",[108,929,930],{"__ignoreMap":110},[157,931,932,935,937,939,941,944],{"class":159,"line":160},[157,933,934],{"class":241},"file_put_contents",[157,936,549],{"class":249},[157,938,918],{"class":245},[157,940,572],{"class":249},[157,942,943],{"class":245}," $data",[157,945,921],{"class":249},[13,947,948],{},"好了，现在我们的数据库处理好了，让我们开始处理所有的路径。",[13,950,951],{},"我使用 Postman 发送请求并查看响应。",[23,953,954],{"id":954},"获取所有用户",[101,956,958],{"className":226,"code":957,"language":228,"meta":110,"style":110},"case ($method == 'GET' && $uri == '/api/users'):\n   header('Content-Type: application/json');\n   echo json_encode($users, JSON_PRETTY_PRINT);\n   break;\n",[108,959,960,983,995,1016],{"__ignoreMap":110},[157,961,962,965,967,969,971,973,975,977,979,981],{"class":159,"line":160},[157,963,964],{"class":439},"case",[157,966,443],{"class":249},[157,968,392],{"class":245},[157,970,486],{"class":378},[157,972,489],{"class":253},[157,974,492],{"class":378},[157,976,451],{"class":245},[157,978,486],{"class":378},[157,980,499],{"class":253},[157,982,502],{"class":249},[157,984,985,988,990,993],{"class":159,"line":166},[157,986,987],{"class":241},"   header",[157,989,549],{"class":249},[157,991,992],{"class":253},"'Content-Type: application/json'",[157,994,921],{"class":249},[157,996,997,1000,1003,1005,1008,1010,1014],{"class":159,"line":172},[157,998,999],{"class":241},"   echo",[157,1001,1002],{"class":241}," json_encode",[157,1004,549],{"class":249},[157,1006,1007],{"class":245},"$users",[157,1009,572],{"class":249},[157,1011,1013],{"class":1012},"sxymB"," JSON_PRETTY_PRINT",[157,1015,921],{"class":249},[157,1017,1018,1021],{"class":159,"line":178},[157,1019,1020],{"class":439},"   break",[157,1022,510],{"class":249},[13,1024,1025],{},[1026,1027],"img",{"alt":110,"src":1028},"https://static.031130.xyz/uploads/2024/08/12/6577fcdf64a96.webp",[23,1030,1031],{"id":1031},"获取单个用户",[101,1033,1035],{"className":226,"code":1034,"language":228,"meta":110,"style":110},"case ($method == 'GET' && preg_match('/\\/api\\/users\\/[1-9]/', $uri)):\n   header('Content-Type: application/json');\n   // get the id\n   $id = basename($uri);\n   if (!array_key_exists($id, $users)) {\n       http_response_code(404);\n       echo json_encode(['error' => 'user does not exist']);\n       break;\n   }\n   $responseData = [$id => $users[$id]];\n   echo json_encode($responseData, JSON_PRETTY_PRINT);\n   break;\n",[108,1036,1037,1075,1085,1090,1106,1132,1145,1167,1173,1178,1202,1219],{"__ignoreMap":110},[157,1038,1039,1041,1043,1045,1047,1049,1051,1053,1055,1057,1059,1061,1063,1065,1067,1069,1071,1073],{"class":159,"line":160},[157,1040,964],{"class":439},[157,1042,443],{"class":249},[157,1044,392],{"class":245},[157,1046,486],{"class":378},[157,1048,489],{"class":253},[157,1050,492],{"class":378},[157,1052,546],{"class":241},[157,1054,549],{"class":249},[157,1056,553],{"class":552},[157,1058,556],{"class":241},[157,1060,559],{"class":552},[157,1062,556],{"class":241},[157,1064,564],{"class":552},[157,1066,556],{"class":241},[157,1068,569],{"class":552},[157,1070,572],{"class":249},[157,1072,451],{"class":245},[157,1074,577],{"class":249},[157,1076,1077,1079,1081,1083],{"class":159,"line":166},[157,1078,987],{"class":241},[157,1080,549],{"class":249},[157,1082,992],{"class":253},[157,1084,921],{"class":249},[157,1086,1087],{"class":159,"line":172},[157,1088,1089],{"class":235},"   // get the id\n",[157,1091,1092,1095,1097,1100,1102,1104],{"class":159,"line":178},[157,1093,1094],{"class":245},"   $id",[157,1096,379],{"class":378},[157,1098,1099],{"class":241}," basename",[157,1101,549],{"class":249},[157,1103,375],{"class":245},[157,1105,921],{"class":249},[157,1107,1108,1111,1113,1116,1119,1121,1124,1126,1129],{"class":159,"line":184},[157,1109,1110],{"class":439},"   if",[157,1112,443],{"class":249},[157,1114,1115],{"class":378},"!",[157,1117,1118],{"class":241},"array_key_exists",[157,1120,549],{"class":249},[157,1122,1123],{"class":245},"$id",[157,1125,572],{"class":249},[157,1127,1128],{"class":245}," $users",[157,1130,1131],{"class":249},")) {\n",[157,1133,1134,1137,1139,1143],{"class":159,"line":276},[157,1135,1136],{"class":241},"       http_response_code",[157,1138,549],{"class":249},[157,1140,1142],{"class":1141},"sAGMh","404",[157,1144,921],{"class":249},[157,1146,1147,1150,1152,1155,1158,1161,1164],{"class":159,"line":289},[157,1148,1149],{"class":241},"       echo",[157,1151,1002],{"class":241},[157,1153,1154],{"class":249},"([",[157,1156,1157],{"class":253},"'error'",[157,1159,1160],{"class":249}," =>",[157,1162,1163],{"class":253}," 'user does not exist'",[157,1165,1166],{"class":249},"]);\n",[157,1168,1169,1171],{"class":159,"line":295},[157,1170,507],{"class":439},[157,1172,510],{"class":249},[157,1174,1175],{"class":159,"line":300},[157,1176,1177],{"class":249},"   }\n",[157,1179,1180,1183,1185,1188,1190,1193,1195,1197,1199],{"class":159,"line":306},[157,1181,1182],{"class":245},"   $responseData",[157,1184,379],{"class":378},[157,1186,1187],{"class":249}," [",[157,1189,1123],{"class":245},[157,1191,1192],{"class":249}," => ",[157,1194,1007],{"class":245},[157,1196,250],{"class":249},[157,1198,1123],{"class":245},[157,1200,1201],{"class":249},"]];\n",[157,1203,1204,1206,1208,1210,1213,1215,1217],{"class":159,"line":319},[157,1205,999],{"class":241},[157,1207,1002],{"class":241},[157,1209,549],{"class":249},[157,1211,1212],{"class":245},"$responseData",[157,1214,572],{"class":249},[157,1216,1013],{"class":1012},[157,1218,921],{"class":249},[157,1220,1221,1223],{"class":159,"line":531},[157,1222,1020],{"class":439},[157,1224,510],{"class":249},[13,1226,1227,1231],{},[1228,1229,1230],"strong",{},"basename","($uri) 会将 uri 的最后一部分给我。比如一个 api/users/10 这样的路径，它会返回 10.",[13,1233,1234,1235,1237],{},"然后我使用 ",[1228,1236,1118],{}," 检查是否存在一个 id 为 10 的用户",[13,1239,1240],{},[1026,1241],{"alt":110,"src":1242},"https://static.031130.xyz/uploads/2024/08/12/6577fd77c3d06.webp",[23,1244,1245],{"id":1245},"添加一个新用户",[101,1247,1249],{"className":226,"code":1248,"language":228,"meta":110,"style":110},"case ($method == 'POST' && $uri == '/api/users'):\n   header('Content-Type: application/json');\n   $requestBody = json_decode(file_get_contents('php://input'), true);\n   $name = $requestBody['name'];\n   if (empty($name)) {\n       http_response_code(404);\n       echo json_encode(['error' => 'Please add name of the user']);\n   }\n   $users[] = $name;\n   $data = json_encode($users, JSON_PRETTY_PRINT);\n   file_put_contents($jsonFile, $data);\n   echo json_encode(['message' => 'user added successfully']);\n   break;\n",[108,1250,1251,1273,1283,1310,1327,1343,1353,1370,1374,1390,1409,1424,1442],{"__ignoreMap":110},[157,1252,1253,1255,1257,1259,1261,1263,1265,1267,1269,1271],{"class":159,"line":160},[157,1254,964],{"class":439},[157,1256,443],{"class":249},[157,1258,392],{"class":245},[157,1260,486],{"class":378},[157,1262,620],{"class":253},[157,1264,492],{"class":378},[157,1266,451],{"class":245},[157,1268,486],{"class":378},[157,1270,499],{"class":253},[157,1272,502],{"class":249},[157,1274,1275,1277,1279,1281],{"class":159,"line":166},[157,1276,987],{"class":241},[157,1278,549],{"class":249},[157,1280,992],{"class":253},[157,1282,921],{"class":249},[157,1284,1285,1288,1290,1293,1295,1297,1299,1302,1305,1308],{"class":159,"line":172},[157,1286,1287],{"class":245},"   $requestBody",[157,1289,379],{"class":378},[157,1291,1292],{"class":241}," json_decode",[157,1294,549],{"class":249},[157,1296,913],{"class":241},[157,1298,549],{"class":249},[157,1300,1301],{"class":253},"'php://input'",[157,1303,1304],{"class":249},"),",[157,1306,1307],{"class":1141}," true",[157,1309,921],{"class":249},[157,1311,1312,1315,1317,1320,1322,1325],{"class":159,"line":178},[157,1313,1314],{"class":245},"   $name",[157,1316,379],{"class":378},[157,1318,1319],{"class":245}," $requestBody",[157,1321,250],{"class":249},[157,1323,1324],{"class":253},"'name'",[157,1326,257],{"class":249},[157,1328,1329,1331,1333,1336,1338,1341],{"class":159,"line":184},[157,1330,1110],{"class":439},[157,1332,443],{"class":249},[157,1334,1335],{"class":241},"empty",[157,1337,549],{"class":249},[157,1339,1340],{"class":245},"$name",[157,1342,1131],{"class":249},[157,1344,1345,1347,1349,1351],{"class":159,"line":276},[157,1346,1136],{"class":241},[157,1348,549],{"class":249},[157,1350,1142],{"class":1141},[157,1352,921],{"class":249},[157,1354,1355,1357,1359,1361,1363,1365,1368],{"class":159,"line":289},[157,1356,1149],{"class":241},[157,1358,1002],{"class":241},[157,1360,1154],{"class":249},[157,1362,1157],{"class":253},[157,1364,1160],{"class":249},[157,1366,1367],{"class":253}," 'Please add name of the user'",[157,1369,1166],{"class":249},[157,1371,1372],{"class":159,"line":295},[157,1373,1177],{"class":249},[157,1375,1376,1379,1382,1385,1388],{"class":159,"line":300},[157,1377,1378],{"class":245},"   $users",[157,1380,1381],{"class":249},"[] ",[157,1383,1384],{"class":378},"=",[157,1386,1387],{"class":245}," $name",[157,1389,510],{"class":249},[157,1391,1392,1395,1397,1399,1401,1403,1405,1407],{"class":159,"line":306},[157,1393,1394],{"class":245},"   $data",[157,1396,379],{"class":378},[157,1398,1002],{"class":241},[157,1400,549],{"class":249},[157,1402,1007],{"class":245},[157,1404,572],{"class":249},[157,1406,1013],{"class":1012},[157,1408,921],{"class":249},[157,1410,1411,1414,1416,1418,1420,1422],{"class":159,"line":319},[157,1412,1413],{"class":241},"   file_put_contents",[157,1415,549],{"class":249},[157,1417,918],{"class":245},[157,1419,572],{"class":249},[157,1421,943],{"class":245},[157,1423,921],{"class":249},[157,1425,1426,1428,1430,1432,1435,1437,1440],{"class":159,"line":531},[157,1427,999],{"class":241},[157,1429,1002],{"class":241},[157,1431,1154],{"class":249},[157,1433,1434],{"class":253},"'message'",[157,1436,1160],{"class":249},[157,1438,1439],{"class":253}," 'user added successfully'",[157,1441,1166],{"class":249},[157,1443,1444,1446],{"class":159,"line":580},[157,1445,1020],{"class":439},[157,1447,510],{"class":249},[13,1449,1450,1451,1454],{},"我使用 ",[1228,1452,1453],{},"file_get_contents('php://input')"," 以获取请求的 body 部分。由于在这个例子中我使用的是 json，我将会解码 json 以便我可以获取到名字。",[13,1456,1457],{},[1026,1458],{"alt":110,"src":1459},"https://static.031130.xyz/uploads/2024/08/12/6577fdca88f76.webp",[23,1461,1462],{"id":1462},"更新一个用户",[101,1464,1466],{"className":226,"code":1465,"language":228,"meta":110,"style":110},"case ($method == 'PUT' && preg_match('/\\/api\\/users\\/[1-9]/', $uri)):\n   header('Content-Type: application/json');\n   // get the id\n   $id = basename($uri);\n   if (!array_key_exists($id, $users)) {\n       http_response_code(404);\n       echo json_encode(['error' => 'user does not exist']);\n       break;\n   }\n   $requestBody = json_decode(file_get_contents('php://input'), true);\n   $name = $requestBody['name'];\n   if (empty($name)) {\n       http_response_code(404);\n       echo json_encode(['error' => 'Please add name of the user']);\n   }\n   $users[$id] = $name;\n   $data = json_encode($users, JSON_PRETTY_PRINT);\n   file_put_contents($jsonFile, $data);\n   echo json_encode(['message' => 'user updated successfully']);\n   break;\n",[108,1467,1468,1506,1516,1520,1534,1554,1564,1580,1586,1590,1612,1626,1640,1650,1666,1670,1687,1705,1719,1736],{"__ignoreMap":110},[157,1469,1470,1472,1474,1476,1478,1480,1482,1484,1486,1488,1490,1492,1494,1496,1498,1500,1502,1504],{"class":159,"line":160},[157,1471,964],{"class":439},[157,1473,443],{"class":249},[157,1475,392],{"class":245},[157,1477,486],{"class":378},[157,1479,673],{"class":253},[157,1481,492],{"class":378},[157,1483,546],{"class":241},[157,1485,549],{"class":249},[157,1487,553],{"class":552},[157,1489,556],{"class":241},[157,1491,559],{"class":552},[157,1493,556],{"class":241},[157,1495,564],{"class":552},[157,1497,556],{"class":241},[157,1499,569],{"class":552},[157,1501,572],{"class":249},[157,1503,451],{"class":245},[157,1505,577],{"class":249},[157,1507,1508,1510,1512,1514],{"class":159,"line":166},[157,1509,987],{"class":241},[157,1511,549],{"class":249},[157,1513,992],{"class":253},[157,1515,921],{"class":249},[157,1517,1518],{"class":159,"line":172},[157,1519,1089],{"class":235},[157,1521,1522,1524,1526,1528,1530,1532],{"class":159,"line":178},[157,1523,1094],{"class":245},[157,1525,379],{"class":378},[157,1527,1099],{"class":241},[157,1529,549],{"class":249},[157,1531,375],{"class":245},[157,1533,921],{"class":249},[157,1535,1536,1538,1540,1542,1544,1546,1548,1550,1552],{"class":159,"line":184},[157,1537,1110],{"class":439},[157,1539,443],{"class":249},[157,1541,1115],{"class":378},[157,1543,1118],{"class":241},[157,1545,549],{"class":249},[157,1547,1123],{"class":245},[157,1549,572],{"class":249},[157,1551,1128],{"class":245},[157,1553,1131],{"class":249},[157,1555,1556,1558,1560,1562],{"class":159,"line":276},[157,1557,1136],{"class":241},[157,1559,549],{"class":249},[157,1561,1142],{"class":1141},[157,1563,921],{"class":249},[157,1565,1566,1568,1570,1572,1574,1576,1578],{"class":159,"line":289},[157,1567,1149],{"class":241},[157,1569,1002],{"class":241},[157,1571,1154],{"class":249},[157,1573,1157],{"class":253},[157,1575,1160],{"class":249},[157,1577,1163],{"class":253},[157,1579,1166],{"class":249},[157,1581,1582,1584],{"class":159,"line":295},[157,1583,507],{"class":439},[157,1585,510],{"class":249},[157,1587,1588],{"class":159,"line":300},[157,1589,1177],{"class":249},[157,1591,1592,1594,1596,1598,1600,1602,1604,1606,1608,1610],{"class":159,"line":306},[157,1593,1287],{"class":245},[157,1595,379],{"class":378},[157,1597,1292],{"class":241},[157,1599,549],{"class":249},[157,1601,913],{"class":241},[157,1603,549],{"class":249},[157,1605,1301],{"class":253},[157,1607,1304],{"class":249},[157,1609,1307],{"class":1141},[157,1611,921],{"class":249},[157,1613,1614,1616,1618,1620,1622,1624],{"class":159,"line":319},[157,1615,1314],{"class":245},[157,1617,379],{"class":378},[157,1619,1319],{"class":245},[157,1621,250],{"class":249},[157,1623,1324],{"class":253},[157,1625,257],{"class":249},[157,1627,1628,1630,1632,1634,1636,1638],{"class":159,"line":531},[157,1629,1110],{"class":439},[157,1631,443],{"class":249},[157,1633,1335],{"class":241},[157,1635,549],{"class":249},[157,1637,1340],{"class":245},[157,1639,1131],{"class":249},[157,1641,1642,1644,1646,1648],{"class":159,"line":580},[157,1643,1136],{"class":241},[157,1645,549],{"class":249},[157,1647,1142],{"class":1141},[157,1649,921],{"class":249},[157,1651,1652,1654,1656,1658,1660,1662,1664],{"class":159,"line":587},[157,1653,1149],{"class":241},[157,1655,1002],{"class":241},[157,1657,1154],{"class":249},[157,1659,1157],{"class":253},[157,1661,1160],{"class":249},[157,1663,1367],{"class":253},[157,1665,1166],{"class":249},[157,1667,1668],{"class":159,"line":592},[157,1669,1177],{"class":249},[157,1671,1672,1674,1676,1678,1681,1683,1685],{"class":159,"line":598},[157,1673,1378],{"class":245},[157,1675,250],{"class":249},[157,1677,1123],{"class":245},[157,1679,1680],{"class":249},"] ",[157,1682,1384],{"class":378},[157,1684,1387],{"class":245},[157,1686,510],{"class":249},[157,1688,1689,1691,1693,1695,1697,1699,1701,1703],{"class":159,"line":604},[157,1690,1394],{"class":245},[157,1692,379],{"class":378},[157,1694,1002],{"class":241},[157,1696,549],{"class":249},[157,1698,1007],{"class":245},[157,1700,572],{"class":249},[157,1702,1013],{"class":1012},[157,1704,921],{"class":249},[157,1706,1707,1709,1711,1713,1715,1717],{"class":159,"line":609},[157,1708,1413],{"class":241},[157,1710,549],{"class":249},[157,1712,918],{"class":245},[157,1714,572],{"class":249},[157,1716,943],{"class":245},[157,1718,921],{"class":249},[157,1720,1721,1723,1725,1727,1729,1731,1734],{"class":159,"line":633},[157,1722,999],{"class":241},[157,1724,1002],{"class":241},[157,1726,1154],{"class":249},[157,1728,1434],{"class":253},[157,1730,1160],{"class":249},[157,1732,1733],{"class":253}," 'user updated successfully'",[157,1735,1166],{"class":249},[157,1737,1738,1740],{"class":159,"line":640},[157,1739,1020],{"class":439},[157,1741,510],{"class":249},[13,1743,1744],{},[1026,1745],{"alt":110,"src":1746},"https://static.031130.xyz/uploads/2024/08/12/6577fdf646402.webp",[23,1748,1749],{"id":1749},"删除一个用户",[101,1751,1753],{"className":226,"code":1752,"language":228,"meta":110,"style":110},"case ($method == 'DELETE' && preg_match('/\\/api\\/users\\/[1-9]/', $uri)):\n   header('Content-Type: application/json');\n   // get the id\n   $id = basename($uri);\n   if (empty($users[$id])) {\n       http_response_code(404);\n       echo json_encode(['error' => 'user does not exist']);\n       break;\n   }\n   unset($users[$id]);\n   $data = json_encode($users, JSON_PRETTY_PRINT);\n   file_put_contents($jsonFile, $data);\n   echo json_encode(['message' => 'user deleted successfully']);\n   break;\n",[108,1754,1755,1797,1807,1811,1825,1844,1854,1870,1876,1880,1895,1913,1927,1944],{"__ignoreMap":110},[157,1756,1757,1759,1761,1763,1765,1767,1769,1771,1773,1775,1777,1779,1781,1783,1785,1787,1789,1791,1793,1795],{"class":159,"line":160},[157,1758,964],{"class":439},[157,1760,443],{"class":249},[157,1762,392],{"class":245},[157,1764,486],{"class":378},[157,1766,742],{"class":253},[157,1768,745],{"class":439},[157,1770,748],{"class":253},[157,1772,492],{"class":378},[157,1774,546],{"class":241},[157,1776,549],{"class":249},[157,1778,553],{"class":552},[157,1780,556],{"class":241},[157,1782,559],{"class":552},[157,1784,556],{"class":241},[157,1786,564],{"class":552},[157,1788,556],{"class":241},[157,1790,569],{"class":552},[157,1792,572],{"class":249},[157,1794,451],{"class":245},[157,1796,577],{"class":249},[157,1798,1799,1801,1803,1805],{"class":159,"line":166},[157,1800,987],{"class":241},[157,1802,549],{"class":249},[157,1804,992],{"class":253},[157,1806,921],{"class":249},[157,1808,1809],{"class":159,"line":172},[157,1810,1089],{"class":235},[157,1812,1813,1815,1817,1819,1821,1823],{"class":159,"line":178},[157,1814,1094],{"class":245},[157,1816,379],{"class":378},[157,1818,1099],{"class":241},[157,1820,549],{"class":249},[157,1822,375],{"class":245},[157,1824,921],{"class":249},[157,1826,1827,1829,1831,1833,1835,1837,1839,1841],{"class":159,"line":184},[157,1828,1110],{"class":439},[157,1830,443],{"class":249},[157,1832,1335],{"class":241},[157,1834,549],{"class":249},[157,1836,1007],{"class":245},[157,1838,250],{"class":249},[157,1840,1123],{"class":245},[157,1842,1843],{"class":249},"])) {\n",[157,1845,1846,1848,1850,1852],{"class":159,"line":276},[157,1847,1136],{"class":241},[157,1849,549],{"class":249},[157,1851,1142],{"class":1141},[157,1853,921],{"class":249},[157,1855,1856,1858,1860,1862,1864,1866,1868],{"class":159,"line":289},[157,1857,1149],{"class":241},[157,1859,1002],{"class":241},[157,1861,1154],{"class":249},[157,1863,1157],{"class":253},[157,1865,1160],{"class":249},[157,1867,1163],{"class":253},[157,1869,1166],{"class":249},[157,1871,1872,1874],{"class":159,"line":295},[157,1873,507],{"class":439},[157,1875,510],{"class":249},[157,1877,1878],{"class":159,"line":300},[157,1879,1177],{"class":249},[157,1881,1882,1885,1887,1889,1891,1893],{"class":159,"line":306},[157,1883,1884],{"class":241},"   unset",[157,1886,549],{"class":249},[157,1888,1007],{"class":245},[157,1890,250],{"class":249},[157,1892,1123],{"class":245},[157,1894,1166],{"class":249},[157,1896,1897,1899,1901,1903,1905,1907,1909,1911],{"class":159,"line":319},[157,1898,1394],{"class":245},[157,1900,379],{"class":378},[157,1902,1002],{"class":241},[157,1904,549],{"class":249},[157,1906,1007],{"class":245},[157,1908,572],{"class":249},[157,1910,1013],{"class":1012},[157,1912,921],{"class":249},[157,1914,1915,1917,1919,1921,1923,1925],{"class":159,"line":531},[157,1916,1413],{"class":241},[157,1918,549],{"class":249},[157,1920,918],{"class":245},[157,1922,572],{"class":249},[157,1924,943],{"class":245},[157,1926,921],{"class":249},[157,1928,1929,1931,1933,1935,1937,1939,1942],{"class":159,"line":580},[157,1930,999],{"class":241},[157,1932,1002],{"class":241},[157,1934,1154],{"class":249},[157,1936,1434],{"class":253},[157,1938,1160],{"class":249},[157,1940,1941],{"class":253}," 'user deleted successfully'",[157,1943,1166],{"class":249},[157,1945,1946,1948],{"class":159,"line":587},[157,1947,1020],{"class":439},[157,1949,510],{"class":249},[13,1951,1952],{},[1026,1953],{"alt":110,"src":1954},"https://static.031130.xyz/uploads/2024/08/12/6577fe0c3a95b.webp",[23,1956,1957],{"id":1957},"最终文件",[13,1959,1960],{},"现在我们的 index.php 文件看起来是这样的",[13,1962,1963],{},"在 70 行左右的代码中，我们使用 PHP 创建了一个 RESTful API，很神奇吧？",[101,1965,1967],{"className":226,"code":1966,"language":228,"meta":110,"style":110},"\u003C?php\n$jsonFile = 'users.json';\n$data = file_get_contents($jsonFile);\n$users = json_decode($data, true);\n$uri = $_SERVER['REQUEST_URI'];\n$method = $_SERVER['REQUEST_METHOD'];\nswitch ($method | $uri) {\n   case ($method == 'GET' && $uri == '/api/users'):\n       header('Content-Type: application/json');\n       echo json_encode($users, JSON_PRETTY_PRINT);\n       break;\n   case ($method == 'GET' && preg_match('/\\/api\\/users\\/[1-9]/', $uri)):\n       header('Content-Type: application/json');\n       $id = basename($uri);\n       if (!array_key_exists($id, $users)) {\n           http_response_code(404);\n           echo json_encode(['error' => 'user does not exist']);\n           break;\n       }\n       $responseData = [$id => $users[$id]];\n       echo json_encode($responseData, JSON_PRETTY_PRINT);\n       break;\n   case ($method == 'POST' && $uri == '/api/users'):\n       header('Content-Type: application/json');\n       $requestBody = json_decode(file_get_contents('php://input'), true);\n       $name = $requestBody['name'];\n       if (empty($name)) {\n           http_response_code(404);\n           echo json_encode(['error' => 'Please add name of the user']);\n       }\n       $users[] = $name;\n       $data = json_encode($users, JSON_PRETTY_PRINT);\n       file_put_contents($jsonFile, $data);\n       echo json_encode(['message' => 'user added successfully']);\n       break;\n   case ($method == 'PUT' && preg_match('/\\/api\\/users\\/[1-9]/', $uri)):\n       header('Content-Type: application/json');\n       $id = basename($uri);\n       if (!array_key_exists($id, $users)) {\n           http_response_code(404);\n           echo json_encode(['error' => 'user does not exist']);\n           break;\n       }\n       $requestBody = json_decode(file_get_contents('php://input'), true);\n       $name = $requestBody['name'];\n       if (empty($name)) {\n           http_response_code(404);\n           echo json_encode(['error' => 'Please add name of the user']);\n       }\n       $users[$id] = $name;\n       $data = json_encode($users, JSON_PRETTY_PRINT);\n       file_put_contents($jsonFile, $data);\n       echo json_encode(['message' => 'user updated successfully']);\n       break;\n   case ($method == 'DELETE' && preg_match('/\\/api\\/users\\/[1-9]/', $uri)):\n       header('Content-Type: application/json');\n       $id = basename($uri);\n       if (empty($users[$id])) {\n           http_response_code(404);\n           echo json_encode(['error' => 'user does not exist']);\n           break;\n       }\n       unset($users[$id]);\n       $data = json_encode($users, JSON_PRETTY_PRINT);\n       file_put_contents($jsonFile, $data);\n       echo json_encode(['message' => 'user deleted successfully']);\n       break;\n   default:\n       http_response_code(404);\n       echo json_encode(['error' => \"We cannot find what you're looking for.\"]);\n       break;\n}\n",[108,1968,1969,1981,1992,2008,2026,2040,2054,2068,2090,2101,2117,2123,2161,2171,2186,2207,2218,2235,2242,2247,2268,2284,2290,2312,2322,2345,2360,2374,2384,2400,2404,2417,2436,2451,2467,2473,2511,2521,2535,2555,2566,2583,2590,2595,2618,2633,2648,2659,2676,2681,2698,2717,2732,2749,2756,2799,2810,2825,2844,2855,2872,2879,2884,2900,2919,2934,2951,2958,2965,2976,2994,3001],{"__ignoreMap":110},[157,1970,1971,1974,1978],{"class":159,"line":160},[157,1972,1973],{"class":378},"\u003C",[157,1975,1977],{"class":1976},"sblXP","?",[157,1979,1980],{"class":1012},"php\n",[157,1982,1983,1985,1987,1990],{"class":159,"line":166},[157,1984,918],{"class":245},[157,1986,379],{"class":378},[157,1988,1989],{"class":253}," 'users.json'",[157,1991,510],{"class":249},[157,1993,1994,1997,1999,2002,2004,2006],{"class":159,"line":172},[157,1995,1996],{"class":245},"$data",[157,1998,379],{"class":378},[157,2000,2001],{"class":241}," file_get_contents",[157,2003,549],{"class":249},[157,2005,918],{"class":245},[157,2007,921],{"class":249},[157,2009,2010,2012,2014,2016,2018,2020,2022,2024],{"class":159,"line":178},[157,2011,1007],{"class":245},[157,2013,379],{"class":378},[157,2015,1292],{"class":241},[157,2017,549],{"class":249},[157,2019,1996],{"class":245},[157,2021,572],{"class":249},[157,2023,1307],{"class":1141},[157,2025,921],{"class":249},[157,2027,2028,2030,2032,2034,2036,2038],{"class":159,"line":184},[157,2029,375],{"class":245},[157,2031,379],{"class":378},[157,2033,246],{"class":245},[157,2035,250],{"class":249},[157,2037,254],{"class":253},[157,2039,257],{"class":249},[157,2041,2042,2044,2046,2048,2050,2052],{"class":159,"line":276},[157,2043,392],{"class":245},[157,2045,379],{"class":378},[157,2047,246],{"class":245},[157,2049,250],{"class":249},[157,2051,359],{"class":253},[157,2053,257],{"class":249},[157,2055,2056,2058,2060,2062,2064,2066],{"class":159,"line":289},[157,2057,440],{"class":439},[157,2059,443],{"class":249},[157,2061,392],{"class":245},[157,2063,448],{"class":378},[157,2065,451],{"class":245},[157,2067,454],{"class":249},[157,2069,2070,2072,2074,2076,2078,2080,2082,2084,2086,2088],{"class":159,"line":295},[157,2071,479],{"class":439},[157,2073,443],{"class":249},[157,2075,392],{"class":245},[157,2077,486],{"class":378},[157,2079,489],{"class":253},[157,2081,492],{"class":378},[157,2083,451],{"class":245},[157,2085,486],{"class":378},[157,2087,499],{"class":253},[157,2089,502],{"class":249},[157,2091,2092,2095,2097,2099],{"class":159,"line":300},[157,2093,2094],{"class":241},"       header",[157,2096,549],{"class":249},[157,2098,992],{"class":253},[157,2100,921],{"class":249},[157,2102,2103,2105,2107,2109,2111,2113,2115],{"class":159,"line":306},[157,2104,1149],{"class":241},[157,2106,1002],{"class":241},[157,2108,549],{"class":249},[157,2110,1007],{"class":245},[157,2112,572],{"class":249},[157,2114,1013],{"class":1012},[157,2116,921],{"class":249},[157,2118,2119,2121],{"class":159,"line":319},[157,2120,507],{"class":439},[157,2122,510],{"class":249},[157,2124,2125,2127,2129,2131,2133,2135,2137,2139,2141,2143,2145,2147,2149,2151,2153,2155,2157,2159],{"class":159,"line":531},[157,2126,479],{"class":439},[157,2128,443],{"class":249},[157,2130,392],{"class":245},[157,2132,486],{"class":378},[157,2134,489],{"class":253},[157,2136,492],{"class":378},[157,2138,546],{"class":241},[157,2140,549],{"class":249},[157,2142,553],{"class":552},[157,2144,556],{"class":241},[157,2146,559],{"class":552},[157,2148,556],{"class":241},[157,2150,564],{"class":552},[157,2152,556],{"class":241},[157,2154,569],{"class":552},[157,2156,572],{"class":249},[157,2158,451],{"class":245},[157,2160,577],{"class":249},[157,2162,2163,2165,2167,2169],{"class":159,"line":580},[157,2164,2094],{"class":241},[157,2166,549],{"class":249},[157,2168,992],{"class":253},[157,2170,921],{"class":249},[157,2172,2173,2176,2178,2180,2182,2184],{"class":159,"line":587},[157,2174,2175],{"class":245},"       $id",[157,2177,379],{"class":378},[157,2179,1099],{"class":241},[157,2181,549],{"class":249},[157,2183,375],{"class":245},[157,2185,921],{"class":249},[157,2187,2188,2191,2193,2195,2197,2199,2201,2203,2205],{"class":159,"line":592},[157,2189,2190],{"class":439},"       if",[157,2192,443],{"class":249},[157,2194,1115],{"class":378},[157,2196,1118],{"class":241},[157,2198,549],{"class":249},[157,2200,1123],{"class":245},[157,2202,572],{"class":249},[157,2204,1128],{"class":245},[157,2206,1131],{"class":249},[157,2208,2209,2212,2214,2216],{"class":159,"line":598},[157,2210,2211],{"class":241},"           http_response_code",[157,2213,549],{"class":249},[157,2215,1142],{"class":1141},[157,2217,921],{"class":249},[157,2219,2220,2223,2225,2227,2229,2231,2233],{"class":159,"line":604},[157,2221,2222],{"class":241},"           echo",[157,2224,1002],{"class":241},[157,2226,1154],{"class":249},[157,2228,1157],{"class":253},[157,2230,1160],{"class":249},[157,2232,1163],{"class":253},[157,2234,1166],{"class":249},[157,2236,2237,2240],{"class":159,"line":609},[157,2238,2239],{"class":439},"           break",[157,2241,510],{"class":249},[157,2243,2244],{"class":159,"line":633},[157,2245,2246],{"class":249},"       }\n",[157,2248,2249,2252,2254,2256,2258,2260,2262,2264,2266],{"class":159,"line":640},[157,2250,2251],{"class":245},"       $responseData",[157,2253,379],{"class":378},[157,2255,1187],{"class":249},[157,2257,1123],{"class":245},[157,2259,1192],{"class":249},[157,2261,1007],{"class":245},[157,2263,250],{"class":249},[157,2265,1123],{"class":245},[157,2267,1201],{"class":249},[157,2269,2270,2272,2274,2276,2278,2280,2282],{"class":159,"line":645},[157,2271,1149],{"class":241},[157,2273,1002],{"class":241},[157,2275,549],{"class":249},[157,2277,1212],{"class":245},[157,2279,572],{"class":249},[157,2281,1013],{"class":1012},[157,2283,921],{"class":249},[157,2285,2286,2288],{"class":159,"line":651},[157,2287,507],{"class":439},[157,2289,510],{"class":249},[157,2291,2292,2294,2296,2298,2300,2302,2304,2306,2308,2310],{"class":159,"line":657},[157,2293,479],{"class":439},[157,2295,443],{"class":249},[157,2297,392],{"class":245},[157,2299,486],{"class":378},[157,2301,620],{"class":253},[157,2303,492],{"class":378},[157,2305,451],{"class":245},[157,2307,486],{"class":378},[157,2309,499],{"class":253},[157,2311,502],{"class":249},[157,2313,2314,2316,2318,2320],{"class":159,"line":662},[157,2315,2094],{"class":241},[157,2317,549],{"class":249},[157,2319,992],{"class":253},[157,2321,921],{"class":249},[157,2323,2324,2327,2329,2331,2333,2335,2337,2339,2341,2343],{"class":159,"line":702},[157,2325,2326],{"class":245},"       $requestBody",[157,2328,379],{"class":378},[157,2330,1292],{"class":241},[157,2332,549],{"class":249},[157,2334,913],{"class":241},[157,2336,549],{"class":249},[157,2338,1301],{"class":253},[157,2340,1304],{"class":249},[157,2342,1307],{"class":1141},[157,2344,921],{"class":249},[157,2346,2347,2350,2352,2354,2356,2358],{"class":159,"line":709},[157,2348,2349],{"class":245},"       $name",[157,2351,379],{"class":378},[157,2353,1319],{"class":245},[157,2355,250],{"class":249},[157,2357,1324],{"class":253},[157,2359,257],{"class":249},[157,2361,2362,2364,2366,2368,2370,2372],{"class":159,"line":714},[157,2363,2190],{"class":439},[157,2365,443],{"class":249},[157,2367,1335],{"class":241},[157,2369,549],{"class":249},[157,2371,1340],{"class":245},[157,2373,1131],{"class":249},[157,2375,2376,2378,2380,2382],{"class":159,"line":720},[157,2377,2211],{"class":241},[157,2379,549],{"class":249},[157,2381,1142],{"class":1141},[157,2383,921],{"class":249},[157,2385,2386,2388,2390,2392,2394,2396,2398],{"class":159,"line":726},[157,2387,2222],{"class":241},[157,2389,1002],{"class":241},[157,2391,1154],{"class":249},[157,2393,1157],{"class":253},[157,2395,1160],{"class":249},[157,2397,1367],{"class":253},[157,2399,1166],{"class":249},[157,2401,2402],{"class":159,"line":731},[157,2403,2246],{"class":249},[157,2405,2406,2409,2411,2413,2415],{"class":159,"line":777},[157,2407,2408],{"class":245},"       $users",[157,2410,1381],{"class":249},[157,2412,1384],{"class":378},[157,2414,1387],{"class":245},[157,2416,510],{"class":249},[157,2418,2419,2422,2424,2426,2428,2430,2432,2434],{"class":159,"line":784},[157,2420,2421],{"class":245},"       $data",[157,2423,379],{"class":378},[157,2425,1002],{"class":241},[157,2427,549],{"class":249},[157,2429,1007],{"class":245},[157,2431,572],{"class":249},[157,2433,1013],{"class":1012},[157,2435,921],{"class":249},[157,2437,2438,2441,2443,2445,2447,2449],{"class":159,"line":789},[157,2439,2440],{"class":241},"       file_put_contents",[157,2442,549],{"class":249},[157,2444,918],{"class":245},[157,2446,572],{"class":249},[157,2448,943],{"class":245},[157,2450,921],{"class":249},[157,2452,2453,2455,2457,2459,2461,2463,2465],{"class":159,"line":795},[157,2454,1149],{"class":241},[157,2456,1002],{"class":241},[157,2458,1154],{"class":249},[157,2460,1434],{"class":253},[157,2462,1160],{"class":249},[157,2464,1439],{"class":253},[157,2466,1166],{"class":249},[157,2468,2469,2471],{"class":159,"line":801},[157,2470,507],{"class":439},[157,2472,510],{"class":249},[157,2474,2475,2477,2479,2481,2483,2485,2487,2489,2491,2493,2495,2497,2499,2501,2503,2505,2507,2509],{"class":159,"line":807},[157,2476,479],{"class":439},[157,2478,443],{"class":249},[157,2480,392],{"class":245},[157,2482,486],{"class":378},[157,2484,673],{"class":253},[157,2486,492],{"class":378},[157,2488,546],{"class":241},[157,2490,549],{"class":249},[157,2492,553],{"class":552},[157,2494,556],{"class":241},[157,2496,559],{"class":552},[157,2498,556],{"class":241},[157,2500,564],{"class":552},[157,2502,556],{"class":241},[157,2504,569],{"class":552},[157,2506,572],{"class":249},[157,2508,451],{"class":245},[157,2510,577],{"class":249},[157,2512,2513,2515,2517,2519],{"class":159,"line":812},[157,2514,2094],{"class":241},[157,2516,549],{"class":249},[157,2518,992],{"class":253},[157,2520,921],{"class":249},[157,2522,2523,2525,2527,2529,2531,2533],{"class":159,"line":821},[157,2524,2175],{"class":245},[157,2526,379],{"class":378},[157,2528,1099],{"class":241},[157,2530,549],{"class":249},[157,2532,375],{"class":245},[157,2534,921],{"class":249},[157,2536,2537,2539,2541,2543,2545,2547,2549,2551,2553],{"class":159,"line":828},[157,2538,2190],{"class":439},[157,2540,443],{"class":249},[157,2542,1115],{"class":378},[157,2544,1118],{"class":241},[157,2546,549],{"class":249},[157,2548,1123],{"class":245},[157,2550,572],{"class":249},[157,2552,1128],{"class":245},[157,2554,1131],{"class":249},[157,2556,2558,2560,2562,2564],{"class":159,"line":2557},40,[157,2559,2211],{"class":241},[157,2561,549],{"class":249},[157,2563,1142],{"class":1141},[157,2565,921],{"class":249},[157,2567,2569,2571,2573,2575,2577,2579,2581],{"class":159,"line":2568},41,[157,2570,2222],{"class":241},[157,2572,1002],{"class":241},[157,2574,1154],{"class":249},[157,2576,1157],{"class":253},[157,2578,1160],{"class":249},[157,2580,1163],{"class":253},[157,2582,1166],{"class":249},[157,2584,2586,2588],{"class":159,"line":2585},42,[157,2587,2239],{"class":439},[157,2589,510],{"class":249},[157,2591,2593],{"class":159,"line":2592},43,[157,2594,2246],{"class":249},[157,2596,2598,2600,2602,2604,2606,2608,2610,2612,2614,2616],{"class":159,"line":2597},44,[157,2599,2326],{"class":245},[157,2601,379],{"class":378},[157,2603,1292],{"class":241},[157,2605,549],{"class":249},[157,2607,913],{"class":241},[157,2609,549],{"class":249},[157,2611,1301],{"class":253},[157,2613,1304],{"class":249},[157,2615,1307],{"class":1141},[157,2617,921],{"class":249},[157,2619,2621,2623,2625,2627,2629,2631],{"class":159,"line":2620},45,[157,2622,2349],{"class":245},[157,2624,379],{"class":378},[157,2626,1319],{"class":245},[157,2628,250],{"class":249},[157,2630,1324],{"class":253},[157,2632,257],{"class":249},[157,2634,2636,2638,2640,2642,2644,2646],{"class":159,"line":2635},46,[157,2637,2190],{"class":439},[157,2639,443],{"class":249},[157,2641,1335],{"class":241},[157,2643,549],{"class":249},[157,2645,1340],{"class":245},[157,2647,1131],{"class":249},[157,2649,2651,2653,2655,2657],{"class":159,"line":2650},47,[157,2652,2211],{"class":241},[157,2654,549],{"class":249},[157,2656,1142],{"class":1141},[157,2658,921],{"class":249},[157,2660,2662,2664,2666,2668,2670,2672,2674],{"class":159,"line":2661},48,[157,2663,2222],{"class":241},[157,2665,1002],{"class":241},[157,2667,1154],{"class":249},[157,2669,1157],{"class":253},[157,2671,1160],{"class":249},[157,2673,1367],{"class":253},[157,2675,1166],{"class":249},[157,2677,2679],{"class":159,"line":2678},49,[157,2680,2246],{"class":249},[157,2682,2684,2686,2688,2690,2692,2694,2696],{"class":159,"line":2683},50,[157,2685,2408],{"class":245},[157,2687,250],{"class":249},[157,2689,1123],{"class":245},[157,2691,1680],{"class":249},[157,2693,1384],{"class":378},[157,2695,1387],{"class":245},[157,2697,510],{"class":249},[157,2699,2701,2703,2705,2707,2709,2711,2713,2715],{"class":159,"line":2700},51,[157,2702,2421],{"class":245},[157,2704,379],{"class":378},[157,2706,1002],{"class":241},[157,2708,549],{"class":249},[157,2710,1007],{"class":245},[157,2712,572],{"class":249},[157,2714,1013],{"class":1012},[157,2716,921],{"class":249},[157,2718,2720,2722,2724,2726,2728,2730],{"class":159,"line":2719},52,[157,2721,2440],{"class":241},[157,2723,549],{"class":249},[157,2725,918],{"class":245},[157,2727,572],{"class":249},[157,2729,943],{"class":245},[157,2731,921],{"class":249},[157,2733,2735,2737,2739,2741,2743,2745,2747],{"class":159,"line":2734},53,[157,2736,1149],{"class":241},[157,2738,1002],{"class":241},[157,2740,1154],{"class":249},[157,2742,1434],{"class":253},[157,2744,1160],{"class":249},[157,2746,1733],{"class":253},[157,2748,1166],{"class":249},[157,2750,2752,2754],{"class":159,"line":2751},54,[157,2753,507],{"class":439},[157,2755,510],{"class":249},[157,2757,2759,2761,2763,2765,2767,2769,2771,2773,2775,2777,2779,2781,2783,2785,2787,2789,2791,2793,2795,2797],{"class":159,"line":2758},55,[157,2760,479],{"class":439},[157,2762,443],{"class":249},[157,2764,392],{"class":245},[157,2766,486],{"class":378},[157,2768,742],{"class":253},[157,2770,745],{"class":439},[157,2772,748],{"class":253},[157,2774,492],{"class":378},[157,2776,546],{"class":241},[157,2778,549],{"class":249},[157,2780,553],{"class":552},[157,2782,556],{"class":241},[157,2784,559],{"class":552},[157,2786,556],{"class":241},[157,2788,564],{"class":552},[157,2790,556],{"class":241},[157,2792,569],{"class":552},[157,2794,572],{"class":249},[157,2796,451],{"class":245},[157,2798,577],{"class":249},[157,2800,2802,2804,2806,2808],{"class":159,"line":2801},56,[157,2803,2094],{"class":241},[157,2805,549],{"class":249},[157,2807,992],{"class":253},[157,2809,921],{"class":249},[157,2811,2813,2815,2817,2819,2821,2823],{"class":159,"line":2812},57,[157,2814,2175],{"class":245},[157,2816,379],{"class":378},[157,2818,1099],{"class":241},[157,2820,549],{"class":249},[157,2822,375],{"class":245},[157,2824,921],{"class":249},[157,2826,2828,2830,2832,2834,2836,2838,2840,2842],{"class":159,"line":2827},58,[157,2829,2190],{"class":439},[157,2831,443],{"class":249},[157,2833,1335],{"class":241},[157,2835,549],{"class":249},[157,2837,1007],{"class":245},[157,2839,250],{"class":249},[157,2841,1123],{"class":245},[157,2843,1843],{"class":249},[157,2845,2847,2849,2851,2853],{"class":159,"line":2846},59,[157,2848,2211],{"class":241},[157,2850,549],{"class":249},[157,2852,1142],{"class":1141},[157,2854,921],{"class":249},[157,2856,2858,2860,2862,2864,2866,2868,2870],{"class":159,"line":2857},60,[157,2859,2222],{"class":241},[157,2861,1002],{"class":241},[157,2863,1154],{"class":249},[157,2865,1157],{"class":253},[157,2867,1160],{"class":249},[157,2869,1163],{"class":253},[157,2871,1166],{"class":249},[157,2873,2875,2877],{"class":159,"line":2874},61,[157,2876,2239],{"class":439},[157,2878,510],{"class":249},[157,2880,2882],{"class":159,"line":2881},62,[157,2883,2246],{"class":249},[157,2885,2887,2890,2892,2894,2896,2898],{"class":159,"line":2886},63,[157,2888,2889],{"class":241},"       unset",[157,2891,549],{"class":249},[157,2893,1007],{"class":245},[157,2895,250],{"class":249},[157,2897,1123],{"class":245},[157,2899,1166],{"class":249},[157,2901,2903,2905,2907,2909,2911,2913,2915,2917],{"class":159,"line":2902},64,[157,2904,2421],{"class":245},[157,2906,379],{"class":378},[157,2908,1002],{"class":241},[157,2910,549],{"class":249},[157,2912,1007],{"class":245},[157,2914,572],{"class":249},[157,2916,1013],{"class":1012},[157,2918,921],{"class":249},[157,2920,2922,2924,2926,2928,2930,2932],{"class":159,"line":2921},65,[157,2923,2440],{"class":241},[157,2925,549],{"class":249},[157,2927,918],{"class":245},[157,2929,572],{"class":249},[157,2931,943],{"class":245},[157,2933,921],{"class":249},[157,2935,2937,2939,2941,2943,2945,2947,2949],{"class":159,"line":2936},66,[157,2938,1149],{"class":241},[157,2940,1002],{"class":241},[157,2942,1154],{"class":249},[157,2944,1434],{"class":253},[157,2946,1160],{"class":249},[157,2948,1941],{"class":253},[157,2950,1166],{"class":249},[157,2952,2954,2956],{"class":159,"line":2953},67,[157,2955,507],{"class":439},[157,2957,510],{"class":249},[157,2959,2961,2963],{"class":159,"line":2960},68,[157,2962,815],{"class":439},[157,2964,818],{"class":249},[157,2966,2968,2970,2972,2974],{"class":159,"line":2967},69,[157,2969,1136],{"class":241},[157,2971,549],{"class":249},[157,2973,1142],{"class":1141},[157,2975,921],{"class":249},[157,2977,2979,2981,2983,2985,2987,2989,2992],{"class":159,"line":2978},70,[157,2980,1149],{"class":241},[157,2982,1002],{"class":241},[157,2984,1154],{"class":249},[157,2986,1157],{"class":253},[157,2988,1160],{"class":249},[157,2990,2991],{"class":253}," \"We cannot find what you're looking for.\"",[157,2993,1166],{"class":249},[157,2995,2997,2999],{"class":159,"line":2996},71,[157,2998,507],{"class":439},[157,3000,510],{"class":249},[157,3002,3004],{"class":159,"line":3003},72,[157,3005,831],{"class":249},[23,3007,3008],{"id":3008},"额外内容",[13,3010,3011],{},"在这种情况下，我不希望删除我的所有用户，所以我加了一个新的语句，如果只剩下最后一个用户，它将不会被删除，像这样",[101,3013,3015],{"className":226,"code":3014,"language":228,"meta":110,"style":110},"if (sizeof($users) == 1){\n   http_response_code(404);\n   echo json_encode(['error' => 'there is only one user left. you cannot delete it!']);\n   break;\n}\n",[108,3016,3017,3043,3054,3071,3077],{"__ignoreMap":110},[157,3018,3019,3022,3024,3027,3029,3031,3034,3037,3040],{"class":159,"line":160},[157,3020,3021],{"class":439},"if",[157,3023,443],{"class":249},[157,3025,3026],{"class":241},"sizeof",[157,3028,549],{"class":249},[157,3030,1007],{"class":245},[157,3032,3033],{"class":249},") ",[157,3035,3036],{"class":378},"==",[157,3038,3039],{"class":1141}," 1",[157,3041,3042],{"class":249},"){\n",[157,3044,3045,3048,3050,3052],{"class":159,"line":166},[157,3046,3047],{"class":241},"   http_response_code",[157,3049,549],{"class":249},[157,3051,1142],{"class":1141},[157,3053,921],{"class":249},[157,3055,3056,3058,3060,3062,3064,3066,3069],{"class":159,"line":172},[157,3057,999],{"class":241},[157,3059,1002],{"class":241},[157,3061,1154],{"class":249},[157,3063,1157],{"class":253},[157,3065,1160],{"class":249},[157,3067,3068],{"class":253}," 'there is only one user left. you cannot delete it!'",[157,3070,1166],{"class":249},[157,3072,3073,3075],{"class":159,"line":178},[157,3074,1020],{"class":439},[157,3076,510],{"class":249},[157,3078,3079],{"class":159,"line":184},[157,3080,831],{"class":249},[23,3082,3083],{"id":3083},"源码",[13,3085,3086,3087,3092],{},"你可以在",[17,3088,3091],{"href":3089,"rel":3090},"https://github.com/amirkamizi/php-simple-restful-api",[21],"原作者的 github"," 上看到完整注释的源代码以及 post man 集合",[23,3094,3095],{"id":3095},"总结",[13,3097,3098],{},"现在你知道如何在 PHP 中创建一个简单的 RESTful API。",[13,3100,3101],{},"我推荐你打开一个 PHP 文件并复习所有的这些我们进行的步骤，并且像本文一样添加一些额外的资源",[13,3103,3104],{},"如果你有任何的建议、问题或者观点，请联系文章原作者，他期待着听到你的声音。",[23,3106,3107],{"id":3107},"要点",[410,3109,3110,3113,3116,3119,3122],{},[54,3111,3112],{},"不使用框架，用 PHP 创建一个 RESTful API",[54,3114,3115],{},"在 PHP 中使用优雅的 URL",[54,3117,3118],{},"处理请求的 body",[54,3120,3121],{},"使用 Json 文件作为你的数据库",[54,3123,3124],{},"使用多个变量作为 switch 的关键词",[3126,3127,3128],"style",{},"html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html pre.shiki code .sW2Sy, html code.shiki .sW2Sy{--shiki-default:#A0A1A7;--shiki-default-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic}html pre.shiki code .s_Sar, html code.shiki .s_Sar{--shiki-default:#0184BC;--shiki-dark:#56B6C2}html pre.shiki code .sJa8x, html code.shiki .sJa8x{--shiki-default:#E45649;--shiki-dark:#E06C75}html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html pre.shiki code .sknuh, html code.shiki .sknuh{--shiki-default:#383A42;--shiki-dark:#56B6C2}html pre.shiki code .sLKXg, html code.shiki .sLKXg{--shiki-default:#A626A4;--shiki-dark:#C678DD}html pre.shiki code .sDaw7, html code.shiki .sDaw7{--shiki-default:#0184BC;--shiki-dark:#E06C75}html pre.shiki code .sxymB, html code.shiki .sxymB{--shiki-default:#986801;--shiki-dark:#ABB2BF}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html pre.shiki code .sblXP, html code.shiki .sblXP{--shiki-default:#383A42;--shiki-dark:#C678DD}",{"title":110,"searchDepth":166,"depth":166,"links":3130},[3131,3132,3133,3134,3138,3139,3140,3141,3142,3143,3144,3145,3146,3147,3148,3149,3150],{"id":25,"depth":166,"text":25},{"id":46,"depth":166,"text":46},{"id":68,"depth":166,"text":68},{"id":85,"depth":166,"text":86,"children":3135},[3136,3137],{"id":96,"depth":172,"text":96},{"id":136,"depth":172,"text":136},{"id":213,"depth":166,"text":214},{"id":338,"depth":166,"text":338},{"id":844,"depth":166,"text":844},{"id":954,"depth":166,"text":954},{"id":1031,"depth":166,"text":1031},{"id":1245,"depth":166,"text":1245},{"id":1462,"depth":166,"text":1462},{"id":1749,"depth":166,"text":1749},{"id":1957,"depth":166,"text":1957},{"id":3008,"depth":166,"text":3008},{"id":3083,"depth":166,"text":3083},{"id":3095,"depth":166,"text":3095},{"id":3107,"depth":166,"text":3107},"2023-12-12 13:07:32","md","zh-CN",{},"/2023/12/12/php-simple-rest-api","---\ntitle: 【翻译】使用 PHP 构建简单的 REST API\ndate: 2023-12-12 13:07:32\nsticky:\ntags:\n- Translation\n- PHP\n---\n\n> 我这学期有一门偏向前端的 WEB 课程，期末大作业要求使用 PHP 作为后端语言实现一个简单的影评系统，应该是不允许使用框架，使用中文关键字在搜索引擎上搜了一阵子似乎没有可供参考的案例，后来就找到了这篇博客，当中的许多观点与我不谋而合，因此我将这篇博客翻译成中文，原文戳这里: https://amirkamizi.com/blog/php-simple-rest-api\n\n## 介绍\n\n上周 @rapid_api 发了一个非常好的关于[使用 nodejs 和 express 创建 REST API](https://twitter.com/Rapid_API/status/1486423046424563714) 的教程帖子。我想要帮助你使用 PHP 开发同样简单的 REST API。\n\n首先，如果你不了解 REST API，请务必查看这个 [Twitter 帖子](https://twitter.com/Rapid_API/status/1452932706967461890)。\n\n## 目标\n\n在我们开始之前，我想提一句，当我写这篇帖子的时候，我想确保：\n\n1. 我使用单纯的 PHP，不使用框架\n2. 我使用最简单的函数和结构体以便所有人都可以理解并跟上\n3. 我将主体部分分开\n\n现在让我们开始吧\n\n## 准备\n\n在我本地的机器上，我创建了一个叫 api 的文件夹于 xampp > htdocs，在里面有一个叫 index.php 的文件\n\n如果你没有 xampp 或者你不知道如何把 php 跑起来，请务必查看[这篇文章](https://amirkamizi.com/blog/introduction-to-php)\n\n现在，如果你尝试访问 localhost/api，你将得到一个空的响应，因为 index.php 文件是空的\n\n## 优雅的 URL\n\n项目中，我们需要处理的第一件事是 url\n\nREST API 的关键特性之一是每一个 url 负责一个资源和一个操作\n\n### 问题\n\n这时候如果我创建一个 users.php，我需要访问\n\n```\nlocalhost/api/users.php\n```\n\n我需要为每一个 user id 创建一个新的文件\n\n```\nlocalhost/api/users/1.php\nlocalhost/api/users/2.php\n```\n\n以此类推。\n\n这种方案有两个问题\n\n1. 为每个用户创建一个新文件是非常无聊和耗时的\n2. 路由不优雅，每个路径后面都带有 .php\n\n### 解决方案\n\n让我们解决这个问题。\n\n正如我所提到的，我不想使用任何框架，并且我想使用最简单的、最让人能够理解的方案\n\n让我们看看如何解决这个问题\n\n在 api 文件夹下创建一个叫 .htaccess 的文件，并且将下面的文本复制进去\n\n```htaccess\nRewriteEngine On\nRewriteBase /api\nRewriteCond %{REQUEST_FILENAME} !-d\nRewriteCond %{REQUEST_FILENAME} !-f\nRewriteRule ^(.+)$ index.php [QSA,L]\n```\n\n我们告诉服务器，将所有指向 /api 的请求都转发到 index.php 文件\n\n现在，所有的 url 都指向 index.php 了，比如下面的 url 都是指向 index.php 的\n\n```\napi/users\napi/users/10\napi/users/5\n```\n\n现在我们同时解决了这两个问题\n\n1. 所有的 url 都被一个文件处理\n2. url 都很优雅，结尾处没有 .php\n\n## URI\n\n但如何知道用户请求的是哪个 uri 呢？\n\n很简单，使用 $_SERVER 超全局变量\n\n让我们来看一些例子\n\n```php\n// url api/users\necho $_SERVER['REQUEST_URI'];\n// /api/users\n\n// url api/users/5\necho $_SERVER['REQUEST_URI'];\n// /api/users/5\n\n// url api\necho $_SERVER['REQUEST_URI'];\n// /api\n```\n\n看见了吗？这就是我们所需要的\n\n现在，使用一个简单的 if 或者 switch 语句，我们就可以处理不同的路径了\n\n如果你从来没有用过这些语句，去读[这篇文章](https://amirkamizi.com/blog/php-conditionals)。\n\n## 请求方法\n\n接下来，我们需要从请求中获取请求的方法，以查看它是GET、POST、PUT、PATCH还是DELETE。\n\n你可以从 $_SERVER 超全局数组中获取这个信息。\n\n```php\n$_SERVER['REQUEST_METHOD']\n```\n\n让我们将这两个值存储在变量中：\n\n```php\n$uri = $_SERVER['REQUEST_URI'];\n$method = $_SERVER['REQUEST_METHOD'];\n```\n\n我们可以在一个简单的 switch 语句中使用这两个变量来处理不同的请求。\n\n我们需要判断以下请求\n\n- api/users 的 GET 请求\n- api/users/{id} 的 GET 请求\n- api/users 的 POST 请求\n- api/users/{id} 的 PUT 请求\n- api/users/{id} 的 DELETE 请求\n\n让我们编写针对上述请求的 switch 语句\n\n```php\nswitch ($method | $uri) {\n   /*\n   * Path: GET /api/users\n   * Task: show all the users\n   */\n   case ($method == 'GET' && $uri == '/api/users'):\n       break;\n   /*\n   * Path: GET /api/users/{id}\n   * Task: get one user\n   */\n   case ($method == 'GET' && preg_match('/\\/api\\/users\\/[1-9]/', $uri)):\n       break;\n   /*\n   * Path: POST /api/users\n   * Task: store one user\n   */\n   case ($method == 'POST' && $uri == '/api/users'):\n       break;\n   /*\n   * Path: PUT /api/users/{id}\n   * Task: update one user\n   */\n   case ($method == 'PUT' && preg_match('/\\/api\\/users\\/[1-9]/', $uri)):\n       break;\n   /*\n   * Path: DELETE /api/users/{id}\n   * Task: delete one user\n   */\n   case ($method == 'DELETE' && preg_match('/\\/api\\/users\\/[1-9]/', $uri)):\n       break;\n   /*\n   * Path: ?\n   * Task: this path doesn't match any of the defined paths\n   *      throw an error\n   */\n   default:\n       break;\n}\n```\n\n当我们想要在 switch 语句中使用两个变量，我们可以使用 | 符号\n\n如果你想知道 preg_match 是如何工作的，看[这篇文章](https://amirkamizi.com/blog/php-regular-expressions)。\n\n## 数据库\n\n现在是说说数据。储存数据的最好方法是将数据储存在数据库中。但在这篇教程中，我不想使用数据库。因此，我们使用一个 json 文件当作数据库来保证数据的持久性。\n\n我的 json 文件看起来长成这个样子：\n\n```json\n{\n   \"1\": \"Pratham\",\n   \"2\": \"Amir\"\n}\n```\n\n如果你想知道如何使用 json，看[这篇文章](https://amirkamizi.com/blog/php-xml-and-json)\n\n我加载 json 数据并将其转换为数组，然后在 php 使用他们。如果我想要更改数据，我将数组转换回 json 并将其重新写入文件。\n\n要将整个文件作为一个字符串读取并存储在变量中，我使用：\n\n```php\nfile_get_contents($jsonFile);\n```\n\n而要将json写入文件，我使用：\n\n```php\nfile_put_contents($jsonFile, $data);\n```\n\n好了，现在我们的数据库处理好了，让我们开始处理所有的路径。\n\n我使用 Postman 发送请求并查看响应。\n\n## 获取所有用户\n\n```php\ncase ($method == 'GET' && $uri == '/api/users'):\n   header('Content-Type: application/json');\n   echo json_encode($users, JSON_PRETTY_PRINT);\n   break;\n```\n\n![](https://static.031130.xyz/uploads/2024/08/12/6577fcdf64a96.webp)\n\n## 获取单个用户\n\n```php\ncase ($method == 'GET' && preg_match('/\\/api\\/users\\/[1-9]/', $uri)):\n   header('Content-Type: application/json');\n   // get the id\n   $id = basename($uri);\n   if (!array_key_exists($id, $users)) {\n       http_response_code(404);\n       echo json_encode(['error' => 'user does not exist']);\n       break;\n   }\n   $responseData = [$id => $users[$id]];\n   echo json_encode($responseData, JSON_PRETTY_PRINT);\n   break;\n```\n\n**basename**($uri) 会将 uri 的最后一部分给我。比如一个 api/users/10 这样的路径，它会返回 10.\n\n然后我使用 **array_key_exists** 检查是否存在一个 id 为 10 的用户\n\n![](https://static.031130.xyz/uploads/2024/08/12/6577fd77c3d06.webp)\n\n## 添加一个新用户\n\n```php\ncase ($method == 'POST' && $uri == '/api/users'):\n   header('Content-Type: application/json');\n   $requestBody = json_decode(file_get_contents('php://input'), true);\n   $name = $requestBody['name'];\n   if (empty($name)) {\n       http_response_code(404);\n       echo json_encode(['error' => 'Please add name of the user']);\n   }\n   $users[] = $name;\n   $data = json_encode($users, JSON_PRETTY_PRINT);\n   file_put_contents($jsonFile, $data);\n   echo json_encode(['message' => 'user added successfully']);\n   break;\n```\n\n我使用 **file_get_contents('php://input')** 以获取请求的 body 部分。由于在这个例子中我使用的是 json，我将会解码 json 以便我可以获取到名字。\n\n![](https://static.031130.xyz/uploads/2024/08/12/6577fdca88f76.webp)\n\n## 更新一个用户\n\n```php\ncase ($method == 'PUT' && preg_match('/\\/api\\/users\\/[1-9]/', $uri)):\n   header('Content-Type: application/json');\n   // get the id\n   $id = basename($uri);\n   if (!array_key_exists($id, $users)) {\n       http_response_code(404);\n       echo json_encode(['error' => 'user does not exist']);\n       break;\n   }\n   $requestBody = json_decode(file_get_contents('php://input'), true);\n   $name = $requestBody['name'];\n   if (empty($name)) {\n       http_response_code(404);\n       echo json_encode(['error' => 'Please add name of the user']);\n   }\n   $users[$id] = $name;\n   $data = json_encode($users, JSON_PRETTY_PRINT);\n   file_put_contents($jsonFile, $data);\n   echo json_encode(['message' => 'user updated successfully']);\n   break;\n```\n\n![](https://static.031130.xyz/uploads/2024/08/12/6577fdf646402.webp)\n\n## 删除一个用户\n\n```php\ncase ($method == 'DELETE' && preg_match('/\\/api\\/users\\/[1-9]/', $uri)):\n   header('Content-Type: application/json');\n   // get the id\n   $id = basename($uri);\n   if (empty($users[$id])) {\n       http_response_code(404);\n       echo json_encode(['error' => 'user does not exist']);\n       break;\n   }\n   unset($users[$id]);\n   $data = json_encode($users, JSON_PRETTY_PRINT);\n   file_put_contents($jsonFile, $data);\n   echo json_encode(['message' => 'user deleted successfully']);\n   break;\n```\n\n![](https://static.031130.xyz/uploads/2024/08/12/6577fe0c3a95b.webp)\n\n## 最终文件\n\n现在我们的 index.php 文件看起来是这样的\n\n在 70 行左右的代码中，我们使用 PHP 创建了一个 RESTful API，很神奇吧？\n\n```php\n\u003C?php\n$jsonFile = 'users.json';\n$data = file_get_contents($jsonFile);\n$users = json_decode($data, true);\n$uri = $_SERVER['REQUEST_URI'];\n$method = $_SERVER['REQUEST_METHOD'];\nswitch ($method | $uri) {\n   case ($method == 'GET' && $uri == '/api/users'):\n       header('Content-Type: application/json');\n       echo json_encode($users, JSON_PRETTY_PRINT);\n       break;\n   case ($method == 'GET' && preg_match('/\\/api\\/users\\/[1-9]/', $uri)):\n       header('Content-Type: application/json');\n       $id = basename($uri);\n       if (!array_key_exists($id, $users)) {\n           http_response_code(404);\n           echo json_encode(['error' => 'user does not exist']);\n           break;\n       }\n       $responseData = [$id => $users[$id]];\n       echo json_encode($responseData, JSON_PRETTY_PRINT);\n       break;\n   case ($method == 'POST' && $uri == '/api/users'):\n       header('Content-Type: application/json');\n       $requestBody = json_decode(file_get_contents('php://input'), true);\n       $name = $requestBody['name'];\n       if (empty($name)) {\n           http_response_code(404);\n           echo json_encode(['error' => 'Please add name of the user']);\n       }\n       $users[] = $name;\n       $data = json_encode($users, JSON_PRETTY_PRINT);\n       file_put_contents($jsonFile, $data);\n       echo json_encode(['message' => 'user added successfully']);\n       break;\n   case ($method == 'PUT' && preg_match('/\\/api\\/users\\/[1-9]/', $uri)):\n       header('Content-Type: application/json');\n       $id = basename($uri);\n       if (!array_key_exists($id, $users)) {\n           http_response_code(404);\n           echo json_encode(['error' => 'user does not exist']);\n           break;\n       }\n       $requestBody = json_decode(file_get_contents('php://input'), true);\n       $name = $requestBody['name'];\n       if (empty($name)) {\n           http_response_code(404);\n           echo json_encode(['error' => 'Please add name of the user']);\n       }\n       $users[$id] = $name;\n       $data = json_encode($users, JSON_PRETTY_PRINT);\n       file_put_contents($jsonFile, $data);\n       echo json_encode(['message' => 'user updated successfully']);\n       break;\n   case ($method == 'DELETE' && preg_match('/\\/api\\/users\\/[1-9]/', $uri)):\n       header('Content-Type: application/json');\n       $id = basename($uri);\n       if (empty($users[$id])) {\n           http_response_code(404);\n           echo json_encode(['error' => 'user does not exist']);\n           break;\n       }\n       unset($users[$id]);\n       $data = json_encode($users, JSON_PRETTY_PRINT);\n       file_put_contents($jsonFile, $data);\n       echo json_encode(['message' => 'user deleted successfully']);\n       break;\n   default:\n       http_response_code(404);\n       echo json_encode(['error' => \"We cannot find what you're looking for.\"]);\n       break;\n}\n```\n\n## 额外内容\n\n在这种情况下，我不希望删除我的所有用户，所以我加了一个新的语句，如果只剩下最后一个用户，它将不会被删除，像这样\n```php\nif (sizeof($users) == 1){\n   http_response_code(404);\n   echo json_encode(['error' => 'there is only one user left. you cannot delete it!']);\n   break;\n}\n```\n\n## 源码\n\n你可以在[原作者的 github](https://github.com/amirkamizi/php-simple-restful-api) 上看到完整注释的源代码以及 post man 集合\n\n## 总结\n\n现在你知道如何在 PHP 中创建一个简单的 RESTful API。\n\n我推荐你打开一个 PHP 文件并复习所有的这些我们进行的步骤，并且像本文一样添加一些额外的资源\n\n如果你有任何的建议、问题或者观点，请联系文章原作者，他期待着听到你的声音。\n\n## 要点\n\n- 不使用框架，用 PHP 创建一个 RESTful API\n- 在 PHP 中使用优雅的 URL\n- 处理请求的 body\n- 使用 Json 文件作为你的数据库\n- 使用多个变量作为 switch 的关键词\n",{"title":5,"description":110},"posts/zh/php-simple-rest-api",false,[3161,3162],"Translation","PHP","Uqo_uS4IEdIZkT2AyegBSpflONxT-0FoH1Vu9L-K1k8",[3165,3170],{"title":3166,"path":3167,"stem":3168,"date":3169,"lang":3153,"children":-1},"vuejs、php、caddy 与 docker —— web 期末大作业上云部署","/2023/12/27/php-and-vuejs-project-deploy-on-caddy","posts/zh/php-and-vuejs-project-deploy-on-caddy","2023-12-27 22:09:00",{"title":3171,"path":3172,"stem":3173,"date":3174,"lang":3153,"children":-1},"在 Hexo Fluid 主题中使用霞鹜文楷","/2023/11/28/use-lxgw-wenkai-in-hexo-fluid","posts/zh/use-lxgw-wenkai-in-hexo-fluid","2023-11-28 00:16:23",null,1763660340502]
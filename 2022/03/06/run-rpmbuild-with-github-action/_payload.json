[{"data":1,"prerenderedAt":102},["ShallowReactive",2],{"post-2022-03-06-run-rpmbuild-with-github-action-zh":3,"surround-2022-03-06-run-rpmbuild-with-github-action-zh":88,"randomIndex/2022/03/06/run-rpmbuild-with-github-action/":100,"language-switch-/2022/03/06/run-rpmbuild-with-github-action/-en":101},{"title":4,"date":5,"path":6,"tags":7,"body":11,"description":17},"使用 Github Action 跑 rpmbuild","2022-03-06 16:02:54","/2022/03/06/run-rpmbuild-with-github-action",[8,9,10],"Fedora","RPM Package","Github Action",{"type":12,"value":13,"toc":85},"minimark",[14,18,21,38,41,60,67,76],[15,16,17],"p",{},"一直打算用 Github Action 跑 rpmbuild 构建 rpm 包，然后传到 Action 的 Artifacts 里面，用户就可以在登陆 Github 帐号的情况下进行下载。只要不发 Release，应该就不算「再分发」的行为，也就自然规避了再分发闭源软件的法律风险。",[15,19,20],{},"然而，现有的那些 Action 几乎全都是针对 CentOS 老古董定制的，，有些甚至连 buildrequires 都不帮你安装，而且大部分情况下都不支持 Source 直接填写一个链接，需要你直接提供 Source 文件。我自己又不可能在 Github 的仓库里用 lfs 强行存一个 200MB+ 的二进制文件，显然是不符合我要求的。还有几个项目使用 mock 去构建的，但使用 mock 构建需要提前用 rpmbuild 生成 srpm，在我们的个人电脑上可以理解为用一个干净的 chroot 打包防止自己的环境受污染，但在一个全新的、用完一次就要扔掉的 docker 里面还要防止环境被污染似乎有些画蛇添足的嫌疑。",[15,22,23,24,31,32,37],{},"最终，我选择了 ",[25,26,30],"a",{"href":27,"rel":28},"https://github.com/marketplace/actions/rpm-build",[29],"nofollow","naveenrajm7/rpmbuild"," 这个项目。（虽然我并不理解为什么他要用 nodejs 去调用系统命令去执行 rpmbuild 等一系列步骤，我也没学过这类语言。不过项目的 ",[25,33,36],{"href":34,"rel":35},"https://github.com/naveenrajm7/rpmbuild/blob/master/src/main.ts",[29],"main.ts"," 我还是能仿写的。）",[15,39,40],{},"在经过三四个小时的摸爬滚打下，我还是成功地将这个项目按照我的想法改完了。",[42,43,44,48,51,54,57],"ul",{},[45,46,47],"li",{},"采用 Fedora 35 作为 host 进行 rpmbuild",[45,49,50],{},"自动安装 buildrequires",[45,52,53],{},"自动下载 source",[45,55,56],{},"允许仓库内自带本地 source",[45,58,59],{},"移除针对 srpm 的构建",[15,61,62],{},[63,64],"img",{"alt":65,"src":66},"","https://static.031130.xyz/uploads/2024/08/12/bb263c91c7bf4.webp",[15,68,69,70,75],{},"改完后的 action 在 ",[25,71,74],{"href":72,"rel":73},"https://github.com/zhullyb/rpmbuild-github-action",[29],"zhullyb/rpmbuild-github-action","，欢迎使用。",[15,77,78,79,84],{},"最终是在 ",[25,80,83],{"href":81,"rel":82},"https://github.com/zhullyb/dingtalk-for-fedora",[29],"zhullyb/dingtalk-for-fedora"," 项目成功实装了，有兴趣的访客们可以去尝试着一起来白嫖 Github Action 呀！ >_\u003C",{"title":65,"searchDepth":86,"depth":86,"links":87},2,[],[89,95],{"title":90,"path":91,"stem":92,"date":93,"lang":94,"children":-1},"抛弃PicGo，直接使用curl将图片上传到LskyPro","/2022/03/31/upload-pic-to-lskypro-with-curl","posts/zh/upload-pic-to-lskypro-with-curl","2022-03-31 19:19:14","zh-CN",{"title":96,"path":97,"stem":98,"date":99,"lang":94,"children":-1},"如何打出一个「-git」的rpm包","/2022/02/07/how-to-package-a-git-rpm-package","posts/zh/how-to-package-a-git-rpm-package","2022-02-07 10:23:29",10,null,1766437536762]
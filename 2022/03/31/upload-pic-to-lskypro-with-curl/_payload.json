[{"data":1,"prerenderedAt":507},["ShallowReactive",2],{"post-2022-03-31-upload-pic-to-lskypro-with-curl-zh":3,"surround-2022-03-31-upload-pic-to-lskypro-with-curl-zh":494,"randomIndex/2022/03/31/upload-pic-to-lskypro-with-curl/":114,"language-switch-/2022/03/31/upload-pic-to-lskypro-with-curl/-en":506},{"title":4,"date":5,"path":6,"tags":7,"body":11,"description":493},"抛弃PicGo，直接使用curl将图片上传到LskyPro","2022-03-31 19:19:14","/2022/03/31/upload-pic-to-lskypro-with-curl",[8,9,10],"Shell Script","Image Hosting","Lsky Pro",{"type":12,"value":13,"toc":491},"minimark",[14,23,44,57,66,73,76,79,92,95,470,476,479,482,487],[15,16,17,18,22],"p",{},"前一阵子为了图床折腾了好长一段时间。刚开始用的是 cloudinary，虽然每月有限制，但强在境内访问速度还不错，可惜后来 ",[19,20,21],"code",{},"res.cloudinary.com"," 这个域名在某些地方被 DNS 污染了，而自定义域名是付费版的功能，就不得不放弃了。",[15,24,25,26,29,30,37,38,43],{},"后来也尝试过 npm图床 的方案，可惜面对这种滥用公共资源的行为我无法接受~~（肯定不是因为受不了那繁琐的上传步骤，随便传张图都得 bump 下版本号的原因）~~，而且现在境内的能作为图床使用的 npm 镜像似乎也就只剩下 ",[19,27,28],{},"npm.elemecdn.com"," 这一个能够正常回源了，没准哪天就用不了了，所以就去投奔了",[31,32,36],"a",{"href":33,"rel":34},"https://dusays.com/",[35],"nofollow","杜老师","的",[31,39,42],{"href":40,"rel":41},"https://7bu.top/",[35],"去不图床","。",[15,45,46,47,51,52,56],{},"去不图床采用开源图床程序 ",[31,48,10],{"href":49,"rel":50},"https://www.lsky.pro/",[35]," 搭建，没有免费服务，且配置了鉴黄服务，看起来就是打算长久做下去的图床站点。境内使用腾讯云cdn，境外采用 cloudflare cdn，速度都挺让我满意的。",[53,54,55],"del",{},"（杜老师看见请给我打钱，或者多送我点空间也行","（x",[15,58,59,60,65],{},"Typora 一直是我写博客的主用 Markdown 编辑器，之前我采用 Typora 调用 ",[31,61,64],{"href":62,"rel":63},"https://github.com/xiebruce/PicUploader",[35],"PicUploader(php)"," 自动上传图片的方案写博客，体验相当不错，如图:",[15,67,68],{},[69,70],"img",{"alt":71,"src":72},"","https://static.031130.xyz/uploads/2024/08/12/62f3b881e3c4c.gif",[15,74,75],{},"可惜 PicUploader 目前仍然没有支持 LskyPro 的上传，我采用的是现在烂大街的 Typora+PicGo+LskyPro插件 的方案去实现 Typora 的自动上传图片功能。",[15,77,78],{},"这个方案有明显的弊端：",[80,81,82,86,89],"ul",{},[83,84,85],"li",{},"PicGo 运行依赖于 electron，极大地消耗了系统资源。",[83,87,88],{},"PicGo 面对多张图片( >=4张 )同时上传时容易报错。",[83,90,91],{},"PicGo 对于 Linux 的支持比较有限，作者可能不熟悉 Linux，直到半个月前我去交了一个 pr 才支持 wayland 下使用 wl-clipboard 将图片链接复制到粘贴版。",[15,93,94],{},"正好 LskyPro 有详细的文档，应该可以用 curl 手糊一段 Shell 脚本实现直接上传，资源占用小，唯一的弊端是上传完成后的图片不容易管理。脚本如下",[96,97,101],"pre",{"className":98,"code":99,"language":100,"meta":71,"style":71},"language-bash shiki shiki-themes one-light one-dark-pro","#!/bin/bash\n\nAPI_URL=\"https://7bu.top/api/v1\"\n\nAUTH_TOKEN=\"\"\n\nmarkdown=false\nwhile [[ \"$#\" -gt 0 ]]; do\n    case $1 in\n        -m|--markdown) markdown=true; shift ;;\n        *) break ;;\n    esac\ndone\n\nfor images in \"$@\"; do\n    UPLOAD_RESPONSE=$(curl -s -X POST \"$API_URL/upload\" \\\n        -H 'Content-Type: multipart/form-data' \\\n        -H \"Authorization: Bearer $AUTH_TOKEN\" \\\n        -F \"file=@$images\")\n\n    if [ \"$markdown\" = true ]; then\n        echo \"$UPLOAD_RESPONSE\" | jq -r .data.links.markdown\n    else\n        echo \"$UPLOAD_RESPONSE\" | jq -r .data.links.url\n    fi\ndone\n","bash",[19,102,103,112,119,134,139,150,155,166,199,212,245,256,262,268,273,297,332,343,358,375,380,408,433,439,459,465],{"__ignoreMap":71},[104,105,108],"span",{"class":106,"line":107},"line",1,[104,109,111],{"class":110},"sW2Sy","#!/bin/bash\n",[104,113,115],{"class":106,"line":114},2,[104,116,118],{"emptyLinePlaceholder":117},true,"\n",[104,120,122,126,130],{"class":106,"line":121},3,[104,123,125],{"class":124},"sJa8x","API_URL",[104,127,129],{"class":128},"sknuh","=",[104,131,133],{"class":132},"sDhpE","\"https://7bu.top/api/v1\"\n",[104,135,137],{"class":106,"line":136},4,[104,138,118],{"emptyLinePlaceholder":117},[104,140,142,145,147],{"class":106,"line":141},5,[104,143,144],{"class":124},"AUTH_TOKEN",[104,146,129],{"class":128},[104,148,149],{"class":132},"\"\"\n",[104,151,153],{"class":106,"line":152},6,[104,154,118],{"emptyLinePlaceholder":117},[104,156,158,161,163],{"class":106,"line":157},7,[104,159,160],{"class":124},"markdown",[104,162,129],{"class":128},[104,164,165],{"class":132},"false\n",[104,167,169,173,177,180,184,186,189,193,196],{"class":106,"line":168},8,[104,170,172],{"class":171},"sLKXg","while",[104,174,176],{"class":175},"s5ixo"," [[ ",[104,178,179],{"class":132},"\"",[104,181,183],{"class":182},"s2QsP","$#",[104,185,179],{"class":132},[104,187,188],{"class":128}," -gt",[104,190,192],{"class":191},"sAGMh"," 0",[104,194,195],{"class":175}," ]]; ",[104,197,198],{"class":171},"do\n",[104,200,202,205,209],{"class":106,"line":201},9,[104,203,204],{"class":171},"    case",[104,206,208],{"class":207},"s8iYz"," $1",[104,210,211],{"class":171}," in\n",[104,213,215,219,222,225,228,230,232,235,238,242],{"class":106,"line":214},10,[104,216,218],{"class":217},"sDaw7","        -m",[104,220,221],{"class":175},"|",[104,223,224],{"class":217},"--markdown",[104,226,227],{"class":175},") ",[104,229,160],{"class":124},[104,231,129],{"class":128},[104,233,234],{"class":132},"true",[104,236,237],{"class":175},"; ",[104,239,241],{"class":240},"s_Sar","shift",[104,243,244],{"class":175}," ;;\n",[104,246,248,251,254],{"class":106,"line":247},11,[104,249,250],{"class":175},"        *) ",[104,252,253],{"class":171},"break",[104,255,244],{"class":175},[104,257,259],{"class":106,"line":258},12,[104,260,261],{"class":171},"    esac\n",[104,263,265],{"class":106,"line":264},13,[104,266,267],{"class":171},"done\n",[104,269,271],{"class":106,"line":270},14,[104,272,118],{"emptyLinePlaceholder":117},[104,274,276,279,282,285,288,291,293,295],{"class":106,"line":275},15,[104,277,278],{"class":171},"for",[104,280,281],{"class":124}," images",[104,283,284],{"class":171}," in",[104,286,287],{"class":132}," \"",[104,289,290],{"class":207},"$@",[104,292,179],{"class":132},[104,294,237],{"class":175},[104,296,198],{"class":171},[104,298,300,303,305,308,312,315,318,321,323,326,329],{"class":106,"line":299},16,[104,301,302],{"class":124},"    UPLOAD_RESPONSE",[104,304,129],{"class":128},[104,306,307],{"class":175},"$(",[104,309,311],{"class":310},"sAdtL","curl",[104,313,314],{"class":191}," -s",[104,316,317],{"class":191}," -X",[104,319,320],{"class":132}," POST",[104,322,287],{"class":132},[104,324,325],{"class":124},"$API_URL",[104,327,328],{"class":132},"/upload\"",[104,330,331],{"class":240}," \\\n",[104,333,335,338,341],{"class":106,"line":334},17,[104,336,337],{"class":191},"        -H",[104,339,340],{"class":132}," 'Content-Type: multipart/form-data'",[104,342,331],{"class":240},[104,344,346,348,351,354,356],{"class":106,"line":345},18,[104,347,337],{"class":191},[104,349,350],{"class":132}," \"Authorization: Bearer ",[104,352,353],{"class":124},"$AUTH_TOKEN",[104,355,179],{"class":132},[104,357,331],{"class":240},[104,359,361,364,367,370,372],{"class":106,"line":360},19,[104,362,363],{"class":191},"        -F",[104,365,366],{"class":132}," \"file=@",[104,368,369],{"class":124},"$images",[104,371,179],{"class":132},[104,373,374],{"class":175},")\n",[104,376,378],{"class":106,"line":377},20,[104,379,118],{"emptyLinePlaceholder":117},[104,381,383,386,389,391,394,396,399,402,405],{"class":106,"line":382},21,[104,384,385],{"class":171},"    if",[104,387,388],{"class":175}," [ ",[104,390,179],{"class":132},[104,392,393],{"class":124},"$markdown",[104,395,179],{"class":132},[104,397,398],{"class":128}," =",[104,400,401],{"class":191}," true",[104,403,404],{"class":175}," ]; ",[104,406,407],{"class":171},"then\n",[104,409,411,414,416,419,421,424,427,430],{"class":106,"line":410},22,[104,412,413],{"class":240},"        echo",[104,415,287],{"class":132},[104,417,418],{"class":124},"$UPLOAD_RESPONSE",[104,420,179],{"class":132},[104,422,423],{"class":175}," | ",[104,425,426],{"class":310},"jq",[104,428,429],{"class":191}," -r",[104,431,432],{"class":132}," .data.links.markdown\n",[104,434,436],{"class":106,"line":435},23,[104,437,438],{"class":171},"    else\n",[104,440,442,444,446,448,450,452,454,456],{"class":106,"line":441},24,[104,443,413],{"class":240},[104,445,287],{"class":132},[104,447,418],{"class":124},[104,449,179],{"class":132},[104,451,423],{"class":175},[104,453,426],{"class":310},[104,455,429],{"class":191},[104,457,458],{"class":132}," .data.links.url\n",[104,460,462],{"class":106,"line":461},25,[104,463,464],{"class":171},"    fi\n",[104,466,468],{"class":106,"line":467},26,[104,469,267],{"class":171},[471,472,473],"blockquote",{},[15,474,475],{},"2022/04/02更新: 第六行 $@ - \"$@\"，解决文件名中出现空格时导致的上传失败问题。",[15,477,478],{},"需要借助 jq 来读取返回的 json，各 Linux 发行版源内应该都有打包，自行安装即可。",[15,480,481],{},"授予x可执行权限后，Typora 内直接填写自定义命令输入脚本所在位置即可实现 Typora 自动上传图片了。",[471,483,484],{},[15,485,486],{},"2023/12/12更新: 支持 -m 或 --markdown 参数，使脚本输出 markdown 格式的链接。",[488,489,490],"style",{},"html pre.shiki code .sW2Sy, html code.shiki .sW2Sy{--shiki-default:#A0A1A7;--shiki-default-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic}html pre.shiki code .sJa8x, html code.shiki .sJa8x{--shiki-default:#E45649;--shiki-dark:#E06C75}html pre.shiki code .sknuh, html code.shiki .sknuh{--shiki-default:#383A42;--shiki-dark:#56B6C2}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html pre.shiki code .sLKXg, html code.shiki .sLKXg{--shiki-default:#A626A4;--shiki-dark:#C678DD}html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html pre.shiki code .s2QsP, html code.shiki .s2QsP{--shiki-default:#E45649;--shiki-dark:#E5C07B}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html pre.shiki code .s8iYz, html code.shiki .s8iYz{--shiki-default:#383A42;--shiki-default-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic}html pre.shiki code .sDaw7, html code.shiki .sDaw7{--shiki-default:#0184BC;--shiki-dark:#E06C75}html pre.shiki code .s_Sar, html code.shiki .s_Sar{--shiki-default:#0184BC;--shiki-dark:#56B6C2}html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}",{"title":71,"searchDepth":114,"depth":114,"links":492},[],"前一阵子为了图床折腾了好长一段时间。刚开始用的是 cloudinary，虽然每月有限制，但强在境内访问速度还不错，可惜后来 res.cloudinary.com 这个域名在某些地方被 DNS 污染了，而自定义域名是付费版的功能，就不得不放弃了。",[495,501],{"title":496,"path":497,"stem":498,"date":499,"lang":500,"children":-1},"好软推荐——FastOCR","/2022/04/14/fastocr-experience","posts/zh/fastocr-experience","2022-04-14 05:55:18","zh-CN",{"title":502,"path":503,"stem":504,"date":505,"lang":500,"children":-1},"使用 Github Action 跑 rpmbuild","/2022/03/06/run-rpmbuild-with-github-action","posts/zh/run-rpmbuild-with-github-action","2022-03-06 16:02:54",null,1765391922218]
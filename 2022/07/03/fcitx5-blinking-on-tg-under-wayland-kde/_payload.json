[{"data":1,"prerenderedAt":253},["ShallowReactive",2],{"post-2022-07-03-fcitx5-blinking-on-tg-under-wayland-kde-zh":3,"surround-2022-07-03-fcitx5-blinking-on-tg-under-wayland-kde-zh":240,"randomIndex/2022/07/03/fcitx5-blinking-on-tg-under-wayland-kde/":144,"language-switch-/2022/07/03/fcitx5-blinking-on-tg-under-wayland-kde/-en":252},{"title":4,"date":5,"path":6,"tags":7,"body":11,"description":137},"处理 fcitx5 的文字候选框在 tg 客户端上闪烁的问题","2022-07-03 13:52:44","/2022/07/03/fcitx5-blinking-on-tg-under-wayland-kde",[8,9,10],"Linux","Notes","KDE",{"type":12,"value":13,"toc":228},"minimark",[14,29,33,36,43,46,49,59,62,65,68,74,82,93,96,99,102,105,120,123,127,131,162,165,173,176,180,186,189,196,203,210,224],[15,16,17],"blockquote",{},[18,19,20,21,28],"p",{},"文章开头，先要感谢 fcitx5 的开发者 ",[22,23,27],"a",{"href":24,"rel":25},"https://www.csslayer.info/wordpress/",[26],"nofollow","老K"," 帮我 debug 这个问题",[30,31,32],"h2",{"id":32},"鬼畜的文字候选框",[18,34,35],{},"在新装的 Fedora 36 KDE Wayland 下使用 fcitx5 时遇到了文字候选框前后移动晃眼的问题（如下图）",[18,37,38],{},[39,40],"img",{"alt":41,"src":42},"fcitx5 blinking","https://static.031130.xyz/uploads/2024/08/12/62c13162a6efc.gif",[30,44,45],{"id":45},"解决方案",[18,47,48],{},"当我向老K提出这个问题上的时候，老K告诉我这是预期行为，一共有两个解决方案。",[50,51,52,56],"ul",{},[53,54,55],"li",{},"使用 qt 的 text input",[53,57,58],{},"关掉 kwin 的淡入淡出特效",[18,60,61],{},"但由于我并不熟悉 KWin 的特效，所以我选择了前者的方案。",[18,63,64],{},"首先，需要确保自己的 Plasma 版本在 5.24 或以上，fcitx5 的版本号在 5.0.14 以上。",[18,66,67],{},"然后我们需要让 KWin 去启动 fcitx5。KCM 为此提供了一个非常简单的方式，如下图",[18,69,70],{},[39,71],{"alt":72,"src":73},"选择 fcitx5 就好啦","https://static.031130.xyz/uploads/2024/08/12/62c134907ada9.webp",[18,75,76,77,81],{},"随后需要确保环境变量没有设置 ",[78,79,80],"code",{},"QT_IM_MODULE ","。一定要确保这个变量不存在，连空也不行，必须是 unset。",[18,83,84,85,88,89,92],{},"理论上来说，是不需要重启的，但我的环境变量是 ",[78,86,87],{},"fcitx5-autostart"," 这个 rpm 包在 ",[78,90,91],{},"/etc/profile.d/fcitx5.sh","里面设置的，我需要重启系统来使新的环境变量生效。",[18,94,95],{},"重启后，如果没有什么意外的话，就算成功了。",[30,97,98],{"id":98},"绝对不会缺席的意外",[18,100,101],{},"很遗憾，我遇到了意外。",[18,103,104],{},"完成上述操作后，文字候选框依然有问题。",[18,106,107,108,111,112,115,116,119],{},"在老K的正确推测下，是因为我在 Fedora 下曾经使用过 ",[78,109,110],{},"im-settings","，该程序在 ",[78,113,114],{},"$HOME/.config/environment.d/"," 路径下重新帮我设置回了 ",[78,117,118],{},"QT_IM_MODULE"," 这个变量，从而使得 tg 启动时还在使用 IM MODULE，而不是预期的 qt text input。",[18,121,122],{},"删除这两个影响环境变量的文件后，在 tg 输入时，fcitx5 的文字候选框恢复了正常。",[30,124,126],{"id":125},"debug-过程中用到的两个方式","debug 过程中用到的两个方式",[128,129,130],"h3",{"id":130},"dbus-send",[132,133,138],"pre",{"className":134,"code":135,"language":136,"meta":137,"style":137},"language-bash shiki shiki-themes one-light one-dark-pro","dbus-send --print-reply=literal --dest=org.fcitx.Fcitx5 /controller org.fcitx.Fcitx.Controller1.DebugInfo\n","bash","",[78,139,140],{"__ignoreMap":137},[141,142,145,148,152,155,159],"span",{"class":143,"line":144},"line",1,[141,146,130],{"class":147},"sAdtL",[141,149,151],{"class":150},"sAGMh"," --print-reply=literal",[141,153,154],{"class":150}," --dest=org.fcitx.Fcitx5",[141,156,158],{"class":157},"sDhpE"," /controller",[141,160,161],{"class":157}," org.fcitx.Fcitx.Controller1.DebugInfo\n",[18,163,164],{},"运行如上命令后，我得到了如下的输出",[132,166,171],{"className":167,"code":169,"language":170},[168],"language-text","   Group [x11::1] has 0 InputContext(s)\nGroup [wayland:] has 5 InputContext(s)\n  IC [a50fe208d42e4611b240c0b66a2fa0b9] program:konsole frontend:dbus cap:e001800060 focus:1\n  IC [d7d4d5c05e9c445aab1af9c7dfb5fbd4] program:telegram-desktop frontend:dbus cap:e001800060 focus:0\n  IC [ac72ec3edf58481bbdf838352520efd5] program:krunner frontend:dbus cap:e001820060 focus:0\n  IC [d8b450176e204953837248f786204c29] program:plasmashell frontend:dbus cap:e001800060 focus:0\n  IC [df252979343d42ebbe9bd82ead6ff194] program: frontend:wayland cap:40 focus:0\nInput Context without group\n","text",[78,172,169],{"__ignoreMap":137},[18,174,175],{},"老K指出，出现了 telegram 的那一行表明 tg 还是在用 IM Module，所以是环境变量有问题",[128,177,179],{"id":178},"proc-查看程序运行时的环境变量","/proc 查看程序运行时的环境变量",[18,181,182],{},[39,183],{"alt":184,"src":185},"获取到的环境变量","https://static.031130.xyz/uploads/2024/08/12/62c138b030469.webp",[30,187,188],{"id":188},"参考资料",[18,190,191],{},[22,192,195],{"href":193,"rel":194},"https://www.csslayer.info/wordpress/linux/use-plasma-5-24-to-type-in-alacritty-or-any-other-text-input-v3-client-with-fcitx-5-on-wayland/",[26],"Use Plasma 5.24 to type in Alacritty (Or any other text-input-v3 client) with Fcitx 5 on Wayland",[18,197,198],{},[22,199,202],{"href":200,"rel":201},"https://fcitx-im.org/wiki/FAQ#Candidate_window_is_blinking_under_wayland_with_Fcitx_5",[26],"Candidate window is blinking under wayland with Fcitx 5",[18,204,205],{},[22,206,209],{"href":207,"rel":208},"https://www.cnblogs.com/hupeng1234/p/6735403.html",[26],"查看进程的环境变量",[18,211,212],{},[213,214,215,216,219,220,223],"em",{},"注: 上述参考资料均已在 ",[78,217,218],{},"web.archive.org"," 和 ",[78,221,222],{},"archive.ph"," 做过存档，如遇到原站点无法访问的情况，可自行前往这两个站点查看存档。",[225,226,227],"style",{},"html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}",{"title":137,"searchDepth":229,"depth":229,"links":230},2,[231,232,233,234,239],{"id":32,"depth":229,"text":32},{"id":45,"depth":229,"text":45},{"id":98,"depth":229,"text":98},{"id":125,"depth":229,"text":126,"children":235},[236,238],{"id":130,"depth":237,"text":130},3,{"id":178,"depth":237,"text":179},{"id":188,"depth":229,"text":188},[241,247],{"title":242,"path":243,"stem":244,"date":245,"lang":246,"children":-1},"如何拯救失声的 hollywood","/2022/07/25/restore-the-sound-of-hollywood","posts/zh/restore-the-sound-of-hollywood","2022-07-25 11:25:44","zh-CN",{"title":248,"path":249,"stem":250,"date":251,"lang":246,"children":-1},"使用caddy反向代理维基百科中文站点","/2022/05/30/use-caddy-to-proxy-wikipedia","posts/zh/use-caddy-to-proxy-wikipedia","2022-05-30 08:59:21",null,1766504040271]
[{"data":1,"prerenderedAt":263},["ShallowReactive",2],{"post-2022-07-03-fcitx5-blinking-on-tg-under-wayland-kde-zh":3,"surround-2022-07-03-fcitx5-blinking-on-tg-under-wayland-kde-zh":250,"randomIndex/2022/07/03/fcitx5-blinking-on-tg-under-wayland-kde/":261,"language-switch-/2022/07/03/fcitx5-blinking-on-tg-under-wayland-kde/-en":262},{"id":4,"title":5,"body":6,"date":235,"description":132,"extension":236,"lang":237,"meta":238,"navigation":239,"path":240,"rawbody":241,"seo":242,"stem":243,"sticky":244,"tags":245,"__hash__":249},"posts/posts/zh/fcitx5-blinking-on-tg-under-wayland-kde.md","处理 fcitx5 的文字候选框在 tg 客户端上闪烁的问题",{"type":7,"value":8,"toc":223},"minimark",[9,24,28,31,38,41,44,54,57,60,63,69,77,88,91,94,97,100,115,118,122,126,157,160,168,171,175,181,184,191,198,205,219],[10,11,12],"blockquote",{},[13,14,15,16,23],"p",{},"文章开头，先要感谢 fcitx5 的开发者 ",[17,18,22],"a",{"href":19,"rel":20},"https://www.csslayer.info/wordpress/",[21],"nofollow","老K"," 帮我 debug 这个问题",[25,26,27],"h2",{"id":27},"鬼畜的文字候选框",[13,29,30],{},"在新装的 Fedora 36 KDE Wayland 下使用 fcitx5 时遇到了文字候选框前后移动晃眼的问题（如下图）",[13,32,33],{},[34,35],"img",{"alt":36,"src":37},"fcitx5 blinking","https://static.031130.xyz/uploads/2024/08/12/62c13162a6efc.gif",[25,39,40],{"id":40},"解决方案",[13,42,43],{},"当我向老K提出这个问题上的时候，老K告诉我这是预期行为，一共有两个解决方案。",[45,46,47,51],"ul",{},[48,49,50],"li",{},"使用 qt 的 text input",[48,52,53],{},"关掉 kwin 的淡入淡出特效",[13,55,56],{},"但由于我并不熟悉 KWin 的特效，所以我选择了前者的方案。",[13,58,59],{},"首先，需要确保自己的 Plasma 版本在 5.24 或以上，fcitx5 的版本号在 5.0.14 以上。",[13,61,62],{},"然后我们需要让 KWin 去启动 fcitx5。KCM 为此提供了一个非常简单的方式，如下图",[13,64,65],{},[34,66],{"alt":67,"src":68},"选择 fcitx5 就好啦","https://static.031130.xyz/uploads/2024/08/12/62c134907ada9.webp",[13,70,71,72,76],{},"随后需要确保环境变量没有设置 ",[73,74,75],"code",{},"QT_IM_MODULE ","。一定要确保这个变量不存在，连空也不行，必须是 unset。",[13,78,79,80,83,84,87],{},"理论上来说，是不需要重启的，但我的环境变量是 ",[73,81,82],{},"fcitx5-autostart"," 这个 rpm 包在 ",[73,85,86],{},"/etc/profile.d/fcitx5.sh","里面设置的，我需要重启系统来使新的环境变量生效。",[13,89,90],{},"重启后，如果没有什么意外的话，就算成功了。",[25,92,93],{"id":93},"绝对不会缺席的意外",[13,95,96],{},"很遗憾，我遇到了意外。",[13,98,99],{},"完成上述操作后，文字候选框依然有问题。",[13,101,102,103,106,107,110,111,114],{},"在老K的正确推测下，是因为我在 Fedora 下曾经使用过 ",[73,104,105],{},"im-settings","，该程序在 ",[73,108,109],{},"$HOME/.config/environment.d/"," 路径下重新帮我设置回了 ",[73,112,113],{},"QT_IM_MODULE"," 这个变量，从而使得 tg 启动时还在使用 IM MODULE，而不是预期的 qt text input。",[13,116,117],{},"删除这两个影响环境变量的文件后，在 tg 输入时，fcitx5 的文字候选框恢复了正常。",[25,119,121],{"id":120},"debug-过程中用到的两个方式","debug 过程中用到的两个方式",[123,124,125],"h3",{"id":125},"dbus-send",[127,128,133],"pre",{"className":129,"code":130,"language":131,"meta":132,"style":132},"language-bash shiki shiki-themes one-light one-dark-pro","dbus-send --print-reply=literal --dest=org.fcitx.Fcitx5 /controller org.fcitx.Fcitx.Controller1.DebugInfo\n","bash","",[73,134,135],{"__ignoreMap":132},[136,137,140,143,147,150,154],"span",{"class":138,"line":139},"line",1,[136,141,125],{"class":142},"sAdtL",[136,144,146],{"class":145},"sAGMh"," --print-reply=literal",[136,148,149],{"class":145}," --dest=org.fcitx.Fcitx5",[136,151,153],{"class":152},"sDhpE"," /controller",[136,155,156],{"class":152}," org.fcitx.Fcitx.Controller1.DebugInfo\n",[13,158,159],{},"运行如上命令后，我得到了如下的输出",[127,161,166],{"className":162,"code":164,"language":165},[163],"language-text","   Group [x11::1] has 0 InputContext(s)\nGroup [wayland:] has 5 InputContext(s)\n  IC [a50fe208d42e4611b240c0b66a2fa0b9] program:konsole frontend:dbus cap:e001800060 focus:1\n  IC [d7d4d5c05e9c445aab1af9c7dfb5fbd4] program:telegram-desktop frontend:dbus cap:e001800060 focus:0\n  IC [ac72ec3edf58481bbdf838352520efd5] program:krunner frontend:dbus cap:e001820060 focus:0\n  IC [d8b450176e204953837248f786204c29] program:plasmashell frontend:dbus cap:e001800060 focus:0\n  IC [df252979343d42ebbe9bd82ead6ff194] program: frontend:wayland cap:40 focus:0\nInput Context without group\n","text",[73,167,164],{"__ignoreMap":132},[13,169,170],{},"老K指出，出现了 telegram 的那一行表明 tg 还是在用 IM Module，所以是环境变量有问题",[123,172,174],{"id":173},"proc-查看程序运行时的环境变量","/proc 查看程序运行时的环境变量",[13,176,177],{},[34,178],{"alt":179,"src":180},"获取到的环境变量","https://static.031130.xyz/uploads/2024/08/12/62c138b030469.webp",[25,182,183],{"id":183},"参考资料",[13,185,186],{},[17,187,190],{"href":188,"rel":189},"https://www.csslayer.info/wordpress/linux/use-plasma-5-24-to-type-in-alacritty-or-any-other-text-input-v3-client-with-fcitx-5-on-wayland/",[21],"Use Plasma 5.24 to type in Alacritty (Or any other text-input-v3 client) with Fcitx 5 on Wayland",[13,192,193],{},[17,194,197],{"href":195,"rel":196},"https://fcitx-im.org/wiki/FAQ#Candidate_window_is_blinking_under_wayland_with_Fcitx_5",[21],"Candidate window is blinking under wayland with Fcitx 5",[13,199,200],{},[17,201,204],{"href":202,"rel":203},"https://www.cnblogs.com/hupeng1234/p/6735403.html",[21],"查看进程的环境变量",[13,206,207],{},[208,209,210,211,214,215,218],"em",{},"注: 上述参考资料均已在 ",[73,212,213],{},"web.archive.org"," 和 ",[73,216,217],{},"archive.ph"," 做过存档，如遇到原站点无法访问的情况，可自行前往这两个站点查看存档。",[220,221,222],"style",{},"html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}",{"title":132,"searchDepth":224,"depth":224,"links":225},2,[226,227,228,229,234],{"id":27,"depth":224,"text":27},{"id":40,"depth":224,"text":40},{"id":93,"depth":224,"text":93},{"id":120,"depth":224,"text":121,"children":230},[231,233],{"id":125,"depth":232,"text":125},3,{"id":173,"depth":232,"text":174},{"id":183,"depth":224,"text":183},"2022-07-03 13:52:44","md","zh-CN",{},true,"/2022/07/03/fcitx5-blinking-on-tg-under-wayland-kde","---\ntitle: 处理 fcitx5 的文字候选框在 tg 客户端上闪烁的问题\ndate: 2022-07-03 13:52:44\nsticky:\ntags:\n- Linux\n- Notes\n- KDE\n---\n\n> 文章开头，先要感谢 fcitx5 的开发者 [老K](https://www.csslayer.info/wordpress/) 帮我 debug 这个问题\n\n## 鬼畜的文字候选框\n\n在新装的 Fedora 36 KDE Wayland 下使用 fcitx5 时遇到了文字候选框前后移动晃眼的问题（如下图）\n\n![fcitx5 blinking](https://static.031130.xyz/uploads/2024/08/12/62c13162a6efc.gif)\n\n## 解决方案\n\n当我向老K提出这个问题上的时候，老K告诉我这是预期行为，一共有两个解决方案。\n\n- 使用 qt 的 text input\n- 关掉 kwin 的淡入淡出特效\n\n但由于我并不熟悉 KWin 的特效，所以我选择了前者的方案。\n\n首先，需要确保自己的 Plasma 版本在 5.24 或以上，fcitx5 的版本号在 5.0.14 以上。\n\n然后我们需要让 KWin 去启动 fcitx5。KCM 为此提供了一个非常简单的方式，如下图\n\n![选择 fcitx5 就好啦](https://static.031130.xyz/uploads/2024/08/12/62c134907ada9.webp)\n\n随后需要确保环境变量没有设置 `QT_IM_MODULE `。一定要确保这个变量不存在，连空也不行，必须是 unset。\n\n理论上来说，是不需要重启的，但我的环境变量是 `fcitx5-autostart` 这个 rpm 包在 `/etc/profile.d/fcitx5.sh`里面设置的，我需要重启系统来使新的环境变量生效。\n\n重启后，如果没有什么意外的话，就算成功了。\n\n## 绝对不会缺席的意外\n\n很遗憾，我遇到了意外。\n\n完成上述操作后，文字候选框依然有问题。\n\n在老K的正确推测下，是因为我在 Fedora 下曾经使用过 `im-settings`，该程序在 `$HOME/.config/environment.d/` 路径下重新帮我设置回了 `QT_IM_MODULE` 这个变量，从而使得 tg 启动时还在使用 IM MODULE，而不是预期的 qt text input。\n\n删除这两个影响环境变量的文件后，在 tg 输入时，fcitx5 的文字候选框恢复了正常。\n\n## debug 过程中用到的两个方式\n\n### dbus-send\n\n```bash\ndbus-send --print-reply=literal --dest=org.fcitx.Fcitx5 /controller org.fcitx.Fcitx.Controller1.DebugInfo\n```\n\n运行如上命令后，我得到了如下的输出\n\n```\n   Group [x11::1] has 0 InputContext(s)\nGroup [wayland:] has 5 InputContext(s)\n  IC [a50fe208d42e4611b240c0b66a2fa0b9] program:konsole frontend:dbus cap:e001800060 focus:1\n  IC [d7d4d5c05e9c445aab1af9c7dfb5fbd4] program:telegram-desktop frontend:dbus cap:e001800060 focus:0\n  IC [ac72ec3edf58481bbdf838352520efd5] program:krunner frontend:dbus cap:e001820060 focus:0\n  IC [d8b450176e204953837248f786204c29] program:plasmashell frontend:dbus cap:e001800060 focus:0\n  IC [df252979343d42ebbe9bd82ead6ff194] program: frontend:wayland cap:40 focus:0\nInput Context without group\n```\n\n老K指出，出现了 telegram 的那一行表明 tg 还是在用 IM Module，所以是环境变量有问题\n\n### /proc 查看程序运行时的环境变量\n\n![获取到的环境变量](https://static.031130.xyz/uploads/2024/08/12/62c138b030469.webp)\n\n## 参考资料\n\n[Use Plasma 5.24 to type in Alacritty (Or any other text-input-v3 client) with Fcitx 5 on Wayland](https://www.csslayer.info/wordpress/linux/use-plasma-5-24-to-type-in-alacritty-or-any-other-text-input-v3-client-with-fcitx-5-on-wayland/)\n\n[Candidate window is blinking under wayland with Fcitx 5](https://fcitx-im.org/wiki/FAQ#Candidate_window_is_blinking_under_wayland_with_Fcitx_5)\n\n[查看进程的环境变量](https://www.cnblogs.com/hupeng1234/p/6735403.html)\n\n*注: 上述参考资料均已在 `web.archive.org` 和 `archive.ph` 做过存档，如遇到原站点无法访问的情况，可自行前往这两个站点查看存档。*\n",{"title":5,"description":132},"posts/zh/fcitx5-blinking-on-tg-under-wayland-kde",false,[246,247,248],"Linux","Notes","KDE","YsFLy1aN65gxx5qhf0ypSykt7y5areVM1_oW5ZFR1Q8",[251,256],{"title":252,"path":253,"stem":254,"date":255,"lang":237,"children":-1},"如何拯救失声的 hollywood","/2022/07/25/restore-the-sound-of-hollywood","posts/zh/restore-the-sound-of-hollywood","2022-07-25 11:25:44",{"title":257,"path":258,"stem":259,"date":260,"lang":237,"children":-1},"使用caddy反向代理维基百科中文站点","/2022/05/30/use-caddy-to-proxy-wikipedia","posts/zh/use-caddy-to-proxy-wikipedia","2022-05-30 08:59:21",10,null,1763997786627]
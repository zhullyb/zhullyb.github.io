[{"data":1,"prerenderedAt":431},["ShallowReactive",2],{"post-2022-05-11-setup-a-local-fedora-source":3,"surround-2022-05-11-setup-a-local-fedora-source":420,"randomIndex/2022/05/11/setup-a-local-fedora-source/":314},{"id":4,"title":5,"body":6,"date":407,"description":93,"extension":408,"meta":409,"navigation":410,"path":411,"rawbody":412,"seo":413,"stem":414,"sticky":415,"tags":416,"__hash__":419},"posts/posts/setup-a-local-fedora-source.md","创建一个本地的 Fedora 镜像源",{"type":7,"value":8,"toc":398},"minimark",[9,21,25,49,52,55,62,66,69,80,87,108,115,121,124,135,154,160,166,170,173,176,187,190,198,201,220,223,229,232,239,246,324,331,385,394],[10,11,12],"blockquote",{},[13,14,15,16,20],"p",{},"Fedora 36 在多次跳票后，总算是在 5月10日正式发布了。截止北京时间 5月11日凌晨两点，上海交通大学开源镜像站的上游 ",[17,18,19],"code",{},"rsync://download-ib01.fedoraproject.org/","  仍然没有同步 Fedora 36 的 Release 源。鉴于 Release 自 freeze 以后基本是不会有什么大变动的，也不需要及时同步更新，干脆就直接建立一个本地的镜像源。",[22,23,24],"h2",{"id":24},"准备",[26,27,28,36,46],"ol",{},[29,30,31,32,35],"li",{},"一块足够大的硬盘",[33,34],"br",{},"根据我个人实测，单 Fedora 36 的 x86_64 架构 的 Release 源中的 binary rpm 就占用了 89.6 GB，具体准备多的的硬盘空间还得看你具体需要同步些什么。",[29,37,38,39,41,42,45],{},"符合要求的上游",[33,40],{},"这里所说的符合要求一共是两个方面，一是允许 rsync 同步，二是有你想要的文件。我通过 getfedora.org 的下载按钮的转发目标得知 ",[17,43,44],{},"mirror.karneval.cz"," 已经完成了 Fedora 36 Release 源的同步。",[29,47,48],{},"良好的网络条件",[13,50,51],{},"这里说的良好的网络条件，并不一定是说需要访问境外站点的能力，而是你和你的上游之间的网络访问畅通，不要动不动就i断开连接那种。如果你选择的是国内镜像站作为你的上游，那一般不会有什么问题。",[22,53,54],{"id":54},"开始同步",[13,56,57,58,61],{},"现在的主流方案一般都是选择 ",[17,59,60],{},"rsync"," 直接开整。",[63,64,65],"h3",{"id":65},"试探环节",[13,67,68],{},"很多镜像站的 rsync 文件路径和 http 文件路径路径是不同的。",[13,70,71,72,75,76,79],{},"比如说，我这里用的 mirror.karneval.cz 的 http 页面显示的 fedora 仓库路径在 ",[17,73,74],{},"/pub/fedora","，但 rsync 同步时需要使用 ",[17,77,78],{},"/fedora"," 路径。",[13,81,82,83,86],{},"为了确定这一点，我们可以先通过 ",[17,84,85],{},"rsync rsync://example.com"," 进行预览",[88,89,94],"pre",{"className":90,"code":91,"language":92,"meta":93,"style":93},"language-bash shiki shiki-themes one-light one-dark-pro","rsync rsync://mirror.karneval.cz\n","bash","",[17,95,96],{"__ignoreMap":93},[97,98,101,104],"span",{"class":99,"line":100},"line",1,[97,102,60],{"class":103},"sAdtL",[97,105,107],{"class":106},"sDhpE"," rsync://mirror.karneval.cz\n",[13,109,110],{},[111,112],"img",{"alt":113,"src":114},"image-20220511103736493","https://static.031130.xyz/uploads/2024/08/12/627b2177c4da2.webp",[13,116,117,118],{},"通过一层一层预览目录的方式，找到需要同步的路径是 ",[17,119,120],{},"/fedora/linux/releases/36/Everything/x86_64/os/",[63,122,123],{"id":123},"同步环节",[13,125,126,127,130,131,134],{},"通过 ",[17,128,129],{},"mkdir"," 和 ",[17,132,133],{},"cd"," 创建并进入我们准备用于同步源码的文件夹，然后开始执行同步命令。",[88,136,138],{"className":90,"code":137,"language":92,"meta":93,"style":93},"rsync -avP rsync://mirror.karneval.cz/fedora/linux/releases/36/Everything/x86_64/os/ .\n",[17,139,140],{"__ignoreMap":93},[97,141,142,144,148,151],{"class":99,"line":100},[97,143,60],{"class":103},[97,145,147],{"class":146},"sAGMh"," -avP",[97,149,150],{"class":106}," rsync://mirror.karneval.cz/fedora/linux/releases/36/Everything/x86_64/os/",[97,152,153],{"class":106}," .\n",[13,155,156],{},[157,158,159],"em",{},"Ps: 中途如果由于各种原因而中断了同步过程，可以再次使用上述命令继续同步，rsync 会保证文件完整性。",[13,161,162],{},[111,163],{"alt":164,"src":165},"耗费两个半小时，同步成功","https://static.031130.xyz/uploads/2024/08/12/627b22fa44446.webp",[22,167,169],{"id":168},"安装配置并启用-static-server-可选","安装、配置并启用 static server (可选)",[13,171,172],{},"如果只需要本机使用，那么直接跳过这一步即可；如果需要给局域网内的其他机器提供镜像源，那么需要启用 static server。",[13,174,175],{},"我这里选择的是 caddy，性能虽然比 nginx 略逊一筹，但胜在配置简单。",[13,177,178,179,186],{},"caddy 的安装可以直接参考",[180,181,185],"a",{"href":182,"rel":183},"https://caddyserver.com/docs/install",[184],"nofollow","官方文档","，这里不再赘述。",[13,188,189],{},"配置也不过那么几行的事情，我给个 example。端口号只要和别的程序没有冲突，就可以随意指定。443 端口需要 ssl 证书比较麻烦，局域网内直接用非标准端口即可。",[88,191,196],{"className":192,"code":194,"language":195},[193],"language-text",":14567 {\n        root * /the/directory/you/use\n\n        file_server {\n                browse\n        }\n}\n","text",[17,197,194],{"__ignoreMap":93},[13,199,200],{},"配置完后直接以普通用户的权限启用即可，使用 systemd 启用需要解决 caddy 用户对目标无权限的问题。",[88,202,204],{"className":90,"code":203,"language":92,"meta":93,"style":93},"caddy run --config /etc/caddy/Caddyfile\n",[17,205,206],{"__ignoreMap":93},[97,207,208,211,214,217],{"class":99,"line":100},[97,209,210],{"class":103},"caddy",[97,212,213],{"class":106}," run",[97,215,216],{"class":146}," --config",[97,218,219],{"class":106}," /etc/caddy/Caddyfile\n",[13,221,222],{},"浏览器输入对应的 ip 和端口，应该就可以访问了。",[13,224,225],{},[111,226],{"alt":227,"src":228},"image-20220511113417004","https://static.031130.xyz/uploads/2024/08/12/627b2ebd23331.webp",[22,230,231],{"id":231},"修改源配置文件",[13,233,234,235,238],{},"由于我们仅同步了 Release 源，就只需要修改 ",[17,236,237],{},"/etc/yum.repo.d/fedora.repo"," 即可。",[13,240,241,242,245],{},"如果镜像源在本机上，可以直接使用 ",[17,243,244],{},"file://"," 协议头:",[88,247,251],{"className":248,"code":249,"language":250,"meta":93,"style":93},"language-diff shiki shiki-themes one-light one-dark-pro","[fedora]\nname=Fedora $releasever - $basearch\n+ baseurl=file:///the/directory/you/use\n- metalink=https://mirrors.fedoraproject.org/metalink?repo=fedora-$releasever&arch=$basearch\nenabled=1\ncountme=1\nmetadata_expire=7d\nrepo_gpgcheck=0\ntype=rpm\ngpgcheck=1\ngpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-fedora-$releasever-$basearch\nskip_if_unavailable=False\n","diff",[17,252,253,258,264,270,276,282,288,294,300,306,312,318],{"__ignoreMap":93},[97,254,255],{"class":99,"line":100},[97,256,257],{},"[fedora]\n",[97,259,261],{"class":99,"line":260},2,[97,262,263],{},"name=Fedora $releasever - $basearch\n",[97,265,267],{"class":99,"line":266},3,[97,268,269],{},"+ baseurl=file:///the/directory/you/use\n",[97,271,273],{"class":99,"line":272},4,[97,274,275],{},"- metalink=https://mirrors.fedoraproject.org/metalink?repo=fedora-$releasever&arch=$basearch\n",[97,277,279],{"class":99,"line":278},5,[97,280,281],{},"enabled=1\n",[97,283,285],{"class":99,"line":284},6,[97,286,287],{},"countme=1\n",[97,289,291],{"class":99,"line":290},7,[97,292,293],{},"metadata_expire=7d\n",[97,295,297],{"class":99,"line":296},8,[97,298,299],{},"repo_gpgcheck=0\n",[97,301,303],{"class":99,"line":302},9,[97,304,305],{},"type=rpm\n",[97,307,309],{"class":99,"line":308},10,[97,310,311],{},"gpgcheck=1\n",[97,313,315],{"class":99,"line":314},11,[97,316,317],{},"gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-fedora-$releasever-$basearch\n",[97,319,321],{"class":99,"line":320},12,[97,322,323],{},"skip_if_unavailable=False\n",[13,325,326,327,330],{},"如果镜像源在同局域网设备上，通过 ",[17,328,329],{},"http://"," 协议也能达到相同的效果:",[88,332,334],{"className":248,"code":333,"language":250,"meta":93,"style":93},"[fedora]\nname=Fedora $releasever - $basearch\n+ baseurl=http://192.168.1.233:14567\n- metalink=https://mirrors.fedoraproject.org/metalink?repo=fedora-$releasever&arch=$basearch\nenabled=1\ncountme=1\nmetadata_expire=7d\nrepo_gpgcheck=0\ntype=rpm\ngpgcheck=1\ngpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-fedora-$releasever-$basearch\nskip_if_unavailable=False\n",[17,335,336,340,344,349,353,357,361,365,369,373,377,381],{"__ignoreMap":93},[97,337,338],{"class":99,"line":100},[97,339,257],{},[97,341,342],{"class":99,"line":260},[97,343,263],{},[97,345,346],{"class":99,"line":266},[97,347,348],{},"+ baseurl=http://192.168.1.233:14567\n",[97,350,351],{"class":99,"line":272},[97,352,275],{},[97,354,355],{"class":99,"line":278},[97,356,281],{},[97,358,359],{"class":99,"line":284},[97,360,287],{},[97,362,363],{"class":99,"line":290},[97,364,293],{},[97,366,367],{"class":99,"line":296},[97,368,299],{},[97,370,371],{"class":99,"line":302},[97,372,305],{},[97,374,375],{"class":99,"line":308},[97,376,311],{},[97,378,379],{"class":99,"line":314},[97,380,317],{},[97,382,383],{"class":99,"line":320},[97,384,323],{},[13,386,387],{},[157,388,389,390,393],{},"Ps: 提供镜像源的机子的局域网 ip 可以通过 ",[17,391,392],{},"ip -br a"," 命令获取",[395,396,397],"style",{},"html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}",{"title":93,"searchDepth":260,"depth":260,"links":399},[400,401,405,406],{"id":24,"depth":260,"text":24},{"id":54,"depth":260,"text":54,"children":402},[403,404],{"id":65,"depth":266,"text":65},{"id":123,"depth":266,"text":123},{"id":168,"depth":260,"text":169},{"id":231,"depth":260,"text":231},"2022-05-11 04:18:26","md",{},true,"/2022/05/11/setup-a-local-fedora-source","---\ntitle: 创建一个本地的 Fedora 镜像源\ndate: 2022-05-11 04:18:26\nsticky:\ntags:\n- Fedora\n- Caddy\n---\n\n> Fedora 36 在多次跳票后，总算是在 5月10日正式发布了。截止北京时间 5月11日凌晨两点，上海交通大学开源镜像站的上游 `rsync://download-ib01.fedoraproject.org/`  仍然没有同步 Fedora 36 的 Release 源。鉴于 Release 自 freeze 以后基本是不会有什么大变动的，也不需要及时同步更新，干脆就直接建立一个本地的镜像源。\n\n## 准备\n\n1. 一块足够大的硬盘\n\n   根据我个人实测，单 Fedora 36 的 x86_64 架构 的 Release 源中的 binary rpm 就占用了 89.6 GB，具体准备多的的硬盘空间还得看你具体需要同步些什么。\n\n2. 符合要求的上游\n\n   这里所说的符合要求一共是两个方面，一是允许 rsync 同步，二是有你想要的文件。我通过 getfedora.org 的下载按钮的转发目标得知 `mirror.karneval.cz` 已经完成了 Fedora 36 Release 源的同步。\n\n3.  良好的网络条件\n\n   这里说的良好的网络条件，并不一定是说需要访问境外站点的能力，而是你和你的上游之间的网络访问畅通，不要动不动就i断开连接那种。如果你选择的是国内镜像站作为你的上游，那一般不会有什么问题。\n\n## 开始同步\n\n现在的主流方案一般都是选择 `rsync` 直接开整。\n\n### 试探环节\n\n很多镜像站的 rsync 文件路径和 http 文件路径路径是不同的。\n\n比如说，我这里用的 mirror.karneval.cz 的 http 页面显示的 fedora 仓库路径在 `/pub/fedora`，但 rsync 同步时需要使用 `/fedora` 路径。\n\n为了确定这一点，我们可以先通过 `rsync rsync://example.com` 进行预览\n\n```bash\nrsync rsync://mirror.karneval.cz\n```\n\n![image-20220511103736493](https://static.031130.xyz/uploads/2024/08/12/627b2177c4da2.webp)\n\n通过一层一层预览目录的方式，找到需要同步的路径是 `/fedora/linux/releases/36/Everything/x86_64/os/`\n\n### 同步环节\n\n通过 `mkdir` 和 `cd` 创建并进入我们准备用于同步源码的文件夹，然后开始执行同步命令。\n\n```bash\nrsync -avP rsync://mirror.karneval.cz/fedora/linux/releases/36/Everything/x86_64/os/ .\n```\n\n*Ps: 中途如果由于各种原因而中断了同步过程，可以再次使用上述命令继续同步，rsync 会保证文件完整性。*\n\n![耗费两个半小时，同步成功](https://static.031130.xyz/uploads/2024/08/12/627b22fa44446.webp)\n\n## 安装、配置并启用 static server (可选)\n\n如果只需要本机使用，那么直接跳过这一步即可；如果需要给局域网内的其他机器提供镜像源，那么需要启用 static server。\n\n我这里选择的是 caddy，性能虽然比 nginx 略逊一筹，但胜在配置简单。\n\ncaddy 的安装可以直接参考[官方文档](https://caddyserver.com/docs/install)，这里不再赘述。\n\n配置也不过那么几行的事情，我给个 example。端口号只要和别的程序没有冲突，就可以随意指定。443 端口需要 ssl 证书比较麻烦，局域网内直接用非标准端口即可。\n\n```\n:14567 {\n        root * /the/directory/you/use\n\n        file_server {\n                browse\n        }\n}\n```\n\n配置完后直接以普通用户的权限启用即可，使用 systemd 启用需要解决 caddy 用户对目标无权限的问题。\n\n```bash\ncaddy run --config /etc/caddy/Caddyfile\n```\n\n浏览器输入对应的 ip 和端口，应该就可以访问了。\n\n![image-20220511113417004](https://static.031130.xyz/uploads/2024/08/12/627b2ebd23331.webp)\n\n## 修改源配置文件\n\n由于我们仅同步了 Release 源，就只需要修改 `/etc/yum.repo.d/fedora.repo` 即可。\n\n如果镜像源在本机上，可以直接使用 `file://` 协议头: \n\n```diff\n[fedora]\nname=Fedora $releasever - $basearch\n+ baseurl=file:///the/directory/you/use\n- metalink=https://mirrors.fedoraproject.org/metalink?repo=fedora-$releasever&arch=$basearch\nenabled=1\ncountme=1\nmetadata_expire=7d\nrepo_gpgcheck=0\ntype=rpm\ngpgcheck=1\ngpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-fedora-$releasever-$basearch\nskip_if_unavailable=False\n```\n\n如果镜像源在同局域网设备上，通过 `http://` 协议也能达到相同的效果: \n\n```diff\n[fedora]\nname=Fedora $releasever - $basearch\n+ baseurl=http://192.168.1.233:14567\n- metalink=https://mirrors.fedoraproject.org/metalink?repo=fedora-$releasever&arch=$basearch\nenabled=1\ncountme=1\nmetadata_expire=7d\nrepo_gpgcheck=0\ntype=rpm\ngpgcheck=1\ngpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-fedora-$releasever-$basearch\nskip_if_unavailable=False\n```\n\n*Ps: 提供镜像源的机子的局域网 ip 可以通过 `ip -br a` 命令获取*\n",{"title":5,"description":93},"posts/setup-a-local-fedora-source",false,[417,418],"Fedora","Caddy","I3EauAUT-bri7NStp2Igu4Lq8syRU3PTdO3CtFxPBvc",[421,426],{"title":422,"path":423,"stem":424,"date":425,"children":-1},"使用caddy反向代理维基百科中文站点","/2022/05/30/use-caddy-to-proxy-wikipedia","posts/use-caddy-to-proxy-wikipedia","2022-05-30 08:59:21",{"title":427,"path":428,"stem":429,"date":430,"children":-1},"好软推荐——FastOCR","/2022/04/14/fastocr-experience","posts/fastocr-experience","2022-04-14 05:55:18",1762243371740]
[{"data":1,"prerenderedAt":426},["ShallowReactive",2],{"post-2022-05-11-setup-a-local-fedora-source-zh":3,"surround-2022-05-11-setup-a-local-fedora-source-zh":413,"randomIndex/2022/05/11/setup-a-local-fedora-source/":314,"language-switch-/2022/05/11/setup-a-local-fedora-source/-en":425},{"title":4,"date":5,"path":6,"tags":7,"body":10,"description":97},"创建一个本地的 Fedora 镜像源","2022-05-11 04:18:26","/2022/05/11/setup-a-local-fedora-source",[8,9],"Fedora","Caddy",{"type":11,"value":12,"toc":404},"minimark",[13,25,29,53,56,59,66,70,73,84,91,112,119,125,128,139,158,164,170,174,177,180,191,194,202,205,224,227,233,236,243,250,330,337,391,400],[14,15,16],"blockquote",{},[17,18,19,20,24],"p",{},"Fedora 36 在多次跳票后，总算是在 5月10日正式发布了。截止北京时间 5月11日凌晨两点，上海交通大学开源镜像站的上游 ",[21,22,23],"code",{},"rsync://download-ib01.fedoraproject.org/","  仍然没有同步 Fedora 36 的 Release 源。鉴于 Release 自 freeze 以后基本是不会有什么大变动的，也不需要及时同步更新，干脆就直接建立一个本地的镜像源。",[26,27,28],"h2",{"id":28},"准备",[30,31,32,40,50],"ol",{},[33,34,35,36,39],"li",{},"一块足够大的硬盘",[37,38],"br",{},"根据我个人实测，单 Fedora 36 的 x86_64 架构 的 Release 源中的 binary rpm 就占用了 89.6 GB，具体准备多的的硬盘空间还得看你具体需要同步些什么。",[33,41,42,43,45,46,49],{},"符合要求的上游",[37,44],{},"这里所说的符合要求一共是两个方面，一是允许 rsync 同步，二是有你想要的文件。我通过 getfedora.org 的下载按钮的转发目标得知 ",[21,47,48],{},"mirror.karneval.cz"," 已经完成了 Fedora 36 Release 源的同步。",[33,51,52],{},"良好的网络条件",[17,54,55],{},"这里说的良好的网络条件，并不一定是说需要访问境外站点的能力，而是你和你的上游之间的网络访问畅通，不要动不动就i断开连接那种。如果你选择的是国内镜像站作为你的上游，那一般不会有什么问题。",[26,57,58],{"id":58},"开始同步",[17,60,61,62,65],{},"现在的主流方案一般都是选择 ",[21,63,64],{},"rsync"," 直接开整。",[67,68,69],"h3",{"id":69},"试探环节",[17,71,72],{},"很多镜像站的 rsync 文件路径和 http 文件路径路径是不同的。",[17,74,75,76,79,80,83],{},"比如说，我这里用的 mirror.karneval.cz 的 http 页面显示的 fedora 仓库路径在 ",[21,77,78],{},"/pub/fedora","，但 rsync 同步时需要使用 ",[21,81,82],{},"/fedora"," 路径。",[17,85,86,87,90],{},"为了确定这一点，我们可以先通过 ",[21,88,89],{},"rsync rsync://example.com"," 进行预览",[92,93,98],"pre",{"className":94,"code":95,"language":96,"meta":97,"style":97},"language-bash shiki shiki-themes one-light one-dark-pro","rsync rsync://mirror.karneval.cz\n","bash","",[21,99,100],{"__ignoreMap":97},[101,102,105,108],"span",{"class":103,"line":104},"line",1,[101,106,64],{"class":107},"sAdtL",[101,109,111],{"class":110},"sDhpE"," rsync://mirror.karneval.cz\n",[17,113,114],{},[115,116],"img",{"alt":117,"src":118},"image-20220511103736493","https://static.031130.xyz/uploads/2024/08/12/627b2177c4da2.webp",[17,120,121,122],{},"通过一层一层预览目录的方式，找到需要同步的路径是 ",[21,123,124],{},"/fedora/linux/releases/36/Everything/x86_64/os/",[67,126,127],{"id":127},"同步环节",[17,129,130,131,134,135,138],{},"通过 ",[21,132,133],{},"mkdir"," 和 ",[21,136,137],{},"cd"," 创建并进入我们准备用于同步源码的文件夹，然后开始执行同步命令。",[92,140,142],{"className":94,"code":141,"language":96,"meta":97,"style":97},"rsync -avP rsync://mirror.karneval.cz/fedora/linux/releases/36/Everything/x86_64/os/ .\n",[21,143,144],{"__ignoreMap":97},[101,145,146,148,152,155],{"class":103,"line":104},[101,147,64],{"class":107},[101,149,151],{"class":150},"sAGMh"," -avP",[101,153,154],{"class":110}," rsync://mirror.karneval.cz/fedora/linux/releases/36/Everything/x86_64/os/",[101,156,157],{"class":110}," .\n",[17,159,160],{},[161,162,163],"em",{},"Ps: 中途如果由于各种原因而中断了同步过程，可以再次使用上述命令继续同步，rsync 会保证文件完整性。",[17,165,166],{},[115,167],{"alt":168,"src":169},"耗费两个半小时，同步成功","https://static.031130.xyz/uploads/2024/08/12/627b22fa44446.webp",[26,171,173],{"id":172},"安装配置并启用-static-server-可选","安装、配置并启用 static server (可选)",[17,175,176],{},"如果只需要本机使用，那么直接跳过这一步即可；如果需要给局域网内的其他机器提供镜像源，那么需要启用 static server。",[17,178,179],{},"我这里选择的是 caddy，性能虽然比 nginx 略逊一筹，但胜在配置简单。",[17,181,182,183,190],{},"caddy 的安装可以直接参考",[184,185,189],"a",{"href":186,"rel":187},"https://caddyserver.com/docs/install",[188],"nofollow","官方文档","，这里不再赘述。",[17,192,193],{},"配置也不过那么几行的事情，我给个 example。端口号只要和别的程序没有冲突，就可以随意指定。443 端口需要 ssl 证书比较麻烦，局域网内直接用非标准端口即可。",[92,195,200],{"className":196,"code":198,"language":199},[197],"language-text",":14567 {\n        root * /the/directory/you/use\n\n        file_server {\n                browse\n        }\n}\n","text",[21,201,198],{"__ignoreMap":97},[17,203,204],{},"配置完后直接以普通用户的权限启用即可，使用 systemd 启用需要解决 caddy 用户对目标无权限的问题。",[92,206,208],{"className":94,"code":207,"language":96,"meta":97,"style":97},"caddy run --config /etc/caddy/Caddyfile\n",[21,209,210],{"__ignoreMap":97},[101,211,212,215,218,221],{"class":103,"line":104},[101,213,214],{"class":107},"caddy",[101,216,217],{"class":110}," run",[101,219,220],{"class":150}," --config",[101,222,223],{"class":110}," /etc/caddy/Caddyfile\n",[17,225,226],{},"浏览器输入对应的 ip 和端口，应该就可以访问了。",[17,228,229],{},[115,230],{"alt":231,"src":232},"image-20220511113417004","https://static.031130.xyz/uploads/2024/08/12/627b2ebd23331.webp",[26,234,235],{"id":235},"修改源配置文件",[17,237,238,239,242],{},"由于我们仅同步了 Release 源，就只需要修改 ",[21,240,241],{},"/etc/yum.repo.d/fedora.repo"," 即可。",[17,244,245,246,249],{},"如果镜像源在本机上，可以直接使用 ",[21,247,248],{},"file://"," 协议头:",[92,251,255],{"className":252,"code":253,"language":254,"meta":97,"style":97},"language-diff shiki shiki-themes one-light one-dark-pro","[fedora]\nname=Fedora $releasever - $basearch\n+ baseurl=file:///the/directory/you/use\n- metalink=https://mirrors.fedoraproject.org/metalink?repo=fedora-$releasever&arch=$basearch\nenabled=1\ncountme=1\nmetadata_expire=7d\nrepo_gpgcheck=0\ntype=rpm\ngpgcheck=1\ngpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-fedora-$releasever-$basearch\nskip_if_unavailable=False\n","diff",[21,256,257,263,269,275,282,288,294,300,306,312,318,324],{"__ignoreMap":97},[101,258,259],{"class":103,"line":104},[101,260,262],{"class":261},"s5ixo","[fedora]\n",[101,264,266],{"class":103,"line":265},2,[101,267,268],{"class":261},"name=Fedora $releasever - $basearch\n",[101,270,272],{"class":103,"line":271},3,[101,273,274],{"class":110},"+ baseurl=file:///the/directory/you/use\n",[101,276,278],{"class":103,"line":277},4,[101,279,281],{"class":280},"sJa8x","- metalink=https://mirrors.fedoraproject.org/metalink?repo=fedora-$releasever&arch=$basearch\n",[101,283,285],{"class":103,"line":284},5,[101,286,287],{"class":261},"enabled=1\n",[101,289,291],{"class":103,"line":290},6,[101,292,293],{"class":261},"countme=1\n",[101,295,297],{"class":103,"line":296},7,[101,298,299],{"class":261},"metadata_expire=7d\n",[101,301,303],{"class":103,"line":302},8,[101,304,305],{"class":261},"repo_gpgcheck=0\n",[101,307,309],{"class":103,"line":308},9,[101,310,311],{"class":261},"type=rpm\n",[101,313,315],{"class":103,"line":314},10,[101,316,317],{"class":261},"gpgcheck=1\n",[101,319,321],{"class":103,"line":320},11,[101,322,323],{"class":261},"gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-fedora-$releasever-$basearch\n",[101,325,327],{"class":103,"line":326},12,[101,328,329],{"class":261},"skip_if_unavailable=False\n",[17,331,332,333,336],{},"如果镜像源在同局域网设备上，通过 ",[21,334,335],{},"http://"," 协议也能达到相同的效果:",[92,338,340],{"className":252,"code":339,"language":254,"meta":97,"style":97},"[fedora]\nname=Fedora $releasever - $basearch\n+ baseurl=http://192.168.1.233:14567\n- metalink=https://mirrors.fedoraproject.org/metalink?repo=fedora-$releasever&arch=$basearch\nenabled=1\ncountme=1\nmetadata_expire=7d\nrepo_gpgcheck=0\ntype=rpm\ngpgcheck=1\ngpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-fedora-$releasever-$basearch\nskip_if_unavailable=False\n",[21,341,342,346,350,355,359,363,367,371,375,379,383,387],{"__ignoreMap":97},[101,343,344],{"class":103,"line":104},[101,345,262],{"class":261},[101,347,348],{"class":103,"line":265},[101,349,268],{"class":261},[101,351,352],{"class":103,"line":271},[101,353,354],{"class":110},"+ baseurl=http://192.168.1.233:14567\n",[101,356,357],{"class":103,"line":277},[101,358,281],{"class":280},[101,360,361],{"class":103,"line":284},[101,362,287],{"class":261},[101,364,365],{"class":103,"line":290},[101,366,293],{"class":261},[101,368,369],{"class":103,"line":296},[101,370,299],{"class":261},[101,372,373],{"class":103,"line":302},[101,374,305],{"class":261},[101,376,377],{"class":103,"line":308},[101,378,311],{"class":261},[101,380,381],{"class":103,"line":314},[101,382,317],{"class":261},[101,384,385],{"class":103,"line":320},[101,386,323],{"class":261},[101,388,389],{"class":103,"line":326},[101,390,329],{"class":261},[17,392,393],{},[161,394,395,396,399],{},"Ps: 提供镜像源的机子的局域网 ip 可以通过 ",[21,397,398],{},"ip -br a"," 命令获取",[401,402,403],"style",{},"html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html pre.shiki code .sJa8x, html code.shiki .sJa8x{--shiki-default:#E45649;--shiki-dark:#E06C75}",{"title":97,"searchDepth":265,"depth":265,"links":405},[406,407,411,412],{"id":28,"depth":265,"text":28},{"id":58,"depth":265,"text":58,"children":408},[409,410],{"id":69,"depth":271,"text":69},{"id":127,"depth":271,"text":127},{"id":172,"depth":265,"text":173},{"id":235,"depth":265,"text":235},[414,420],{"title":415,"path":416,"stem":417,"date":418,"lang":419,"children":-1},"使用caddy反向代理维基百科中文站点","/2022/05/30/use-caddy-to-proxy-wikipedia","posts/zh/use-caddy-to-proxy-wikipedia","2022-05-30 08:59:21","zh-CN",{"title":421,"path":422,"stem":423,"date":424,"lang":419,"children":-1},"好软推荐——FastOCR","/2022/04/14/fastocr-experience","posts/zh/fastocr-experience","2022-04-14 05:55:18",null,1765392895634]
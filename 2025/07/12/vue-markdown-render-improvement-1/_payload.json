[{"data":1,"prerenderedAt":1525},["ShallowReactive",2],{"post-2025-07-12-vue-markdown-render-improvement-1-zh":3,"surround-2025-07-12-vue-markdown-render-improvement-1-zh":1512,"randomIndex/2025/07/12/vue-markdown-render-improvement-1/":162,"language-switch-/2025/07/12/vue-markdown-render-improvement-1/-en":1524},{"title":4,"date":5,"path":6,"tags":7,"body":13,"description":84},"Vue Markdown 渲染优化实战(上)：从暴力刷新、分块更新到 Morphdom 的华丽变身","2025-07-12 20:48:56","/2025/07/12/vue-markdown-render-improvement-1",[8,9,10,11,12],"Vue.js","Markdown","JavaScript","Web","HTML",{"type":14,"value":15,"toc":1501},"minimark",[16,20,24,53,57,60,63,75,78,347,351,358,372,385,394,397,979,983,986,991,1001,1008,1019,1029,1032,1035,1450,1454,1457,1463,1469,1476,1479,1485,1491,1497],[17,18,19],"h2",{"id":19},"需求背景",[21,22,23],"p",{},"在最近接手的 AI 需求中，需要实现一个类似 ChatGPT 的对话交互界面。其核心流程是：后端通过 SSE（Server-Sent  Events）协议，持续地将 AI 生成的 Markdown 格式文本片段推送到前端。前端负责动态接收并拼接这些 Markdown  片段，最终将拼接完成的 Markdown 文本实时渲染并显示在用户界面上。",[21,25,26,27,34,35,40,41,46,47,52],{},"Markdown 渲染并不是什么罕见的需求，尤其是在 LLM 相关落地产品满天飞的当下。不同于 React 生态拥有一个 14k+ star 的著名第三方库——",[28,29,33],"a",{"href":30,"rel":31},"https://github.com/remarkjs/react-markdown",[32],"nofollow","react-markdown","，Vue 这边似乎暂时还没有一个仍在活跃维护的、star 数量不低（起码得 2k+ 吧？）的 markdown 渲染库。",[28,36,39],{"href":37,"rel":38},"https://github.com/cloudacy/vue-markdown-render#readme",[32],"cloudacy/vue-markdown-render"," 最后一次发版在一年前，但截止本文写作时间只有 103 个 star；",[28,42,45],{"href":43,"rel":44},"https://github.com/miaolz123/vue-markdown",[32],"miaolz123/vue-markdown"," 有 2k star，但最后一次 commit 已经是 7 年前了；",[28,48,51],{"href":49,"rel":50},"https://github.com/zhaoxuhui1122/vue-markdown",[32],"zhaoxuhui1122/vue-markdown"," 更是 archived 状态。",[17,54,56],{"id":55},"第一版方案简单粗暴的-v-html","第一版方案：简单粗暴的 v-html",[21,58,59],{},"简单调研了一圈，发现 Vue 生态里确实缺少一个能打的 Markdown 渲染库。既然没有现成的轮子，那咱就自己造一个！",[21,61,62],{},"根据大部分文章以及 LLM 的推荐，我们首先采用 markdown-it 这个第三方库将 markdown 转换为 html 字符串，再通过 v-html 传入。",[21,64,65,69,70,74],{},[66,67,68],"strong",{},"PS:"," 我们这里假设 Markdown 内容是可信的（比如由我们自己的 AI 生成）。如果内容来自用户输入，一定要使用 ",[71,72,73],"code",{},"DOMPurify"," 这类库来防止 XSS 攻击，避免给网站“开天窗”哦！",[21,76,77],{},"示例代码如下：",[79,80,85],"pre",{"className":81,"code":82,"language":83,"meta":84,"style":84},"language-vue shiki shiki-themes one-light one-dark-pro","\u003Ctemplate>\n  \u003Cdiv v-html=\"renderedHtml\">\u003C/div>\n\u003C/template>\n\n\u003Cscript setup>\nimport { computed, onMounted, ref } from 'vue';\nimport MarkdownIt from 'markdown-it';\n\nconst markdownContent = ref('');\nconst md = new MarkdownIt();\n\nconst renderedHtml = computed(() => md.render(markdownContent.value))\n\nonMounted(() => {\n  // markdownContent.value = await fetch() ...\n})\n\u003C/script>\n","vue","",[71,86,87,103,130,140,147,160,196,212,217,244,262,267,308,313,325,332,338],{"__ignoreMap":84},[88,89,92,96,100],"span",{"class":90,"line":91},"line",1,[88,93,95],{"class":94},"s5ixo","\u003C",[88,97,99],{"class":98},"sJa8x","template",[88,101,102],{"class":94},">\n",[88,104,106,109,112,116,119,123,126,128],{"class":90,"line":105},2,[88,107,108],{"class":94},"  \u003C",[88,110,111],{"class":98},"div",[88,113,115],{"class":114},"sAGMh"," v-html",[88,117,118],{"class":94},"=",[88,120,122],{"class":121},"sDhpE","\"renderedHtml\"",[88,124,125],{"class":94},">\u003C/",[88,127,111],{"class":98},[88,129,102],{"class":94},[88,131,133,136,138],{"class":90,"line":132},3,[88,134,135],{"class":94},"\u003C/",[88,137,99],{"class":98},[88,139,102],{"class":94},[88,141,143],{"class":90,"line":142},4,[88,144,146],{"emptyLinePlaceholder":145},true,"\n",[88,148,150,152,155,158],{"class":90,"line":149},5,[88,151,95],{"class":94},[88,153,154],{"class":98},"script",[88,156,157],{"class":114}," setup",[88,159,102],{"class":94},[88,161,163,167,170,173,176,179,181,184,187,190,193],{"class":90,"line":162},6,[88,164,166],{"class":165},"sLKXg","import",[88,168,169],{"class":94}," { ",[88,171,172],{"class":98},"computed",[88,174,175],{"class":94},", ",[88,177,178],{"class":98},"onMounted",[88,180,175],{"class":94},[88,182,183],{"class":98},"ref",[88,185,186],{"class":94}," } ",[88,188,189],{"class":165},"from",[88,191,192],{"class":121}," 'vue'",[88,194,195],{"class":94},";\n",[88,197,199,201,204,207,210],{"class":90,"line":198},7,[88,200,166],{"class":165},[88,202,203],{"class":98}," MarkdownIt",[88,205,206],{"class":165}," from",[88,208,209],{"class":121}," 'markdown-it'",[88,211,195],{"class":94},[88,213,215],{"class":90,"line":214},8,[88,216,146],{"emptyLinePlaceholder":145},[88,218,220,223,227,231,235,238,241],{"class":90,"line":219},9,[88,221,222],{"class":165},"const",[88,224,226],{"class":225},"sNmU0"," markdownContent",[88,228,230],{"class":229},"s_Sar"," =",[88,232,234],{"class":233},"sAdtL"," ref",[88,236,237],{"class":94},"(",[88,239,240],{"class":121},"''",[88,242,243],{"class":94},");\n",[88,245,247,249,252,254,257,259],{"class":90,"line":246},10,[88,248,222],{"class":165},[88,250,251],{"class":225}," md",[88,253,230],{"class":229},[88,255,256],{"class":165}," new",[88,258,203],{"class":233},[88,260,261],{"class":94},"();\n",[88,263,265],{"class":90,"line":264},11,[88,266,146],{"emptyLinePlaceholder":145},[88,268,270,272,275,277,280,283,286,289,292,295,297,300,302,305],{"class":90,"line":269},12,[88,271,222],{"class":165},[88,273,274],{"class":225}," renderedHtml",[88,276,230],{"class":229},[88,278,279],{"class":233}," computed",[88,281,282],{"class":94},"(() ",[88,284,285],{"class":165},"=>",[88,287,251],{"class":288},"s7GmK",[88,290,291],{"class":94},".",[88,293,294],{"class":233},"render",[88,296,237],{"class":94},[88,298,299],{"class":288},"markdownContent",[88,301,291],{"class":94},[88,303,304],{"class":98},"value",[88,306,307],{"class":94},"))\n",[88,309,311],{"class":90,"line":310},13,[88,312,146],{"emptyLinePlaceholder":145},[88,314,316,318,320,322],{"class":90,"line":315},14,[88,317,178],{"class":233},[88,319,282],{"class":94},[88,321,285],{"class":165},[88,323,324],{"class":94}," {\n",[88,326,328],{"class":90,"line":327},15,[88,329,331],{"class":330},"sW2Sy","  // markdownContent.value = await fetch() ...\n",[88,333,335],{"class":90,"line":334},16,[88,336,337],{"class":94},"})\n",[88,339,341,343,345],{"class":90,"line":340},17,[88,342,135],{"class":94},[88,344,154],{"class":98},[88,346,102],{"class":94},[17,348,350],{"id":349},"进化版给-markdown-分块更新","进化版：给 Markdown 分块更新",[21,352,353,354,357],{},"上述方案虽然能实现基础渲染，但在实时更新场景下存在明显缺陷：",[66,355,356],{},"每次接收到新的 Markdown 片段，整个文档都会触发全量重渲染","。即使只有最后一行是新增内容，整个文档的 DOM 也会被完全替换。这导致两个核心问题：",[359,360,361,369],"ol",{},[362,363,364,365,368],"li",{},"**性能顶不住：**Markdown 内容增长时，",[71,366,367],{},"markdown-it"," 解析和 DOM 重建的开销呈线性上升。",[362,370,371],{},"**交互状态丢失：**全量刷新会把用户当前的操作状态冲掉。最明显的就是，如果你选中了某段文字，一刷新，选中状态就没了！",[21,373,374,375,380,381,384],{},"为了解决这两个问题，",[28,376,379],{"href":377,"rel":378},"https://juejin.cn/post/7480900772386734143",[32],"我们在网上找到了分块渲染的方案"," —— 把 Markdown 按两个连续的换行符 (",[71,382,383],{},"\\n\\n",") 切成一块一块的。这样每次更新，只重新渲染最后一块新的，前面的老块直接复用缓存。好处很明显：",[386,387,388,391],"ul",{},[362,389,390],{},"用户如果选中了前面块里的文字，下次更新时选中状态不会丢（因为前面的块没动）。",[362,392,393],{},"需要重新渲染的 DOM 变少了，性能自然就上来了。",[21,395,396],{},"代码调整后像这样：",[79,398,400],{"className":81,"code":399,"language":83,"meta":84,"style":84},"\u003Ctemplate>\n  \u003Cdiv>\n    \u003Cdiv\n      v-for=\"(block, idx) in renderedBlocks\"\n      :key=\"idx\"\n      v-html=\"block\"\n      class=\"markdown-block\"\n    >\u003C/div>\n  \u003C/div>\n\u003C/template>\n\n\u003Cscript setup>\nimport { ref, computed, watch } from 'vue'\nimport MarkdownIt from 'markdown-it'\n\nconst markdownContent = ref('')\nconst md = new MarkdownIt()\n\nconst renderedBlocks = ref([])\nconst blockCache = ref([])\n\nwatch(\n  markdownContent,\n  (newContent, oldContent) => {\n    const blocks = newContent.split(/\\n{2,}/)\n    // 只重新渲染最后一个块，其余用缓存\n    // 处理块减少、块增多的场景\n    blockCache.value.length = blocks.length\n    for (let i = 0; i \u003C blocks.length; i++) {\n      // 只渲染最后一个，或新块\n      if (i === blocks.length - 1 || !blockCache.value[i]) {\n        blockCache.value[i] = md.render(blocks[i] || '')\n      }\n      // 其余块直接复用\n    }\n    renderedBlocks.value = blockCache.value.slice()\n  },\n  { immediate: true }\n)\n\nonMounted(() => {\n  // markdownContent.value = await fetch() ...\n})\n\u003C/script>\n",[71,401,402,410,418,426,436,446,456,466,475,484,492,496,506,530,541,545,562,577,582,597,611,616,624,634,656,693,699,705,730,775,781,827,871,877,883,889,914,920,939,944,949,960,965,970],{"__ignoreMap":84},[88,403,404,406,408],{"class":90,"line":91},[88,405,95],{"class":94},[88,407,99],{"class":98},[88,409,102],{"class":94},[88,411,412,414,416],{"class":90,"line":105},[88,413,108],{"class":94},[88,415,111],{"class":98},[88,417,102],{"class":94},[88,419,420,423],{"class":90,"line":132},[88,421,422],{"class":94},"    \u003C",[88,424,425],{"class":98},"div\n",[88,427,428,431,433],{"class":90,"line":142},[88,429,430],{"class":114},"      v-for",[88,432,118],{"class":94},[88,434,435],{"class":121},"\"(block, idx) in renderedBlocks\"\n",[88,437,438,441,443],{"class":90,"line":149},[88,439,440],{"class":114},"      :key",[88,442,118],{"class":94},[88,444,445],{"class":121},"\"idx\"\n",[88,447,448,451,453],{"class":90,"line":162},[88,449,450],{"class":114},"      v-html",[88,452,118],{"class":94},[88,454,455],{"class":121},"\"block\"\n",[88,457,458,461,463],{"class":90,"line":198},[88,459,460],{"class":114},"      class",[88,462,118],{"class":94},[88,464,465],{"class":121},"\"markdown-block\"\n",[88,467,468,471,473],{"class":90,"line":214},[88,469,470],{"class":94},"    >\u003C/",[88,472,111],{"class":98},[88,474,102],{"class":94},[88,476,477,480,482],{"class":90,"line":219},[88,478,479],{"class":94},"  \u003C/",[88,481,111],{"class":98},[88,483,102],{"class":94},[88,485,486,488,490],{"class":90,"line":246},[88,487,135],{"class":94},[88,489,99],{"class":98},[88,491,102],{"class":94},[88,493,494],{"class":90,"line":264},[88,495,146],{"emptyLinePlaceholder":145},[88,497,498,500,502,504],{"class":90,"line":269},[88,499,95],{"class":94},[88,501,154],{"class":98},[88,503,157],{"class":114},[88,505,102],{"class":94},[88,507,508,510,512,514,516,518,520,523,525,527],{"class":90,"line":310},[88,509,166],{"class":165},[88,511,169],{"class":94},[88,513,183],{"class":98},[88,515,175],{"class":94},[88,517,172],{"class":98},[88,519,175],{"class":94},[88,521,522],{"class":98},"watch",[88,524,186],{"class":94},[88,526,189],{"class":165},[88,528,529],{"class":121}," 'vue'\n",[88,531,532,534,536,538],{"class":90,"line":315},[88,533,166],{"class":165},[88,535,203],{"class":98},[88,537,206],{"class":165},[88,539,540],{"class":121}," 'markdown-it'\n",[88,542,543],{"class":90,"line":327},[88,544,146],{"emptyLinePlaceholder":145},[88,546,547,549,551,553,555,557,559],{"class":90,"line":334},[88,548,222],{"class":165},[88,550,226],{"class":225},[88,552,230],{"class":229},[88,554,234],{"class":233},[88,556,237],{"class":94},[88,558,240],{"class":121},[88,560,561],{"class":94},")\n",[88,563,564,566,568,570,572,574],{"class":90,"line":340},[88,565,222],{"class":165},[88,567,251],{"class":225},[88,569,230],{"class":229},[88,571,256],{"class":165},[88,573,203],{"class":233},[88,575,576],{"class":94},"()\n",[88,578,580],{"class":90,"line":579},18,[88,581,146],{"emptyLinePlaceholder":145},[88,583,585,587,590,592,594],{"class":90,"line":584},19,[88,586,222],{"class":165},[88,588,589],{"class":225}," renderedBlocks",[88,591,230],{"class":229},[88,593,234],{"class":233},[88,595,596],{"class":94},"([])\n",[88,598,600,602,605,607,609],{"class":90,"line":599},20,[88,601,222],{"class":165},[88,603,604],{"class":225}," blockCache",[88,606,230],{"class":229},[88,608,234],{"class":233},[88,610,596],{"class":94},[88,612,614],{"class":90,"line":613},21,[88,615,146],{"emptyLinePlaceholder":145},[88,617,619,621],{"class":90,"line":618},22,[88,620,522],{"class":233},[88,622,623],{"class":94},"(\n",[88,625,627,631],{"class":90,"line":626},23,[88,628,630],{"class":629},"sz0mV","  markdownContent",[88,632,633],{"class":94},",\n",[88,635,637,640,644,646,649,652,654],{"class":90,"line":636},24,[88,638,639],{"class":94},"  (",[88,641,643],{"class":642},"s8iYz","newContent",[88,645,175],{"class":94},[88,647,648],{"class":642},"oldContent",[88,650,651],{"class":94},") ",[88,653,285],{"class":165},[88,655,324],{"class":94},[88,657,659,662,665,667,670,672,675,677,681,685,689,691],{"class":90,"line":658},25,[88,660,661],{"class":165},"    const",[88,663,664],{"class":225}," blocks",[88,666,230],{"class":229},[88,668,669],{"class":288}," newContent",[88,671,291],{"class":94},[88,673,674],{"class":233},"split",[88,676,237],{"class":94},[88,678,680],{"class":679},"sDaw7","/",[88,682,684],{"class":683},"sRZ4U","\\n",[88,686,688],{"class":687},"sYoRg","{2,}",[88,690,680],{"class":679},[88,692,561],{"class":94},[88,694,696],{"class":90,"line":695},26,[88,697,698],{"class":330},"    // 只重新渲染最后一个块，其余用缓存\n",[88,700,702],{"class":90,"line":701},27,[88,703,704],{"class":330},"    // 处理块减少、块增多的场景\n",[88,706,708,711,713,716,718,721,723,725,727],{"class":90,"line":707},28,[88,709,710],{"class":288},"    blockCache",[88,712,291],{"class":94},[88,714,304],{"class":715},"s2QsP",[88,717,291],{"class":94},[88,719,720],{"class":98},"length",[88,722,230],{"class":229},[88,724,664],{"class":288},[88,726,291],{"class":94},[88,728,729],{"class":98},"length\n",[88,731,733,736,739,742,745,747,750,753,756,759,761,763,765,767,769,772],{"class":90,"line":732},29,[88,734,735],{"class":165},"    for",[88,737,738],{"class":94}," (",[88,740,741],{"class":165},"let",[88,743,744],{"class":629}," i",[88,746,230],{"class":229},[88,748,749],{"class":114}," 0",[88,751,752],{"class":94},"; ",[88,754,755],{"class":629},"i",[88,757,758],{"class":229}," \u003C",[88,760,664],{"class":288},[88,762,291],{"class":94},[88,764,720],{"class":98},[88,766,752],{"class":94},[88,768,755],{"class":629},[88,770,771],{"class":229},"++",[88,773,774],{"class":94},") {\n",[88,776,778],{"class":90,"line":777},30,[88,779,780],{"class":330},"      // 只渲染最后一个，或新块\n",[88,782,784,787,789,791,794,796,798,800,803,806,809,812,815,817,819,822,824],{"class":90,"line":783},31,[88,785,786],{"class":165},"      if",[88,788,738],{"class":94},[88,790,755],{"class":629},[88,792,793],{"class":229}," ===",[88,795,664],{"class":288},[88,797,291],{"class":94},[88,799,720],{"class":98},[88,801,802],{"class":229}," -",[88,804,805],{"class":114}," 1",[88,807,808],{"class":229}," ||",[88,810,811],{"class":229}," !",[88,813,814],{"class":288},"blockCache",[88,816,291],{"class":94},[88,818,304],{"class":98},[88,820,821],{"class":94},"[",[88,823,755],{"class":629},[88,825,826],{"class":94},"]) {\n",[88,828,830,833,835,837,839,841,844,846,848,850,852,854,857,859,861,863,866,869],{"class":90,"line":829},32,[88,831,832],{"class":288},"        blockCache",[88,834,291],{"class":94},[88,836,304],{"class":98},[88,838,821],{"class":94},[88,840,755],{"class":629},[88,842,843],{"class":94},"] ",[88,845,118],{"class":229},[88,847,251],{"class":288},[88,849,291],{"class":94},[88,851,294],{"class":233},[88,853,237],{"class":94},[88,855,856],{"class":629},"blocks",[88,858,821],{"class":94},[88,860,755],{"class":629},[88,862,843],{"class":94},[88,864,865],{"class":229},"||",[88,867,868],{"class":121}," ''",[88,870,561],{"class":94},[88,872,874],{"class":90,"line":873},33,[88,875,876],{"class":94},"      }\n",[88,878,880],{"class":90,"line":879},34,[88,881,882],{"class":330},"      // 其余块直接复用\n",[88,884,886],{"class":90,"line":885},35,[88,887,888],{"class":94},"    }\n",[88,890,892,895,897,899,901,903,905,907,909,912],{"class":90,"line":891},36,[88,893,894],{"class":288},"    renderedBlocks",[88,896,291],{"class":94},[88,898,304],{"class":98},[88,900,230],{"class":229},[88,902,604],{"class":288},[88,904,291],{"class":94},[88,906,304],{"class":715},[88,908,291],{"class":94},[88,910,911],{"class":233},"slice",[88,913,576],{"class":94},[88,915,917],{"class":90,"line":916},37,[88,918,919],{"class":94},"  },\n",[88,921,923,926,929,933,936],{"class":90,"line":922},38,[88,924,925],{"class":94},"  { ",[88,927,928],{"class":98},"immediate",[88,930,932],{"class":931},"st7oF",":",[88,934,935],{"class":114}," true",[88,937,938],{"class":94}," }\n",[88,940,942],{"class":90,"line":941},39,[88,943,561],{"class":94},[88,945,947],{"class":90,"line":946},40,[88,948,146],{"emptyLinePlaceholder":145},[88,950,952,954,956,958],{"class":90,"line":951},41,[88,953,178],{"class":233},[88,955,282],{"class":94},[88,957,285],{"class":165},[88,959,324],{"class":94},[88,961,963],{"class":90,"line":962},42,[88,964,331],{"class":330},[88,966,968],{"class":90,"line":967},43,[88,969,337],{"class":94},[88,971,973,975,977],{"class":90,"line":972},44,[88,974,135],{"class":94},[88,976,154],{"class":98},[88,978,102],{"class":94},[17,980,982],{"id":981},"终极武器用-morphdom-实现精准更新","终极武器：用 morphdom 实现精准更新",[21,984,985],{},"分块渲染虽然解决了大部分问题，但遇到 Markdown 列表就有点力不从心了。因为 Markdown 语法里，列表项之间通常只有一个换行符，整个列表会被当成一个大块。想象一下一个几百项的列表，哪怕只更新最后一项，整个列表块也要全部重来，前面的问题又回来了。",[987,988,990],"h3",{"id":989},"morphdom-是何方神圣","morphdom 是何方神圣？",[21,992,993,996,997,1000],{},[71,994,995],{},"morphdom"," 是一个仅 5KB（gzip 后）的 JavaScript 库，核心功能是：",[66,998,999],{},"接收两个 DOM 节点（或 HTML 字符串），计算出最小化的 DOM 操作，将第一个节点 “变形” 为第二个节点，而非直接替换","。",[21,1002,1003,1004,1007],{},"其工作原理类似虚拟 DOM 的 Diff 算法，但",[66,1005,1006],{},"直接操作真实 DOM","：",[359,1009,1010,1013,1016],{},[362,1011,1012],{},"对比新旧 DOM 的标签名、属性、文本内容等；",[362,1014,1015],{},"仅对差异部分执行增 / 删 / 改操作（如修改文本、更新属性、移动节点位置）；",[362,1017,1018],{},"未变化的 DOM 节点会被完整保留，包括其事件监听、滚动位置、选中状态等。",[21,1020,1021,1022,1025,1026,1028],{},"Markdown 把列表当整体，但生成的 HTML 里，每个列表项 (",[71,1023,1024],{},"\u003Cli>",") 都是独立的！",[71,1027,995],{}," 在更新后面的列表项时，能保证前面的列表项纹丝不动，状态自然就保住了。",[21,1030,1031],{},"这不就是我们梦寐以求的效果吗？在 Markdown 实时更新的同时，最大程度留住用户的操作状态，还能省掉一堆不必要的 DOM 操作！",[987,1033,1034],{"id":1034},"示例代码",[79,1036,1038],{"className":81,"code":1037,"language":83,"meta":84,"style":84},"\u003Ctemplate>\n  \u003Cdiv ref=\"markdownContainer\" class=\"markdown-container\">\n    \u003Cdiv id=\"md-root\">\u003C/div>\n  \u003C/div>\n\u003C/template>\n\n\u003Cscript setup>\nimport { nextTick, ref, watch } from 'vue';\nimport MarkdownIt from 'markdown-it';\nimport morphdom from 'morphdom';\n\nconst markdownContent = ref('');\nconst markdownContainer = ref(null);\nconst md = new MarkdownIt();\n\nconst render = () => {\n  if (!markdownContainer.value.querySelector('#md-root')) return;\n\n  const newHtml = `\u003Cdiv id=\"md-root\">` + md.render(markdownContent.value) + `\u003C/div>`\n\n  morphdom(markdownContainer.value, newHtml, {\n    childrenOnly: true\n  });\n}\n\nwatch(markdownContent, () => {\n    render()\n});\n\nonMounted(async () => {\n  // 等待 Dom 被挂载上\n  await nextTick()\n  render()\n})\n\u003C/script>\n\n",[71,1039,1040,1048,1071,1091,1099,1107,1111,1121,1146,1158,1172,1176,1192,1210,1224,1228,1244,1279,1283,1321,1325,1346,1356,1361,1366,1370,1385,1392,1397,1401,1416,1421,1431,1438,1442],{"__ignoreMap":84},[88,1041,1042,1044,1046],{"class":90,"line":91},[88,1043,95],{"class":94},[88,1045,99],{"class":98},[88,1047,102],{"class":94},[88,1049,1050,1052,1054,1056,1058,1061,1064,1066,1069],{"class":90,"line":105},[88,1051,108],{"class":94},[88,1053,111],{"class":98},[88,1055,234],{"class":114},[88,1057,118],{"class":94},[88,1059,1060],{"class":121},"\"markdownContainer\"",[88,1062,1063],{"class":114}," class",[88,1065,118],{"class":94},[88,1067,1068],{"class":121},"\"markdown-container\"",[88,1070,102],{"class":94},[88,1072,1073,1075,1077,1080,1082,1085,1087,1089],{"class":90,"line":132},[88,1074,422],{"class":94},[88,1076,111],{"class":98},[88,1078,1079],{"class":114}," id",[88,1081,118],{"class":94},[88,1083,1084],{"class":121},"\"md-root\"",[88,1086,125],{"class":94},[88,1088,111],{"class":98},[88,1090,102],{"class":94},[88,1092,1093,1095,1097],{"class":90,"line":142},[88,1094,479],{"class":94},[88,1096,111],{"class":98},[88,1098,102],{"class":94},[88,1100,1101,1103,1105],{"class":90,"line":149},[88,1102,135],{"class":94},[88,1104,99],{"class":98},[88,1106,102],{"class":94},[88,1108,1109],{"class":90,"line":162},[88,1110,146],{"emptyLinePlaceholder":145},[88,1112,1113,1115,1117,1119],{"class":90,"line":198},[88,1114,95],{"class":94},[88,1116,154],{"class":98},[88,1118,157],{"class":114},[88,1120,102],{"class":94},[88,1122,1123,1125,1127,1130,1132,1134,1136,1138,1140,1142,1144],{"class":90,"line":214},[88,1124,166],{"class":165},[88,1126,169],{"class":94},[88,1128,1129],{"class":98},"nextTick",[88,1131,175],{"class":94},[88,1133,183],{"class":98},[88,1135,175],{"class":94},[88,1137,522],{"class":98},[88,1139,186],{"class":94},[88,1141,189],{"class":165},[88,1143,192],{"class":121},[88,1145,195],{"class":94},[88,1147,1148,1150,1152,1154,1156],{"class":90,"line":219},[88,1149,166],{"class":165},[88,1151,203],{"class":98},[88,1153,206],{"class":165},[88,1155,209],{"class":121},[88,1157,195],{"class":94},[88,1159,1160,1162,1165,1167,1170],{"class":90,"line":246},[88,1161,166],{"class":165},[88,1163,1164],{"class":98}," morphdom",[88,1166,206],{"class":165},[88,1168,1169],{"class":121}," 'morphdom'",[88,1171,195],{"class":94},[88,1173,1174],{"class":90,"line":264},[88,1175,146],{"emptyLinePlaceholder":145},[88,1177,1178,1180,1182,1184,1186,1188,1190],{"class":90,"line":269},[88,1179,222],{"class":165},[88,1181,226],{"class":225},[88,1183,230],{"class":229},[88,1185,234],{"class":233},[88,1187,237],{"class":94},[88,1189,240],{"class":121},[88,1191,243],{"class":94},[88,1193,1194,1196,1199,1201,1203,1205,1208],{"class":90,"line":310},[88,1195,222],{"class":165},[88,1197,1198],{"class":225}," markdownContainer",[88,1200,230],{"class":229},[88,1202,234],{"class":233},[88,1204,237],{"class":94},[88,1206,1207],{"class":114},"null",[88,1209,243],{"class":94},[88,1211,1212,1214,1216,1218,1220,1222],{"class":90,"line":315},[88,1213,222],{"class":165},[88,1215,251],{"class":225},[88,1217,230],{"class":229},[88,1219,256],{"class":165},[88,1221,203],{"class":233},[88,1223,261],{"class":94},[88,1225,1226],{"class":90,"line":327},[88,1227,146],{"emptyLinePlaceholder":145},[88,1229,1230,1232,1235,1237,1240,1242],{"class":90,"line":334},[88,1231,222],{"class":165},[88,1233,1234],{"class":233}," render",[88,1236,230],{"class":229},[88,1238,1239],{"class":94}," () ",[88,1241,285],{"class":165},[88,1243,324],{"class":94},[88,1245,1246,1249,1251,1254,1257,1259,1261,1263,1266,1268,1271,1274,1277],{"class":90,"line":340},[88,1247,1248],{"class":165},"  if",[88,1250,738],{"class":94},[88,1252,1253],{"class":229},"!",[88,1255,1256],{"class":288},"markdownContainer",[88,1258,291],{"class":94},[88,1260,304],{"class":715},[88,1262,291],{"class":94},[88,1264,1265],{"class":233},"querySelector",[88,1267,237],{"class":94},[88,1269,1270],{"class":121},"'#md-root'",[88,1272,1273],{"class":94},")) ",[88,1275,1276],{"class":165},"return",[88,1278,195],{"class":94},[88,1280,1281],{"class":90,"line":579},[88,1282,146],{"emptyLinePlaceholder":145},[88,1284,1285,1288,1291,1293,1296,1299,1301,1303,1305,1307,1309,1311,1313,1315,1318],{"class":90,"line":584},[88,1286,1287],{"class":165},"  const",[88,1289,1290],{"class":225}," newHtml",[88,1292,230],{"class":229},[88,1294,1295],{"class":121}," `\u003Cdiv id=\"md-root\">`",[88,1297,1298],{"class":229}," +",[88,1300,251],{"class":288},[88,1302,291],{"class":94},[88,1304,294],{"class":233},[88,1306,237],{"class":94},[88,1308,299],{"class":288},[88,1310,291],{"class":94},[88,1312,304],{"class":98},[88,1314,651],{"class":94},[88,1316,1317],{"class":229},"+",[88,1319,1320],{"class":121}," `\u003C/div>`\n",[88,1322,1323],{"class":90,"line":599},[88,1324,146],{"emptyLinePlaceholder":145},[88,1326,1327,1330,1332,1334,1336,1338,1340,1343],{"class":90,"line":613},[88,1328,1329],{"class":233},"  morphdom",[88,1331,237],{"class":94},[88,1333,1256],{"class":288},[88,1335,291],{"class":94},[88,1337,304],{"class":98},[88,1339,175],{"class":94},[88,1341,1342],{"class":629},"newHtml",[88,1344,1345],{"class":94},", {\n",[88,1347,1348,1351,1353],{"class":90,"line":618},[88,1349,1350],{"class":98},"    childrenOnly",[88,1352,932],{"class":931},[88,1354,1355],{"class":114}," true\n",[88,1357,1358],{"class":90,"line":626},[88,1359,1360],{"class":94},"  });\n",[88,1362,1363],{"class":90,"line":636},[88,1364,1365],{"class":94},"}\n",[88,1367,1368],{"class":90,"line":658},[88,1369,146],{"emptyLinePlaceholder":145},[88,1371,1372,1374,1376,1378,1381,1383],{"class":90,"line":695},[88,1373,522],{"class":233},[88,1375,237],{"class":94},[88,1377,299],{"class":629},[88,1379,1380],{"class":94},", () ",[88,1382,285],{"class":165},[88,1384,324],{"class":94},[88,1386,1387,1390],{"class":90,"line":701},[88,1388,1389],{"class":233},"    render",[88,1391,576],{"class":94},[88,1393,1394],{"class":90,"line":707},[88,1395,1396],{"class":94},"});\n",[88,1398,1399],{"class":90,"line":732},[88,1400,146],{"emptyLinePlaceholder":145},[88,1402,1403,1405,1407,1410,1412,1414],{"class":90,"line":777},[88,1404,178],{"class":233},[88,1406,237],{"class":94},[88,1408,1409],{"class":165},"async",[88,1411,1239],{"class":94},[88,1413,285],{"class":165},[88,1415,324],{"class":94},[88,1417,1418],{"class":90,"line":783},[88,1419,1420],{"class":330},"  // 等待 Dom 被挂载上\n",[88,1422,1423,1426,1429],{"class":90,"line":829},[88,1424,1425],{"class":165},"  await",[88,1427,1428],{"class":233}," nextTick",[88,1430,576],{"class":94},[88,1432,1433,1436],{"class":90,"line":873},[88,1434,1435],{"class":233},"  render",[88,1437,576],{"class":94},[88,1439,1440],{"class":90,"line":879},[88,1441,337],{"class":94},[88,1443,1444,1446,1448],{"class":90,"line":885},[88,1445,135],{"class":94},[88,1447,154],{"class":98},[88,1449,102],{"class":94},[987,1451,1453],{"id":1452},"眼见为实demo-对比","眼见为实：Demo 对比",[21,1455,1456],{},"下面这个 iframe 里放了个对比 Demo，展示了不同方案的效果差异。",[21,1458,1459,1462],{},[66,1460,1461],{},"小技巧："," 如果你用的是 Chrome、Edge 这类 Chromium 内核的浏览器，打开开发者工具 (DevTools)，找到“渲染”(Rendering) 标签页，勾选「突出显示重绘区域(Paint flashing)」。这样你就能直观看到每次更新时，哪些部分被重新绘制了——重绘区域越少，性能越好！",[21,1464,1465],{},[1466,1467],"img",{"alt":84,"src":1468},"https://static.031130.xyz/uploads/2025/07/12/d5721c40fb076.webp",[1470,1471],"iframe",{"src":1472,"width":1473,"height":1474,"allowFullScreen":145,"loading":1475},"https://static.031130.xyz/demo/morphdom-vs-markdown-chunk.html","100%",500,"lazy",[17,1477,1478],{"id":1478},"阶段性成果",[21,1480,1481,1482,1484],{},"从最开始的“暴力全量刷新”，到“聪明点的分块更新”，再到如今“精准手术刀般的 ",[71,1483,995],{}," 更新”，我们一步步把那些不必要的渲染开销给砍掉了，最终搞出了一个既快又能留住用户状态的 Markdown 实时渲染方案。",[21,1486,1487,1488,1490],{},"不过，用 ",[71,1489,995],{}," 这个第三方库来直接操作 Vue 组件里的 DOM，总觉得有点...不够“Vue”？它虽然解决了核心的性能和状态问题，但在 Vue 的世界里这么玩，多少有点旁门左道的意思。",[21,1492,1493,1496],{},[66,1494,1495],{},"下篇预告："," 在下一篇文章里，咱们就来聊聊，在 Vue 的世界里，有没有更优雅、更“原生”的方案来搞定 Markdown 的精准更新？敬请期待！",[1498,1499,1500],"style",{},"html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html pre.shiki code .sJa8x, html code.shiki .sJa8x{--shiki-default:#E45649;--shiki-dark:#E06C75}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html pre.shiki code .sLKXg, html code.shiki .sLKXg{--shiki-default:#A626A4;--shiki-dark:#C678DD}html pre.shiki code .sNmU0, html code.shiki .sNmU0{--shiki-default:#986801;--shiki-dark:#E5C07B}html pre.shiki code .s_Sar, html code.shiki .s_Sar{--shiki-default:#0184BC;--shiki-dark:#56B6C2}html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .s7GmK, html code.shiki .s7GmK{--shiki-default:#383A42;--shiki-dark:#E5C07B}html pre.shiki code .sW2Sy, html code.shiki .sW2Sy{--shiki-default:#A0A1A7;--shiki-default-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html pre.shiki code .sz0mV, html code.shiki .sz0mV{--shiki-default:#383A42;--shiki-dark:#E06C75}html pre.shiki code .s8iYz, html code.shiki .s8iYz{--shiki-default:#383A42;--shiki-default-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic}html pre.shiki code .sDaw7, html code.shiki .sDaw7{--shiki-default:#0184BC;--shiki-dark:#E06C75}html pre.shiki code .sRZ4U, html code.shiki .sRZ4U{--shiki-default:#986801;--shiki-dark:#E06C75}html pre.shiki code .sYoRg, html code.shiki .sYoRg{--shiki-default:#0184BC;--shiki-dark:#D19A66}html pre.shiki code .s2QsP, html code.shiki .s2QsP{--shiki-default:#E45649;--shiki-dark:#E5C07B}html pre.shiki code .st7oF, html code.shiki .st7oF{--shiki-default:#0184BC;--shiki-dark:#ABB2BF}",{"title":84,"searchDepth":105,"depth":105,"links":1502},[1503,1504,1505,1506,1511],{"id":19,"depth":105,"text":19},{"id":55,"depth":105,"text":56},{"id":349,"depth":105,"text":350},{"id":981,"depth":105,"text":982,"children":1507},[1508,1509,1510],{"id":989,"depth":132,"text":990},{"id":1034,"depth":132,"text":1034},{"id":1452,"depth":132,"text":1453},{"id":1478,"depth":105,"text":1478},[1513,1519],{"title":1514,"path":1515,"stem":1516,"date":1517,"lang":1518,"children":-1},"Vue Markdown 渲染优化实战(下)：告别 DOM 操作，拥抱 AST 与函数式渲染","/2025/07/13/vue-markdown-render-improvement-2","posts/zh/vue-markdown-render-improvement-2","2025-07-13 00:01:35","zh-CN",{"title":1520,"path":1521,"stem":1522,"date":1523,"lang":1518,"children":-1},"node-sass 迁移至 dart-sass 踩坑实录","/2025/07/05/node-sass-migration-to-dart-sass","posts/zh/node-sass-migration-to-dart-sass","2025-07-05 17:57:02","/en/2025/07/12/vue-markdown-render-improvement-1/",1766337199316]
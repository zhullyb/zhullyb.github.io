[{"data":1,"prerenderedAt":491},["ShallowReactive",2],{"post-2024-09-20-migrate-rustdesk-server-from-arch-to-debian-zh":3,"surround-2024-09-20-migrate-rustdesk-server-from-arch-to-debian-zh":478,"randomIndex/2024/09/20/migrate-rustdesk-server-from-arch-to-debian/":265,"language-switch-/2024/09/20/migrate-rustdesk-server-from-arch-to-debian/-en":490},{"title":4,"date":5,"path":6,"tags":7,"body":12,"description":18},"将 Rustdesk 中继服务从 Arch Linux 迁移至 Debian","2024-09-20 03:20:38","/2024/09/20/migrate-rustdesk-server-from-arch-to-debian",[8,9,10,11],"Rustdesk","Archlinux","Debian","Linux",{"type":13,"value":14,"toc":469},"minimark",[15,19,39,42,47,61,71,75,354,357,360,363,366,373,380,383,389,392,395,413,416,419,425,430,433,436,441,444,465],[16,17,18],"p",{},"这次迁移主要是两方面原因，一来是我安装了 Arch Linux 的 VPS 要过期了，续费价格过高，没有续费的动力；二来是手上的 VPS 越来越多，逐渐意识到 Arch Linux 作为滚动发行版，每次安装新的软件都要 Syu 甚至重启系统，实在没有太多的精力去维护，这也是为什么 Arch Linux 仅适合桌面发行版。",[16,20,21,22,29,30,34,35,38],{},"原本在 Arch Linux 上部署的 rustdesk server 我是按照这篇文章「",[23,24,28],"a",{"href":25,"rel":26},"https://www.liyp.cc/archives/1698241638248",[27],"nofollow","(水文)在archlinux上部署rustdesk服务端","」部署的。本身没什么技巧，直接从 AUR 安装现成的 rustdesk-server-bin，使用 systemctl 启用 ",[31,32,33],"code",{},"rustdesk-server-hbbr.service"," 和 ",[31,36,37],{},"rustdesk-server-hbbs.service"," 两个服务即可。",[16,40,41],{},"Rustdesk 现在为 Debian 提供了官方的中继服务器的 deb 包，而谷歌搜了一圈都是下载 zip 包使用 pm2 管理进程，故写下此文。",[43,44,46],"h2",{"id":45},"备份原服务器的-rustdesk-密钥","备份原服务器的 rustdesk 密钥",[16,48,49,50,53,54,34,57,60],{},"AUR 上的安装方案将密钥放在 ",[31,51,52],{},"/opt/rustdesk-server/data"," 直接用 sftp 获取 ",[31,55,56],{},"id_ed25519",[31,58,59],{},"id_ed25519.pub"," 两个文件就行。如果是新部署的没有这两个文件也没事，rustdesk 服务在启动时可以自动创建，只不过需要在客户端重新输入公钥。",[62,63,68],"pre",{"className":64,"code":66,"language":67},[65],"language-text","sftp> get /opt/rustdesk-server/data/id_ed25519\nsftp> get /opt/rustdesk-server/data/id_ed25519.pub\n","text",[31,69,66],{"__ignoreMap":70},"",[43,72,74],{"id":73},"在新服务器上下载-deb-包进行安装","在新服务器上下载 deb 包，进行安装",[62,76,80],{"className":77,"code":78,"language":79,"meta":70,"style":70},"language-bash shiki shiki-themes one-light one-dark-pro","apt install -y curl jq\nversion=$(curl -s https://api.github.com/repos/rustdesk/rustdesk-server/releases/latest | jq .tag_name)\n\nhbbr_deb=rustdesk-server-hbbr_${version:1:-1}_amd64.deb\nhbbs_deb=rustdesk-server-hbbs_${version:1:-1}_amd64.deb\nutils_deb=rustdesk-server-utils_${version:1:-1}_amd64.deb\n\nfor deb in $hbbr_deb $hbbs_deb $utils_deb\ndo\n    curl -L https://github.com/rustdesk/rustdesk-server/releases/download/${version:1:-1}/${deb} -o ${deb}\ndone\n\ndpkg -i $hbbr_deb $hbbs_deb $utils_deb\nrm $hbbr_deb $hbbs_deb $utils_deb\n","bash",[31,81,82,105,141,148,182,209,236,241,263,269,316,322,327,342],{"__ignoreMap":70},[83,84,87,91,95,99,102],"span",{"class":85,"line":86},"line",1,[83,88,90],{"class":89},"sAdtL","apt",[83,92,94],{"class":93},"sDhpE"," install",[83,96,98],{"class":97},"sAGMh"," -y",[83,100,101],{"class":93}," curl",[83,103,104],{"class":93}," jq\n",[83,106,108,112,116,120,123,126,129,132,135,138],{"class":85,"line":107},2,[83,109,111],{"class":110},"sJa8x","version",[83,113,115],{"class":114},"sknuh","=",[83,117,119],{"class":118},"s5ixo","$(",[83,121,122],{"class":89},"curl",[83,124,125],{"class":97}," -s",[83,127,128],{"class":93}," https://api.github.com/repos/rustdesk/rustdesk-server/releases/latest",[83,130,131],{"class":118}," | ",[83,133,134],{"class":89},"jq",[83,136,137],{"class":93}," .tag_name",[83,139,140],{"class":118},")\n",[83,142,144],{"class":85,"line":143},3,[83,145,147],{"emptyLinePlaceholder":146},true,"\n",[83,149,151,154,156,159,163,165,168,171,174,176,179],{"class":85,"line":150},4,[83,152,153],{"class":110},"hbbr_deb",[83,155,115],{"class":114},[83,157,158],{"class":93},"rustdesk-server-hbbr_",[83,160,162],{"class":161},"sr1Ac","${",[83,164,111],{"class":110},[83,166,167],{"class":118},":",[83,169,170],{"class":110},"1",[83,172,173],{"class":118},":-",[83,175,170],{"class":110},[83,177,178],{"class":161},"}",[83,180,181],{"class":93},"_amd64.deb\n",[83,183,185,188,190,193,195,197,199,201,203,205,207],{"class":85,"line":184},5,[83,186,187],{"class":110},"hbbs_deb",[83,189,115],{"class":114},[83,191,192],{"class":93},"rustdesk-server-hbbs_",[83,194,162],{"class":161},[83,196,111],{"class":110},[83,198,167],{"class":118},[83,200,170],{"class":110},[83,202,173],{"class":118},[83,204,170],{"class":110},[83,206,178],{"class":161},[83,208,181],{"class":93},[83,210,212,215,217,220,222,224,226,228,230,232,234],{"class":85,"line":211},6,[83,213,214],{"class":110},"utils_deb",[83,216,115],{"class":114},[83,218,219],{"class":93},"rustdesk-server-utils_",[83,221,162],{"class":161},[83,223,111],{"class":110},[83,225,167],{"class":118},[83,227,170],{"class":110},[83,229,173],{"class":118},[83,231,170],{"class":110},[83,233,178],{"class":161},[83,235,181],{"class":93},[83,237,239],{"class":85,"line":238},7,[83,240,147],{"emptyLinePlaceholder":146},[83,242,244,248,251,254,257,260],{"class":85,"line":243},8,[83,245,247],{"class":246},"sLKXg","for",[83,249,250],{"class":110}," deb",[83,252,253],{"class":246}," in",[83,255,256],{"class":110}," $hbbr_deb",[83,258,259],{"class":110}," $hbbs_deb",[83,261,262],{"class":110}," $utils_deb\n",[83,264,266],{"class":85,"line":265},9,[83,267,268],{"class":246},"do\n",[83,270,272,275,278,281,283,285,287,289,291,293,295,298,300,303,305,308,311,313],{"class":85,"line":271},10,[83,273,274],{"class":89},"    curl",[83,276,277],{"class":97}," -L",[83,279,280],{"class":93}," https://github.com/rustdesk/rustdesk-server/releases/download/",[83,282,162],{"class":161},[83,284,111],{"class":110},[83,286,167],{"class":118},[83,288,170],{"class":110},[83,290,173],{"class":118},[83,292,170],{"class":110},[83,294,178],{"class":161},[83,296,297],{"class":93},"/",[83,299,162],{"class":161},[83,301,302],{"class":110},"deb",[83,304,178],{"class":161},[83,306,307],{"class":97}," -o",[83,309,310],{"class":161}," ${",[83,312,302],{"class":110},[83,314,315],{"class":161},"}\n",[83,317,319],{"class":85,"line":318},11,[83,320,321],{"class":246},"done\n",[83,323,325],{"class":85,"line":324},12,[83,326,147],{"emptyLinePlaceholder":146},[83,328,330,333,336,338,340],{"class":85,"line":329},13,[83,331,332],{"class":89},"dpkg",[83,334,335],{"class":97}," -i",[83,337,256],{"class":110},[83,339,259],{"class":110},[83,341,262],{"class":110},[83,343,345,348,350,352],{"class":85,"line":344},14,[83,346,347],{"class":89},"rm",[83,349,256],{"class":110},[83,351,259],{"class":110},[83,353,262],{"class":110},[16,355,356],{},"简单写了个脚本，仅适用 amd64，也没做异常处理，如果服务器在大陆境内需要自行解决 github 下载时可能出现的网络波动问题。",[16,358,359],{},"dpkg 安装结束后默认会启用两个 systemd 服务并开机自启，所以不需要使用 systemctl 手动启用。",[43,361,362],{"id":362},"替换密钥",[16,364,365],{},"将刚刚备份的一个公钥和一个私钥放在 Debian 服务器的相应路径，问题是这个路径在哪里呢？",[16,367,368,369,372],{},"通过翻看 rustdesk 的 service 文件，我们大概可以定位到是在 ",[31,370,371],{},"/var/lib/rustdesk-server/"," 路径下的",[16,374,375],{},[376,377],"img",{"alt":378,"src":379},"service 问价你","https://static.031130.xyz/uploads/2024/09/20/59d08477f8a0b.webp",[16,381,382],{},"直接对两个密钥文件进行替换，重启 rustdesk 相关的两个 service 服务即可。",[16,384,385],{},[376,386],{"alt":387,"src":388},"密钥文件","https://static.031130.xyz/uploads/2024/09/20/527c5b1151a57.webp",[43,390,391],{"id":391},"开放服务器防火墙",[16,393,394],{},"需要开放如下端口，记得 Linux 的防火墙和云服务供应商面板（如果有的话）上都要开放",[396,397,398,407],"ul",{},[399,400,401,402,406],"li",{},"TCP(",[403,404,405],"strong",{},"21115, 21116, 21117, 21118, 21119",")",[399,408,409,410,406],{},"UDP(",[403,411,412],{},"21116",[43,414,415],{"id":415},"客户端设置",[16,417,418],{},"id_ed25519.pub 对应客户端中需要输入的 Key，大概长成下面这个样子",[62,420,423],{"className":421,"code":422,"language":67},[65],"rdtxujYccRLXwXOu2KR3V9cGgP51lEdSmE0HJHGNkn4=\n",[31,424,422],{"__ignoreMap":70},[16,426,427],{},[376,428],{"alt":70,"src":429},"https://static.031130.xyz/uploads/2024/09/20/cc715265b8b37.webp",[16,431,432],{},"ID 服务器直接输入中继服务器的 ip 或者解析到对应 ip 的域名即可，另外两个地址可以不填，RustDesk会自动推导（如果没有特别设定）",[43,434,435],{"id":435},"成果展示",[16,437,438],{},[376,439],{"alt":435,"src":440},"https://static.031130.xyz/uploads/2024/09/20/3108bac773390.webp",[43,442,443],{"id":443},"参见",[396,445,446,453,460],{},[399,447,448],{},[23,449,452],{"href":450,"rel":451},"https://rustdesk.com/docs/en/self-host/rustdesk-server-oss/install/",[27],"Installation :: Documentation for RustDesk",[399,454,455],{},[23,456,459],{"href":457,"rel":458},"https://catcat.blog/rustdesk-debian-%E8%87%AA%E5%BB%BA%E4%B8%AD%E7%BB%A7%E6%9C%8D%E5%8A%A1%E5%99%A8.html",[27],"RustDesk Debian 自建中继服务器",[399,461,462],{},[23,463,28],{"href":25,"rel":464},[27],[466,467,468],"style",{},"html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html pre.shiki code .sJa8x, html code.shiki .sJa8x{--shiki-default:#E45649;--shiki-dark:#E06C75}html pre.shiki code .sknuh, html code.shiki .sknuh{--shiki-default:#383A42;--shiki-dark:#56B6C2}html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html pre.shiki code .sr1Ac, html code.shiki .sr1Ac{--shiki-default:#E45649;--shiki-dark:#ABB2BF}html pre.shiki code .sLKXg, html code.shiki .sLKXg{--shiki-default:#A626A4;--shiki-dark:#C678DD}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}",{"title":70,"searchDepth":107,"depth":107,"links":470},[471,472,473,474,475,476,477],{"id":45,"depth":107,"text":46},{"id":73,"depth":107,"text":74},{"id":362,"depth":107,"text":362},{"id":391,"depth":107,"text":391},{"id":415,"depth":107,"text":415},{"id":435,"depth":107,"text":435},{"id":443,"depth":107,"text":443},[479,485],{"title":480,"path":481,"stem":482,"date":483,"lang":484,"children":-1},"使用 Caddy 反向代理 dockerhub 需要几步？","/2024/09/21/how-to-reverse-proxy-dockerhub-with-caddy","posts/zh/how-to-reverse-proxy-dockerhub-with-caddy","2024-09-21 01:29:17","zh-CN",{"title":486,"path":487,"stem":488,"date":489,"lang":484,"children":-1},"自建图床小记五——费用","/2024/08/21/self-host-cdn-expense","posts/zh/self-host-cdn-expense","2024-08-21 00:05:15",null,1766566744234]
[{"data":1,"prerenderedAt":497},["ShallowReactive",2],{"post-2024-09-20-migrate-rustdesk-server-from-arch-to-debian":3,"surround-2024-09-20-migrate-rustdesk-server-from-arch-to-debian":486,"randomIndex/2024/09/20/migrate-rustdesk-server-from-arch-to-debian/":80},{"id":4,"title":5,"body":6,"date":472,"description":12,"extension":473,"meta":474,"navigation":140,"path":475,"rawbody":476,"seo":477,"stem":478,"sticky":479,"tags":480,"__hash__":485},"posts/posts/migrate-rustdesk-server-from-arch-to-debian.md","将 Rustdesk 中继服务从 Arch Linux 迁移至 Debian",{"type":7,"value":8,"toc":463},"minimark",[9,13,33,36,41,55,65,69,348,351,354,357,360,367,374,377,383,386,389,407,410,413,419,424,427,430,435,438,459],[10,11,12],"p",{},"这次迁移主要是两方面原因，一来是我安装了 Arch Linux 的 VPS 要过期了，续费价格过高，没有续费的动力；二来是手上的 VPS 越来越多，逐渐意识到 Arch Linux 作为滚动发行版，每次安装新的软件都要 Syu 甚至重启系统，实在没有太多的精力去维护，这也是为什么 Arch Linux 仅适合桌面发行版。",[10,14,15,16,23,24,28,29,32],{},"原本在 Arch Linux 上部署的 rustdesk server 我是按照这篇文章「",[17,18,22],"a",{"href":19,"rel":20},"https://www.liyp.cc/archives/1698241638248",[21],"nofollow","(水文)在archlinux上部署rustdesk服务端","」部署的。本身没什么技巧，直接从 AUR 安装现成的 rustdesk-server-bin，使用 systemctl 启用 ",[25,26,27],"code",{},"rustdesk-server-hbbr.service"," 和 ",[25,30,31],{},"rustdesk-server-hbbs.service"," 两个服务即可。",[10,34,35],{},"Rustdesk 现在为 Debian 提供了官方的中继服务器的 deb 包，而谷歌搜了一圈都是下载 zip 包使用 pm2 管理进程，故写下此文。",[37,38,40],"h2",{"id":39},"备份原服务器的-rustdesk-密钥","备份原服务器的 rustdesk 密钥",[10,42,43,44,47,48,28,51,54],{},"AUR 上的安装方案将密钥放在 ",[25,45,46],{},"/opt/rustdesk-server/data"," 直接用 sftp 获取 ",[25,49,50],{},"id_ed25519",[25,52,53],{},"id_ed25519.pub"," 两个文件就行。如果是新部署的没有这两个文件也没事，rustdesk 服务在启动时可以自动创建，只不过需要在客户端重新输入公钥。",[56,57,62],"pre",{"className":58,"code":60,"language":61},[59],"language-text","sftp> get /opt/rustdesk-server/data/id_ed25519\nsftp> get /opt/rustdesk-server/data/id_ed25519.pub\n","text",[25,63,60],{"__ignoreMap":64},"",[37,66,68],{"id":67},"在新服务器上下载-deb-包进行安装","在新服务器上下载 deb 包，进行安装",[56,70,74],{"className":71,"code":72,"language":73,"meta":64,"style":64},"language-bash shiki shiki-themes one-light one-dark-pro","apt install -y curl jq\nversion=$(curl -s https://api.github.com/repos/rustdesk/rustdesk-server/releases/latest | jq .tag_name)\n\nhbbr_deb=rustdesk-server-hbbr_${version:1:-1}_amd64.deb\nhbbs_deb=rustdesk-server-hbbs_${version:1:-1}_amd64.deb\nutils_deb=rustdesk-server-utils_${version:1:-1}_amd64.deb\n\nfor deb in $hbbr_deb $hbbs_deb $utils_deb\ndo\n    curl -L https://github.com/rustdesk/rustdesk-server/releases/download/${version:1:-1}/${deb} -o ${deb}\ndone\n\ndpkg -i $hbbr_deb $hbbs_deb $utils_deb\nrm $hbbr_deb $hbbs_deb $utils_deb\n","bash",[25,75,76,99,135,142,176,203,230,235,257,263,310,316,321,336],{"__ignoreMap":64},[77,78,81,85,89,93,96],"span",{"class":79,"line":80},"line",1,[77,82,84],{"class":83},"sAdtL","apt",[77,86,88],{"class":87},"sDhpE"," install",[77,90,92],{"class":91},"sAGMh"," -y",[77,94,95],{"class":87}," curl",[77,97,98],{"class":87}," jq\n",[77,100,102,106,110,114,117,120,123,126,129,132],{"class":79,"line":101},2,[77,103,105],{"class":104},"sJa8x","version",[77,107,109],{"class":108},"sknuh","=",[77,111,113],{"class":112},"s5ixo","$(",[77,115,116],{"class":83},"curl",[77,118,119],{"class":91}," -s",[77,121,122],{"class":87}," https://api.github.com/repos/rustdesk/rustdesk-server/releases/latest",[77,124,125],{"class":112}," | ",[77,127,128],{"class":83},"jq",[77,130,131],{"class":87}," .tag_name",[77,133,134],{"class":112},")\n",[77,136,138],{"class":79,"line":137},3,[77,139,141],{"emptyLinePlaceholder":140},true,"\n",[77,143,145,148,150,153,157,159,162,165,168,170,173],{"class":79,"line":144},4,[77,146,147],{"class":104},"hbbr_deb",[77,149,109],{"class":108},[77,151,152],{"class":87},"rustdesk-server-hbbr_",[77,154,156],{"class":155},"sr1Ac","${",[77,158,105],{"class":104},[77,160,161],{"class":112},":",[77,163,164],{"class":104},"1",[77,166,167],{"class":112},":-",[77,169,164],{"class":104},[77,171,172],{"class":155},"}",[77,174,175],{"class":87},"_amd64.deb\n",[77,177,179,182,184,187,189,191,193,195,197,199,201],{"class":79,"line":178},5,[77,180,181],{"class":104},"hbbs_deb",[77,183,109],{"class":108},[77,185,186],{"class":87},"rustdesk-server-hbbs_",[77,188,156],{"class":155},[77,190,105],{"class":104},[77,192,161],{"class":112},[77,194,164],{"class":104},[77,196,167],{"class":112},[77,198,164],{"class":104},[77,200,172],{"class":155},[77,202,175],{"class":87},[77,204,206,209,211,214,216,218,220,222,224,226,228],{"class":79,"line":205},6,[77,207,208],{"class":104},"utils_deb",[77,210,109],{"class":108},[77,212,213],{"class":87},"rustdesk-server-utils_",[77,215,156],{"class":155},[77,217,105],{"class":104},[77,219,161],{"class":112},[77,221,164],{"class":104},[77,223,167],{"class":112},[77,225,164],{"class":104},[77,227,172],{"class":155},[77,229,175],{"class":87},[77,231,233],{"class":79,"line":232},7,[77,234,141],{"emptyLinePlaceholder":140},[77,236,238,242,245,248,251,254],{"class":79,"line":237},8,[77,239,241],{"class":240},"sLKXg","for",[77,243,244],{"class":104}," deb",[77,246,247],{"class":240}," in",[77,249,250],{"class":104}," $hbbr_deb",[77,252,253],{"class":104}," $hbbs_deb",[77,255,256],{"class":104}," $utils_deb\n",[77,258,260],{"class":79,"line":259},9,[77,261,262],{"class":240},"do\n",[77,264,266,269,272,275,277,279,281,283,285,287,289,292,294,297,299,302,305,307],{"class":79,"line":265},10,[77,267,268],{"class":83},"    curl",[77,270,271],{"class":91}," -L",[77,273,274],{"class":87}," https://github.com/rustdesk/rustdesk-server/releases/download/",[77,276,156],{"class":155},[77,278,105],{"class":104},[77,280,161],{"class":112},[77,282,164],{"class":104},[77,284,167],{"class":112},[77,286,164],{"class":104},[77,288,172],{"class":155},[77,290,291],{"class":87},"/",[77,293,156],{"class":155},[77,295,296],{"class":104},"deb",[77,298,172],{"class":155},[77,300,301],{"class":91}," -o",[77,303,304],{"class":155}," ${",[77,306,296],{"class":104},[77,308,309],{"class":155},"}\n",[77,311,313],{"class":79,"line":312},11,[77,314,315],{"class":240},"done\n",[77,317,319],{"class":79,"line":318},12,[77,320,141],{"emptyLinePlaceholder":140},[77,322,324,327,330,332,334],{"class":79,"line":323},13,[77,325,326],{"class":83},"dpkg",[77,328,329],{"class":91}," -i",[77,331,250],{"class":104},[77,333,253],{"class":104},[77,335,256],{"class":104},[77,337,339,342,344,346],{"class":79,"line":338},14,[77,340,341],{"class":83},"rm",[77,343,250],{"class":104},[77,345,253],{"class":104},[77,347,256],{"class":104},[10,349,350],{},"简单写了个脚本，仅适用 amd64，也没做异常处理，如果服务器在大陆境内需要自行解决 github 下载时可能出现的网络波动问题。",[10,352,353],{},"dpkg 安装结束后默认会启用两个 systemd 服务并开机自启，所以不需要使用 systemctl 手动启用。",[37,355,356],{"id":356},"替换密钥",[10,358,359],{},"将刚刚备份的一个公钥和一个私钥放在 Debian 服务器的相应路径，问题是这个路径在哪里呢？",[10,361,362,363,366],{},"通过翻看 rustdesk 的 service 文件，我们大概可以定位到是在 ",[25,364,365],{},"/var/lib/rustdesk-server/"," 路径下的",[10,368,369],{},[370,371],"img",{"alt":372,"src":373},"service 问价你","https://static.031130.xyz/uploads/2024/09/20/59d08477f8a0b.webp",[10,375,376],{},"直接对两个密钥文件进行替换，重启 rustdesk 相关的两个 service 服务即可。",[10,378,379],{},[370,380],{"alt":381,"src":382},"密钥文件","https://static.031130.xyz/uploads/2024/09/20/527c5b1151a57.webp",[37,384,385],{"id":385},"开放服务器防火墙",[10,387,388],{},"需要开放如下端口，记得 Linux 的防火墙和云服务供应商面板（如果有的话）上都要开放",[390,391,392,401],"ul",{},[393,394,395,396,400],"li",{},"TCP(",[397,398,399],"strong",{},"21115, 21116, 21117, 21118, 21119",")",[393,402,403,404,400],{},"UDP(",[397,405,406],{},"21116",[37,408,409],{"id":409},"客户端设置",[10,411,412],{},"id_ed25519.pub 对应客户端中需要输入的 Key，大概长成下面这个样子",[56,414,417],{"className":415,"code":416,"language":61},[59],"rdtxujYccRLXwXOu2KR3V9cGgP51lEdSmE0HJHGNkn4=\n",[25,418,416],{"__ignoreMap":64},[10,420,421],{},[370,422],{"alt":64,"src":423},"https://static.031130.xyz/uploads/2024/09/20/cc715265b8b37.webp",[10,425,426],{},"ID 服务器直接输入中继服务器的 ip 或者解析到对应 ip 的域名即可，另外两个地址可以不填，RustDesk会自动推导（如果没有特别设定）",[37,428,429],{"id":429},"成果展示",[10,431,432],{},[370,433],{"alt":429,"src":434},"https://static.031130.xyz/uploads/2024/09/20/3108bac773390.webp",[37,436,437],{"id":437},"参见",[390,439,440,447,454],{},[393,441,442],{},[17,443,446],{"href":444,"rel":445},"https://rustdesk.com/docs/en/self-host/rustdesk-server-oss/install/",[21],"Installation :: Documentation for RustDesk",[393,448,449],{},[17,450,453],{"href":451,"rel":452},"https://catcat.blog/rustdesk-debian-%E8%87%AA%E5%BB%BA%E4%B8%AD%E7%BB%A7%E6%9C%8D%E5%8A%A1%E5%99%A8.html",[21],"RustDesk Debian 自建中继服务器",[393,455,456],{},[17,457,22],{"href":19,"rel":458},[21],[460,461,462],"style",{},"html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html pre.shiki code .sJa8x, html code.shiki .sJa8x{--shiki-default:#E45649;--shiki-dark:#E06C75}html pre.shiki code .sknuh, html code.shiki .sknuh{--shiki-default:#383A42;--shiki-dark:#56B6C2}html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html pre.shiki code .sr1Ac, html code.shiki .sr1Ac{--shiki-default:#E45649;--shiki-dark:#ABB2BF}html pre.shiki code .sLKXg, html code.shiki .sLKXg{--shiki-default:#A626A4;--shiki-dark:#C678DD}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}",{"title":64,"searchDepth":101,"depth":101,"links":464},[465,466,467,468,469,470,471],{"id":39,"depth":101,"text":40},{"id":67,"depth":101,"text":68},{"id":356,"depth":101,"text":356},{"id":385,"depth":101,"text":385},{"id":409,"depth":101,"text":409},{"id":429,"depth":101,"text":429},{"id":437,"depth":101,"text":437},"2024-09-20 03:20:38","md",{},"/2024/09/20/migrate-rustdesk-server-from-arch-to-debian","---\ntitle: 将 Rustdesk 中继服务从 Arch Linux 迁移至 Debian\ndate: 2024-09-20 03:20:38\nsticky:\ntags:\n- Rustdesk\n- Archlinux\n- Debian\n- Linux\n---\n\n这次迁移主要是两方面原因，一来是我安装了 Arch Linux 的 VPS 要过期了，续费价格过高，没有续费的动力；二来是手上的 VPS 越来越多，逐渐意识到 Arch Linux 作为滚动发行版，每次安装新的软件都要 Syu 甚至重启系统，实在没有太多的精力去维护，这也是为什么 Arch Linux 仅适合桌面发行版。\n\n原本在 Arch Linux 上部署的 rustdesk server 我是按照这篇文章「[(水文)在archlinux上部署rustdesk服务端](https://www.liyp.cc/archives/1698241638248)」部署的。本身没什么技巧，直接从 AUR 安装现成的 rustdesk-server-bin，使用 systemctl 启用 `rustdesk-server-hbbr.service` 和 `rustdesk-server-hbbs.service` 两个服务即可。\n\nRustdesk 现在为 Debian 提供了官方的中继服务器的 deb 包，而谷歌搜了一圈都是下载 zip 包使用 pm2 管理进程，故写下此文。\n\n## 备份原服务器的 rustdesk 密钥\n\nAUR 上的安装方案将密钥放在 `/opt/rustdesk-server/data` 直接用 sftp 获取 `id_ed25519` 和 `id_ed25519.pub` 两个文件就行。如果是新部署的没有这两个文件也没事，rustdesk 服务在启动时可以自动创建，只不过需要在客户端重新输入公钥。\n\n```\nsftp> get /opt/rustdesk-server/data/id_ed25519\nsftp> get /opt/rustdesk-server/data/id_ed25519.pub\n```\n\n## 在新服务器上下载 deb 包，进行安装\n\n```bash\napt install -y curl jq\nversion=$(curl -s https://api.github.com/repos/rustdesk/rustdesk-server/releases/latest | jq .tag_name)\n\nhbbr_deb=rustdesk-server-hbbr_${version:1:-1}_amd64.deb\nhbbs_deb=rustdesk-server-hbbs_${version:1:-1}_amd64.deb\nutils_deb=rustdesk-server-utils_${version:1:-1}_amd64.deb\n\nfor deb in $hbbr_deb $hbbs_deb $utils_deb\ndo\n    curl -L https://github.com/rustdesk/rustdesk-server/releases/download/${version:1:-1}/${deb} -o ${deb}\ndone\n\ndpkg -i $hbbr_deb $hbbs_deb $utils_deb\nrm $hbbr_deb $hbbs_deb $utils_deb\n```\n\n简单写了个脚本，仅适用 amd64，也没做异常处理，如果服务器在大陆境内需要自行解决 github 下载时可能出现的网络波动问题。\n\ndpkg 安装结束后默认会启用两个 systemd 服务并开机自启，所以不需要使用 systemctl 手动启用。\n\n## 替换密钥\n\n将刚刚备份的一个公钥和一个私钥放在 Debian 服务器的相应路径，问题是这个路径在哪里呢？\n\n通过翻看 rustdesk 的 service 文件，我们大概可以定位到是在 `/var/lib/rustdesk-server/` 路径下的\n\n![service 问价你](https://static.031130.xyz/uploads/2024/09/20/59d08477f8a0b.webp)\n\n直接对两个密钥文件进行替换，重启 rustdesk 相关的两个 service 服务即可。\n\n![密钥文件](https://static.031130.xyz/uploads/2024/09/20/527c5b1151a57.webp)\n\n## 开放服务器防火墙\n\n需要开放如下端口，记得 Linux 的防火墙和云服务供应商面板（如果有的话）上都要开放\n\n- TCP(**21115, 21116, 21117, 21118, 21119**)\n- UDP(**21116**)\n\n## 客户端设置\n\nid_ed25519.pub 对应客户端中需要输入的 Key，大概长成下面这个样子\n\n```\nrdtxujYccRLXwXOu2KR3V9cGgP51lEdSmE0HJHGNkn4=\n```\n\n![](https://static.031130.xyz/uploads/2024/09/20/cc715265b8b37.webp)\n\nID 服务器直接输入中继服务器的 ip 或者解析到对应 ip 的域名即可，另外两个地址可以不填，RustDesk会自动推导（如果没有特别设定）\n\n## 成果展示\n\n![成果展示](https://static.031130.xyz/uploads/2024/09/20/3108bac773390.webp)\n\n## 参见\n\n- [Installation :: Documentation for RustDesk](https://rustdesk.com/docs/en/self-host/rustdesk-server-oss/install/)\n- [RustDesk Debian 自建中继服务器](https://catcat.blog/rustdesk-debian-自建中继服务器.html)\n- [(水文)在archlinux上部署rustdesk服务端](https://www.liyp.cc/archives/1698241638248)\n",{"title":5,"description":12},"posts/migrate-rustdesk-server-from-arch-to-debian",false,[481,482,483,484],"Rustdesk","Archlinux","Debian","Linux","ldsf4TRLzHc6ha0Ymow_GIwyOVj5h-dHeatpEHt3iU4",[487,492],{"title":488,"path":489,"stem":490,"date":491,"children":-1},"使用 Caddy 反向代理 dockerhub 需要几步？","/2024/09/21/how-to-reverse-proxy-dockerhub-with-caddy","posts/how-to-reverse-proxy-dockerhub-with-caddy","2024-09-21 01:29:17",{"title":493,"path":494,"stem":495,"date":496,"children":-1},"自建图床小记五——费用","/2024/08/21/self-host-cdn-expense","posts/self-host-cdn-expense","2024-08-21 00:05:15",1761884676505]
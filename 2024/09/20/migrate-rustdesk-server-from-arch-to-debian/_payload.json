[{"data":1,"prerenderedAt":456},["ShallowReactive",2],{"post-2024-09-20-migrate-rustdesk-server-from-arch-to-debian":3,"surround-2024-09-20-migrate-rustdesk-server-from-arch-to-debian":444,"randomIndex/2024/09/20/migrate-rustdesk-server-from-arch-to-debian":455},{"id":4,"title":5,"body":6,"date":430,"description":12,"extension":431,"meta":432,"navigation":139,"path":433,"rawbody":434,"seo":435,"stem":436,"sticky":437,"tags":438,"__hash__":443},"posts/posts/migrate-rustdesk-server-from-arch-to-debian.md","将 Rustdesk 中继服务从 Arch Linux 迁移至 Debian",{"type":7,"value":8,"toc":421},"minimark",[9,13,33,36,41,55,65,69,306,309,312,315,318,325,332,335,341,344,347,365,368,371,377,382,385,388,393,396,417],[10,11,12],"p",{},"这次迁移主要是两方面原因，一来是我安装了 Arch Linux 的 VPS 要过期了，续费价格过高，没有续费的动力；二来是手上的 VPS 越来越多，逐渐意识到 Arch Linux 作为滚动发行版，每次安装新的软件都要 Syu 甚至重启系统，实在没有太多的精力去维护，这也是为什么 Arch Linux 仅适合桌面发行版。",[10,14,15,16,23,24,28,29,32],{},"原本在 Arch Linux 上部署的 rustdesk server 我是按照这篇文章「",[17,18,22],"a",{"href":19,"rel":20},"https://www.liyp.cc/archives/1698241638248",[21],"nofollow","(水文)在archlinux上部署rustdesk服务端","」部署的。本身没什么技巧，直接从 AUR 安装现成的 rustdesk-server-bin，使用 systemctl 启用 ",[25,26,27],"code",{},"rustdesk-server-hbbr.service"," 和 ",[25,30,31],{},"rustdesk-server-hbbs.service"," 两个服务即可。",[10,34,35],{},"Rustdesk 现在为 Debian 提供了官方的中继服务器的 deb 包，而谷歌搜了一圈都是下载 zip 包使用 pm2 管理进程，故写下此文。",[37,38,40],"h2",{"id":39},"备份原服务器的-rustdesk-密钥","备份原服务器的 rustdesk 密钥",[10,42,43,44,47,48,28,51,54],{},"AUR 上的安装方案将密钥放在 ",[25,45,46],{},"/opt/rustdesk-server/data"," 直接用 sftp 获取 ",[25,49,50],{},"id_ed25519",[25,52,53],{},"id_ed25519.pub"," 两个文件就行。如果是新部署的没有这两个文件也没事，rustdesk 服务在启动时可以自动创建，只不过需要在客户端重新输入公钥。",[56,57,62],"pre",{"className":58,"code":60,"language":61},[59],"language-text","sftp> get /opt/rustdesk-server/data/id_ed25519\nsftp> get /opt/rustdesk-server/data/id_ed25519.pub\n","text",[25,63,60],{"__ignoreMap":64},"",[37,66,68],{"id":67},"在新服务器上下载-deb-包进行安装","在新服务器上下载 deb 包，进行安装",[56,70,74],{"className":71,"code":72,"language":73,"meta":64,"style":64},"language-bash shiki shiki-themes github-light github-dark","apt install -y curl jq\nversion=$(curl -s https://api.github.com/repos/rustdesk/rustdesk-server/releases/latest | jq .tag_name)\n\nhbbr_deb=rustdesk-server-hbbr_${version:1:-1}_amd64.deb\nhbbs_deb=rustdesk-server-hbbs_${version:1:-1}_amd64.deb\nutils_deb=rustdesk-server-utils_${version:1:-1}_amd64.deb\n\nfor deb in $hbbr_deb $hbbs_deb $utils_deb\ndo\n    curl -L https://github.com/rustdesk/rustdesk-server/releases/download/${version:1:-1}/${deb} -o ${deb}\ndone\n\ndpkg -i $hbbr_deb $hbbs_deb $utils_deb\nrm $hbbr_deb $hbbs_deb $utils_deb\n","bash",[25,75,76,99,134,141,170,193,216,221,236,242,276,282,287,298],{"__ignoreMap":64},[77,78,81,85,89,93,96],"span",{"class":79,"line":80},"line",1,[77,82,84],{"class":83},"sScJk","apt",[77,86,88],{"class":87},"sZZnC"," install",[77,90,92],{"class":91},"sj4cs"," -y",[77,94,95],{"class":87}," curl",[77,97,98],{"class":87}," jq\n",[77,100,102,106,110,113,116,119,122,125,128,131],{"class":79,"line":101},2,[77,103,105],{"class":104},"sVt8B","version",[77,107,109],{"class":108},"szBVR","=",[77,111,112],{"class":104},"$(",[77,114,115],{"class":83},"curl",[77,117,118],{"class":91}," -s",[77,120,121],{"class":87}," https://api.github.com/repos/rustdesk/rustdesk-server/releases/latest",[77,123,124],{"class":108}," |",[77,126,127],{"class":83}," jq",[77,129,130],{"class":87}," .tag_name",[77,132,133],{"class":104},")\n",[77,135,137],{"class":79,"line":136},3,[77,138,140],{"emptyLinePlaceholder":139},true,"\n",[77,142,144,147,149,152,155,158,161,164,167],{"class":79,"line":143},4,[77,145,146],{"class":104},"hbbr_deb",[77,148,109],{"class":108},[77,150,151],{"class":87},"rustdesk-server-hbbr_",[77,153,154],{"class":104},"${version",[77,156,157],{"class":108},":",[77,159,160],{"class":104},"1",[77,162,163],{"class":108},":-",[77,165,166],{"class":104},"1}",[77,168,169],{"class":87},"_amd64.deb\n",[77,171,173,176,178,181,183,185,187,189,191],{"class":79,"line":172},5,[77,174,175],{"class":104},"hbbs_deb",[77,177,109],{"class":108},[77,179,180],{"class":87},"rustdesk-server-hbbs_",[77,182,154],{"class":104},[77,184,157],{"class":108},[77,186,160],{"class":104},[77,188,163],{"class":108},[77,190,166],{"class":104},[77,192,169],{"class":87},[77,194,196,199,201,204,206,208,210,212,214],{"class":79,"line":195},6,[77,197,198],{"class":104},"utils_deb",[77,200,109],{"class":108},[77,202,203],{"class":87},"rustdesk-server-utils_",[77,205,154],{"class":104},[77,207,157],{"class":108},[77,209,160],{"class":104},[77,211,163],{"class":108},[77,213,166],{"class":104},[77,215,169],{"class":87},[77,217,219],{"class":79,"line":218},7,[77,220,140],{"emptyLinePlaceholder":139},[77,222,224,227,230,233],{"class":79,"line":223},8,[77,225,226],{"class":108},"for",[77,228,229],{"class":104}," deb ",[77,231,232],{"class":108},"in",[77,234,235],{"class":104}," $hbbr_deb $hbbs_deb $utils_deb\n",[77,237,239],{"class":79,"line":238},9,[77,240,241],{"class":108},"do\n",[77,243,245,248,251,254,256,258,260,262,264,267,270,273],{"class":79,"line":244},10,[77,246,247],{"class":83},"    curl",[77,249,250],{"class":91}," -L",[77,252,253],{"class":87}," https://github.com/rustdesk/rustdesk-server/releases/download/",[77,255,154],{"class":104},[77,257,157],{"class":108},[77,259,160],{"class":104},[77,261,163],{"class":108},[77,263,166],{"class":104},[77,265,266],{"class":87},"/",[77,268,269],{"class":104},"${deb} ",[77,271,272],{"class":91},"-o",[77,274,275],{"class":104}," ${deb}\n",[77,277,279],{"class":79,"line":278},11,[77,280,281],{"class":108},"done\n",[77,283,285],{"class":79,"line":284},12,[77,286,140],{"emptyLinePlaceholder":139},[77,288,290,293,296],{"class":79,"line":289},13,[77,291,292],{"class":83},"dpkg",[77,294,295],{"class":91}," -i",[77,297,235],{"class":104},[77,299,301,304],{"class":79,"line":300},14,[77,302,303],{"class":83},"rm",[77,305,235],{"class":104},[10,307,308],{},"简单写了个脚本，仅适用 amd64，也没做异常处理，如果服务器在大陆境内需要自行解决 github 下载时可能出现的网络波动问题。",[10,310,311],{},"dpkg 安装结束后默认会启用两个 systemd 服务并开机自启，所以不需要使用 systemctl 手动启用。",[37,313,314],{"id":314},"替换密钥",[10,316,317],{},"将刚刚备份的一个公钥和一个私钥放在 Debian 服务器的相应路径，问题是这个路径在哪里呢？",[10,319,320,321,324],{},"通过翻看 rustdesk 的 service 文件，我们大概可以定位到是在 ",[25,322,323],{},"/var/lib/rustdesk-server/"," 路径下的",[10,326,327],{},[328,329],"img",{"alt":330,"src":331},"service 问价你","https://static.031130.xyz/uploads/2024/09/20/59d08477f8a0b.webp",[10,333,334],{},"直接对两个密钥文件进行替换，重启 rustdesk 相关的两个 service 服务即可。",[10,336,337],{},[328,338],{"alt":339,"src":340},"密钥文件","https://static.031130.xyz/uploads/2024/09/20/527c5b1151a57.webp",[37,342,343],{"id":343},"开放服务器防火墙",[10,345,346],{},"需要开放如下端口，记得 Linux 的防火墙和云服务供应商面板（如果有的话）上都要开放",[348,349,350,359],"ul",{},[351,352,353,354,358],"li",{},"TCP(",[355,356,357],"strong",{},"21115, 21116, 21117, 21118, 21119",")",[351,360,361,362,358],{},"UDP(",[355,363,364],{},"21116",[37,366,367],{"id":367},"客户端设置",[10,369,370],{},"id_ed25519.pub 对应客户端中需要输入的 Key，大概长成下面这个样子",[56,372,375],{"className":373,"code":374,"language":61},[59],"rdtxujYccRLXwXOu2KR3V9cGgP51lEdSmE0HJHGNkn4=\n",[25,376,374],{"__ignoreMap":64},[10,378,379],{},[328,380],{"alt":64,"src":381},"https://static.031130.xyz/uploads/2024/09/20/cc715265b8b37.webp",[10,383,384],{},"ID 服务器直接输入中继服务器的 ip 或者解析到对应 ip 的域名即可，另外两个地址可以不填，RustDesk会自动推导（如果没有特别设定）",[37,386,387],{"id":387},"成果展示",[10,389,390],{},[328,391],{"alt":387,"src":392},"https://static.031130.xyz/uploads/2024/09/20/3108bac773390.webp",[37,394,395],{"id":395},"参见",[348,397,398,405,412],{},[351,399,400],{},[17,401,404],{"href":402,"rel":403},"https://rustdesk.com/docs/en/self-host/rustdesk-server-oss/install/",[21],"Installation :: Documentation for RustDesk",[351,406,407],{},[17,408,411],{"href":409,"rel":410},"https://catcat.blog/rustdesk-debian-%E8%87%AA%E5%BB%BA%E4%B8%AD%E7%BB%A7%E6%9C%8D%E5%8A%A1%E5%99%A8.html",[21],"RustDesk Debian 自建中继服务器",[351,413,414],{},[17,415,22],{"href":19,"rel":416},[21],[418,419,420],"style",{},"html pre.shiki code .sScJk, html code.shiki .sScJk{--shiki-default:#6F42C1;--shiki-dark:#B392F0}html pre.shiki code .sZZnC, html code.shiki .sZZnC{--shiki-default:#032F62;--shiki-dark:#9ECBFF}html pre.shiki code .sj4cs, html code.shiki .sj4cs{--shiki-default:#005CC5;--shiki-dark:#79B8FF}html pre.shiki code .sVt8B, html code.shiki .sVt8B{--shiki-default:#24292E;--shiki-dark:#E1E4E8}html pre.shiki code .szBVR, html code.shiki .szBVR{--shiki-default:#D73A49;--shiki-dark:#F97583}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}",{"title":64,"searchDepth":101,"depth":101,"links":422},[423,424,425,426,427,428,429],{"id":39,"depth":101,"text":40},{"id":67,"depth":101,"text":68},{"id":314,"depth":101,"text":314},{"id":343,"depth":101,"text":343},{"id":367,"depth":101,"text":367},{"id":387,"depth":101,"text":387},{"id":395,"depth":101,"text":395},"2024-09-20 03:20:38","md",{},"/2024/09/20/migrate-rustdesk-server-from-arch-to-debian","---\ntitle: 将 Rustdesk 中继服务从 Arch Linux 迁移至 Debian\ndate: 2024-09-20 03:20:38\nsticky:\ntags:\n- Rustdesk\n- Archlinux\n- Debian\n- Linux\n---\n\n这次迁移主要是两方面原因，一来是我安装了 Arch Linux 的 VPS 要过期了，续费价格过高，没有续费的动力；二来是手上的 VPS 越来越多，逐渐意识到 Arch Linux 作为滚动发行版，每次安装新的软件都要 Syu 甚至重启系统，实在没有太多的精力去维护，这也是为什么 Arch Linux 仅适合桌面发行版。\n\n原本在 Arch Linux 上部署的 rustdesk server 我是按照这篇文章「[(水文)在archlinux上部署rustdesk服务端](https://www.liyp.cc/archives/1698241638248)」部署的。本身没什么技巧，直接从 AUR 安装现成的 rustdesk-server-bin，使用 systemctl 启用 `rustdesk-server-hbbr.service` 和 `rustdesk-server-hbbs.service` 两个服务即可。\n\nRustdesk 现在为 Debian 提供了官方的中继服务器的 deb 包，而谷歌搜了一圈都是下载 zip 包使用 pm2 管理进程，故写下此文。\n\n## 备份原服务器的 rustdesk 密钥\n\nAUR 上的安装方案将密钥放在 `/opt/rustdesk-server/data` 直接用 sftp 获取 `id_ed25519` 和 `id_ed25519.pub` 两个文件就行。如果是新部署的没有这两个文件也没事，rustdesk 服务在启动时可以自动创建，只不过需要在客户端重新输入公钥。\n\n```\nsftp> get /opt/rustdesk-server/data/id_ed25519\nsftp> get /opt/rustdesk-server/data/id_ed25519.pub\n```\n\n## 在新服务器上下载 deb 包，进行安装\n\n```bash\napt install -y curl jq\nversion=$(curl -s https://api.github.com/repos/rustdesk/rustdesk-server/releases/latest | jq .tag_name)\n\nhbbr_deb=rustdesk-server-hbbr_${version:1:-1}_amd64.deb\nhbbs_deb=rustdesk-server-hbbs_${version:1:-1}_amd64.deb\nutils_deb=rustdesk-server-utils_${version:1:-1}_amd64.deb\n\nfor deb in $hbbr_deb $hbbs_deb $utils_deb\ndo\n    curl -L https://github.com/rustdesk/rustdesk-server/releases/download/${version:1:-1}/${deb} -o ${deb}\ndone\n\ndpkg -i $hbbr_deb $hbbs_deb $utils_deb\nrm $hbbr_deb $hbbs_deb $utils_deb\n```\n\n简单写了个脚本，仅适用 amd64，也没做异常处理，如果服务器在大陆境内需要自行解决 github 下载时可能出现的网络波动问题。\n\ndpkg 安装结束后默认会启用两个 systemd 服务并开机自启，所以不需要使用 systemctl 手动启用。\n\n## 替换密钥\n\n将刚刚备份的一个公钥和一个私钥放在 Debian 服务器的相应路径，问题是这个路径在哪里呢？\n\n通过翻看 rustdesk 的 service 文件，我们大概可以定位到是在 `/var/lib/rustdesk-server/` 路径下的\n\n![service 问价你](https://static.031130.xyz/uploads/2024/09/20/59d08477f8a0b.webp)\n\n直接对两个密钥文件进行替换，重启 rustdesk 相关的两个 service 服务即可。\n\n![密钥文件](https://static.031130.xyz/uploads/2024/09/20/527c5b1151a57.webp)\n\n## 开放服务器防火墙\n\n需要开放如下端口，记得 Linux 的防火墙和云服务供应商面板（如果有的话）上都要开放\n\n- TCP(**21115, 21116, 21117, 21118, 21119**)\n- UDP(**21116**)\n\n## 客户端设置\n\nid_ed25519.pub 对应客户端中需要输入的 Key，大概长成下面这个样子\n\n```\nrdtxujYccRLXwXOu2KR3V9cGgP51lEdSmE0HJHGNkn4=\n```\n\n![](https://static.031130.xyz/uploads/2024/09/20/cc715265b8b37.webp)\n\nID 服务器直接输入中继服务器的 ip 或者解析到对应 ip 的域名即可，另外两个地址可以不填，RustDesk会自动推导（如果没有特别设定）\n\n## 成果展示\n\n![成果展示](https://static.031130.xyz/uploads/2024/09/20/3108bac773390.webp)\n\n## 参见\n\n- [Installation :: Documentation for RustDesk](https://rustdesk.com/docs/en/self-host/rustdesk-server-oss/install/)\n- [RustDesk Debian 自建中继服务器](https://catcat.blog/rustdesk-debian-自建中继服务器.html)\n- [(水文)在archlinux上部署rustdesk服务端](https://www.liyp.cc/archives/1698241638248)\n",{"title":5,"description":12},"posts/migrate-rustdesk-server-from-arch-to-debian",false,[439,440,441,442],"Rustdesk","Archlinux","Debian","Linux","JRP2Nr3TeJxe91Z_KkFEFT5mfiCLtl6JFNTkQh6wGzU",[445,450],{"title":446,"path":447,"stem":448,"date":449,"children":-1},"使用 Caddy 反向代理 dockerhub 需要几步？","/2024/09/21/how-to-reverse-proxy-dockerhub-with-caddy","posts/how-to-reverse-proxy-dockerhub-with-caddy","2024-09-21 01:29:17",{"title":451,"path":452,"stem":453,"date":454,"children":-1},"自建图床小记五——费用","/2024/08/21/self-host-cdn-expense","posts/self-host-cdn-expense","2024-08-21 00:05:15",27,1761696886163]
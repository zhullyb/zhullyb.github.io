[{"data":1,"prerenderedAt":519},["ShallowReactive",2],{"post-2024-09-25-random-banner-backgroud-image-implement-for-hexo-fluid-with-javascript":3,"surround-2024-09-25-random-banner-backgroud-image-implement-for-hexo-fluid-with-javascript":508,"randomIndex/2024/09/25/random-banner-backgroud-image-implement-for-hexo-fluid-with-javascript/":356},{"id":4,"title":5,"body":6,"date":496,"description":113,"extension":497,"meta":498,"navigation":373,"path":499,"rawbody":500,"seo":501,"stem":502,"sticky":503,"tags":504,"__hash__":507},"posts/posts/random-banner-backgroud-image-implement-for-hexo-fluid-with-javascript.md","基于 JavaScript 的 Hexo Fluid 主题 banner 随机背景图实现",{"type":7,"value":8,"toc":483},"minimark",[9,14,26,33,38,46,52,55,58,61,65,68,72,75,78,94,100,104,107,166,169,178,454,457,465,468,479],[10,11,13],"h2",{"id":12},"为什么要换掉随机图片-api","为什么要换掉随机图片 API",[15,16,17,18,25],"p",{},"因为 API 太慢了。根据 ",[19,20,24],"a",{"href":21,"rel":22},"https://pagespeed.web.dev/",[23],"nofollow","PageSpeed"," 的测速，使用 API 的图片加载时间来到了整整 2.5s，这似乎有些不可忍受。",[15,27,28],{},[29,30],"img",{"alt":31,"src":32},"PageSpeed 测速","https://static.031130.xyz/uploads/2024/09/25/3ef1a17bca955.webp",[34,35,37],"h3",{"id":36},"vercel-冷启动问题","Vercel 冷启动问题",[15,39,40,41,45],{},"当初年少无知，为了实现 banner 随机背景图，选择了",[19,42,44],{"href":43},"/2021/05/21/create-a-random-picture-api-with-vercel/","使用 vercel 创建随机图片 API","。这带来了一些问题，首先 vercel 在站点一段时间没人访问以后会进入一种类似休眠的模式，下一次启动将会经历一个冷启动（cold start）的过程。我认为这对于一个图片背景的随机 API 而言是不可忍受的。",[15,47,48],{},[29,49],{"alt":50,"src":51},"冷启动","https://static.031130.xyz/uploads/2024/09/24/f8cb9fd7a963e.webp",[15,53,54],{},"观察图上就可以发现，第一次访问时花费了 1.9 秒，第二次只需要 0.5 秒，这是因为第一次是冷启动，需要花费更多时间。",[34,56,57],{"id":57},"多一次网络请求",[15,59,60],{},"抛开冷启动不谈，引入 API 就会导致一次额外的网络请求。访客的浏览器将会先请求随机图片 API，然后根据 API 返回的 302 相应去请求真正的图片，而且这一过程是没法并行的，只能串行执行，这会浪费更多的等待时间。",[34,62,64],{"id":63},"vercel-在大陆境内的访问质量","Vercel 在大陆境内的访问质量",[15,66,67],{},"Vercel 在大陆境内的访问质量其实并不算好，即使是使用了所谓的优选节点，也不一定能保证整个大陆境内大部分访客都有不错的访问质量，因此使用 Vercel 搭建 API 的行为并不是最优解。",[10,69,71],{"id":70},"转向-javascript-实现","转向 JavaScript 实现",[15,73,74],{},"这个方案本身没多少复杂的，只不过是三年前的我对前端一无所知不敢操刀罢了。",[34,76,77],{"id":77},"删除原有的背景图",[15,79,80,81,85,86,89,90,93],{},"在 ",[82,83,84],"code",{},"_config.fluid.yml"," 中，将所有的 ",[82,87,88],{},"banner_img:"," 字段全部置空，防止其加载默认的 ",[82,91,92],{},"/img/default.png"," 而白白浪费用户的流量。这个字段一共在配置文件中出现了九次。",[15,95,96],{},[29,97],{"alt":98,"src":99},"字段置空","https://static.031130.xyz/uploads/2024/09/25/70bd0b27f5aad.webp",[34,101,103],{"id":102},"添加-js","添加 js",[15,105,106],{},"我们的目标是修改 id 为 banner 的 div 块的 backgroud 的 css 属性，Hexo Fluid 默认的生成内容是这样的",[108,109,114],"pre",{"className":110,"code":111,"language":112,"meta":113,"style":113},"language-html shiki shiki-themes github-light github-dark","\u003Cdiv id=\"banner\" class=\"banner\" parallax=true style=\"background: url('/img/default.png') no-repeat center center; background-size: cover;\">\n","html","",[82,115,116],{"__ignoreMap":113},[117,118,121,125,129,133,136,140,143,145,147,150,152,155,158,160,163],"span",{"class":119,"line":120},"line",1,[117,122,124],{"class":123},"sVt8B","\u003C",[117,126,128],{"class":127},"s9eBZ","div",[117,130,132],{"class":131},"sScJk"," id",[117,134,135],{"class":123},"=",[117,137,139],{"class":138},"sZZnC","\"banner\"",[117,141,142],{"class":131}," class",[117,144,135],{"class":123},[117,146,139],{"class":138},[117,148,149],{"class":131}," parallax",[117,151,135],{"class":123},[117,153,154],{"class":138},"true",[117,156,157],{"class":131}," style",[117,159,135],{"class":123},[117,161,162],{"class":138},"\"background: url('/img/default.png') no-repeat center center; background-size: cover;\"",[117,164,165],{"class":123},">\n",[15,167,168],{},"我们可以通过 id 来定位这个元素，修改其 style.background 属性。",[15,170,171,172,177],{},"可以在任何地方引入下面的 js 代码，在这篇名为",[19,173,176],{"href":174,"rel":175},"https://www.zywvvd.com/notes/hexo/theme/fluid/fluid-add-umami/fluid-add-umami/",[23],"《Fluid -23- 添加 Umami 统计》"," 的文章里的方案是可供参考的。",[108,179,183],{"className":180,"code":181,"language":182,"meta":113,"style":113},"language-javascript shiki shiki-themes github-light github-dark","const imgs = [\n    \"https://example.com/1.jpg\",\n    \"https://example.com/2.jpg\",\n    \"https://example.com/3.jpg\",\n    \"https://example.com/4.jpg\",\n    \"https://example.com/5.jpg\",\n    \"https://example.com/6.jpg\",\n    \"https://example.com/7.jpg\",\n    \"https://example.com/8.jpg\",\n    \"https://example.com/9.jpg\",\n    \"https://example.com/10.jpg\",\n    \"https://example.com/11.jpg\",\n    \"https://example.com/12.jpg\",\n    \"https://example.com/13.jpg\",\n    \"https://example.com/14.jpg\",\n    \"https://example.com/15.jpg\",\n    \"https://example.com/16.jpg\",\n    \"https://example.com/17.jpg\",\n    \"https://example.com/18.jpg\",\n    \"https://example.com/19.jpg\",\n    \"https://example.com/20.jpg\",\n]\n\nconst luck_img = imgs[Math.floor(Math.random() * imgs.length)]\nconst banner = document.getElementById('banner')\nbanner.style.background = `url(${luck_img}) center center / cover no-repeat`\n","javascript",[82,184,185,201,210,218,226,234,242,250,258,266,274,282,290,298,306,314,322,330,338,346,354,362,368,375,412,437],{"__ignoreMap":113},[117,186,187,191,195,198],{"class":119,"line":120},[117,188,190],{"class":189},"szBVR","const",[117,192,194],{"class":193},"sj4cs"," imgs",[117,196,197],{"class":189}," =",[117,199,200],{"class":123}," [\n",[117,202,204,207],{"class":119,"line":203},2,[117,205,206],{"class":138},"    \"https://example.com/1.jpg\"",[117,208,209],{"class":123},",\n",[117,211,213,216],{"class":119,"line":212},3,[117,214,215],{"class":138},"    \"https://example.com/2.jpg\"",[117,217,209],{"class":123},[117,219,221,224],{"class":119,"line":220},4,[117,222,223],{"class":138},"    \"https://example.com/3.jpg\"",[117,225,209],{"class":123},[117,227,229,232],{"class":119,"line":228},5,[117,230,231],{"class":138},"    \"https://example.com/4.jpg\"",[117,233,209],{"class":123},[117,235,237,240],{"class":119,"line":236},6,[117,238,239],{"class":138},"    \"https://example.com/5.jpg\"",[117,241,209],{"class":123},[117,243,245,248],{"class":119,"line":244},7,[117,246,247],{"class":138},"    \"https://example.com/6.jpg\"",[117,249,209],{"class":123},[117,251,253,256],{"class":119,"line":252},8,[117,254,255],{"class":138},"    \"https://example.com/7.jpg\"",[117,257,209],{"class":123},[117,259,261,264],{"class":119,"line":260},9,[117,262,263],{"class":138},"    \"https://example.com/8.jpg\"",[117,265,209],{"class":123},[117,267,269,272],{"class":119,"line":268},10,[117,270,271],{"class":138},"    \"https://example.com/9.jpg\"",[117,273,209],{"class":123},[117,275,277,280],{"class":119,"line":276},11,[117,278,279],{"class":138},"    \"https://example.com/10.jpg\"",[117,281,209],{"class":123},[117,283,285,288],{"class":119,"line":284},12,[117,286,287],{"class":138},"    \"https://example.com/11.jpg\"",[117,289,209],{"class":123},[117,291,293,296],{"class":119,"line":292},13,[117,294,295],{"class":138},"    \"https://example.com/12.jpg\"",[117,297,209],{"class":123},[117,299,301,304],{"class":119,"line":300},14,[117,302,303],{"class":138},"    \"https://example.com/13.jpg\"",[117,305,209],{"class":123},[117,307,309,312],{"class":119,"line":308},15,[117,310,311],{"class":138},"    \"https://example.com/14.jpg\"",[117,313,209],{"class":123},[117,315,317,320],{"class":119,"line":316},16,[117,318,319],{"class":138},"    \"https://example.com/15.jpg\"",[117,321,209],{"class":123},[117,323,325,328],{"class":119,"line":324},17,[117,326,327],{"class":138},"    \"https://example.com/16.jpg\"",[117,329,209],{"class":123},[117,331,333,336],{"class":119,"line":332},18,[117,334,335],{"class":138},"    \"https://example.com/17.jpg\"",[117,337,209],{"class":123},[117,339,341,344],{"class":119,"line":340},19,[117,342,343],{"class":138},"    \"https://example.com/18.jpg\"",[117,345,209],{"class":123},[117,347,349,352],{"class":119,"line":348},20,[117,350,351],{"class":138},"    \"https://example.com/19.jpg\"",[117,353,209],{"class":123},[117,355,357,360],{"class":119,"line":356},21,[117,358,359],{"class":138},"    \"https://example.com/20.jpg\"",[117,361,209],{"class":123},[117,363,365],{"class":119,"line":364},22,[117,366,367],{"class":123},"]\n",[117,369,371],{"class":119,"line":370},23,[117,372,374],{"emptyLinePlaceholder":373},true,"\n",[117,376,378,380,383,385,388,391,394,397,400,403,406,409],{"class":119,"line":377},24,[117,379,190],{"class":189},[117,381,382],{"class":193}," luck_img",[117,384,197],{"class":189},[117,386,387],{"class":123}," imgs[Math.",[117,389,390],{"class":131},"floor",[117,392,393],{"class":123},"(Math.",[117,395,396],{"class":131},"random",[117,398,399],{"class":123},"() ",[117,401,402],{"class":189},"*",[117,404,405],{"class":123}," imgs.",[117,407,408],{"class":193},"length",[117,410,411],{"class":123},")]\n",[117,413,415,417,420,422,425,428,431,434],{"class":119,"line":414},25,[117,416,190],{"class":189},[117,418,419],{"class":193}," banner",[117,421,197],{"class":189},[117,423,424],{"class":123}," document.",[117,426,427],{"class":131},"getElementById",[117,429,430],{"class":123},"(",[117,432,433],{"class":138},"'banner'",[117,435,436],{"class":123},")\n",[117,438,440,443,445,448,451],{"class":119,"line":439},26,[117,441,442],{"class":123},"banner.style.background ",[117,444,135],{"class":189},[117,446,447],{"class":138}," `url(${",[117,449,450],{"class":123},"luck_img",[117,452,453],{"class":138},"}) center center / cover no-repeat`\n",[10,455,456],{"id":456},"成果",[15,458,459,460,464],{},"博客能够在不引入外部 api 的情况下通过 js 自主实现随机的 banner 背景图，",[461,462,463],"del",{},"但 pagespeed 的测速结果并没有明显好转","，因为 pagespeed 模拟了低速 4G 的访问速度，无论如何都无法提升大文件的加载速度。不过避免了多一次网络请求后，打开页面时的加载速度确实有提升。",[10,466,467],{"id":467},"参见",[469,470,471],"ul",{},[472,473,474],"li",{},[19,475,478],{"href":476,"rel":477},"https://vercel.com/guides/how-can-i-improve-serverless-function-lambda-cold-start-performance-on-vercel",[23],"How can I improve function cold start performance on Vercel?",[480,481,482],"style",{},"html pre.shiki code .sVt8B, html code.shiki .sVt8B{--shiki-default:#24292E;--shiki-dark:#E1E4E8}html pre.shiki code .s9eBZ, html code.shiki .s9eBZ{--shiki-default:#22863A;--shiki-dark:#85E89D}html pre.shiki code .sScJk, html code.shiki .sScJk{--shiki-default:#6F42C1;--shiki-dark:#B392F0}html pre.shiki code .sZZnC, html code.shiki .sZZnC{--shiki-default:#032F62;--shiki-dark:#9ECBFF}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html pre.shiki code .szBVR, html code.shiki .szBVR{--shiki-default:#D73A49;--shiki-dark:#F97583}html pre.shiki code .sj4cs, html code.shiki .sj4cs{--shiki-default:#005CC5;--shiki-dark:#79B8FF}",{"title":113,"searchDepth":203,"depth":203,"links":484},[485,490,494,495],{"id":12,"depth":203,"text":13,"children":486},[487,488,489],{"id":36,"depth":212,"text":37},{"id":57,"depth":212,"text":57},{"id":63,"depth":212,"text":64},{"id":70,"depth":203,"text":71,"children":491},[492,493],{"id":77,"depth":212,"text":77},{"id":102,"depth":212,"text":103},{"id":456,"depth":203,"text":456},{"id":467,"depth":203,"text":467},"2024-09-25 00:00:42","md",{},"/2024/09/25/random-banner-backgroud-image-implement-for-hexo-fluid-with-javascript","---\ntitle: 基于 JavaScript 的 Hexo Fluid 主题 banner 随机背景图实现\ndate: 2024-09-25 00:00:42\nsticky:\ntags:\n- JavaScript\n- Hexo\n---\n\n## 为什么要换掉随机图片 API\n\n因为 API 太慢了。根据 [PageSpeed](https://pagespeed.web.dev/) 的测速，使用 API 的图片加载时间来到了整整 2.5s，这似乎有些不可忍受。\n\n![PageSpeed 测速](https://static.031130.xyz/uploads/2024/09/25/3ef1a17bca955.webp)\n\n### Vercel 冷启动问题\n\n当初年少无知，为了实现 banner 随机背景图，选择了[使用 vercel 创建随机图片 API](/2021/05/21/create-a-random-picture-api-with-vercel/)。这带来了一些问题，首先 vercel 在站点一段时间没人访问以后会进入一种类似休眠的模式，下一次启动将会经历一个冷启动（cold start）的过程。我认为这对于一个图片背景的随机 API 而言是不可忍受的。\n\n![冷启动](https://static.031130.xyz/uploads/2024/09/24/f8cb9fd7a963e.webp)\n\n观察图上就可以发现，第一次访问时花费了 1.9 秒，第二次只需要 0.5 秒，这是因为第一次是冷启动，需要花费更多时间。\n\n### 多一次网络请求\n\n抛开冷启动不谈，引入 API 就会导致一次额外的网络请求。访客的浏览器将会先请求随机图片 API，然后根据 API 返回的 302 相应去请求真正的图片，而且这一过程是没法并行的，只能串行执行，这会浪费更多的等待时间。\n\n### Vercel 在大陆境内的访问质量\n\nVercel 在大陆境内的访问质量其实并不算好，即使是使用了所谓的优选节点，也不一定能保证整个大陆境内大部分访客都有不错的访问质量，因此使用 Vercel 搭建 API 的行为并不是最优解。\n\n## 转向 JavaScript 实现\n\n这个方案本身没多少复杂的，只不过是三年前的我对前端一无所知不敢操刀罢了。\n\n### 删除原有的背景图\n\n在 `_config.fluid.yml` 中，将所有的 `banner_img:` 字段全部置空，防止其加载默认的 `/img/default.png` 而白白浪费用户的流量。这个字段一共在配置文件中出现了九次。\n\n![字段置空](https://static.031130.xyz/uploads/2024/09/25/70bd0b27f5aad.webp)\n\n### 添加 js\n\n我们的目标是修改 id 为 banner 的 div 块的 backgroud 的 css 属性，Hexo Fluid 默认的生成内容是这样的\n\n```html\n\u003Cdiv id=\"banner\" class=\"banner\" parallax=true style=\"background: url('/img/default.png') no-repeat center center; background-size: cover;\">\n```\n\n我们可以通过 id 来定位这个元素，修改其 style.background 属性。\n\n可以在任何地方引入下面的 js 代码，在这篇名为[《Fluid -23- 添加 Umami 统计》](https://www.zywvvd.com/notes/hexo/theme/fluid/fluid-add-umami/fluid-add-umami/) 的文章里的方案是可供参考的。\n\n```javascript\nconst imgs = [\n    \"https://example.com/1.jpg\",\n    \"https://example.com/2.jpg\",\n    \"https://example.com/3.jpg\",\n    \"https://example.com/4.jpg\",\n    \"https://example.com/5.jpg\",\n    \"https://example.com/6.jpg\",\n    \"https://example.com/7.jpg\",\n    \"https://example.com/8.jpg\",\n    \"https://example.com/9.jpg\",\n    \"https://example.com/10.jpg\",\n    \"https://example.com/11.jpg\",\n    \"https://example.com/12.jpg\",\n    \"https://example.com/13.jpg\",\n    \"https://example.com/14.jpg\",\n    \"https://example.com/15.jpg\",\n    \"https://example.com/16.jpg\",\n    \"https://example.com/17.jpg\",\n    \"https://example.com/18.jpg\",\n    \"https://example.com/19.jpg\",\n    \"https://example.com/20.jpg\",\n]\n\nconst luck_img = imgs[Math.floor(Math.random() * imgs.length)]\nconst banner = document.getElementById('banner')\nbanner.style.background = `url(${luck_img}) center center / cover no-repeat`\n```\n\n## 成果\n\n博客能够在不引入外部 api 的情况下通过 js 自主实现随机的 banner 背景图，~~但 pagespeed 的测速结果并没有明显好转~~，因为 pagespeed 模拟了低速 4G 的访问速度，无论如何都无法提升大文件的加载速度。不过避免了多一次网络请求后，打开页面时的加载速度确实有提升。\n\n## 参见\n\n- [How can I improve function cold start performance on Vercel?](https://vercel.com/guides/how-can-i-improve-serverless-function-lambda-cold-start-performance-on-vercel)\n",{"title":5,"description":113},"posts/random-banner-backgroud-image-implement-for-hexo-fluid-with-javascript",false,[505,506],"JavaScript","Hexo","5gUl-28KNI_VrDNNekqOoh3UaAJYBD0xsY8-XA-d3Uk",[509,514],{"title":510,"path":511,"stem":512,"date":513,"children":-1},"使用 GPT 对 waline 的评论进行审查","/2024/10/12/use-gpt-to-review-waline-comments","posts/use-gpt-to-review-waline-comments","2024-10-12 16:11:06",{"title":515,"path":516,"stem":517,"date":518,"children":-1},"使用向日葵智能插座 C2 用电记录推算宿舍上次烧水时间","/2024/09/24/log-last-water-boiling-water-with-sunlogin-adapter-power-consumption","posts/log-last-water-boiling-water-with-sunlogin-adapter-power-consumption","2024-09-24 05:17:47",1761699274956]
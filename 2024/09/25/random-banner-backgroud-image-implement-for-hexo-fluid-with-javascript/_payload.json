[{"data":1,"prerenderedAt":555},["ShallowReactive",2],{"post-2024-09-25-random-banner-backgroud-image-implement-for-hexo-fluid-with-javascript-zh":3,"surround-2024-09-25-random-banner-backgroud-image-implement-for-hexo-fluid-with-javascript-zh":541,"randomIndex/2024/09/25/random-banner-backgroud-image-implement-for-hexo-fluid-with-javascript/":553,"language-switch-/2024/09/25/random-banner-backgroud-image-implement-for-hexo-fluid-with-javascript/-en":554},{"title":4,"date":5,"path":6,"tags":7,"body":10,"description":117},"基于 JavaScript 的 Hexo Fluid 主题 banner 随机背景图实现","2024-09-25 00:00:42","/2024/09/25/random-banner-backgroud-image-implement-for-hexo-fluid-with-javascript",[8,9],"JavaScript","Hexo",{"type":11,"value":12,"toc":528},"minimark",[13,18,30,37,42,50,56,59,62,65,69,72,76,79,82,98,104,108,111,176,179,188,500,503,511,514,525],[14,15,17],"h2",{"id":16},"为什么要换掉随机图片-api","为什么要换掉随机图片 API",[19,20,21,22,29],"p",{},"因为 API 太慢了。根据 ",[23,24,28],"a",{"href":25,"rel":26},"https://pagespeed.web.dev/",[27],"nofollow","PageSpeed"," 的测速，使用 API 的图片加载时间来到了整整 2.5s，这似乎有些不可忍受。",[19,31,32],{},[33,34],"img",{"alt":35,"src":36},"PageSpeed 测速","https://static.031130.xyz/uploads/2024/09/25/3ef1a17bca955.webp",[38,39,41],"h3",{"id":40},"vercel-冷启动问题","Vercel 冷启动问题",[19,43,44,45,49],{},"当初年少无知，为了实现 banner 随机背景图，选择了",[23,46,48],{"href":47},"/2021/05/21/create-a-random-picture-api-with-vercel/","使用 vercel 创建随机图片 API","。这带来了一些问题，首先 vercel 在站点一段时间没人访问以后会进入一种类似休眠的模式，下一次启动将会经历一个冷启动（cold start）的过程。我认为这对于一个图片背景的随机 API 而言是不可忍受的。",[19,51,52],{},[33,53],{"alt":54,"src":55},"冷启动","https://static.031130.xyz/uploads/2024/09/24/f8cb9fd7a963e.webp",[19,57,58],{},"观察图上就可以发现，第一次访问时花费了 1.9 秒，第二次只需要 0.5 秒，这是因为第一次是冷启动，需要花费更多时间。",[38,60,61],{"id":61},"多一次网络请求",[19,63,64],{},"抛开冷启动不谈，引入 API 就会导致一次额外的网络请求。访客的浏览器将会先请求随机图片 API，然后根据 API 返回的 302 相应去请求真正的图片，而且这一过程是没法并行的，只能串行执行，这会浪费更多的等待时间。",[38,66,68],{"id":67},"vercel-在大陆境内的访问质量","Vercel 在大陆境内的访问质量",[19,70,71],{},"Vercel 在大陆境内的访问质量其实并不算好，即使是使用了所谓的优选节点，也不一定能保证整个大陆境内大部分访客都有不错的访问质量，因此使用 Vercel 搭建 API 的行为并不是最优解。",[14,73,75],{"id":74},"转向-javascript-实现","转向 JavaScript 实现",[19,77,78],{},"这个方案本身没多少复杂的，只不过是三年前的我对前端一无所知不敢操刀罢了。",[38,80,81],{"id":81},"删除原有的背景图",[19,83,84,85,89,90,93,94,97],{},"在 ",[86,87,88],"code",{},"_config.fluid.yml"," 中，将所有的 ",[86,91,92],{},"banner_img:"," 字段全部置空，防止其加载默认的 ",[86,95,96],{},"/img/default.png"," 而白白浪费用户的流量。这个字段一共在配置文件中出现了九次。",[19,99,100],{},[33,101],{"alt":102,"src":103},"字段置空","https://static.031130.xyz/uploads/2024/09/25/70bd0b27f5aad.webp",[38,105,107],{"id":106},"添加-js","添加 js",[19,109,110],{},"我们的目标是修改 id 为 banner 的 div 块的 backgroud 的 css 属性，Hexo Fluid 默认的生成内容是这样的",[112,113,118],"pre",{"className":114,"code":115,"language":116,"meta":117,"style":117},"language-html shiki shiki-themes one-light one-dark-pro","\u003Cdiv id=\"banner\" class=\"banner\" parallax=true style=\"background: url('/img/default.png') no-repeat center center; background-size: cover;\">\n","html","",[86,119,120],{"__ignoreMap":117},[121,122,125,129,133,137,140,144,147,149,151,154,156,159,162,164,167,171,173],"span",{"class":123,"line":124},"line",1,[121,126,128],{"class":127},"s5ixo","\u003C",[121,130,132],{"class":131},"sJa8x","div",[121,134,136],{"class":135},"sAGMh"," id",[121,138,139],{"class":127},"=",[121,141,143],{"class":142},"sDhpE","\"banner\"",[121,145,146],{"class":135}," class",[121,148,139],{"class":127},[121,150,143],{"class":142},[121,152,153],{"class":135}," parallax",[121,155,139],{"class":127},[121,157,158],{"class":142},"true",[121,160,161],{"class":135}," style",[121,163,139],{"class":127},[121,165,166],{"class":142},"\"",[121,168,170],{"class":169},"s-4uI","background: url('/img/default.png') no-repeat center center; background-size: cover;",[121,172,166],{"class":142},[121,174,175],{"class":127},">\n",[19,177,178],{},"我们可以通过 id 来定位这个元素，修改其 style.background 属性。",[19,180,181,182,187],{},"可以在任何地方引入下面的 js 代码，在这篇名为",[23,183,186],{"href":184,"rel":185},"https://www.zywvvd.com/notes/hexo/theme/fluid/fluid-add-umami/fluid-add-umami/",[27],"《Fluid -23- 添加 Umami 统计》"," 的文章里的方案是可供参考的。",[112,189,193],{"className":190,"code":191,"language":192,"meta":117,"style":117},"language-javascript shiki shiki-themes one-light one-dark-pro","const imgs = [\n    \"https://example.com/1.jpg\",\n    \"https://example.com/2.jpg\",\n    \"https://example.com/3.jpg\",\n    \"https://example.com/4.jpg\",\n    \"https://example.com/5.jpg\",\n    \"https://example.com/6.jpg\",\n    \"https://example.com/7.jpg\",\n    \"https://example.com/8.jpg\",\n    \"https://example.com/9.jpg\",\n    \"https://example.com/10.jpg\",\n    \"https://example.com/11.jpg\",\n    \"https://example.com/12.jpg\",\n    \"https://example.com/13.jpg\",\n    \"https://example.com/14.jpg\",\n    \"https://example.com/15.jpg\",\n    \"https://example.com/16.jpg\",\n    \"https://example.com/17.jpg\",\n    \"https://example.com/18.jpg\",\n    \"https://example.com/19.jpg\",\n    \"https://example.com/20.jpg\",\n]\n\nconst luck_img = imgs[Math.floor(Math.random() * imgs.length)]\nconst banner = document.getElementById('banner')\nbanner.style.background = `url(${luck_img}) center center / cover no-repeat`\n","javascript",[86,194,195,212,221,229,237,245,253,261,269,277,285,293,301,309,317,325,333,341,349,357,365,373,379,386,439,465],{"__ignoreMap":117},[121,196,197,201,205,209],{"class":123,"line":124},[121,198,200],{"class":199},"sLKXg","const",[121,202,204],{"class":203},"sNmU0"," imgs",[121,206,208],{"class":207},"s_Sar"," =",[121,210,211],{"class":127}," [\n",[121,213,215,218],{"class":123,"line":214},2,[121,216,217],{"class":142},"    \"https://example.com/1.jpg\"",[121,219,220],{"class":127},",\n",[121,222,224,227],{"class":123,"line":223},3,[121,225,226],{"class":142},"    \"https://example.com/2.jpg\"",[121,228,220],{"class":127},[121,230,232,235],{"class":123,"line":231},4,[121,233,234],{"class":142},"    \"https://example.com/3.jpg\"",[121,236,220],{"class":127},[121,238,240,243],{"class":123,"line":239},5,[121,241,242],{"class":142},"    \"https://example.com/4.jpg\"",[121,244,220],{"class":127},[121,246,248,251],{"class":123,"line":247},6,[121,249,250],{"class":142},"    \"https://example.com/5.jpg\"",[121,252,220],{"class":127},[121,254,256,259],{"class":123,"line":255},7,[121,257,258],{"class":142},"    \"https://example.com/6.jpg\"",[121,260,220],{"class":127},[121,262,264,267],{"class":123,"line":263},8,[121,265,266],{"class":142},"    \"https://example.com/7.jpg\"",[121,268,220],{"class":127},[121,270,272,275],{"class":123,"line":271},9,[121,273,274],{"class":142},"    \"https://example.com/8.jpg\"",[121,276,220],{"class":127},[121,278,280,283],{"class":123,"line":279},10,[121,281,282],{"class":142},"    \"https://example.com/9.jpg\"",[121,284,220],{"class":127},[121,286,288,291],{"class":123,"line":287},11,[121,289,290],{"class":142},"    \"https://example.com/10.jpg\"",[121,292,220],{"class":127},[121,294,296,299],{"class":123,"line":295},12,[121,297,298],{"class":142},"    \"https://example.com/11.jpg\"",[121,300,220],{"class":127},[121,302,304,307],{"class":123,"line":303},13,[121,305,306],{"class":142},"    \"https://example.com/12.jpg\"",[121,308,220],{"class":127},[121,310,312,315],{"class":123,"line":311},14,[121,313,314],{"class":142},"    \"https://example.com/13.jpg\"",[121,316,220],{"class":127},[121,318,320,323],{"class":123,"line":319},15,[121,321,322],{"class":142},"    \"https://example.com/14.jpg\"",[121,324,220],{"class":127},[121,326,328,331],{"class":123,"line":327},16,[121,329,330],{"class":142},"    \"https://example.com/15.jpg\"",[121,332,220],{"class":127},[121,334,336,339],{"class":123,"line":335},17,[121,337,338],{"class":142},"    \"https://example.com/16.jpg\"",[121,340,220],{"class":127},[121,342,344,347],{"class":123,"line":343},18,[121,345,346],{"class":142},"    \"https://example.com/17.jpg\"",[121,348,220],{"class":127},[121,350,352,355],{"class":123,"line":351},19,[121,353,354],{"class":142},"    \"https://example.com/18.jpg\"",[121,356,220],{"class":127},[121,358,360,363],{"class":123,"line":359},20,[121,361,362],{"class":142},"    \"https://example.com/19.jpg\"",[121,364,220],{"class":127},[121,366,368,371],{"class":123,"line":367},21,[121,369,370],{"class":142},"    \"https://example.com/20.jpg\"",[121,372,220],{"class":127},[121,374,376],{"class":123,"line":375},22,[121,377,378],{"class":127},"]\n",[121,380,382],{"class":123,"line":381},23,[121,383,385],{"emptyLinePlaceholder":384},true,"\n",[121,387,389,391,394,396,399,402,406,409,413,416,418,420,423,426,429,431,433,436],{"class":123,"line":388},24,[121,390,200],{"class":199},[121,392,393],{"class":203}," luck_img",[121,395,208],{"class":207},[121,397,204],{"class":398},"sz0mV",[121,400,401],{"class":127},"[",[121,403,405],{"class":404},"s7GmK","Math",[121,407,408],{"class":127},".",[121,410,412],{"class":411},"sAdtL","floor",[121,414,415],{"class":127},"(",[121,417,405],{"class":404},[121,419,408],{"class":127},[121,421,422],{"class":411},"random",[121,424,425],{"class":127},"() ",[121,427,428],{"class":207},"*",[121,430,204],{"class":404},[121,432,408],{"class":127},[121,434,435],{"class":131},"length",[121,437,438],{"class":127},")]\n",[121,440,442,444,447,449,452,454,457,459,462],{"class":123,"line":441},25,[121,443,200],{"class":199},[121,445,446],{"class":203}," banner",[121,448,208],{"class":207},[121,450,451],{"class":404}," document",[121,453,408],{"class":127},[121,455,456],{"class":411},"getElementById",[121,458,415],{"class":127},[121,460,461],{"class":142},"'banner'",[121,463,464],{"class":127},")\n",[121,466,468,471,473,477,479,482,484,487,491,494,497],{"class":123,"line":467},26,[121,469,470],{"class":404},"banner",[121,472,408],{"class":127},[121,474,476],{"class":475},"s2QsP","style",[121,478,408],{"class":127},[121,480,481],{"class":131},"background",[121,483,208],{"class":207},[121,485,486],{"class":142}," `url(",[121,488,490],{"class":489},"sAOjX","${",[121,492,493],{"class":398},"luck_img",[121,495,496],{"class":489},"}",[121,498,499],{"class":142},") center center / cover no-repeat`\n",[14,501,502],{"id":502},"成果",[19,504,505,506,510],{},"博客能够在不引入外部 api 的情况下通过 js 自主实现随机的 banner 背景图，",[507,508,509],"del",{},"但 pagespeed 的测速结果并没有明显好转","，因为 pagespeed 模拟了低速 4G 的访问速度，无论如何都无法提升大文件的加载速度。不过避免了多一次网络请求后，打开页面时的加载速度确实有提升。",[14,512,513],{"id":513},"参见",[515,516,517],"ul",{},[518,519,520],"li",{},[23,521,524],{"href":522,"rel":523},"https://vercel.com/guides/how-can-i-improve-serverless-function-lambda-cold-start-performance-on-vercel",[27],"How can I improve function cold start performance on Vercel?",[476,526,527],{},"html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html pre.shiki code .sJa8x, html code.shiki .sJa8x{--shiki-default:#E45649;--shiki-dark:#E06C75}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html pre.shiki code .s-4uI, html code.shiki .s-4uI{--shiki-default:#383A42;--shiki-dark:#98C379}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html pre.shiki code .sLKXg, html code.shiki .sLKXg{--shiki-default:#A626A4;--shiki-dark:#C678DD}html pre.shiki code .sNmU0, html code.shiki .sNmU0{--shiki-default:#986801;--shiki-dark:#E5C07B}html pre.shiki code .s_Sar, html code.shiki .s_Sar{--shiki-default:#0184BC;--shiki-dark:#56B6C2}html pre.shiki code .sz0mV, html code.shiki .sz0mV{--shiki-default:#383A42;--shiki-dark:#E06C75}html pre.shiki code .s7GmK, html code.shiki .s7GmK{--shiki-default:#383A42;--shiki-dark:#E5C07B}html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .s2QsP, html code.shiki .s2QsP{--shiki-default:#E45649;--shiki-dark:#E5C07B}html pre.shiki code .sAOjX, html code.shiki .sAOjX{--shiki-default:#CA1243;--shiki-dark:#C678DD}",{"title":117,"searchDepth":214,"depth":214,"links":529},[530,535,539,540],{"id":16,"depth":214,"text":17,"children":531},[532,533,534],{"id":40,"depth":223,"text":41},{"id":61,"depth":223,"text":61},{"id":67,"depth":223,"text":68},{"id":74,"depth":214,"text":75,"children":536},[537,538],{"id":81,"depth":223,"text":81},{"id":106,"depth":223,"text":107},{"id":502,"depth":214,"text":502},{"id":513,"depth":214,"text":513},[542,548],{"title":543,"path":544,"stem":545,"date":546,"lang":547,"children":-1},"使用 GPT 对 waline 的评论进行审查","/2024/10/12/use-gpt-to-review-waline-comments","posts/zh/use-gpt-to-review-waline-comments","2024-10-12 16:11:06","zh-CN",{"title":549,"path":550,"stem":551,"date":552,"lang":547,"children":-1},"使用向日葵智能插座 C2 用电记录推算宿舍上次烧水时间","/2024/09/24/log-last-water-boiling-water-with-sunlogin-adapter-power-consumption","posts/zh/log-last-water-boiling-water-with-sunlogin-adapter-power-consumption","2024-09-24 05:17:47",0,null,1766526714193]
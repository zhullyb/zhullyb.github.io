[{"data":1,"prerenderedAt":2144},["ShallowReactive",2],{"post-2024-08-20-picbed-upload-script-and-image-migration-zh":3,"surround-2024-08-20-picbed-upload-script-and-image-migration-zh":2131,"randomIndex/2024/08/20/picbed-upload-script-and-image-migration/":93,"language-switch-/2024/08/20/picbed-upload-script-and-image-migration/-en":2143},{"title":4,"date":5,"path":6,"tags":7,"body":13,"description":2130},"自建图床小记四——上传脚本编写与图片迁移","2024-08-20 23:12:30","/2024/08/20/picbed-upload-script-and-image-migration",[8,9,10,11,12],"Python","Image Hosting","Linux","Network","Shell Script",{"type":14,"value":15,"toc":2126},"minimark",[16,36,40,43,50,1148,1175,1213,1223,1226,1326,1347,1355,1358,1361,1364,2122],[17,18,19,20,25,26,30,31,35],"p",{},"前面三篇小记分别讲述了",[21,22,24],"a",{"href":23},"/2024/08/12/new-picbed-based-on-cloudflare-and-upyun/","图床的整体架构","、",[21,27,29],{"href":28},"/2024/08/13/build-restful-api-for-cloudflare-r2-with-cloudflare-workers/","用 Workers 构建 Restful API"," 和 ",[21,32,34],{"href":33},"/2024/08/14/auto-renew-ssl-certificate-and-deploy-to-upyun-with-github-action/","自动更新部署 SSL 证书","，这一篇c处理由此带来的图片上传问题，主要是要为 Typora 编写自动上传脚本，并为博客原有的图片进行迁移。",[37,38,39],"h2",{"id":39},"自动上传脚本",[17,41,42],{},"主要还是给 Typora 用，实现这种效果",[17,44,45],{},[46,47],"img",{"alt":48,"src":49},"Typora 自动上传","https://static.031130.xyz/uploads/2024/08/12/62f3b881e3c4c.gif",[51,52,57],"pre",{"className":53,"code":54,"language":55,"meta":56,"style":56},"language-bash shiki shiki-themes one-light one-dark-pro","#!/bin/bash\n\nHOST=\"upload.example.com\"\nCDN_HOST=\"cdn.example.com\"\nUPLOAD_PATH=\"uploads/$(date +%Y/%m/%d)\"\n\nAUTH_TOKEN=\"1145141919810\"\n\nwebp=false\nmarkdown=false\nforce=false\nkeep=false\n\nwhile getopts \":mwfkp:\" opt; do\n    case $opt in\n        m|markdown) markdown=true ;;\n        w|webp) webp=true ;;\n        f|force) force=true ;;\n        k|keep) keep=true ;;\n        p|path) UPLOAD_PATH=$OPTARG ;;\n        \\?) echo \"Invalid option: -$OPTARG\" ;;\n    esac\ndone\nshift $((OPTIND - 1))\n\nUPLOAD_URL=\"https://$HOST/$UPLOAD_PATH\"\nif [[ \"$UPLOAD_URL\" == */ ]]; then\n    UPLOAD_URL=\"${UPLOAD_URL%?}\"\nfi\n\nfor image in \"$@\"; do\n    if [ \"$webp\" = true ]; then\n        cwebp -quiet \"$image\" -o \"${image%.*}.webp\"\n        image=\"${image%.*}.webp\"\n    fi\n\n    if [ \"$keep\" = true ]; then\n        FILENAME=$(basename \"$image\")\n    else\n        FILENAME=\"$(md5sum $image | cut -c 1-13).$(basename $image | cut -d. -f2)\"\n    fi\n\n    if [ \"$force\" = true ]; then\n        UPLOAD_RESPONSE=$(curl -s -X PUT \"${UPLOAD_URL}/$FILENAME\" \\\n            -w \"%{http_code}\" \\\n            --data-binary @\"$image\" \\\n            -H \"X-Custom-Auth-Key: $AUTH_TOKEN\" \\\n            -H \"Overwrite: true\" \\\n        )\n    else\n        UPLOAD_RESPONSE=$(curl -s -X PUT \"${UPLOAD_URL}/$FILENAME\" \\\n            -w \"%{http_code}\" \\\n            --data-binary @\"$image\" \\\n            -H \"X-Custom-Auth-Key: $AUTH_TOKEN\" \\\n        )\n    fi\n\n    UPLOAD_HTTP_CODE=$(echo \"$UPLOAD_RESPONSE\" | tail -n1)\n\n    if [ -n \"$UPLOAD_PATH\" ]; then\n        CDN_URL=\"https://$CDN_HOST/$UPLOAD_PATH/$FILENAME\"\n    else\n        CDN_URL=\"https://$CDN_HOST/$FILENAME\"\n    fi\n\n    if [ \"$UPLOAD_HTTP_CODE\" != \"200\" ]; then\n        echo \"上传失败: $UPLOAD_RESPONSE\"\n        continue\n    fi\n\n    if [ \"$markdown\" = true ]; then\n        echo \"![](${CDN_URL})\"\n    else\n        echo \"${CDN_URL}\"\n    fi\ndone\n","bash","",[58,59,60,69,76,91,102,120,125,136,141,152,162,172,182,187,211,223,248,268,288,308,330,351,357,363,385,390,413,438,465,471,476,501,528,567,591,597,602,624,647,653,698,703,708,730,770,781,796,812,822,828,833,866,875,888,901,906,911,916,946,951,971,994,999,1016,1021,1026,1050,1063,1069,1074,1079,1101,1118,1123,1138,1143],"code",{"__ignoreMap":56},[61,62,65],"span",{"class":63,"line":64},"line",1,[61,66,68],{"class":67},"sW2Sy","#!/bin/bash\n",[61,70,72],{"class":63,"line":71},2,[61,73,75],{"emptyLinePlaceholder":74},true,"\n",[61,77,79,83,87],{"class":63,"line":78},3,[61,80,82],{"class":81},"sJa8x","HOST",[61,84,86],{"class":85},"sknuh","=",[61,88,90],{"class":89},"sDhpE","\"upload.example.com\"\n",[61,92,94,97,99],{"class":63,"line":93},4,[61,95,96],{"class":81},"CDN_HOST",[61,98,86],{"class":85},[61,100,101],{"class":89},"\"cdn.example.com\"\n",[61,103,105,108,110,113,117],{"class":63,"line":104},5,[61,106,107],{"class":81},"UPLOAD_PATH",[61,109,86],{"class":85},[61,111,112],{"class":89},"\"uploads/$(",[61,114,116],{"class":115},"sAdtL","date",[61,118,119],{"class":89}," +%Y/%m/%d)\"\n",[61,121,123],{"class":63,"line":122},6,[61,124,75],{"emptyLinePlaceholder":74},[61,126,128,131,133],{"class":63,"line":127},7,[61,129,130],{"class":81},"AUTH_TOKEN",[61,132,86],{"class":85},[61,134,135],{"class":89},"\"1145141919810\"\n",[61,137,139],{"class":63,"line":138},8,[61,140,75],{"emptyLinePlaceholder":74},[61,142,144,147,149],{"class":63,"line":143},9,[61,145,146],{"class":81},"webp",[61,148,86],{"class":85},[61,150,151],{"class":89},"false\n",[61,153,155,158,160],{"class":63,"line":154},10,[61,156,157],{"class":81},"markdown",[61,159,86],{"class":85},[61,161,151],{"class":89},[61,163,165,168,170],{"class":63,"line":164},11,[61,166,167],{"class":81},"force",[61,169,86],{"class":85},[61,171,151],{"class":89},[61,173,175,178,180],{"class":63,"line":174},12,[61,176,177],{"class":81},"keep",[61,179,86],{"class":85},[61,181,151],{"class":89},[61,183,185],{"class":63,"line":184},13,[61,186,75],{"emptyLinePlaceholder":74},[61,188,190,194,198,201,204,208],{"class":63,"line":189},14,[61,191,193],{"class":192},"sLKXg","while",[61,195,197],{"class":196},"s_Sar"," getopts",[61,199,200],{"class":89}," \":mwfkp:\"",[61,202,203],{"class":89}," opt",[61,205,207],{"class":206},"s5ixo","; ",[61,209,210],{"class":192},"do\n",[61,212,214,217,220],{"class":63,"line":213},15,[61,215,216],{"class":192},"    case",[61,218,219],{"class":81}," $opt",[61,221,222],{"class":192}," in\n",[61,224,226,230,233,235,238,240,242,245],{"class":63,"line":225},16,[61,227,229],{"class":228},"sDaw7","        m",[61,231,232],{"class":206},"|",[61,234,157],{"class":228},[61,236,237],{"class":206},") ",[61,239,157],{"class":81},[61,241,86],{"class":85},[61,243,244],{"class":89},"true",[61,246,247],{"class":206}," ;;\n",[61,249,251,254,256,258,260,262,264,266],{"class":63,"line":250},17,[61,252,253],{"class":228},"        w",[61,255,232],{"class":206},[61,257,146],{"class":228},[61,259,237],{"class":206},[61,261,146],{"class":81},[61,263,86],{"class":85},[61,265,244],{"class":89},[61,267,247],{"class":206},[61,269,271,274,276,278,280,282,284,286],{"class":63,"line":270},18,[61,272,273],{"class":228},"        f",[61,275,232],{"class":206},[61,277,167],{"class":228},[61,279,237],{"class":206},[61,281,167],{"class":81},[61,283,86],{"class":85},[61,285,244],{"class":89},[61,287,247],{"class":206},[61,289,291,294,296,298,300,302,304,306],{"class":63,"line":290},19,[61,292,293],{"class":228},"        k",[61,295,232],{"class":206},[61,297,177],{"class":228},[61,299,237],{"class":206},[61,301,177],{"class":81},[61,303,86],{"class":85},[61,305,244],{"class":89},[61,307,247],{"class":206},[61,309,311,314,316,319,321,323,325,328],{"class":63,"line":310},20,[61,312,313],{"class":228},"        p",[61,315,232],{"class":206},[61,317,318],{"class":228},"path",[61,320,237],{"class":206},[61,322,107],{"class":81},[61,324,86],{"class":85},[61,326,327],{"class":81},"$OPTARG",[61,329,247],{"class":206},[61,331,333,336,338,341,344,346,349],{"class":63,"line":332},21,[61,334,335],{"class":196},"        \\?",[61,337,237],{"class":206},[61,339,340],{"class":196},"echo",[61,342,343],{"class":89}," \"Invalid option: -",[61,345,327],{"class":81},[61,347,348],{"class":89},"\"",[61,350,247],{"class":206},[61,352,354],{"class":63,"line":353},22,[61,355,356],{"class":192},"    esac\n",[61,358,360],{"class":63,"line":359},23,[61,361,362],{"class":192},"done\n",[61,364,366,369,372,375,378,382],{"class":63,"line":365},24,[61,367,368],{"class":196},"shift",[61,370,371],{"class":206}," $((",[61,373,374],{"class":115},"OPTIND",[61,376,377],{"class":89}," -",[61,379,381],{"class":380},"sAGMh"," 1",[61,383,384],{"class":206},"))\n",[61,386,388],{"class":63,"line":387},25,[61,389,75],{"emptyLinePlaceholder":74},[61,391,393,396,398,401,404,407,410],{"class":63,"line":392},26,[61,394,395],{"class":81},"UPLOAD_URL",[61,397,86],{"class":85},[61,399,400],{"class":89},"\"https://",[61,402,403],{"class":81},"$HOST",[61,405,406],{"class":89},"/",[61,408,409],{"class":81},"$UPLOAD_PATH",[61,411,412],{"class":89},"\"\n",[61,414,416,419,422,424,427,429,432,435],{"class":63,"line":415},27,[61,417,418],{"class":192},"if",[61,420,421],{"class":206}," [[ ",[61,423,348],{"class":89},[61,425,426],{"class":81},"$UPLOAD_URL",[61,428,348],{"class":89},[61,430,431],{"class":85}," ==",[61,433,434],{"class":206}," */ ]]; ",[61,436,437],{"class":192},"then\n",[61,439,441,444,446,448,452,454,457,460,463],{"class":63,"line":440},28,[61,442,443],{"class":81},"    UPLOAD_URL",[61,445,86],{"class":85},[61,447,348],{"class":89},[61,449,451],{"class":450},"sTIpt","${",[61,453,395],{"class":81},[61,455,456],{"class":206},"%",[61,458,459],{"class":89},"?",[61,461,462],{"class":450},"}",[61,464,412],{"class":89},[61,466,468],{"class":63,"line":467},29,[61,469,470],{"class":192},"fi\n",[61,472,474],{"class":63,"line":473},30,[61,475,75],{"emptyLinePlaceholder":74},[61,477,479,482,485,488,491,495,497,499],{"class":63,"line":478},31,[61,480,481],{"class":192},"for",[61,483,484],{"class":81}," image",[61,486,487],{"class":192}," in",[61,489,490],{"class":89}," \"",[61,492,494],{"class":493},"s8iYz","$@",[61,496,348],{"class":89},[61,498,207],{"class":206},[61,500,210],{"class":192},[61,502,504,507,510,512,515,517,520,523,526],{"class":63,"line":503},32,[61,505,506],{"class":192},"    if",[61,508,509],{"class":206}," [ ",[61,511,348],{"class":89},[61,513,514],{"class":81},"$webp",[61,516,348],{"class":89},[61,518,519],{"class":85}," =",[61,521,522],{"class":380}," true",[61,524,525],{"class":206}," ]; ",[61,527,437],{"class":192},[61,529,531,534,537,539,542,544,547,549,551,554,556,559,562,564],{"class":63,"line":530},33,[61,532,533],{"class":115},"        cwebp",[61,535,536],{"class":380}," -quiet",[61,538,490],{"class":89},[61,540,541],{"class":81},"$image",[61,543,348],{"class":89},[61,545,546],{"class":380}," -o",[61,548,490],{"class":89},[61,550,451],{"class":450},[61,552,553],{"class":81},"image",[61,555,456],{"class":206},[61,557,558],{"class":89},".",[61,560,561],{"class":206},"*",[61,563,462],{"class":450},[61,565,566],{"class":89},".webp\"\n",[61,568,570,573,575,577,579,581,583,585,587,589],{"class":63,"line":569},34,[61,571,572],{"class":81},"        image",[61,574,86],{"class":85},[61,576,348],{"class":89},[61,578,451],{"class":450},[61,580,553],{"class":81},[61,582,456],{"class":206},[61,584,558],{"class":89},[61,586,561],{"class":206},[61,588,462],{"class":450},[61,590,566],{"class":89},[61,592,594],{"class":63,"line":593},35,[61,595,596],{"class":192},"    fi\n",[61,598,600],{"class":63,"line":599},36,[61,601,75],{"emptyLinePlaceholder":74},[61,603,605,607,609,611,614,616,618,620,622],{"class":63,"line":604},37,[61,606,506],{"class":192},[61,608,509],{"class":206},[61,610,348],{"class":89},[61,612,613],{"class":81},"$keep",[61,615,348],{"class":89},[61,617,519],{"class":85},[61,619,522],{"class":380},[61,621,525],{"class":206},[61,623,437],{"class":192},[61,625,627,630,632,635,638,640,642,644],{"class":63,"line":626},38,[61,628,629],{"class":81},"        FILENAME",[61,631,86],{"class":85},[61,633,634],{"class":206},"$(",[61,636,637],{"class":115},"basename",[61,639,490],{"class":89},[61,641,541],{"class":81},[61,643,348],{"class":89},[61,645,646],{"class":206},")\n",[61,648,650],{"class":63,"line":649},39,[61,651,652],{"class":192},"    else\n",[61,654,656,658,660,663,666,669,672,675,678,681,683,685,687,689,692,695],{"class":63,"line":655},40,[61,657,629],{"class":81},[61,659,86],{"class":85},[61,661,662],{"class":89},"\"$(",[61,664,665],{"class":115},"md5sum",[61,667,668],{"class":81}," $image",[61,670,671],{"class":206}," |",[61,673,674],{"class":115}," cut",[61,676,677],{"class":380}," -c",[61,679,680],{"class":89}," 1-13).$(",[61,682,637],{"class":115},[61,684,668],{"class":81},[61,686,671],{"class":206},[61,688,674],{"class":115},[61,690,691],{"class":380}," -d.",[61,693,694],{"class":380}," -f2",[61,696,697],{"class":89},")\"\n",[61,699,701],{"class":63,"line":700},41,[61,702,596],{"class":192},[61,704,706],{"class":63,"line":705},42,[61,707,75],{"emptyLinePlaceholder":74},[61,709,711,713,715,717,720,722,724,726,728],{"class":63,"line":710},43,[61,712,506],{"class":192},[61,714,509],{"class":206},[61,716,348],{"class":89},[61,718,719],{"class":81},"$force",[61,721,348],{"class":89},[61,723,519],{"class":85},[61,725,522],{"class":380},[61,727,525],{"class":206},[61,729,437],{"class":192},[61,731,733,736,738,740,743,746,749,752,754,756,758,760,762,765,767],{"class":63,"line":732},44,[61,734,735],{"class":81},"        UPLOAD_RESPONSE",[61,737,86],{"class":85},[61,739,634],{"class":206},[61,741,742],{"class":115},"curl",[61,744,745],{"class":380}," -s",[61,747,748],{"class":380}," -X",[61,750,751],{"class":89}," PUT",[61,753,490],{"class":89},[61,755,451],{"class":450},[61,757,395],{"class":81},[61,759,462],{"class":450},[61,761,406],{"class":89},[61,763,764],{"class":81},"$FILENAME",[61,766,348],{"class":89},[61,768,769],{"class":196}," \\\n",[61,771,773,776,779],{"class":63,"line":772},45,[61,774,775],{"class":380},"            -w",[61,777,778],{"class":89}," \"%{http_code}\"",[61,780,769],{"class":196},[61,782,784,787,790,792,794],{"class":63,"line":783},46,[61,785,786],{"class":380},"            --data-binary",[61,788,789],{"class":89}," @\"",[61,791,541],{"class":81},[61,793,348],{"class":89},[61,795,769],{"class":196},[61,797,799,802,805,808,810],{"class":63,"line":798},47,[61,800,801],{"class":380},"            -H",[61,803,804],{"class":89}," \"X-Custom-Auth-Key: ",[61,806,807],{"class":81},"$AUTH_TOKEN",[61,809,348],{"class":89},[61,811,769],{"class":196},[61,813,815,817,820],{"class":63,"line":814},48,[61,816,801],{"class":380},[61,818,819],{"class":89}," \"Overwrite: true\"",[61,821,769],{"class":196},[61,823,825],{"class":63,"line":824},49,[61,826,827],{"class":206},"        )\n",[61,829,831],{"class":63,"line":830},50,[61,832,652],{"class":192},[61,834,836,838,840,842,844,846,848,850,852,854,856,858,860,862,864],{"class":63,"line":835},51,[61,837,735],{"class":81},[61,839,86],{"class":85},[61,841,634],{"class":206},[61,843,742],{"class":115},[61,845,745],{"class":380},[61,847,748],{"class":380},[61,849,751],{"class":89},[61,851,490],{"class":89},[61,853,451],{"class":450},[61,855,395],{"class":81},[61,857,462],{"class":450},[61,859,406],{"class":89},[61,861,764],{"class":81},[61,863,348],{"class":89},[61,865,769],{"class":196},[61,867,869,871,873],{"class":63,"line":868},52,[61,870,775],{"class":380},[61,872,778],{"class":89},[61,874,769],{"class":196},[61,876,878,880,882,884,886],{"class":63,"line":877},53,[61,879,786],{"class":380},[61,881,789],{"class":89},[61,883,541],{"class":81},[61,885,348],{"class":89},[61,887,769],{"class":196},[61,889,891,893,895,897,899],{"class":63,"line":890},54,[61,892,801],{"class":380},[61,894,804],{"class":89},[61,896,807],{"class":81},[61,898,348],{"class":89},[61,900,769],{"class":196},[61,902,904],{"class":63,"line":903},55,[61,905,827],{"class":206},[61,907,909],{"class":63,"line":908},56,[61,910,596],{"class":192},[61,912,914],{"class":63,"line":913},57,[61,915,75],{"emptyLinePlaceholder":74},[61,917,919,922,924,926,928,930,933,935,938,941,944],{"class":63,"line":918},58,[61,920,921],{"class":81},"    UPLOAD_HTTP_CODE",[61,923,86],{"class":85},[61,925,634],{"class":206},[61,927,340],{"class":196},[61,929,490],{"class":89},[61,931,932],{"class":81},"$UPLOAD_RESPONSE",[61,934,348],{"class":89},[61,936,937],{"class":206}," | ",[61,939,940],{"class":115},"tail",[61,942,943],{"class":380}," -n1",[61,945,646],{"class":206},[61,947,949],{"class":63,"line":948},59,[61,950,75],{"emptyLinePlaceholder":74},[61,952,954,956,958,961,963,965,967,969],{"class":63,"line":953},60,[61,955,506],{"class":192},[61,957,509],{"class":206},[61,959,960],{"class":85},"-n",[61,962,490],{"class":89},[61,964,409],{"class":81},[61,966,348],{"class":89},[61,968,525],{"class":206},[61,970,437],{"class":192},[61,972,974,977,979,981,984,986,988,990,992],{"class":63,"line":973},61,[61,975,976],{"class":81},"        CDN_URL",[61,978,86],{"class":85},[61,980,400],{"class":89},[61,982,983],{"class":81},"$CDN_HOST",[61,985,406],{"class":89},[61,987,409],{"class":81},[61,989,406],{"class":89},[61,991,764],{"class":81},[61,993,412],{"class":89},[61,995,997],{"class":63,"line":996},62,[61,998,652],{"class":192},[61,1000,1002,1004,1006,1008,1010,1012,1014],{"class":63,"line":1001},63,[61,1003,976],{"class":81},[61,1005,86],{"class":85},[61,1007,400],{"class":89},[61,1009,983],{"class":81},[61,1011,406],{"class":89},[61,1013,764],{"class":81},[61,1015,412],{"class":89},[61,1017,1019],{"class":63,"line":1018},64,[61,1020,596],{"class":192},[61,1022,1024],{"class":63,"line":1023},65,[61,1025,75],{"emptyLinePlaceholder":74},[61,1027,1029,1031,1033,1035,1038,1040,1043,1046,1048],{"class":63,"line":1028},66,[61,1030,506],{"class":192},[61,1032,509],{"class":206},[61,1034,348],{"class":89},[61,1036,1037],{"class":81},"$UPLOAD_HTTP_CODE",[61,1039,348],{"class":89},[61,1041,1042],{"class":85}," !=",[61,1044,1045],{"class":89}," \"200\"",[61,1047,525],{"class":206},[61,1049,437],{"class":192},[61,1051,1053,1056,1059,1061],{"class":63,"line":1052},67,[61,1054,1055],{"class":196},"        echo",[61,1057,1058],{"class":89}," \"上传失败: ",[61,1060,932],{"class":81},[61,1062,412],{"class":89},[61,1064,1066],{"class":63,"line":1065},68,[61,1067,1068],{"class":192},"        continue\n",[61,1070,1072],{"class":63,"line":1071},69,[61,1073,596],{"class":192},[61,1075,1077],{"class":63,"line":1076},70,[61,1078,75],{"emptyLinePlaceholder":74},[61,1080,1082,1084,1086,1088,1091,1093,1095,1097,1099],{"class":63,"line":1081},71,[61,1083,506],{"class":192},[61,1085,509],{"class":206},[61,1087,348],{"class":89},[61,1089,1090],{"class":81},"$markdown",[61,1092,348],{"class":89},[61,1094,519],{"class":85},[61,1096,522],{"class":380},[61,1098,525],{"class":206},[61,1100,437],{"class":192},[61,1102,1104,1106,1109,1111,1114,1116],{"class":63,"line":1103},72,[61,1105,1055],{"class":196},[61,1107,1108],{"class":89}," \"![](",[61,1110,451],{"class":450},[61,1112,1113],{"class":81},"CDN_URL",[61,1115,462],{"class":450},[61,1117,697],{"class":89},[61,1119,1121],{"class":63,"line":1120},73,[61,1122,652],{"class":192},[61,1124,1126,1128,1130,1132,1134,1136],{"class":63,"line":1125},74,[61,1127,1055],{"class":196},[61,1129,490],{"class":89},[61,1131,451],{"class":450},[61,1133,1113],{"class":81},[61,1135,462],{"class":450},[61,1137,412],{"class":89},[61,1139,1141],{"class":63,"line":1140},75,[61,1142,596],{"class":192},[61,1144,1146],{"class":63,"line":1145},76,[61,1147,362],{"class":192},[17,1149,1150,1151,25,1154,30,1157,1160,1161,1163,1164,30,1166,1168,1169,30,1171,1174],{},"这一次使用 Cloudflare Workers 构建的 Restful API 很有意思，使用了 ",[58,1152,1153],{},"GET",[58,1155,1156],{},"PUT",[58,1158,1159],{},"DELETE"," 三个请求类型。",[58,1162,1153],{}," 请求很常见，是用来获取图片的，",[58,1165,1156],{},[58,1167,1159],{}," 在 web 开发就不如 ",[58,1170,1153],{},[58,1172,1173],{},"POST"," 常见了，这一次也是让我体会到了这两个 http verb 在 Storage Bucket 操作中是有多么形象了。",[1176,1177,1178,1202],"ul",{},[1179,1180,1181,1183,1184,1187,1188,1191,1192,1195,1196,1198,1199,1201],"li",{},[58,1182,1156],{}," - 从直观上来讲，就是将某个文件放到目标位置",[1185,1186],"br",{},"打个比方，我向 ",[58,1189,1190],{},"https://cdn.example.com/img/avatar.webp"," 打了一个请求，并带上了要上传的文件，那就意味着我将这个文件放到了 Storage Bucket 的 ",[58,1193,1194],{},"/img/avatar.webp"," 这个位置，所以我在上传后，应该就能用 ",[58,1197,1153],{}," 请求我刚才 ",[58,1200,1156],{}," 的那个 URL 获取我刚才上传的东西。如果那个路径存在文件，那么默认行为是直接覆盖。",[1179,1203,1204,1206,1207,1209,1210,1212],{},[58,1205,1159],{}," - 删除目标路径的文件",[1185,1208],{},"和 ",[58,1211,1156],{}," 一样，我在请求对应 URL 后，Storage Bucket 中对应 URL 路径的资源应该被删除。",[17,1214,1215,30,1217,1219,1220,1222],{},[58,1216,1156],{},[58,1218,1159],{}," 这两个 Http Verb 让我们更像是在对一个真实的文件系统进行操作，而非那种传统的使用 ",[58,1221,1173],{}," 上传的图床那样，我们并不通过 POST 请求上传一个文件，然后获取资源最终被放置位置的 URL —— 我们自己决定资源被存放的位置。",[17,1224,1225],{},"在这个 Shell 脚本中，引入了四个可选选项",[51,1227,1229],{"className":53,"code":1228,"language":55,"meta":56,"style":56},"    m|markdown) markdown=true ;;\n    w|webp) webp=true ;;\n    f|force) force=true ;;\n    k|keep) keep=true ;;\n    p|path) UPLOAD_PATH=$OPTARG ;;\n",[58,1230,1231,1250,1269,1288,1307],{"__ignoreMap":56},[61,1232,1233,1236,1238,1240,1242,1244,1246,1248],{"class":63,"line":64},[61,1234,1235],{"class":115},"    m",[61,1237,232],{"class":206},[61,1239,157],{"class":115},[61,1241,237],{"class":206},[61,1243,157],{"class":81},[61,1245,86],{"class":85},[61,1247,244],{"class":89},[61,1249,247],{"class":206},[61,1251,1252,1255,1257,1259,1261,1263,1265,1267],{"class":63,"line":71},[61,1253,1254],{"class":115},"    w",[61,1256,232],{"class":206},[61,1258,146],{"class":115},[61,1260,237],{"class":206},[61,1262,146],{"class":81},[61,1264,86],{"class":85},[61,1266,244],{"class":89},[61,1268,247],{"class":206},[61,1270,1271,1274,1276,1278,1280,1282,1284,1286],{"class":63,"line":78},[61,1272,1273],{"class":115},"    f",[61,1275,232],{"class":206},[61,1277,167],{"class":115},[61,1279,237],{"class":206},[61,1281,167],{"class":81},[61,1283,86],{"class":85},[61,1285,244],{"class":89},[61,1287,247],{"class":206},[61,1289,1290,1293,1295,1297,1299,1301,1303,1305],{"class":63,"line":93},[61,1291,1292],{"class":115},"    k",[61,1294,232],{"class":206},[61,1296,177],{"class":115},[61,1298,237],{"class":206},[61,1300,177],{"class":81},[61,1302,86],{"class":85},[61,1304,244],{"class":89},[61,1306,247],{"class":206},[61,1308,1309,1312,1314,1316,1318,1320,1322,1324],{"class":63,"line":104},[61,1310,1311],{"class":115},"    p",[61,1313,232],{"class":206},[61,1315,318],{"class":115},[61,1317,237],{"class":206},[61,1319,107],{"class":81},[61,1321,86],{"class":85},[61,1323,327],{"class":81},[61,1325,247],{"class":206},[1176,1327,1328,1335,1338,1341,1344],{},[1179,1329,1330,1331,1334],{},"markdown 选项决定返回值是否以 ",[58,1332,1333],{},"![]()"," 这种 URL 格式返回",[1179,1336,1337],{},"webp 决定上传过程中是否将图片转为 webp 后再上传",[1179,1339,1340],{},"force 决定如果遇到文件路径冲突，是否强制覆盖云端的文件",[1179,1342,1343],{},"keep 决定是否保留文件原有的文件名进行上传",[1179,1345,1346],{},"path 决定文件具体被存放的路径（或者使用默认的路径）",[17,1348,1349,1351,1352,1354],{},[58,1350,82],{}," 是图床用于上传的地址，",[58,1353,96],{}," 是图床用于被方可访问的地址。",[17,1356,1357],{},"由于急着用，也没考虑协程的处理方式，等等看后期有没有时间用 Python 重写吧。",[37,1359,1360],{"id":1360},"博客图床迁移脚本",[17,1362,1363],{},"因为只用一次，所以也没使用协程或者多线程的方式去上传文件——毕竟图片不多，也就两三百张。",[51,1365,1369],{"className":1366,"code":1367,"language":1368,"meta":56,"style":56},"language-python shiki shiki-themes one-light one-dark-pro","import os\nimport re\nimport requests\n\n# 哪些后缀的文件需要检测是否存在老图床的 URL 并进行迁移？\nfile_extension = [\n    '.md',\n    '.yml',\n    '.html'\n]\n\npic_urls = []\n\n_files = []\n\n# 用于匹配老图床的正则表达式，这里是按照 lsky pro 的格式编写的\npattern = r'https://cdn.example.com/\\d{4}/\\d{2}/\\d{2}/[a-z0-9]{13}\\.[a-z]{3,4}'\n\n# 图片的上传部分，需要先从原 url 中下载图片，在上传到新图床中，如果需要的话可以在中途转换为 webp 格式\ndef upload(url):\n    \"\"\"\n    此处的返回值应该是新的 url\n    \"\"\"\n\n# 遍历目标后缀文件名的文件，如果存在老图床的 url，则将 url 加入到 pic_urls 列表中，并将这个文件的文件名（相对路径）添加到 _files 列表中\nfor root, dirs, files in os.walk(\".\"):\n    for file in files:\n        if file.endswith(tuple(file_extension)):\n            file_name = os.path.join(root, file)\n            with open(file_name, 'r') as f:\n                content = f.read()\n            urls = re.findall(pattern, content)\n            if urls:\n                pic_urls.extend(urls)\n                _files.append(file_name)\n\n# 先转为集合，再转回列表，进行去重\npic_urls = list(set(pic_urls))\nprint(\"共找到图片：\", len(pic_urls))\n\nurl_dict = {}\n\n# 将列表中的图片进行上传，每张图片最多尝试三次上传，如果三次都失败，则保留原连接\nfor i,u in enumerate(pci_urls, start=1):\n    for t in range(1,4):\n        try:\n            new_u = upload(u)\n            continue\n        except:\n            if t == 3:\n                new_u = u\n                print(f\"{u} 无法上传：{e}\")\n    url_dict[u] = new_u\n    print(f\"{i} / {len(pic_urls)}\")\n\n# 对 _files 列表中的文件一一完成替换\nfor file in _files:\n    with open(file, 'r') as f:\n        content = f.read()\n    for k, v in url_dict.items():\n        content = content.replace(k, v)\n    with open(file, 'w') as f:\n        f.write(content)\n    print(\"完成替换：\", file)\n","python",[58,1370,1371,1379,1386,1393,1397,1402,1412,1420,1427,1432,1437,1441,1451,1455,1464,1468,1473,1525,1529,1534,1552,1557,1562,1566,1570,1575,1599,1612,1632,1653,1675,1691,1707,1715,1726,1737,1741,1746,1763,1781,1785,1795,1799,1804,1830,1854,1862,1874,1879,1886,1900,1910,1944,1954,1988,1992,1997,2008,2029,2042,2060,2075,2096,2107],{"__ignoreMap":56},[61,1372,1373,1376],{"class":63,"line":64},[61,1374,1375],{"class":192},"import",[61,1377,1378],{"class":206}," os\n",[61,1380,1381,1383],{"class":63,"line":71},[61,1382,1375],{"class":192},[61,1384,1385],{"class":206}," re\n",[61,1387,1388,1390],{"class":63,"line":78},[61,1389,1375],{"class":192},[61,1391,1392],{"class":206}," requests\n",[61,1394,1395],{"class":63,"line":93},[61,1396,75],{"emptyLinePlaceholder":74},[61,1398,1399],{"class":63,"line":104},[61,1400,1401],{"class":67},"# 哪些后缀的文件需要检测是否存在老图床的 URL 并进行迁移？\n",[61,1403,1404,1407,1409],{"class":63,"line":122},[61,1405,1406],{"class":206},"file_extension ",[61,1408,86],{"class":85},[61,1410,1411],{"class":206}," [\n",[61,1413,1414,1417],{"class":63,"line":127},[61,1415,1416],{"class":89},"    '.md'",[61,1418,1419],{"class":206},",\n",[61,1421,1422,1425],{"class":63,"line":138},[61,1423,1424],{"class":89},"    '.yml'",[61,1426,1419],{"class":206},[61,1428,1429],{"class":63,"line":143},[61,1430,1431],{"class":89},"    '.html'\n",[61,1433,1434],{"class":63,"line":154},[61,1435,1436],{"class":206},"]\n",[61,1438,1439],{"class":63,"line":164},[61,1440,75],{"emptyLinePlaceholder":74},[61,1442,1443,1446,1448],{"class":63,"line":174},[61,1444,1445],{"class":206},"pic_urls ",[61,1447,86],{"class":85},[61,1449,1450],{"class":206}," []\n",[61,1452,1453],{"class":63,"line":184},[61,1454,75],{"emptyLinePlaceholder":74},[61,1456,1457,1460,1462],{"class":63,"line":189},[61,1458,1459],{"class":206},"_files ",[61,1461,86],{"class":85},[61,1463,1450],{"class":206},[61,1465,1466],{"class":63,"line":213},[61,1467,75],{"emptyLinePlaceholder":74},[61,1469,1470],{"class":63,"line":225},[61,1471,1472],{"class":67},"# 用于匹配老图床的正则表达式，这里是按照 lsky pro 的格式编写的\n",[61,1474,1475,1478,1480,1483,1486,1490,1493,1496,1498,1500,1502,1505,1508,1511,1514,1516,1519,1522],{"class":63,"line":250},[61,1476,1477],{"class":206},"pattern ",[61,1479,86],{"class":85},[61,1481,1482],{"class":192}," r",[61,1484,1485],{"class":228},"'https://cdn.example.com/\\d",[61,1487,1489],{"class":1488},"sYebD","{4}",[61,1491,1492],{"class":228},"/\\d",[61,1494,1495],{"class":1488},"{2}",[61,1497,1492],{"class":228},[61,1499,1495],{"class":1488},[61,1501,406],{"class":228},[61,1503,1504],{"class":1488},"[",[61,1506,1507],{"class":380},"a-z0-9",[61,1509,1510],{"class":1488},"]{13}",[61,1512,1513],{"class":196},"\\.",[61,1515,1504],{"class":1488},[61,1517,1518],{"class":380},"a-z",[61,1520,1521],{"class":1488},"]{3,4}",[61,1523,1524],{"class":228},"'\n",[61,1526,1527],{"class":63,"line":270},[61,1528,75],{"emptyLinePlaceholder":74},[61,1530,1531],{"class":63,"line":290},[61,1532,1533],{"class":67},"# 图片的上传部分，需要先从原 url 中下载图片，在上传到新图床中，如果需要的话可以在中途转换为 webp 格式\n",[61,1535,1536,1539,1542,1545,1549],{"class":63,"line":310},[61,1537,1538],{"class":192},"def",[61,1540,1541],{"class":115}," upload",[61,1543,1544],{"class":206},"(",[61,1546,1548],{"class":1547},"so_Uh","url",[61,1550,1551],{"class":206},"):\n",[61,1553,1554],{"class":63,"line":332},[61,1555,1556],{"class":89},"    \"\"\"\n",[61,1558,1559],{"class":63,"line":353},[61,1560,1561],{"class":89},"    此处的返回值应该是新的 url\n",[61,1563,1564],{"class":63,"line":359},[61,1565,1556],{"class":89},[61,1567,1568],{"class":63,"line":365},[61,1569,75],{"emptyLinePlaceholder":74},[61,1571,1572],{"class":63,"line":387},[61,1573,1574],{"class":67},"# 遍历目标后缀文件名的文件，如果存在老图床的 url，则将 url 加入到 pic_urls 列表中，并将这个文件的文件名（相对路径）添加到 _files 列表中\n",[61,1576,1577,1579,1582,1585,1588,1592,1594,1597],{"class":63,"line":392},[61,1578,481],{"class":192},[61,1580,1581],{"class":206}," root, dirs, files ",[61,1583,1584],{"class":192},"in",[61,1586,1587],{"class":206}," os.",[61,1589,1591],{"class":1590},"slOjB","walk",[61,1593,1544],{"class":206},[61,1595,1596],{"class":89},"\".\"",[61,1598,1551],{"class":206},[61,1600,1601,1604,1607,1609],{"class":63,"line":415},[61,1602,1603],{"class":192},"    for",[61,1605,1606],{"class":81}," file",[61,1608,487],{"class":192},[61,1610,1611],{"class":206}," files:\n",[61,1613,1614,1617,1619,1621,1624,1626,1629],{"class":63,"line":440},[61,1615,1616],{"class":192},"        if",[61,1618,1606],{"class":81},[61,1620,558],{"class":206},[61,1622,1623],{"class":1590},"endswith",[61,1625,1544],{"class":206},[61,1627,1628],{"class":196},"tuple",[61,1630,1631],{"class":206},"(file_extension)):\n",[61,1633,1634,1637,1639,1642,1645,1648,1651],{"class":63,"line":467},[61,1635,1636],{"class":206},"            file_name ",[61,1638,86],{"class":85},[61,1640,1641],{"class":206}," os.path.",[61,1643,1644],{"class":1590},"join",[61,1646,1647],{"class":206},"(root, ",[61,1649,1650],{"class":81},"file",[61,1652,646],{"class":206},[61,1654,1655,1658,1661,1664,1667,1669,1672],{"class":63,"line":473},[61,1656,1657],{"class":192},"            with",[61,1659,1660],{"class":196}," open",[61,1662,1663],{"class":206},"(file_name, ",[61,1665,1666],{"class":89},"'r'",[61,1668,237],{"class":206},[61,1670,1671],{"class":192},"as",[61,1673,1674],{"class":206}," f:\n",[61,1676,1677,1680,1682,1685,1688],{"class":63,"line":478},[61,1678,1679],{"class":206},"                content ",[61,1681,86],{"class":85},[61,1683,1684],{"class":206}," f.",[61,1686,1687],{"class":1590},"read",[61,1689,1690],{"class":206},"()\n",[61,1692,1693,1696,1698,1701,1704],{"class":63,"line":503},[61,1694,1695],{"class":206},"            urls ",[61,1697,86],{"class":85},[61,1699,1700],{"class":206}," re.",[61,1702,1703],{"class":1590},"findall",[61,1705,1706],{"class":206},"(pattern, content)\n",[61,1708,1709,1712],{"class":63,"line":530},[61,1710,1711],{"class":192},"            if",[61,1713,1714],{"class":206}," urls:\n",[61,1716,1717,1720,1723],{"class":63,"line":569},[61,1718,1719],{"class":206},"                pic_urls.",[61,1721,1722],{"class":1590},"extend",[61,1724,1725],{"class":206},"(urls)\n",[61,1727,1728,1731,1734],{"class":63,"line":593},[61,1729,1730],{"class":206},"                _files.",[61,1732,1733],{"class":1590},"append",[61,1735,1736],{"class":206},"(file_name)\n",[61,1738,1739],{"class":63,"line":599},[61,1740,75],{"emptyLinePlaceholder":74},[61,1742,1743],{"class":63,"line":604},[61,1744,1745],{"class":67},"# 先转为集合，再转回列表，进行去重\n",[61,1747,1748,1750,1752,1755,1757,1760],{"class":63,"line":626},[61,1749,1445],{"class":206},[61,1751,86],{"class":85},[61,1753,1754],{"class":196}," list",[61,1756,1544],{"class":206},[61,1758,1759],{"class":196},"set",[61,1761,1762],{"class":206},"(pic_urls))\n",[61,1764,1765,1768,1770,1773,1776,1779],{"class":63,"line":649},[61,1766,1767],{"class":196},"print",[61,1769,1544],{"class":206},[61,1771,1772],{"class":89},"\"共找到图片：\"",[61,1774,1775],{"class":206},", ",[61,1777,1778],{"class":196},"len",[61,1780,1762],{"class":206},[61,1782,1783],{"class":63,"line":655},[61,1784,75],{"emptyLinePlaceholder":74},[61,1786,1787,1790,1792],{"class":63,"line":700},[61,1788,1789],{"class":206},"url_dict ",[61,1791,86],{"class":85},[61,1793,1794],{"class":206}," {}\n",[61,1796,1797],{"class":63,"line":705},[61,1798,75],{"emptyLinePlaceholder":74},[61,1800,1801],{"class":63,"line":710},[61,1802,1803],{"class":67},"# 将列表中的图片进行上传，每张图片最多尝试三次上传，如果三次都失败，则保留原连接\n",[61,1805,1806,1808,1811,1813,1816,1819,1823,1825,1828],{"class":63,"line":732},[61,1807,481],{"class":192},[61,1809,1810],{"class":206}," i,u ",[61,1812,1584],{"class":192},[61,1814,1815],{"class":196}," enumerate",[61,1817,1818],{"class":206},"(pci_urls, ",[61,1820,1822],{"class":1821},"sp7wS","start",[61,1824,86],{"class":85},[61,1826,1827],{"class":380},"1",[61,1829,1551],{"class":206},[61,1831,1832,1834,1837,1839,1842,1844,1846,1849,1852],{"class":63,"line":772},[61,1833,1603],{"class":192},[61,1835,1836],{"class":206}," t ",[61,1838,1584],{"class":192},[61,1840,1841],{"class":196}," range",[61,1843,1544],{"class":206},[61,1845,1827],{"class":380},[61,1847,1848],{"class":206},",",[61,1850,1851],{"class":380},"4",[61,1853,1551],{"class":206},[61,1855,1856,1859],{"class":63,"line":783},[61,1857,1858],{"class":192},"        try",[61,1860,1861],{"class":206},":\n",[61,1863,1864,1867,1869,1871],{"class":63,"line":798},[61,1865,1866],{"class":206},"            new_u ",[61,1868,86],{"class":85},[61,1870,1541],{"class":1590},[61,1872,1873],{"class":206},"(u)\n",[61,1875,1876],{"class":63,"line":814},[61,1877,1878],{"class":192},"            continue\n",[61,1880,1881,1884],{"class":63,"line":824},[61,1882,1883],{"class":192},"        except",[61,1885,1861],{"class":206},[61,1887,1888,1890,1892,1895,1898],{"class":63,"line":830},[61,1889,1711],{"class":192},[61,1891,1836],{"class":206},[61,1893,1894],{"class":85},"==",[61,1896,1897],{"class":380}," 3",[61,1899,1861],{"class":206},[61,1901,1902,1905,1907],{"class":63,"line":835},[61,1903,1904],{"class":206},"                new_u ",[61,1906,86],{"class":85},[61,1908,1909],{"class":206}," u\n",[61,1911,1912,1915,1917,1920,1922,1925,1928,1930,1933,1935,1938,1940,1942],{"class":63,"line":868},[61,1913,1914],{"class":196},"                print",[61,1916,1544],{"class":206},[61,1918,1919],{"class":192},"f",[61,1921,348],{"class":89},[61,1923,1924],{"class":380},"{",[61,1926,1927],{"class":206},"u",[61,1929,462],{"class":380},[61,1931,1932],{"class":89}," 无法上传：",[61,1934,1924],{"class":380},[61,1936,1937],{"class":206},"e",[61,1939,462],{"class":380},[61,1941,348],{"class":89},[61,1943,646],{"class":206},[61,1945,1946,1949,1951],{"class":63,"line":877},[61,1947,1948],{"class":206},"    url_dict[u] ",[61,1950,86],{"class":85},[61,1952,1953],{"class":206}," new_u\n",[61,1955,1956,1959,1961,1963,1965,1967,1970,1972,1975,1977,1979,1982,1984,1986],{"class":63,"line":890},[61,1957,1958],{"class":196},"    print",[61,1960,1544],{"class":206},[61,1962,1919],{"class":192},[61,1964,348],{"class":89},[61,1966,1924],{"class":380},[61,1968,1969],{"class":206},"i",[61,1971,462],{"class":380},[61,1973,1974],{"class":89}," / ",[61,1976,1924],{"class":380},[61,1978,1778],{"class":196},[61,1980,1981],{"class":206},"(pic_urls)",[61,1983,462],{"class":380},[61,1985,348],{"class":89},[61,1987,646],{"class":206},[61,1989,1990],{"class":63,"line":903},[61,1991,75],{"emptyLinePlaceholder":74},[61,1993,1994],{"class":63,"line":908},[61,1995,1996],{"class":67},"# 对 _files 列表中的文件一一完成替换\n",[61,1998,1999,2001,2003,2005],{"class":63,"line":913},[61,2000,481],{"class":192},[61,2002,1606],{"class":81},[61,2004,487],{"class":192},[61,2006,2007],{"class":206}," _files:\n",[61,2009,2010,2013,2015,2017,2019,2021,2023,2025,2027],{"class":63,"line":918},[61,2011,2012],{"class":192},"    with",[61,2014,1660],{"class":196},[61,2016,1544],{"class":206},[61,2018,1650],{"class":81},[61,2020,1775],{"class":206},[61,2022,1666],{"class":89},[61,2024,237],{"class":206},[61,2026,1671],{"class":192},[61,2028,1674],{"class":206},[61,2030,2031,2034,2036,2038,2040],{"class":63,"line":948},[61,2032,2033],{"class":206},"        content ",[61,2035,86],{"class":85},[61,2037,1684],{"class":206},[61,2039,1687],{"class":1590},[61,2041,1690],{"class":206},[61,2043,2044,2046,2049,2051,2054,2057],{"class":63,"line":953},[61,2045,1603],{"class":192},[61,2047,2048],{"class":206}," k, v ",[61,2050,1584],{"class":192},[61,2052,2053],{"class":206}," url_dict.",[61,2055,2056],{"class":1590},"items",[61,2058,2059],{"class":206},"():\n",[61,2061,2062,2064,2066,2069,2072],{"class":63,"line":973},[61,2063,2033],{"class":206},[61,2065,86],{"class":85},[61,2067,2068],{"class":206}," content.",[61,2070,2071],{"class":1590},"replace",[61,2073,2074],{"class":206},"(k, v)\n",[61,2076,2077,2079,2081,2083,2085,2087,2090,2092,2094],{"class":63,"line":996},[61,2078,2012],{"class":192},[61,2080,1660],{"class":196},[61,2082,1544],{"class":206},[61,2084,1650],{"class":81},[61,2086,1775],{"class":206},[61,2088,2089],{"class":89},"'w'",[61,2091,237],{"class":206},[61,2093,1671],{"class":192},[61,2095,1674],{"class":206},[61,2097,2098,2101,2104],{"class":63,"line":1001},[61,2099,2100],{"class":206},"        f.",[61,2102,2103],{"class":1590},"write",[61,2105,2106],{"class":206},"(content)\n",[61,2108,2109,2111,2113,2116,2118,2120],{"class":63,"line":1018},[61,2110,1958],{"class":196},[61,2112,1544],{"class":206},[61,2114,2115],{"class":89},"\"完成替换：\"",[61,2117,1775],{"class":206},[61,2119,1650],{"class":81},[61,2121,646],{"class":206},[2123,2124,2125],"style",{},"html pre.shiki code .sW2Sy, html code.shiki .sW2Sy{--shiki-default:#A0A1A7;--shiki-default-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic}html pre.shiki code .sJa8x, html code.shiki .sJa8x{--shiki-default:#E45649;--shiki-dark:#E06C75}html pre.shiki code .sknuh, html code.shiki .sknuh{--shiki-default:#383A42;--shiki-dark:#56B6C2}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .sLKXg, html code.shiki .sLKXg{--shiki-default:#A626A4;--shiki-dark:#C678DD}html pre.shiki code .s_Sar, html code.shiki .s_Sar{--shiki-default:#0184BC;--shiki-dark:#56B6C2}html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html pre.shiki code .sDaw7, html code.shiki .sDaw7{--shiki-default:#0184BC;--shiki-dark:#E06C75}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html pre.shiki code .sTIpt, html code.shiki .sTIpt{--shiki-default:#E45649;--shiki-dark:#98C379}html pre.shiki code .s8iYz, html code.shiki .s8iYz{--shiki-default:#383A42;--shiki-default-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html pre.shiki code .sYebD, html code.shiki .sYebD{--shiki-default:#383A42;--shiki-dark:#D19A66}html pre.shiki code .so_Uh, html code.shiki .so_Uh{--shiki-default:#986801;--shiki-default-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic}html pre.shiki code .slOjB, html code.shiki .slOjB{--shiki-default:#383A42;--shiki-dark:#61AFEF}html pre.shiki code .sp7wS, html code.shiki .sp7wS{--shiki-default:#986801;--shiki-default-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic}",{"title":56,"searchDepth":71,"depth":71,"links":2127},[2128,2129],{"id":39,"depth":71,"text":39},{"id":1360,"depth":71,"text":1360},"前面三篇小记分别讲述了图床的整体架构、用 Workers 构建 Restful API 和 自动更新部署 SSL 证书，这一篇c处理由此带来的图片上传问题，主要是要为 Typora 编写自动上传脚本，并为博客原有的图片进行迁移。",[2132,2138],{"title":2133,"path":2134,"stem":2135,"date":2136,"lang":2137,"children":-1},"自建图床小记五——费用","/2024/08/21/self-host-cdn-expense","posts/zh/self-host-cdn-expense","2024-08-21 00:05:15","zh-CN",{"title":2139,"path":2140,"stem":2141,"date":2142,"lang":2137,"children":-1},"自建图床小记三—— SSL 证书的自动更新与部署","/2024/08/14/auto-renew-ssl-certificate-and-deploy-to-upyun-with-github-action","posts/zh/auto-renew-ssl-certificate-and-deploy-to-upyun-with-github-action","2024-08-14 10:35:18",null,1765307569935]
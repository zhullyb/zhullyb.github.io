[{"data":1,"prerenderedAt":1505},["ShallowReactive",2],{"post-2024-10-12-use-gpt-to-review-waline-comments-zh":3,"surround-2024-10-12-use-gpt-to-review-waline-comments-zh":1492,"randomIndex/2024/10/12/use-gpt-to-review-waline-comments/":120,"language-switch-/2024/10/12/use-gpt-to-review-waline-comments/-en":1504},{"title":4,"date":5,"path":6,"tags":7,"body":10,"description":16},"使用 GPT 对 waline 的评论进行审查","2024-10-12 16:11:06","/2024/10/12/use-gpt-to-review-waline-comments",[8,9],"waline","GPT",{"type":11,"value":12,"toc":1490},"minimark",[13,17,34,37,44,53,62,829,844,847,850,853,1204,1207,1218,1224,1242,1247,1425,1430,1478,1481,1486],[14,15,16],"p",{},"前一阵子收到了这么一条来自 waline 的评论提醒。",[18,19,20],"blockquote",{},[14,21,22,23,28,29],{},"New comment on 竹林里有冰的博客\n【网站名称】：竹林里有冰的博客\n【评论者昵称】：专业数据库\n【评论者邮箱】：",[24,25,27],"a",{"href":26},"mailto:rakhiranijhhg@gmail.com","rakhiranijhhg@gmail.com","\n【内容】：总之，优化专业数据库对于保持数据准确性、提高系统性能和推动业务成功至关重要。通过遵循本文中概述的策略，您可以提高数据库操作的效率并释放新的增长机会。\n【地址】：",[24,30,31],{"href":31,"rel":32},"https://zhul.in/2021/04/04/yay-more/#66f7a8889ab78865d5f5ae19",[33],"nofollow",[14,35,36],{},"评论的内容不仅透露着一股 AI 味，还和文章内容可谓是一点关系都没有，点开评论者的网站一看，一股塑料机翻味，怕是又是个来蹭 SEO 的广告哥。",[14,38,39],{},[40,41],"img",{"alt":42,"src":43},"广告哥留下的网站","https://static.031130.xyz/uploads/2024/10/07/4673580090861.webp",[14,45,46,47,52],{},"根据 ",[24,48,51],{"href":49,"rel":50},"https://waline.js.org/advanced/faq.html#%E5%8F%91%E5%B8%83%E8%AF%84%E8%AE%BA%E5%BE%88%E6%85%A2%E6%80%8E%E4%B9%88%E5%8A%9E",[33],"waline 的官方文档","所言，waline 是使用了 Akismet 提供的垃圾内容检测服务的。可惜它似乎对 AI 生成的垃圾没有分辨能力。因此我计划使用 GPT 代替 Akismet 对 waline 的新评论进行审核。",[14,54,55,56,61],{},"walinejs/plugin 提供了一个 ",[24,57,60],{"href":58,"rel":59},"https://github.com/walinejs/plugins/blob/master/packages/tencent-tms/index.js",[33],"tencent-cms"," 的插件，功能是使用腾讯云的内容审查接口审查评论内容，这和我们需要的功能很像，主体部分和调用方法可以直接借鉴。",[63,64,69],"pre",{"className":65,"code":66,"language":67,"meta":68,"style":68},"language-javascript shiki shiki-themes one-light one-dark-pro","// index.js\n\nconst tencentcloud = require(\"tencentcloud-sdk-nodejs-tms\");\nconst TmsClient = tencentcloud.tms.v20201229.Client;\n\n\nmodule.exports = function({secretId, secretKey, region}) {\n  if (!secretId || !secretKey || !region) {\n    return {};\n  }\n\n  const clientConfig = {\n    credential: {\n      secretId,\n      secretKey,\n    },\n    region,\n    profile: {\n      httpProfile: {\n        endpoint: \"tms.tencentcloudapi.com\",\n      },\n    },\n  };\n  \n  return {\n    hooks: {\n      async preSave(data) {\n        const { userInfo } = this.ctx.state;\n        const isAdmin = userInfo.type === 'administrator';\n        // ignore admin comment\n        if (isAdmin) {\n          return;\n        }\n\n        const client = new TmsClient(clientConfig);\n        try {\n          const resp = await client.TextModeration({ Content: data.comment });\n          if (!resp.Suggestion) {\n            throw new Error('Suggestion is empty. Tencent Cloud TMS info:', resp);\n          }\n\n          switch(resp.Suggestion) {\n            case 'Pass':\n              data.status = 'approved';\n              break;\n            case 'Block':\n              data.status = 'spam';\n              break;\n              case 'Review':\n              default:\n                data.status = 'waiting';\n                break;\n          }\n        } catch(e) {\n          console.log(e);\n          data.status = 'waiting';\n        }\n      },\n    },\n  };\n}\n","javascript","",[70,71,72,81,88,118,152,157,162,199,231,240,246,251,265,277,286,294,300,308,318,328,341,347,352,358,364,372,382,398,431,457,463,476,484,490,495,517,525,565,585,607,613,618,634,646,664,672,682,698,705,716,724,741,749,754,770,787,803,808,813,818,823],"code",{"__ignoreMap":68},[73,74,77],"span",{"class":75,"line":76},"line",1,[73,78,80],{"class":79},"sW2Sy","// index.js\n",[73,82,84],{"class":75,"line":83},2,[73,85,87],{"emptyLinePlaceholder":86},true,"\n",[73,89,91,95,99,103,107,111,115],{"class":75,"line":90},3,[73,92,94],{"class":93},"sLKXg","const",[73,96,98],{"class":97},"sNmU0"," tencentcloud",[73,100,102],{"class":101},"s_Sar"," =",[73,104,106],{"class":105},"sAdtL"," require",[73,108,110],{"class":109},"s5ixo","(",[73,112,114],{"class":113},"sDhpE","\"tencentcloud-sdk-nodejs-tms\"",[73,116,117],{"class":109},");\n",[73,119,121,123,126,128,131,134,138,140,143,145,149],{"class":75,"line":120},4,[73,122,94],{"class":93},[73,124,125],{"class":97}," TmsClient",[73,127,102],{"class":101},[73,129,98],{"class":130},"s7GmK",[73,132,133],{"class":109},".",[73,135,137],{"class":136},"s2QsP","tms",[73,139,133],{"class":109},[73,141,142],{"class":136},"v20201229",[73,144,133],{"class":109},[73,146,148],{"class":147},"sJa8x","Client",[73,150,151],{"class":109},";\n",[73,153,155],{"class":75,"line":154},5,[73,156,87],{"emptyLinePlaceholder":86},[73,158,160],{"class":75,"line":159},6,[73,161,87],{"emptyLinePlaceholder":86},[73,163,165,168,170,173,175,178,181,185,188,191,193,196],{"class":75,"line":164},7,[73,166,167],{"class":136},"module",[73,169,133],{"class":109},[73,171,172],{"class":136},"exports",[73,174,102],{"class":101},[73,176,177],{"class":93}," function",[73,179,180],{"class":109},"({",[73,182,184],{"class":183},"s8iYz","secretId",[73,186,187],{"class":109},", ",[73,189,190],{"class":183},"secretKey",[73,192,187],{"class":109},[73,194,195],{"class":183},"region",[73,197,198],{"class":109},"}) {\n",[73,200,202,205,208,211,214,217,220,222,224,226,228],{"class":75,"line":201},8,[73,203,204],{"class":93},"  if",[73,206,207],{"class":109}," (",[73,209,210],{"class":101},"!",[73,212,184],{"class":213},"sz0mV",[73,215,216],{"class":101}," ||",[73,218,219],{"class":101}," !",[73,221,190],{"class":213},[73,223,216],{"class":101},[73,225,219],{"class":101},[73,227,195],{"class":213},[73,229,230],{"class":109},") {\n",[73,232,234,237],{"class":75,"line":233},9,[73,235,236],{"class":93},"    return",[73,238,239],{"class":109}," {};\n",[73,241,243],{"class":75,"line":242},10,[73,244,245],{"class":109},"  }\n",[73,247,249],{"class":75,"line":248},11,[73,250,87],{"emptyLinePlaceholder":86},[73,252,254,257,260,262],{"class":75,"line":253},12,[73,255,256],{"class":93},"  const",[73,258,259],{"class":97}," clientConfig",[73,261,102],{"class":101},[73,263,264],{"class":109}," {\n",[73,266,268,271,275],{"class":75,"line":267},13,[73,269,270],{"class":147},"    credential",[73,272,274],{"class":273},"st7oF",":",[73,276,264],{"class":109},[73,278,280,283],{"class":75,"line":279},14,[73,281,282],{"class":213},"      secretId",[73,284,285],{"class":109},",\n",[73,287,289,292],{"class":75,"line":288},15,[73,290,291],{"class":213},"      secretKey",[73,293,285],{"class":109},[73,295,297],{"class":75,"line":296},16,[73,298,299],{"class":109},"    },\n",[73,301,303,306],{"class":75,"line":302},17,[73,304,305],{"class":213},"    region",[73,307,285],{"class":109},[73,309,311,314,316],{"class":75,"line":310},18,[73,312,313],{"class":147},"    profile",[73,315,274],{"class":273},[73,317,264],{"class":109},[73,319,321,324,326],{"class":75,"line":320},19,[73,322,323],{"class":147},"      httpProfile",[73,325,274],{"class":273},[73,327,264],{"class":109},[73,329,331,334,336,339],{"class":75,"line":330},20,[73,332,333],{"class":147},"        endpoint",[73,335,274],{"class":273},[73,337,338],{"class":113}," \"tms.tencentcloudapi.com\"",[73,340,285],{"class":109},[73,342,344],{"class":75,"line":343},21,[73,345,346],{"class":109},"      },\n",[73,348,350],{"class":75,"line":349},22,[73,351,299],{"class":109},[73,353,355],{"class":75,"line":354},23,[73,356,357],{"class":109},"  };\n",[73,359,361],{"class":75,"line":360},24,[73,362,363],{"class":109},"  \n",[73,365,367,370],{"class":75,"line":366},25,[73,368,369],{"class":93},"  return",[73,371,264],{"class":109},[73,373,375,378,380],{"class":75,"line":374},26,[73,376,377],{"class":147},"    hooks",[73,379,274],{"class":273},[73,381,264],{"class":109},[73,383,385,388,391,393,396],{"class":75,"line":384},27,[73,386,387],{"class":93},"      async",[73,389,390],{"class":105}," preSave",[73,392,110],{"class":109},[73,394,395],{"class":183},"data",[73,397,230],{"class":109},[73,399,401,404,407,410,413,416,419,421,424,426,429],{"class":75,"line":400},28,[73,402,403],{"class":93},"        const",[73,405,406],{"class":109}," { ",[73,408,409],{"class":97},"userInfo",[73,411,412],{"class":109}," } ",[73,414,415],{"class":101},"=",[73,417,418],{"class":136}," this",[73,420,133],{"class":109},[73,422,423],{"class":136},"ctx",[73,425,133],{"class":109},[73,427,428],{"class":147},"state",[73,430,151],{"class":109},[73,432,434,436,439,441,444,446,449,452,455],{"class":75,"line":433},29,[73,435,403],{"class":93},[73,437,438],{"class":97}," isAdmin",[73,440,102],{"class":101},[73,442,443],{"class":130}," userInfo",[73,445,133],{"class":109},[73,447,448],{"class":147},"type",[73,450,451],{"class":101}," ===",[73,453,454],{"class":113}," 'administrator'",[73,456,151],{"class":109},[73,458,460],{"class":75,"line":459},30,[73,461,462],{"class":79},"        // ignore admin comment\n",[73,464,466,469,471,474],{"class":75,"line":465},31,[73,467,468],{"class":93},"        if",[73,470,207],{"class":109},[73,472,473],{"class":213},"isAdmin",[73,475,230],{"class":109},[73,477,479,482],{"class":75,"line":478},32,[73,480,481],{"class":93},"          return",[73,483,151],{"class":109},[73,485,487],{"class":75,"line":486},33,[73,488,489],{"class":109},"        }\n",[73,491,493],{"class":75,"line":492},34,[73,494,87],{"emptyLinePlaceholder":86},[73,496,498,500,503,505,508,510,512,515],{"class":75,"line":497},35,[73,499,403],{"class":93},[73,501,502],{"class":97}," client",[73,504,102],{"class":101},[73,506,507],{"class":93}," new",[73,509,125],{"class":105},[73,511,110],{"class":109},[73,513,514],{"class":213},"clientConfig",[73,516,117],{"class":109},[73,518,520,523],{"class":75,"line":519},36,[73,521,522],{"class":93},"        try",[73,524,264],{"class":109},[73,526,528,531,534,536,539,541,543,546,549,552,554,557,559,562],{"class":75,"line":527},37,[73,529,530],{"class":93},"          const",[73,532,533],{"class":97}," resp",[73,535,102],{"class":101},[73,537,538],{"class":93}," await",[73,540,502],{"class":130},[73,542,133],{"class":109},[73,544,545],{"class":105},"TextModeration",[73,547,548],{"class":109},"({ ",[73,550,551],{"class":147},"Content",[73,553,274],{"class":273},[73,555,556],{"class":130}," data",[73,558,133],{"class":109},[73,560,561],{"class":147},"comment",[73,563,564],{"class":109}," });\n",[73,566,568,571,573,575,578,580,583],{"class":75,"line":567},38,[73,569,570],{"class":93},"          if",[73,572,207],{"class":109},[73,574,210],{"class":101},[73,576,577],{"class":130},"resp",[73,579,133],{"class":109},[73,581,582],{"class":147},"Suggestion",[73,584,230],{"class":109},[73,586,588,591,593,596,598,601,603,605],{"class":75,"line":587},39,[73,589,590],{"class":93},"            throw",[73,592,507],{"class":93},[73,594,595],{"class":105}," Error",[73,597,110],{"class":109},[73,599,600],{"class":113},"'Suggestion is empty. Tencent Cloud TMS info:'",[73,602,187],{"class":109},[73,604,577],{"class":213},[73,606,117],{"class":109},[73,608,610],{"class":75,"line":609},40,[73,611,612],{"class":109},"          }\n",[73,614,616],{"class":75,"line":615},41,[73,617,87],{"emptyLinePlaceholder":86},[73,619,621,624,626,628,630,632],{"class":75,"line":620},42,[73,622,623],{"class":93},"          switch",[73,625,110],{"class":109},[73,627,577],{"class":130},[73,629,133],{"class":109},[73,631,582],{"class":147},[73,633,230],{"class":109},[73,635,637,640,643],{"class":75,"line":636},43,[73,638,639],{"class":93},"            case",[73,641,642],{"class":113}," 'Pass'",[73,644,645],{"class":109},":\n",[73,647,649,652,654,657,659,662],{"class":75,"line":648},44,[73,650,651],{"class":130},"              data",[73,653,133],{"class":109},[73,655,656],{"class":147},"status",[73,658,102],{"class":101},[73,660,661],{"class":113}," 'approved'",[73,663,151],{"class":109},[73,665,667,670],{"class":75,"line":666},45,[73,668,669],{"class":93},"              break",[73,671,151],{"class":109},[73,673,675,677,680],{"class":75,"line":674},46,[73,676,639],{"class":93},[73,678,679],{"class":113}," 'Block'",[73,681,645],{"class":109},[73,683,685,687,689,691,693,696],{"class":75,"line":684},47,[73,686,651],{"class":130},[73,688,133],{"class":109},[73,690,656],{"class":147},[73,692,102],{"class":101},[73,694,695],{"class":113}," 'spam'",[73,697,151],{"class":109},[73,699,701,703],{"class":75,"line":700},48,[73,702,669],{"class":93},[73,704,151],{"class":109},[73,706,708,711,714],{"class":75,"line":707},49,[73,709,710],{"class":93},"              case",[73,712,713],{"class":113}," 'Review'",[73,715,645],{"class":109},[73,717,719,722],{"class":75,"line":718},50,[73,720,721],{"class":93},"              default",[73,723,645],{"class":109},[73,725,727,730,732,734,736,739],{"class":75,"line":726},51,[73,728,729],{"class":130},"                data",[73,731,133],{"class":109},[73,733,656],{"class":147},[73,735,102],{"class":101},[73,737,738],{"class":113}," 'waiting'",[73,740,151],{"class":109},[73,742,744,747],{"class":75,"line":743},52,[73,745,746],{"class":93},"                break",[73,748,151],{"class":109},[73,750,752],{"class":75,"line":751},53,[73,753,612],{"class":109},[73,755,757,760,763,765,768],{"class":75,"line":756},54,[73,758,759],{"class":109},"        } ",[73,761,762],{"class":93},"catch",[73,764,110],{"class":109},[73,766,767],{"class":213},"e",[73,769,230],{"class":109},[73,771,773,776,778,781,783,785],{"class":75,"line":772},55,[73,774,775],{"class":130},"          console",[73,777,133],{"class":109},[73,779,780],{"class":105},"log",[73,782,110],{"class":109},[73,784,767],{"class":213},[73,786,117],{"class":109},[73,788,790,793,795,797,799,801],{"class":75,"line":789},56,[73,791,792],{"class":130},"          data",[73,794,133],{"class":109},[73,796,656],{"class":147},[73,798,102],{"class":101},[73,800,738],{"class":113},[73,802,151],{"class":109},[73,804,806],{"class":75,"line":805},57,[73,807,489],{"class":109},[73,809,811],{"class":75,"line":810},58,[73,812,346],{"class":109},[73,814,816],{"class":75,"line":815},59,[73,817,299],{"class":109},[73,819,821],{"class":75,"line":820},60,[73,822,357],{"class":109},[73,824,826],{"class":75,"line":825},61,[73,827,828],{"class":109},"}\n",[14,830,831,832,837,838,843],{},"可以看到，我们需要在这个被 module.exports 导出的函数中，return 一个对象，如果使用 hooks 编写的话可以调用",[24,833,836],{"href":834,"rel":835},"https://waline.js.org/reference/server/config.html#%E8%AF%84%E8%AE%BA-hooks",[33],"一些生命周期 hook",": 在 preSave 阶段，我们可以通过标注 data.status 参数来反馈评论类型。approved 为接受，spam 为垃圾邮件，waiting 为等待人工审核；除此之外，还可以",[24,839,842],{"href":840,"rel":841},"https://waline.js.org/reference/server/plugin.html#%E5%9F%BA%E4%BA%8E%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%88%B6%E4%BD%9C",[33],"基于 Koa 中间件制作插件","，文档中有具体的描述。",[14,845,846],{},"index.js 顶部是需要引入的依赖。当然，如果需要引入外部的第三方包的话，需要在 packages.json 中加入需要的依赖（使用包管理器的命令进行安装）。",[14,848,849],{},"有了这些基础知识，就能手搓一个基于 GPT 的评论审查插件。",[14,851,852],{},"OpenAI 提供的是标准的 Restful API，本身的鉴权逻辑也不复杂，其实没必要调用 SDK，直接使用 fetch 调用就行。",[63,854,856],{"className":65,"code":855,"language":67,"meta":68,"style":68},"const doReview = async (comment) => {\n  const response = await fetch(openaiBaseUrl + '/v1/chat/completions', {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n      'Authorization': `Bearer ${openaiApiKey}`,\n    },\n    body: JSON.stringify({\n      model: openaiModel,\n      messages: [\n        {\n          role: 'system',\n          content: prompt\n        },\n        {\n          role: 'user',\n          content: comment,\n        },\n      ],\n    }),\n  });\n  const data = await response.json();\n  if (data && data.choices && data.choices.length > 0) {\n    return data.choices[0].message.content;\n  } else {\n    return 'waiting';\n  }\n}\n",[70,857,858,882,910,922,931,943,968,972,990,1002,1012,1017,1029,1039,1044,1048,1059,1070,1074,1079,1084,1089,1109,1149,1178,1188,1196,1200],{"__ignoreMap":68},[73,859,860,862,865,867,870,872,874,877,880],{"class":75,"line":76},[73,861,94],{"class":93},[73,863,864],{"class":105}," doReview",[73,866,102],{"class":101},[73,868,869],{"class":93}," async",[73,871,207],{"class":109},[73,873,561],{"class":183},[73,875,876],{"class":109},") ",[73,878,879],{"class":93},"=>",[73,881,264],{"class":109},[73,883,884,886,889,891,893,896,898,901,904,907],{"class":75,"line":83},[73,885,256],{"class":93},[73,887,888],{"class":97}," response",[73,890,102],{"class":101},[73,892,538],{"class":93},[73,894,895],{"class":105}," fetch",[73,897,110],{"class":109},[73,899,900],{"class":213},"openaiBaseUrl",[73,902,903],{"class":101}," +",[73,905,906],{"class":113}," '/v1/chat/completions'",[73,908,909],{"class":109},", {\n",[73,911,912,915,917,920],{"class":75,"line":90},[73,913,914],{"class":147},"    method",[73,916,274],{"class":273},[73,918,919],{"class":113}," 'POST'",[73,921,285],{"class":109},[73,923,924,927,929],{"class":75,"line":120},[73,925,926],{"class":147},"    headers",[73,928,274],{"class":273},[73,930,264],{"class":109},[73,932,933,936,938,941],{"class":75,"line":154},[73,934,935],{"class":113},"      'Content-Type'",[73,937,274],{"class":273},[73,939,940],{"class":113}," 'application/json'",[73,942,285],{"class":109},[73,944,945,948,950,953,957,960,963,966],{"class":75,"line":159},[73,946,947],{"class":113},"      'Authorization'",[73,949,274],{"class":273},[73,951,952],{"class":113}," `Bearer ",[73,954,956],{"class":955},"sAOjX","${",[73,958,959],{"class":213},"openaiApiKey",[73,961,962],{"class":955},"}",[73,964,965],{"class":113},"`",[73,967,285],{"class":109},[73,969,970],{"class":75,"line":164},[73,971,299],{"class":109},[73,973,974,977,979,982,984,987],{"class":75,"line":201},[73,975,976],{"class":147},"    body",[73,978,274],{"class":273},[73,980,981],{"class":97}," JSON",[73,983,133],{"class":109},[73,985,986],{"class":105},"stringify",[73,988,989],{"class":109},"({\n",[73,991,992,995,997,1000],{"class":75,"line":233},[73,993,994],{"class":147},"      model",[73,996,274],{"class":273},[73,998,999],{"class":213}," openaiModel",[73,1001,285],{"class":109},[73,1003,1004,1007,1009],{"class":75,"line":242},[73,1005,1006],{"class":147},"      messages",[73,1008,274],{"class":273},[73,1010,1011],{"class":109}," [\n",[73,1013,1014],{"class":75,"line":248},[73,1015,1016],{"class":109},"        {\n",[73,1018,1019,1022,1024,1027],{"class":75,"line":253},[73,1020,1021],{"class":147},"          role",[73,1023,274],{"class":273},[73,1025,1026],{"class":113}," 'system'",[73,1028,285],{"class":109},[73,1030,1031,1034,1036],{"class":75,"line":267},[73,1032,1033],{"class":147},"          content",[73,1035,274],{"class":273},[73,1037,1038],{"class":213}," prompt\n",[73,1040,1041],{"class":75,"line":279},[73,1042,1043],{"class":109},"        },\n",[73,1045,1046],{"class":75,"line":288},[73,1047,1016],{"class":109},[73,1049,1050,1052,1054,1057],{"class":75,"line":296},[73,1051,1021],{"class":147},[73,1053,274],{"class":273},[73,1055,1056],{"class":113}," 'user'",[73,1058,285],{"class":109},[73,1060,1061,1063,1065,1068],{"class":75,"line":302},[73,1062,1033],{"class":147},[73,1064,274],{"class":273},[73,1066,1067],{"class":213}," comment",[73,1069,285],{"class":109},[73,1071,1072],{"class":75,"line":310},[73,1073,1043],{"class":109},[73,1075,1076],{"class":75,"line":320},[73,1077,1078],{"class":109},"      ],\n",[73,1080,1081],{"class":75,"line":330},[73,1082,1083],{"class":109},"    }),\n",[73,1085,1086],{"class":75,"line":343},[73,1087,1088],{"class":109},"  });\n",[73,1090,1091,1093,1095,1097,1099,1101,1103,1106],{"class":75,"line":349},[73,1092,256],{"class":93},[73,1094,556],{"class":97},[73,1096,102],{"class":101},[73,1098,538],{"class":93},[73,1100,888],{"class":130},[73,1102,133],{"class":109},[73,1104,1105],{"class":105},"json",[73,1107,1108],{"class":109},"();\n",[73,1110,1111,1113,1115,1117,1120,1122,1124,1127,1129,1131,1133,1135,1137,1140,1143,1147],{"class":75,"line":354},[73,1112,204],{"class":93},[73,1114,207],{"class":109},[73,1116,395],{"class":213},[73,1118,1119],{"class":101}," &&",[73,1121,556],{"class":130},[73,1123,133],{"class":109},[73,1125,1126],{"class":147},"choices",[73,1128,1119],{"class":101},[73,1130,556],{"class":130},[73,1132,133],{"class":109},[73,1134,1126],{"class":136},[73,1136,133],{"class":109},[73,1138,1139],{"class":147},"length",[73,1141,1142],{"class":101}," >",[73,1144,1146],{"class":1145},"sAGMh"," 0",[73,1148,230],{"class":109},[73,1150,1151,1153,1155,1157,1159,1162,1165,1168,1171,1173,1176],{"class":75,"line":360},[73,1152,236],{"class":93},[73,1154,556],{"class":130},[73,1156,133],{"class":109},[73,1158,1126],{"class":147},[73,1160,1161],{"class":109},"[",[73,1163,1164],{"class":1145},"0",[73,1166,1167],{"class":109},"].",[73,1169,1170],{"class":136},"message",[73,1172,133],{"class":109},[73,1174,1175],{"class":147},"content",[73,1177,151],{"class":109},[73,1179,1180,1183,1186],{"class":75,"line":366},[73,1181,1182],{"class":109},"  } ",[73,1184,1185],{"class":93},"else",[73,1187,264],{"class":109},[73,1189,1190,1192,1194],{"class":75,"line":374},[73,1191,236],{"class":93},[73,1193,738],{"class":113},[73,1195,151],{"class":109},[73,1197,1198],{"class":75,"line":384},[73,1199,245],{"class":109},[73,1201,1202],{"class":75,"line":400},[73,1203,828],{"class":109},[14,1205,1206],{},"再配合相应的封装，一款基于 GPT 的 waline 评论审核插件就完成了",[1208,1209,1210],"ul",{},[1211,1212,1213],"li",{},[24,1214,1217],{"href":1215,"rel":1216},"https://github.com/zhullyb/waline-plugin-llm-reviewer",[33],"zhullyb/waline-plugin-llm-reviewer",[14,1219,1220],{},[1221,1222,1223],"strong",{},"如何安装",[63,1225,1229],{"className":1226,"code":1227,"language":1228,"meta":68,"style":68},"language-bash shiki shiki-themes one-light one-dark-pro","npm install waline-plugin-llm-reviewer\n","bash",[70,1230,1231],{"__ignoreMap":68},[73,1232,1233,1236,1239],{"class":75,"line":76},[73,1234,1235],{"class":105},"npm",[73,1237,1238],{"class":113}," install",[73,1240,1241],{"class":113}," waline-plugin-llm-reviewer\n",[14,1243,1244],{},[1221,1245,1246],{},"如何使用",[63,1248,1250],{"className":65,"code":1249,"language":67,"meta":68,"style":68},"// index.js\nconst Waline = require('@waline/vercel');\nconst GPTReviewer = require('waline-plugin-llm-reviewer');\n\nmodule.exports = Waline({\n  plugins: [\n    GptReviewer({\n        openaiBaseUrl: process.env.OPENAI_BASE_URL,\n        openaiModel: process.env.OPENAI_MODEL,\n        openaiApiKey: process.env.OPENAI_API_KEY,\n        openaiPrompt: process.env.OPENAI_PROMPT,\n    })\n  ]\n});\n",[70,1251,1252,1256,1274,1292,1296,1310,1319,1326,1350,1370,1390,1410,1415,1420],{"__ignoreMap":68},[73,1253,1254],{"class":75,"line":76},[73,1255,80],{"class":79},[73,1257,1258,1260,1263,1265,1267,1269,1272],{"class":75,"line":83},[73,1259,94],{"class":93},[73,1261,1262],{"class":97}," Waline",[73,1264,102],{"class":101},[73,1266,106],{"class":105},[73,1268,110],{"class":109},[73,1270,1271],{"class":113},"'@waline/vercel'",[73,1273,117],{"class":109},[73,1275,1276,1278,1281,1283,1285,1287,1290],{"class":75,"line":90},[73,1277,94],{"class":93},[73,1279,1280],{"class":97}," GPTReviewer",[73,1282,102],{"class":101},[73,1284,106],{"class":105},[73,1286,110],{"class":109},[73,1288,1289],{"class":113},"'waline-plugin-llm-reviewer'",[73,1291,117],{"class":109},[73,1293,1294],{"class":75,"line":120},[73,1295,87],{"emptyLinePlaceholder":86},[73,1297,1298,1300,1302,1304,1306,1308],{"class":75,"line":154},[73,1299,167],{"class":136},[73,1301,133],{"class":109},[73,1303,172],{"class":136},[73,1305,102],{"class":101},[73,1307,1262],{"class":105},[73,1309,989],{"class":109},[73,1311,1312,1315,1317],{"class":75,"line":159},[73,1313,1314],{"class":147},"  plugins",[73,1316,274],{"class":273},[73,1318,1011],{"class":109},[73,1320,1321,1324],{"class":75,"line":164},[73,1322,1323],{"class":105},"    GptReviewer",[73,1325,989],{"class":109},[73,1327,1328,1331,1333,1336,1338,1342,1344,1348],{"class":75,"line":201},[73,1329,1330],{"class":147},"        openaiBaseUrl",[73,1332,274],{"class":273},[73,1334,1335],{"class":130}," process",[73,1337,133],{"class":109},[73,1339,1341],{"class":1340},"sC09Y","env",[73,1343,133],{"class":109},[73,1345,1347],{"class":1346},"sRZ4U","OPENAI_BASE_URL",[73,1349,285],{"class":109},[73,1351,1352,1355,1357,1359,1361,1363,1365,1368],{"class":75,"line":233},[73,1353,1354],{"class":147},"        openaiModel",[73,1356,274],{"class":273},[73,1358,1335],{"class":130},[73,1360,133],{"class":109},[73,1362,1341],{"class":1340},[73,1364,133],{"class":109},[73,1366,1367],{"class":1346},"OPENAI_MODEL",[73,1369,285],{"class":109},[73,1371,1372,1375,1377,1379,1381,1383,1385,1388],{"class":75,"line":242},[73,1373,1374],{"class":147},"        openaiApiKey",[73,1376,274],{"class":273},[73,1378,1335],{"class":130},[73,1380,133],{"class":109},[73,1382,1341],{"class":1340},[73,1384,133],{"class":109},[73,1386,1387],{"class":1346},"OPENAI_API_KEY",[73,1389,285],{"class":109},[73,1391,1392,1395,1397,1399,1401,1403,1405,1408],{"class":75,"line":248},[73,1393,1394],{"class":147},"        openaiPrompt",[73,1396,274],{"class":273},[73,1398,1335],{"class":130},[73,1400,133],{"class":109},[73,1402,1341],{"class":1340},[73,1404,133],{"class":109},[73,1406,1407],{"class":1346},"OPENAI_PROMPT",[73,1409,285],{"class":109},[73,1411,1412],{"class":75,"line":253},[73,1413,1414],{"class":109},"    })\n",[73,1416,1417],{"class":75,"line":267},[73,1418,1419],{"class":109},"  ]\n",[73,1421,1422],{"class":75,"line":279},[73,1423,1424],{"class":109},"});\n",[14,1426,1427],{},[1221,1428,1429],{},"环境变量",[1208,1431,1432,1446,1454,1462,1470],{},[1211,1433,1434,1437,1438,1445],{},[70,1435,1436],{},"ASISMET_KEY",": Waline 使用的反垃圾评论服务，",[1221,1439,1440,1441,1444],{},"建议设置为 ",[70,1442,1443],{},"false"," 以禁用","。",[1211,1447,1448,1450,1451],{},[70,1449,1347],{},": API 基础 URL。例如 ",[70,1452,1453],{},"https://api.openai.com",[1211,1455,1456,1458,1459],{},[70,1457,1367],{},": 模型名称。例如 ",[70,1460,1461],{},"gpt-4o-mini",[1211,1463,1464,1466,1467],{},[70,1465,1387],{},": API 密钥。例如 ",[70,1468,1469],{},"ak-xxxxxx",[1211,1471,1472,1474,1475],{},[70,1473,1407],{},"(可选): 模型的提示。例如 ",[70,1476,1477],{},"这是一个评论审查: ",[14,1479,1480],{},"在 waline 中设置好对应的环境变量，使用 npm 安装好对应的包，就算大功告成了。",[14,1482,1483],{},[40,1484],{"alt":68,"src":1485},"https://static.031130.xyz/uploads/2024/10/12/45f06a78286de.webp",[1487,1488,1489],"style",{},"html pre.shiki code .sW2Sy, html code.shiki .sW2Sy{--shiki-default:#A0A1A7;--shiki-default-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic}html pre.shiki code .sLKXg, html code.shiki .sLKXg{--shiki-default:#A626A4;--shiki-dark:#C678DD}html pre.shiki code .sNmU0, html code.shiki .sNmU0{--shiki-default:#986801;--shiki-dark:#E5C07B}html pre.shiki code .s_Sar, html code.shiki .s_Sar{--shiki-default:#0184BC;--shiki-dark:#56B6C2}html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html pre.shiki code .s7GmK, html code.shiki .s7GmK{--shiki-default:#383A42;--shiki-dark:#E5C07B}html pre.shiki code .s2QsP, html code.shiki .s2QsP{--shiki-default:#E45649;--shiki-dark:#E5C07B}html pre.shiki code .sJa8x, html code.shiki .sJa8x{--shiki-default:#E45649;--shiki-dark:#E06C75}html pre.shiki code .s8iYz, html code.shiki .s8iYz{--shiki-default:#383A42;--shiki-default-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic}html pre.shiki code .sz0mV, html code.shiki .sz0mV{--shiki-default:#383A42;--shiki-dark:#E06C75}html pre.shiki code .st7oF, html code.shiki .st7oF{--shiki-default:#0184BC;--shiki-dark:#ABB2BF}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html pre.shiki code .sAOjX, html code.shiki .sAOjX{--shiki-default:#CA1243;--shiki-dark:#C678DD}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html pre.shiki code .sC09Y, html code.shiki .sC09Y{--shiki-default:#C18401;--shiki-dark:#E5C07B}html pre.shiki code .sRZ4U, html code.shiki .sRZ4U{--shiki-default:#986801;--shiki-dark:#E06C75}",{"title":68,"searchDepth":83,"depth":83,"links":1491},[],[1493,1499],{"title":1494,"path":1495,"stem":1496,"date":1497,"lang":1498,"children":-1},"为 Hexo 添加 follow 认证","/2024/10/23/follow-cert-for-hexo-feed","posts/zh/follow-cert-for-hexo-feed","2024-10-23 23:11:32","zh-CN",{"title":1500,"path":1501,"stem":1502,"date":1503,"lang":1498,"children":-1},"基于 JavaScript 的 Hexo Fluid 主题 banner 随机背景图实现","/2024/09/25/random-banner-backgroud-image-implement-for-hexo-fluid-with-javascript","posts/zh/random-banner-backgroud-image-implement-for-hexo-fluid-with-javascript","2024-09-25 00:00:42",null,1765392895228]
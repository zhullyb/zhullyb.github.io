[{"data":1,"prerenderedAt":497},["ShallowReactive",2],{"post-2024-01-14-where-does-this-refer-in-arrow-function-in-js-zh":3,"surround-2024-01-14-where-does-this-refer-in-arrow-function-in-js-zh":484,"randomIndex/2024/01/14/where-does-this-refer-in-arrow-function-in-js/":167,"language-switch-/2024/01/14/where-does-this-refer-in-arrow-function-in-js/-en":496},{"title":4,"date":5,"path":6,"tags":7,"body":9,"description":483},"在 JavaScript 中，箭头函数中的 this 指针到底指向哪里？","2024-01-14 02:50:03","/2024/01/14/where-does-this-refer-in-arrow-function-in-js",[8],"JavaScript",{"type":10,"value":11,"toc":480},"minimark",[12,21,369,372,379,386,397,400,403,414,421,437,444,450,454,462,469,476],[13,14,15,16,20],"p",{},"这学期期末复习的时候，学校里负责上 JavaScript 的老师给我们提出了一个问题。下面这段代码中，",[17,18,19],"code",{},"a.u2()"," 在 ES Module 下执行会抛出 TypeError 的异常，在 CommonJS 下运行则会输出 undefined，而 B 这个类的 u2 函数则能够在对象实例化以后正常运行。",[22,23,28],"pre",{"className":24,"code":25,"language":26,"meta":27,"style":27},"language-javascript shiki shiki-themes one-light one-dark-pro","const a = {\n    x: 3,\n    u1: function () {\n        console.log(this.x)\n    },\n    u2: () => {\n        console.log(this.x)\n    }\n}\n\nclass b {\n    x = 3\n\n    u1 = function () {\n        console.log(this.x)\n    }\n\n    u2 = () => {\n        console.log(this.x)\n    }\n}\n\na.u1()\n// 3\na.u2()\n// undefined\n\nnew b().u1()\n// 3\nnew b().u2()\n// 3\n","javascript","",[17,29,30,51,69,84,112,118,134,153,159,165,172,184,195,200,211,230,235,240,253,272,277,282,287,301,308,320,326,331,346,351,364],{"__ignoreMap":27},[31,32,35,39,43,47],"span",{"class":33,"line":34},"line",1,[31,36,38],{"class":37},"sLKXg","const",[31,40,42],{"class":41},"sNmU0"," a",[31,44,46],{"class":45},"s_Sar"," =",[31,48,50],{"class":49},"s5ixo"," {\n",[31,52,54,58,62,66],{"class":33,"line":53},2,[31,55,57],{"class":56},"sJa8x","    x",[31,59,61],{"class":60},"st7oF",":",[31,63,65],{"class":64},"sAGMh"," 3",[31,67,68],{"class":49},",\n",[31,70,72,76,78,81],{"class":33,"line":71},3,[31,73,75],{"class":74},"sAdtL","    u1",[31,77,61],{"class":60},[31,79,80],{"class":37}," function",[31,82,83],{"class":49}," () {\n",[31,85,87,91,94,97,100,104,106,109],{"class":33,"line":86},4,[31,88,90],{"class":89},"s7GmK","        console",[31,92,93],{"class":49},".",[31,95,96],{"class":74},"log",[31,98,99],{"class":49},"(",[31,101,103],{"class":102},"s2QsP","this",[31,105,93],{"class":49},[31,107,108],{"class":56},"x",[31,110,111],{"class":49},")\n",[31,113,115],{"class":33,"line":114},5,[31,116,117],{"class":49},"    },\n",[31,119,121,124,126,129,132],{"class":33,"line":120},6,[31,122,123],{"class":74},"    u2",[31,125,61],{"class":60},[31,127,128],{"class":49}," () ",[31,130,131],{"class":37},"=>",[31,133,50],{"class":49},[31,135,137,139,141,143,145,147,149,151],{"class":33,"line":136},7,[31,138,90],{"class":89},[31,140,93],{"class":49},[31,142,96],{"class":74},[31,144,99],{"class":49},[31,146,103],{"class":102},[31,148,93],{"class":49},[31,150,108],{"class":56},[31,152,111],{"class":49},[31,154,156],{"class":33,"line":155},8,[31,157,158],{"class":49},"    }\n",[31,160,162],{"class":33,"line":161},9,[31,163,164],{"class":49},"}\n",[31,166,168],{"class":33,"line":167},10,[31,169,171],{"emptyLinePlaceholder":170},true,"\n",[31,173,175,178,182],{"class":33,"line":174},11,[31,176,177],{"class":37},"class",[31,179,181],{"class":180},"sC09Y"," b",[31,183,50],{"class":49},[31,185,187,190,192],{"class":33,"line":186},12,[31,188,57],{"class":189},"sz0mV",[31,191,46],{"class":45},[31,193,194],{"class":64}," 3\n",[31,196,198],{"class":33,"line":197},13,[31,199,171],{"emptyLinePlaceholder":170},[31,201,203,205,207,209],{"class":33,"line":202},14,[31,204,75],{"class":74},[31,206,46],{"class":45},[31,208,80],{"class":37},[31,210,83],{"class":49},[31,212,214,216,218,220,222,224,226,228],{"class":33,"line":213},15,[31,215,90],{"class":89},[31,217,93],{"class":49},[31,219,96],{"class":74},[31,221,99],{"class":49},[31,223,103],{"class":102},[31,225,93],{"class":49},[31,227,108],{"class":56},[31,229,111],{"class":49},[31,231,233],{"class":33,"line":232},16,[31,234,158],{"class":49},[31,236,238],{"class":33,"line":237},17,[31,239,171],{"emptyLinePlaceholder":170},[31,241,243,245,247,249,251],{"class":33,"line":242},18,[31,244,123],{"class":74},[31,246,46],{"class":45},[31,248,128],{"class":49},[31,250,131],{"class":37},[31,252,50],{"class":49},[31,254,256,258,260,262,264,266,268,270],{"class":33,"line":255},19,[31,257,90],{"class":89},[31,259,93],{"class":49},[31,261,96],{"class":74},[31,263,99],{"class":49},[31,265,103],{"class":102},[31,267,93],{"class":49},[31,269,108],{"class":56},[31,271,111],{"class":49},[31,273,275],{"class":33,"line":274},20,[31,276,158],{"class":49},[31,278,280],{"class":33,"line":279},21,[31,281,164],{"class":49},[31,283,285],{"class":33,"line":284},22,[31,286,171],{"emptyLinePlaceholder":170},[31,288,290,293,295,298],{"class":33,"line":289},23,[31,291,292],{"class":89},"a",[31,294,93],{"class":49},[31,296,297],{"class":74},"u1",[31,299,300],{"class":49},"()\n",[31,302,304],{"class":33,"line":303},24,[31,305,307],{"class":306},"sW2Sy","// 3\n",[31,309,311,313,315,318],{"class":33,"line":310},25,[31,312,292],{"class":89},[31,314,93],{"class":49},[31,316,317],{"class":74},"u2",[31,319,300],{"class":49},[31,321,323],{"class":33,"line":322},26,[31,324,325],{"class":306},"// undefined\n",[31,327,329],{"class":33,"line":328},27,[31,330,171],{"emptyLinePlaceholder":170},[31,332,334,337,339,342,344],{"class":33,"line":333},28,[31,335,336],{"class":37},"new",[31,338,181],{"class":74},[31,340,341],{"class":49},"().",[31,343,297],{"class":74},[31,345,300],{"class":49},[31,347,349],{"class":33,"line":348},29,[31,350,307],{"class":306},[31,352,354,356,358,360,362],{"class":33,"line":353},30,[31,355,336],{"class":37},[31,357,181],{"class":74},[31,359,341],{"class":49},[31,361,317],{"class":74},[31,363,300],{"class":49},[31,365,367],{"class":33,"line":366},31,[31,368,307],{"class":306},[13,370,371],{},"这个问题涉及到 JavaScript 中箭头函数的作用域以及 this 指向。",[13,373,374,375,378],{},"**在 JS 中使用 function 关键字定义的普通函数中，this 指针遵循一个规则：谁调用指向谁。**即 ",[17,376,377],{},"obj.func()"," 这种调用情况下，func 方法内部的this指向obj；如果没有调用者，则严格模式下 this 为 undefined，非严格模式下 this 指向window(浏览器)或者global(node环境)。",[13,380,381,382],{},"而箭头函数比较特殊，",[383,384,385],"strong",{},"箭头函数的 this 在定义时就被绑定，绑定的是定义时所在作用域中的 this。",[13,387,388,389,392,393,396],{},"在老师给的示例代码中，第一行定义了 a 这个对象字面量，而",[383,390,391],{},"定义对象字面量不会创建新的作用域","，因此 a 中定义的 u2 的 this 指向的是全局对象。因此在 Es Module 默认启用 strict mode 的情况下，全局对象的 this 指向 undefined，进而导致 a 的 u2 内 this 也指向 undefined，this.x 就抛了 TypeError；而在 ",[383,394,395],{},"CommonJS 未启用 strict mode 的情况下，全局对象的 this 指向全局对象","，因而 u2 内的 this 也指向全局对象，因此 this 存在，this.x 就不会抛 TypeError，只会报 undefined。",[13,398,399],{},"而 B 类在对象初始化阶段拥有一个新的作用域，因此箭头函数的 this 能够正确指向 B 被实例化出来的对象，因此也就能够正确读取到 this.x 的值。",[13,401,402],{},"理论上来说，我们可以给全局对象也赋一个不一样的 x 值，这样 a.u2() 就能够读取到全局对象中的 x 值，验证我们的结论。",[13,404,405,406,409,410,413],{},"在浏览器中，可以在代码的头部加一行 ",[17,407,408],{},"var x = 10"," 或者 ",[17,411,412],{},"window.x = 10","，可以看到a.u2() 顺利的输出了 10，验证了我的结论。",[13,415,416],{},[417,418],"img",{"alt":419,"src":420},"浏览器控制台调试","https://static.031130.xyz/uploads/2024/08/12/65a2e1d093b78.webp",[13,422,423,424,409,426,429,430,432,433,436],{},"但在 Node.js 中，直接使用 ",[17,425,408],{},[17,427,428],{},"global.x = 10"," 并不能达到我们想要的效果。因为Node.js 中的每个 CommonJS 模块都有其自己的模块作用域，即模块的顶层作用域不是全局作用域。在模块内部，",[17,431,103],{}," 关键字不是指向 ",[17,434,435],{},"global"," 对象，而是指向模块的导出对象。这是为了确保模块内部的作用域隔离和模块的封装性。",[13,438,439,440,443],{},"那么我们可以通过为模块的导出对象添加一个 x 属性来验证我们的结论，我们可以使用 ",[17,441,442],{},"exports.x = 10"," 来为模块的顶层作用域添加一个值为 10 的 x 属性。",[13,445,446],{},[417,447],{"alt":448,"src":449},"nodejs 环境运行","https://static.031130.xyz/uploads/2024/08/12/65a2e379ba89e.webp",[451,452,453],"h2",{"id":453},"参考文章",[13,455,456],{},[292,457,461],{"href":458,"rel":459},"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Functions/Arrow_functions",[460],"nofollow","箭头函数表达式 - JavaScript | MDN",[13,463,464],{},[292,465,468],{"href":466,"rel":467},"https://segmentfault.com/q/1010000022948115",[460],"ES6箭头函数作用域的问题",[13,470,471],{},[292,472,475],{"href":473,"rel":474},"https://www.zhihu.com/tardis/zm/art/57204184",[460],"ES6箭头函数的this指向详解",[477,478,479],"style",{},"html pre.shiki code .sLKXg, html code.shiki .sLKXg{--shiki-default:#A626A4;--shiki-dark:#C678DD}html pre.shiki code .sNmU0, html code.shiki .sNmU0{--shiki-default:#986801;--shiki-dark:#E5C07B}html pre.shiki code .s_Sar, html code.shiki .s_Sar{--shiki-default:#0184BC;--shiki-dark:#56B6C2}html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html pre.shiki code .sJa8x, html code.shiki .sJa8x{--shiki-default:#E45649;--shiki-dark:#E06C75}html pre.shiki code .st7oF, html code.shiki .st7oF{--shiki-default:#0184BC;--shiki-dark:#ABB2BF}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .s7GmK, html code.shiki .s7GmK{--shiki-default:#383A42;--shiki-dark:#E5C07B}html pre.shiki code .s2QsP, html code.shiki .s2QsP{--shiki-default:#E45649;--shiki-dark:#E5C07B}html pre.shiki code .sC09Y, html code.shiki .sC09Y{--shiki-default:#C18401;--shiki-dark:#E5C07B}html pre.shiki code .sz0mV, html code.shiki .sz0mV{--shiki-default:#383A42;--shiki-dark:#E06C75}html pre.shiki code .sW2Sy, html code.shiki .sW2Sy{--shiki-default:#A0A1A7;--shiki-default-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}",{"title":27,"searchDepth":53,"depth":53,"links":481},[482],{"id":453,"depth":53,"text":453},"这学期期末复习的时候，学校里负责上 JavaScript 的老师给我们提出了一个问题。下面这段代码中，a.u2() 在 ES Module 下执行会抛出 TypeError 的异常，在 CommonJS 下运行则会输出 undefined，而 B 这个类的 u2 函数则能够在对象实例化以后正常运行。",[485,491],{"title":486,"path":487,"stem":488,"date":489,"lang":490,"children":-1},"备份 umami 数据库，并使用 TG Bot 保存 dump 文件","/2024/02/01/backup-umami-database-and-send-it-by-tg-bot","posts/zh/backup-umami-database-and-send-it-by-tg-bot","2024-02-01 00:00:01","zh-CN",{"title":492,"path":493,"stem":494,"date":495,"lang":490,"children":-1},"结合 Vue.js 与 php 完成的 web 期末大作业，讲讲前后端分离站点开发与部署中可能遇到的 CORS 跨域问题","/2024/01/10/cors-when-using-splited-frontend-and-backend","posts/zh/cors-when-using-splited-frontend-and-backend","2024-01-10 23:55:36",null,1766435594282]
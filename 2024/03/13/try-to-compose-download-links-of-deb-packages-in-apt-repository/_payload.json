[{"data":1,"prerenderedAt":268},["ShallowReactive",2],{"post-2024-03-13-try-to-compose-download-links-of-deb-packages-in-apt-repository-zh":3,"surround-2024-03-13-try-to-compose-download-links-of-deb-packages-in-apt-repository-zh":255,"randomIndex/2024/03/13/try-to-compose-download-links-of-deb-packages-in-apt-repository/":196,"language-switch-/2024/03/13/try-to-compose-download-links-of-deb-packages-in-apt-repository/-en":267},{"title":4,"date":5,"path":6,"tags":7,"body":11,"description":17},"小记 - 尝试拼凑出 apt 仓库中的 deb 包下载地址","2024-03-13 21:55:04","/2024/03/13/try-to-compose-download-links-of-deb-packages-in-apt-repository",[8,9,10],"Linux","Apt","deepin",{"type":12,"value":13,"toc":252},"minimark",[14,18,29,32,35,42,50,53,56,64,80,149,156,162,173,179,182,185,222,228,239,242,248],[15,16,17],"p",{},"大概一周前，有一个来源不明的 Linux 微信，从包的结构来看是基于 qt 实现的图形化界面，deb 包中的 control 信息表明是腾讯团队官方出品的。今天听人说 UOS 的商店上架了最新的微信，便尝试从 UOS 的官方仓库提取下载链接，帮助 AUR Maintainer 获取到新的地址。",[15,19,20,21,28],{},"在我的",[22,23,27],"a",{"href":24,"rel":25},"https://zhul.in/2021/11/20/what-is-deepin-elf-verify/",[26],"nofollow","《deepin-elf-verify究竟是何物？》","这篇文章中，我成功从 uos.deepin.cn 下载到了来自 UOS 中的软件包。可惜，当我采用同样的方法搜索 weixin 或者 wechat 字样时，没有得到任何结果。",[15,30,31],{},"UOS 上的软件来源起码来自两个仓库，一个是与系统有关的软件，比如 Linux Kernel，GCC 一类开源软件，应该就是来自我之前下载到 deepin-elf-verify 的那个源。除此之外，还有一个 appstore 源，里面存放的都是应用商店中上架的软件（大部分可能是闭源的）。",[15,33,34],{},"在 chinauos.com 下载到最新的 ISO 安装镜像后，直接在虚拟机中走完正常的安装流畅，然后直捣黄龙。",[15,36,37],{},[38,39],"img",{"alt":40,"src":41},"源地址","https://static.031130.xyz/uploads/2024/08/12/65f1b344e5581.webp",[15,43,44,45,49],{},"可以看出，",[46,47,48],"code",{},"/etc/apt/sources.list.d/appstore.list"," 文件中列出的源很有可能就是我们要找的新版微信的所在源。",[15,51,52],{},"可惜直接访问的时候，源地址给出了 403。他们似乎不愿意公开源地址的 filelist index。",[15,54,55],{},"不过没关系，既然 UOS Desktop 目前仍然依赖 APT 实现软件安装，那它的源应该仍然符合 Debian 的 APT Repository 目录结构。",[15,57,58,59],{},"根据 ",[22,60,63],{"href":61,"rel":62},"https://wiki.debian.org/DebianRepository/Format",[26],"DebianWiki 中的描述",[65,66,67,70],"blockquote",{},[15,68,69],{},"gives an example:",[71,72,77],"pre",{"className":73,"code":75,"language":76},[74],"language-text","deb https://deb.debian.org/debian stable main contrib non-free\n","text",[46,78,75],{"__ignoreMap":79},"",[65,81,82,85,103,136],{},[15,83,84],{},"An archive can have either source packages or binary packages or both but they have to be specified separately to apt.",[15,86,87,88,94,95,98,99,102],{},"The uri, in this case ",[89,90,91],"em",{},[46,92,93],{},"https://deb.debian.org/debian"," specifies the root of the archive. Often Debian archives are in the ",[89,96,97],{},"debian/"," directory on the server but can be anywhere else (many mirrors for example have it in a ",[89,100,101],{},"pub/linux/debian"," directory, for example).",[15,104,105,106,109,110,114,115,118,119,122,123,126,127,130,131],{},"The distribution part (",[89,107,108],{},"stable"," in this case) specifies a subdirectory in ",[111,112,113],"strong",{},"$ARCHIVE_ROOT/dists",". It can contain additional slashes to specify subdirectories nested deeper, eg. ",[89,116,117],{},"stable/updates",". distribution typically corresponds to ",[111,120,121],{},"Suite"," or ",[111,124,125],{},"Codename"," specified in the ",[111,128,129],{},"Release"," files. ",[89,132,133],{},[111,134,135],{},"FIXME is this enforced anyhow?",[15,137,138,139,122,142,144,145,148],{},"To download packages from a repository apt would download an ",[111,140,141],{},"InRelease",[111,143,129],{}," file from the ",[111,146,147],{},"$ARCHIVE_ROOT/dists/$DISTRIBUTION"," directory.",[15,150,151,152,155],{},"我尝试了访问 ",[46,153,154],{},"https://pro-store-packages.uniontech.com/appstore/dists/eagle-pro/Release","，获得了一系列索引文件的索引。",[15,157,158],{},[38,159],{"alt":160,"src":161},"索引的索引（很拗口）","https://static.031130.xyz/uploads/2024/08/12/65f1b5166810a.webp",[15,163,164,165,168,169],{},"第一段中就能看到熟悉的 ",[46,166,167],{},"Packages"," 文件。根据我 deepin-elf-verify 相关博客中记载，这个文件中会保存 deb 文件的相对路径。我们先拼出 amd64 架构的 Packages 文件下载链接: ",[22,170,171],{"href":171,"rel":172},"https://pro-store-packages.uniontech.com/appstore/dists/eagle-pro/appstore/binary-amd64/Packages",[26],[15,174,175],{},[38,176],{"alt":177,"src":178},"deb 包详细信息","https://static.031130.xyz/uploads/2024/08/12/65f1b5faccc86.webp",[15,180,181],{},"这里可以看到源中每一个 deb 包的信息。图中红色方框框出的便是其中一个 deb 包在源中的相对路径。",[15,183,184],{},"我们可以使用 grep 命令去检索 weixin 或者 wechat 关键词",[71,186,190],{"className":187,"code":188,"language":189,"meta":79,"style":79},"language-bash shiki shiki-themes one-light one-dark-pro","curl -sL https://pro-store-packages.uniontech.com/appstore/dists/eagle-pro/appstore/binary-amd64/Packages | grep -E \"weixin|wechat\"\n","bash",[46,191,192],{"__ignoreMap":79},[193,194,197,201,205,209,213,216,219],"span",{"class":195,"line":196},"line",1,[193,198,200],{"class":199},"sAdtL","curl",[193,202,204],{"class":203},"sAGMh"," -sL",[193,206,208],{"class":207},"sDhpE"," https://pro-store-packages.uniontech.com/appstore/dists/eagle-pro/appstore/binary-amd64/Packages",[193,210,212],{"class":211},"s5ixo"," | ",[193,214,215],{"class":199},"grep",[193,217,218],{"class":203}," -E",[193,220,221],{"class":207}," \"weixin|wechat\"\n",[15,223,224],{},[38,225],{"alt":226,"src":227},"获取到我们想要的 deb 包的相对路径","https://static.031130.xyz/uploads/2024/08/12/65f1b6a4c3239.webp",[15,229,230,231,234,235],{},"在这个路径前加上之前 ",[46,232,233],{},"appstore.list"," 文件中给出的 url 前缀，即可拼凑出 deb 包的完整下载地址: ",[22,236,237],{"href":237,"rel":238},"https://pro-store-packages.uniontech.com/appstore/pool/appstore/c/com.tencent.wechat/com.tencent.wechat_1.0.0.236_amd64.deb",[26],[15,240,241],{},"放到浏览器中尝试，果然可以正常下载",[15,243,244],{},[38,245],{"alt":246,"src":247},"正常下载","https://static.031130.xyz/uploads/2024/08/12/65f1b73567121.webp",[249,250,251],"style",{},"html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}",{"title":79,"searchDepth":253,"depth":253,"links":254},2,[],[256,262],{"title":257,"path":258,"stem":259,"date":260,"lang":261,"children":-1},"uniapp 中的图片预加载","/2024/04/01/image-preload-in-uniapp","posts/zh/image-preload-in-uniapp","2024-04-01 05:31:25","zh-CN",{"title":263,"path":264,"stem":265,"date":266,"lang":261,"children":-1},"在 Linux 下使用 mitmproxy 抓取 HTTPS 流量","/2024/02/29/capture-https-traffic-on-linux-with-mitmproxy","posts/zh/capture-https-traffic-on-linux-with-mitmproxy","2024-02-29 22:03:58",null,1765307270143]
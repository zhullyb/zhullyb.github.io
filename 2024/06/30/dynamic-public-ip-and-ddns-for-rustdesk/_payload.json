[{"data":1,"prerenderedAt":194},["ShallowReactive",2],{"post-2024-06-30-dynamic-public-ip-and-ddns-for-rustdesk-zh":3,"surround-2024-06-30-dynamic-public-ip-and-ddns-for-rustdesk-zh":180,"randomIndex/2024/06/30/dynamic-public-ip-and-ddns-for-rustdesk/":192,"language-switch-/2024/06/30/dynamic-public-ip-and-ddns-for-rustdesk/-en":193},{"title":4,"date":5,"path":6,"tags":7,"body":14,"description":20},"使用动态公网 ip + ddns 实现 rustdesk 的 ip 直连","2024-06-30 18:15:00","/2024/06/30/dynamic-public-ip-and-ddns-for-rustdesk",[8,9,10,11,12,13],"Linux","OpenSource Project","Shell Script","Rustdesk","Router","HomeServer",{"type":15,"value":16,"toc":173},"minimark",[17,21,24,27,32,35,38,45,48,65,126,129,132,135,138,143,146,151,158,161,164,169],[18,19,20],"p",{},"最近跟风整了一台 n100 的迷你主机装了个 Archlinux 当 HomeServer，搭配上了显卡欺骗器，平常一直远程使用，因此需要实现稳定的远程桌面连接。开源软件 Rustdesk 本身对 Linux 的适配尚可，可惜官方提供的服务器位于境外，且前一阵子因为诈骗相关的风波使得官方对连接做出了一些限制，应当使用自建服务器或者 ip 直连。",[18,22,23],{},"单从网络安全的角度出发，最佳实践应该是通过 wireguard 或者别的协议先接入局域网，然后使用局域网内的 ip 直连，这是最稳妥的，但我有点懒，而且我可能会在多个设备上都有控制 HomeServer 的需求，给所有设备配置 wireguard 是一件挺麻烦的事情，因此我决定放弃安全性，直接公网裸奔。",[18,25,26],{},"在学校宿舍的电信宽带提供了一个动态公网 ip，因此只需要设置好 ddns 和端口转发就可以拿到一个固定的 domain + port 提供给 rustdesk 直连。",[28,29,31],"h2",{"id":30},"在被控端-rustdesk-允许直连访问","在被控端 Rustdesk 允许直连访问",[18,33,34],{},"在「设置」中的「安全」一栏选择「解锁安全设置」，拉到最下面的「安全」栏，勾选「允许 IP 直接访问」，并选择一个端口，范围在 1000 ~35535 之间且不要被本地的其他程序占用，Rustdesk 的默认值为 21118。",[18,36,37],{},"可以直接在局域网内的另一台设备进行测试，直接在 Rustdesk 中输入被控端的局域网 ip 和刚刚设置的端口，看看能不能访问得通，如果不行可能需要排查一下被控端访问墙设置的问题。",[18,39,40],{},[41,42],"img",{"alt":43,"src":44},"","https://static.031130.xyz/uploads/2024/08/12/66814701cf7ce.webp",[28,46,47],{"id":47},"ddns",[18,49,50,51,58,59,64],{},"由于我的域名是交给 cloudflare 进行解析的，就找了个",[52,53,57],"a",{"href":54,"rel":55},"https://github.com/yulewang/cloudflare-api-v4-ddns/",[56],"nofollow","支持 cloudflare 的 ddns 脚本","，大致的部署过程可以参考 ",[52,60,63],{"href":61,"rel":62},"https://www.rclogs.com/2023/06/%25e8%2587%25aa%25e5%25bb%25ba%25e5%259f%25ba%25e4%25ba%258ecloudflare%25e7%259a%2584ddns",[56],"「自建基于Cloudflare的DDNS」","，不过我小改了一下脚本中获取公网 ipv4 的方式，直接 ssh 到路由器上获取当前的 ipv4 地址，不依赖外部的服务。",[66,67,71],"pre",{"className":68,"code":69,"language":70,"meta":43,"style":43},"language-bash shiki shiki-themes one-light one-dark-pro","WAN_IP=`ssh -o HostKeyAlgorithms=+ssh-rsa -o PubkeyAcceptedKeyTypes=+ssh-rsa root@192.168.1.1 'ip -br a' | grep pppoe-wan | awk '{print $3}'`\n","bash",[72,73,74],"code",{"__ignoreMap":43},[75,76,79,83,87,91,95,99,102,105,108,112,115,118,120,123],"span",{"class":77,"line":78},"line",1,[75,80,82],{"class":81},"sJa8x","WAN_IP",[75,84,86],{"class":85},"sknuh","=",[75,88,90],{"class":89},"sDhpE","`",[75,92,94],{"class":93},"sAdtL","ssh",[75,96,98],{"class":97},"sAGMh"," -o",[75,100,101],{"class":89}," HostKeyAlgorithms=+ssh-rsa ",[75,103,104],{"class":97},"-o",[75,106,107],{"class":89}," PubkeyAcceptedKeyTypes=+ssh-rsa root@192.168.1.1 'ip -br a' ",[75,109,111],{"class":110},"s5ixo","|",[75,113,114],{"class":93}," grep",[75,116,117],{"class":89}," pppoe-wan ",[75,119,111],{"class":110},[75,121,122],{"class":93}," awk",[75,124,125],{"class":89}," '{print $3}'`\n",[18,127,128],{},"理论上来说，有不少路由器自身就支持不少域名解析商",[28,130,131],{"id":131},"端口转发",[18,133,134],{},"端口转发需要在路由器的后台设置进行，我这里路由器使用的是 openwrt 系统，大部分路由器应该都支持这个操作。",[18,136,137],{},"在「网络」-「防火墙」",[18,139,140],{},[41,141],{"alt":43,"src":142},"https://static.031130.xyz/uploads/2024/08/12/6681635804e68.webp",[18,144,145],{},"选择「端口转发」",[18,147,148],{},[41,149],{"alt":43,"src":150},"https://static.031130.xyz/uploads/2024/08/12/66817e416534c.webp",[18,152,153,154,157],{},"新建端口转发，共享名随便填，外部端口是你最终要在主控端输入的端口，内部 IP 地址是被控机 的 IP 地址，可以用 ",[72,155,156],{},"ip -br a"," 命令看到，内部端口就是上文在 Rustdesk 指定的端口号。",[28,159,160],{"id":160},"效果",[18,162,163],{},"可以直接在主控端口输入 ddns 的域名和端口号，实现远程控制",[18,165,166],{},[41,167],{"alt":43,"src":168},"https://static.031130.xyz/uploads/2024/08/12/66817f77aae7e.webp",[170,171,172],"style",{},"html pre.shiki code .sJa8x, html code.shiki .sJa8x{--shiki-default:#E45649;--shiki-dark:#E06C75}html pre.shiki code .sknuh, html code.shiki .sknuh{--shiki-default:#383A42;--shiki-dark:#56B6C2}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}",{"title":43,"searchDepth":174,"depth":174,"links":175},2,[176,177,178,179],{"id":30,"depth":174,"text":31},{"id":47,"depth":174,"text":47},{"id":131,"depth":174,"text":131},{"id":160,"depth":174,"text":160},[181,187],{"title":182,"path":183,"stem":184,"date":185,"lang":186,"children":-1},"在 Arch Linux 下配置使用 HP Laser 103w 打印机无线打印","/2024/07/14/config-hp-laser-103w-printer-for-archlinux","posts/zh/config-hp-laser-103w-printer-for-archlinux","2024-07-14 18:30:33","zh-CN",{"title":188,"path":189,"stem":190,"date":191,"lang":186,"children":-1},"使用 Windows 虚拟机运行虚拟专用网客户端为 Linux 提供内网环境","/2024/05/23/setup-network-environment-for-non-linux-vpn-client-with-virtual-machine","posts/zh/setup-network-environment-for-non-linux-vpn-client-with-virtual-machine","2024-05-23 01:07:44",9,null,1766532344321]
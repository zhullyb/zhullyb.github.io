<!DOCTYPE html><html  lang="zh-CN"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>构建部署在 Cloudflare Workers 上的 TG Bot | 竹林里有冰的博客</title><link rel="stylesheet" href="https://static.031130.xyz/res/github-markdown.css"><style>[data-v-483530c4] .markdown-body h2,[data-v-483530c4] .markdown-body h3,[data-v-483530c4] .markdown-body h4,[data-v-483530c4] .markdown-body h5,[data-v-483530c4] .markdown-body h6{scroll-margin-top:78px}[data-v-483530c4] .markdown-body h2>a,[data-v-483530c4] .markdown-body h3>a,[data-v-483530c4] .markdown-body h4>a,[data-v-483530c4] .markdown-body h5>a,[data-v-483530c4] .markdown-body h6>a{color:unset}@media(prefers-color-scheme:dark){[data-v-483530c4] .markdown-body{--bgColor-default:#252d38;--bgColor-muted:#181c27}[data-v-483530c4] .markdown-body .shiki,[data-v-483530c4] .markdown-body .shiki span{color:var(--shiki-dark)!important}}aside[data-v-483530c4]{position:sticky;top:78px}[data-v-483530c4] #waline{margin-top:3rem}</style><style>.content-wrapper[data-v-03b6b78b]{margin-bottom:40px;margin-top:40px}@media(min-width:769px){.content-wrapper[data-v-03b6b78b]{display:flex;justify-content:space-around}.content-wrapper .side[data-v-03b6b78b]{width:20%}}@media(max-width:768px){.content-wrapper[data-v-03b6b78b]{margin:30px}}main[data-v-03b6b78b]{min-height:calc(40vh - 120px);width:50%}@media(max-width:1024px){main[data-v-03b6b78b]{width:75%}}@media(max-width:768px){main[data-v-03b6b78b]{width:unset}}</style><style>header[data-v-995e7b74]{align-items:center;box-shadow:0 2px 4px #0000001a;display:flex;flex-direction:column;height:62px;justify-content:center;padding-bottom:16px;padding-top:20px;position:fixed;top:0;transition:all .3s ease;-webkit-user-select:none;-moz-user-select:none;user-select:none;width:100%;z-index:2}header.scrolled[data-v-995e7b74]{height:58px;padding-bottom:16px;padding-top:16px}header.scrolled[data-v-995e7b74],header.show-mobile-menu[data-v-995e7b74]{-webkit-backdrop-filter:blur(3px);backdrop-filter:blur(3px);background-color:#3c4658b3}header.show-mobile-menu[data-v-995e7b74]{height:-moz-fit-content;height:fit-content}.header-container[data-v-995e7b74]{color:#fff;min-width:70%}@media(max-width:1024px){.header-container[data-v-995e7b74]{min-width:75%;padding-left:16px;padding-right:16px}}@media(max-width:768px){.header-container[data-v-995e7b74]{min-width:100%}}.header-container .header-title[data-v-995e7b74]{font-weight:700;text-shadow:0 0 10px rgba(0,0,0,.3)}.header[data-v-995e7b74]{justify-content:space-between}.header[data-v-995e7b74],.header-right[data-v-995e7b74]{align-items:center;display:flex}.header-right[data-v-995e7b74]{gap:16px}.mobile-menu-dropdown[data-v-995e7b74]{border-radius:8px;display:flex;flex-direction:column;padding:8px 0;width:100%}.mobile-menu-dropdown a[data-v-995e7b74]{font-size:18px;font-weight:500;padding:12px 24px;text-align:center}.mobile-menu-dropdown a[data-v-995e7b74],a[data-v-995e7b74]{color:#fff;text-decoration:none}.search-trigger[data-v-995e7b74]{align-items:center;background:#ffffff1a;border:1px solid hsla(0,0%,100%,.3);border-radius:999px;color:#fff;cursor:pointer;display:flex;font-size:14px;gap:6px;padding:6px 12px;transition:background .2s ease,border-color .2s ease}.search-trigger[data-v-995e7b74]:hover{background:#fff3;border-color:#fff9}.search-trigger span[aria-hidden=true][data-v-995e7b74]{font-size:16px;line-height:1}@media(max-width:768px){.search-trigger .search-trigger__label[data-v-995e7b74]{display:none}}</style><style>@media(max-width:768px){.pc-nav[data-v-f0d77200]{display:none}}.mobile-nav[data-v-f0d77200]{cursor:pointer;display:none}@media(max-width:768px){.mobile-nav[data-v-f0d77200]{align-items:center;display:flex;justify-content:center}}.mobile-nav .container[data-v-f0d77200]{align-items:center;display:flex;flex-direction:column;height:20px;justify-content:center;margin:0 auto;width:25px}.mobile-nav-item[data-v-f0d77200]{background:#fff;border-radius:2px;flex-shrink:0;height:2px;margin:2.5px 0;width:100%}a[data-v-f0d77200]{color:#fff;margin-left:16px;margin-right:16px;text-decoration:none}</style><style>.banner[data-v-3b68dcd7]{height:60vh;width:100%}.mask[data-v-3b68dcd7]{align-items:center;background:#0000001a;display:flex;height:100%;justify-content:center;width:100%}@media(prefers-color-scheme:dark){.mask[data-v-3b68dcd7]{background:#00000080}}.title-container[data-v-3b68dcd7]{align-items:center;color:#fff;display:flex;height:100%;justify-content:center;margin:auto;width:50%}@media(max-width:768px){.title-container[data-v-3b68dcd7]{width:80%}}.title[data-v-3b68dcd7]{color:#fff;margin:auto auto auto 0;padding-top:58px;text-shadow:0 0 5px rgba(0,0,0,.7)}.title h1[data-v-3b68dcd7]{font-size:32px;font-weight:700;margin:0}.title p[data-v-3b68dcd7]{font-size:16px;font-weight:300;margin:8px 0}@media(max-width:768px){.title[data-v-3b68dcd7]{margin:auto;text-align:center}}</style><style>.search-overlay-enter-active[data-v-62b29045],.search-overlay-leave-active[data-v-62b29045]{transition:opacity .2s ease}.search-overlay-enter-from[data-v-62b29045],.search-overlay-leave-to[data-v-62b29045]{opacity:0}.search-overlay[data-v-62b29045]{align-items:flex-start;-webkit-backdrop-filter:blur(2px);backdrop-filter:blur(2px);background:#00000059;display:flex;justify-content:center;inset:0;padding:120px 16px 40px;position:fixed;z-index:2000}.search-overlay__panel[data-v-62b29045]{background:#fffffff2;box-shadow:0 18px 50px #00000040;display:flex;flex-direction:column;max-height:calc(100vh - 160px);overflow:hidden;width:min(720px,100%)}.search-overlay__header[data-v-62b29045]{align-items:center;border-bottom:1px solid rgba(0,0,0,.05);display:flex;gap:12px;padding:16px 20px 16px 16px}.search-overlay__input[data-v-62b29045]{background:#ffffffd9;border:1px solid rgba(0,0,0,.12);flex:1;font-size:16px;padding:12px 16px;transition:border-color .2s ease}.search-overlay__input[data-v-62b29045]:focus{border-color:#007bff;outline:none}.search-overlay__close[data-v-62b29045]{background:transparent;border:none;border-radius:50%;color:#0000008c;cursor:pointer;font-size:24px;height:32px;line-height:24px;width:32px}.search-overlay__close[data-v-62b29045]:hover{color:#000c}.search-overlay__body[data-v-62b29045]{overflow-y:auto;padding:8px 0 20px}.search-overlay__state[data-v-62b29045]{color:#00000094;margin:20px;text-align:center}.search-overlay__count[data-v-62b29045]{color:#000000b3;font-weight:600;margin:12px 24px 0}.search-overlay__list[data-v-62b29045]{display:flex;flex-direction:column;gap:12px;list-style:none;margin:16px 0 0;padding:0 8px 8px}.search-overlay__item[data-v-62b29045]{background:#ffffffe6;border-radius:12px;box-shadow:0 8px 18px #00000014;transition:transform .2s ease}.search-overlay__item[data-v-62b29045]:hover{transform:translateY(-2px)}.search-overlay__link[data-v-62b29045]{color:inherit;display:block;padding:16px 20px;text-decoration:none}.search-overlay__item-title[data-v-62b29045]{color:#007bff;font-size:18px;font-weight:700;margin:0}.search-overlay__item-meta[data-v-62b29045]{color:#0009;font-size:13px;margin:8px 0 0}.search-overlay__item-meta span[data-v-62b29045]{color:#0000008c}.search-overlay__item-snippet[data-v-62b29045]{color:#000c;font-size:14px;line-height:1.6;margin:12px 0 0}@media(max-width:768px){.search-overlay[data-v-62b29045]{padding:80px 12px 20px}.search-overlay__panel[data-v-62b29045]{max-height:calc(100vh - 120px)}}</style><style>.post-navigation[data-v-27f76087]{display:flex;flex-wrap:wrap;gap:1rem}.nav-button[data-v-27f76087]{align-items:center;border:1px solid #e1e4e8;color:#24292e;cursor:pointer;display:flex;flex:0 1 calc(50% - .5rem);gap:1rem;max-width:calc(50% - .5rem);min-width:280px;padding:1.25rem 1.5rem;text-decoration:none;transition:border-color .2s ease}@media(prefers-color-scheme:dark){.nav-button[data-v-27f76087]{border:1px solid #444c5a;color:#c9d1d9}}.nav-button[data-v-27f76087]:hover{border-color:#007bff}.nav-button:hover .nav-title[data-v-27f76087]{color:#007bff}.nav-button.prev[data-v-27f76087]{margin-right:auto}.nav-button.prev .nav-content[data-v-27f76087]{text-align:left}.nav-button.next[data-v-27f76087]{flex-direction:row-reverse;margin-left:auto}.nav-button.next .nav-content[data-v-27f76087]{text-align:right}.nav-arrow[data-v-27f76087]{color:#6a737d;flex-shrink:0;font-size:1.5rem;font-weight:600;line-height:1}.nav-content[data-v-27f76087]{display:flex;flex:1;flex-direction:column;gap:.5rem;min-width:0}.nav-label[data-v-27f76087]{color:#6a737d;font-size:.875rem;font-weight:500}.nav-title[data-v-27f76087]{display:-webkit-box;font-size:1rem;font-weight:600;-webkit-line-clamp:2;line-clamp:2;overflow:hidden;text-overflow:ellipsis;transition:color .2s ease;-webkit-box-orient:vertical;color:#24292e;line-height:1.4}@media(prefers-color-scheme:dark){.nav-title[data-v-27f76087]{color:#c9d1d9}}@media(max-width:768px){.post-navigation[data-v-27f76087]{flex-direction:column;gap:.75rem}.nav-button[data-v-27f76087]{min-width:100%}}</style><style>#waline{--waline-theme-color:#3f72af;--waline-active-color:#173f70}#waline .wl-panel{border:0;border-radius:0;margin:0}#waline .wl-btn{border-radius:0}</style><style>.toc[data-v-61bd12f2]{background:#fafafa;border:1px solid #e5e5e5;max-height:calc(100vh - 120px);overflow-y:auto;padding:1.25rem}@media(prefers-color-scheme:dark){.toc[data-v-61bd12f2]{background:#181c27;border:1px solid #444c5a}}@media(max-width:768px){.toc[data-v-61bd12f2]{display:none}}.toc-title[data-v-61bd12f2]{border-bottom:1px solid #e5e5e5;color:#333;font-size:1rem;font-weight:600;margin-bottom:1rem;padding-bottom:.5rem}@media(prefers-color-scheme:dark){.toc-title[data-v-61bd12f2]{border-bottom:1px solid #444c5a;color:#fff}}.toc-list[data-v-61bd12f2]{list-style:none;margin:0;padding:0}.toc-item[data-v-61bd12f2]{line-height:1.5;margin:.3rem 0;max-height:100px;opacity:1;overflow:hidden;transition:max-height .25s ease,opacity .25s ease,margin .25s ease}.toc-item.collapsed[data-v-61bd12f2]{margin:0;max-height:0;opacity:0}.toc-item a[data-v-61bd12f2]{color:#666;display:block;font-size:.875rem;padding:.35rem .5rem;text-decoration:none;transition:color .2s,background-color .2s}@media(prefers-color-scheme:dark){.toc-item a[data-v-61bd12f2]{color:#ccc}}.toc-item a[data-v-61bd12f2]:hover{background-color:#3b82f614;color:#007bff}.toc-item.active a[data-v-61bd12f2]{background-color:#3b82f61f;color:#007bff;font-weight:500}.toc-item.toc-level-1[data-v-61bd12f2]{padding-left:0}.toc-item.toc-level-1 a[data-v-61bd12f2]{font-weight:500}.toc-item.toc-level-2[data-v-61bd12f2]{padding-left:.75rem}.toc-item.toc-level-3[data-v-61bd12f2]{padding-left:1.5rem}.toc-item.toc-level-3 a[data-v-61bd12f2]{font-size:.85rem}.toc-item.toc-level-4[data-v-61bd12f2]{padding-left:2.25rem}.toc-item.toc-level-4 a[data-v-61bd12f2]{font-size:.825rem}.toc-item.toc-level-5[data-v-61bd12f2]{padding-left:3rem}.toc-item.toc-level-5 a[data-v-61bd12f2]{font-size:.8rem}.toc-item.toc-level-6[data-v-61bd12f2]{padding-left:3.75rem}.toc-item.toc-level-6 a[data-v-61bd12f2]{font-size:.775rem}.toc[data-v-61bd12f2]::-webkit-scrollbar{width:5px}.toc[data-v-61bd12f2]::-webkit-scrollbar-track{background:transparent}.toc[data-v-61bd12f2]::-webkit-scrollbar-thumb{background:#d1d5db}.toc[data-v-61bd12f2]::-webkit-scrollbar-thumb:hover{background:#9ca3af}</style><style>footer[data-v-75e9447f]{color:#fff;justify-content:center;position:relative;width:100%}.footer-content[data-v-75e9447f],footer[data-v-75e9447f]{align-items:center;display:flex}.footer-content[data-v-75e9447f]{flex-direction:column;gap:12px;padding:20px;z-index:1}.footer-mask[data-v-75e9447f]{background:linear-gradient(180deg,#0000004d,#00000080);inset:0;position:absolute}@media(prefers-color-scheme:dark){.footer-mask[data-v-75e9447f]{background:linear-gradient(180deg,#0009,#000c)}}</style><style>.prose-heading[data-v-a22a06c0]{position:relative}.prose-heading:hover .heading-anchor[data-v-a22a06c0]{opacity:1}.heading-anchor[data-v-a22a06c0]{color:#3b82f6;font-weight:400;margin-left:.5rem;opacity:0;text-decoration:none;transition:opacity .2s,color .2s}.heading-anchor[data-v-a22a06c0]:hover{color:#007bff}.anchor-icon[data-v-a22a06c0]{display:inline-block}.prose-h2[data-v-a22a06c0]{margin:1.75rem 0 .875rem}</style><style>.prose-heading[data-v-894c4550]{position:relative}.prose-heading:hover .heading-anchor[data-v-894c4550]{opacity:1}.heading-anchor[data-v-894c4550]{color:#3b82f6;font-weight:400;margin-left:.5rem;opacity:0;text-decoration:none;transition:opacity .2s,color .2s}.heading-anchor[data-v-894c4550]:hover{color:#007bff}.anchor-icon[data-v-894c4550]{display:inline-block}.prose-h3[data-v-894c4550]{margin:1.5rem 0 .75rem}</style><style>pre code .line{display:block}</style><style>.prose-img-wrapper[data-v-4f488808]{display:inline-block;position:relative}.prose-img[data-v-4f488808]{border-radius:4px;box-shadow:0 1px 4px #00000014;max-width:100%;transition:box-shadow .2s}.prose-img[data-v-4f488808]:hover{box-shadow:0 4px 16px #0000002e}.prose-img-caption[data-v-4f488808]{color:#666;display:block;font-size:.875rem;font-style:italic;margin-top:.25rem;text-align:center}.prose-img-preview-mask[data-v-4f488808]{align-items:center;animation:fadeIn-4f488808 .2s;background:#000000d9;display:flex;justify-content:center;inset:0;position:fixed;z-index:9999}.prose-img-preview-img[data-v-4f488808]{background:#fff;border-radius:8px;box-shadow:0 8px 32px #0006;max-height:90vh;max-width:90vw;will-change:transform}.prose-img-preview-img[data-v-4f488808],.prose-img-preview-scale-indicator[data-v-4f488808]{-webkit-user-select:none;-moz-user-select:none;user-select:none}.prose-img-preview-scale-indicator[data-v-4f488808]{background:#00000080;border-radius:4px;bottom:32px;color:#fff;font-size:1rem;left:50%;padding:2px 10px;pointer-events:none;position:absolute;transform:translate(-50%);z-index:10001}.prose-img-preview-close[data-v-4f488808]{background:none;border:none;color:#fff;cursor:pointer;font-size:2.5rem;line-height:1;padding:0 .5rem;position:absolute;right:48px;top:32px;transition:color .2s;z-index:10000}.prose-img-preview-close[data-v-4f488808]:hover{color:#ffb3b3}@keyframes fadeIn-4f488808{0%{opacity:0}to{opacity:1}}</style><link rel="stylesheet" href="/_nuxt/entry.Cb3Jctur.css" crossorigin><link rel="stylesheet" href="/_nuxt/DefaultLayout.CUcAcFaJ.css" crossorigin><link rel="preload" as="image" href="https://static.031130.xyz/uploads/2024/08/12/62f373292129a.webp" fetchpriority="high"><link rel="preload" as="fetch" crossorigin="anonymous" href="/2024/12/30/tg-bot-hosted-on-cloudflare-workers/_payload.json?59506ef7-936c-44e0-9177-6faed365eca0"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/6ChjxVS1.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/Dpdvy8qp.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/DFmXq_SX.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/xuhSpq13.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/pSBfBZDX.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/D2O0VX7l.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/Dw9FZWsg.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/CLREOrDA.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/CvI1cw0z.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/579mEZ-0.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/Dd1DfmCc.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/CLgJ0asj.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/CrxNXKqF.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/BhSseIkV.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/DgBICsdk.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/DvyIGPtM.js"><link rel="preload" as="fetch" fetchpriority="low" crossorigin="anonymous" href="/_nuxt/builds/meta/59506ef7-936c-44e0-9177-6faed365eca0.json"><script src="/js/u.js" defer data-website-id="5346b89b-f4bf-4593-971d-1f41a1118bc1"></script><link rel="alternate" type="application/atom+xml" title="竹林里有冰的博客 Atom Feed" href="https://zhul.in/rss.xml"><meta name="description" content><meta property="og:type" content="website"><meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1"><meta name="keywords" content="Bot,Cloudflare"><script type="module" src="/_nuxt/6ChjxVS1.js" crossorigin></script><meta name="twitter:card" content="summary_large_image"><meta property="og:title" data-infer="" content="构建部署在 Cloudflare Workers 上的 TG Bot | 竹林里有冰的博客"><meta property="og:description" data-infer="" content><link rel="canonical" href="https://zhul.in/2024/12/30/tg-bot-hosted-on-cloudflare-workers/"><meta property="og:url" content="https://zhul.in/2024/12/30/tg-bot-hosted-on-cloudflare-workers/"><meta property="og:locale" content="zh_CN"><meta property="og:site_name" content="竹林里有冰的博客"></head><body><!--teleport start anchor--><!----><!--teleport anchor--><!--teleport start anchor--><!----><!--teleport anchor--><!--teleport start anchor--><!----><!--teleport anchor--><div id="__nuxt"><!--[--><div></div><div data-v-483530c4 data-v-03b6b78b><!--[--><header class="" data-v-995e7b74><div class="header-container" data-v-995e7b74><div class="header" data-v-995e7b74><a href="/" class="header-title" data-v-995e7b74>竹林里有冰的博客</a><div class="header-right" data-v-995e7b74><nav data-v-995e7b74 data-v-f0d77200><div class="pc-nav" data-v-f0d77200><!--[--><a href="/" class="" data-v-f0d77200>首页</a><a href="/archives/" class="" data-v-f0d77200>归档</a><a href="/tags/" class="" data-v-f0d77200>标签</a><a href="/links/" class="" data-v-f0d77200>友链</a><a href="/about/" class="" data-v-f0d77200>关于</a><!--]--></div><div class="mobile-nav" data-v-f0d77200><div class="container" data-v-f0d77200><!--[--><div class="mobile-nav-item" data-v-f0d77200></div><div class="mobile-nav-item" data-v-f0d77200></div><div class="mobile-nav-item" data-v-f0d77200></div><!--]--></div></div></nav><button type="button" class="search-trigger" aria-label="搜索文章" data-v-995e7b74><span aria-hidden="true" data-v-995e7b74>🔍</span><span class="search-trigger__label" data-v-995e7b74>搜索</span></button></div></div></div><!----></header><div class="banner" style="background:url(https://static.031130.xyz/uploads/2024/08/12/62f3734fe20d3.webp) center center / cover no-repeat;" data-v-995e7b74 data-v-3b68dcd7><div class="mask" data-v-3b68dcd7><div class="title-container" data-v-3b68dcd7><div class="title" data-v-3b68dcd7><h1 data-v-3b68dcd7>构建部署在 Cloudflare Workers 上的 TG Bot</h1><!----></div></div></div></div><!--teleport start--><!--teleport end--><!--]--><div class="content-wrapper" data-v-03b6b78b><div class="before-main side" data-v-03b6b78b><!--[--><!--]--></div><main data-v-03b6b78b><!--[--><article class="markdown-body" data-v-483530c4><h2 id="起因" class="prose-heading prose-h2" data-v-a22a06c0><!--[-->起因<!--]--><a href="#起因" class="heading-anchor" aria-label="链接到此标题" data-v-a22a06c0><span class="anchor-icon" data-v-a22a06c0>#</span></a></h2><p><!--[-->早在去年 10 月，我就写过一篇<a href="/2023/10/29/create-b23tv-remover-bot/" class=""><!--[-->《创建 b23.tv 追踪参数移除 bot》<!--]--></a>。记录了部署 b23.tv 的追踪参数移除 Bot 的部署方案。其中提到的 TG Bot 随着服务器到期不再续费也一同落灰了——<strong><!--[-->公益服务总是这样，开始时满腔热血，随着时间散去没有多少人能坚持投入成本，徒留下一地鸡毛。<!--]--></strong><!--]--></p><p><!--[-->大概半个月前，我在群里看见 <a href="https://asukaminato.eu.org/" rel="nofollow"><!--[-->Asuka Minato<!--]--></a> 开发的群消息总结 Bot，整体部署在 Cloudflare Workers 上，在保证零运营成本的情况下有着相当非常不错的在线率保证，因此便考虑将这个 Bot 迁移到 Cloudflare Workers 上。<strong><!--[-->选用免费的 serverless 能够有效延长服务的可持续性，它不需要额外投入时间精力和财力进行维护，通常可以活很久。<!--]--></strong><!--]--></p><p><!--[-->之所以可以把 TG Bot 部署到 Cloudflare Workers 上，主要是得益于 TG 平台支持 webhook 的方式让 Bot 程序提供服务。我们所需要提供的是一个公网能访问的 http 地址，在成功注册 webhook 服务后，TG 的官方服务器会将所有 Bot 所在群或者和所有对个人的对话以 http 请求的方式打到这个 url 上，而 Cloudflare Workers 平台就能提供一个 workers.dev 结尾的公网 url 作为 webhook 提供给 TG 服务器。<!--]--></p><h2 id="怎么做" class="prose-heading prose-h2" data-v-a22a06c0><!--[-->怎么做？<!--]--><a href="#怎么做" class="heading-anchor" aria-label="链接到此标题" data-v-a22a06c0><span class="anchor-icon" data-v-a22a06c0>#</span></a></h2><p><!--[--><a href="https://github.com/cvzi/telegram-bot-cloudflare" rel="nofollow"><!--[-->在这个 Github 仓库中<!--]--></a>，给出了不少例子，用以讲述如何利用 Cloudflare Workers 构建 TG Bot。<!--]--></p><p><!--[-->在 <a href="https://github.com/cvzi/telegram-bot-cloudflare/blob/main/bot.js" rel="nofollow"><!--[-->bot.js<!--]--></a> 这个文件中编写了一个最简单的 TG Bot，其功能是: 将受到的所有消息在头部添加「Echo:」字符串，并发送回刚才的对话。<!--]--></p><p><!--[-->例: 用户发送 「Hello」，bot 回复 「Echo: Hello」<!--]--></p><hr><h2 id="代码分析" class="prose-heading prose-h2" data-v-a22a06c0><!--[-->代码分析<!--]--><a href="#代码分析" class="heading-anchor" aria-label="链接到此标题" data-v-a22a06c0><span class="anchor-icon" data-v-a22a06c0>#</span></a></h2><p><!--[-->代码整体分为四个部分<!--]--></p><h3 id="顶部变量" class="prose-heading prose-h3" data-v-894c4550><!--[-->顶部变量<!--]--><a href="#顶部变量" class="heading-anchor" aria-label="链接到此标题" data-v-894c4550><span class="anchor-icon" data-v-894c4550>#</span></a></h3><p><!--[-->文件顶部定义了 Bot 的 token、webhook 的 url 路径以及一个简易的 webhook 密码。<!--]--></p><p><!--[-->TOKEN 是从 botfather 那里获得的 bot token，SECRET 是自己设置的 webhook 密码，TG 的 webhook 服务器会通过把这个字段添加到名为 <code><!--[-->X-Telegram-Bot-Api-Secret-Token<!--]--></code> 的请求头中来证明自己的官方身份。<!--]--></p><pre class="language-javascript shiki shiki-themes one-light one-dark-pro" style=""><!--[--><code><span class="line" line="1"><span class="sLKXg">const</span><span class="sNmU0"> TOKEN</span><span class="s_Sar"> =</span><span class="sNmU0"> ENV_BOT_TOKEN</span><span class="sW2Sy"> // Get it from @BotFather https://core.telegram.org/bots#6-botfather
</span></span><span class="line" line="2"><span class="sLKXg">const</span><span class="sNmU0"> WEBHOOK</span><span class="s_Sar"> =</span><span class="sDhpE"> &#39;/endpoint&#39;
</span></span><span class="line" line="3"><span class="sLKXg">const</span><span class="sNmU0"> SECRET</span><span class="s_Sar"> =</span><span class="sNmU0"> ENV_BOT_SECRET</span><span class="sW2Sy"> // A-Z, a-z, 0-9, _ and -
</span></span></code><!--]--></pre><h3 id="简易路由" class="prose-heading prose-h3" data-v-894c4550><!--[-->简易路由<!--]--><a href="#简易路由" class="heading-anchor" aria-label="链接到此标题" data-v-894c4550><span class="anchor-icon" data-v-894c4550>#</span></a></h3><p><!--[-->紧接着定义了一个简易的路由<!--]--></p><pre class="language-javascript shiki shiki-themes one-light one-dark-pro" style=""><!--[--><code><span class="line" line="1"><span class="sAdtL">addEventListener</span><span class="s5ixo">(</span><span class="sDhpE">&#39;fetch&#39;</span><span class="s5ixo">, </span><span class="s8iYz">event</span><span class="sLKXg"> =&gt;</span><span class="s5ixo"> {
</span></span><span class="line" line="2"><span class="sLKXg">  const</span><span class="sNmU0"> url</span><span class="s_Sar"> =</span><span class="sLKXg"> new</span><span class="sAdtL"> URL</span><span class="s5ixo">(</span><span class="s7GmK">event</span><span class="s5ixo">.</span><span class="s2QsP">request</span><span class="s5ixo">.</span><span class="sJa8x">url</span><span class="s5ixo">)
</span></span><span class="line" line="3"><span class="sLKXg">  if</span><span class="s5ixo"> (</span><span class="s7GmK">url</span><span class="s5ixo">.</span><span class="sJa8x">pathname</span><span class="s_Sar"> ===</span><span class="sNmU0"> WEBHOOK</span><span class="s5ixo">) {
</span></span><span class="line" line="4"><span class="s7GmK">    event</span><span class="s5ixo">.</span><span class="sAdtL">respondWith</span><span class="s5ixo">(</span><span class="sAdtL">handleWebhook</span><span class="s5ixo">(</span><span class="sz0mV">event</span><span class="s5ixo">))
</span></span><span class="line" line="5"><span class="s5ixo">  } </span><span class="sLKXg">else</span><span class="sLKXg"> if</span><span class="s5ixo"> (</span><span class="s7GmK">url</span><span class="s5ixo">.</span><span class="sJa8x">pathname</span><span class="s_Sar"> ===</span><span class="sDhpE"> &#39;/registerWebhook&#39;</span><span class="s5ixo">) {
</span></span><span class="line" line="6"><span class="s7GmK">    event</span><span class="s5ixo">.</span><span class="sAdtL">respondWith</span><span class="s5ixo">(</span><span class="sAdtL">registerWebhook</span><span class="s5ixo">(</span><span class="sz0mV">event</span><span class="s5ixo">, </span><span class="sz0mV">url</span><span class="s5ixo">, </span><span class="sNmU0">WEBHOOK</span><span class="s5ixo">, </span><span class="sNmU0">SECRET</span><span class="s5ixo">))
</span></span><span class="line" line="7"><span class="s5ixo">  } </span><span class="sLKXg">else</span><span class="sLKXg"> if</span><span class="s5ixo"> (</span><span class="s7GmK">url</span><span class="s5ixo">.</span><span class="sJa8x">pathname</span><span class="s_Sar"> ===</span><span class="sDhpE"> &#39;/unRegisterWebhook&#39;</span><span class="s5ixo">) {
</span></span><span class="line" line="8"><span class="s7GmK">    event</span><span class="s5ixo">.</span><span class="sAdtL">respondWith</span><span class="s5ixo">(</span><span class="sAdtL">unRegisterWebhook</span><span class="s5ixo">(</span><span class="sz0mV">event</span><span class="s5ixo">))
</span></span><span class="line" line="9"><span class="s5ixo">  } </span><span class="sLKXg">else</span><span class="s5ixo"> {
</span></span><span class="line" line="10"><span class="s7GmK">    event</span><span class="s5ixo">.</span><span class="sAdtL">respondWith</span><span class="s5ixo">(</span><span class="sLKXg">new</span><span class="sAdtL"> Response</span><span class="s5ixo">(</span><span class="sDhpE">&#39;No handler for this request&#39;</span><span class="s5ixo">))
</span></span><span class="line" line="11"><span class="s5ixo">  }
</span></span><span class="line" line="12"><span class="s5ixo">})
</span></span></code><!--]--></pre><h3 id="核心功能" class="prose-heading prose-h3" data-v-894c4550><!--[-->核心功能<!--]--><a href="#核心功能" class="heading-anchor" aria-label="链接到此标题" data-v-894c4550><span class="anchor-icon" data-v-894c4550>#</span></a></h3><p><!--[-->随后的三个函数，会先进行 SECRET 的校验，并将 message 类型消息从 TG 的所有消息类型中分离开单独处理<!--]--></p><pre class="language-javascript shiki shiki-themes one-light one-dark-pro" style=""><!--[--><code><span class="line" line="1"><span class="sW2Sy">/**
</span></span><span class="line" line="2"><span class="sW2Sy"> * Handle requests to WEBHOOK
</span></span><span class="line" line="3"><span class="sW2Sy"> * https://core.telegram.org/bots/api#update
</span></span><span class="line" line="4"><span class="sW2Sy"> */
</span></span><span class="line" line="5"><span class="sLKXg">async</span><span class="sLKXg"> function</span><span class="sAdtL"> handleWebhook</span><span class="s5ixo"> (</span><span class="s8iYz">event</span><span class="s5ixo">) {
</span></span><span class="line" line="6"><span class="sW2Sy">  // Check secret
</span></span><span class="line" line="7"><span class="sLKXg">  if</span><span class="s5ixo"> (</span><span class="s7GmK">event</span><span class="s5ixo">.</span><span class="s2QsP">request</span><span class="s5ixo">.</span><span class="s2QsP">headers</span><span class="s5ixo">.</span><span class="sAdtL">get</span><span class="s5ixo">(</span><span class="sDhpE">&#39;X-Telegram-Bot-Api-Secret-Token&#39;</span><span class="s5ixo">) </span><span class="s_Sar">!==</span><span class="sNmU0"> SECRET</span><span class="s5ixo">) {
</span></span><span class="line" line="8"><span class="sLKXg">    return</span><span class="sLKXg"> new</span><span class="sAdtL"> Response</span><span class="s5ixo">(</span><span class="sDhpE">&#39;Unauthorized&#39;</span><span class="s5ixo">, { </span><span class="sJa8x">status</span><span class="st7oF">:</span><span class="sAGMh"> 403</span><span class="s5ixo"> })
</span></span><span class="line" line="9"><span class="s5ixo">  }
</span></span><span class="line" line="10"><span emptylineplaceholder="true">
</span></span><span class="line" line="11"><span class="sW2Sy">  // Read request body synchronously
</span></span><span class="line" line="12"><span class="sLKXg">  const</span><span class="sNmU0"> update</span><span class="s_Sar"> =</span><span class="sLKXg"> await</span><span class="s7GmK"> event</span><span class="s5ixo">.</span><span class="s2QsP">request</span><span class="s5ixo">.</span><span class="sAdtL">json</span><span class="s5ixo">()
</span></span><span class="line" line="13"><span class="sW2Sy">  // Deal with response asynchronously
</span></span><span class="line" line="14"><span class="s7GmK">  event</span><span class="s5ixo">.</span><span class="sAdtL">waitUntil</span><span class="s5ixo">(</span><span class="sAdtL">onUpdate</span><span class="s5ixo">(</span><span class="sz0mV">update</span><span class="s5ixo">))
</span></span><span class="line" line="15"><span emptylineplaceholder="true">
</span></span><span class="line" line="16"><span class="sLKXg">  return</span><span class="sLKXg"> new</span><span class="sAdtL"> Response</span><span class="s5ixo">(</span><span class="sDhpE">&#39;Ok&#39;</span><span class="s5ixo">)
</span></span><span class="line" line="17"><span class="s5ixo">}
</span></span><span class="line" line="18"><span emptylineplaceholder="true">
</span></span><span class="line" line="19"><span class="sW2Sy">/**
</span></span><span class="line" line="20"><span class="sW2Sy"> * Handle incoming Update
</span></span><span class="line" line="21"><span class="sW2Sy"> * https://core.telegram.org/bots/api#update
</span></span><span class="line" line="22"><span class="sW2Sy"> */
</span></span><span class="line" line="23"><span class="sLKXg">async</span><span class="sLKXg"> function</span><span class="sAdtL"> onUpdate</span><span class="s5ixo"> (</span><span class="s8iYz">update</span><span class="s5ixo">) {
</span></span><span class="line" line="24"><span class="sLKXg">  if</span><span class="s5ixo"> (</span><span class="sDhpE">&#39;message&#39;</span><span class="sLKXg"> in</span><span class="sz0mV"> update</span><span class="s5ixo">) {
</span></span><span class="line" line="25"><span class="sLKXg">    await</span><span class="sAdtL"> onMessage</span><span class="s5ixo">(</span><span class="s7GmK">update</span><span class="s5ixo">.</span><span class="sJa8x">message</span><span class="s5ixo">)
</span></span><span class="line" line="26"><span class="s5ixo">  }
</span></span><span class="line" line="27"><span class="s5ixo">}
</span></span><span class="line" line="28"><span emptylineplaceholder="true">
</span></span><span class="line" line="29"><span class="sW2Sy">/**
</span></span><span class="line" line="30"><span class="sW2Sy"> * Handle incoming Message
</span></span><span class="line" line="31"><span class="sW2Sy"> * https://core.telegram.org/bots/api#message
</span></span><span class="line" line="32"><span class="sW2Sy"> */
</span></span><span class="line" line="33"><span class="sLKXg">function</span><span class="sAdtL"> onMessage</span><span class="s5ixo"> (</span><span class="s8iYz">message</span><span class="s5ixo">) {
</span></span><span class="line" line="34"><span class="sLKXg">  return</span><span class="sAdtL"> sendPlainText</span><span class="s5ixo">(</span><span class="s7GmK">message</span><span class="s5ixo">.</span><span class="s2QsP">chat</span><span class="s5ixo">.</span><span class="sJa8x">id</span><span class="s5ixo">, </span><span class="sDhpE">&#39;Echo:</span><span class="s_Sar">\n</span><span class="sDhpE">&#39;</span><span class="s_Sar"> +</span><span class="s7GmK"> message</span><span class="s5ixo">.</span><span class="sJa8x">text</span><span class="s5ixo">)
</span></span><span class="line" line="35"><span class="s5ixo">}
</span></span><span class="line" line="36"><span emptylineplaceholder="true">
</span></span><span class="line" line="37"><span class="sW2Sy">/**
</span></span><span class="line" line="38"><span class="sW2Sy"> * Send plain text message
</span></span><span class="line" line="39"><span class="sW2Sy"> * https://core.telegram.org/bots/api#sendmessage
</span></span><span class="line" line="40"><span class="sW2Sy"> */
</span></span><span class="line" line="41"><span class="sLKXg">async</span><span class="sLKXg"> function</span><span class="sAdtL"> sendPlainText</span><span class="s5ixo"> (</span><span class="s8iYz">chatId</span><span class="s5ixo">, </span><span class="s8iYz">text</span><span class="s5ixo">) {
</span></span><span class="line" line="42"><span class="sLKXg">  return</span><span class="s5ixo"> (</span><span class="sLKXg">await</span><span class="sAdtL"> fetch</span><span class="s5ixo">(</span><span class="sAdtL">apiUrl</span><span class="s5ixo">(</span><span class="sDhpE">&#39;sendMessage&#39;</span><span class="s5ixo">, {
</span></span><span class="line" line="43"><span class="sJa8x">    chat_id</span><span class="st7oF">:</span><span class="sz0mV"> chatId</span><span class="s5ixo">,
</span></span><span class="line" line="44"><span class="sz0mV">    text
</span></span><span class="line" line="45"><span class="s5ixo">  }))).</span><span class="sAdtL">json</span><span class="s5ixo">()
</span></span></code><!--]--></pre><p><!--[-->我们需要更改的就是这个 onMessage 函数，用户输入的文本信息通过 message.text 获取，我们可以很轻易的把 b23 remover 的逻辑用 js 实现<!--]--></p><pre class="language-javascript shiki shiki-themes one-light one-dark-pro" style=""><!--[--><code><span class="line" line="1"><span class="sLKXg">async</span><span class="sLKXg"> function</span><span class="sAdtL"> onMessage</span><span class="s5ixo">(</span><span class="s8iYz">message</span><span class="s5ixo">) {
</span></span><span class="line" line="2"><span class="sLKXg">    if</span><span class="s5ixo"> (</span><span class="s_Sar">!</span><span class="s7GmK">message</span><span class="s5ixo">.</span><span class="sJa8x">text</span><span class="s5ixo">) {
</span></span><span class="line" line="3"><span class="sLKXg">        return</span><span class="s5ixo">;
</span></span><span class="line" line="4"><span class="s5ixo">    }
</span></span><span class="line" line="5"><span class="sLKXg">    const</span><span class="sNmU0"> b23Reg</span><span class="s_Sar"> =</span><span class="sDaw7"> /b23</span><span class="s_Sar">\.</span><span class="sDaw7">tv</span><span class="s_Sar">\/</span><span class="sAGMh">[a-zA-Z0-9]</span><span class="sYoRg">+</span><span class="sDaw7">/</span><span class="sLKXg">g</span><span class="s5ixo">;
</span></span><span class="line" line="6"><span class="sLKXg">    if</span><span class="s5ixo"> (</span><span class="s_Sar">!</span><span class="s7GmK">b23Reg</span><span class="s5ixo">.</span><span class="sAdtL">test</span><span class="s5ixo">(</span><span class="s7GmK">message</span><span class="s5ixo">.</span><span class="sJa8x">text</span><span class="s5ixo">)) {
</span></span><span class="line" line="7"><span class="s7GmK">        console</span><span class="s5ixo">.</span><span class="sAdtL">log</span><span class="s5ixo">(</span><span class="sDhpE">&#39;No match found&#39;</span><span class="s5ixo">);
</span></span><span class="line" line="8"><span class="s5ixo">    }
</span></span><span class="line" line="9"><span class="sLKXg">    const</span><span class="sNmU0"> b23Links</span><span class="s_Sar"> =</span><span class="s7GmK"> message</span><span class="s5ixo">.</span><span class="s2QsP">text</span><span class="s5ixo">.</span><span class="sAdtL">match</span><span class="s5ixo">(</span><span class="sz0mV">b23Reg</span><span class="s5ixo">);
</span></span><span class="line" line="10"><span class="sLKXg">    const</span><span class="sNmU0"> cleanLinks</span><span class="s_Sar"> =</span><span class="s5ixo"> [];
</span></span><span class="line" line="11"><span class="sLKXg">    await</span><span class="sC09Y"> Promise</span><span class="s5ixo">.</span><span class="sAdtL">all</span><span class="s5ixo">(
</span></span><span class="line" line="12"><span class="s7GmK">        b23Links</span><span class="s5ixo">.</span><span class="sAdtL">map</span><span class="s5ixo">(</span><span class="s8iYz">link</span><span class="sLKXg"> =&gt;</span><span class="sAdtL"> b23Remover</span><span class="s5ixo">(</span><span class="sDhpE">&#39;https://&#39;</span><span class="s_Sar"> +</span><span class="sz0mV"> link</span><span class="s5ixo">))
</span></span><span class="line" line="13"><span class="s5ixo">    ).</span><span class="sAdtL">then</span><span class="s5ixo">(</span><span class="s8iYz">result</span><span class="sLKXg"> =&gt;</span><span class="s5ixo"> {
</span></span><span class="line" line="14"><span class="s7GmK">        cleanLinks</span><span class="s5ixo">.</span><span class="sAdtL">push</span><span class="s5ixo">(</span><span class="st7oF">...</span><span class="sz0mV">result</span><span class="s5ixo">);
</span></span><span class="line" line="15"><span class="s5ixo">    });
</span></span><span class="line" line="16"><span emptylineplaceholder="true">
</span></span><span class="line" line="17"><span class="sLKXg">    const</span><span class="sNmU0"> text2Send</span><span class="s_Sar"> =</span><span class="sDhpE"> &quot;Track ID removed:</span><span class="s_Sar">\n</span><span class="sDhpE">&quot;</span><span class="s_Sar"> +</span><span class="s7GmK"> cleanLinks</span><span class="s5ixo">.</span><span class="sAdtL">join</span><span class="s5ixo">(</span><span class="sDhpE">&quot;</span><span class="s_Sar">\n</span><span class="sDhpE">&quot;</span><span class="s5ixo">);
</span></span><span class="line" line="18"><span class="sLKXg">    return</span><span class="sAdtL"> sendPlainText</span><span class="s5ixo">(</span><span class="s7GmK">message</span><span class="s5ixo">.</span><span class="s2QsP">chat</span><span class="s5ixo">.</span><span class="sJa8x">id</span><span class="s5ixo">, </span><span class="sz0mV">text2Send</span><span class="s5ixo">);
</span></span><span class="line" line="19"><span class="s5ixo">}
</span></span><span class="line" line="20"><span emptylineplaceholder="true">
</span></span><span class="line" line="21"><span class="sLKXg">async</span><span class="sLKXg"> function</span><span class="sAdtL"> b23Remover</span><span class="s5ixo"> (</span><span class="s8iYz">url</span><span class="s5ixo">) {
</span></span><span class="line" line="22"><span class="sLKXg">    const</span><span class="sNmU0"> r</span><span class="s_Sar"> =</span><span class="sLKXg"> await</span><span class="sAdtL"> fetch</span><span class="s5ixo">(</span><span class="sz0mV">url</span><span class="s5ixo">)
</span></span><span class="line" line="23"><span class="sLKXg">    const</span><span class="sNmU0"> v</span><span class="s_Sar"> =</span><span class="s7GmK"> r</span><span class="s5ixo">.</span><span class="sJa8x">url
</span></span><span class="line" line="24"><span class="sLKXg">    const</span><span class="sNmU0"> u</span><span class="s_Sar"> =</span><span class="sLKXg"> new</span><span class="sAdtL"> URL</span><span class="s5ixo">(</span><span class="sz0mV">v</span><span class="s5ixo">)
</span></span><span class="line" line="25"><span class="sLKXg">    return</span><span class="s7GmK"> u</span><span class="s5ixo">.</span><span class="sJa8x">origin</span><span class="s_Sar"> +</span><span class="s7GmK"> u</span><span class="s5ixo">.</span><span class="sJa8x">pathname
</span></span><span class="line" line="26"><span class="s5ixo">}
</span></span></code><!--]--></pre><h3 id="webhook-注册相关" class="prose-heading prose-h3" data-v-894c4550><!--[-->webhook 注册相关<!--]--><a href="#webhook-注册相关" class="heading-anchor" aria-label="链接到此标题" data-v-894c4550><span class="anchor-icon" data-v-894c4550>#</span></a></h3><p><!--[-->后面的 registerWebhook、unRegisterWebhook、apiUrl 在没有特定需求的情况下不需要变动。<!--]--></p><p><!--[-->在 Cloudflare 部署后，就可以访问 aaa.bbb.workers.dev/registerWebhook 这个 url 注册 TG 的 webhook 服务。收到 Ok 就代表注册好了。<!--]--></p><p><!--[--><span class="prose-img-wrapper" data-v-4f488808><img src="https://static.031130.xyz/uploads/2024/12/30/5fd442bb18064.webp" alt="" title="" loading="lazy" class="prose-img" style="cursor:zoom-in;" data-v-4f488808><!----><!--teleport start--><!--teleport end--></span><!--]--></p><h2 id="成果展示" class="prose-heading prose-h2" data-v-a22a06c0><!--[-->成果展示<!--]--><a href="#成果展示" class="heading-anchor" aria-label="链接到此标题" data-v-a22a06c0><span class="anchor-icon" data-v-a22a06c0>#</span></a></h2><p><!--[--><span class="prose-img-wrapper" data-v-4f488808><img src="https://static.031130.xyz/uploads/2024/12/30/3b0b929960840.webp" alt="" title="" loading="lazy" class="prose-img" style="cursor:zoom-in;" data-v-4f488808><!----><!--teleport start--><!--teleport end--></span><!--]--></p><style>html pre.shiki code .sLKXg, html code.shiki .sLKXg{--shiki-default:#A626A4;--shiki-dark:#C678DD}html pre.shiki code .sNmU0, html code.shiki .sNmU0{--shiki-default:#986801;--shiki-dark:#E5C07B}html pre.shiki code .s_Sar, html code.shiki .s_Sar{--shiki-default:#0184BC;--shiki-dark:#56B6C2}html pre.shiki code .sW2Sy, html code.shiki .sW2Sy{--shiki-default:#A0A1A7;--shiki-default-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html pre.shiki code .s8iYz, html code.shiki .s8iYz{--shiki-default:#383A42;--shiki-default-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic}html pre.shiki code .s7GmK, html code.shiki .s7GmK{--shiki-default:#383A42;--shiki-dark:#E5C07B}html pre.shiki code .s2QsP, html code.shiki .s2QsP{--shiki-default:#E45649;--shiki-dark:#E5C07B}html pre.shiki code .sJa8x, html code.shiki .sJa8x{--shiki-default:#E45649;--shiki-dark:#E06C75}html pre.shiki code .sz0mV, html code.shiki .sz0mV{--shiki-default:#383A42;--shiki-dark:#E06C75}html pre.shiki code .st7oF, html code.shiki .st7oF{--shiki-default:#0184BC;--shiki-dark:#ABB2BF}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html pre.shiki code .sDaw7, html code.shiki .sDaw7{--shiki-default:#0184BC;--shiki-dark:#E06C75}html pre.shiki code .sYoRg, html code.shiki .sYoRg{--shiki-default:#0184BC;--shiki-dark:#D19A66}html pre.shiki code .sC09Y, html code.shiki .sC09Y{--shiki-default:#C18401;--shiki-dark:#E5C07B}</style></article><nav class="post-navigation" data-v-483530c4 data-v-27f76087><a class="nav-button prev" href="/2025/01/18/service-status-monitor-based-on-cloudflare-workers/" data-v-27f76087><div class="nav-arrow" data-v-27f76087>←</div><div class="nav-content" data-v-27f76087><span class="nav-label" data-v-27f76087>上一篇</span><span class="nav-title" data-v-27f76087>基于 Cloudflare Workers 实现的在线服务状态检测告警系统</span></div></a><a class="nav-button next" href="/2024/11/19/firefox-is-the-only-mainstream-brower-doing-online-certificate-revocation-checks/" data-v-27f76087><div class="nav-content" data-v-27f76087><span class="nav-label" data-v-27f76087>下一篇</span><span class="nav-title" data-v-27f76087>2024年，Firefox 是唯一还在坚持执行在线的 SSL 证书吊销状态检查的主流浏览器</span></div><div class="nav-arrow" data-v-27f76087>→</div></a></nav><hr data-v-483530c4><div id="waline" data-v-483530c4><span></span></div><!--]--></main><div class="after-main side" data-v-03b6b78b><!--[--><aside data-v-483530c4><nav class="toc" data-v-483530c4 data-v-61bd12f2><div class="toc-title" data-v-61bd12f2>目录</div><ul class="toc-list" data-v-61bd12f2><!--[--><li class="toc-item toc-level-2" data-v-61bd12f2><a href="#起因" data-v-61bd12f2>起因</a></li><li class="toc-item toc-level-2" data-v-61bd12f2><a href="#怎么做" data-v-61bd12f2>怎么做？</a></li><li class="toc-item toc-level-2" data-v-61bd12f2><a href="#代码分析" data-v-61bd12f2>代码分析</a></li><li class="toc-item toc-level-3" data-v-61bd12f2><a href="#顶部变量" data-v-61bd12f2>顶部变量</a></li><li class="toc-item toc-level-3" data-v-61bd12f2><a href="#简易路由" data-v-61bd12f2>简易路由</a></li><li class="toc-item toc-level-3" data-v-61bd12f2><a href="#核心功能" data-v-61bd12f2>核心功能</a></li><li class="toc-item toc-level-3" data-v-61bd12f2><a href="#webhook-注册相关" data-v-61bd12f2>webhook 注册相关</a></li><li class="toc-item toc-level-2" data-v-61bd12f2><a href="#成果展示" data-v-61bd12f2>成果展示</a></li><!--]--></ul></nav></aside><!--]--></div></div><footer style="background:url(https://static.031130.xyz/uploads/2024/08/12/62f3734fe20d3.webp) center bottom / cover no-repeat;min-height:120px;color:white;" data-v-03b6b78b data-v-75e9447f><div class="footer-mask" data-v-75e9447f></div><div class="footer-content" data-v-75e9447f><div data-v-75e9447f>©2020 - 2025 By zhullyb</div><!----></div></footer></div><!--]--></div><div id="teleports"></div><script type="application/ld+json" data-nuxt-schema-org="true" data-hid="schema-org-graph">{"@context":"https://schema.org","@graph":[{"@id":"https://zhul.in/#website","@type":"WebSite","description":"这里是我的个人博客，专注于分享技术干货、学习心得和生活感悟，涵盖前端开发、后端架构、人工智能、编程技巧、工具推荐等多个领域。我持续更新原创内容，记录成长过程中的思考与收获，致力于帮助更多开发者和技术爱好者提升技能、拓展视野。如果你对技术、产品和互联网行业感兴趣，相信你能在这里找到有价值的知识与灵感。","inLanguage":"zh-CN","name":"竹林里有冰的博客","url":"https://zhul.in/"},{"@id":"https://zhul.in/2024/12/30/tg-bot-hosted-on-cloudflare-workers/#webpage","@type":"WebPage","description":true,"name":"构建部署在 Cloudflare Workers 上的 TG Bot","url":"https://zhul.in/2024/12/30/tg-bot-hosted-on-cloudflare-workers/","isPartOf":{"@id":"https://zhul.in/#website"},"potentialAction":[{"@type":"ReadAction","target":["https://zhul.in/2024/12/30/tg-bot-hosted-on-cloudflare-workers/"]}]}]}</script><script type="application/json" data-nuxt-data="nuxt-app" data-ssr="true" id="__NUXT_DATA__" data-src="/2024/12/30/tg-bot-hosted-on-cloudflare-workers/_payload.json?59506ef7-936c-44e0-9177-6faed365eca0">[{"state":1,"once":14,"_errors":15,"serverRendered":12,"path":17,"prerenderedAt":18},["Reactive",2],{"$snuxt-seo-utils:routeRules":3,"$ssite-config":4},{"head":-1,"seoMeta":-1},{"_priority":5,"defaultLocale":8,"description":9,"env":10,"name":11,"trailingSlash":12,"url":13},{"name":6,"env":7,"url":6,"description":6,"defaultLocale":6,"trailingSlash":6},-3,-15,"zh-CN","这里是我的个人博客，专注于分享技术干货、学习心得和生活感悟，涵盖前端开发、后端架构、人工智能、编程技巧、工具推荐等多个领域。我持续更新原创内容，记录成长过程中的思考与收获，致力于帮助更多开发者和技术爱好者提升技能、拓展视野。如果你对技术、产品和互联网行业感兴趣，相信你能在这里找到有价值的知识与灵感。","production","竹林里有冰的博客",true,"https://zhul.in/",["Set"],["ShallowReactive",16],{"post-2024-12-30-tg-bot-hosted-on-cloudflare-workers":-1,"surround-2024-12-30-tg-bot-hosted-on-cloudflare-workers":-1,"randomIndex/2024/12/30/tg-bot-hosted-on-cloudflare-workers/":-1,"posts-search-sections":-1},"/2024/12/30/tg-bot-hosted-on-cloudflare-workers/",1761897610295]</script><script>window.__NUXT__={};window.__NUXT__.config={public:{content:{wsUrl:""},mdc:{components:{prose:true,map:{}},headings:{anchorLinks:{h1:false,h2:true,h3:true,h4:true,h5:false,h6:false}}},"seo-utils":{canonicalQueryWhitelist:["page","sort","filter","search","q","category","tag"],canonicalLowercase:true}},app:{baseURL:"/",buildId:"59506ef7-936c-44e0-9177-6faed365eca0",buildAssetsDir:"/_nuxt/",cdnURL:""}}</script></body></html>
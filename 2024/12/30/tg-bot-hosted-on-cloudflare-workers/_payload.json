[{"data":1,"prerenderedAt":1418},["ShallowReactive",2],{"post-2024-12-30-tg-bot-hosted-on-cloudflare-workers-zh":3,"surround-2024-12-30-tg-bot-hosted-on-cloudflare-workers-zh":1405,"randomIndex/2024/12/30/tg-bot-hosted-on-cloudflare-workers/":366,"language-switch-/2024/12/30/tg-bot-hosted-on-cloudflare-workers/-en":1417},{"title":4,"date":5,"path":6,"tags":7,"body":10,"description":101},"构建部署在 Cloudflare Workers 上的 TG Bot","2024-12-30 19:45:43","/2024/12/30/tg-bot-hosted-on-cloudflare-workers",[8,9],"Bot","Cloudflare",{"type":11,"value":12,"toc":1394},"minimark",[13,17,31,44,47,51,59,68,71,74,77,80,84,87,95,158,161,164,429,432,435,933,936,1366,1370,1373,1376,1382,1385,1390],[14,15,16],"h2",{"id":16},"起因",[18,19,20,21,26,27],"p",{},"早在去年 10 月，我就写过一篇",[22,23,25],"a",{"href":24},"/2023/10/29/create-b23tv-remover-bot/","《创建 b23.tv 追踪参数移除 bot》","。记录了部署 b23.tv 的追踪参数移除 Bot 的部署方案。其中提到的 TG Bot 随着服务器到期不再续费也一同落灰了——",[28,29,30],"strong",{},"公益服务总是这样，开始时满腔热血，随着时间散去没有多少人能坚持投入成本，徒留下一地鸡毛。",[18,32,33,34,40,41],{},"大概半个月前，我在群里看见 ",[22,35,39],{"href":36,"rel":37},"https://asukaminato.eu.org/",[38],"nofollow","Asuka Minato"," 开发的群消息总结 Bot，整体部署在 Cloudflare Workers 上，在保证零运营成本的情况下有着相当非常不错的在线率保证，因此便考虑将这个 Bot 迁移到 Cloudflare Workers 上。",[28,42,43],{},"选用免费的 serverless 能够有效延长服务的可持续性，它不需要额外投入时间精力和财力进行维护，通常可以活很久。",[18,45,46],{},"之所以可以把 TG Bot 部署到 Cloudflare Workers 上，主要是得益于 TG 平台支持 webhook 的方式让 Bot 程序提供服务。我们所需要提供的是一个公网能访问的 http 地址，在成功注册 webhook 服务后，TG 的官方服务器会将所有 Bot 所在群或者和所有对个人的对话以 http 请求的方式打到这个 url 上，而 Cloudflare Workers 平台就能提供一个 workers.dev 结尾的公网 url 作为 webhook 提供给 TG 服务器。",[14,48,50],{"id":49},"怎么做","怎么做？",[18,52,53,58],{},[22,54,57],{"href":55,"rel":56},"https://github.com/cvzi/telegram-bot-cloudflare",[38],"在这个 Github 仓库中","，给出了不少例子，用以讲述如何利用 Cloudflare Workers 构建 TG Bot。",[18,60,61,62,67],{},"在 ",[22,63,66],{"href":64,"rel":65},"https://github.com/cvzi/telegram-bot-cloudflare/blob/main/bot.js",[38],"bot.js"," 这个文件中编写了一个最简单的 TG Bot，其功能是: 将受到的所有消息在头部添加「Echo:」字符串，并发送回刚才的对话。",[18,69,70],{},"例: 用户发送 「Hello」，bot 回复 「Echo: Hello」",[72,73],"hr",{},[14,75,76],{"id":76},"代码分析",[18,78,79],{},"代码整体分为四个部分",[81,82,83],"h3",{"id":83},"顶部变量",[18,85,86],{},"文件顶部定义了 Bot 的 token、webhook 的 url 路径以及一个简易的 webhook 密码。",[18,88,89,90,94],{},"TOKEN 是从 botfather 那里获得的 bot token，SECRET 是自己设置的 webhook 密码，TG 的 webhook 服务器会通过把这个字段添加到名为 ",[91,92,93],"code",{},"X-Telegram-Bot-Api-Secret-Token"," 的请求头中来证明自己的官方身份。",[96,97,102],"pre",{"className":98,"code":99,"language":100,"meta":101,"style":101},"language-javascript shiki shiki-themes one-light one-dark-pro","const TOKEN = ENV_BOT_TOKEN // Get it from @BotFather https://core.telegram.org/bots#6-botfather\nconst WEBHOOK = '/endpoint'\nconst SECRET = ENV_BOT_SECRET // A-Z, a-z, 0-9, _ and -\n","javascript","",[91,103,104,128,142],{"__ignoreMap":101},[105,106,109,113,117,121,124],"span",{"class":107,"line":108},"line",1,[105,110,112],{"class":111},"sLKXg","const",[105,114,116],{"class":115},"sNmU0"," TOKEN",[105,118,120],{"class":119},"s_Sar"," =",[105,122,123],{"class":115}," ENV_BOT_TOKEN",[105,125,127],{"class":126},"sW2Sy"," // Get it from @BotFather https://core.telegram.org/bots#6-botfather\n",[105,129,131,133,136,138],{"class":107,"line":130},2,[105,132,112],{"class":111},[105,134,135],{"class":115}," WEBHOOK",[105,137,120],{"class":119},[105,139,141],{"class":140},"sDhpE"," '/endpoint'\n",[105,143,145,147,150,152,155],{"class":107,"line":144},3,[105,146,112],{"class":111},[105,148,149],{"class":115}," SECRET",[105,151,120],{"class":119},[105,153,154],{"class":115}," ENV_BOT_SECRET",[105,156,157],{"class":126}," // A-Z, a-z, 0-9, _ and -\n",[81,159,160],{"id":160},"简易路由",[18,162,163],{},"紧接着定义了一个简易的路由",[96,165,167],{"className":98,"code":166,"language":100,"meta":101,"style":101},"addEventListener('fetch', event => {\n  const url = new URL(event.request.url)\n  if (url.pathname === WEBHOOK) {\n    event.respondWith(handleWebhook(event))\n  } else if (url.pathname === '/registerWebhook') {\n    event.respondWith(registerWebhook(event, url, WEBHOOK, SECRET))\n  } else if (url.pathname === '/unRegisterWebhook') {\n    event.respondWith(unRegisterWebhook(event))\n  } else {\n    event.respondWith(new Response('No handler for this request'))\n  }\n})\n",[91,168,169,195,232,255,279,306,340,364,384,393,417,423],{"__ignoreMap":101},[105,170,171,175,179,182,185,189,192],{"class":107,"line":108},[105,172,174],{"class":173},"sAdtL","addEventListener",[105,176,178],{"class":177},"s5ixo","(",[105,180,181],{"class":140},"'fetch'",[105,183,184],{"class":177},", ",[105,186,188],{"class":187},"s8iYz","event",[105,190,191],{"class":111}," =>",[105,193,194],{"class":177}," {\n",[105,196,197,200,203,205,208,211,213,216,219,223,225,229],{"class":107,"line":130},[105,198,199],{"class":111},"  const",[105,201,202],{"class":115}," url",[105,204,120],{"class":119},[105,206,207],{"class":111}," new",[105,209,210],{"class":173}," URL",[105,212,178],{"class":177},[105,214,188],{"class":215},"s7GmK",[105,217,218],{"class":177},".",[105,220,222],{"class":221},"s2QsP","request",[105,224,218],{"class":177},[105,226,228],{"class":227},"sJa8x","url",[105,230,231],{"class":177},")\n",[105,233,234,237,240,242,244,247,250,252],{"class":107,"line":144},[105,235,236],{"class":111},"  if",[105,238,239],{"class":177}," (",[105,241,228],{"class":215},[105,243,218],{"class":177},[105,245,246],{"class":227},"pathname",[105,248,249],{"class":119}," ===",[105,251,135],{"class":115},[105,253,254],{"class":177},") {\n",[105,256,258,261,263,266,268,271,273,276],{"class":107,"line":257},4,[105,259,260],{"class":215},"    event",[105,262,218],{"class":177},[105,264,265],{"class":173},"respondWith",[105,267,178],{"class":177},[105,269,270],{"class":173},"handleWebhook",[105,272,178],{"class":177},[105,274,188],{"class":275},"sz0mV",[105,277,278],{"class":177},"))\n",[105,280,282,285,288,291,293,295,297,299,301,304],{"class":107,"line":281},5,[105,283,284],{"class":177},"  } ",[105,286,287],{"class":111},"else",[105,289,290],{"class":111}," if",[105,292,239],{"class":177},[105,294,228],{"class":215},[105,296,218],{"class":177},[105,298,246],{"class":227},[105,300,249],{"class":119},[105,302,303],{"class":140}," '/registerWebhook'",[105,305,254],{"class":177},[105,307,309,311,313,315,317,320,322,324,326,328,330,333,335,338],{"class":107,"line":308},6,[105,310,260],{"class":215},[105,312,218],{"class":177},[105,314,265],{"class":173},[105,316,178],{"class":177},[105,318,319],{"class":173},"registerWebhook",[105,321,178],{"class":177},[105,323,188],{"class":275},[105,325,184],{"class":177},[105,327,228],{"class":275},[105,329,184],{"class":177},[105,331,332],{"class":115},"WEBHOOK",[105,334,184],{"class":177},[105,336,337],{"class":115},"SECRET",[105,339,278],{"class":177},[105,341,343,345,347,349,351,353,355,357,359,362],{"class":107,"line":342},7,[105,344,284],{"class":177},[105,346,287],{"class":111},[105,348,290],{"class":111},[105,350,239],{"class":177},[105,352,228],{"class":215},[105,354,218],{"class":177},[105,356,246],{"class":227},[105,358,249],{"class":119},[105,360,361],{"class":140}," '/unRegisterWebhook'",[105,363,254],{"class":177},[105,365,367,369,371,373,375,378,380,382],{"class":107,"line":366},8,[105,368,260],{"class":215},[105,370,218],{"class":177},[105,372,265],{"class":173},[105,374,178],{"class":177},[105,376,377],{"class":173},"unRegisterWebhook",[105,379,178],{"class":177},[105,381,188],{"class":275},[105,383,278],{"class":177},[105,385,387,389,391],{"class":107,"line":386},9,[105,388,284],{"class":177},[105,390,287],{"class":111},[105,392,194],{"class":177},[105,394,396,398,400,402,404,407,410,412,415],{"class":107,"line":395},10,[105,397,260],{"class":215},[105,399,218],{"class":177},[105,401,265],{"class":173},[105,403,178],{"class":177},[105,405,406],{"class":111},"new",[105,408,409],{"class":173}," Response",[105,411,178],{"class":177},[105,413,414],{"class":140},"'No handler for this request'",[105,416,278],{"class":177},[105,418,420],{"class":107,"line":419},11,[105,421,422],{"class":177},"  }\n",[105,424,426],{"class":107,"line":425},12,[105,427,428],{"class":177},"})\n",[81,430,431],{"id":431},"核心功能",[18,433,434],{},"随后的三个函数，会先进行 SECRET 的校验，并将 message 类型消息从 TG 的所有消息类型中分离开单独处理",[96,436,438],{"className":98,"code":437,"language":100,"meta":101,"style":101},"/**\n * Handle requests to WEBHOOK\n * https://core.telegram.org/bots/api#update\n */\nasync function handleWebhook (event) {\n  // Check secret\n  if (event.request.headers.get('X-Telegram-Bot-Api-Secret-Token') !== SECRET) {\n    return new Response('Unauthorized', { status: 403 })\n  }\n\n  // Read request body synchronously\n  const update = await event.request.json()\n  // Deal with response asynchronously\n  event.waitUntil(onUpdate(update))\n\n  return new Response('Ok')\n}\n\n/**\n * Handle incoming Update\n * https://core.telegram.org/bots/api#update\n */\nasync function onUpdate (update) {\n  if ('message' in update) {\n    await onMessage(update.message)\n  }\n}\n\n/**\n * Handle incoming Message\n * https://core.telegram.org/bots/api#message\n */\nfunction onMessage (message) {\n  return sendPlainText(message.chat.id, 'Echo:\\n' + message.text)\n}\n\n/**\n * Send plain text message\n * https://core.telegram.org/bots/api#sendmessage\n */\nasync function sendPlainText (chatId, text) {\n  return (await fetch(apiUrl('sendMessage', {\n    chat_id: chatId,\n    text\n  }))).json()\n",[91,439,440,445,450,455,460,477,482,519,550,554,560,565,592,598,621,626,643,649,654,659,665,670,675,691,708,728,733,738,743,748,754,760,765,779,825,830,835,840,846,852,857,877,903,917,923],{"__ignoreMap":101},[105,441,442],{"class":107,"line":108},[105,443,444],{"class":126},"/**\n",[105,446,447],{"class":107,"line":130},[105,448,449],{"class":126}," * Handle requests to WEBHOOK\n",[105,451,452],{"class":107,"line":144},[105,453,454],{"class":126}," * https://core.telegram.org/bots/api#update\n",[105,456,457],{"class":107,"line":257},[105,458,459],{"class":126}," */\n",[105,461,462,465,468,471,473,475],{"class":107,"line":281},[105,463,464],{"class":111},"async",[105,466,467],{"class":111}," function",[105,469,470],{"class":173}," handleWebhook",[105,472,239],{"class":177},[105,474,188],{"class":187},[105,476,254],{"class":177},[105,478,479],{"class":107,"line":308},[105,480,481],{"class":126},"  // Check secret\n",[105,483,484,486,488,490,492,494,496,499,501,504,506,509,512,515,517],{"class":107,"line":342},[105,485,236],{"class":111},[105,487,239],{"class":177},[105,489,188],{"class":215},[105,491,218],{"class":177},[105,493,222],{"class":221},[105,495,218],{"class":177},[105,497,498],{"class":221},"headers",[105,500,218],{"class":177},[105,502,503],{"class":173},"get",[105,505,178],{"class":177},[105,507,508],{"class":140},"'X-Telegram-Bot-Api-Secret-Token'",[105,510,511],{"class":177},") ",[105,513,514],{"class":119},"!==",[105,516,149],{"class":115},[105,518,254],{"class":177},[105,520,521,524,526,528,530,533,536,539,543,547],{"class":107,"line":366},[105,522,523],{"class":111},"    return",[105,525,207],{"class":111},[105,527,409],{"class":173},[105,529,178],{"class":177},[105,531,532],{"class":140},"'Unauthorized'",[105,534,535],{"class":177},", { ",[105,537,538],{"class":227},"status",[105,540,542],{"class":541},"st7oF",":",[105,544,546],{"class":545},"sAGMh"," 403",[105,548,549],{"class":177}," })\n",[105,551,552],{"class":107,"line":386},[105,553,422],{"class":177},[105,555,556],{"class":107,"line":395},[105,557,559],{"emptyLinePlaceholder":558},true,"\n",[105,561,562],{"class":107,"line":419},[105,563,564],{"class":126},"  // Read request body synchronously\n",[105,566,567,569,572,574,577,580,582,584,586,589],{"class":107,"line":425},[105,568,199],{"class":111},[105,570,571],{"class":115}," update",[105,573,120],{"class":119},[105,575,576],{"class":111}," await",[105,578,579],{"class":215}," event",[105,581,218],{"class":177},[105,583,222],{"class":221},[105,585,218],{"class":177},[105,587,588],{"class":173},"json",[105,590,591],{"class":177},"()\n",[105,593,595],{"class":107,"line":594},13,[105,596,597],{"class":126},"  // Deal with response asynchronously\n",[105,599,601,604,606,609,611,614,616,619],{"class":107,"line":600},14,[105,602,603],{"class":215},"  event",[105,605,218],{"class":177},[105,607,608],{"class":173},"waitUntil",[105,610,178],{"class":177},[105,612,613],{"class":173},"onUpdate",[105,615,178],{"class":177},[105,617,618],{"class":275},"update",[105,620,278],{"class":177},[105,622,624],{"class":107,"line":623},15,[105,625,559],{"emptyLinePlaceholder":558},[105,627,629,632,634,636,638,641],{"class":107,"line":628},16,[105,630,631],{"class":111},"  return",[105,633,207],{"class":111},[105,635,409],{"class":173},[105,637,178],{"class":177},[105,639,640],{"class":140},"'Ok'",[105,642,231],{"class":177},[105,644,646],{"class":107,"line":645},17,[105,647,648],{"class":177},"}\n",[105,650,652],{"class":107,"line":651},18,[105,653,559],{"emptyLinePlaceholder":558},[105,655,657],{"class":107,"line":656},19,[105,658,444],{"class":126},[105,660,662],{"class":107,"line":661},20,[105,663,664],{"class":126}," * Handle incoming Update\n",[105,666,668],{"class":107,"line":667},21,[105,669,454],{"class":126},[105,671,673],{"class":107,"line":672},22,[105,674,459],{"class":126},[105,676,678,680,682,685,687,689],{"class":107,"line":677},23,[105,679,464],{"class":111},[105,681,467],{"class":111},[105,683,684],{"class":173}," onUpdate",[105,686,239],{"class":177},[105,688,618],{"class":187},[105,690,254],{"class":177},[105,692,694,696,698,701,704,706],{"class":107,"line":693},24,[105,695,236],{"class":111},[105,697,239],{"class":177},[105,699,700],{"class":140},"'message'",[105,702,703],{"class":111}," in",[105,705,571],{"class":275},[105,707,254],{"class":177},[105,709,711,714,717,719,721,723,726],{"class":107,"line":710},25,[105,712,713],{"class":111},"    await",[105,715,716],{"class":173}," onMessage",[105,718,178],{"class":177},[105,720,618],{"class":215},[105,722,218],{"class":177},[105,724,725],{"class":227},"message",[105,727,231],{"class":177},[105,729,731],{"class":107,"line":730},26,[105,732,422],{"class":177},[105,734,736],{"class":107,"line":735},27,[105,737,648],{"class":177},[105,739,741],{"class":107,"line":740},28,[105,742,559],{"emptyLinePlaceholder":558},[105,744,746],{"class":107,"line":745},29,[105,747,444],{"class":126},[105,749,751],{"class":107,"line":750},30,[105,752,753],{"class":126}," * Handle incoming Message\n",[105,755,757],{"class":107,"line":756},31,[105,758,759],{"class":126}," * https://core.telegram.org/bots/api#message\n",[105,761,763],{"class":107,"line":762},32,[105,764,459],{"class":126},[105,766,768,771,773,775,777],{"class":107,"line":767},33,[105,769,770],{"class":111},"function",[105,772,716],{"class":173},[105,774,239],{"class":177},[105,776,725],{"class":187},[105,778,254],{"class":177},[105,780,782,784,787,789,791,793,796,798,801,803,806,809,812,815,818,820,823],{"class":107,"line":781},34,[105,783,631],{"class":111},[105,785,786],{"class":173}," sendPlainText",[105,788,178],{"class":177},[105,790,725],{"class":215},[105,792,218],{"class":177},[105,794,795],{"class":221},"chat",[105,797,218],{"class":177},[105,799,800],{"class":227},"id",[105,802,184],{"class":177},[105,804,805],{"class":140},"'Echo:",[105,807,808],{"class":119},"\\n",[105,810,811],{"class":140},"'",[105,813,814],{"class":119}," +",[105,816,817],{"class":215}," message",[105,819,218],{"class":177},[105,821,822],{"class":227},"text",[105,824,231],{"class":177},[105,826,828],{"class":107,"line":827},35,[105,829,648],{"class":177},[105,831,833],{"class":107,"line":832},36,[105,834,559],{"emptyLinePlaceholder":558},[105,836,838],{"class":107,"line":837},37,[105,839,444],{"class":126},[105,841,843],{"class":107,"line":842},38,[105,844,845],{"class":126}," * Send plain text message\n",[105,847,849],{"class":107,"line":848},39,[105,850,851],{"class":126}," * https://core.telegram.org/bots/api#sendmessage\n",[105,853,855],{"class":107,"line":854},40,[105,856,459],{"class":126},[105,858,860,862,864,866,868,871,873,875],{"class":107,"line":859},41,[105,861,464],{"class":111},[105,863,467],{"class":111},[105,865,786],{"class":173},[105,867,239],{"class":177},[105,869,870],{"class":187},"chatId",[105,872,184],{"class":177},[105,874,822],{"class":187},[105,876,254],{"class":177},[105,878,880,882,884,887,890,892,895,897,900],{"class":107,"line":879},42,[105,881,631],{"class":111},[105,883,239],{"class":177},[105,885,886],{"class":111},"await",[105,888,889],{"class":173}," fetch",[105,891,178],{"class":177},[105,893,894],{"class":173},"apiUrl",[105,896,178],{"class":177},[105,898,899],{"class":140},"'sendMessage'",[105,901,902],{"class":177},", {\n",[105,904,906,909,911,914],{"class":107,"line":905},43,[105,907,908],{"class":227},"    chat_id",[105,910,542],{"class":541},[105,912,913],{"class":275}," chatId",[105,915,916],{"class":177},",\n",[105,918,920],{"class":107,"line":919},44,[105,921,922],{"class":275},"    text\n",[105,924,926,929,931],{"class":107,"line":925},45,[105,927,928],{"class":177},"  }))).",[105,930,588],{"class":173},[105,932,591],{"class":177},[18,934,935],{},"我们需要更改的就是这个 onMessage 函数，用户输入的文本信息通过 message.text 获取，我们可以很轻易的把 b23 remover 的逻辑用 js 实现",[96,937,939],{"className":98,"code":938,"language":100,"meta":101,"style":101},"async function onMessage(message) {\n    if (!message.text) {\n        return;\n    }\n    const b23Reg = /b23\\.tv\\/[a-zA-Z0-9]+/g;\n    if (!b23Reg.test(message.text)) {\n        console.log('No match found');\n    }\n    const b23Links = message.text.match(b23Reg);\n    const cleanLinks = [];\n    await Promise.all(\n        b23Links.map(link => b23Remover('https://' + link))\n    ).then(result => {\n        cleanLinks.push(...result);\n    });\n\n    const text2Send = \"Track ID removed:\\n\" + cleanLinks.join(\"\\n\");\n    return sendPlainText(message.chat.id, text2Send);\n}\n\nasync function b23Remover (url) {\n    const r = await fetch(url)\n    const v = r.url\n    const u = new URL(v)\n    return u.origin + u.pathname\n}\n",[91,940,941,955,973,981,986,1024,1051,1069,1073,1099,1111,1127,1159,1176,1195,1200,1204,1240,1265,1269,1273,1287,1306,1322,1342,1362],{"__ignoreMap":101},[105,942,943,945,947,949,951,953],{"class":107,"line":108},[105,944,464],{"class":111},[105,946,467],{"class":111},[105,948,716],{"class":173},[105,950,178],{"class":177},[105,952,725],{"class":187},[105,954,254],{"class":177},[105,956,957,960,962,965,967,969,971],{"class":107,"line":130},[105,958,959],{"class":111},"    if",[105,961,239],{"class":177},[105,963,964],{"class":119},"!",[105,966,725],{"class":215},[105,968,218],{"class":177},[105,970,822],{"class":227},[105,972,254],{"class":177},[105,974,975,978],{"class":107,"line":144},[105,976,977],{"class":111},"        return",[105,979,980],{"class":177},";\n",[105,982,983],{"class":107,"line":257},[105,984,985],{"class":177},"    }\n",[105,987,988,991,994,996,1000,1003,1006,1009,1012,1016,1019,1022],{"class":107,"line":281},[105,989,990],{"class":111},"    const",[105,992,993],{"class":115}," b23Reg",[105,995,120],{"class":119},[105,997,999],{"class":998},"sDaw7"," /b23",[105,1001,1002],{"class":119},"\\.",[105,1004,1005],{"class":998},"tv",[105,1007,1008],{"class":119},"\\/",[105,1010,1011],{"class":545},"[a-zA-Z0-9]",[105,1013,1015],{"class":1014},"sYoRg","+",[105,1017,1018],{"class":998},"/",[105,1020,1021],{"class":111},"g",[105,1023,980],{"class":177},[105,1025,1026,1028,1030,1032,1035,1037,1040,1042,1044,1046,1048],{"class":107,"line":308},[105,1027,959],{"class":111},[105,1029,239],{"class":177},[105,1031,964],{"class":119},[105,1033,1034],{"class":215},"b23Reg",[105,1036,218],{"class":177},[105,1038,1039],{"class":173},"test",[105,1041,178],{"class":177},[105,1043,725],{"class":215},[105,1045,218],{"class":177},[105,1047,822],{"class":227},[105,1049,1050],{"class":177},")) {\n",[105,1052,1053,1056,1058,1061,1063,1066],{"class":107,"line":342},[105,1054,1055],{"class":215},"        console",[105,1057,218],{"class":177},[105,1059,1060],{"class":173},"log",[105,1062,178],{"class":177},[105,1064,1065],{"class":140},"'No match found'",[105,1067,1068],{"class":177},");\n",[105,1070,1071],{"class":107,"line":366},[105,1072,985],{"class":177},[105,1074,1075,1077,1080,1082,1084,1086,1088,1090,1093,1095,1097],{"class":107,"line":386},[105,1076,990],{"class":111},[105,1078,1079],{"class":115}," b23Links",[105,1081,120],{"class":119},[105,1083,817],{"class":215},[105,1085,218],{"class":177},[105,1087,822],{"class":221},[105,1089,218],{"class":177},[105,1091,1092],{"class":173},"match",[105,1094,178],{"class":177},[105,1096,1034],{"class":275},[105,1098,1068],{"class":177},[105,1100,1101,1103,1106,1108],{"class":107,"line":395},[105,1102,990],{"class":111},[105,1104,1105],{"class":115}," cleanLinks",[105,1107,120],{"class":119},[105,1109,1110],{"class":177}," [];\n",[105,1112,1113,1115,1119,1121,1124],{"class":107,"line":419},[105,1114,713],{"class":111},[105,1116,1118],{"class":1117},"sC09Y"," Promise",[105,1120,218],{"class":177},[105,1122,1123],{"class":173},"all",[105,1125,1126],{"class":177},"(\n",[105,1128,1129,1132,1134,1137,1139,1142,1144,1147,1149,1152,1154,1157],{"class":107,"line":425},[105,1130,1131],{"class":215},"        b23Links",[105,1133,218],{"class":177},[105,1135,1136],{"class":173},"map",[105,1138,178],{"class":177},[105,1140,1141],{"class":187},"link",[105,1143,191],{"class":111},[105,1145,1146],{"class":173}," b23Remover",[105,1148,178],{"class":177},[105,1150,1151],{"class":140},"'https://'",[105,1153,814],{"class":119},[105,1155,1156],{"class":275}," link",[105,1158,278],{"class":177},[105,1160,1161,1164,1167,1169,1172,1174],{"class":107,"line":594},[105,1162,1163],{"class":177},"    ).",[105,1165,1166],{"class":173},"then",[105,1168,178],{"class":177},[105,1170,1171],{"class":187},"result",[105,1173,191],{"class":111},[105,1175,194],{"class":177},[105,1177,1178,1181,1183,1186,1188,1191,1193],{"class":107,"line":600},[105,1179,1180],{"class":215},"        cleanLinks",[105,1182,218],{"class":177},[105,1184,1185],{"class":173},"push",[105,1187,178],{"class":177},[105,1189,1190],{"class":541},"...",[105,1192,1171],{"class":275},[105,1194,1068],{"class":177},[105,1196,1197],{"class":107,"line":623},[105,1198,1199],{"class":177},"    });\n",[105,1201,1202],{"class":107,"line":628},[105,1203,559],{"emptyLinePlaceholder":558},[105,1205,1206,1208,1211,1213,1216,1218,1221,1223,1225,1227,1230,1232,1234,1236,1238],{"class":107,"line":645},[105,1207,990],{"class":111},[105,1209,1210],{"class":115}," text2Send",[105,1212,120],{"class":119},[105,1214,1215],{"class":140}," \"Track ID removed:",[105,1217,808],{"class":119},[105,1219,1220],{"class":140},"\"",[105,1222,814],{"class":119},[105,1224,1105],{"class":215},[105,1226,218],{"class":177},[105,1228,1229],{"class":173},"join",[105,1231,178],{"class":177},[105,1233,1220],{"class":140},[105,1235,808],{"class":119},[105,1237,1220],{"class":140},[105,1239,1068],{"class":177},[105,1241,1242,1244,1246,1248,1250,1252,1254,1256,1258,1260,1263],{"class":107,"line":651},[105,1243,523],{"class":111},[105,1245,786],{"class":173},[105,1247,178],{"class":177},[105,1249,725],{"class":215},[105,1251,218],{"class":177},[105,1253,795],{"class":221},[105,1255,218],{"class":177},[105,1257,800],{"class":227},[105,1259,184],{"class":177},[105,1261,1262],{"class":275},"text2Send",[105,1264,1068],{"class":177},[105,1266,1267],{"class":107,"line":656},[105,1268,648],{"class":177},[105,1270,1271],{"class":107,"line":661},[105,1272,559],{"emptyLinePlaceholder":558},[105,1274,1275,1277,1279,1281,1283,1285],{"class":107,"line":667},[105,1276,464],{"class":111},[105,1278,467],{"class":111},[105,1280,1146],{"class":173},[105,1282,239],{"class":177},[105,1284,228],{"class":187},[105,1286,254],{"class":177},[105,1288,1289,1291,1294,1296,1298,1300,1302,1304],{"class":107,"line":672},[105,1290,990],{"class":111},[105,1292,1293],{"class":115}," r",[105,1295,120],{"class":119},[105,1297,576],{"class":111},[105,1299,889],{"class":173},[105,1301,178],{"class":177},[105,1303,228],{"class":275},[105,1305,231],{"class":177},[105,1307,1308,1310,1313,1315,1317,1319],{"class":107,"line":677},[105,1309,990],{"class":111},[105,1311,1312],{"class":115}," v",[105,1314,120],{"class":119},[105,1316,1293],{"class":215},[105,1318,218],{"class":177},[105,1320,1321],{"class":227},"url\n",[105,1323,1324,1326,1329,1331,1333,1335,1337,1340],{"class":107,"line":693},[105,1325,990],{"class":111},[105,1327,1328],{"class":115}," u",[105,1330,120],{"class":119},[105,1332,207],{"class":111},[105,1334,210],{"class":173},[105,1336,178],{"class":177},[105,1338,1339],{"class":275},"v",[105,1341,231],{"class":177},[105,1343,1344,1346,1348,1350,1353,1355,1357,1359],{"class":107,"line":710},[105,1345,523],{"class":111},[105,1347,1328],{"class":215},[105,1349,218],{"class":177},[105,1351,1352],{"class":227},"origin",[105,1354,814],{"class":119},[105,1356,1328],{"class":215},[105,1358,218],{"class":177},[105,1360,1361],{"class":227},"pathname\n",[105,1363,1364],{"class":107,"line":730},[105,1365,648],{"class":177},[81,1367,1369],{"id":1368},"webhook-注册相关","webhook 注册相关",[18,1371,1372],{},"后面的 registerWebhook、unRegisterWebhook、apiUrl 在没有特定需求的情况下不需要变动。",[18,1374,1375],{},"在 Cloudflare 部署后，就可以访问 aaa.bbb.workers.dev/registerWebhook 这个 url 注册 TG 的 webhook 服务。收到 Ok 就代表注册好了。",[18,1377,1378],{},[1379,1380],"img",{"alt":101,"src":1381},"https://static.031130.xyz/uploads/2024/12/30/5fd442bb18064.webp",[14,1383,1384],{"id":1384},"成果展示",[18,1386,1387],{},[1379,1388],{"alt":101,"src":1389},"https://static.031130.xyz/uploads/2024/12/30/3b0b929960840.webp",[1391,1392,1393],"style",{},"html pre.shiki code .sLKXg, html code.shiki .sLKXg{--shiki-default:#A626A4;--shiki-dark:#C678DD}html pre.shiki code .sNmU0, html code.shiki .sNmU0{--shiki-default:#986801;--shiki-dark:#E5C07B}html pre.shiki code .s_Sar, html code.shiki .s_Sar{--shiki-default:#0184BC;--shiki-dark:#56B6C2}html pre.shiki code .sW2Sy, html code.shiki .sW2Sy{--shiki-default:#A0A1A7;--shiki-default-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html pre.shiki code .s8iYz, html code.shiki .s8iYz{--shiki-default:#383A42;--shiki-default-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic}html pre.shiki code .s7GmK, html code.shiki .s7GmK{--shiki-default:#383A42;--shiki-dark:#E5C07B}html pre.shiki code .s2QsP, html code.shiki .s2QsP{--shiki-default:#E45649;--shiki-dark:#E5C07B}html pre.shiki code .sJa8x, html code.shiki .sJa8x{--shiki-default:#E45649;--shiki-dark:#E06C75}html pre.shiki code .sz0mV, html code.shiki .sz0mV{--shiki-default:#383A42;--shiki-dark:#E06C75}html pre.shiki code .st7oF, html code.shiki .st7oF{--shiki-default:#0184BC;--shiki-dark:#ABB2BF}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html pre.shiki code .sDaw7, html code.shiki .sDaw7{--shiki-default:#0184BC;--shiki-dark:#E06C75}html pre.shiki code .sYoRg, html code.shiki .sYoRg{--shiki-default:#0184BC;--shiki-dark:#D19A66}html pre.shiki code .sC09Y, html code.shiki .sC09Y{--shiki-default:#C18401;--shiki-dark:#E5C07B}",{"title":101,"searchDepth":130,"depth":130,"links":1395},[1396,1397,1398,1404],{"id":16,"depth":130,"text":16},{"id":49,"depth":130,"text":50},{"id":76,"depth":130,"text":76,"children":1399},[1400,1401,1402,1403],{"id":83,"depth":144,"text":83},{"id":160,"depth":144,"text":160},{"id":431,"depth":144,"text":431},{"id":1368,"depth":144,"text":1369},{"id":1384,"depth":130,"text":1384},[1406,1412],{"title":1407,"path":1408,"stem":1409,"date":1410,"lang":1411,"children":-1},"基于 Cloudflare Workers 实现的在线服务状态检测告警系统","/2025/01/18/service-status-monitor-based-on-cloudflare-workers","posts/zh/service-status-monitor-based-on-cloudflare-workers","2025-01-18 02:00:08","zh-CN",{"title":1413,"path":1414,"stem":1415,"date":1416,"lang":1411,"children":-1},"2024年，Firefox 是唯一还在坚持执行在线的 SSL 证书吊销状态检查的主流浏览器","/2024/11/19/firefox-is-the-only-mainstream-brower-doing-online-certificate-revocation-checks","posts/zh/firefox-is-the-only-mainstream-brower-doing-online-certificate-revocation-checks","2024-11-19 17:58:14",null,1766532348291]
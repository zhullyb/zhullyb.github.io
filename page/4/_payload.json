[{"data":1,"prerenderedAt":3549},["ShallowReactive",2],{"randomIndex/page/4/":3,"index-page-4":4,"posts-total":3548},5,[5,973,1159,1490,1535,2488,2656,2921,3073,3189],{"title":6,"date":7,"path":8,"tags":9,"body":14},"自建图床小记二——使用 Workers 为 R2 构建 Restful API","2024-08-13 22:58:26","/2024/08/13/build-restful-api-for-cloudflare-r2-with-cloudflare-workers",[10,11,12,13],"图床","Cloudflare","JavaScript","Python",{"type":15,"value":16,"toc":955},"minimark",[17,22,26,31,38,42,48,51,57,61,64,67,76,82,85,92,94,99,103,107,110,116,120,125,141,146,150,153,157,171,177,179,184,188,191,201,205,208,602,605,619,622,626,629,634,638,641,644,801,804,811,814,817,920,923,951],[18,19,21],"h2",{"id":20},"访问-r2-的两种方式","访问 R2 的两种方式",[23,24,25],"p",{},"一般来说，想要访问 Cloudflare R2 中的文件，会有两种方式。",[27,28,30],"h3",{"id":29},"一种是在-r2-的设置界面设置自定义域","一种是在 R2 的设置界面设置自定义域",[23,32,33],{},[34,35],"img",{"alt":36,"src":37},"设置自定义域","https://static.031130.xyz/uploads/2024/08/13/61fe9ede194af.webp",[27,39,41],{"id":40},"另一种是通过-cloudflare-workers-进行访问","另一种是通过 Cloudflare Workers 进行访问",[23,43,44],{},[34,45],{"alt":46,"src":47},"通过 Cloudflare Workers","https://static.031130.xyz/uploads/2024/08/13/846164273571d.webp",[49,50],"hr",{},[23,52,53],{},[54,55,56],"strong",{},"那么应该选择哪种？选择 Cloudflare Workers！",[18,58,60],{"id":59},"为什么是-cloudflare-workers","为什么是 Cloudflare Workers？",[23,62,63],{},"要回答这个问题比较困难，但可以回答另一个问题——「为什么不设置自定义域实现直接访问？」",[27,65,66],{"id":66},"自定义域的访问存在限制",[23,68,69,70,75],{},"设置自定义域的访问方式存在较多的限制，让我们先来复习一下",[71,72,74],"a",{"href":73},"/2024/08/12/new-picbed-based-on-cloudflare-and-upyun/","上一篇博客中","提到的 DNS 解析方案 1",[23,77,78],{},[34,79],{"alt":80,"src":81},"DNS 解析方案 1","https://static.031130.xyz/uploads/2024/08/13/03d8243b67593.webp",[23,83,84],{},"在这里，我们需要将图床访问域名通过 NS 接入 DnsPod 实现境内外的分流，但 R2 所允许设置的自定义域必须是通过 NS 接入 Cloudflare 的，这存在冲突。那如果我们先将自定义域设置为通过 NS 接入 Cloudflare 的工具人域名，再将图床访问域名通过 CNAME 解析到工具人域名会不会有问题呢？恭喜你获得 403 Forbidden。",[23,86,87,88,91],{},"如果通过",[71,89,90],{"href":73},"上一篇文章","中的 DNS 解析方案 2 来进行 DNS 解析，能不能成功设置为 Cloudflare R2 的自定义域呢？也不行，Cloudflare R2 的自定义域会占用域名的解析，这意味着你无法将图床访问域名解析到用于分流的工具人域名。",[49,93],{},[23,95,96],{},[54,97,98],{},"结论：截至本文写作时间，设置自定义域的方案不适用于 DNS 分流的图床架构。",[27,100,102],{"id":101},"如何上传文件到-cloudflare-r2","如何上传文件到 Cloudflare R2？",[104,105,106],"h4",{"id":106},"网页端直接上传",[23,108,109],{},"最简单的上传方式是直接在 Cloudflare 进行网页上传，但这种方案不适合自动化脚本，也没法接入 Typora",[23,111,112],{},[34,113],{"alt":114,"src":115},"直接在网页端进行上传","https://static.031130.xyz/uploads/2024/08/13/b4d1b5b3edfae.webp",[104,117,119],{"id":118},"使用-amazon-s3-的兼容-api","使用 Amazon S3 的兼容 API",[121,122,124],"h5",{"id":123},"手动调用-s3-api","手动调用 S3 API",[23,126,127,128,134,135,140],{},"Cloudflare R2 被设计为兼容 Amazon S3 的存储方案，自然兼容 Amazon S3 的上传 API，在 ",[71,129,133],{"href":130,"rel":131},"https://developers.cloudflare.com/r2/api/s3/api/",[132],"nofollow","Cloudflare Docs 中有关于 S3 API 的实现情况","记载，大部分接口功能都是实现了的。但。。。但 S3 使用的是 ",[71,136,139],{"href":137,"rel":138},"https://docs.aws.amazon.com/zh_cn/IAM/latest/UserGuide/create-signed-request.html",[132],"AWS Signature"," 作为鉴权，你不会希望在每个自动化程序中都自己实现一次的。。。",[23,142,143],{},[34,144],{"alt":145,"src":145},"https://docs.aws.amazon.com/zh_cn/IAM/latest/UserGuide/images/sigV4-using-auth-header.png",[121,147,149],{"id":148},"使用-aws-cli-等-sdk","使用 aws-cli 等 SDK",[23,151,152],{},"使用 aws-cli 可以自动实现计算 AWS Signature，这是一种可行的方案，但我可能会在别的服务中使用到我的图床，不是所有的服务所处的环境都能够执行 shell 命令，也不是所有的编程语言都有现成的 SDK 可用。",[104,154,156],{"id":155},"使用-cloudflare-workers-构建-restful-api","使用 Cloudflare Workers 构建 Restful API",[23,158,159,164,165,170],{},[71,160,163],{"href":161,"rel":162},"https://developers.cloudflare.com/r2/api/workers/workers-api-usage/#5-access-your-r2-bucket-from-your-worker",[132],"在 Cloudflare Docs 中明确提出可以使用 Cloudflare Workers 访问 Cloudflare R2 Bucket，","通过 Workers 设置界面的按钮，可以非常方便的将 R2 Bucket 作为一个 R2Object 绑定到 JavaScript 的一个变量中，",[71,166,169],{"href":167,"rel":168},"https://developers.cloudflare.com/r2/api/workers/workers-api-reference/",[132],"这里有相关的开发文档","。",[23,172,173],{},[34,174],{"alt":175,"src":176},"绑定为变量","https://static.031130.xyz/uploads/2024/08/13/45e58b47f3aeb.webp",[49,178],{},[23,180,181],{},[54,182,183],{},"结论: 从易用性上来看，使用 Cloudflare Workers 构建 Restful API 这种上传文件的方案是最为合适的。",[18,185,187],{"id":186},"使用-cloudflare-workers-构建-restful-api-的方案有没有什么缺点","使用 Cloudflare Workers 构建 Restful API 的方案有没有什么缺点？",[23,189,190],{},"有。",[192,193,194,198],"ul",{},[195,196,197],"li",{},"Cloudflare Workers 的每日额度是有限的，在极端的流量下可能会用完（应该不会吧？）",[195,199,200],{},"Cloudflare Workers 的内存限制为 128MB，在上传下载 > 100MB 的文件时可能会出错。有这种体积上传需求的场景建议使用别的上传方案。",[18,202,204],{"id":203},"如何构建","如何构建？",[23,206,207],{},"直接贴代码",[209,210,215],"pre",{"className":211,"code":212,"language":213,"meta":214,"style":214},"language-javascript shiki shiki-themes one-light one-dark-pro","const hasValidHeader = (request, env) => {\n    return request.headers.get('X-Custom-Auth-Key') === env.AUTH_KEY_SECRET;\n};\n\nfunction authorizeRequest(request, env, key) {\n    switch (request.method) {\n        case 'PUT':\n        case 'DELETE':\n            return hasValidHeader(request, env);\n        case 'GET':\n            return true;\n        default:\n            return false;\n    }\n}\n\nexport default {\n    async fetch(request, env) {\n        const url = new URL(request.url);\n        const key = decodeURI(url.pathname.slice(1));\n\n        if (!authorizeRequest(request, env, key)) {\n            return new Response('Forbidden\\n', { status: 403 });\n        }\n\n        switch (request.method) {\n            case 'PUT':\n                const objectExists = await env.MY_BUCKET.get(key);\n\n                if (objectExists !== null) {\n                    if (request.headers.get('Overwrite') !== 'true') {\n                        return new Response('Object Already Exists\\n', { status: 409 });\n                    }\n                }\n\n                await env.MY_BUCKET.put(key, request.body);\n                return new Response(`Put ${key} successfully!\\n`);\n\n            case 'GET':\n                const object = await env.MY_BUCKET.get(key);\n\n                if (object === null) {\n                    return new Response('Object Not Found\\n', { status: 404 });\n                }\n\n                const headers = new Headers();\n                object.writeHttpMetadata(headers);\n                headers.set('etag', object.httpEtag);\n\n                return new Response(object.body, {\n                    headers,\n                });\n            case 'DELETE':\n                await env.MY_BUCKET.delete(key);\n                return new Response('Deleted!\\n');\n\n            default:\n                return new Response('Method Not Allowed\\n', {\n                    status: 405,\n                    headers: {\n                        Allow: 'PUT, GET, DELETE',\n                    },\n                });\n        }\n    },\n};\n","javascript","",[216,217,218,226,232,238,245,250,256,262,268,274,280,286,292,298,304,310,315,321,327,333,339,344,350,356,362,367,373,379,385,390,396,402,408,414,420,425,431,437,442,448,454,459,465,471,476,481,487,493,499,504,510,516,522,528,534,540,545,551,557,563,569,575,581,586,591,597],"code",{"__ignoreMap":214},[219,220,223],"span",{"class":221,"line":222},"line",1,[219,224,225],{},"const hasValidHeader = (request, env) => {\n",[219,227,229],{"class":221,"line":228},2,[219,230,231],{},"    return request.headers.get('X-Custom-Auth-Key') === env.AUTH_KEY_SECRET;\n",[219,233,235],{"class":221,"line":234},3,[219,236,237],{},"};\n",[219,239,241],{"class":221,"line":240},4,[219,242,244],{"emptyLinePlaceholder":243},true,"\n",[219,246,247],{"class":221,"line":3},[219,248,249],{},"function authorizeRequest(request, env, key) {\n",[219,251,253],{"class":221,"line":252},6,[219,254,255],{},"    switch (request.method) {\n",[219,257,259],{"class":221,"line":258},7,[219,260,261],{},"        case 'PUT':\n",[219,263,265],{"class":221,"line":264},8,[219,266,267],{},"        case 'DELETE':\n",[219,269,271],{"class":221,"line":270},9,[219,272,273],{},"            return hasValidHeader(request, env);\n",[219,275,277],{"class":221,"line":276},10,[219,278,279],{},"        case 'GET':\n",[219,281,283],{"class":221,"line":282},11,[219,284,285],{},"            return true;\n",[219,287,289],{"class":221,"line":288},12,[219,290,291],{},"        default:\n",[219,293,295],{"class":221,"line":294},13,[219,296,297],{},"            return false;\n",[219,299,301],{"class":221,"line":300},14,[219,302,303],{},"    }\n",[219,305,307],{"class":221,"line":306},15,[219,308,309],{},"}\n",[219,311,313],{"class":221,"line":312},16,[219,314,244],{"emptyLinePlaceholder":243},[219,316,318],{"class":221,"line":317},17,[219,319,320],{},"export default {\n",[219,322,324],{"class":221,"line":323},18,[219,325,326],{},"    async fetch(request, env) {\n",[219,328,330],{"class":221,"line":329},19,[219,331,332],{},"        const url = new URL(request.url);\n",[219,334,336],{"class":221,"line":335},20,[219,337,338],{},"        const key = decodeURI(url.pathname.slice(1));\n",[219,340,342],{"class":221,"line":341},21,[219,343,244],{"emptyLinePlaceholder":243},[219,345,347],{"class":221,"line":346},22,[219,348,349],{},"        if (!authorizeRequest(request, env, key)) {\n",[219,351,353],{"class":221,"line":352},23,[219,354,355],{},"            return new Response('Forbidden\\n', { status: 403 });\n",[219,357,359],{"class":221,"line":358},24,[219,360,361],{},"        }\n",[219,363,365],{"class":221,"line":364},25,[219,366,244],{"emptyLinePlaceholder":243},[219,368,370],{"class":221,"line":369},26,[219,371,372],{},"        switch (request.method) {\n",[219,374,376],{"class":221,"line":375},27,[219,377,378],{},"            case 'PUT':\n",[219,380,382],{"class":221,"line":381},28,[219,383,384],{},"                const objectExists = await env.MY_BUCKET.get(key);\n",[219,386,388],{"class":221,"line":387},29,[219,389,244],{"emptyLinePlaceholder":243},[219,391,393],{"class":221,"line":392},30,[219,394,395],{},"                if (objectExists !== null) {\n",[219,397,399],{"class":221,"line":398},31,[219,400,401],{},"                    if (request.headers.get('Overwrite') !== 'true') {\n",[219,403,405],{"class":221,"line":404},32,[219,406,407],{},"                        return new Response('Object Already Exists\\n', { status: 409 });\n",[219,409,411],{"class":221,"line":410},33,[219,412,413],{},"                    }\n",[219,415,417],{"class":221,"line":416},34,[219,418,419],{},"                }\n",[219,421,423],{"class":221,"line":422},35,[219,424,244],{"emptyLinePlaceholder":243},[219,426,428],{"class":221,"line":427},36,[219,429,430],{},"                await env.MY_BUCKET.put(key, request.body);\n",[219,432,434],{"class":221,"line":433},37,[219,435,436],{},"                return new Response(`Put ${key} successfully!\\n`);\n",[219,438,440],{"class":221,"line":439},38,[219,441,244],{"emptyLinePlaceholder":243},[219,443,445],{"class":221,"line":444},39,[219,446,447],{},"            case 'GET':\n",[219,449,451],{"class":221,"line":450},40,[219,452,453],{},"                const object = await env.MY_BUCKET.get(key);\n",[219,455,457],{"class":221,"line":456},41,[219,458,244],{"emptyLinePlaceholder":243},[219,460,462],{"class":221,"line":461},42,[219,463,464],{},"                if (object === null) {\n",[219,466,468],{"class":221,"line":467},43,[219,469,470],{},"                    return new Response('Object Not Found\\n', { status: 404 });\n",[219,472,474],{"class":221,"line":473},44,[219,475,419],{},[219,477,479],{"class":221,"line":478},45,[219,480,244],{"emptyLinePlaceholder":243},[219,482,484],{"class":221,"line":483},46,[219,485,486],{},"                const headers = new Headers();\n",[219,488,490],{"class":221,"line":489},47,[219,491,492],{},"                object.writeHttpMetadata(headers);\n",[219,494,496],{"class":221,"line":495},48,[219,497,498],{},"                headers.set('etag', object.httpEtag);\n",[219,500,502],{"class":221,"line":501},49,[219,503,244],{"emptyLinePlaceholder":243},[219,505,507],{"class":221,"line":506},50,[219,508,509],{},"                return new Response(object.body, {\n",[219,511,513],{"class":221,"line":512},51,[219,514,515],{},"                    headers,\n",[219,517,519],{"class":221,"line":518},52,[219,520,521],{},"                });\n",[219,523,525],{"class":221,"line":524},53,[219,526,527],{},"            case 'DELETE':\n",[219,529,531],{"class":221,"line":530},54,[219,532,533],{},"                await env.MY_BUCKET.delete(key);\n",[219,535,537],{"class":221,"line":536},55,[219,538,539],{},"                return new Response('Deleted!\\n');\n",[219,541,543],{"class":221,"line":542},56,[219,544,244],{"emptyLinePlaceholder":243},[219,546,548],{"class":221,"line":547},57,[219,549,550],{},"            default:\n",[219,552,554],{"class":221,"line":553},58,[219,555,556],{},"                return new Response('Method Not Allowed\\n', {\n",[219,558,560],{"class":221,"line":559},59,[219,561,562],{},"                    status: 405,\n",[219,564,566],{"class":221,"line":565},60,[219,567,568],{},"                    headers: {\n",[219,570,572],{"class":221,"line":571},61,[219,573,574],{},"                        Allow: 'PUT, GET, DELETE',\n",[219,576,578],{"class":221,"line":577},62,[219,579,580],{},"                    },\n",[219,582,584],{"class":221,"line":583},63,[219,585,521],{},[219,587,589],{"class":221,"line":588},64,[219,590,361],{},[219,592,594],{"class":221,"line":593},65,[219,595,596],{},"    },\n",[219,598,600],{"class":221,"line":599},66,[219,601,237],{},[23,603,604],{},"代码的大部分都是基于 Cloudflare Docs 中给出的样例，修改了几个小的优化点",[192,606,607,610,616],{},[195,608,609],{},"删除了 ALLOW_LIST 部分代码，默认所有文件都是可以被访问的",[195,611,612,613],{},"在上传一个文件时，如果目标路径存在同名文件，则不直接覆盖，而是返回 409 的异常 HTTP 相应，如果想要强制覆盖，则需要在 Http Header 中加入 ",[216,614,615],{},"Overwrite: true",[195,617,618],{},"解出请求路径时，使用 decodeURI( ) 方法先进行解码，解决文件路径中含有中文时会导致请求失败的问题。",[23,620,621],{},"填入代码后，还需要绑定两个变量，一个是 R2 Bucket",[23,623,624],{},[34,625],{"alt":214,"src":176},[23,627,628],{},"另一个是自己的管理密码",[23,630,631],{},[34,632],{"alt":214,"src":633},"https://static.031130.xyz/uploads/2024/08/14/96da1f62f5fe7.webp",[18,635,637],{"id":636},"如何使用-cloudflare-workers-构建的-restful-api-进行文件操作","如何使用 Cloudflare Workers 构建的 Restful API 进行文件操作？",[27,639,640],{"id":640},"上传",[23,642,643],{},"以 python 为例，上传一个文件 1MB.bin 到 /example/ 目录下，上传的 url 就是文件最终的存在路径。",[209,645,649],{"className":646,"code":647,"language":648,"meta":214,"style":214},"language-python shiki shiki-themes one-light one-dark-pro","import requests\n\nAUTH_KEY_SECRET='1145141919810'\n\nwith open('1MB.bin', ''rb) as f:\n    file_content = f.read()\n    \nrequests.put(\n    'https://r2.example.workers.dev/example/1MB.bin',\n    headers={\n        'X-Custom-Auth-Key': AUTH_KEY_SECRET,\n        'Overwrite': True   # 如果不需要强制覆盖可以删除这一行\n    }\n)\n","python",[216,650,651,661,665,679,683,713,730,735,746,754,765,777,792,796],{"__ignoreMap":214},[219,652,653,657],{"class":221,"line":222},[219,654,656],{"class":655},"sLKXg","import",[219,658,660],{"class":659},"s5ixo"," requests\n",[219,662,663],{"class":221,"line":228},[219,664,244],{"emptyLinePlaceholder":243},[219,666,667,671,675],{"class":221,"line":234},[219,668,670],{"class":669},"sYebD","AUTH_KEY_SECRET",[219,672,674],{"class":673},"sknuh","=",[219,676,678],{"class":677},"sDhpE","'1145141919810'\n",[219,680,681],{"class":221,"line":240},[219,682,244],{"emptyLinePlaceholder":243},[219,684,685,688,692,695,698,701,704,707,710],{"class":221,"line":3},[219,686,687],{"class":655},"with",[219,689,691],{"class":690},"s_Sar"," open",[219,693,694],{"class":659},"(",[219,696,697],{"class":677},"'1MB.bin'",[219,699,700],{"class":659},", ",[219,702,703],{"class":677},"''",[219,705,706],{"class":659},"rb) ",[219,708,709],{"class":655},"as",[219,711,712],{"class":659}," f:\n",[219,714,715,718,720,723,727],{"class":221,"line":252},[219,716,717],{"class":659},"    file_content ",[219,719,674],{"class":673},[219,721,722],{"class":659}," f.",[219,724,726],{"class":725},"slOjB","read",[219,728,729],{"class":659},"()\n",[219,731,732],{"class":221,"line":258},[219,733,734],{"class":659},"    \n",[219,736,737,740,743],{"class":221,"line":264},[219,738,739],{"class":659},"requests.",[219,741,742],{"class":725},"put",[219,744,745],{"class":659},"(\n",[219,747,748,751],{"class":221,"line":270},[219,749,750],{"class":677},"    'https://r2.example.workers.dev/example/1MB.bin'",[219,752,753],{"class":659},",\n",[219,755,756,760,762],{"class":221,"line":276},[219,757,759],{"class":758},"sp7wS","    headers",[219,761,674],{"class":673},[219,763,764],{"class":659},"{\n",[219,766,767,770,773,775],{"class":221,"line":282},[219,768,769],{"class":677},"        'X-Custom-Auth-Key'",[219,771,772],{"class":659},": ",[219,774,670],{"class":669},[219,776,753],{"class":659},[219,778,779,782,784,788],{"class":221,"line":288},[219,780,781],{"class":677},"        'Overwrite'",[219,783,772],{"class":659},[219,785,787],{"class":786},"sAGMh","True",[219,789,791],{"class":790},"sW2Sy","   # 如果不需要强制覆盖可以删除这一行\n",[219,793,794],{"class":221,"line":294},[219,795,303],{"class":659},[219,797,798],{"class":221,"line":300},[219,799,800],{"class":659},")\n",[27,802,803],{"id":803},"访问",[23,805,806,807,810],{},"通过浏览器直接访问 ",[216,808,809],{},"https://r2.example.workers.dev/example/1MB.bin"," 应该就能访问到",[27,812,813],{"id":813},"删除",[23,815,816],{},"仍然以 python 为例，删除刚才的文件",[209,818,820],{"className":646,"code":819,"language":648,"meta":214,"style":214},"import requests\n\nAUTH_KEY_SECRET='1145141919810'\n\nwith open('1MB.bin', ''rb) as f:\n    file_content = f.read()\n    \nrequests.delete(\n    'https://r2.example.workers.dev/example/1MB.bin',\n    headers={\n        'X-Custom-Auth-Key': AUTH_KEY_SECRET\n    }\n)\n",[216,821,822,828,832,840,844,864,876,880,889,895,903,912,916],{"__ignoreMap":214},[219,823,824,826],{"class":221,"line":222},[219,825,656],{"class":655},[219,827,660],{"class":659},[219,829,830],{"class":221,"line":228},[219,831,244],{"emptyLinePlaceholder":243},[219,833,834,836,838],{"class":221,"line":234},[219,835,670],{"class":669},[219,837,674],{"class":673},[219,839,678],{"class":677},[219,841,842],{"class":221,"line":240},[219,843,244],{"emptyLinePlaceholder":243},[219,845,846,848,850,852,854,856,858,860,862],{"class":221,"line":3},[219,847,687],{"class":655},[219,849,691],{"class":690},[219,851,694],{"class":659},[219,853,697],{"class":677},[219,855,700],{"class":659},[219,857,703],{"class":677},[219,859,706],{"class":659},[219,861,709],{"class":655},[219,863,712],{"class":659},[219,865,866,868,870,872,874],{"class":221,"line":252},[219,867,717],{"class":659},[219,869,674],{"class":673},[219,871,722],{"class":659},[219,873,726],{"class":725},[219,875,729],{"class":659},[219,877,878],{"class":221,"line":258},[219,879,734],{"class":659},[219,881,882,884,887],{"class":221,"line":264},[219,883,739],{"class":659},[219,885,886],{"class":725},"delete",[219,888,745],{"class":659},[219,890,891,893],{"class":221,"line":270},[219,892,750],{"class":677},[219,894,753],{"class":659},[219,896,897,899,901],{"class":221,"line":276},[219,898,759],{"class":758},[219,900,674],{"class":673},[219,902,764],{"class":659},[219,904,905,907,909],{"class":221,"line":282},[219,906,769],{"class":677},[219,908,772],{"class":659},[219,910,911],{"class":669},"AUTH_KEY_SECRET\n",[219,913,914],{"class":221,"line":288},[219,915,303],{"class":659},[219,917,918],{"class":221,"line":294},[219,919,800],{"class":659},[18,921,922],{"id":922},"参见",[192,924,925,932,938,945],{},[195,926,927],{},[71,928,931],{"href":929,"rel":930},"https://blog.yswtrue.com/yong-cloudflare-de-r2-he-worker-lai-zuo-wen-jian-tuo-guan/",[132],"用 cloudflare 的 R2 和 worker 来做文件托管",[195,933,934],{},[71,935,937],{"href":167,"rel":936},[132],"Workers API reference",[195,939,940],{},[71,941,944],{"href":942,"rel":943},"https://developers.cloudflare.com/r2/api/workers/workers-api-usage/",[132],"Use R2 from Workers",[195,946,947],{},[71,948,950],{"href":137,"rel":949},[132],"创建已签名的 AWS API 请求",[952,953,954],"style",{},"html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html pre.shiki code .sLKXg, html code.shiki .sLKXg{--shiki-default:#A626A4;--shiki-dark:#C678DD}html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html pre.shiki code .sYebD, html code.shiki .sYebD{--shiki-default:#383A42;--shiki-dark:#D19A66}html pre.shiki code .sknuh, html code.shiki .sknuh{--shiki-default:#383A42;--shiki-dark:#56B6C2}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html pre.shiki code .s_Sar, html code.shiki .s_Sar{--shiki-default:#0184BC;--shiki-dark:#56B6C2}html pre.shiki code .slOjB, html code.shiki .slOjB{--shiki-default:#383A42;--shiki-dark:#61AFEF}html pre.shiki code .sp7wS, html code.shiki .sp7wS{--shiki-default:#986801;--shiki-default-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html pre.shiki code .sW2Sy, html code.shiki .sW2Sy{--shiki-default:#A0A1A7;--shiki-default-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic}",{"title":214,"searchDepth":228,"depth":228,"links":956},[957,961,965,966,967,972],{"id":20,"depth":228,"text":21,"children":958},[959,960],{"id":29,"depth":234,"text":30},{"id":40,"depth":234,"text":41},{"id":59,"depth":228,"text":60,"children":962},[963,964],{"id":66,"depth":234,"text":66},{"id":101,"depth":234,"text":102},{"id":186,"depth":228,"text":187},{"id":203,"depth":228,"text":204},{"id":636,"depth":228,"text":637,"children":968},[969,970,971],{"id":640,"depth":234,"text":640},{"id":803,"depth":234,"text":803},{"id":813,"depth":234,"text":813},{"id":922,"depth":228,"text":922},{"title":974,"date":975,"path":976,"tags":977,"body":980},"自建图床小记一——图床架构与 DNS 解析","2024-08-12 17:07:11","/2024/08/12/new-picbed-based-on-cloudflare-and-upyun",[978,10,979,11],"CDN","Network",{"type":15,"value":981,"toc":1150},[982,988,991,994,1000,1003,1006,1015,1029,1033,1036,1039,1060,1066,1070,1074,1077,1089,1095,1098,1104,1109,1112,1116,1122,1125,1131,1139,1141],[983,984,985],"blockquote",{},[23,986,987],{},"一直以来，我使用的都是使用付费的第三方图床，可惜最近几年为了节省成本，境内的稳定性出现了一些问题。过去一年中光是我本人遇到的无法访问的情况就有三四次，其中两次持续时间超过 2 小时，甚至有网友特意来 at 我告知我博客使用的图床出问题了，还有两次是在我作品验收前 24 小时内出现，幸亏我及时切换了资源链接。此外，境外 CDN 也从原先的 Cloudflare 换掉了，目前海外的解析结果似乎只有一个在美国的节点，其余地区（尤其是日本香港新加坡等常用的落地地区）的访问质量不佳，Google 的 page speed test 甚至提示我的图片拖慢了网站加载速度。",[23,989,990],{},"基于上述种种原因，我开始选择自建图床，前前后后折腾了快一周后，新图床终于投入使用，目前我的博客已经完成了所有图片资源的切换。",[18,992,993],{"id":993},"架构设计",[23,995,996],{},[34,997],{"alt":998,"src":999},"图床架构设计图","https://static.031130.xyz/uploads/2024/08/12/80402e4da4ef7.webp",[23,1001,1002],{},"这一套架构使用 Dnspod 免费版实现在境内外的解析分流，将境内的流量导向又拍云 CDN 为境内的访客提供服务，在境外使用量大管饱的 Cloudflare CDN 节省成本，为全球提供加速访问。",[18,1004,1005],{"id":1005},"为什么是又拍云",[23,1007,1008,1009,1014],{},"如你所见，我的博客底部挂了又拍云的 logo。",[71,1010,1013],{"href":1011,"rel":1012},"https://www.upyun.com/league",[132],"又拍云联盟","为个人开发者提供了每个月 10GB 存储和 15GB 的免费 CDN 流量，在每年通过申请后会以 67 元无门槛代金券的形式发放到账号，也不用担心某个月超了一点点而付出额外的费用。",[23,1016,1017,1018,1023,1024],{},"相比之下，七牛云虽然控制台的前端 UI 不错，但出了这种事情导致其在我心里印象分极差: 「",[71,1019,1022],{"href":1020,"rel":1021},"https://blog.hanlin.press/2024/07/From-Shanxi-to-Qiniu/",[132],"从山西联通到组播IP：七牛云的奇怪视角（附分析和后日谈）","」",[71,1025,1028],{"href":1026,"rel":1027},"https://archive.md/ONeu3",[132],"Archived Here",[18,1030,1032],{"id":1031},"为什么是-cloudflare-r2","为什么是 Cloudflare R2",[23,1034,1035],{},"作为自己的图床，必须要保证稳定性，境内访问的稳定性可以先放到一边，最重要的就是保证源文件的稳定性。不同于在自己的 VPS 上存储图片的方案，使用 Cloudflare R2 作为储存不需要关注 VPS 到期以后的图片迁移问题。使用 Cloudflare R2 作为储存，免费用量对于个人站点来说绰绰有余，在 10GB 存储容量超出之前不用考虑别的问题，也不用担心资金支持不下去导致的麻烦。而不使用又拍云提供的 10GB 存储也可以节省这部分的代金券金额，让代金券尽可能多的抵扣境内 CDN 流量带来的费用。",[18,1037,1038],{"id":1038},"需要的东西",[192,1040,1041,1044,1047,1054],{},[195,1042,1043],{},"两个或两个以上的域名（其中一个需要备案）",[195,1045,1046],{},"Cloudflare 所支持的境外支付方式（PayPal 账号 / Visa Card / Master Card），用于开通 Cloudflare R2 和 Cloudflare SaaS 接入",[195,1048,1049,1053],{},[1050,1051,1052],"del",{},"很多很多钱","（其实没有很多，又拍云联盟每年的 67 元抵用券在我这里看来完全是够用的）",[195,1055,1056,1057],{},"聪明的大脑，能够快速敲击键盘的双手，",[1050,1058,1059],{},"能够支持你熬夜的心脏",[23,1061,1062],{},[1063,1064,1065],"em",{},"* 在这一套架构中引入了香港 VPS 进行反向代理，一来是防止国内 CDN 与 Cloudflare 的网络连接质量过差导致的回源失败，二来也是方便我在没有国际联网的情况下进行图片的上传，但如果没有条件其实是可以去掉的。",[18,1067,1069],{"id":1068},"dns-解析","DNS 解析",[23,1071,1072],{},[34,1073],{"alt":80,"src":81},[23,1075,1076],{},"如上图，将图床域名 NS 接入 DnsPod，工具人域名 NS 接入 Cloudflare 即可实现境内外分流的效果。",[1078,1079,1080,1083,1086],"ol",{},[195,1081,1082],{},"图床访问域名在境外 CNAME 解析到工具人域名",[195,1084,1085],{},"图床访问域名在境内 CNAME 解析到境内 CDN 服务商",[195,1087,1088],{},"工具人域名在 Cloudflare 上解析到任何站点都行，只需点亮解析时 Cloudflare CDN 代理按钮即可生效。",[23,1090,1091],{},[34,1092],{"alt":1093,"src":1094},"代理按钮","https://static.031130.xyz/uploads/2024/08/13/a0387d2919850.webp",[23,1096,1097],{},"但如果你的备案域名已经通过 NS 接入了 Cloudflare，可以采用下面这套架构。",[23,1099,1100],{},[34,1101],{"alt":1102,"src":1103},"DNS 解析方案 2","https://static.031130.xyz/uploads/2024/08/13/d03d7b3155514.webp",[23,1105,1106],{},[1063,1107,1108],{},"* 解析方案 2 中的图床访问域名和工具人域名可以是同属于同一二级域名的不同子域名",[23,1110,1111],{},"这种方案要多一步，把图床访问域名 CNAME 解析到用于分流的工具人域名。",[18,1113,1115],{"id":1114},"cloudflare-saas-接入","Cloudflare SaaS 接入",[23,1117,1118],{},[34,1119],{"alt":1120,"src":1121},"SaaS 接入","https://static.031130.xyz/uploads/2024/08/13/eb7186205b380.webp",[23,1123,1124],{},"SaaS 接入大概就是如图所示，此外还要配置 Cloudflare Workers 的域名访问",[23,1126,1127],{},[34,1128],{"alt":1129,"src":1130},"Cloudflare Workers 域名访问","https://static.031130.xyz/uploads/2024/08/13/782a665cabe05.webp",[23,1132,1133,1134,1138],{},"这样就能保证在境外访问图床域名时将请求打到 Cloudflare Workers 上了，关于使用 Cloudflare Workers 构建图床 Restful API 相关的内容我放在",[71,1135,1137],{"href":1136},"/2024/08/13/build-restful-api-for-cloudflare-r2-with-cloudflare-workers/","下一篇博客","讲。",[18,1140,922],{"id":922},[192,1142,1143],{},[195,1144,1145],{},[71,1146,1149],{"href":1147,"rel":1148},"https://www.eallion.com/cdn-cname-cloudflare/",[132],"图床 CDN CNAME 接入 Cloudflare SaaS 实现分流",{"title":214,"searchDepth":228,"depth":228,"links":1151},[1152,1153,1154,1155,1156,1157,1158],{"id":993,"depth":228,"text":993},{"id":1005,"depth":228,"text":1005},{"id":1031,"depth":228,"text":1032},{"id":1038,"depth":228,"text":1038},{"id":1068,"depth":228,"text":1069},{"id":1114,"depth":228,"text":1115},{"id":922,"depth":228,"text":922},{"title":1160,"date":1161,"path":1162,"tags":1163,"body":1168},"在 Linux 下使用 mitmproxy 抓取安卓手机上的 HTTPS 流量","2024-07-31 16:02:28","/2024/07/31/capture-android-https-traffic-on-linux-with-mitmproxy",[1164,979,1165,1166,1167],"mitmproxy","Linux","Archlinux","Android",{"type":15,"value":1169,"toc":1484},[1170,1173,1176,1211,1222,1225,1228,1235,1239,1296,1302,1305,1336,1340,1343,1408,1416,1419,1424,1427,1430,1435,1438,1443,1445,1481],[23,1171,1172],{},"纵使安卓下有小黄鸟 HttpCanary 这种抓包神器，但手机一块 6 英寸的小屏实在是不方便分析流量情况，还得是 PC 的屏幕更大一些，处理起流量信息来更得心应手一些。",[23,1174,1175],{},"把话说在前面，目前的安卓抓包有不小的限制",[192,1177,1178,1181],{},[195,1179,1180],{},"Android 7 以下的版本: 直接以普通用户的权限安装 ssl 证书即可被信任",[195,1182,1183,1184],{},"Android 7 以上的版本:\n",[192,1185,1186,1197],{},[195,1187,1188,1189,1192,1193,1196],{},"安全性较低的应用: ",[54,1190,1191],{},"需要使用 root 权限","将证书移动至 ",[216,1194,1195],{},"/system/etc/security/cacerts","使证书被系统信任",[195,1198,1199,1200,1205,1206,170],{},"安全性较高的应用（比如微信 7.0 以上的版本）: 在满足上一条条件的情况下，需要阻止第三方应用使用自带的 ssl 证书信任范围（绕过 SSL Pinning）。通常情况下需要额外的手段对目标应用进行篡改，比如使用 ",[71,1201,1204],{"href":1202,"rel":1203},"https://github.com/Fuzion24/JustTrustMe",[132],"justTrustMe"," 这个 xposed 模块，或者 ",[71,1207,1210],{"href":1208,"rel":1209},"https://github.com/frida/frida/",[132],"frida",[983,1212,1213],{},[23,1214,1215,1216,1221],{},"除此之外，Linux 版本 >= 5.5 的安卓设备也可以使用 ",[71,1217,1220],{"href":1218,"rel":1219},"https://github.com/gojue/ecapture",[132],"eCapture"," 这款基于 eBPF Linux 内核模块实现的抓包软件，算是种奇技淫巧。",[23,1223,1224],{},"本文只讨论 Android 7 以上版本中安全性较低的应用，因为我当前的抓包目标局限于一款安全性不高的外包软件。",[18,1226,1227],{"id":1227},"基本操作",[23,1229,1230,1231,1023],{},"见「",[71,1232,1234],{"href":1233},"/2024/02/29/capture-https-traffic-on-linux-with-mitmproxy/","在 Linux 下使用 mitmproxy 抓取 HTTPS 流量",[18,1236,1238],{"id":1237},"安装-ssl-证书","安装 ssl 证书",[209,1240,1244],{"className":1241,"code":1242,"language":1243,"meta":214,"style":214},"language-bash shiki shiki-themes one-light one-dark-pro","cp $HOME/.mitmproxy/mitmproxy-ca-cert.pem $(openssl x509 -subject_hash_old -in $HOME/.mitmproxy/mitmproxy-ca-cert.pem | head -n 1).0\n","bash",[216,1245,1246],{"__ignoreMap":214},[219,1247,1248,1252,1256,1259,1262,1265,1268,1271,1274,1276,1278,1281,1284,1287,1290,1293],{"class":221,"line":222},[219,1249,1251],{"class":1250},"sAdtL","cp",[219,1253,1255],{"class":1254},"sJa8x"," $HOME",[219,1257,1258],{"class":677},"/.mitmproxy/mitmproxy-ca-cert.pem",[219,1260,1261],{"class":659}," $(",[219,1263,1264],{"class":1250},"openssl",[219,1266,1267],{"class":677}," x509",[219,1269,1270],{"class":786}," -subject_hash_old",[219,1272,1273],{"class":786}," -in",[219,1275,1255],{"class":1254},[219,1277,1258],{"class":677},[219,1279,1280],{"class":659}," | ",[219,1282,1283],{"class":1250},"head",[219,1285,1286],{"class":786}," -n",[219,1288,1289],{"class":786}," 1",[219,1291,1292],{"class":659},")",[219,1294,1295],{"class":677},".0\n",[23,1297,1298,1299,1301],{},"此时我们就可以在家目录下找到一个以 .0 结尾的证书文件，我们的目标是将其放到手机的 ",[216,1300,1195],{}," 路径下。",[23,1303,1304],{},"对于一些出厂安卓版本较低、system 分区采用可变文件系统的手机，我们可以很轻松的使用带有 root 权限的文件管理器将证书文件移动到对应的目录（我这里就是）；而对于出厂版本较高的手机，system 分区可能是不可写的，需要采用额外的奇技淫巧。",[983,1306,1307,1310,1313,1316,1319,1322],{},[23,1308,1309],{},"1、通过 ADB 将 HTTP Toolkit CA 证书推送到设备上。",[23,1311,1312],{},"2、从 /system/etc/security/cacerts/ 中复制所有系统证书到临时目录。",[23,1314,1315],{},"3、在 /system/etc/security/cacerts/ 上面挂载一个 tmpfs 内存文件系统。这实际上将一个可写的全新空文件系统放在了 /system 的一小部分上面。 将复制的系统证书移回到该挂载点。",[23,1317,1318],{},"4、将 HTTP Toolkit CA 证书也移动到该挂载点。",[23,1320,1321],{},"5、更新临时挂载点中所有文件的权限为 644，并将系统文件的 SELinux 标签设置为 system_file，以使其看起来像是合法的 Android 系统文件。",[23,1323,1324,1325,1330,1331,1023],{},"——",[71,1326,1329],{"href":1327,"rel":1328},"http://91fans.com.cn/post/certificate/",[132],"《安卓高版本安装系统证书 HTTPS 抓包 - 终极解决方案》"," 「",[71,1332,1335],{"href":1333,"rel":1334},"http://web.archive.org/web/20240801045307/http://91fans.com.cn/post/certificate/#gsc.tab=0",[132],"archived here",[18,1337,1339],{"id":1338},"让被抓包的应用流量经过-mitm-代理服务器","让被抓包的应用流量经过 mitm 代理服务器",[23,1341,1342],{},"mitmproxy 默认会在 pc 端的 8080 端口开启一个 http 代理服务器，我们要做的就是想办法让待抓包的应用流量被这个 http 代理服务器所代理。",[209,1344,1346],{"className":1241,"code":1345,"language":1243,"meta":214,"style":214},"[zhullyb@Archlinux ~]$ ip -br a\nlo               UNKNOWN        127.0.0.1/8 ::1/128\nenp0s31f6        UP             172.16.0.255/25 fe80::2df9:2927:cd44:65c/64\nwlp0s20f3        UP             192.168.20.212/24 fe80::a6bc:919:281e:dcab/64\ndocker0          DOWN           172.17.0.1/16 fe80::42:d1ff:febe:d513/64\n",[216,1347,1348,1353,1367,1381,1394],{"__ignoreMap":214},[219,1349,1350],{"class":221,"line":222},[219,1351,1352],{"class":659},"[zhullyb@Archlinux ~]$ ip -br a\n",[219,1354,1355,1358,1361,1364],{"class":221,"line":228},[219,1356,1357],{"class":1250},"lo",[219,1359,1360],{"class":677},"               UNKNOWN",[219,1362,1363],{"class":677},"        127.0.0.1/8",[219,1365,1366],{"class":677}," ::1/128\n",[219,1368,1369,1372,1375,1378],{"class":221,"line":234},[219,1370,1371],{"class":1250},"enp0s31f6",[219,1373,1374],{"class":677},"        UP",[219,1376,1377],{"class":677},"             172.16.0.255/25",[219,1379,1380],{"class":677}," fe80::2df9:2927:cd44:65c/64\n",[219,1382,1383,1386,1388,1391],{"class":221,"line":240},[219,1384,1385],{"class":1250},"wlp0s20f3",[219,1387,1374],{"class":677},[219,1389,1390],{"class":677},"             192.168.20.212/24",[219,1392,1393],{"class":677}," fe80::a6bc:919:281e:dcab/64\n",[219,1395,1396,1399,1402,1405],{"class":221,"line":3},[219,1397,1398],{"class":1250},"docker0",[219,1400,1401],{"class":677},"          DOWN",[219,1403,1404],{"class":677},"           172.17.0.1/16",[219,1406,1407],{"class":677}," fe80::42:d1ff:febe:d513/64\n",[23,1409,1410,1411,1415],{},"在这里我们能看到本机的无线网卡地址是 192.168.20.212，所以 http 代理服务器的地址就是 ",[71,1412,1413],{"href":1413,"rel":1414},"http://192.168.20.212:8080",[132]," 。（如果你的有线网卡和手机在同一局域网下，当然也可以用有线网卡的 ip 地址）",[23,1417,1418],{},"我们当然可以在安卓手机的 WIFI 连接页面填入 http 代理地址。",[23,1420,1421],{},[34,1422],{"alt":214,"src":1423},"https://static.031130.xyz/uploads/2024/08/12/66ab548080ed6.webp",[23,1425,1426],{},"但这对我来说似乎并不是一个好主意：一来并不是所有的应用都会默认使用 http 代理服务器，二来这回导致抓包目标不明确，非目标应用的流量也会经过代理服务器。",[23,1428,1429],{},"我选择了 Nekobox 这个常见的代理软件，它支持 http 代理服务器，且允许分应用代理。",[23,1431,1432],{},[34,1433],{"alt":214,"src":1434},"https://static.031130.xyz/uploads/2024/08/12/66ab54f08dfd6.webp",[23,1436,1437],{},"可以看到能正常抓取 https 流量",[23,1439,1440],{},[34,1441],{"alt":214,"src":1442},"https://static.031130.xyz/uploads/2024/08/12/66ab5970a6ac7.webp",[18,1444,922],{"id":922},[192,1446,1447,1454,1461,1468,1474],{},[195,1448,1449],{},[71,1450,1453],{"href":1451,"rel":1452},"https://ibukifalling.github.io/2023/06/07/Android-app-packet-capture/",[132],"安卓应用防抓包机制及一些绕过",[195,1455,1456],{},[71,1457,1460],{"href":1458,"rel":1459},"https://chorer.github.io/2022/05/19/A-%E5%AE%89%E5%8D%937.0%E7%B3%BB%E7%BB%9F%E6%8A%93%E5%8C%85%E6%96%B9%E6%A1%88/",[132],"安卓7.0+系统抓包方案",[195,1462,1463],{},[71,1464,1467],{"href":1465,"rel":1466},"https://www.cnblogs.com/snad/p/17449454.html",[132],"frida抓包",[195,1469,1470],{},[71,1471,1473],{"href":1218,"rel":1472},[132],"gojue/ecapture",[195,1475,1476],{},[71,1477,1480],{"href":1478,"rel":1479},"http://91fans.com.cn/post/certificate/#gsc.tab=0",[132],"安卓高版本安装系统证书 HTTPS 抓包 - 终极解决方案",[952,1482,1483],{},"html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .sJa8x, html code.shiki .sJa8x{--shiki-default:#E45649;--shiki-dark:#E06C75}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}",{"title":214,"searchDepth":228,"depth":228,"links":1485},[1486,1487,1488,1489],{"id":1227,"depth":228,"text":1227},{"id":1237,"depth":228,"text":1238},{"id":1338,"depth":228,"text":1339},{"id":922,"depth":228,"text":922},{"title":1491,"date":1492,"path":1493,"tags":1494,"body":1498},"为中柏 N100 小主机开启来电自启","2024-07-22 23:31:51","/2024/07/22/enable-ac-power-loss-for-jumper-n100",[1495,1496,1497],"Hardware","HomeServer","笔记",{"type":15,"value":1499,"toc":1533},[1500,1503,1506,1509,1514,1517,1528],[23,1501,1502],{},"因为收到通知，寝室过两天要断电 20 分钟，所以需要打开 N100 家里云的来电自启功能。",[23,1504,1505],{},"正常关机短暂等待数秒后，开机，狂按 Delete 键进入 BIOS。",[23,1507,1508],{},"在 Advanced 选项中选择「OEM Configuration」",[23,1510,1511],{},[34,1512],{"alt":214,"src":1513},"https://static.031130.xyz/uploads/2024/08/12/669e7e6ae10a4.webp",[23,1515,1516],{},"可以在最后一行「AC Power Loss」中选择模式。",[192,1518,1519,1522,1525],{},[195,1520,1521],{},"Power Off: 关闭相关功能。",[195,1523,1524],{},"Power On: 传统意义上的来电自启，只要接通电源就会自启动。",[195,1526,1527],{},"Last State: 只有在上次关机是意外断电导致时，接通电源才会自启动。",[23,1529,1530],{},[34,1531],{"alt":214,"src":1532},"https://static.031130.xyz/uploads/2024/08/12/669e7e5ab7ad6.webp",{"title":214,"searchDepth":228,"depth":228,"links":1534},[],{"title":1536,"date":1537,"path":1538,"tags":1539,"body":1543},"我的博客被完整地反向代理，并自动翻译成了繁体中文","2024-07-18 11:22:37","/2024/07/18/my-blog-is-completely-proxied-and-translated-into-traditional-chinese",[1540,979,11,1541,1542],"Blog","waline","umami",{"type":15,"value":1544,"toc":2478},[1545,1549,1552,1555,1561,1570,1573,1579,1582,1588,1649,1655,1658,1665,1667,1670,1673,1678,1689,1696,1701,1704,1709,1712,1717,1723,1726,1729,1735,1737,1744,1774,1778,1782,1793,2077,2081,2084,2087,2095,2412,2415,2421,2423,2426,2432,2439,2443,2450,2455,2464,2467,2470,2475],[18,1546,1548],{"id":1547},"_20240820更新","2024.08.20更新",[23,1550,1551],{},"我将境外的 Github Pages 解析停了，所有流量全部指向我的 HK 的 vps。",[23,1553,1554],{},"访问对方站点 /?about/ 时，在我服务器 /about/ 收到了一个奇怪的请求，访问对方别的路径时也会在我服务器的对应路径收到请求，UA 伪装成了 Google 家的爬虫:",[23,1556,1557],{},[34,1558],{"alt":1559,"src":1560},"caddy 日志","https://static.031130.xyz/uploads/2024/08/20/82e8dc389f081.webp",[23,1562,1563,1564,1569],{},"（关于为什么有 Mozilla 字段，可以参见 ",[71,1565,1568],{"href":1566,"rel":1567},"https://imbearchild.cyou/archives/2024/04/yes-browser-are-faking-to-be-firefox/",[132],"《是的，所有现代浏览器都假装自己是火狐》","）",[23,1571,1572],{},"这个 ip 的归属地是新加坡 Cogent，合理怀疑是对方的源站 IP（也有可能只是对方用于请求的爬虫 ip）。直接通过 ip 访问对方站点，发现是 lnmp 的安装成功提示:",[23,1574,1575],{},[34,1576],{"alt":1577,"src":1578},"ip 访问","https://static.031130.xyz/uploads/2024/08/20/4d181fd0bcc11.webp",[23,1580,1581],{},"我注意到对方站点在 html 结尾处加了如下字段",[23,1583,1584],{},[34,1585],{"alt":1586,"src":1587},"这里是直接请求的 archive 存档，所以有 archive 前缀","https://static.031130.xyz/uploads/2024/08/20/057a829ec9e4a.webp",[209,1589,1593],{"className":1590,"code":1591,"language":1592,"meta":214,"style":214},"language-html shiki shiki-themes one-light one-dark-pro","\u003C!-- freevslinks -->\u003Cdiv style=\"display:none\">\u003Ca href=\"http://www.xxfseo.com/?time=1721267439\">xxfseo.com\u003C/a>\u003C/div>\u003C!-- /freevslinks -->\n","html",[216,1594,1595],{"__ignoreMap":214},[219,1596,1597,1600,1603,1606,1609,1611,1614,1618,1620,1623,1625,1628,1630,1633,1636,1638,1641,1643,1646],{"class":221,"line":222},[219,1598,1599],{"class":790},"\u003C!-- freevslinks -->",[219,1601,1602],{"class":659},"\u003C",[219,1604,1605],{"class":1254},"div",[219,1607,1608],{"class":786}," style",[219,1610,674],{"class":659},[219,1612,1613],{"class":677},"\"",[219,1615,1617],{"class":1616},"s-4uI","display:none",[219,1619,1613],{"class":677},[219,1621,1622],{"class":659},">\u003C",[219,1624,71],{"class":1254},[219,1626,1627],{"class":786}," href",[219,1629,674],{"class":659},[219,1631,1632],{"class":677},"\"http://www.xxfseo.com/?time=1721267439\"",[219,1634,1635],{"class":659},">xxfseo.com\u003C/",[219,1637,71],{"class":1254},[219,1639,1640],{"class":659},">\u003C/",[219,1642,1605],{"class":1254},[219,1644,1645],{"class":659},">",[219,1647,1648],{"class":790},"\u003C!-- /freevslinks -->\n",[23,1650,1651],{},[34,1652],{"alt":1653,"src":1654},"官网","https://static.031130.xyz/uploads/2024/08/20/b0449632623b2.webp",[23,1656,1657],{},"似乎是专业产生互联网垃圾的组织。",[23,1659,1660,1661,1664],{},"我目前已经屏蔽了来自 ",[216,1662,1663],{},"154.39.149.128"," 这个 ip 的访问请求，对方的站点暂时性崩盘，以后可能会换用别的 ip 来爬也说不准，先到此为止吧。",[49,1666],{},[18,1668,1669],{"id":1669},"现象",[23,1671,1672],{},"今早打开我的流量统计网站，发现我的博客有一个神奇的 referer",[23,1674,1675],{},[34,1676],{"alt":214,"src":1677},"https://static.031130.xyz/uploads/2024/08/12/66989d79e740c.webp",[23,1679,1680,1681,1686],{},"顶着我博客用的 favicon，但竟然不是我的域名。点进去一看，发现我的博客被翻译成了繁体中文，而且语句读上去也不是很通畅。",[71,1682,1685],{"href":1683,"rel":1684},"https://web.archive.org/web/20240718015038/https://theodorelobas.com/",[132],"Archived here.",[34,1687],{"alt":214,"src":1688},"https://static.031130.xyz/uploads/2024/08/12/66ab4ffa4eda3.webp",[23,1690,1691,1692],{},"再打开关于页一看，把我的博客域名给干掉了，只留下一个反代域名。",[71,1693,1685],{"href":1694,"rel":1695},"http://web.archive.org/web/20240718034705/https://theodorelobas.com/?about/",[132],[23,1697,1698],{},[34,1699],{"alt":214,"src":1700},"https://static.031130.xyz/uploads/2024/08/12/66989f7f73b90.webp",[23,1702,1703],{},"随机打开一个幸运页面，使用 F12 控制台查看流量情况，发现 umami 统计和 waline 评论都用的我个人部署的",[23,1705,1706],{},[34,1707],{"alt":214,"src":1708},"https://static.031130.xyz/uploads/2024/08/12/6698a0bf39f8d.webp",[23,1710,1711],{},"查询 ip 归属地，是老朋友 Cloudflare 泛播",[23,1713,1714],{},[34,1715],{"alt":214,"src":1716},"https://static.031130.xyz/uploads/2024/08/12/6698a101845a2.webp",[23,1718,1719],{},[34,1720],{"alt":1721,"src":1722},"url 上不明所以的问号","https://static.031130.xyz/uploads/2024/08/12/6698a2dd3d78a.webp",[23,1724,1725],{},"结合 url 上不明所以的问号，推测应该是 cloudflare workers 反向代理 + 调用翻译 api + 关键词替换。我小小更新了某个页面，发现对方站点也立马更新了，基本可以确定是反向代理。",[23,1727,1728],{},"whois 查询没有获得任何有用信息，一眼望去全是隐私保护。",[23,1730,1731],{},[34,1732],{"alt":1733,"src":1734},"whois 信息","https://static.031130.xyz/uploads/2024/08/12/6698a2deaa9d0.webp",[49,1736],{},[23,1738,1739,1740,1743],{},"事先声明，我的博客采用",[216,1741,1742],{},"CC BY-NC-SA 4.0","，我个人是非常欢迎任何人注明出处的情况下搬运甚至翻译我的文章的，甚至允许搬运到 csdn——只要你不开收费访问。但这种反代行为我是非常抵触的。",[1078,1745,1746,1756,1762,1768,1771],{},[195,1747,1748,1749,1751,1752],{},"文章被翻译成了繁体中文，但没有注明是翻译稿，直接把我本人的网名用繁体写了上去，这并不符合 ",[216,1750,1742],{}," 的要求。",[34,1753],{"alt":1754,"src":1755},"如果修改了原文需要做出说明","https://static.031130.xyz/uploads/2024/08/12/669929695144b.webp",[195,1757,1758,1759],{},"翻译质量很差，就连机翻都不应有这种奇怪的同义词替换，问了问熟悉繁中的朋友说是港台也没有这种用法，像是故意洗稿。",[34,1760],{"alt":214,"src":1761},"https://static.031130.xyz/uploads/2024/08/12/6699bdbab5f0a.webp",[195,1763,1764,1765],{},"反向代理了我的整个网站，但把我关于页上的博客链接给去掉了，我不认为这是善意的反代行为。",[71,1766,1685],{"href":1694,"rel":1767},[132],[195,1769,1770],{},"仍然在使用我的 waline 评论和 umami 统计。",[195,1772,1773],{},"没有给我任何事先的邮件说明或者评论留言，whois 开隐私保护的情况下，我找不到任何方法去联系这位域名的持有者。",[18,1775,1777],{"id":1776},"怎么办","怎么办？",[27,1779,1781],{"id":1780},"植入-js-进行跳转","植入 js 进行跳转",[23,1783,1784,1785,1788,1789,1792],{},"因为对方同步的及时性很强，高度怀疑是 cloudflare workers 反向代理，且评论和流量统计都直接原模原样用的是我的 js，我就注入一个 js 检测 host，如果不是我的域名或者本地调试时使用的 ",[216,1786,1787],{},"127.0.0.1"," or ",[216,1790,1791],{},"localhost","，则清空页面内容，给出文字提示，五秒后跳转到我的博客。代码如下:",[209,1794,1796],{"className":211,"code":1795,"language":213,"meta":214,"style":214},"const host = window.location.host\nif (host !== 'zhul.in' && ! host.startsWith('localhost') && ! host.startsWith('127.0.0.1')) {\n    document.body.innerHTML = [\n        '\u003Cdiv style=\"margin: auto;\">',\n        '\u003Ch1>当前页面并非本文作者的主页，将在五秒后跳转。\u003C/h1>',\n        '\u003Cbr />',\n        '\u003Ch1>请此站点持有者联系我: zhullyb@outlook.com\u003C/h1>',\n        '\u003C/div>',\n    ].join('')\n    document.body.style = [\n        'background-color: white;',\n        'color: black;',\n        'text-align: center;',\n        'font-size: 50px;',\n        'width: 100vw;',\n        'height: 100vh;',\n        'display: flex;',\n    ].join('')\n    setTimeout(() => {\n        window.location.href = 'https://zhul.in'\n    }, 5000)\n}\n",[216,1797,1798,1826,1884,1904,1911,1918,1925,1932,1939,1953,1969,1976,1983,1990,1997,2004,2011,2018,2030,2044,2063,2073],{"__ignoreMap":214},[219,1799,1800,1803,1807,1810,1814,1817,1821,1823],{"class":221,"line":222},[219,1801,1802],{"class":655},"const",[219,1804,1806],{"class":1805},"sNmU0"," host",[219,1808,1809],{"class":690}," =",[219,1811,1813],{"class":1812},"s7GmK"," window",[219,1815,1816],{"class":659},".",[219,1818,1820],{"class":1819},"s2QsP","location",[219,1822,1816],{"class":659},[219,1824,1825],{"class":1254},"host\n",[219,1827,1828,1831,1834,1838,1841,1844,1847,1850,1852,1854,1857,1859,1862,1865,1868,1870,1872,1874,1876,1878,1881],{"class":221,"line":228},[219,1829,1830],{"class":655},"if",[219,1832,1833],{"class":659}," (",[219,1835,1837],{"class":1836},"sz0mV","host",[219,1839,1840],{"class":690}," !==",[219,1842,1843],{"class":677}," 'zhul.in'",[219,1845,1846],{"class":690}," &&",[219,1848,1849],{"class":690}," !",[219,1851,1806],{"class":1812},[219,1853,1816],{"class":659},[219,1855,1856],{"class":1250},"startsWith",[219,1858,694],{"class":659},[219,1860,1861],{"class":677},"'localhost'",[219,1863,1864],{"class":659},") ",[219,1866,1867],{"class":690},"&&",[219,1869,1849],{"class":690},[219,1871,1806],{"class":1812},[219,1873,1816],{"class":659},[219,1875,1856],{"class":1250},[219,1877,694],{"class":659},[219,1879,1880],{"class":677},"'127.0.0.1'",[219,1882,1883],{"class":659},")) {\n",[219,1885,1886,1889,1891,1894,1896,1899,1901],{"class":221,"line":234},[219,1887,1888],{"class":1812},"    document",[219,1890,1816],{"class":659},[219,1892,1893],{"class":1819},"body",[219,1895,1816],{"class":659},[219,1897,1898],{"class":1254},"innerHTML",[219,1900,1809],{"class":690},[219,1902,1903],{"class":659}," [\n",[219,1905,1906,1909],{"class":221,"line":240},[219,1907,1908],{"class":677},"        '\u003Cdiv style=\"margin: auto;\">'",[219,1910,753],{"class":659},[219,1912,1913,1916],{"class":221,"line":3},[219,1914,1915],{"class":677},"        '\u003Ch1>当前页面并非本文作者的主页，将在五秒后跳转。\u003C/h1>'",[219,1917,753],{"class":659},[219,1919,1920,1923],{"class":221,"line":252},[219,1921,1922],{"class":677},"        '\u003Cbr />'",[219,1924,753],{"class":659},[219,1926,1927,1930],{"class":221,"line":258},[219,1928,1929],{"class":677},"        '\u003Ch1>请此站点持有者联系我: zhullyb@outlook.com\u003C/h1>'",[219,1931,753],{"class":659},[219,1933,1934,1937],{"class":221,"line":264},[219,1935,1936],{"class":677},"        '\u003C/div>'",[219,1938,753],{"class":659},[219,1940,1941,1944,1947,1949,1951],{"class":221,"line":270},[219,1942,1943],{"class":659},"    ].",[219,1945,1946],{"class":1250},"join",[219,1948,694],{"class":659},[219,1950,703],{"class":677},[219,1952,800],{"class":659},[219,1954,1955,1957,1959,1961,1963,1965,1967],{"class":221,"line":276},[219,1956,1888],{"class":1812},[219,1958,1816],{"class":659},[219,1960,1893],{"class":1819},[219,1962,1816],{"class":659},[219,1964,952],{"class":1254},[219,1966,1809],{"class":690},[219,1968,1903],{"class":659},[219,1970,1971,1974],{"class":221,"line":282},[219,1972,1973],{"class":677},"        'background-color: white;'",[219,1975,753],{"class":659},[219,1977,1978,1981],{"class":221,"line":288},[219,1979,1980],{"class":677},"        'color: black;'",[219,1982,753],{"class":659},[219,1984,1985,1988],{"class":221,"line":294},[219,1986,1987],{"class":677},"        'text-align: center;'",[219,1989,753],{"class":659},[219,1991,1992,1995],{"class":221,"line":300},[219,1993,1994],{"class":677},"        'font-size: 50px;'",[219,1996,753],{"class":659},[219,1998,1999,2002],{"class":221,"line":306},[219,2000,2001],{"class":677},"        'width: 100vw;'",[219,2003,753],{"class":659},[219,2005,2006,2009],{"class":221,"line":312},[219,2007,2008],{"class":677},"        'height: 100vh;'",[219,2010,753],{"class":659},[219,2012,2013,2016],{"class":221,"line":317},[219,2014,2015],{"class":677},"        'display: flex;'",[219,2017,753],{"class":659},[219,2019,2020,2022,2024,2026,2028],{"class":221,"line":323},[219,2021,1943],{"class":659},[219,2023,1946],{"class":1250},[219,2025,694],{"class":659},[219,2027,703],{"class":677},[219,2029,800],{"class":659},[219,2031,2032,2035,2038,2041],{"class":221,"line":329},[219,2033,2034],{"class":1250},"    setTimeout",[219,2036,2037],{"class":659},"(() ",[219,2039,2040],{"class":655},"=>",[219,2042,2043],{"class":659}," {\n",[219,2045,2046,2049,2051,2053,2055,2058,2060],{"class":221,"line":335},[219,2047,2048],{"class":1812},"        window",[219,2050,1816],{"class":659},[219,2052,1820],{"class":1819},[219,2054,1816],{"class":659},[219,2056,2057],{"class":1254},"href",[219,2059,1809],{"class":690},[219,2061,2062],{"class":677}," 'https://zhul.in'\n",[219,2064,2065,2068,2071],{"class":221,"line":341},[219,2066,2067],{"class":659},"    }, ",[219,2069,2070],{"class":786},"5000",[219,2072,800],{"class":659},[219,2074,2075],{"class":221,"line":346},[219,2076,309],{"class":659},[27,2078,2080],{"id":2079},"给-waline-和-umami-设置限制","给 waline 和 umami 设置限制",[23,2082,2083],{},"我博客使用的 waline 和 umami 均是我自己在 vercel 上架设的，我自然可以根据访客的 referer 来判断请求的来源。不过看了下，vercel.json 文件并不能直接实现这个需求，可能需要我们自己来编写一些简易的中间件。",[104,2085,2086],{"id":1541},"Waline",[23,2088,2089,2090,170],{},"waline 文档中有明确提到，waline 基于 Koa 框架开发，可以",[71,2091,2094],{"href":2092,"rel":2093},"https://waline.js.org/reference/server/plugin.html#%E5%9F%BA%E4%BA%8E%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%88%B6%E4%BD%9C",[132],"自行编写中间件",[209,2096,2100],{"className":2097,"code":2098,"language":2099,"meta":214,"style":214},"language-js shiki shiki-themes one-light one-dark-pro","// example/index.cjs\nconst Application = require('@waline/vercel');\n\nmodule.exports = Application({\n    plugins: [\n        {\n            middlewares: [\n                async (ctx, next) => {\n                    const referer = ctx.request.headers['referer'];\n                    if (referer) {\n                        if (\n                            !referer.include('localhost') &&\n                            !referer.include('127.0.0.1') &&\n                            !referer.include('zhul.in')\n                        ) {\n                            ctx.status = 403\n                            ctx.body = 'Forbidden'\n                            return\n                        }\n                    }\n                    await next();\n                },\n            ]\n        }\n    ],\n    async postSave(comment) {\n        // do what ever you want after comment saved\n    },\n});\n","js",[216,2101,2102,2107,2127,2131,2148,2159,2164,2173,2195,2229,2242,2250,2271,2289,2306,2311,2326,2339,2344,2349,2353,2364,2369,2374,2378,2383,2398,2403,2407],{"__ignoreMap":214},[219,2103,2104],{"class":221,"line":222},[219,2105,2106],{"class":790},"// example/index.cjs\n",[219,2108,2109,2111,2114,2116,2119,2121,2124],{"class":221,"line":228},[219,2110,1802],{"class":655},[219,2112,2113],{"class":1805}," Application",[219,2115,1809],{"class":690},[219,2117,2118],{"class":1250}," require",[219,2120,694],{"class":659},[219,2122,2123],{"class":677},"'@waline/vercel'",[219,2125,2126],{"class":659},");\n",[219,2128,2129],{"class":221,"line":234},[219,2130,244],{"emptyLinePlaceholder":243},[219,2132,2133,2136,2138,2141,2143,2145],{"class":221,"line":240},[219,2134,2135],{"class":1819},"module",[219,2137,1816],{"class":659},[219,2139,2140],{"class":1819},"exports",[219,2142,1809],{"class":690},[219,2144,2113],{"class":1250},[219,2146,2147],{"class":659},"({\n",[219,2149,2150,2153,2157],{"class":221,"line":3},[219,2151,2152],{"class":1254},"    plugins",[219,2154,2156],{"class":2155},"st7oF",":",[219,2158,1903],{"class":659},[219,2160,2161],{"class":221,"line":252},[219,2162,2163],{"class":659},"        {\n",[219,2165,2166,2169,2171],{"class":221,"line":258},[219,2167,2168],{"class":1254},"            middlewares",[219,2170,2156],{"class":2155},[219,2172,1903],{"class":659},[219,2174,2175,2178,2180,2184,2186,2189,2191,2193],{"class":221,"line":264},[219,2176,2177],{"class":655},"                async",[219,2179,1833],{"class":659},[219,2181,2183],{"class":2182},"s8iYz","ctx",[219,2185,700],{"class":659},[219,2187,2188],{"class":2182},"next",[219,2190,1864],{"class":659},[219,2192,2040],{"class":655},[219,2194,2043],{"class":659},[219,2196,2197,2200,2203,2205,2208,2210,2214,2216,2220,2223,2226],{"class":221,"line":270},[219,2198,2199],{"class":655},"                    const",[219,2201,2202],{"class":1805}," referer",[219,2204,1809],{"class":690},[219,2206,2207],{"class":1812}," ctx",[219,2209,1816],{"class":659},[219,2211,2213],{"class":2212},"sC09Y","request",[219,2215,1816],{"class":659},[219,2217,2219],{"class":2218},"sj4iG","headers",[219,2221,2222],{"class":659},"[",[219,2224,2225],{"class":677},"'referer'",[219,2227,2228],{"class":659},"];\n",[219,2230,2231,2234,2236,2239],{"class":221,"line":276},[219,2232,2233],{"class":655},"                    if",[219,2235,1833],{"class":659},[219,2237,2238],{"class":1836},"referer",[219,2240,2241],{"class":659},") {\n",[219,2243,2244,2247],{"class":221,"line":282},[219,2245,2246],{"class":655},"                        if",[219,2248,2249],{"class":659}," (\n",[219,2251,2252,2255,2257,2259,2262,2264,2266,2268],{"class":221,"line":288},[219,2253,2254],{"class":690},"                            !",[219,2256,2238],{"class":1812},[219,2258,1816],{"class":659},[219,2260,2261],{"class":1250},"include",[219,2263,694],{"class":659},[219,2265,1861],{"class":677},[219,2267,1864],{"class":659},[219,2269,2270],{"class":690},"&&\n",[219,2272,2273,2275,2277,2279,2281,2283,2285,2287],{"class":221,"line":294},[219,2274,2254],{"class":690},[219,2276,2238],{"class":1812},[219,2278,1816],{"class":659},[219,2280,2261],{"class":1250},[219,2282,694],{"class":659},[219,2284,1880],{"class":677},[219,2286,1864],{"class":659},[219,2288,2270],{"class":690},[219,2290,2291,2293,2295,2297,2299,2301,2304],{"class":221,"line":300},[219,2292,2254],{"class":690},[219,2294,2238],{"class":1812},[219,2296,1816],{"class":659},[219,2298,2261],{"class":1250},[219,2300,694],{"class":659},[219,2302,2303],{"class":677},"'zhul.in'",[219,2305,800],{"class":659},[219,2307,2308],{"class":221,"line":306},[219,2309,2310],{"class":659},"                        ) {\n",[219,2312,2313,2316,2318,2321,2323],{"class":221,"line":312},[219,2314,2315],{"class":1812},"                            ctx",[219,2317,1816],{"class":659},[219,2319,2320],{"class":2218},"status",[219,2322,1809],{"class":690},[219,2324,2325],{"class":786}," 403\n",[219,2327,2328,2330,2332,2334,2336],{"class":221,"line":317},[219,2329,2315],{"class":1812},[219,2331,1816],{"class":659},[219,2333,1893],{"class":2218},[219,2335,1809],{"class":690},[219,2337,2338],{"class":677}," 'Forbidden'\n",[219,2340,2341],{"class":221,"line":323},[219,2342,2343],{"class":655},"                            return\n",[219,2345,2346],{"class":221,"line":329},[219,2347,2348],{"class":659},"                        }\n",[219,2350,2351],{"class":221,"line":335},[219,2352,413],{"class":659},[219,2354,2355,2358,2361],{"class":221,"line":341},[219,2356,2357],{"class":655},"                    await",[219,2359,2360],{"class":1250}," next",[219,2362,2363],{"class":659},"();\n",[219,2365,2366],{"class":221,"line":346},[219,2367,2368],{"class":659},"                },\n",[219,2370,2371],{"class":221,"line":352},[219,2372,2373],{"class":659},"            ]\n",[219,2375,2376],{"class":221,"line":358},[219,2377,361],{"class":659},[219,2379,2380],{"class":221,"line":364},[219,2381,2382],{"class":659},"    ],\n",[219,2384,2385,2388,2391,2393,2396],{"class":221,"line":369},[219,2386,2387],{"class":655},"    async",[219,2389,2390],{"class":1250}," postSave",[219,2392,694],{"class":659},[219,2394,2395],{"class":2182},"comment",[219,2397,2241],{"class":659},[219,2399,2400],{"class":221,"line":375},[219,2401,2402],{"class":790},"        // do what ever you want after comment saved\n",[219,2404,2405],{"class":221,"line":381},[219,2406,596],{"class":659},[219,2408,2409],{"class":221,"line":387},[219,2410,2411],{"class":659},"});\n",[23,2413,2414],{},"成效立竿见影",[23,2416,2417],{},[34,2418],{"alt":2419,"src":2420},"效果图","https://static.031130.xyz/uploads/2024/08/12/6698d6570a780.webp",[104,2422,1542],{"id":1542},[23,2424,2425],{},"对 umami 的第一次请求是 script.js，这个请求是因为 html 头部添加了 umami 的 script 链接，这一次请求是不带有 referer 的，因此，对方站点使用我的 umami 统计并不会给我的博客访问统计造成错乱——umami 能够自行分辨对方的站点是否是当初添加网站时填写的站点。但我不能忍的地方在与 umami 的数据库会记录对方站点的流量情况，这占用了我的数据库空间。",[23,2427,2428],{},[34,2429],{"alt":2430,"src":2431},"数据库导出文件","https://static.031130.xyz/uploads/2024/08/12/6698d9c326739.webp",[23,2433,2434,2435,2438],{},"umami 使用 nextjs 开发，似乎并没有给我留可供自定义的接口，贸然修改源码则可能会在下次 merge 官方代码时遇到麻烦。为了给自己省点事，我选择不再让博客加载 ",[216,2436,2437],{},"https://umami.zhul.in/script.js"," ，而是将其中的内容复制保存下来，添加基于 host 的判断条件来决定是否向自建的 umami 服务发起请求。",[27,2440,2442],{"id":2441},"尝试向-cloudflare-举报滥用行为","尝试向 cloudflare 举报滥用行为",[23,2444,2445,2446],{},"cloudflare 是允许提交滥用举报的，这个域名正在使用 cloudflare 提供服务，因此我可以尝试举报，链接在这里: ",[71,2447,2448],{"href":2448,"rel":2449},"https://www.cloudflare.com/zh-cn/trust-hub/reporting-abuse/",[132],[23,2451,2452],{},[34,2453],{"alt":214,"src":2454},"https://static.031130.xyz/uploads/2024/08/12/669926eddb16e.webp",[23,2456,2457,2458,2460,2461,2463],{},"类别就可以选 DCMA，因为对方没有遵守 ",[216,2459,1742],{}," 协议给我的文章做出合理的署名，且我的博客关于页面不属于 ",[216,2462,1742],{}," 的范畴，对方是没有理由去对这一页做出二次分发的行为的。",[23,2465,2466],{},"不过我暂时还没这么做，我期待着我前面的几个方案能够奏效，我仍寄希望于对方会及时和我沟通，我也不太想为此去填一张额外的烦人的表单。",[18,2468,2469],{"id":2469},"最终效果",[23,2471,2472],{},[34,2473],{"alt":214,"src":2474},"https://static.031130.xyz/uploads/2024/08/12/66992ad0d2890.gif",[952,2476,2477],{},"html pre.shiki code .sW2Sy, html code.shiki .sW2Sy{--shiki-default:#A0A1A7;--shiki-default-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic}html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html pre.shiki code .sJa8x, html code.shiki .sJa8x{--shiki-default:#E45649;--shiki-dark:#E06C75}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html pre.shiki code .s-4uI, html code.shiki .s-4uI{--shiki-default:#383A42;--shiki-dark:#98C379}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html pre.shiki code .sLKXg, html code.shiki .sLKXg{--shiki-default:#A626A4;--shiki-dark:#C678DD}html pre.shiki code .sNmU0, html code.shiki .sNmU0{--shiki-default:#986801;--shiki-dark:#E5C07B}html pre.shiki code .s_Sar, html code.shiki .s_Sar{--shiki-default:#0184BC;--shiki-dark:#56B6C2}html pre.shiki code .s7GmK, html code.shiki .s7GmK{--shiki-default:#383A42;--shiki-dark:#E5C07B}html pre.shiki code .s2QsP, html code.shiki .s2QsP{--shiki-default:#E45649;--shiki-dark:#E5C07B}html pre.shiki code .sz0mV, html code.shiki .sz0mV{--shiki-default:#383A42;--shiki-dark:#E06C75}html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .st7oF, html code.shiki .st7oF{--shiki-default:#0184BC;--shiki-dark:#ABB2BF}html pre.shiki code .s8iYz, html code.shiki .s8iYz{--shiki-default:#383A42;--shiki-default-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic}html pre.shiki code .sC09Y, html code.shiki .sC09Y{--shiki-default:#C18401;--shiki-dark:#E5C07B}html pre.shiki code .sj4iG, html code.shiki .sj4iG{--shiki-default:#C18401;--shiki-dark:#E06C75}",{"title":214,"searchDepth":228,"depth":228,"links":2479},[2480,2481,2482,2487],{"id":1547,"depth":228,"text":1548},{"id":1669,"depth":228,"text":1669},{"id":1776,"depth":228,"text":1777,"children":2483},[2484,2485,2486],{"id":1780,"depth":234,"text":1781},{"id":2079,"depth":234,"text":2080},{"id":2441,"depth":234,"text":2442},{"id":2469,"depth":228,"text":2469},{"title":2489,"date":2490,"path":2491,"tags":2492,"body":2495},"尝试体验 Fedora COPR 中的 allow SSH 功能","2024-07-15 11:14:12","/2024/07/15/try-ssh-connection-in-fedora-copr",[2493,2494,1165],"Fedora","Experience",{"type":15,"value":2496,"toc":2650},[2497,2500,2505,2508,2519,2522,2525,2528,2533,2536,2541,2544,2549,2552,2558,2561,2567,2570,2576,2579,2585,2588,2591,2618,2621,2641,2644],[23,2498,2499],{},"在今年的早些时候，我在 COPR 看到了一个新出现的名为「allow SSH」的按钮。",[23,2501,2502],{},[34,2503],{"alt":214,"src":2504},"https://static.031130.xyz/uploads/2024/08/12/6694949de2921.webp",[23,2506,2507],{},"我在 COPR 的 User Documentation 中找到了对应的描述。",[983,2509,2510],{},[23,2511,2512,2513,2518],{},"Sometimes it is useful to manually debug failed builds not locally but within the Copr infrastructure. That’s why it is possible to allow SSH access to a copr builder. More information in the ",[71,2514,2517],{"href":2515,"rel":2516},"https://frostyx.cz/posts/ssh-access-to-copr-builders",[132],"SSH access to Copr builders"," blog post.",[23,2520,2521],{},"COPR 的这项功能允许包维护者远程访问自己没有的 CPU 架构或 Linux 发行版的 Linux 环境，大大减少打包时的痛点。",[18,2523,2524],{"id":2524},"开始使用",[23,2526,2527],{},"尝试点击按钮，获得如下界面，可以填写自己的 ssh 公钥，最多可以选择两台设备，如果选择的设备数量大于 2，则剩下的人物会维持在 pending 状态，直到被你 ssh 连接的构建机完成对应的构建任务。",[23,2529,2530],{},[34,2531],{"alt":214,"src":2532},"https://static.031130.xyz/uploads/2024/08/12/66949782e9177.webp",[23,2534,2535],{},"在该次构建的详情页面，等待 backend.log 按钮出现",[23,2537,2538],{},[34,2539],{"alt":214,"src":2540},"https://static.031130.xyz/uploads/2024/08/12/6694ca668003e.webp",[23,2542,2543],{},"在这个 url 对应的文件中，我们可以找到需要的 ssh 命令",[23,2545,2546],{},[34,2547],{"alt":214,"src":2548},"https://static.031130.xyz/uploads/2024/08/12/6694988c63899.webp",[23,2550,2551],{},"使用对应的 ssh 命令即可连上构建服务器",[23,2553,2554],{},[34,2555],{"alt":2556,"src":2557},"连接成功","https://static.031130.xyz/uploads/2024/08/12/669499b25cd1b.webp",[23,2559,2560],{},"先跑个 neofetch 看看，双核 16G，看着还行。",[23,2562,2563],{},[34,2564],{"alt":2565,"src":2566},"neofetch","https://static.031130.xyz/uploads/2024/08/12/669499b56e156.webp",[23,2568,2569],{},"随手跑了个 speedtest，竟然是千兆上下传对等的网速。",[23,2571,2572],{},[34,2573],{"alt":2574,"src":2575},"speedtest 结果","https://static.031130.xyz/uploads/2024/08/12/6694bc062f6a3.webp",[23,2577,2578],{},"在这台机子上，我们可以使用 builder-live.log 中的命令手动触发一次构建（不过我这里跑了一半就报错了，疑似是系统不够完善）",[23,2580,2581],{},[34,2582],{"alt":2583,"src":2584},"构建命令","https://static.031130.xyz/uploads/2024/08/12/6694b09a57e06.webp",[23,2586,2587],{},"不过很可惜，COPR 似乎并没有给我们中途去干预/调试构建过程的方案，仅仅是提供了一个可供自由操作的 Linux 环境。使用 copr-rpmbuild 命令可以进行对应的构建，但构建过程依然是在沙箱内进行，且没有给中途暂停/调试的机会。如果需要一步步手动的构建，还是建议使用 rpmbuild 命令进行。",[18,2589,2590],{"id":2590},"杂项",[192,2592,2593,2600,2606,2612],{},[195,2594,2595,2596,2599],{},"使用 ",[216,2597,2598],{},"copr-builder help"," 命令可以获取打包机的提示信息",[195,2601,2595,2602,2605],{},[216,2603,2604],{},"copr-builder show"," 命令查看剩余时间",[195,2607,2595,2608,2611],{},[216,2609,2610],{},"copr-builder prolong"," 可以延长打包机的有效时长",[195,2613,2595,2614,2617],{},[216,2615,2616],{},"copr-builder release"," 可以销毁当前的打包机环境",[18,2619,2620],{"id":2620},"限制",[192,2622,2623,2626,2629,2632,2635,2638],{},[195,2624,2625],{},"由于安全原因，构建结束后，只有 spec 文件和日志可以被存储到 copr 对应项目的服务器。打包机会使用一个独特的沙箱防止其构建产物被二次使用，哪怕是同一个用户都不行。",[195,2627,2628],{},"为了避免资源艾琳娜贵妃，同一用户在同一时刻最多只能使用两台具有 ssh 访问权限的打包机。",[195,2630,2631],{},"由于上面的两套规定，当 copr 构建失败时并不能自动启动 SSH 访问权限，需要用户手动在面板上 resubmit 当前任务并选择使用 SSH 访问权限。",[195,2633,2634],{},"打包机在默认情况下 1 小时后自动销毁，除非你手动申请延长时间，最长为 48 小时。",[195,2636,2637],{},"有些打包机只有 IPv6 的访问地址，你没得选。如果你无法连接 IPv6 网络，你可以取消当前的任务并重新发布并期待能给你下发一台具有 IPv4 访问地址的打包机（其实非常少），或者使用代理。",[195,2639,2640],{},"如果 SRPM 构建失败，则不能 resubmit 当前任务。这是 COPR 的实现逻辑问题，未来可能得到改善。",[18,2642,2643],{"id":2643},"参考",[23,2645,2646],{},[71,2647,2649],{"href":2515,"rel":2648},[132],"「SSH access to Copr builders」",{"title":214,"searchDepth":228,"depth":228,"links":2651},[2652,2653,2654,2655],{"id":2524,"depth":228,"text":2524},{"id":2590,"depth":228,"text":2590},{"id":2620,"depth":228,"text":2620},{"id":2643,"depth":228,"text":2643},{"title":2657,"date":2658,"path":2659,"tags":2660,"body":2662},"在 Arch Linux 下配置使用 HP Laser 103w 打印机无线打印","2024-07-14 18:30:33","/2024/07/14/config-hp-laser-103w-printer-for-archlinux",[1166,1495,1165,2661,1496,1497],"Printer",{"type":15,"value":2663,"toc":2914},[2664,2667,2670,2673,2679,2683,2692,2695,2711,2725,2733,2752,2763,2789,2791,2798,2812,2819,2822,2839,2860,2875,2878,2881,2887,2890,2893,2899,2902,2908,2911],[23,2665,2666],{},"我寝室有一台使用 wifi 连接的 HP Laser 103w 打印机，这些天刚好布置了新的 HomeServer，因此来记录一下这台打印机的配置过程，根据 HP 官网驱动包的名字「HP Laser 100 and HP Color Laser 150 Printer series Print Driver」推断，此过程应该能适用于所有的 HP Laser 100 及 HP Color Laser 150 系列的打印机。",[18,2668,2669],{"id":2669},"打印机联网",[23,2671,2672],{},"首先使用 Windows 操作系统完成打印机的联网工作，在路由器的网页管理界面可以看到这台打印机的局域网 ip 是 192.168.123.20 ，记录备用。如果有条件的话，尽量将打印机的 MAC 地址与 IP 地址绑定，避免路由器将该 IP 分配给别的设备。",[23,2674,2675],{},[34,2676],{"alt":2677,"src":2678},"路由器的网页管理界面","https://static.031130.xyz/uploads/2024/08/12/6693aa41c079b.webp",[18,2680,2682],{"id":2681},"安装-cups","安装 CUPS",[23,2684,2685,2686,2691],{},"随后按照 ArchWiki 的 ",[71,2687,2690],{"href":2688,"rel":2689},"https://wiki.archlinux.org/title/CUPS",[132],"CUPS 页面","进行相关配置，CUPS 是苹果公司开源的打印系统，是目前 Linux 下最主流的打印方案。",[23,2693,2694],{},"首先安装 cups ，如果需要「打印为 pdf」的功能，可以选装 cups-pdf。",[209,2696,2698],{"className":1241,"code":2697,"language":1243,"meta":214,"style":214},"pacman -S cups\n",[216,2699,2700],{"__ignoreMap":214},[219,2701,2702,2705,2708],{"class":221,"line":222},[219,2703,2704],{"class":1250},"pacman",[219,2706,2707],{"class":786}," -S",[219,2709,2710],{"class":677}," cups\n",[209,2712,2714],{"className":1241,"code":2713,"language":1243,"meta":214,"style":214},"pacman -S cups-pdf\n",[216,2715,2716],{"__ignoreMap":214},[219,2717,2718,2720,2722],{"class":221,"line":222},[219,2719,2704],{"class":1250},[219,2721,2707],{"class":786},[219,2723,2724],{"class":677}," cups-pdf\n",[23,2726,2727,2728,2732],{},"接着需要启动 cups 的服务，如果需要使用 cups 自带的 webui，可以直接启用 cups.service，这样就能在 ",[71,2729,2730],{"href":2730,"rel":2731},"http://localhost:631",[132]," 看到对应的配置页面。",[209,2734,2736],{"className":1241,"code":2735,"language":1243,"meta":214,"style":214},"systemctl enable cups.service --now\n",[216,2737,2738],{"__ignoreMap":214},[219,2739,2740,2743,2746,2749],{"class":221,"line":222},[219,2741,2742],{"class":1250},"systemctl",[219,2744,2745],{"class":677}," enable",[219,2747,2748],{"class":677}," cups.service",[219,2750,2751],{"class":786}," --now\n",[23,2753,2754,2755,2758,2759,2762],{},"而如果你正在使用一些集成度较高的 DE 如 KDE 或 GNOME，可以安装 DE 对应的打印机管理程序。在 Arch Linux 下，KDE 自带的打印机管理程序包名为 ",[216,2756,2757],{},"print-manager","，此外还需要安装安装 ",[216,2760,2761],{},"system-config-printer"," 打印机功能支持软件包。这种方案则不需要启动 cups.service，只需要启动 cups.socket 即可。",[209,2764,2766],{"className":1241,"code":2765,"language":1243,"meta":214,"style":214},"pacman -S print-manager system-config-printer\nsystemctl enable cups.socket\n",[216,2767,2768,2780],{"__ignoreMap":214},[219,2769,2770,2772,2774,2777],{"class":221,"line":222},[219,2771,2704],{"class":1250},[219,2773,2707],{"class":786},[219,2775,2776],{"class":677}," print-manager",[219,2778,2779],{"class":677}," system-config-printer\n",[219,2781,2782,2784,2786],{"class":221,"line":228},[219,2783,2742],{"class":1250},[219,2785,2745],{"class":677},[219,2787,2788],{"class":677}," cups.socket\n",[18,2790,2590],{"id":2590},[23,2792,2793,2794,2797],{},"在常规的流程中，通常会安装 ",[216,2795,2796],{},"ghostscript"," 来适应 Non-PDF 打印机，这台 HP Laser 103w 也不例外。",[209,2799,2801],{"className":1241,"code":2800,"language":1243,"meta":214,"style":214},"pacman -S ghostscript\n",[216,2802,2803],{"__ignoreMap":214},[219,2804,2805,2807,2809],{"class":221,"line":222},[219,2806,2704],{"class":1250},[219,2808,2707],{"class":786},[219,2810,2811],{"class":677}," ghostscript\n",[23,2813,2814,2815,2818],{},"如果是 PostScript 打印机可能还需要安装 ",[216,2816,2817],{},"gsfonts"," 包，但我这里不需要。",[18,2820,2821],{"id":2821},"安装驱动",[23,2823,2824,2825,2828,2829,2832,2833,2838],{},"OpenPrinting 维护的 ",[216,2826,2827],{},"foomatic"," 为很大一部分打印机提供的驱动文件，Gutenprint 维护的 gutenprint 包也包含了佳能(Canon)、爱普生(Epson)、利盟(Lexmark)、索尼(Sony)、奥林巴斯(Olympus) 以及 PCL 打印机的驱动程序。如果你的打印机型号和我的不同，可以尝试安装这些组织维护的驱动。具体的安装方法同样可以在 ArchWiki 的 ",[71,2830,2690],{"href":2688,"rel":2831},[132],"找到。我上一台打印机 HP LaserJet 1020 所需的驱动是在 ",[71,2834,2837],{"href":2835,"rel":2836},"https://aur.archlinux.org/packages/foo2zjs-nightly",[132],"AUR/foo2zjs-nightly"," 中取得的。",[23,2840,2841,2842,2847,2848,2853,2854,2859],{},"但 HP Laser 103w 的驱动程序都不在这些软件包中，在 HP 的官网我们可以找到",[71,2843,2846],{"href":2844,"rel":2845},"https://support.hp.com/cn-zh/drivers/hp-laser-100-printer-series/model/2100769190",[132],"这个页面","，包含了 HP Laser 103w 的 Linux 驱动",[71,2849,2852],{"href":2850,"rel":2851},"https://ftp.hp.com/pub/softlib/software13/printers/CLP150/uld-hp_V1.00.39.12_00.15.tar.gz",[132],"下载地址","（已在 web.archive.org 存档）。通过下载下来的文件名，我们可以看见名字为 uld-hp，理论上可以直接通过压缩包内的安装脚本进行安装，但我通过这个名字顺藤摸瓜，找到了 ",[71,2855,2858],{"href":2856,"rel":2857},"https://aur.archlinux.org/packages/hpuld",[132],"AUR/hpuld"," 可以直接进行安装。",[209,2861,2863],{"className":1241,"code":2862,"language":1243,"meta":214,"style":214},"yay -S hpuld\n",[216,2864,2865],{"__ignoreMap":214},[219,2866,2867,2870,2872],{"class":221,"line":222},[219,2868,2869],{"class":1250},"yay",[219,2871,2707],{"class":786},[219,2873,2874],{"class":677}," hpuld\n",[18,2876,2877],{"id":2877},"添加打印机",[23,2879,2880],{},"打开设置中的打印机设置后，选择添加打印机，CUPS 直接帮我们找到了局域网下的打印机，并自动开始搜索驱动程序（虽然没搜到）。",[23,2882,2883],{},[34,2884],{"alt":2885,"src":2886},"自动搜索","https://static.031130.xyz/uploads/2024/08/12/6693b6e81f9c4.webp",[23,2888,2889],{},"但如果没能自动检测到打印机，也可以使用手动选项中的 AppSocket/HP JetDirect 手动输入打印机的 ip 地址进行配置。",[23,2891,2892],{},"紧接着就到了选择驱动程序的阶段，厂商选择 HP，能够找到「HP Laser 10x Series」的选项，直接选择。",[23,2894,2895],{},[34,2896],{"alt":2897,"src":2898},"选择驱动","https://static.031130.xyz/uploads/2024/08/12/6693b76b9c1ca.webp",[23,2900,2901],{},"接着就可以完成打印机的添加。",[23,2903,2904],{},[34,2905],{"alt":2906,"src":2907},"完成添加","https://static.031130.xyz/uploads/2024/08/12/6693b7ba82d99.webp",[23,2909,2910],{},"随后便能正常打印文件啦！",[952,2912,2913],{},"html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}",{"title":214,"searchDepth":228,"depth":228,"links":2915},[2916,2917,2918,2919,2920],{"id":2669,"depth":228,"text":2669},{"id":2681,"depth":228,"text":2682},{"id":2590,"depth":228,"text":2590},{"id":2821,"depth":228,"text":2821},{"id":2877,"depth":228,"text":2877},{"title":2922,"date":2923,"path":2924,"tags":2925,"body":2930},"使用动态公网 ip + ddns 实现 rustdesk 的 ip 直连","2024-06-30 18:15:00","/2024/06/30/dynamic-public-ip-and-ddns-for-rustdesk",[1165,2926,2927,2928,2929,1496],"OpenSource Project","Shell Script","Rustdesk","Router",{"type":15,"value":2931,"toc":3067},[2932,2935,2938,2941,2945,2948,2951,2956,2959,2974,3021,3024,3027,3030,3033,3038,3041,3046,3053,3056,3059,3064],[23,2933,2934],{},"最近跟风整了一台 n100 的迷你主机装了个 Archlinux 当 HomeServer，搭配上了显卡欺骗器，平常一直远程使用，因此需要实现稳定的远程桌面连接。开源软件 Rustdesk 本身对 Linux 的适配尚可，可惜官方提供的服务器位于境外，且前一阵子因为诈骗相关的风波使得官方对连接做出了一些限制，应当使用自建服务器或者 ip 直连。",[23,2936,2937],{},"单从网络安全的角度出发，最佳实践应该是通过 wireguard 或者别的协议先接入局域网，然后使用局域网内的 ip 直连，这是最稳妥的，但我有点懒，而且我可能会在多个设备上都有控制 HomeServer 的需求，给所有设备配置 wireguard 是一件挺麻烦的事情，因此我决定放弃安全性，直接公网裸奔。",[23,2939,2940],{},"在学校宿舍的电信宽带提供了一个动态公网 ip，因此只需要设置好 ddns 和端口转发就可以拿到一个固定的 domain + port 提供给 rustdesk 直连。",[18,2942,2944],{"id":2943},"在被控端-rustdesk-允许直连访问","在被控端 Rustdesk 允许直连访问",[23,2946,2947],{},"在「设置」中的「安全」一栏选择「解锁安全设置」，拉到最下面的「安全」栏，勾选「允许 IP 直接访问」，并选择一个端口，范围在 1000 ~35535 之间且不要被本地的其他程序占用，Rustdesk 的默认值为 21118。",[23,2949,2950],{},"可以直接在局域网内的另一台设备进行测试，直接在 Rustdesk 中输入被控端的局域网 ip 和刚刚设置的端口，看看能不能访问得通，如果不行可能需要排查一下被控端访问墙设置的问题。",[23,2952,2953],{},[34,2954],{"alt":214,"src":2955},"https://static.031130.xyz/uploads/2024/08/12/66814701cf7ce.webp",[18,2957,2958],{"id":2958},"ddns",[23,2960,2961,2962,2967,2968,2973],{},"由于我的域名是交给 cloudflare 进行解析的，就找了个",[71,2963,2966],{"href":2964,"rel":2965},"https://github.com/yulewang/cloudflare-api-v4-ddns/",[132],"支持 cloudflare 的 ddns 脚本","，大致的部署过程可以参考 ",[71,2969,2972],{"href":2970,"rel":2971},"https://www.rclogs.com/2023/06/%25e8%2587%25aa%25e5%25bb%25ba%25e5%259f%25ba%25e4%25ba%258ecloudflare%25e7%259a%2584ddns",[132],"「自建基于Cloudflare的DDNS」","，不过我小改了一下脚本中获取公网 ipv4 的方式，直接 ssh 到路由器上获取当前的 ipv4 地址，不依赖外部的服务。",[209,2975,2977],{"className":1241,"code":2976,"language":1243,"meta":214,"style":214},"WAN_IP=`ssh -o HostKeyAlgorithms=+ssh-rsa -o PubkeyAcceptedKeyTypes=+ssh-rsa root@192.168.1.1 'ip -br a' | grep pppoe-wan | awk '{print $3}'`\n",[216,2978,2979],{"__ignoreMap":214},[219,2980,2981,2984,2986,2989,2992,2995,2998,3001,3004,3007,3010,3013,3015,3018],{"class":221,"line":222},[219,2982,2983],{"class":1254},"WAN_IP",[219,2985,674],{"class":673},[219,2987,2988],{"class":677},"`",[219,2990,2991],{"class":1250},"ssh",[219,2993,2994],{"class":786}," -o",[219,2996,2997],{"class":677}," HostKeyAlgorithms=+ssh-rsa ",[219,2999,3000],{"class":786},"-o",[219,3002,3003],{"class":677}," PubkeyAcceptedKeyTypes=+ssh-rsa root@192.168.1.1 'ip -br a' ",[219,3005,3006],{"class":659},"|",[219,3008,3009],{"class":1250}," grep",[219,3011,3012],{"class":677}," pppoe-wan ",[219,3014,3006],{"class":659},[219,3016,3017],{"class":1250}," awk",[219,3019,3020],{"class":677}," '{print $3}'`\n",[23,3022,3023],{},"理论上来说，有不少路由器自身就支持不少域名解析商",[18,3025,3026],{"id":3026},"端口转发",[23,3028,3029],{},"端口转发需要在路由器的后台设置进行，我这里路由器使用的是 openwrt 系统，大部分路由器应该都支持这个操作。",[23,3031,3032],{},"在「网络」-「防火墙」",[23,3034,3035],{},[34,3036],{"alt":214,"src":3037},"https://static.031130.xyz/uploads/2024/08/12/6681635804e68.webp",[23,3039,3040],{},"选择「端口转发」",[23,3042,3043],{},[34,3044],{"alt":214,"src":3045},"https://static.031130.xyz/uploads/2024/08/12/66817e416534c.webp",[23,3047,3048,3049,3052],{},"新建端口转发，共享名随便填，外部端口是你最终要在主控端输入的端口，内部 IP 地址是被控机 的 IP 地址，可以用 ",[216,3050,3051],{},"ip -br a"," 命令看到，内部端口就是上文在 Rustdesk 指定的端口号。",[18,3054,3055],{"id":3055},"效果",[23,3057,3058],{},"可以直接在主控端口输入 ddns 的域名和端口号，实现远程控制",[23,3060,3061],{},[34,3062],{"alt":214,"src":3063},"https://static.031130.xyz/uploads/2024/08/12/66817f77aae7e.webp",[952,3065,3066],{},"html pre.shiki code .sJa8x, html code.shiki .sJa8x{--shiki-default:#E45649;--shiki-dark:#E06C75}html pre.shiki code .sknuh, html code.shiki .sknuh{--shiki-default:#383A42;--shiki-dark:#56B6C2}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}",{"title":214,"searchDepth":228,"depth":228,"links":3068},[3069,3070,3071,3072],{"id":2943,"depth":228,"text":2944},{"id":2958,"depth":228,"text":2958},{"id":3026,"depth":228,"text":3026},{"id":3055,"depth":228,"text":3055},{"title":3074,"date":3075,"path":3076,"tags":3077,"body":3080},"使用 Windows 虚拟机运行虚拟专用网客户端为 Linux 提供内网环境","2024-05-23 01:07:44","/2024/05/23/setup-network-environment-for-non-linux-vpn-client-with-virtual-machine",[1165,3078,3079,979],"Windows","Virtual Machine",{"type":15,"value":3081,"toc":3180},[3082,3085,3088,3093,3096,3099,3102,3107,3110,3115,3124,3130,3133,3137,3140,3144,3153,3158,3161,3166,3169,3172,3177],[18,3083,3084],{"id":3084},"起因",[23,3086,3087],{},"最近在某家公司实习，公司内部的 git 部署在内网环境上，需要通过虚拟专用网的客户端（天翼云的 AONE）才能够正常访问。很可惜，客户端只提供了 Windows 和 MacOS 的版本。",[23,3089,3090],{},[34,3091],{"alt":214,"src":3092},"https://static.031130.xyz/uploads/2024/08/12/664e29866c1ab.webp",[23,3094,3095],{},"工作的代码总是要提交的，我也不想改变我的开发环境，又不希望在 Windows 上使用 git-for-windows 这个近乎简陋的工具进行代码提交，更别说还有一些别的内网服务接下来可能也会用到。所以最好的办法就是在 Linux 下也配置好能够访问内网的环境。",[18,3097,3098],{"id":3098},"理论",[23,3100,3101],{},"在 Windows 下使用 AONE 的网络拓扑是这样的",[23,3103,3104],{},[34,3105],{"alt":214,"src":3106},"https://static.031130.xyz/uploads/2024/08/12/664e2b93de6f9.webp",[23,3108,3109],{},"而我的方案则是使用 Windows 虚拟机开启 AONE，并在这台虚拟机上开一个 socks5 server 负责代理 Linux 宿主机需要打到内网服务的流量。网络拓扑如下",[23,3111,3112],{},[34,3113],{"alt":214,"src":3114},"https://static.031130.xyz/uploads/2024/08/12/664e2e1b0da09.webp",[23,3116,3117,3118,3123],{},"根据 bilibili 上",[71,3119,3122],{"href":3120,"rel":3121},"https://www.bilibili.com/video/BV11M4y1J7zP/",[132],"技术蛋老师的视频总结","，我们应该选择使用网卡桥接的网络配置，只有这个配置方式同时支持「宿主->虚拟机」和 「虚拟机->互联网」的网络。",[23,3125,3126],{},[34,3127],{"alt":3128,"src":3129},"图片来源: bilibili 技术蛋老师","https://static.031130.xyz/uploads/2024/08/12/664e2fbb4a36b.webp",[18,3131,3132],{"id":3132},"实操",[27,3134,3136],{"id":3135},"在-windows-虚拟机中开启虚拟专用网客户端","在 Windows 虚拟机中开启虚拟专用网客户端",[23,3138,3139],{},"开启 AONE，不做赘述",[27,3141,3143],{"id":3142},"开启-socks-server监听地址为-0000-或者设置为宿主机的-ip-地址","开启 socks server，监听地址为 0.0.0.0 （或者设置为宿主机的 IP 地址）",[23,3145,3146,3147,3152],{},"在「",[71,3148,3151],{"href":3149,"rel":3150},"https://imbearchild.cyou/",[132],"熊孩子(BearChild)","」的推荐下，我这里采用的是大名鼎鼎的二级射线（某 V 字开头的常见软件），直接从 GIthub Release 中下载 Windows X64 的压缩包，简单配置下即可，如果没有什么特殊需求的话可以只修改图中的两处配置。",[23,3154,3155],{},[34,3156],{"alt":214,"src":3157},"https://static.031130.xyz/uploads/2024/08/12/664e328cd83b3.webp",[23,3159,3160],{},"在终端中通过该软件的 run 命令即可开启服务",[23,3162,3163],{},[34,3164],{"alt":214,"src":3165},"https://static.031130.xyz/uploads/2024/08/12/664e32e6c350a.webp",[27,3167,3168],{"id":3168},"在宿主机进行测试",[23,3170,3171],{},"我这里使用的是 mzz2017 编写的 gg 命令进行代理，代理服务器的 ip 地址使用虚拟机下 ipconfig 命令获得的 ip 地址，端口号则对应上面配置文件中的 port 参数。",[23,3173,3174],{},[34,3175],{"alt":214,"src":3176},"https://static.031130.xyz/uploads/2024/08/12/664e33c3e8320.webp",[23,3178,3179],{},"这里 curl 百度得到了正确的相应，说明通道是通的，gg 也可以用于代理浏览器。经实测能够正常访问公司内网服务，不便在博客中展示。",{"title":214,"searchDepth":228,"depth":228,"links":3181},[3182,3183,3184],{"id":3084,"depth":228,"text":3084},{"id":3098,"depth":228,"text":3098},{"id":3132,"depth":228,"text":3132,"children":3185},[3186,3187,3188],{"id":3135,"depth":234,"text":3136},{"id":3142,"depth":234,"text":3143},{"id":3168,"depth":234,"text":3168},{"title":3190,"date":3191,"path":3192,"tags":3193,"body":3195},"以 Archlinux 中 makepkg 的方式打开 rpmbuild","2024-05-03 22:48:39","/2024/05/03/open-rpmbuild-in-the-way-of-archlinux-makepkg",[1166,2493,3194,1165],"RPM Package",{"type":15,"value":3196,"toc":3541},[3197,3200,3207,3272,3287,3294,3334,3341,3344,3347,3350,3363,3366,3381,3389,3392,3395,3398,3406,3409,3412,3415,3440,3447,3467,3474,3479,3486,3489,3496,3514,3517,3520,3527,3533,3535,3538],[23,3198,3199],{},"在 Redhat 系的发行版上打包软件的时候，会发现与 Archlinux 完全不同的思路。",[23,3201,3202,3203,3206],{},"Fedora 所代表的 Redhat 阵营一看就是那种宏大叙事的大型发行版，rpmbuild 在默认情况下会在 $HOME/rpmbuild 下的一系列文件夹进行构建过程。使用 ",[216,3204,3205],{},"rpmdev-setuptree"," 命令会创建好下面这些目录进行构建。",[209,3208,3210],{"className":1241,"code":3209,"language":1243,"meta":214,"style":214},"$ tree rpmbuild\nrpmbuild\n├── BUILD\n├── BUILDROOT\n├── RPMS\n├── SOURCES\n├── SPECS\n└── SRPMS\n",[216,3211,3212,3223,3228,3236,3243,3250,3257,3264],{"__ignoreMap":214},[219,3213,3214,3217,3220],{"class":221,"line":222},[219,3215,3216],{"class":1250},"$",[219,3218,3219],{"class":677}," tree",[219,3221,3222],{"class":677}," rpmbuild\n",[219,3224,3225],{"class":221,"line":228},[219,3226,3227],{"class":1250},"rpmbuild\n",[219,3229,3230,3233],{"class":221,"line":234},[219,3231,3232],{"class":1250},"├──",[219,3234,3235],{"class":677}," BUILD\n",[219,3237,3238,3240],{"class":221,"line":240},[219,3239,3232],{"class":1250},[219,3241,3242],{"class":677}," BUILDROOT\n",[219,3244,3245,3247],{"class":221,"line":3},[219,3246,3232],{"class":1250},[219,3248,3249],{"class":677}," RPMS\n",[219,3251,3252,3254],{"class":221,"line":252},[219,3253,3232],{"class":1250},[219,3255,3256],{"class":677}," SOURCES\n",[219,3258,3259,3261],{"class":221,"line":258},[219,3260,3232],{"class":1250},[219,3262,3263],{"class":677}," SPECS\n",[219,3265,3266,3269],{"class":221,"line":264},[219,3267,3268],{"class":1250},"└──",[219,3270,3271],{"class":677}," SRPMS\n",[23,3273,3274,3275,3280,3281,3286],{},"Fedora 将所有的软件的构建都集中在一个 rpmbuild 目录中，BUILD 是编译时使用的，BUILDROOT 是最终安装目录，RPMS 是存放最终产物的，SOURCES 是存放源码等文件的，SPECS 是存放指导构建过程的 spec 文件的，而 SRPMS 是 RH 系为了 reproducibility 而单独将 spec 和源文件打包的产物。除了 rpmbuild 命令以外，Fedora 还有一套使用容器构建 rpm 包的 ",[71,3276,3279],{"href":3277,"rel":3278},"https://fedoraproject.org/wiki/Using_Mock_to_test_package_builds",[132],"mock"," 构建系统，与 Archlinux 的 ",[71,3282,3285],{"href":3283,"rel":3284},"https://archlinux.org/packages/extra/any/devtools/",[132],"devtools"," 类似，这里不作过多叙述。",[23,3288,3289,3290,3293],{},"反观 Arch 的构建目录，",[1050,3291,3292],{},"就有一股浓浓的小作坊气味","。每个软件包自己拥有一个目录，指导构建过程的 PKGBUILD 文件、源文件和最终的产物都放在这个目录下，目录下的 src 和 pkg 文件夹分别对应 rpm 的 BUILD 和 BUILDROOT，前者是源文件被解压的目录和编译过程进行的目录，后者是软件最终的安装目录。",[209,3295,3297],{"className":1241,"code":3296,"language":1243,"meta":214,"style":214},"$ tree repo\nrepo\n├── src\n├── pkg\n└── PKGBUILD\n",[216,3298,3299,3308,3313,3320,3327],{"__ignoreMap":214},[219,3300,3301,3303,3305],{"class":221,"line":222},[219,3302,3216],{"class":1250},[219,3304,3219],{"class":677},[219,3306,3307],{"class":677}," repo\n",[219,3309,3310],{"class":221,"line":228},[219,3311,3312],{"class":1250},"repo\n",[219,3314,3315,3317],{"class":221,"line":234},[219,3316,3232],{"class":1250},[219,3318,3319],{"class":677}," src\n",[219,3321,3322,3324],{"class":221,"line":240},[219,3323,3232],{"class":1250},[219,3325,3326],{"class":677}," pkg\n",[219,3328,3329,3331],{"class":221,"line":3},[219,3330,3268],{"class":1250},[219,3332,3333],{"class":677}," PKGBUILD\n",[23,3335,3336,3337,3340],{},"好巧不巧，我偏偏习惯这个小作坊气息的 arch build system，每个软件包独享一个自己的目录，",[1050,3338,3339],{},"干净又卫生","。我自然也希望在 Fedora 下打 rpm 包的时候能够使用类似 Archlinux 下 makepkg 使用的目录结构。",[18,3342,3343],{"id":3343},"简单了解",[23,3345,3346],{},"在了解一系列 rpmbuild 中宏（macros）相关的知识后，我意识到这并非不可能。",[23,3348,3349],{},"使用如下的命令可以获取目前系统中定义的所有宏",[209,3351,3353],{"className":1241,"code":3352,"language":1243,"meta":214,"style":214},"rpm --showrc\n",[216,3354,3355],{"__ignoreMap":214},[219,3356,3357,3360],{"class":221,"line":222},[219,3358,3359],{"class":1250},"rpm",[219,3361,3362],{"class":786}," --showrc\n",[23,3364,3365],{},"而可以使用如下命令检查某一个宏目前被定义成了什么值",[209,3367,3369],{"className":1241,"code":3368,"language":1243,"meta":214,"style":214},"rpm --eval \"%{_topdir}\"\n",[216,3370,3371],{"__ignoreMap":214},[219,3372,3373,3375,3378],{"class":221,"line":222},[219,3374,3359],{"class":1250},[219,3376,3377],{"class":786}," --eval",[219,3379,3380],{"class":677}," \"%{_topdir}\"\n",[23,3382,3383,3384,3388],{},"更多关于宏的描述可以在 ",[71,3385,3386],{"href":3386,"rel":3387},"https://rpm-software-management.github.io/rpm/manual/macros.html",[132]," 获取",[18,3390,3391],{"id":3391},"修改路径",[23,3393,3394],{},"我们可以把定义成 $HOME/rpmbuild 的 %_topdir 重新定义成当前目录。",[23,3396,3397],{},"在 $HOME/.rpmmacros 中，去除顶部对 %_topdir 的定义，重新填上以下这些定义，即可初步完成我想要的效果。",[209,3399,3404],{"className":3400,"code":3402,"language":3403},[3401],"language-text","%_topdir    %(pwd)\n%_builddir %{_topdir}/src\n%_buildrootdir %{_topdir}/pkg\n%_rpmdir %{_topdir}\n%_sourcedir %{_topdir}\n%_specdir %{_topdir}\n%_srcrpmdir %{_topdir}\n","text",[216,3405,3402],{"__ignoreMap":214},[23,3407,3408],{},"现在在任何一个目录下执行 rpmbuild 相关命令，都会把 src 认为是构建目录，pkg 是最后安装目录，spec 文件和源文件早当前文件夹下，构建产物在当前文件夹下的 x86_64（或者别的架构名，这一层目录我还没有找到应该如何去掉）下。",[18,3410,3411],{"id":3411},"自动安装依赖文件",[23,3413,3414],{},"Fedora 中的 rpmbuild 不带有 makepkg -s 的功能，不能自动安装依赖。不过这也不意味着需要自己傻傻地去翻 spec 看看需要哪些构建依赖。可以使用 dnf 的 builddep 命令实现",[209,3416,3418],{"className":1241,"code":3417,"language":1243,"meta":214,"style":214},"sudo dnf builddep ./*.spec\n",[216,3419,3420],{"__ignoreMap":214},[219,3421,3422,3425,3428,3431,3434,3437],{"class":221,"line":222},[219,3423,3424],{"class":1250},"sudo",[219,3426,3427],{"class":677}," dnf",[219,3429,3430],{"class":677}," builddep",[219,3432,3433],{"class":677}," ./",[219,3435,3436],{"class":1819},"*",[219,3438,3439],{"class":677},".spec\n",[23,3441,3442,3443,3446],{},"不过 dnf 没有什么完成构建后自动卸载依赖的选项。",[1050,3444,3445],{},"这些依赖装完以后就一辈子赖在你的电脑上了","，才不是，可以在构建完成后使用 dnf 自带的后悔药功能撤销上一条命令执行的效果。",[209,3448,3450],{"className":1241,"code":3449,"language":1243,"meta":214,"style":214},"sudo dnf history undo 0\n",[216,3451,3452],{"__ignoreMap":214},[219,3453,3454,3456,3458,3461,3464],{"class":221,"line":222},[219,3455,3424],{"class":1250},[219,3457,3427],{"class":677},[219,3459,3460],{"class":677}," history",[219,3462,3463],{"class":677}," undo",[219,3465,3466],{"class":786}," 0\n",[23,3468,3469,3470,3473],{},"不过如果在 builddep 过程中，dnf 从 updates 源里更新了一些软件，那么它在 undo 时可能就没法获取更新前的软件版本。会有 ",[216,3471,3472],{},"Cannot find rpm nevra","  的提示",[23,3475,3476],{},[34,3477],{"alt":214,"src":3478},"https://static.031130.xyz/uploads/2024/08/12/6635018238ffa.webp",[23,3480,3481,3482,3485],{},"可以使用 ",[216,3483,3484],{},"--skip-broken"," 命令跳过那些没法找到老版本的软件，继续卸载其余的软件。",[18,3487,3488],{"id":3488},"自动下载源文件",[23,3490,3491,3492,3495],{},"很多使用 spec 中会在 source 里写上下载地址，而不是附上源码文件。rpm 似乎因为一些原因禁止了 rpmbuild 自动下载源文件的功能。可以通过在使用 rpmbuild 的时候带上 ",[216,3493,3494],{},"--undefine=_disable_source_fetch"," 取消定义这个行为，或者干脆在调用 rpmbuild 之前执行一遍",[209,3497,3499],{"className":1241,"code":3498,"language":1243,"meta":214,"style":214},"spectool -gR *.spec\n",[216,3500,3501],{"__ignoreMap":214},[219,3502,3503,3506,3509,3512],{"class":221,"line":222},[219,3504,3505],{"class":1250},"spectool",[219,3507,3508],{"class":786}," -gR",[219,3510,3511],{"class":1819}," *",[219,3513,3439],{"class":677},[23,3515,3516],{},"这样也能自动下载源文件。",[18,3518,3519],{"id":3519},"构建行为",[23,3521,3522,3523,3526],{},"makepkg 的默认构建行为就是只构建最终的安装包，Archlinux 中并没有 Fedora 那样打 source rpm 保证 reproduceability 的行为，这在 rpmbuild 中对应的是 ",[216,3524,3525],{},"-bb"," 选项。",[23,3528,2595,3529,3532],{},[216,3530,3531],{},"rpmbuild -bb *.spec"," 即可",[49,3534],{},[23,3536,3537],{},"上面介绍完了 rpmbuild 和 makepkg 的主要差异，应该可以自己搓一个 rpmbuild-wrapper 去实现以 makepkg 的方式打开 rpmbuild 的目标了，具体的 wrapper 脚本我就不放出来献丑了。",[952,3539,3540],{},"html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html pre.shiki code .s2QsP, html code.shiki .s2QsP{--shiki-default:#E45649;--shiki-dark:#E5C07B}",{"title":214,"searchDepth":228,"depth":228,"links":3542},[3543,3544,3545,3546,3547],{"id":3343,"depth":228,"text":3343},{"id":3391,"depth":228,"text":3391},{"id":3411,"depth":228,"text":3411},{"id":3488,"depth":228,"text":3488},{"id":3519,"depth":228,"text":3519},128,1762454895573]
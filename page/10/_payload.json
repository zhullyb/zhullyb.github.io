[{"data":1,"prerenderedAt":4091},["ShallowReactive",2],{"randomIndex/page/10/":3,"index-page-10":4,"posts-total":4090},2,[5,491,848,1249,2246,2567,2741,2839,3278,3394],{"title":6,"date":7,"path":8,"tags":9,"body":11},"【翻译】请别再使用主题装饰我们的软件","2021-11-05 20:35:58","/2021/11/05/please-dont-theme-our-apps",[10],"翻译",{"type":12,"value":13,"toc":488},"minimark",[14,27,30,39,42,45,52,58,64,69,72,87,90,108,114,117,120,126,133,139,142,145,148,471,476,478],[15,16,17],"p",{},[18,19,20,21],"em",{},"标题中的「我们」当然不是我自己，这是一封来自GNOME开发者针对广大GNOME社区开发者的一封公开信。看着挺有意思的，其中也透露出了GNOME的设计理念，我在这里尽力将其不掺杂个人情感地翻译完。原文可以查看这里: ",[22,23,24],"a",{"href":24,"rel":25},"https://stopthemingmy.app/",[26],"nofollow",[28,29],"hr",{},[31,32,33,36],"blockquote",{},[15,34,35],{},"请从头到尾阅读这封信。",[15,37,38],{},"这份信针对的是那些在默认设置下使用第三方主题破坏软件体验的发行版，而不是那些试图使用第三方主题美化自己桌面的用户。（原文中出现的是tinkerers，意为修补匠）",[15,40,41],{},"我们是 GNOME 平台的应用开发者与设计者，我们为自己的成果感到自豪，并努力确保我们的应用能够为人们提供良好的体验。",[15,43,44],{},"然而不幸的是，在许多情况下，我们所有在软件的设计、开发、测试上所做出努力都因为第三方主题而变得徒劳无功。",[15,46,47],{},[48,49],"img",{"alt":50,"src":51},"\u003Cfont size=\"5\">\u003Cb>GTK样式\u003C/b>可以使得软件外观看上去不协调、甚至使得软件无法使用\u003C/font>","https://stopthemingmy.app/assets/stylesheets.png",[15,53,54],{},[48,55],{"alt":56,"src":57},"\u003Cfont size=\"5\">\u003Cb>图表包\u003C/b>可以改变图标的含义，使得显示的图标无法准确的表达开发者的意思。\u003C/font>","https://stopthemingmy.app/assets/iconthemes.png",[15,59,60],{},[48,61],{"alt":62,"src":63},"\u003Cfont size=\"5\">\u003Cb>应用图标\u003C/b>是一个软件身份的象征。改变一个软件的图标剥夺了开发者控制其品牌的可能性\u003C/font>","https://stopthemingmy.app/assets/appicons.png",[15,65,66],{},[18,67,68],{},"注: 这些例子纯粹只是用于说明问题，并不针对个别主题。所以，主题开发者们别多想。❤️",[15,70,71],{},"当然，还有些不那么直接的后果，包括:",[73,74,75,84],"ul",{},[76,77,78,79,83],"li",{},"在GNOME软件中心或Flathub 中使用的截图( ",[80,81,82],"strong",{},"Appstream Screenshots"," )中的UI会和你实际安装以后的UI看上去完全不同，这使得这些截图失去了原有的意义。",[76,85,86],{},"如果系统的UI元素和用户帮助文档中出现的元素不同，用户帮助文档将会极大地丢失原有意义。",[15,88,89],{},"这些博客文章更详细地解释了主题化的一些问题：",[73,91,92,100],{},[76,93,94,95],{},"GTK Stylesheets — ",[22,96,99],{"href":97,"rel":98},"https://blogs.gnome.org/tbernard/2018/10/15/restyling-apps-at-scale",[26],"Restyling apps at scale",[76,101,102,103],{},"App Icons — ",[22,104,107],{"href":105,"rel":106},"https://samuelhewitt.com/blog/2017-11-26-linux-themes-third-party-icons",[26],"Linux Themes & Third-Party Icons",[15,109,110,113],{},[80,111,112],{},"这就是为什么我们心平气和地要求我们的软件不要被主题化。"," 它们是被上游所使用的（即默认的） GNOME 样式表、图标和字体 所构建和测试的，因此它们在用户的系统上应该是原汁原味的。",[15,115,116],{},"虽然我们可以直接在我们的应用程序中禁用主题，但我们不想这么做。 我们认为技术性的解决方案可能不会有效，因为这不是技术问题。",[15,118,119],{},"在技术上，我们希望软件可以在没有人工干预的情况下被自动地重新设计，但这到目前为止仍然是个幻想。在这种技术现状被改善之前，这种（应用被主题搞炸）的情况几乎不可能被解决。因此，我们正试图通过这封信向大家告知这种情况，并尽自己的一份力量。",[15,121,122,125],{},[80,123,124],{},"如果你想要美化你自己的系统，我们没有意见","。然而，如果你改变了诸如图标、样式表等东西，你应当意识到你的行为不会得到支持（应该是指不会得到社区的帮助）。您遇到的任何问题都应直接报告给主题开发者，而不是软件开发者。",[15,127,128,129,132],{},"作为一个平台，",[80,130,131],{},"我们坚信GTK应当停止强制默认在所有软件使用同一个样式表","（也就是说应该可以为不同的软件指定不同的GTK样式）。应用程序不必通过把样式表写死来避免这种情况，而是应该使用平台样式表（系统提供的样式表），除非他们魔改了样式表以加入其他内容。 我们意识到这是一个复杂的问题，但假设每个应用程序都适用于每个样式表同样也是一个糟糕的默认设置。",[15,134,135,138],{},[80,136,137],{},"如果你是更改了系统样式表和图标的发行版的开发人员，希望你重新考虑此决定","。 在没有任何 QA 的情况下更改第三方应用程序是鲁莽的，并且在任何其他平台上都是不可接受的。 您的行为对我们这些应用程序开发人员造成了很大的伤害，并且正在损害除了您的发行版以外的整个软件生态。",[15,140,141],{},"我们理解发行版需要脱颖而出来吸引用户。但是，我们敦促您想办法在不剥夺我们代理权的情况下做到这一点。 我们厌倦了当人们告诉我们「这个主题魔改得还不错」时，我们必须为我们从未打算支持的设置做额外的工作。你绝对不会对 Blender、Atom、Telegram 或其他第三方应用程序做出这样的魔改。我们的应用程序使用 GTK 并不意味着我们可以接受别人对它们的魔改。",[15,143,144],{},"由于你要使用 GNOME 平台开发，我们预设「你希望这个软件生态是健康的」。如果现实确实如此，我们要求您停止使用主题装饰我们的软件的这一行为。",[15,146,147],{},"署名,",[73,149,150,161,171,198,219,230,243,253,274,284,300,310,324,354,364,383,393,418,428,441,451,462],{},[76,151,152,155,156],{},[80,153,154],{},"Alexander Mikhaylenko","\nMaintainer of ",[22,157,160],{"href":158,"rel":159},"https://gitlab.gnome.org/GNOME/gnome-games",[26],"Games",[76,162,163,155,166],{},[80,164,165],{},"Avi Wadhwa",[22,167,170],{"href":168,"rel":169},"https://gitlab.gnome.org/aviwad/organizer",[26],"Organizer",[76,172,173,155,176,181,182,181,187,192,193],{},[80,174,175],{},"Bilal Elmoussaoui",[22,177,180],{"href":178,"rel":179},"https://gitlab.gnome.org/World/Authenticator",[26],"Authenticator",", ",[22,183,186],{"href":184,"rel":185},"https://gitlab.gnome.org/World/design/icon-library",[26],"Icon Library",[22,188,191],{"href":189,"rel":190},"https://gitlab.gnome.org/World/design/contrast",[26],"Contrast"," and ",[22,194,197],{"href":195,"rel":196},"https://gitlab.gnome.org/World/obfuscate",[26],"Obfuscate",[76,199,200,155,203,181,208,213,214],{},[80,201,202],{},"Cédric Bellegarde",[22,204,207],{"href":205,"rel":206},"https://gitlab.gnome.org/World/lollypop",[26],"Lollypop",[22,209,212],{"href":210,"rel":211},"https://gitlab.gnome.org/World/eolie",[26],"Eolie",", and ",[22,215,218],{"href":216,"rel":217},"https://gitlab.gnome.org/gnumdk/passbook",[26],"Passbook",[76,220,221,224,225],{},[80,222,223],{},"Christopher Davis","\nCore contributor to ",[22,226,229],{"href":227,"rel":228},"https://gitlab.gnome.org/GNOME/Fractal",[26],"Fractal",[76,231,232,155,235,192,238],{},[80,233,234],{},"Daniel García Moreno",[22,236,229],{"href":227,"rel":237},[26],[22,239,242],{"href":240,"rel":241},"https://gitlab.gnome.org/danigm/timetrack",[26],"Timetrack",[76,244,245,155,248],{},[80,246,247],{},"Falk Alexander Seidl",[22,249,252],{"href":250,"rel":251},"https://gitlab.gnome.org/World/PasswordSafe",[26],"Password Safe",[76,254,255,258,259,181,264,213,269],{},[80,256,257],{},"Felix Häcker",",\nMaintainer of ",[22,260,263],{"href":261,"rel":262},"https://gitlab.gnome.org/World/Shortwave",[26],"Gradio/Shortwave",[22,265,268],{"href":266,"rel":267},"https://gitlab.gnome.org/World/Fragments",[26],"Fragments",[22,270,273],{"href":271,"rel":272},"https://gitlab.gnome.org/World/Remotely",[26],"Remotely",[76,275,276,155,279],{},[80,277,278],{},"Forever XML",[22,280,283],{"href":281,"rel":282},"https://codeberg.org/foreverxml/random",[26],"Random",[76,285,286,289,290,192,295],{},[80,287,288],{},"Jan Lukas Gernert","\nAuthor of ",[22,291,294],{"href":292,"rel":293},"https://jangernert.github.io/FeedReader/",[26],"FeedReader",[22,296,299],{"href":297,"rel":298},"https://gitlab.com/news-flash",[26],"NewsFlash",[76,301,302,155,305],{},[80,303,304],{},"Jordan Petridis",[22,306,309],{"href":307,"rel":308},"https://gitlab.gnome.org/World/podcasts",[26],"Podcasts",[76,311,312,224,315,318,319],{},[80,313,314],{},"Julian Sparber",[22,316,229],{"href":227,"rel":317},[26],", maintainer of ",[22,320,323],{"href":321,"rel":322},"https://gitlab.gnome.org/jsparber/teleport",[26],"Teleport",[76,325,326,155,329,181,334,181,339,181,344,213,349],{},[80,327,328],{},"Lains",[22,330,333],{"href":331,"rel":332},"https://github.com/lainsce/notejot",[26],"Notejot",[22,335,338],{"href":336,"rel":337},"https://github.com/lainsce/khronos",[26],"Khronos",[22,340,343],{"href":341,"rel":342},"https://github.com/lainsce/dot-matrix",[26],"Dot Matrix",[22,345,348],{"href":346,"rel":347},"https://github.com/lainsce/quilter",[26],"Quilter",[22,350,353],{"href":351,"rel":352},"https://github.com/lainsce/emulsion",[26],"Emulsion",[76,355,356,155,359],{},[80,357,358],{},"Manuel Genovés",[22,360,363],{"href":361,"rel":362},"https://github.com/UberWriter/uberwriter",[26],"UberWriter",[76,365,366,155,369,192,374,379,380],{},[80,367,368],{},"Maximiliano Sandoval",[22,370,373],{"href":371,"rel":372},"https://gitlab.gnome.org/World/decoder",[26],"Decoder",[22,375,378],{"href":376,"rel":377},"https://gitlab.gnome.org/World/design/lorem",[26],"Lorem",", core contributor to ",[22,381,252],{"href":250,"rel":382},[26],[76,384,385,155,388],{},[80,386,387],{},"Michael Gratton",[22,389,392],{"href":390,"rel":391},"https://gitlab.gnome.org/GNOME/Geary",[26],"Geary",[76,394,395,155,398,181,403,181,408,192,413],{},[80,396,397],{},"Rafael Mardojai C.M.",[22,399,402],{"href":400,"rel":401},"https://github.com/rafaelmardojai/blanket",[26],"Blanket",[22,404,407],{"href":405,"rel":406},"https://github.com/dialect-app/dialect",[26],"Dialect",[22,409,412],{"href":410,"rel":411},"https://github.com/rafaelmardojai/share-preview",[26],"Share Preview",[22,414,417],{"href":415,"rel":416},"https://github.com/rafaelmardojai/webfont-kit-generator",[26],"Webfont Kit Generator",[76,419,420,155,423],{},[80,421,422],{},"Sophie Herold",[22,424,427],{"href":425,"rel":426},"https://apps.gnome.org/app/org.gnome.World.PikaBackup/",[26],"Pika Backup",[76,429,430,433,434,192,437,440],{},[80,431,432],{},"Tobias Bernard","\nDesigner of ",[22,435,268],{"href":266,"rel":436},[26],[22,438,309],{"href":307,"rel":439},[26]," (among others)",[76,442,443,155,446],{},[80,444,445],{},"Zander Brown",[22,447,450],{"href":448,"rel":449},"https://gitlab.gnome.org/World/design/icon-preview",[26],"Icon Preview",[76,452,453],{},[80,454,455,456,461],{},"The ",[22,457,460],{"href":458,"rel":459},"https://usebottles.com",[26],"Bottles"," Developers",[76,463,464],{},[80,465,455,466,461],{},[22,467,470],{"href":468,"rel":469},"https://pitivi.org",[26],"Pitivi",[15,472,473],{},[18,474,475],{},"Note: Even though some of us are Foundation  members or work on GNOME, these are our personal views as individuals,  and not those of the GNOME Project, the GNOME Foundation, or our  employers.",[28,477],{},[15,479,480],{},[80,481,482,483],{},"推荐阅读:  ",[22,484,487],{"href":485,"rel":486},"https://whiteboard-ui8.pages.dev/translation/libadwaita-gtk4-TheEvilSkeleton/",[26],"《libadwaita：修复 Linux 桌面的可用性问题》",{"title":489,"searchDepth":3,"depth":3,"links":490},"",[],{"title":492,"date":493,"path":494,"tags":495,"body":500},"Waydroid on KDE 初体验","2021-10-31 15:57:57","/2021/10/31/waydroid-experience-on-kde",[496,497,498,499],"Archlinux","Waydroid","KDE","Experience",{"type":12,"value":501,"toc":837},[502,519,524,527,530,536,539,555,572,575,578,606,613,627,631,646,649,661,681,684,687,705,708,724,727,730,742,753,756,774,777,786,789,813,816,821,827,833],[31,503,504],{},[15,505,506,507,512,513,518],{},"在",[22,508,511],{"href":509,"rel":510},"https://yanqiyu.info/",[26],"西木野羰基的博客","中看到了其在Fedora中使用waydroid跑明日方舟的",[22,514,517],{"href":515,"rel":516},"https://static.031130.xyz/uploads/2024/08/12/62f3cc0d6b9e8.webp",[26],"截图","，心里有有些痒痒了，决定在Archlinux上尝试使用waydroid。",[520,521,523],"h2",{"id":522},"waydroid是什么","Waydroid是什么",[15,525,526],{},"Waydroid是一个基于lxc容器技术，用以启动完整安卓系统的方案。",[15,528,529],{},"默认使用了LineageOS-17.1，对应 Aosp10，相比起 anbox 显然是更加新了。",[15,531,532],{},[48,533],{"alt":534,"src":535},"是长成这样","https://static.031130.xyz/uploads/2024/08/12/62f3cb238c027.webp",[520,537,538],{"id":538},"内核支持",[15,540,541,542,546,547,550,551,554],{},"waydroid需要内核提供",[543,544,545],"code",{},"Ashmem","和",[543,548,549],{},"binder","支持，西木野羰基是使用的自己编译的内核。而我在使用Archlinux，因此直接使用",[543,552,553],{},"linux-zen","即可。",[31,556,557],{},[15,558,559,560,563,564,567,568,571],{},"注: AUR上的",[543,561,562],{},"linux-xanmod","虽然也有这些模块支持，但是在编译时设置了",[543,565,566],{},"psi=0","以提升性能，而waydroid恰巧需要",[543,569,570],{},"psi=1","的支持，故不可使用。",[520,573,574],{"id":574},"安装",[15,576,577],{},"Archlinux已经有人将其打包上传到了AUR，我们直接安装即可。我使用的 AUR Helper 是 yay，所以直接",[579,580,584],"pre",{"className":581,"code":582,"language":583,"meta":489,"style":489},"language-bash shiki shiki-themes github-light github-dark","yay -S waydroid --noconfirm\n","bash",[543,585,586],{"__ignoreMap":489},[587,588,591,595,599,603],"span",{"class":589,"line":590},"line",1,[587,592,594],{"class":593},"sScJk","yay",[587,596,598],{"class":597},"sj4cs"," -S",[587,600,602],{"class":601},"sZZnC"," waydroid",[587,604,605],{"class":597}," --noconfirm\n",[15,607,608,609,612],{},"再装个",[543,610,611],{},"python-pyclip","解决剪切板同步的问题",[579,614,616],{"className":581,"code":615,"language":583,"meta":489,"style":489},"yay -S python-pyclip\n",[543,617,618],{"__ignoreMap":489},[587,619,620,622,624],{"class":589,"line":590},[587,621,594],{"class":593},[587,623,598],{"class":597},[587,625,626],{"class":601}," python-pyclip\n",[520,628,630],{"id":629},"下载waydroid镜像","下载Waydroid镜像",[579,632,634],{"className":581,"code":633,"language":583,"meta":489,"style":489},"sudo waydroid init\n",[543,635,636],{"__ignoreMap":489},[587,637,638,641,643],{"class":589,"line":590},[587,639,640],{"class":593},"sudo",[587,642,602],{"class":601},[587,644,645],{"class":601}," init\n",[15,647,648],{},"这一步将会自动（从SourceForge）下载纯净的LineageOS镜像压缩包并解压，处于中国大陆网络环境的用户记得（          ）",[15,650,651,652,655,656],{},"如果你需要Gapps，可以指定下载Gapps版本，但是这将需要你获取",[543,653,654],{},"Android ID","并向谷歌提交 Custom Rom 的 Gapps 申请。见",[22,657,660],{"href":658,"rel":659},"https://www.google.com/android/uncertified/",[26],"这里",[579,662,664],{"className":581,"code":663,"language":583,"meta":489,"style":489},"sudo waydroid init -s GAPPS\n",[543,665,666],{"__ignoreMap":489},[587,667,668,670,672,675,678],{"class":589,"line":590},[587,669,640],{"class":593},[587,671,602],{"class":601},[587,673,674],{"class":601}," init",[587,676,677],{"class":597}," -s",[587,679,680],{"class":601}," GAPPS\n",[520,682,683],{"id":683},"启用服务",[15,685,686],{},"这个没什么好说的，使用systemctl启动服务。",[579,688,690],{"className":581,"code":689,"language":583,"meta":489,"style":489},"sudo systemctl start waydroid-container.service\n",[543,691,692],{"__ignoreMap":489},[587,693,694,696,699,702],{"class":589,"line":590},[587,695,640],{"class":593},[587,697,698],{"class":601}," systemctl",[587,700,701],{"class":601}," start",[587,703,704],{"class":601}," waydroid-container.service\n",[520,706,707],{"id":707},"开启waydroid",[579,709,711],{"className":581,"code":710,"language":583,"meta":489,"style":489},"waydroid session start\n",[543,712,713],{"__ignoreMap":489},[587,714,715,718,721],{"class":589,"line":590},[587,716,717],{"class":593},"waydroid",[587,719,720],{"class":601}," session",[587,722,723],{"class":601}," start\n",[520,725,726],{"id":726},"一些简单的使用技巧",[15,728,729],{},"如果你想直接展示整个系统界面，可以使用",[579,731,733],{"className":581,"code":732,"language":583,"meta":489,"style":489},"waydroid show-full-ui\n",[543,734,735],{"__ignoreMap":489},[587,736,737,739],{"class":589,"line":590},[587,738,717],{"class":593},[587,740,741],{"class":601}," show-full-ui\n",[15,743,744,745,748,749,752],{},"我们也可以用",[543,746,747],{},"waydroid app launch ${package_name}","的方式来启动单个应用（包名可以使用",[543,750,751],{},"waydroid app list","来获取",[15,754,755],{},"当然，可以直接在Linux环境里 安装 某个apk",[579,757,759],{"className":581,"code":758,"language":583,"meta":489,"style":489},"waydroid app install path/to/apkfile.apk\n",[543,760,761],{"__ignoreMap":489},[587,762,763,765,768,771],{"class":589,"line":590},[587,764,717],{"class":593},[587,766,767],{"class":601}," app",[587,769,770],{"class":601}," install",[587,772,773],{"class":601}," path/to/apkfile.apk\n",[15,775,776],{},"F11有助于解决应用分辨率问题，左Alt有助于解决键盘无法输入的问题。",[15,778,779,780,785],{},"Github上有个",[22,781,784],{"href":782,"rel":783},"https://github.com/casualsnek/waydroid_script",[26],"脚本","，可以帮助 安装OpenGapps/Magisk/arm转译库/获取Android ID。",[520,787,788],{"id":788},"牢骚时间",[73,790,791,794,797,800,803,806],{},[76,792,793],{},"对AMD和英伟达的显卡支持都不太行",[76,795,796],{},"不能直接输入中文，还是得借助安卓系统内的输入法。",[76,798,799],{},"不自带arm转译库，通过脚本安装的转译库似乎兼容性挺差（至少我是成功打开什么arm软件",[76,801,802],{},"系统运行的流畅度还可以",[76,804,805],{},"相关的资料似乎有点少，官方的文档也没有写得太详细",[76,807,808,809,812],{},"Waydroid会自动在",[543,810,811],{},"$HOME/.local/share/applications/","为wayland内的安装应用添加Desktop文件（这让我有些反感",[520,814,815],{"id":815},"一些截图",[15,817,818],{},[48,819],{"alt":489,"src":820},"https://static.031130.xyz/uploads/2024/08/12/62f3cb26cba03.webp",[15,822,823],{},[48,824],{"alt":825,"src":826},"原生安卓从未变过的应用抽屉","https://static.031130.xyz/uploads/2024/08/12/62f3cc722835c.webp",[15,828,829],{},[48,830],{"alt":831,"src":832},"这充电速度太刺激啦！","https://static.031130.xyz/uploads/2024/08/12/62f3cc76b986c.webp",[834,835,836],"style",{},"html pre.shiki code .sScJk, html code.shiki .sScJk{--shiki-default:#6F42C1;--shiki-dark:#B392F0}html pre.shiki code .sj4cs, html code.shiki .sj4cs{--shiki-default:#005CC5;--shiki-dark:#79B8FF}html pre.shiki code .sZZnC, html code.shiki .sZZnC{--shiki-default:#032F62;--shiki-dark:#9ECBFF}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}",{"title":489,"searchDepth":3,"depth":3,"links":838},[839,840,841,842,843,844,845,846,847],{"id":522,"depth":3,"text":523},{"id":538,"depth":3,"text":538},{"id":574,"depth":3,"text":574},{"id":629,"depth":3,"text":630},{"id":683,"depth":3,"text":683},{"id":707,"depth":3,"text":707},{"id":726,"depth":3,"text":726},{"id":788,"depth":3,"text":788},{"id":815,"depth":3,"text":815},{"title":849,"date":850,"path":851,"tags":852,"body":855},"PicUploader使用系列（二）——为KDE的dolphin添加右键快捷菜单","2021-10-24 22:26:50","/2021/10/24/picuploader-with-kde-action",[496,853,498,854],"PicUploader","PHP",{"type":12,"value":856,"toc":1237},[857,870,876,880,910,913,921,934,937,942,945,949,955,975,978,987,994,1000,1021,1024,1150,1157,1175,1178,1187,1190,1210,1213,1218,1221,1228,1234],[15,858,859,863,864,869],{},[22,860,862],{"href":861},"/2021/10/21/picuploader-on-archlinux-with-caddy/","上一篇文章","我们在Archlinux中成功部署了PicUploader的web端，本文我们来讲讲如何为KDE的dolphin添加右键快捷键上传，效果类似这样。（gif图来自",[22,865,868],{"href":866,"rel":867},"https://www.xiebruce.top/17.html",[26],"PicUploader作者的博客",")",[871,872,873],"center",{},[48,874],{"src":875,"width":489,"height":489},"https://img.xiebruce.top/2018/09/11/f4859eda8832f814486fc00df971e3cc.gif",[520,877,879],{"id":878},"创建desktop文件","创建.desktop文件",[579,881,883],{"className":581,"code":882,"language":583,"meta":489,"style":489},"mkdir -p $HOME/.local/share/kservices5/\ntouch $HOME/.local/share/kservices5/picuploader.desktop\n",[543,884,885,900],{"__ignoreMap":489},[587,886,887,890,893,897],{"class":589,"line":590},[587,888,889],{"class":593},"mkdir",[587,891,892],{"class":597}," -p",[587,894,896],{"class":895},"sVt8B"," $HOME",[587,898,899],{"class":601},"/.local/share/kservices5/\n",[587,901,902,905,907],{"class":589,"line":3},[587,903,904],{"class":593},"touch",[587,906,896],{"class":895},[587,908,909],{"class":601},"/.local/share/kservices5/picuploader.desktop\n",[520,911,912],{"id":912},"填上这段内容",[579,914,919],{"className":915,"code":917,"language":918},[916],"language-text","[Desktop Entry]\nActions=PicUploader;\nMimeType=image/jpeg;image/png;\nType=Service\nX-KDE-Priority=TopLevel\nX-KDE-ServiceTypes=KonqPopupMenu/Plugin\nIcon=/var/www/image/favicon.ico\n\n[Desktop Action PicUploader]\nName=Upload with PicUploader\nName[zh_CN]=使用PicUploader上传\nIcon=/var/www/image/favicon.ico\nExec=php /var/www/image/index.php %F | scopy\n","text",[543,920,917],{"__ignoreMap":489},[15,922,923],{},[80,924,925,926,930,931,554],{},"注: 这里的 scopy 是我在下面",[22,927,929],{"href":928},"#%E5%A4%8D%E5%88%B6%E5%88%B0%E7%B2%98%E8%B4%B4%E6%9D%BF","自己创建的一段脚本","，用以同时满足x11和wayland下的使用，如果你仅使用x11的话直接改成",[543,932,933],{},"xclip -selection clipboard",[15,935,936],{},"MimeType指的是文件类型。在这份desktop中，我仅指定了png和jpg文件在右键时会弹出picuploader的上传菜单，如果你需要更多文件类型的MimeType，你可以参考下gwenview的desktop都写了哪些文件类型。",[31,938,939],{},[15,940,941],{},"MimeType=inode/directory;image/avif;image/gif;image/jpeg;image/png;image/bmp;image/x-eps;image/x-icns;image/x-ico;image/x-portable-bitmap;image/x-portable-graymap;image/x-portable-pixmap;image/x-xbitmap;image/x-xpixmap;image/tiff;image/x-psd;image/x-webp;image/webp;image/x-tga;application/x-krita;image/x-kde-raw;image/x-canon-cr2;image/x-canon-crw;image/x-kodak-dcr;image/x-adobe-dng;image/x-kodak-k25;image/x-kodak-kdc;image/x-minolta-mrw;image/x-nikon-nef;image/x-olympus-orf;image/x-pentax-pef;image/x-fuji-raf;image/x-panasonic-rw;image/x-sony-sr2;image/x-sony-srf;image/x-sigma-x3f;image/x-sony-arw;image/x-panasonic-rw2;",[520,943,944],{"id":944},"安装所需组件",[946,947,948],"h3",{"id":948},"通知提示",[15,950,951,952],{},"右下角弹出文字提示的功能依赖于",[543,953,954],{},"libnotify",[579,956,958],{"className":581,"code":957,"language":583,"meta":489,"style":489},"sudo pacman -S libnotify --needed\n",[543,959,960],{"__ignoreMap":489},[587,961,962,964,967,969,972],{"class":589,"line":590},[587,963,640],{"class":593},[587,965,966],{"class":601}," pacman",[587,968,598],{"class":597},[587,970,971],{"class":601}," libnotify",[587,973,974],{"class":597}," --needed\n",[946,976,977],{"id":977},"复制到粘贴板",[15,979,980],{},[981,982,983,984],"del",{},"复制到粘贴板的功能依赖于",[543,985,986],{},"xclip",[15,988,989],{},[981,990,991],{},[543,992,993],{},"sudo pacman -S xclip --needed",[15,995,996,997,999],{},"考虑到我可能在 x11 和 wayland 之间反复横跳，仅仅一个",[543,998,986],{},"看起来满足不了我的需求",[579,1001,1003],{"className":581,"code":1002,"language":583,"meta":489,"style":489},"sudo pacman -S xclip wl-clipboard --needed\n",[543,1004,1005],{"__ignoreMap":489},[587,1006,1007,1009,1011,1013,1016,1019],{"class":589,"line":590},[587,1008,640],{"class":593},[587,1010,966],{"class":601},[587,1012,598],{"class":597},[587,1014,1015],{"class":601}," xclip",[587,1017,1018],{"class":601}," wl-clipboard",[587,1020,974],{"class":597},[15,1022,1023],{},"手糊了一段脚本，用以判断对应的运行环境并调用相应的粘贴板工具",[579,1025,1027],{"className":581,"code":1026,"language":583,"meta":489,"style":489},"/usr/bin/scopy\n---\n#!/bin/bash\n\nif [ \"$XDG_SESSION_TYPE\" = \"wayland\" ]; then\n  wl-copy\nelif [ \"$XDG_SESSION_TYPE\" = \"x11\" ]; then\n  xclip -selection clipboard\nelse\n  echo \"ERROR! You are using $XDG_SESSION_TYPE\"\nfi\n",[543,1028,1029,1034,1039,1046,1053,1083,1089,1112,1124,1130,1144],{"__ignoreMap":489},[587,1030,1031],{"class":589,"line":590},[587,1032,1033],{"class":593},"/usr/bin/scopy\n",[587,1035,1036],{"class":589,"line":3},[587,1037,1038],{"class":593},"---\n",[587,1040,1042],{"class":589,"line":1041},3,[587,1043,1045],{"class":1044},"sJ8bj","#!/bin/bash\n",[587,1047,1049],{"class":589,"line":1048},4,[587,1050,1052],{"emptyLinePlaceholder":1051},true,"\n",[587,1054,1056,1060,1063,1066,1069,1071,1074,1077,1080],{"class":589,"line":1055},5,[587,1057,1059],{"class":1058},"szBVR","if",[587,1061,1062],{"class":895}," [ ",[587,1064,1065],{"class":601},"\"",[587,1067,1068],{"class":895},"$XDG_SESSION_TYPE",[587,1070,1065],{"class":601},[587,1072,1073],{"class":1058}," =",[587,1075,1076],{"class":601}," \"wayland\"",[587,1078,1079],{"class":895}," ]; ",[587,1081,1082],{"class":1058},"then\n",[587,1084,1086],{"class":589,"line":1085},6,[587,1087,1088],{"class":593},"  wl-copy\n",[587,1090,1092,1095,1097,1099,1101,1103,1105,1108,1110],{"class":589,"line":1091},7,[587,1093,1094],{"class":1058},"elif",[587,1096,1062],{"class":895},[587,1098,1065],{"class":601},[587,1100,1068],{"class":895},[587,1102,1065],{"class":601},[587,1104,1073],{"class":1058},[587,1106,1107],{"class":601}," \"x11\"",[587,1109,1079],{"class":895},[587,1111,1082],{"class":1058},[587,1113,1115,1118,1121],{"class":589,"line":1114},8,[587,1116,1117],{"class":593},"  xclip",[587,1119,1120],{"class":597}," -selection",[587,1122,1123],{"class":601}," clipboard\n",[587,1125,1127],{"class":589,"line":1126},9,[587,1128,1129],{"class":1058},"else\n",[587,1131,1133,1136,1139,1141],{"class":589,"line":1132},10,[587,1134,1135],{"class":597},"  echo",[587,1137,1138],{"class":601}," \"ERROR! You are using ",[587,1140,1068],{"class":895},[587,1142,1143],{"class":601},"\"\n",[587,1145,1147],{"class":589,"line":1146},11,[587,1148,1149],{"class":1058},"fi\n",[15,1151,1152,1153,1156],{},"为",[543,1154,1155],{},"/usr/bin/scopy","授予运行权限",[579,1158,1160],{"className":581,"code":1159,"language":583,"meta":489,"style":489},"sudo chmod 755 /usr/bin/scopy\n",[543,1161,1162],{"__ignoreMap":489},[587,1163,1164,1166,1169,1172],{"class":589,"line":590},[587,1165,640],{"class":593},[587,1167,1168],{"class":601}," chmod",[587,1170,1171],{"class":597}," 755",[587,1173,1174],{"class":601}," /usr/bin/scopy\n",[520,1176,1177],{"id":1177},"启用该动作菜单",[579,1179,1181],{"className":581,"code":1180,"language":583,"meta":489,"style":489},"kbuildsycoca5\n",[543,1182,1183],{"__ignoreMap":489},[587,1184,1185],{"class":589,"line":590},[587,1186,1180],{"class":593},[520,1188,1189],{"id":1189},"处理普通用户无权写入logs的问题",[579,1191,1193],{"className":581,"code":1192,"language":583,"meta":489,"style":489},"sudo chmod 777 -R /var/www/image/logs/\n",[543,1194,1195],{"__ignoreMap":489},[587,1196,1197,1199,1201,1204,1207],{"class":589,"line":590},[587,1198,640],{"class":593},[587,1200,1168],{"class":601},[587,1202,1203],{"class":597}," 777",[587,1205,1206],{"class":597}," -R",[587,1208,1209],{"class":601}," /var/www/image/logs/\n",[520,1211,1212],{"id":1212},"最终结果",[871,1214,1215],{},[48,1216],{"src":1217,"width":489,"height":489},"https://static.031130.xyz/uploads/2024/08/12/62f36f57f34aa.gif",[520,1219,1220],{"id":1220},"参考链接",[15,1222,1223],{},[22,1224,1227],{"href":1225,"rel":1226},"https://cnzhx.net/blog/kde-plasma-5-dolphin-add-action-menu-entry/",[26],"在 KDE Plasma 5 的 Dolphin 中添加一个右键动作菜单",[15,1229,1230],{},[22,1231,1233],{"href":866,"rel":1232},[26],"PicUploader: 一个还不错的图床工具",[834,1235,1236],{},"html pre.shiki code .sScJk, html code.shiki .sScJk{--shiki-default:#6F42C1;--shiki-dark:#B392F0}html pre.shiki code .sj4cs, html code.shiki .sj4cs{--shiki-default:#005CC5;--shiki-dark:#79B8FF}html pre.shiki code .sVt8B, html code.shiki .sVt8B{--shiki-default:#24292E;--shiki-dark:#E1E4E8}html pre.shiki code .sZZnC, html code.shiki .sZZnC{--shiki-default:#032F62;--shiki-dark:#9ECBFF}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html pre.shiki code .sJ8bj, html code.shiki .sJ8bj{--shiki-default:#6A737D;--shiki-dark:#6A737D}html pre.shiki code .szBVR, html code.shiki .szBVR{--shiki-default:#D73A49;--shiki-dark:#F97583}",{"title":489,"searchDepth":3,"depth":3,"links":1238},[1239,1240,1241,1245,1246,1247,1248],{"id":878,"depth":3,"text":879},{"id":912,"depth":3,"text":912},{"id":944,"depth":3,"text":944,"children":1242},[1243,1244],{"id":948,"depth":1041,"text":948},{"id":977,"depth":1041,"text":977},{"id":1177,"depth":3,"text":1177},{"id":1189,"depth":3,"text":1189},{"id":1212,"depth":3,"text":1212},{"id":1220,"depth":3,"text":1220},{"title":1250,"date":1251,"path":1252,"tags":1253,"body":1255},"PicUploader使用系列（一）——在Archlinux上使用Caddy部署PicUploader","2021-10-21 22:15:33","/2021/10/21/picuploader-on-archlinux-with-caddy",[496,1254,853,854],"Caddy",{"type":12,"value":1256,"toc":2227},[1257,1270,1280,1307,1313,1320,1344,1598,1605,1610,1625,1632,1788,1798,1983,1987,1990,2007,2010,2031,2034,2053,2057,2064,2067,2074,2080,2094,2098,2105,2132,2135,2141,2145,2148,2166,2169,2172,2180,2202,2205,2213,2216,2224],[31,1258,1259,1262],{},[15,1260,1261],{},"之前找对大陆网络友好的图床时，找到了cloudinary，但是全英文界面对操作增加了不少难度，其页面也不是很简洁，让我一下打消了使用网页版的念头。通过搜索，找到了 PicUploader 这一方案，使用php编写，支持cloudinary的api。",[15,1263,1264,1265,1269],{},"作者在其",[22,1266,1268],{"href":866,"rel":1267},[26],"博客","中仅提供了nginx的部署方案，我参考其配置文件成功实现了在caddy下的部署，并且花费了数个小时排坑，故写下本文帮助后来者节省时间。",[520,1271,574,1273,546,1276,1279],{"id":1272},"安装caddy和php-fpm以及所需的拓展",[543,1274,1275],{},"caddy",[543,1277,1278],{},"php-fpm","以及所需的拓展",[579,1281,1283],{"className":581,"code":1282,"language":583,"meta":489,"style":489},"sudo pacman -S caddy php-fpm php-gd php-sqlite --needed\n",[543,1284,1285],{"__ignoreMap":489},[587,1286,1287,1289,1291,1293,1296,1299,1302,1305],{"class":589,"line":590},[587,1288,640],{"class":593},[587,1290,966],{"class":601},[587,1292,598],{"class":597},[587,1294,1295],{"class":601}," caddy",[587,1297,1298],{"class":601}," php-fpm",[587,1300,1301],{"class":601}," php-gd",[587,1303,1304],{"class":601}," php-sqlite",[587,1306,974],{"class":597},[520,1308,1310,1311],{"id":1309},"配置php-fpm","配置",[543,1312,1278],{},[946,1314,506,1316,1319],{"id":1315},"在etcphpphpini启用picuploader所需拓展",[543,1317,1318],{},"/etc/php/php.ini","启用PicUploader所需拓展",[15,1321,1322,1323,1326,1327,1326,1330,1326,1333,1326,1336,1339,1340,1343],{},"PicUploaer依赖于",[543,1324,1325],{},"fileinfo","、",[543,1328,1329],{},"gd",[543,1331,1332],{},"curl",[543,1334,1335],{},"exif",[543,1337,1338],{},"pdo_sqlite","拓展，可以使用",[543,1341,1342],{},"php -m","命令来查看目前加载成功了的插件。",[579,1345,1349],{"className":1346,"code":1347,"language":1348,"meta":489,"style":489},"language-diff shiki shiki-themes github-light github-dark",";extension=bcmath\n;extension=bz2\n;extension=calendar\n- extension=curl\n+ extension=curl\n;extension=dba\n;extension=enchant\n- extension=exif\n+ extension=exif\n;extension=ffi\n;extension=ftp\n- extension=gd\n+ extension=gd\n;extension=gettext\n;extension=gmp\n;extension=iconv\n;extension=imap\n;extension=intl\n;extension=ldap\n;extension=mysqli\n;extension=odbc\n;zend_extension=opcache\n;extension=pdo_dblib\n;extension=pdo_mysql\n;extension=pdo_odbc\n;extension=pdo_pgsql\n- extension=pdo_sqlite\n+ extension=pdo_sqlite\n;extension=pgsql\n;extension=pspell\n;extension=shmop\n;extension=snmp\n;extension=soap\n;extension=sockets\n;extension=sodium\n;extension=sqlite3\n;extension=sysvmsg\n;extension=sysvsem\n;extension=sysvshm\n;extension=tidy\n;extension=xmlrpc\n;extension=xsl\nextension=zip\n","diff",[543,1350,1351,1356,1361,1366,1371,1376,1381,1386,1391,1396,1401,1406,1412,1418,1424,1430,1436,1442,1448,1454,1460,1466,1472,1478,1484,1490,1496,1502,1508,1514,1520,1526,1532,1538,1544,1550,1556,1562,1568,1574,1580,1586,1592],{"__ignoreMap":489},[587,1352,1353],{"class":589,"line":590},[587,1354,1355],{},";extension=bcmath\n",[587,1357,1358],{"class":589,"line":3},[587,1359,1360],{},";extension=bz2\n",[587,1362,1363],{"class":589,"line":1041},[587,1364,1365],{},";extension=calendar\n",[587,1367,1368],{"class":589,"line":1048},[587,1369,1370],{},"- extension=curl\n",[587,1372,1373],{"class":589,"line":1055},[587,1374,1375],{},"+ extension=curl\n",[587,1377,1378],{"class":589,"line":1085},[587,1379,1380],{},";extension=dba\n",[587,1382,1383],{"class":589,"line":1091},[587,1384,1385],{},";extension=enchant\n",[587,1387,1388],{"class":589,"line":1114},[587,1389,1390],{},"- extension=exif\n",[587,1392,1393],{"class":589,"line":1126},[587,1394,1395],{},"+ extension=exif\n",[587,1397,1398],{"class":589,"line":1132},[587,1399,1400],{},";extension=ffi\n",[587,1402,1403],{"class":589,"line":1146},[587,1404,1405],{},";extension=ftp\n",[587,1407,1409],{"class":589,"line":1408},12,[587,1410,1411],{},"- extension=gd\n",[587,1413,1415],{"class":589,"line":1414},13,[587,1416,1417],{},"+ extension=gd\n",[587,1419,1421],{"class":589,"line":1420},14,[587,1422,1423],{},";extension=gettext\n",[587,1425,1427],{"class":589,"line":1426},15,[587,1428,1429],{},";extension=gmp\n",[587,1431,1433],{"class":589,"line":1432},16,[587,1434,1435],{},";extension=iconv\n",[587,1437,1439],{"class":589,"line":1438},17,[587,1440,1441],{},";extension=imap\n",[587,1443,1445],{"class":589,"line":1444},18,[587,1446,1447],{},";extension=intl\n",[587,1449,1451],{"class":589,"line":1450},19,[587,1452,1453],{},";extension=ldap\n",[587,1455,1457],{"class":589,"line":1456},20,[587,1458,1459],{},";extension=mysqli\n",[587,1461,1463],{"class":589,"line":1462},21,[587,1464,1465],{},";extension=odbc\n",[587,1467,1469],{"class":589,"line":1468},22,[587,1470,1471],{},";zend_extension=opcache\n",[587,1473,1475],{"class":589,"line":1474},23,[587,1476,1477],{},";extension=pdo_dblib\n",[587,1479,1481],{"class":589,"line":1480},24,[587,1482,1483],{},";extension=pdo_mysql\n",[587,1485,1487],{"class":589,"line":1486},25,[587,1488,1489],{},";extension=pdo_odbc\n",[587,1491,1493],{"class":589,"line":1492},26,[587,1494,1495],{},";extension=pdo_pgsql\n",[587,1497,1499],{"class":589,"line":1498},27,[587,1500,1501],{},"- extension=pdo_sqlite\n",[587,1503,1505],{"class":589,"line":1504},28,[587,1506,1507],{},"+ extension=pdo_sqlite\n",[587,1509,1511],{"class":589,"line":1510},29,[587,1512,1513],{},";extension=pgsql\n",[587,1515,1517],{"class":589,"line":1516},30,[587,1518,1519],{},";extension=pspell\n",[587,1521,1523],{"class":589,"line":1522},31,[587,1524,1525],{},";extension=shmop\n",[587,1527,1529],{"class":589,"line":1528},32,[587,1530,1531],{},";extension=snmp\n",[587,1533,1535],{"class":589,"line":1534},33,[587,1536,1537],{},";extension=soap\n",[587,1539,1541],{"class":589,"line":1540},34,[587,1542,1543],{},";extension=sockets\n",[587,1545,1547],{"class":589,"line":1546},35,[587,1548,1549],{},";extension=sodium\n",[587,1551,1553],{"class":589,"line":1552},36,[587,1554,1555],{},";extension=sqlite3\n",[587,1557,1559],{"class":589,"line":1558},37,[587,1560,1561],{},";extension=sysvmsg\n",[587,1563,1565],{"class":589,"line":1564},38,[587,1566,1567],{},";extension=sysvsem\n",[587,1569,1571],{"class":589,"line":1570},39,[587,1572,1573],{},";extension=sysvshm\n",[587,1575,1577],{"class":589,"line":1576},40,[587,1578,1579],{},";extension=tidy\n",[587,1581,1583],{"class":589,"line":1582},41,[587,1584,1585],{},";extension=xmlrpc\n",[587,1587,1589],{"class":589,"line":1588},42,[587,1590,1591],{},";extension=xsl\n",[587,1593,1595],{"class":589,"line":1594},43,[587,1596,1597],{},"extension=zip\n",[946,1599,1601,1602,1604],{"id":1600},"编辑etcphpphpini以增加单文件上传大小限制","编辑",[543,1603,1318],{},"以增加单文件上传大小限制",[15,1606,1607],{},[981,1608,1609],{},"查出这个问题浪费了我整整4小时时间。",[579,1611,1613],{"className":1346,"code":1612,"language":1348,"meta":489,"style":489},"- upload_max_filesize = 2M\n+ upload_max_filesize = 100M\n",[543,1614,1615,1620],{"__ignoreMap":489},[587,1616,1617],{"class":589,"line":590},[587,1618,1619],{},"- upload_max_filesize = 2M\n",[587,1621,1622],{"class":589,"line":3},[587,1623,1624],{},"+ upload_max_filesize = 100M\n",[946,1626,1601,1628,1631],{"id":1627},"编辑etcphpphp-fpmdwwwconf使其在运行时使用caddy用户",[543,1629,1630],{},"/etc/php/php-fpm.d/www.conf","使其在运行时使用caddy用户。",[579,1633,1635],{"className":1346,"code":1634,"language":1348,"meta":489,"style":489},"---\n; Unix user/group of processes\n; Note: The user is mandatory. If the group is not set, the default user's group\n;       will be used.\n- user = http\n+ user = caddy\n- group = http\n+ group = caddy\n; The address on which to accept FastCGI requests.\n; Valid syntaxes are:\n;   'ip.add.re.ss:port'    - to listen on a TCP socket to a specific IPv4 address on\n;                            a specific port;\n;   '[ip:6:addr:ess]:port' - to listen on a TCP socket to a specific IPv6 address on\n---\n---\n; Note: This value is mandatory.\nlisten = /run/php-fpm/php-fpm.sock\n; and group can be specified either by name or by their numeric IDs.\n; Default Values: user and group are set as the running user\n;                 mode is set to 0660\n- listen.owner = http\n+ listen.owner = caddy\n- listen.group = http\n+ listen.group = caddy\n;listen.mode = 0660\n; When POSIX Access Control Lists are supported you can set them using\n; these options, value is a comma separated list of user/group names.\n; When set, listen.owner and listen.group are ignored\n;listen.acl_users =\n;listen.acl_groups =\n---\n",[543,1636,1637,1641,1646,1651,1656,1661,1666,1671,1676,1681,1686,1691,1696,1701,1705,1709,1714,1719,1724,1729,1734,1739,1744,1749,1754,1759,1764,1769,1774,1779,1784],{"__ignoreMap":489},[587,1638,1639],{"class":589,"line":590},[587,1640,1038],{},[587,1642,1643],{"class":589,"line":3},[587,1644,1645],{},"; Unix user/group of processes\n",[587,1647,1648],{"class":589,"line":1041},[587,1649,1650],{},"; Note: The user is mandatory. If the group is not set, the default user's group\n",[587,1652,1653],{"class":589,"line":1048},[587,1654,1655],{},";       will be used.\n",[587,1657,1658],{"class":589,"line":1055},[587,1659,1660],{},"- user = http\n",[587,1662,1663],{"class":589,"line":1085},[587,1664,1665],{},"+ user = caddy\n",[587,1667,1668],{"class":589,"line":1091},[587,1669,1670],{},"- group = http\n",[587,1672,1673],{"class":589,"line":1114},[587,1674,1675],{},"+ group = caddy\n",[587,1677,1678],{"class":589,"line":1126},[587,1679,1680],{},"; The address on which to accept FastCGI requests.\n",[587,1682,1683],{"class":589,"line":1132},[587,1684,1685],{},"; Valid syntaxes are:\n",[587,1687,1688],{"class":589,"line":1146},[587,1689,1690],{},";   'ip.add.re.ss:port'    - to listen on a TCP socket to a specific IPv4 address on\n",[587,1692,1693],{"class":589,"line":1408},[587,1694,1695],{},";                            a specific port;\n",[587,1697,1698],{"class":589,"line":1414},[587,1699,1700],{},";   '[ip:6:addr:ess]:port' - to listen on a TCP socket to a specific IPv6 address on\n",[587,1702,1703],{"class":589,"line":1420},[587,1704,1038],{},[587,1706,1707],{"class":589,"line":1426},[587,1708,1038],{},[587,1710,1711],{"class":589,"line":1432},[587,1712,1713],{},"; Note: This value is mandatory.\n",[587,1715,1716],{"class":589,"line":1438},[587,1717,1718],{},"listen = /run/php-fpm/php-fpm.sock\n",[587,1720,1721],{"class":589,"line":1444},[587,1722,1723],{},"; and group can be specified either by name or by their numeric IDs.\n",[587,1725,1726],{"class":589,"line":1450},[587,1727,1728],{},"; Default Values: user and group are set as the running user\n",[587,1730,1731],{"class":589,"line":1456},[587,1732,1733],{},";                 mode is set to 0660\n",[587,1735,1736],{"class":589,"line":1462},[587,1737,1738],{},"- listen.owner = http\n",[587,1740,1741],{"class":589,"line":1468},[587,1742,1743],{},"+ listen.owner = caddy\n",[587,1745,1746],{"class":589,"line":1474},[587,1747,1748],{},"- listen.group = http\n",[587,1750,1751],{"class":589,"line":1480},[587,1752,1753],{},"+ listen.group = caddy\n",[587,1755,1756],{"class":589,"line":1486},[587,1757,1758],{},";listen.mode = 0660\n",[587,1760,1761],{"class":589,"line":1492},[587,1762,1763],{},"; When POSIX Access Control Lists are supported you can set them using\n",[587,1765,1766],{"class":589,"line":1498},[587,1767,1768],{},"; these options, value is a comma separated list of user/group names.\n",[587,1770,1771],{"class":589,"line":1504},[587,1772,1773],{},"; When set, listen.owner and listen.group are ignored\n",[587,1775,1776],{"class":589,"line":1510},[587,1777,1778],{},";listen.acl_users =\n",[587,1780,1781],{"class":589,"line":1516},[587,1782,1783],{},";listen.acl_groups =\n",[587,1785,1786],{"class":589,"line":1522},[587,1787,1038],{},[15,1789,1790,1793,1794,1797],{},[80,1791,1792],{},"2022年1月14日更新","：在 Fedora 尝试部署的时候遇到了新的坑，Fedora 的相应配置文件为 ",[543,1795,1796],{},"/etc/php-fpm.d/www.conf","，相应修改如下",[579,1799,1801],{"className":1346,"code":1800,"language":1348,"meta":489,"style":489},"; Unix user/group of processes\n; Note: The user is mandatory. If the group is not set, the default user's group\n;       will be used.\n; RPM: apache user chosen to provide access to the same directories as httpd\n-user = apache\n+user = caddy\n; RPM: Keep a group allowed to write in log dir.\n-user = apache\n+group = caddy\n\n; The address on which to accept FastCGI requests.\n; Valid syntaxes are:\n;   'ip.add.re.ss:port'    - to listen on a TCP socket to a specific IPv4 address on\n;             a specific port;\n---\n---\n; Set permissions for unix socket, if one is used. In Linux, read/write\n; permissions must be set in order to allow connections from a web server.\n; Default Values: user and group are set as the running user\n;                 mode is set to 0660\n-;listen.owner = nobody\n+listen.owner = caddy\n-;listen.owner = nobody\n+listen.group = caddy\n;listen.mode = 0660\n\n; When POSIX Access Control Lists are supported you can set them using\n; these options, value is a comma separated list of user/group names.\n; When set, listen.owner and listen.group are ignored\n-listen.acl_users = apache,nginx\n+;listen.acl_users = apache,nginx\n;listen.acl_groups =\n\n; List of addresses (IPv4/IPv6) of FastCGI clients which are allowed to connect.\n; Equivalent to the FCGI_WEB_SERVER_ADDRS environment variable in the original\n; PHP FCGI (5.2.2+). Makes sense only with a tcp listening socket. Each address\n; must be separated by a comma. If this value is left blank, connections will be\n; accepted from any ip address.\n; Default Value: any\nlisten.allowed_clients = 127.0.0.1\n",[543,1802,1803,1807,1811,1815,1820,1825,1830,1835,1839,1844,1848,1852,1856,1860,1865,1869,1873,1878,1883,1887,1891,1896,1901,1905,1910,1914,1918,1922,1926,1930,1935,1940,1944,1948,1953,1958,1963,1968,1973,1978],{"__ignoreMap":489},[587,1804,1805],{"class":589,"line":590},[587,1806,1645],{},[587,1808,1809],{"class":589,"line":3},[587,1810,1650],{},[587,1812,1813],{"class":589,"line":1041},[587,1814,1655],{},[587,1816,1817],{"class":589,"line":1048},[587,1818,1819],{},"; RPM: apache user chosen to provide access to the same directories as httpd\n",[587,1821,1822],{"class":589,"line":1055},[587,1823,1824],{},"-user = apache\n",[587,1826,1827],{"class":589,"line":1085},[587,1828,1829],{},"+user = caddy\n",[587,1831,1832],{"class":589,"line":1091},[587,1833,1834],{},"; RPM: Keep a group allowed to write in log dir.\n",[587,1836,1837],{"class":589,"line":1114},[587,1838,1824],{},[587,1840,1841],{"class":589,"line":1126},[587,1842,1843],{},"+group = caddy\n",[587,1845,1846],{"class":589,"line":1132},[587,1847,1052],{"emptyLinePlaceholder":1051},[587,1849,1850],{"class":589,"line":1146},[587,1851,1680],{},[587,1853,1854],{"class":589,"line":1408},[587,1855,1685],{},[587,1857,1858],{"class":589,"line":1414},[587,1859,1690],{},[587,1861,1862],{"class":589,"line":1420},[587,1863,1864],{},";             a specific port;\n",[587,1866,1867],{"class":589,"line":1426},[587,1868,1038],{},[587,1870,1871],{"class":589,"line":1432},[587,1872,1038],{},[587,1874,1875],{"class":589,"line":1438},[587,1876,1877],{},"; Set permissions for unix socket, if one is used. In Linux, read/write\n",[587,1879,1880],{"class":589,"line":1444},[587,1881,1882],{},"; permissions must be set in order to allow connections from a web server.\n",[587,1884,1885],{"class":589,"line":1450},[587,1886,1728],{},[587,1888,1889],{"class":589,"line":1456},[587,1890,1733],{},[587,1892,1893],{"class":589,"line":1462},[587,1894,1895],{},"-;listen.owner = nobody\n",[587,1897,1898],{"class":589,"line":1468},[587,1899,1900],{},"+listen.owner = caddy\n",[587,1902,1903],{"class":589,"line":1474},[587,1904,1895],{},[587,1906,1907],{"class":589,"line":1480},[587,1908,1909],{},"+listen.group = caddy\n",[587,1911,1912],{"class":589,"line":1486},[587,1913,1758],{},[587,1915,1916],{"class":589,"line":1492},[587,1917,1052],{"emptyLinePlaceholder":1051},[587,1919,1920],{"class":589,"line":1498},[587,1921,1763],{},[587,1923,1924],{"class":589,"line":1504},[587,1925,1768],{},[587,1927,1928],{"class":589,"line":1510},[587,1929,1773],{},[587,1931,1932],{"class":589,"line":1516},[587,1933,1934],{},"-listen.acl_users = apache,nginx\n",[587,1936,1937],{"class":589,"line":1522},[587,1938,1939],{},"+;listen.acl_users = apache,nginx\n",[587,1941,1942],{"class":589,"line":1528},[587,1943,1783],{},[587,1945,1946],{"class":589,"line":1534},[587,1947,1052],{"emptyLinePlaceholder":1051},[587,1949,1950],{"class":589,"line":1540},[587,1951,1952],{},"; List of addresses (IPv4/IPv6) of FastCGI clients which are allowed to connect.\n",[587,1954,1955],{"class":589,"line":1546},[587,1956,1957],{},"; Equivalent to the FCGI_WEB_SERVER_ADDRS environment variable in the original\n",[587,1959,1960],{"class":589,"line":1552},[587,1961,1962],{},"; PHP FCGI (5.2.2+). Makes sense only with a tcp listening socket. Each address\n",[587,1964,1965],{"class":589,"line":1558},[587,1966,1967],{},"; must be separated by a comma. If this value is left blank, connections will be\n",[587,1969,1970],{"class":589,"line":1564},[587,1971,1972],{},"; accepted from any ip address.\n",[587,1974,1975],{"class":589,"line":1570},[587,1976,1977],{},"; Default Value: any\n",[587,1979,1980],{"class":589,"line":1576},[587,1981,1982],{},"listen.allowed_clients = 127.0.0.1\n",[520,1984,1986],{"id":1985},"拉取-picuploader-最新代码","拉取 PicUploader 最新代码",[15,1988,1989],{},"首先创建一个用于存放代码的目录",[579,1991,1993],{"className":581,"code":1992,"language":583,"meta":489,"style":489},"sudo mkdir -p /var/www/\n",[543,1994,1995],{"__ignoreMap":489},[587,1996,1997,1999,2002,2004],{"class":589,"line":590},[587,1998,640],{"class":593},[587,2000,2001],{"class":601}," mkdir",[587,2003,892],{"class":597},[587,2005,2006],{"class":601}," /var/www/\n",[15,2008,2009],{},"clone 最新源码",[579,2011,2013],{"className":581,"code":2012,"language":583,"meta":489,"style":489},"sudo git clone https://github.com/xiebruce/PicUploader.git /var/www/picuploader\n",[543,2014,2015],{"__ignoreMap":489},[587,2016,2017,2019,2022,2025,2028],{"class":589,"line":590},[587,2018,640],{"class":593},[587,2020,2021],{"class":601}," git",[587,2023,2024],{"class":601}," clone",[587,2026,2027],{"class":601}," https://github.com/xiebruce/PicUploader.git",[587,2029,2030],{"class":601}," /var/www/picuploader\n",[15,2032,2033],{},"将代码所有权转交给caddy用户",[579,2035,2037],{"className":581,"code":2036,"language":583,"meta":489,"style":489},"sudo chown -R caddy:caddy /var/www/picuploader\n",[543,2038,2039],{"__ignoreMap":489},[587,2040,2041,2043,2046,2048,2051],{"class":589,"line":590},[587,2042,640],{"class":593},[587,2044,2045],{"class":601}," chown",[587,2047,1206],{"class":597},[587,2049,2050],{"class":601}," caddy:caddy",[587,2052,2030],{"class":601},[520,2054,2056],{"id":2055},"编辑caddyfile","编辑Caddyfile",[15,2058,2059,2060,2063],{},"caddy默认使用",[543,2061,2062],{},"/etc/caddy/Caddyfile","，因此如果你就部署这一个站点，直接修改这个就好了。",[15,2065,2066],{},"caddy的语法非常简洁易懂，因此我随手写了几行就能跑起来了。",[15,2068,2069,2070,2073],{},"下面是我用的Caddyfile，如果你在服务器上部署，请把",[543,2071,2072],{},"http://api.picuploader.com","更换为你服务器所需要绑定的域名(不带http协议头)，caddy将自动为你申请ssl证书。",[579,2075,2078],{"className":2076,"code":2077,"language":918},[916],"http://api.picuploader.com {\n        root * /var/www/picuploader\n\n        php_fastcgi * unix//run/php-fpm/php-fpm.sock {\n                index dashboard.php\n        }\n\n        file_server {\n                index index.php\n        }\n\n        handle_errors {\n        root * /etc/caddy/error\n                rewrite * /error.html\n                templates\n                file_server\n        }\n}\n\n# Import additional caddy config files in /etc/caddy/conf.d/\nimport /etc/caddy/conf.d/*\n",[543,2079,2077],{"__ignoreMap":489},[15,2081,2082,2083,2086,2087,2089,2090,2093],{},"php我选择了监听本地",[543,2084,2085],{},"unix//run/php-fpm/php-fpm.sock","的方案，这个路径在上文的",[543,2088,1630],{},"可以设置，如需查询，直接使用 ",[543,2091,2092],{},"grep listen\\ = /etc/php/php-fpm.d/www.conf","应该就能看见。",[946,2095,2097],{"id":2096},"设置访问密码可选","设置访问密码（可选）",[15,2099,2100,2101,2104],{},"caddy2开始不允许在caddyfile中直接指定明文密码，因此我们需要用",[543,2102,2103],{},"hash-password","获取加密后的密码密文",[579,2106,2108],{"className":581,"code":2107,"language":583,"meta":489,"style":489},"caddy hash-password  --plaintext \u003CYourPassword>\n",[543,2109,2110],{"__ignoreMap":489},[587,2111,2112,2114,2117,2120,2123,2126,2129],{"class":589,"line":590},[587,2113,1275],{"class":593},[587,2115,2116],{"class":601}," hash-password",[587,2118,2119],{"class":597},"  --plaintext",[587,2121,2122],{"class":1058}," \u003C",[587,2124,2125],{"class":601},"YourPasswor",[587,2127,2128],{"class":895},"d",[587,2130,2131],{"class":1058},">\n",[15,2133,2134],{},"再在Caddyfile中，加上",[579,2136,2139],{"className":2137,"code":2138,"language":918},[916],"basicauth /* {\n        \u003Cusername> \u003Chashed_password>\n}\n",[543,2140,2138],{"__ignoreMap":489},[520,2142,2144],{"id":2143},"修改hosts设置dns解析","修改hosts/设置DNS解析",[15,2146,2147],{},"由于 api.picuploader.com 这个域名不在我手里，而我只是想在本地使用，并不打算部署到服务器，因此修改hosts将这个域名解析到本地是个不错的选择。",[579,2149,2151],{"className":581,"code":2150,"language":583,"meta":489,"style":489},"sudo sh -c \"echo '127.0.0.1     api.picuploader.com'  /etc/hosts\"\n",[543,2152,2153],{"__ignoreMap":489},[587,2154,2155,2157,2160,2163],{"class":589,"line":590},[587,2156,640],{"class":593},[587,2158,2159],{"class":601}," sh",[587,2161,2162],{"class":597}," -c",[587,2164,2165],{"class":601}," \"echo '127.0.0.1     api.picuploader.com'  /etc/hosts\"\n",[15,2167,2168],{},"而你若是在服务器上部署，应当去设置DNS解析，这个应该不需要我多说。",[520,2170,2171],{"id":2171},"开启服务",[15,2173,2174,2175,546,2177,2179],{},"在Archlinux下，我习惯直接用systemd运行",[543,2176,1275],{},[543,2178,1278],{},"以开机自启动。",[579,2181,2183],{"className":581,"code":2182,"language":583,"meta":489,"style":489},"sudo systemctl enable --now caddy php-fpm\n",[543,2184,2185],{"__ignoreMap":489},[587,2186,2187,2189,2191,2194,2197,2199],{"class":589,"line":590},[587,2188,640],{"class":593},[587,2190,698],{"class":601},[587,2192,2193],{"class":601}," enable",[587,2195,2196],{"class":597}," --now",[587,2198,1295],{"class":601},[587,2200,2201],{"class":601}," php-fpm\n",[520,2203,2204],{"id":2204},"最终测试",[15,2206,2207,2208,2212],{},"在浏览器内访问 ",[22,2209,2211],{"href":2072,"rel":2210},[26],"api.picuploader.com"," ，如果能看到页面，就算是成功啦。",[520,2214,2215],{"id":2215},"设置上传参数",[15,2217,2218,2219],{},"见作者博客：",[22,2220,2223],{"href":2221,"rel":2222},"https://www.xiebruce.top/117.html",[26],"PicUploader: 各图床获取上传图片参数的方法",[834,2225,2226],{},"html pre.shiki code .sScJk, html code.shiki .sScJk{--shiki-default:#6F42C1;--shiki-dark:#B392F0}html pre.shiki code .sZZnC, html code.shiki .sZZnC{--shiki-default:#032F62;--shiki-dark:#9ECBFF}html pre.shiki code .sj4cs, html code.shiki .sj4cs{--shiki-default:#005CC5;--shiki-dark:#79B8FF}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html pre.shiki code .szBVR, html code.shiki .szBVR{--shiki-default:#D73A49;--shiki-dark:#F97583}html pre.shiki code .sVt8B, html code.shiki .sVt8B{--shiki-default:#24292E;--shiki-dark:#E1E4E8}",{"title":489,"searchDepth":3,"depth":3,"links":2228},[2229,2230,2238,2239,2242,2243,2244,2245],{"id":1272,"depth":3,"text":1272},{"id":1309,"depth":3,"text":1309,"children":2231},[2232,2234,2236],{"id":1315,"depth":1041,"text":2233},"在/etc/php/php.ini启用PicUploader所需拓展",{"id":1600,"depth":1041,"text":2235},"编辑/etc/php/php.ini以增加单文件上传大小限制",{"id":1627,"depth":1041,"text":2237},"编辑/etc/php/php-fpm.d/www.conf使其在运行时使用caddy用户。",{"id":1985,"depth":3,"text":1986},{"id":2055,"depth":3,"text":2056,"children":2240},[2241],{"id":2096,"depth":1041,"text":2097},{"id":2143,"depth":3,"text":2144},{"id":2171,"depth":3,"text":2171},{"id":2204,"depth":3,"text":2204},{"id":2215,"depth":3,"text":2215},{"title":2247,"date":2248,"path":2249,"tags":2250,"body":2251},"Archlinux坚果云踩坑实录","2021-10-02 00:21:34","/2021/10/02/nutstore-guide-on-archlinux-kde",[496],{"type":12,"value":2252,"toc":2559},[2253,2258,2260,2274,2277,2280,2283,2288,2295,2301,2307,2328,2331,2334,2340,2346,2352,2356,2362,2370,2399,2405,2409,2412,2418,2425,2455,2459,2462,2480,2486,2556],[31,2254,2255],{},[15,2256,2257],{},"在Archlinux上，坚果云似乎出现了一些问题。",[520,2259,574],{"id":574},[579,2261,2263],{"className":581,"code":2262,"language":583,"meta":489,"style":489},"yay -S nutstore\n",[543,2264,2265],{"__ignoreMap":489},[587,2266,2267,2269,2271],{"class":589,"line":590},[587,2268,594],{"class":593},[587,2270,598],{"class":597},[587,2272,2273],{"class":601}," nutstore\n",[15,2275,2276],{},"这个没什么可说的，AUR还是Archlinuxcn都无所谓，都是一模一样的。",[520,2278,2279],{"id":2279},"白屏",[15,2281,2282],{},"双击图标，咦？怎么白屏了？",[15,2284,2285],{},[48,2286],{"alt":2279,"src":2287},"https://static.031130.xyz/uploads/2024/08/12/62f3cc797bc09.webp",[15,2289,2290,2291,2294],{},"看看AUR评论区，有人说",[543,2292,2293],{},"nutstore-experimental","修了？",[15,2296,2297],{},[48,2298],{"alt":2299,"src":2300},"AUR评论区","https://static.031130.xyz/uploads/2024/08/12/62f3cc7df08ad.webp",[15,2302,2303,2304],{},"对比了一下，就是改了改",[543,2305,2306],{},"/opt/nutstore/conf/nutstore.properties",[579,2308,2310],{"className":581,"code":2309,"language":583,"meta":489,"style":489},"sudo sed -i 's|webui.enable=true|webui.enable=false|' /opt/nutstore/conf/nutstore.properties\n",[543,2311,2312],{"__ignoreMap":489},[587,2313,2314,2316,2319,2322,2325],{"class":589,"line":590},[587,2315,640],{"class":593},[587,2317,2318],{"class":601}," sed",[587,2320,2321],{"class":597}," -i",[587,2323,2324],{"class":601}," 's|webui.enable=true|webui.enable=false|'",[587,2326,2327],{"class":601}," /opt/nutstore/conf/nutstore.properties\n",[15,2329,2330],{},"轻松解决",[520,2332,2333],{"id":2333},"窗口太小不能登陆",[15,2335,2336],{},[48,2337],{"alt":2338,"src":2339},"调出窗口规则设置界面","https://static.031130.xyz/uploads/2024/08/12/62f3cc822fbe9.webp",[15,2341,2342],{},[48,2343],{"alt":2344,"src":2345},"进行设置","https://static.031130.xyz/uploads/2024/08/12/62f3cc864a783.webp",[15,2347,2348],{},[48,2349],{"alt":2350,"src":2351},"完成","https://static.031130.xyz/uploads/2024/08/12/62f3cc89ca4eb.webp",[520,2353,2355],{"id":2354},"桌面使用了暗色主题导致部分字体不清晰","桌面使用了暗色主题导致部分字体不清晰？",[15,2357,2358],{},[48,2359],{"alt":2360,"src":2361},"这字体鬼看得见？","https://static.031130.xyz/uploads/2024/08/12/62f3cc8f193b1.webp",[15,2363,2364,2365,2369],{},"参考",[22,2366,2368],{"href":2367},"/2021/09/05/wrong-fonts-color-fix-under-kde-with-a-dark-theme/","使用fakehome方案暂时解决跑在KDE暗色主题下的程序使用亮色字体的问题","编写启动命令",[579,2371,2373],{"className":581,"code":2372,"language":583,"meta":489,"style":489},"bwrap --dev-bind / / --tmpfs $HOME/.config /usr/bin/nutstore\n",[543,2374,2375],{"__ignoreMap":489},[587,2376,2377,2380,2383,2386,2388,2391,2393,2396],{"class":589,"line":590},[587,2378,2379],{"class":593},"bwrap",[587,2381,2382],{"class":597}," --dev-bind",[587,2384,2385],{"class":601}," /",[587,2387,2385],{"class":601},[587,2389,2390],{"class":597}," --tmpfs",[587,2392,896],{"class":895},[587,2394,2395],{"class":601},"/.config",[587,2397,2398],{"class":601}," /usr/bin/nutstore\n",[15,2400,2401],{},[48,2402],{"alt":2403,"src":2404},"测试通过","https://static.031130.xyz/uploads/2024/08/12/62f3cc9245d26.webp",[520,2406,2408],{"id":2407},"本地markdown文件的文件类型被识别成了坚果云-markdown","本地markdown文件的文件类型被识别成了「坚果云 Markdown」",[15,2410,2411],{},"这个是由于坚果云自作主张推广他自己并不好用的lightapp，写了几条 mime 的规则，如图",[15,2413,2414],{},[48,2415],{"alt":2416,"src":2417},"没错，整整5个xml","https://static.031130.xyz/uploads/2024/08/12/62f3cc95f0dd1.webp",[15,2419,2420,2421,2424],{},"看来在我们的启动命令中也需要防止坚果云接触到",[543,2422,2423],{},"$HOME/.local/share/","这个路径，所以现在的启动命令得写成这样。",[579,2426,2428],{"className":581,"code":2427,"language":583,"meta":489,"style":489},"bwrap --dev-bind / / --tmpfs $HOME/.config --tmpfs $HOME/.local/share/ /usr/bin/nutstore\n",[543,2429,2430],{"__ignoreMap":489},[587,2431,2432,2434,2436,2438,2440,2442,2444,2446,2448,2450,2453],{"class":589,"line":590},[587,2433,2379],{"class":593},[587,2435,2382],{"class":597},[587,2437,2385],{"class":601},[587,2439,2385],{"class":601},[587,2441,2390],{"class":597},[587,2443,896],{"class":895},[587,2445,2395],{"class":601},[587,2447,2390],{"class":597},[587,2449,896],{"class":895},[587,2451,2452],{"class":601},"/.local/share/",[587,2454,2398],{"class":601},[520,2456,2458],{"id":2457},"修改desktop文件使其使用我们自己攥写的启动命令","修改desktop文件，使其使用我们自己攥写的启动命令",[15,2460,2461],{},"首先，复制一份desktop文件到我们的 $HOME 目录下，好处是下次更新的时候我们所做的更改不会被包管理器覆盖。",[579,2463,2465],{"className":581,"code":2464,"language":583,"meta":489,"style":489},"cp /usr/share/applications/nutstore.desktop $HOME/.local/share/applications/\n",[543,2466,2467],{"__ignoreMap":489},[587,2468,2469,2472,2475,2477],{"class":589,"line":590},[587,2470,2471],{"class":593},"cp",[587,2473,2474],{"class":601}," /usr/share/applications/nutstore.desktop",[587,2476,896],{"class":895},[587,2478,2479],{"class":601},"/.local/share/applications/\n",[15,2481,2482,2483],{},"再修改",[543,2484,2485],{},"$HOME/.local/share/applications/nutstore.desktop",[579,2487,2489],{"className":1346,"code":2488,"language":1348,"meta":489,"style":489},"[Desktop Entry]\nEncoding=UTF-8\nType=Application\nTerminal=false\nIcon=nutstore\n-Exec=/usr/bin/nutstore\n+Exec=bwrap --dev-bind / / --tmpfs $HOME/.config --tmpfs $HOME/.local/share/applications --tmpfs $HOME/.local/share/mime /usr/bin/nutstore\nStartupWMClass=Nutstore\nName=Nutstore\nName[zh_CN]=坚果云 \nComment=Data Sync, Sharing, Backup\nComment[zh_CN]=数据同步,共享和备份\nCategories=Network;Application;\n",[543,2490,2491,2496,2501,2506,2511,2516,2521,2526,2531,2536,2541,2546,2551],{"__ignoreMap":489},[587,2492,2493],{"class":589,"line":590},[587,2494,2495],{},"[Desktop Entry]\n",[587,2497,2498],{"class":589,"line":3},[587,2499,2500],{},"Encoding=UTF-8\n",[587,2502,2503],{"class":589,"line":1041},[587,2504,2505],{},"Type=Application\n",[587,2507,2508],{"class":589,"line":1048},[587,2509,2510],{},"Terminal=false\n",[587,2512,2513],{"class":589,"line":1055},[587,2514,2515],{},"Icon=nutstore\n",[587,2517,2518],{"class":589,"line":1085},[587,2519,2520],{},"-Exec=/usr/bin/nutstore\n",[587,2522,2523],{"class":589,"line":1091},[587,2524,2525],{},"+Exec=bwrap --dev-bind / / --tmpfs $HOME/.config --tmpfs $HOME/.local/share/applications --tmpfs $HOME/.local/share/mime /usr/bin/nutstore\n",[587,2527,2528],{"class":589,"line":1114},[587,2529,2530],{},"StartupWMClass=Nutstore\n",[587,2532,2533],{"class":589,"line":1126},[587,2534,2535],{},"Name=Nutstore\n",[587,2537,2538],{"class":589,"line":1132},[587,2539,2540],{},"Name[zh_CN]=坚果云 \n",[587,2542,2543],{"class":589,"line":1146},[587,2544,2545],{},"Comment=Data Sync, Sharing, Backup\n",[587,2547,2548],{"class":589,"line":1408},[587,2549,2550],{},"Comment[zh_CN]=数据同步,共享和备份\n",[587,2552,2553],{"class":589,"line":1414},[587,2554,2555],{},"Categories=Network;Application;\n",[834,2557,2558],{},"html pre.shiki code .sScJk, html code.shiki .sScJk{--shiki-default:#6F42C1;--shiki-dark:#B392F0}html pre.shiki code .sj4cs, html code.shiki .sj4cs{--shiki-default:#005CC5;--shiki-dark:#79B8FF}html pre.shiki code .sZZnC, html code.shiki .sZZnC{--shiki-default:#032F62;--shiki-dark:#9ECBFF}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html pre.shiki code .sVt8B, html code.shiki .sVt8B{--shiki-default:#24292E;--shiki-dark:#E1E4E8}",{"title":489,"searchDepth":3,"depth":3,"links":2560},[2561,2562,2563,2564,2565,2566],{"id":574,"depth":3,"text":574},{"id":2279,"depth":3,"text":2279},{"id":2333,"depth":3,"text":2333},{"id":2354,"depth":3,"text":2355},{"id":2407,"depth":3,"text":2408},{"id":2457,"depth":3,"text":2458},{"title":2568,"date":2569,"path":2570,"tags":2571,"body":2575},"把老版的火狐顶栏UI带回来","2021-10-01 19:20:23","/2021/10/01/bring-firefox-old-topbar-back",[2572,2573,2574],"Firefox","Linux","Bwrap",{"type":12,"value":2576,"toc":2736},[2577,2583,2589,2600,2603,2609,2637,2644,2651,2656,2667,2673,2676,2682,2685,2694,2700,2703,2721,2727,2733],[15,2578,2579],{},[48,2580],{"alt":2581,"src":2582},"这是最新版火狐的顶栏","https://static.031130.xyz/uploads/2024/08/12/62f3cca6bb523.webp",[15,2584,2585],{},[48,2586],{"alt":2587,"src":2588},"这是去掉标题栏后的样子","https://static.031130.xyz/uploads/2024/08/12/62f3ccaa2b91c.webp",[31,2590,2591],{},[15,2592,2593,2594,2599],{},"在Firefox更新UI以后，我就一直感觉不太适应。顶栏的一个个标签页占用的体积达到了原来的1.5~2倍。Thanks to ",[22,2595,2598],{"href":2596,"rel":2597},"https://github.com/black7375/Firefox-UI-Fix",[26],"black7375/Firefox-UI-Fix"," ，我们得以把以前的顶栏找回来。",[946,2601,2602],{"id":2602},"加载新的css",[15,2604,2605,2606],{},"clone该github项目并进入对应路径后，执行",[543,2607,2608],{},"install.sh",[579,2610,2612],{"className":581,"code":2611,"language":583,"meta":489,"style":489},"git clone https://github.com/black7375/Firefox-UI-Fix.git\ncd Firefox-UI-Fix.git\n./install.sh\n",[543,2613,2614,2624,2632],{"__ignoreMap":489},[587,2615,2616,2619,2621],{"class":589,"line":590},[587,2617,2618],{"class":593},"git",[587,2620,2024],{"class":601},[587,2622,2623],{"class":601}," https://github.com/black7375/Firefox-UI-Fix.git\n",[587,2625,2626,2629],{"class":589,"line":3},[587,2627,2628],{"class":597},"cd",[587,2630,2631],{"class":601}," Firefox-UI-Fix.git\n",[587,2633,2634],{"class":589,"line":1041},[587,2635,2636],{"class":593},"./install.sh\n",[15,2638,2639,2640,2643],{},"在接下来的对话中，我们选择",[543,2641,2642],{},"Photon-Style","，这是最接近老版UI的。",[15,2645,2646,2647,2650],{},"紧接着脚本会要求我们选择我们的Firefox数据文件夹，我们可以打开Firefox，在浏览器地址栏输入",[543,2648,2649],{},"about:support","查看到我们所使用的数据文件夹路径。",[15,2652,2653],{},[48,2654],{"alt":2649,"src":2655},"https://static.031130.xyz/uploads/2024/08/12/62f3ccadd6ce8.webp",[15,2657,2658,2659,2662,2663,2666],{},"使用空格键选择我们的数据文件夹后，在终端上该路径开头处的",[543,2660,2661],{},"[ ]","中会被打上",[543,2664,2665],{},"X","，确认无误后，敲回车。",[15,2668,2669],{},[48,2670],{"alt":2671,"src":2672},"终端显示","https://static.031130.xyz/uploads/2024/08/12/62f3ccb1b0ebf.webp",[15,2674,2675],{},"重启浏览器，顶栏就长成了这样。",[15,2677,2678],{},[48,2679],{"alt":2680,"src":2681},"Fix后的顶栏效果","https://static.031130.xyz/uploads/2024/08/12/62f3ccb49ff10.webp",[946,2683,2684],{"id":2684},"添加主题",[15,2686,2687,2688,2693],{},"为了进一步模仿Firefox经典的配色，我们可以安装上",[22,2689,2692],{"href":2690,"rel":2691},"https://addons.mozilla.org/zh-CN/firefox/addon/photon-colors/",[26],"这个主题","，变成这样",[15,2695,2696],{},[48,2697],{"alt":2698,"src":2699},"应用主题后的样子","https://static.031130.xyz/uploads/2024/08/12/62f3ccb7bc14f.webp",[946,2701,2702],{"id":2702},"禁用暗色模式",[15,2704,2705,2706,2711,2712,2720],{},"如果你的系统主题使用的是深色，导致了诸如",[22,2707,2710],{"href":2708,"rel":2709},"https://mirrors.tuna.tsinghua.edu.cn",[26],"TUNA镜像站","自动为你启用了暗色模式，而你想禁用的话，",[22,2713,2715,2716,2719],{"href":2714},"/2021/04/23/disable-firefox-nightmode-when-your-system-is-using-that/","之前通过修改",[543,2717,2718],{},"about:config","方案","依然适用。",[15,2722,2723],{},[48,2724],{"alt":2725,"src":2726},"修改前","https://static.031130.xyz/uploads/2024/08/12/62f3ccbb36c5e.webp",[15,2728,2729],{},[48,2730],{"alt":2731,"src":2732},"修改后","https://static.031130.xyz/uploads/2024/08/12/62f3ccbe6f31a.webp",[834,2734,2735],{},"html pre.shiki code .sScJk, html code.shiki .sScJk{--shiki-default:#6F42C1;--shiki-dark:#B392F0}html pre.shiki code .sZZnC, html code.shiki .sZZnC{--shiki-default:#032F62;--shiki-dark:#9ECBFF}html pre.shiki code .sj4cs, html code.shiki .sj4cs{--shiki-default:#005CC5;--shiki-dark:#79B8FF}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}",{"title":489,"searchDepth":3,"depth":3,"links":2737},[2738,2739,2740],{"id":2602,"depth":1041,"text":2602},{"id":2684,"depth":1041,"text":2684},{"id":2702,"depth":1041,"text":2702},{"title":2742,"date":2743,"path":2744,"tags":2745,"body":2747},"记录一次原创文章被抄袭","2021-09-21","/2021/09/21/csdn-copied-my-article",[2746],"Blog",{"type":12,"value":2748,"toc":2837},[2749,2758,2761,2767,2770,2773,2779,2785,2791,2797,2803,2806,2828,2834],[15,2750,2751,2752,2757],{},"今天在网站自搜的时候偶然间发现了一个叫「程序员宝宝」的站点转载了我去年在知乎专栏上发的一篇文章",[22,2753,2756],{"href":2754,"rel":2755},"https://zhuanlan.zhihu.com/p/141107518",[26],"《Ubuntu下对deepin-wine的使用详解》","。",[15,2759,2760],{},"转载的质量并不高，超链接都没有转载上去，只有干巴巴的图片和文字。翻到结尾处，我一口老血喷出。",[15,2762,2763],{},[48,2764],{"alt":2765,"src":2766},"都不知道哪里来的版权申明","https://static.031130.xyz/uploads/2024/08/12/62f3cacc1ff3f.webp",[15,2768,2769],{},"我就纳闷了，我作为原创博主，自己都没有给这篇文章挂上CC的版权协议，怎么就有人自称是原创给我挂上了CC协议，要知道我知乎还明确勾选了「转载需要申请」呢。",[15,2771,2772],{},"抱着吃瓜的心态在谷歌上搜索，我发现了五篇抄袭我的文章。CSDN三篇，还有「程序员宝宝」和「程序员宅基地」使用相同UI的、被我怀疑是机器人搬运的站点。",[15,2774,2775],{},[48,2776],{"alt":2777,"src":2778},"谷歌搜索结果","https://static.031130.xyz/uploads/2024/08/12/62f3cad01576d.webp",[15,2780,2781,2782],{},"CSDN那边，我在页面页脚处找到了「在线客服」，注册帐号后联系了客服，客服反应非常迅速，",[80,2783,2784],{},"5分钟内就对抄袭文章进行了下架处理，这点值得表扬。",[15,2786,2787],{},[48,2788],{"alt":2789,"src":2790},"CSDN客服聊天记录1","https://static.031130.xyz/uploads/2024/08/12/62f3cad3ceaa6.webp",[15,2792,2793],{},[48,2794],{"alt":2795,"src":2796},"CSDN客服聊天记录2","https://static.031130.xyz/uploads/2024/08/12/62f3cad833827.webp",[15,2798,2799],{},[48,2800],{"alt":2801,"src":2802},"CSDN客服聊天记录3","https://static.031130.xyz/uploads/2024/08/12/62f3cadacac4d.webp",[15,2804,2805],{},"至于「程序员宝宝」和「程序员宅基地」这两个站点，在他们的版权申明中写得很清楚。",[31,2807,2808,2813,2816,2825],{},[15,2809,2810],{},[80,2811,2812],{},"如果你是文章作者：",[15,2814,2815],{},"请通过邮件联系我们，邮件内容包括：",[2817,2818,2819,2822],"ol",{},[76,2820,2821],{},"待删除的文章链接",[76,2823,2824],{},"发件人是待删除文章作者的证明（如果发件人邮箱地址能证明你是文章作者，此项内容可以为空）",[15,2826,2827],{},"我们会在收到邮件后7个工作日内进行处理。",[15,2829,2830,2831],{},"但我找遍了整个网站，",[80,2832,2833],{},"根本没有发现站点方的邮箱。",[15,2835,2836],{},"不知诸位有何解决方案？",{"title":489,"searchDepth":3,"depth":3,"links":2838},[],{"title":2840,"date":2841,"path":2842,"tags":2843,"body":2844},"使用AUR(Helper)安装软件时究竟发生了什么？对于常见的构建错误如何解决？","2021-09-11 19:22:29","/2021/09/11/detailed-explanation-for-aur",[2573,496],{"type":12,"value":2845,"toc":3264},[2846,2851,2855,2862,2869,2875,2908,2910,2913,2938,2941,2961,2967,2971,2978,2984,2988,2991,2995,3002,3008,3011,3032,3034,3037,3043,3049,3053,3177,3181,3184,3191,3198,3211,3215,3218,3220,3223,3229,3232,3250,3253,3261],[31,2847,2848],{},[15,2849,2850],{},"虽然对于没有能力手动修改/编写PKGBUILD的Arch用户其实是不应该使用AUR中的包的，这些软件的PKGBUILD可以由个人随意发布，并不能保证安全性，但是作为Archlinux的特色，但随着AUR Helper的趋于便利，还是吸引了不少小白使用AUR。本文将主要讲一讲 AUR Helper 帮助我们安装软件时到底做了些什么事情，并提供一些使用AUR Helper构建时常见错误的解决方案。",[520,2852,2854],{"id":2853},"partⅰ基本原理","PartⅠ基本原理",[946,2856,2858,2861],{"id":2857},"makepkg是如何工作的",[543,2859,2860],{},"makepkg","是如何工作的？",[15,2863,2864,2865,2868],{},"以钉钉举例，我们可以从AUR上使用 ",[543,2866,2867],{},"git clone https://aur.archlinux.org/dingtalk-bin.git"," 获取到由这个包的维护者为我们提前写好的构建脚本。他的目录大概是长成下面这个样子:",[579,2870,2873],{"className":2871,"code":2872,"language":918},[916],"dingtalk-bin\n├── com.alibabainc.dingtalk.desktop\n├── dingtalk.sh\n├── .git\n├── .gitignore\n├── PKGBUILD\n├── service-terms-zh\n└── .SRCINFO\n",[543,2874,2872],{"__ignoreMap":489},[73,2876,2877,2884,2890,2896],{},[76,2878,2879,2880,2883],{},"其中，",[543,2881,2882],{},".git","是git的工作目录，可以忽视。",[76,2885,2886,2889],{},[543,2887,2888],{},".gitignore","属于git的配置文件之一，我们也不用管。",[76,2891,2892,2895],{},[543,2893,2894],{},"PKGBUILD","是这个目录下最重要的东西，是一个用于提供参数的脚本。makepkg通过执行PKGBUILD脚本来获取到参数，自动进行下载和构建过程。",[76,2897,2898,181,2901,181,2904,2907],{},[543,2899,2900],{},"service-terms-zh",[543,2902,2903],{},"com.alibabainc.dingtalk.desktop",[543,2905,2906],{},"dingtalk.sh","是包里所需要用到的东西。",[28,2909],{},[15,2911,2912],{},"当我们cd到这个目录下执行makepkg时，",[15,2914,2915,2916,2918,2919,2921,2922,2925,2926,2929,2930,2933,2934,2937],{},"makepkg会调用",[543,2917,1332],{}," / ",[543,2920,2618],{},"下载PKGBUILD中",[543,2923,2924],{},"source=()","部分中以",[543,2927,2928],{},"http(s)","协议头或者",[543,2931,2932],{},"git+","开头的链接，这些东西将会被下载到这个目录的",[543,2935,2936],{},"src","文件夹下。",[15,2939,2940],{},"对于curl下载的东西，makepkg会使用校验码核对下载到的文件是否完整、是否是当初这个包的维护者下载到的这一个。",[15,2942,2943,2944,1326,2947,1326,2950,2953,2954,2957,2958,2937],{},"校验通过后，makepkg会依次执行",[543,2945,2946],{},"prepare(){}",[543,2948,2949],{},"build(){}",[543,2951,2952],{},"package(){}","函数中的命令陆续完成",[18,2955,2956],{},"准备、编译","过程，并将最终要打进包里的文件放置到",[543,2959,2960],{},"pkg",[15,2962,2963,2964,2966],{},"最后，makepkg将会将",[543,2965,2960],{},"文件夹的内容压缩成包。",[946,2968,2970],{"id":2969},"aur-helper-干了些什么","AUR Helper 干了些什么",[15,2972,2973,2974,2977],{},"我们还是以钉钉为例，看看我们执行",[543,2975,2976],{},"yay dingtalk-bin","时到底发生了什么。",[15,2979,2980],{},[48,2981],{"alt":2982,"src":2983},"当你使用yay安装软件到底发生了什么","https://static.031130.xyz/uploads/2024/08/12/62f3cdb03ec8c.webp",[520,2985,2987],{"id":2986},"partⅱ常见错误解决方案","PartⅡ常见错误解决方案",[15,2989,2990],{},"如果有其他情况觉得可以完善的，欢迎在评论区留言。",[946,2992,2994],{"id":2993},"_1-base-devel-没有安装","1. base-devel 没有安装",[15,2996,2997,2998,3001],{},"正如上面所说的，没有安装",[543,2999,3000],{},"base-devel","组，赶紧补上!",[15,3003,3004,3005,3007],{},"由于",[543,3006,3000],{},"并不是一个具体的包，而是由多个包构成的包组，其实并没有很好的方法来检测你是否已经安装。",[15,3009,3010],{},"所以如果你不确定，你也可以执行下面的命令来确保自己已经安装。",[579,3012,3014],{"className":581,"code":3013,"language":583,"meta":489,"style":489},"sudo pacman -S base-devel --noconfirm --needed\n",[543,3015,3016],{"__ignoreMap":489},[587,3017,3018,3020,3022,3024,3027,3030],{"class":589,"line":590},[587,3019,640],{"class":593},[587,3021,966],{"class":601},[587,3023,598],{"class":597},[587,3025,3026],{"class":601}," base-devel",[587,3028,3029],{"class":597}," --noconfirm",[587,3031,974],{"class":597},[28,3033],{},[15,3035,3036],{},"常见表现:",[579,3038,3041],{"className":3039,"code":3040,"language":918},[916],"ERROR: Cannot find the strip binary required for object file stripping.\n",[543,3042,3040],{"__ignoreMap":489},[579,3044,3047],{"className":3045,"code":3046,"language":918},[916],"PKGBUILD: line XXX XXX: command not found\n",[543,3048,3046],{"__ignoreMap":489},[946,3050,3052],{"id":3051},"_2-source源文件下载失败","2. source源文件下载失败",[2817,3054,3055,3162,3168],{},[76,3056,3057,3061,3062,3065,3069,3071,3072,2757,3075,3093,3095,3106,3114,3116,3117,3120,3121,3124,3125,3127,3130,3132,3133,3159,3161],{},[3058,3059,3060],"h4",{"id":3060},"网络问题","国内的网络问题不用多说了，大多数情况下都是Github连接不上。",[3063,3064],"br",{},[48,3066],{"alt":3067,"src":3068},"yay下载失败","https://static.031130.xyz/uploads/2024/08/12/62f3cc9c9dda8.webp",[3063,3070],{},"最简单的解决方案就是把source里下载失败的东西通过特殊手段（比如你浏览器设置下代理，或者找找fastgit这种反代）下载下来以后直接扔到PKGBUILD所在的路径，然后手动执行",[543,3073,3074],{},"makepkg -si",[31,3076,3077,3080],{},[15,3078,3079],{},"-s代表自动下载makedepend，-i表示构建成功以后自动安装",[15,3081,3082,3083,3086,3087,3092],{},"yay存放PKGBUILD的默认路径是在",[543,3084,3085],{},"$HOME/.cache/yay/$pkgname","下面，具体可以参考我的另一篇关于",[22,3088,3091],{"href":3089,"rel":3090},"https://blog.zhullyb.top/2021/04/04/yay-more/#builddir-lt-dir-gt",[26],"yay的用法详解","的博客。",[3063,3094],{},[80,3096,3097,3098,3105],{},"我在这里再讲一种使用 ",[22,3099,3102],{"href":3100,"rel":3101},"http://fastgit.org/",[26],[18,3103,3104],{},"fastgit"," 作为反代加速github下载的方法。",[981,3107,3108,3109,2757],{},"如果觉得fastgit帮助到了你，你可以考虑",[22,3110,3113],{"href":3111,"rel":3112},"http://fastgit.org/donate.html",[26],"给fastgit项目打钱",[3063,3115],{},"当你的yay出现这个询问菜单时，（也就是出现",[543,3118,3119],{},"Diffs to show","/",[543,3122,3123],{},"显示哪些差异？","字样时）",[3063,3126],{},[48,3128],{"alt":489,"src":3129},"https://static.031130.xyz/uploads/2024/08/12/62f3cca0c7aba.webp",[3063,3131],{},"我们再开一个终端，输入",[579,3134,3136],{"className":581,"code":3135,"language":583,"meta":489,"style":489},"sed -i \"s|github.com|hub.fastgit.org|g\" $HOME/.cache/yay/*/PKGBUILD\n",[543,3137,3138],{"__ignoreMap":489},[587,3139,3140,3143,3145,3148,3150,3153,3156],{"class":589,"line":590},[587,3141,3142],{"class":593},"sed",[587,3144,2321],{"class":597},[587,3146,3147],{"class":601}," \"s|github.com|hub.fastgit.org|g\"",[587,3149,896],{"class":895},[587,3151,3152],{"class":601},"/.cache/yay/",[587,3154,3155],{"class":597},"*",[587,3157,3158],{"class":601},"/PKGBUILD\n",[3063,3160],{},"接着就下一步安装即可。",[76,3163,3164,3167],{},[3058,3165,3166],{"id":3166},"链接失效","这种情况多见于维护者维护不到位，上游放出了新版本包并删除老版本包以后维护者没有及时跟进的。你可以去逛一逛AUR的评论区查看解决方案，或者去查找上游的最新版本是多少，尝试更改PKGBUILD中的pkgver参数和checksum以后尝试makepkg。",[76,3169,3170,3173,3174],{},[3058,3171,3172],{"id":3172},"需要手动下载","一般情况下是上游没有提供直链，makepkg无法自行下载，需要人工介入。解决方法同上面的",[22,3175,3060],{"href":3176},"#%E7%BD%91%E7%BB%9C%E9%97%AE%E9%A2%98",[946,3178,3180],{"id":3179},"_3-checksum-错误","3. checksum 错误",[15,3182,3183],{},"上文已经提到过，checksum用于判断你所下载到的软件和维护者当初下载到的是否一致。但是有些情况下，确实是维护者忘了更新checksum值了，因此我们需要做一个判断。",[15,3185,3186,3187,3190],{},"打开",[543,3188,3189],{},".SCRINFO","，找到checksum报错的那个文件的链接。",[15,3192,3193,3194,3197],{},"使用wget/curl等工具将他下载下来，可以通过",[543,3195,3196],{},"md5sum+文件名","的方式获取他们的md5值。连续下载两次，核对两次的检验值是否一致。",[15,3199,3200,3201,3204,3205,3208,3209,2757],{},"如果结果一致，那么说明并不是网络波动导致的检验值不符，而是维护者没有及时跟进导致的，你可以使用",[543,3202,3203],{},"yay -S $pkgname --skipchecksums","的方式跳过验证校验值的过程，或者你可以修改PKGBUILD中的校验值为",[543,3206,3207],{},"\"SKIP\"","来跳过某一文件的校验后手动",[543,3210,2860],{},[946,3212,3214],{"id":3213},"_4-tuna反代受限","4. tuna反代受限",[15,3216,3217],{},"tuna的服务器只有一个ip，但当使用他提供的AUR的反代服务时，全国的使用者都会被AUR认为是tuna这一个ip，过大的请求数量可能导致tuna的服务器超出AUR每天给每个ip限制的请求次数。",[28,3219],{},[15,3221,3222],{},"具体表现:",[579,3224,3227],{"className":3225,"code":3226,"language":918},[916],"Rate limit reached\n",[543,3228,3226],{"__ignoreMap":489},[15,3230,3231],{},"解决方案，改回AUR的服务器，使用自己的ip进行请求",[579,3233,3235],{"className":581,"code":3234,"language":583,"meta":489,"style":489},"yay --aururl \"https://aur.archlinux.org\" --save\n",[543,3236,3237],{"__ignoreMap":489},[587,3238,3239,3241,3244,3247],{"class":589,"line":590},[587,3240,594],{"class":593},[587,3242,3243],{"class":597}," --aururl",[587,3245,3246],{"class":601}," \"https://aur.archlinux.org\"",[587,3248,3249],{"class":597}," --save\n",[520,3251,3252],{"id":3252},"写在最后",[15,3254,3255,3256],{},"关于AUR使用的更多细节可以阅读 ",[22,3257,3260],{"href":3258,"rel":3259},"https://blog.zhullyb.top/2021/04/04/yay-more/",[26],"《yay进阶》",[834,3262,3263],{},"html pre.shiki code .sScJk, html code.shiki .sScJk{--shiki-default:#6F42C1;--shiki-dark:#B392F0}html pre.shiki code .sZZnC, html code.shiki .sZZnC{--shiki-default:#032F62;--shiki-dark:#9ECBFF}html pre.shiki code .sj4cs, html code.shiki .sj4cs{--shiki-default:#005CC5;--shiki-dark:#79B8FF}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html pre.shiki code .sVt8B, html code.shiki .sVt8B{--shiki-default:#24292E;--shiki-dark:#E1E4E8}",{"title":489,"searchDepth":3,"depth":3,"links":3265},[3266,3271,3277],{"id":2853,"depth":3,"text":2854,"children":3267},[3268,3270],{"id":2857,"depth":1041,"text":3269},"makepkg是如何工作的？",{"id":2969,"depth":1041,"text":2970},{"id":2986,"depth":3,"text":2987,"children":3272},[3273,3274,3275,3276],{"id":2993,"depth":1041,"text":2994},{"id":3051,"depth":1041,"text":3052},{"id":3179,"depth":1041,"text":3180},{"id":3213,"depth":1041,"text":3214},{"id":3252,"depth":3,"text":3252},{"title":2368,"date":3279,"path":3280,"tags":3281,"body":3282},"2021-09-05","/2021/09/05/wrong-fonts-color-fix-under-kde-with-a-dark-theme",[2573,496,2574],{"type":12,"value":3283,"toc":3392},[3284,3293,3306,3309,3312,3320,3325,3332,3335,3359,3362,3377,3384,3389],[15,3285,3286],{},[80,3287,3288,3289,3292],{},"9月6日更新：AUR的",[543,3290,3291],{},"wemeet-bin","维护者sukanka已经将咱的运行指令直接打进了包内，故本文已经基本失去原本的应用意义，但仍可以作为一个案例来解决类似问题。",[31,3294,3295,3298,3301],{},[15,3296,3297],{},"在使用腾讯最近推出的Linux原生腾讯会议的时候，咱遇到了个十分影响体验的问题。",[15,3299,3300],{},"我在使用KDE的暗色主题，腾讯回忆自作主张将字体颜色调成了白色。然而，字体背景是白色的没，因此导致对比度下降，字体难以辨认。效果大概是这个鬼样子:",[15,3302,3303],{},[48,3304],{"alt":489,"src":3305},"https://static.031130.xyz/uploads/2024/08/12/62f3cb059b229.webp",[15,3307,3308],{},"然而我一时半会儿却找不到合适的变量在运行腾讯会议之前unset，无法指定它使用一个正确的字体颜色。",[15,3310,3311],{},"此时，我想到了fakehome的解决方案——bwrap。",[15,3313,3314,3315,3319],{},"关于bwrap，依云在ta的",[22,3316,1268],{"href":3317,"rel":3318},"https://blog.lilydjwg.me/2021/8/12/using-bwrap.215869.html",[26],"里讲过运行原理，我在这里直接摘一小段过来",[31,3321,3322],{},[15,3323,3324],{},"bwrap 的原理是，把 / 放到一个 tmpfs 上，然后需要允许访问的目录通过 bind mount 弄进来。所以没弄进来的部分就是不存在，写数据的话就存在内存里，用完就扔掉了。",[15,3326,3327,3328,3331],{},"而我们要做的，就是开一个tmpfs作为",[543,3329,3330],{},"$HOME/.config","，让腾讯会议读取不到KDE的主题配置文件。",[15,3333,3334],{},"使用如下命令",[579,3336,3338],{"className":581,"code":3337,"language":583,"meta":489,"style":489},"bwrap --dev-bind / / --tmpfs $HOME/.config wemeet\n",[543,3339,3340],{"__ignoreMap":489},[587,3341,3342,3344,3346,3348,3350,3352,3354,3356],{"class":589,"line":590},[587,3343,2379],{"class":593},[587,3345,2382],{"class":597},[587,3347,2385],{"class":601},[587,3349,2385],{"class":601},[587,3351,2390],{"class":597},[587,3353,896],{"class":895},[587,3355,2395],{"class":601},[587,3357,3358],{"class":601}," wemeet\n",[15,3360,3361],{},"软件启动确认没有问题后，我们可以更改腾讯会议desktop中的启动命令",[579,3363,3365],{"className":581,"code":3364,"language":583,"meta":489,"style":489},"sudo $EDITOR /usr/share/applications/wemeetapp.desktop\n",[543,3366,3367],{"__ignoreMap":489},[587,3368,3369,3371,3374],{"class":589,"line":590},[587,3370,640],{"class":593},[587,3372,3373],{"class":895}," $EDITOR ",[587,3375,3376],{"class":601},"/usr/share/applications/wemeetapp.desktop\n",[15,3378,3379,3380,3383],{},"将",[543,3381,3382],{},"Exec=","后面的命令改成我们刚刚启动所使用的命令即可。",[31,3385,3386],{},[15,3387,3388],{},"关键词: bwrap, linux, 暗色模式, 深色模式, 夜间模式, 白色字体, 亮色字体",[834,3390,3391],{},"html pre.shiki code .sScJk, html code.shiki .sScJk{--shiki-default:#6F42C1;--shiki-dark:#B392F0}html pre.shiki code .sj4cs, html code.shiki .sj4cs{--shiki-default:#005CC5;--shiki-dark:#79B8FF}html pre.shiki code .sZZnC, html code.shiki .sZZnC{--shiki-default:#032F62;--shiki-dark:#9ECBFF}html pre.shiki code .sVt8B, html code.shiki .sVt8B{--shiki-default:#24292E;--shiki-dark:#E1E4E8}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}",{"title":489,"searchDepth":3,"depth":3,"links":3393},[],{"title":3395,"date":3396,"path":3397,"tags":3398,"body":3401},"来，从AUR给Fedora偷个包","2021-07-23 01:50:09","/2021/07/23/build-a-rpm-package-from-aur-with-archlinux",[2573,496,3399,3400],"Fedora","RPM Package",{"type":12,"value":3402,"toc":4078},[3403,3411,3416,3419,3426,3429,3437,3440,3447,3463,3467,3473,3479,3483,3486,3499,3510,3517,3523,3540,3563,3569,3572,3578,3594,3597,3614,3618,3831,3834,3839,3845,3859,3862,3868,3873,3879,3882,3888,3894,3897,3914,3919,3921,3928,3961,4010,4015,4026,4041,4053,4065,4076],[31,3404,3405,3408],{},[15,3406,3407],{},"前一阵子，某Q群里的某初中生居然跳上了Fedora这辆灵车，还一直缠着我要我给他整个打rpm包的教程，说什么要复兴FedoraCN之类的我听不懂的话。碰巧听说Fedora似乎还没有wechat-uos，于是我就寻思着给Fedora打一个，顺便熟悉一下dnf的操作。",[15,3409,3410],{},"事实上，Fedora和Archlinux的目录结构很相似，理论上来讲Archlinux的大部分包都可以直接解压后塞到Fedora里直接用，对于咱这种日常偷Deb包的Arch用户来说基本没什么难度，唯一的难点在于处理依赖关系。",[15,3412,3413],{},[80,3414,3415],{},"Tips1: 使用电脑端的访客可以在页面左下角打开侧栏以获取目录。",[946,3417,3418],{"id":3418},"下载链接",[15,3420,3421,3422],{},"如果你是为了wechat-uos这个包而非教程而来的，下载链接在这里。",[22,3423,3424],{"href":3424,"rel":3425},"https://zhullyb.lanzoui.com/ikN55rqr7ah",[26],[946,3427,3428],{"id":3428},"偷包环境",[73,3430,3431,3434],{},[76,3432,3433],{},"Archlinux实体机(打包)",[76,3435,3436],{},"Fedora虚拟机(依赖查询、测试)",[946,3438,3439],{"id":3439},"准备好wechat-uos",[15,3441,3442,3443,3446],{},"首先，咱们先在Archlinux上把我们的",[543,3444,3445],{},"wechat-uos","先打包好，这个老生常谈的问题我不多赘述了。",[579,3448,3450],{"className":581,"code":3449,"language":583,"meta":489,"style":489},"yay -S wechat-uos --noconfirm\n",[543,3451,3452],{"__ignoreMap":489},[587,3453,3454,3456,3458,3461],{"class":589,"line":590},[587,3455,594],{"class":593},[587,3457,598],{"class":597},[587,3459,3460],{"class":601}," wechat-uos",[587,3462,605],{"class":597},[946,3464,3466],{"id":3465},"查找wechat-uos在archlinux上所需的依赖","查找wechat-uos在Archlinux上所需的依赖",[15,3468,3469,3470,3472],{},"再去查看",[543,3471,3445],{},"所需要的依赖",[579,3474,3477],{"className":3475,"code":3476,"language":918},[916],"[zhullyb@Archlinux ~]$ yay -Si wechat-uos\n:: Querying AUR...\nRepository      : aur\nName            : wechat-uos\nKeywords        : electron  patched  uos  wechat  weixin\nVersion         : 2:2.0.0-1145141919\nDescription     : UOS专业版微信 (迫真魔改版)\nURL             : https://www.chinauos.com/resource/download-professional\nAUR URL         : https://aur.archlinux.org/packages/wechat-uos\nGroups          : None\nLicenses        : MIT\nProvides        : None\nDepends On      : gtk2  gtk3  libxss  gconf  nss  lsb-release  bubblewrap\nMake Deps       : imagemagick\nCheck Deps      : None\nOptional Deps   : None\nConflicts With  : None\nMaintainer      : DuckSoft\nVotes           : 16\nPopularity      : 0.603501\nFirst Submitted : Wed 30 Dec 2020 12:21:51 PM CST\nLast Modified   : Sat 20 Feb 2021 06:53:24 AM CST\nOut-of-date     : No\n",[543,3478,3476],{"__ignoreMap":489},[946,3480,3482],{"id":3481},"查找fedora上的对应依赖包名","查找Fedora上的对应依赖包名",[15,3484,3485],{},"然后我们需要去Fedora上找一找这些依赖在Fedora上的包名都叫什么。",[15,3487,3488,3489,3492,3493,3495,3496],{},"比如这个",[543,3490,3491],{},"bubblewrap","，我们需要的是他提供的",[543,3494,2379],{},"，所以我们直接在Fedora上",[543,3497,3498],{},"sudo dnf provides bwrap",[15,3500,3501,3502,3505,3506,3509],{},"再比如",[543,3503,3504],{},"gconf","并没有在",[543,3507,3508],{},"/usr/bin","路径下直接留下什么非常具有代表性的可执行文件，所以在Fedora里面寻找等效包就稍微复杂一些，但也并非不能找。",[15,3511,3512,3513,3516],{},"先在Archlinux下使用",[543,3514,3515],{},"pacman -Ql gconf","，输出结果有点长，我就截一小段上来。",[579,3518,3521],{"className":3519,"code":3520,"language":918},[916],"[zhullyb@Archlinux ~]$ pacman -Qlq gconf\n/etc/\n/etc/gconf/\n/etc/gconf/2/\n/etc/gconf/2/evoldap.conf\n/etc/gconf/2/path\n/etc/gconf/gconf.xml.defaults/\n/etc/gconf/gconf.xml.mandatory/\n/etc/gconf/gconf.xml.system/\n/etc/xdg/\n/etc/xdg/autostart/\n/etc/xdg/autostart/gsettings-data-convert.desktop\n/usr/\n/usr/bin/\n/usr/bin/gconf-merge-schema\n/usr/bin/gconf-merge-tree\n/usr/bin/gconfpkg\n/usr/bin/gconftool-2\n......\n",[543,3522,3520],{"__ignoreMap":489},[15,3524,3525,3526,3528,3529,3532,3533,3536,3537,2757],{},"可以发现，",[543,3527,3504],{},"还是有不少文件是非常具有代表性的，比如这里的",[543,3530,3531],{},"/usr/bin/gconf-merge-tree","，我们在Fedora上使用",[543,3534,3535],{},"sudo dnf provides gconf-merge-tree","很容易就能找到对应的包是",[543,3538,3539],{},"GConf2",[15,3541,3542,3545,3546,3549,3550,3553,3554,3556,3557,3559,3560,3562],{},[543,3543,3544],{},"lsb-release","这个依赖中，我们只是需要",[543,3547,3548],{},"/etc/lsb-release","这个文件存在让我们的bwrap可以顺利地伪装成uos的样子。Fedora中虽然有",[543,3551,3552],{},"redhat-lsb-core","这个包算是",[543,3555,3544],{},"的等效包，但是并不提供这个文件，因此我们只需要在待会儿打包的时候带一个",[543,3558,3548],{},"的空文件即可，不需要将",[543,3561,3552],{},"写进依赖。",[15,3564,3565,3566,2757],{},"最终我们可以确定下来需要的依赖为",[543,3567,3568],{},"gtk2,gtk3,libXScrnSaver,nss,bubblewrap,GConf2",[946,3570,3571],{"id":3571},"准备打包",[3058,3573,574,3575],{"id":3574},"安装rpm-tools",[543,3576,3577],{},"rpm-tools",[579,3579,3581],{"className":581,"code":3580,"language":583,"meta":489,"style":489},"sudo pacman -S rpm-tools\n",[543,3582,3583],{"__ignoreMap":489},[587,3584,3585,3587,3589,3591],{"class":589,"line":590},[587,3586,640],{"class":593},[587,3588,966],{"class":601},[587,3590,598],{"class":597},[587,3592,3593],{"class":601}," rpm-tools\n",[3058,3595,3596],{"id":3596},"生成工作路径",[579,3598,3600],{"className":581,"code":3599,"language":583,"meta":489,"style":489},"mkdir -pv $HOME/rpmbuild/{BUILD,BUILDROOT,RPMS,SOURCES,SPECS,SRPMS}\n",[543,3601,3602],{"__ignoreMap":489},[587,3603,3604,3606,3609,3611],{"class":589,"line":590},[587,3605,889],{"class":593},[587,3607,3608],{"class":597}," -pv",[587,3610,896],{"class":895},[587,3612,3613],{"class":601},"/rpmbuild/{BUILD,BUILDROOT,RPMS,SOURCES,SPECS,SRPMS}\n",[3058,3615,3617],{"id":3616},"编写-spec-文件","编写 spec 文件",[579,3619,3621],{"className":581,"code":3620,"language":583,"meta":489,"style":489},"Name: wechat-uos\nVersion: 2.0.0\nRelease: 1\nSummary: A wechat client based on electron.\nLicense: None\nURL: https://www.chinauos.com/resource/download-professional\nPackager: zhullyb\n\nRequires: gtk2,gtk3,libXScrnSaver,nss,bubblewrap,GConf2\n\nAutoReqProv: no\n\n%description\n\n%prep\n\n%pre\n\n%post\n\n%preun\n\n%postun\n\n%files\n/etc/lsb-release\n/opt/wechat-uos/\n/usr/bin/wechat-uos\n/usr/lib/license/libuosdevicea.so\n/usr/share/applications/wechat-uos.desktop\n/usr/share/icons/hicolor/128x128/apps/wechat.png\n/usr/share/icons/hicolor/16x16/apps/wechat.png\n/usr/share/icons/hicolor/256x256/apps/wechat.png\n/usr/share/icons/hicolor/48x48/apps/wechat.png\n/usr/share/icons/hicolor/64x64/apps/wechat.png\n",[543,3622,3623,3631,3639,3647,3670,3678,3686,3694,3698,3706,3710,3718,3722,3727,3731,3736,3740,3745,3749,3754,3758,3763,3767,3772,3776,3781,3786,3791,3796,3801,3806,3811,3816,3821,3826],{"__ignoreMap":489},[587,3624,3625,3628],{"class":589,"line":590},[587,3626,3627],{"class":593},"Name:",[587,3629,3630],{"class":601}," wechat-uos\n",[587,3632,3633,3636],{"class":589,"line":3},[587,3634,3635],{"class":593},"Version:",[587,3637,3638],{"class":597}," 2.0.0\n",[587,3640,3641,3644],{"class":589,"line":1041},[587,3642,3643],{"class":593},"Release:",[587,3645,3646],{"class":597}," 1\n",[587,3648,3649,3652,3655,3658,3661,3664,3667],{"class":589,"line":1048},[587,3650,3651],{"class":593},"Summary:",[587,3653,3654],{"class":601}," A",[587,3656,3657],{"class":601}," wechat",[587,3659,3660],{"class":601}," client",[587,3662,3663],{"class":601}," based",[587,3665,3666],{"class":601}," on",[587,3668,3669],{"class":601}," electron.\n",[587,3671,3672,3675],{"class":589,"line":1055},[587,3673,3674],{"class":593},"License:",[587,3676,3677],{"class":601}," None\n",[587,3679,3680,3683],{"class":589,"line":1085},[587,3681,3682],{"class":593},"URL:",[587,3684,3685],{"class":601}," https://www.chinauos.com/resource/download-professional\n",[587,3687,3688,3691],{"class":589,"line":1091},[587,3689,3690],{"class":593},"Packager:",[587,3692,3693],{"class":601}," zhullyb\n",[587,3695,3696],{"class":589,"line":1114},[587,3697,1052],{"emptyLinePlaceholder":1051},[587,3699,3700,3703],{"class":589,"line":1126},[587,3701,3702],{"class":593},"Requires:",[587,3704,3705],{"class":601}," gtk2,gtk3,libXScrnSaver,nss,bubblewrap,GConf2\n",[587,3707,3708],{"class":589,"line":1132},[587,3709,1052],{"emptyLinePlaceholder":1051},[587,3711,3712,3715],{"class":589,"line":1146},[587,3713,3714],{"class":593},"AutoReqProv:",[587,3716,3717],{"class":601}," no\n",[587,3719,3720],{"class":589,"line":1408},[587,3721,1052],{"emptyLinePlaceholder":1051},[587,3723,3724],{"class":589,"line":1414},[587,3725,3726],{"class":593},"%description\n",[587,3728,3729],{"class":589,"line":1420},[587,3730,1052],{"emptyLinePlaceholder":1051},[587,3732,3733],{"class":589,"line":1426},[587,3734,3735],{"class":593},"%prep\n",[587,3737,3738],{"class":589,"line":1432},[587,3739,1052],{"emptyLinePlaceholder":1051},[587,3741,3742],{"class":589,"line":1438},[587,3743,3744],{"class":593},"%pre\n",[587,3746,3747],{"class":589,"line":1444},[587,3748,1052],{"emptyLinePlaceholder":1051},[587,3750,3751],{"class":589,"line":1450},[587,3752,3753],{"class":593},"%post\n",[587,3755,3756],{"class":589,"line":1456},[587,3757,1052],{"emptyLinePlaceholder":1051},[587,3759,3760],{"class":589,"line":1462},[587,3761,3762],{"class":593},"%preun\n",[587,3764,3765],{"class":589,"line":1468},[587,3766,1052],{"emptyLinePlaceholder":1051},[587,3768,3769],{"class":589,"line":1474},[587,3770,3771],{"class":593},"%postun\n",[587,3773,3774],{"class":589,"line":1480},[587,3775,1052],{"emptyLinePlaceholder":1051},[587,3777,3778],{"class":589,"line":1486},[587,3779,3780],{"class":593},"%files\n",[587,3782,3783],{"class":589,"line":1492},[587,3784,3785],{"class":593},"/etc/lsb-release\n",[587,3787,3788],{"class":589,"line":1498},[587,3789,3790],{"class":593},"/opt/wechat-uos/\n",[587,3792,3793],{"class":589,"line":1504},[587,3794,3795],{"class":593},"/usr/bin/wechat-uos\n",[587,3797,3798],{"class":589,"line":1510},[587,3799,3800],{"class":593},"/usr/lib/license/libuosdevicea.so\n",[587,3802,3803],{"class":589,"line":1516},[587,3804,3805],{"class":593},"/usr/share/applications/wechat-uos.desktop\n",[587,3807,3808],{"class":589,"line":1522},[587,3809,3810],{"class":593},"/usr/share/icons/hicolor/128x128/apps/wechat.png\n",[587,3812,3813],{"class":589,"line":1528},[587,3814,3815],{"class":593},"/usr/share/icons/hicolor/16x16/apps/wechat.png\n",[587,3817,3818],{"class":589,"line":1534},[587,3819,3820],{"class":593},"/usr/share/icons/hicolor/256x256/apps/wechat.png\n",[587,3822,3823],{"class":589,"line":1540},[587,3824,3825],{"class":593},"/usr/share/icons/hicolor/48x48/apps/wechat.png\n",[587,3827,3828],{"class":589,"line":1546},[587,3829,3830],{"class":593},"/usr/share/icons/hicolor/64x64/apps/wechat.png\n",[3058,3832,3833],{"id":3833},"处理source",[31,3835,3836],{},[15,3837,3838],{},"一般来说，我们需要配置各种奇奇怪怪的编译命令，但是我这里直接选择了打包二进制文件，一来是减少了对于spec的学习成本，二来是因为wechat-uos本来就不开源，也没什么好编译的。",[15,3840,3841,3842,3844],{},"创建我们",[543,3843,3445],{},"的二进制文件所需要放入的文件夹。",[579,3846,3848],{"className":581,"code":3847,"language":583,"meta":489,"style":489},"mkdir $HOME/rpmbuild/BUILDROOT/wechat-uos-2.0.0-1.x86_64\n",[543,3849,3850],{"__ignoreMap":489},[587,3851,3852,3854,3856],{"class":589,"line":590},[587,3853,889],{"class":593},[587,3855,896],{"class":895},[587,3857,3858],{"class":601},"/rpmbuild/BUILDROOT/wechat-uos-2.0.0-1.x86_64\n",[15,3860,3861],{},"将我们的wechat-uos直接放入对应的文件夹中",[15,3863,3864],{},[48,3865],{"alt":3866,"src":3867},"解压原先打包好的wechat-uos","https://static.031130.xyz/uploads/2024/08/12/62f3cadde8d65.webp",[15,3869,3870,3871],{},"补上我们的",[543,3872,3548],{},[579,3874,3877],{"className":3875,"code":3876,"language":918},[916],"mkdir $HOME/rpmbuild/BUILDROOT/wechat-uos-2.0.0-1.x86_64/etc/\ntouch $HOME/rpmbuild/BUILDROOT/wechat-uos-2.0.0-1.x86_64/etc/lsb-release\n",[543,3878,3876],{"__ignoreMap":489},[946,3880,3881],{"id":3881},"正式打包",[579,3883,3886],{"className":3884,"code":3885,"language":918},[916],"rpmbuild -bb --target=x86_64 SPECS/wechat-uos.spec --nodeps\n",[543,3887,3885],{"__ignoreMap":489},[15,3889,3890],{},[48,3891],{"alt":3892,"src":3893},"打包成功","https://static.031130.xyz/uploads/2024/08/12/62f3cae15fdcf.webp",[946,3895,3896],{"id":3896},"安装测试",[579,3898,3900],{"className":581,"code":3899,"language":583,"meta":489,"style":489},"sudo dnf install ./wechat-uos-2.0.0-1.x86_64.rpm\n",[543,3901,3902],{"__ignoreMap":489},[587,3903,3904,3906,3909,3911],{"class":589,"line":590},[587,3905,640],{"class":593},[587,3907,3908],{"class":601}," dnf",[587,3910,770],{"class":601},[587,3912,3913],{"class":601}," ./wechat-uos-2.0.0-1.x86_64.rpm\n",[15,3915,3916],{},[48,3917],{"alt":2403,"src":3918},"https://static.031130.xyz/uploads/2024/08/12/62f3cae5aa4b0.webp",[946,3920,3252],{"id":3252},[15,3922,3923,3924,3927],{},"rpm的打包工具是我近期",[80,3925,3926],{},"最","想吐槽的东西了，主要槽点有两个。",[15,3929,3930,3931,3934,3935,3120,3938,3120,3941,3944,3945,3952,3953,3956,3957,3960],{},"其一是：rpm在打包时的默认状态下，会使用 ",[543,3932,3933],{},"file"," 命令判断文件，如果是二进制的，用ldd判断依赖；如果是脚本，过滤文件中对应的 ",[543,3936,3937],{},"use",[543,3939,3940],{},"requires",[543,3942,3943],{},"import"," 语句，以此来找出内部依赖。**这固然是个非常贴心的小善举，**能够确保软件正常运行，",[80,3946,3947,3948,3951],{},"但完全有可能造成比较奇怪的问题。",[80,3949,3950],{},"比如我本次打包中rpm","自作聪明","地给我添加了一个",[543,3954,3955],{},"libffmpeg.so","的依赖，这东西整个Fedora自带的四个源里都不存在，在安装测试的时候出现了找不到依赖的情况。想我这种添加了找不到依赖的情况还算是运气好的，之前听说有人在使用opensuse的某个私人源的时候发现安装网易云音乐居然吧wps-office都给依赖上了，我想就是rpm自动检测到了网易云需要某个库，而wps恰好自带了这个库而导致的依赖误报。在Archlinux中，我们有一个叫",[543,3958,3959],{},"namcap","的小工具能够使用类似的方法检测软件运行时可能所需要的内部依赖，但他并不会默认启用，更不会自说自话的就直接把他添加为依赖，连一声也不吭。",[15,3962,3963,3964,3967,3968,3970,3971,3974,3975,1326,3977,3980,3981,3983,3984,3987,3988,3990,3991,546,3993,3996,3997,3999,4000,4002,4003,4005,4006,4009],{},"其二是：rpm检测新增包内文件是否与系统已安装的软件包内的文件因为使用相同路径而冲突时，不仅会核对是否有冲突的同路径同名文件，他",[80,3965,3966],{},"还会核对文件夹","的文件占用情况。这说起来可能会有些抽象，我举个例子。在Fedora中，",[543,3969,3508],{},"路径是被",[543,3972,3973],{},"filesystem","这个包所占有的，所以其他包在打包时是不能直接使用",[543,3976,3508],{},[543,3978,3979],{},"/usr","、甚至",[543,3982,3120],{},"来限定包内文件的范围的（也就是上面spec文件中的%files区域）。而我在第一次打包时，想要直接打包",[543,3985,3986],{},"BUILDROOT","下的所有文件，于是%files就直接填写了",[543,3989,3120],{},"作为限定，安装时提示",[543,3992,3508],{},[543,3994,3995],{},"/usr/lib","被",[543,3998,3973],{},"这个包所占用，文件冲突。为此我还特意去仔细对比了Fedora自带的",[543,4001,3973],{},"和我这个",[543,4004,3445],{},"是否有冲突的文件，实则证明并没有，只是单纯这个",[80,4007,4008],{},"检测机制过于死板","罢了。而在Archlinux中，pacman安装时只会检测包内的文件是否与系统内的现有文件路径产生冲突，而不会非常无意义的去限定哪个文件夹是属于哪个包的。",[946,4011,4013],{"id":4012},"附上本文的参考资料",[80,4014,4012],{},[31,4016,4017],{},[15,4018,4019,4020,4025],{},"为了避免源网页失效，我特意去",[22,4021,4024],{"href":4022,"rel":4023},"http://web.archive.org",[26],"互联网档案馆","做了备份",[15,4027,4028,4029,4034,4035,4040],{},"「",[22,4030,4033],{"href":4031,"rel":4032},"https://blog.csdn.net/get_set/article/details/53453320",[26],"RPM打包原理、示例、详解及备查","」\t\t\t\t\t\t\t 「",[22,4036,4039],{"href":4037,"rel":4038},"http://web.archive.org/web/20210722180835/https://blog.konghy.cn/2015/11/13/rpmbuild/",[26],"Archive","」",[15,4042,4028,4043,4048,4049,4040],{},[22,4044,4047],{"href":4045,"rel":4046},"https://blog.konghy.cn/2015/11/13/rpmbuild/",[26],"在 Ubuntu 下直接将二进制文件制作成 rpm 包","」\t\t「",[22,4050,4039],{"href":4051,"rel":4052},"http://web.archive.org/web/20210722180859/http://blog.sina.cn/dpool/blog/s/blog_6a5aee670101r1si.html",[26],[15,4054,4028,4055,4060,4061,4040],{},[22,4056,4059],{"href":4057,"rel":4058},"http://blog.sina.cn/dpool/blog/s/blog_6a5aee670101r1si.html",[26],"解除RPM包的依赖的方法","」\t\t\t\t\t\t\t\t\t\t\t「",[22,4062,4039],{"href":4063,"rel":4064},"http://web.archive.org/web/20210722180936/https://blog.csdn.net/get_set/article/details/53453320",[26],[15,4066,4067],{},[18,4068,4069,4070,4075],{},"本文同时发布于「",[22,4071,4074],{"href":4072,"rel":4073},"https://zhuanlan.zhihu.com/p/392650904",[26],"知乎专栏","」，如果你恰好有知乎帐号的话或许可以考虑帮我点个赞？",[834,4077,2558],{},{"title":489,"searchDepth":3,"depth":3,"links":4079},[4080,4081,4082,4083,4084,4085,4086,4087,4088,4089],{"id":3418,"depth":1041,"text":3418},{"id":3428,"depth":1041,"text":3428},{"id":3439,"depth":1041,"text":3439},{"id":3465,"depth":1041,"text":3466},{"id":3481,"depth":1041,"text":3482},{"id":3571,"depth":1041,"text":3571},{"id":3881,"depth":1041,"text":3881},{"id":3896,"depth":1041,"text":3896},{"id":3252,"depth":1041,"text":3252},{"id":4012,"depth":1041,"text":4012},127,1761696666522]
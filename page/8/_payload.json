[{"data":1,"prerenderedAt":2428},["ShallowReactive",2],{"randomIndex/page/8/":3,"language-switch-/page/8/-en":4,"index-page-8-zh":5,"posts-total-zh":2427},0,"/en/",[6,275,749,1087,1162,1329,1623,1752,1835,2275],{"title":7,"date":8,"path":9,"tags":10,"body":12},"隐式转发——骚套路建站方案","2023-03-26 00:10:02","/2023/03/26/implicit-forwarding-is-a-new-site-deploying-method",[11],"Network",{"type":13,"value":14,"toc":272},"minimark",[15,19,26,29,39,61,64,161,164,170,177,182,185,192,197,201,204,207,223,226,244,247,268],[16,17,18],"p",{},"其实很久以前就接触到了国内 DNS 解析服务商提供的这个「隐式 URL」 这种 “DNS 记录类型”了，但我域名没有备案，一直没有机会去体验。",[16,20,21],{},[22,23],"img",{"alt":24,"src":25},"DNSPOD 的解析面板中提供的记录类型","https://static.031130.xyz/uploads/2024/08/12/641f1e2cd8809.webp",[16,27,28],{},"今天社团内某个同学在折腾自己博客的时候又用到了「隐式 URL」，于是就借此机会了解了一下相关内容。",[16,30,31,38],{},[32,33,37],"a",{"href":34,"rel":35},"https://docs.dnspod.cn/dns/help-redirect-url/",[36],"nofollow","DNSPOD 文档的描述","如下",[40,41,42],"blockquote",{},[16,43,44,48,49,53,54,57,58,60],{},[45,46,47],"strong",{},"隐性转发","：用的是 iframe 框架技术、非重定向技术，效果为浏览器地址栏输入 ",[50,51,52],"code",{},"http://www.dnspod.cn"," 回车，打开网站内容是目标地址 ",[50,55,56],{},"http://cloud.tencent.com/"," 的网站内容，但地址栏显示当前地址 ",[50,59,52],{}," 。",[16,62,63],{},"也就是说，所谓「隐式 URL」，只不过是域名解析的服务商用他们的服务器去响应了访客的请求，并回应了一段使用了 iframe 的 html 。这段代码打开了一个大小为 100% 的窗口去请求了被“隐式代理”的站点。我这位同学域名是备案在阿里云下的，阿里云所使用的 html 代码如下:",[65,66,71],"pre",{"className":67,"code":68,"language":69,"meta":70,"style":70},"language-html shiki shiki-themes one-light one-dark-pro","\u003C!doctype html>\u003Chtml>\u003Cframeset rows=\"100%\">\u003Cframe src=\"http://example.com\">\u003Cnoframes>\u003Ca href=\"http://example.com\">Click here\u003C/a>\u003C/noframes>\u003C/frameset>\u003C/html>\n","html","",[50,72,73],{"__ignoreMap":70},[74,75,78,82,86,90,93,95,97,101,104,107,111,113,116,119,121,124,126,129,131,133,136,138,140,143,145,148,150,152,154,156,158],"span",{"class":76,"line":77},"line",1,[74,79,81],{"class":80},"s5ixo","\u003C!",[74,83,85],{"class":84},"sJa8x","doctype",[74,87,89],{"class":88},"sAGMh"," html",[74,91,92],{"class":80},">\u003C",[74,94,69],{"class":84},[74,96,92],{"class":80},[74,98,100],{"class":99},"s-dj3","frameset",[74,102,103],{"class":88}," rows",[74,105,106],{"class":80},"=",[74,108,110],{"class":109},"sDhpE","\"100%\"",[74,112,92],{"class":80},[74,114,115],{"class":99},"frame",[74,117,118],{"class":88}," src",[74,120,106],{"class":80},[74,122,123],{"class":109},"\"http://example.com\"",[74,125,92],{"class":80},[74,127,128],{"class":99},"noframes",[74,130,92],{"class":80},[74,132,32],{"class":84},[74,134,135],{"class":88}," href",[74,137,106],{"class":80},[74,139,123],{"class":109},[74,141,142],{"class":80},">Click here\u003C/",[74,144,32],{"class":84},[74,146,147],{"class":80},">\u003C/",[74,149,128],{"class":99},[74,151,147],{"class":80},[74,153,100],{"class":99},[74,155,147],{"class":80},[74,157,69],{"class":84},[74,159,160],{"class":80},">\n",[16,162,163],{},"在下图中，我通过更改 hosts 文件实现将百度的域名在本地被解析到 localhost，并使用 iframe 标签将 b 站嵌入到页面中。当然，这并不能说明什么事情，不过是我个人的恶趣味罢了。",[16,165,166],{},[22,167],{"alt":168,"src":169},"example","https://static.031130.xyz/uploads/2024/08/12/641f2272ab7fb.webp",[16,171,172,173,176],{},"将 ",[50,174,175],{},"http://example.com","改为目标站点，我们完全可以摆脱国内云服务商，在自己的服务器上直接实现「隐式代理」的效果。",[16,178,179],{},[45,180,181],{},"而这种方案，恰巧可以用于在境内机子上建站，尤其是针对未备案的域名。",[16,183,184],{},"碍于 Github Pages 在境内的访问体验并不好，所以直接把博客部署在 Github Pages 下一直都不是首选，因此很多人都会选择去购买一台境内的小鸡，带宽虽然不大，但跑个博客什么的其实没什么大问题，但备案就很麻烦了。",[16,186,187,188,191],{},"我们可以通过在 Github Pages（或者其他境外的服务器） 上挂一个 ",[50,189,190],{},"index.html"," ，html 中使用 iframe 嵌套一个部署在境内小鸡上的网页来规避掉备案的问题。而境内小鸡可以选用非标准端口去监听请求。",[22,193],{"src":194,"alt":195,"style":196},"https://static.031130.xyz/uploads/2024/08/12/642014b05bb43.webp","使用隐式转发","zoom:67%;",[22,198],{"src":199,"alt":200,"style":196},"https://static.031130.xyz/uploads/2024/08/12/642014519ce2a.webp","2.drawio.png",[16,202,203],{},"这样带来的好处是访客只需要从境外的服务器上获取一个不到 1 KB 大小的 html ，随后的所有请求都是指向境内云服务器的，所以网页打开时的体验会得到改善。",[16,205,206],{},"隐式转发拥有以下优势：",[208,209,210,214,217,220],"ul",{},[211,212,213],"li",{},"直接向境内的云服务器发送请求，速度会得到改善 （相比于直接部署在境外服务器上的方案）",[211,215,216],{},"不怎么消耗境外服务器的流量 （相比于使用境外服务器反向代理的方案）",[211,218,219],{},"浏览器的地址栏不会直接显示 ip 或端口号（相比于未备案使用境内服务器的非标准端口的方案）",[211,221,222],{},"不需要备案（相比于备案后使用境内服务器的 80/443 端口的方案）",[16,224,225],{},"但也存在以下劣势：",[208,227,228,231,238,241],{},[211,229,230],{},"移动端设备访问时好像还是会展示 PC 端的界面（存疑",[211,232,233,234,237],{},"现代浏览器访问时可能会有 ",[50,235,236],{},"strict-origin-when-cross-origin"," 的问题（一般好像是出现在 iframe 的 html 是 https 访问，而目标站点是 http 访问的情况？）",[211,239,240],{},"一些古老的浏览器可能不支持 iframe （？",[211,242,243],{},"访问目标站点的其他路径时，浏览器地址栏的显示的地址不会变",[245,246],"hr",{},[16,248,249,250,255,256,261,262,267],{},"那么应",[32,251,254],{"href":252,"rel":253},"https://static.031130.xyz/uploads/2024/08/12/64201607999e3.webp",[36],"某些群友的要求","，本文的第二作者为 ",[32,257,260],{"href":258,"rel":259},"https://blog.f1nley.xyz",[36],"Finley","，通信作者为 ",[32,263,266],{"href":264,"rel":265},"https://blog.chordvers.com/",[36],"LanStarD","。",[269,270,271],"style",{},"html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html pre.shiki code .sJa8x, html code.shiki .sJa8x{--shiki-default:#E45649;--shiki-dark:#E06C75}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html pre.shiki code .s-dj3, html code.shiki .s-dj3{--shiki-default:#000000;--shiki-dark:#FFFFFF}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}",{"title":70,"searchDepth":273,"depth":273,"links":274},2,[],{"title":276,"date":277,"path":278,"tags":279,"body":285},"在 vps 上配合 caddy 部署 siteproxy","2023-02-01 22:33:53","/2023/02/01/deploy-siteproxy-with-caddy-on-vps",[280,281,282,283,284],"OpenSource Project","siteproxy","Archlinux","nodejs","Caddy",{"type":13,"value":286,"toc":738},[287,295,302,305,320,323,328,343,431,441,445,459,462,469,472,475,520,552,557,560,639,643,650,663,670,673,686,693,699,702,705,713,720,724,731,735],[16,288,289,290,294],{},"之前趁着春节活动的时候在某 vps 服务商买了 1 年的 vps，线路不算太好，但勉强够用，于是打算在上面部署一些反代程序。在群友的推荐下，发现了这款名为 ",[32,291,281],{"href":292,"rel":293},"https://github.com/netptop/siteproxy",[36]," 的开源项目。",[16,296,297,298,301],{},"siteproxy 相较于我在 ",[50,299,300],{},"r.zhullyb.top"," 部署的那个反代，其特点是可以运行在 vps 上，且将会替换被反代页面上的所有 url，因此遇到使用相对路径的网页也可以从容应对。",[16,303,304],{},"在项目的 README 中介绍了一种部署方案，但我仍有以下几点不太满意",[208,306,307,310,317],{},[211,308,309],{},"README 中的方案仅支持 nginx 部署，但我希望使用 caddy",[211,311,312,313,316],{},"README 中的方案使用 npm 安装了 ",[50,314,315],{},"forever"," 来达到保活的目的，甚至为此安装了 nvm，但我一不希望使用 npm 在系统上安装软件、二不希望安装 nvm 与 forever",[211,318,319],{},"原项目把根目录页做成了一个导航，指向了一些比较敏感的站点，而我希望换掉这个网页。",[16,321,322],{},"因此这篇博客也就应运而生。",[324,325,327],"h2",{"id":326},"反代-8011-端口","反代 8011 端口",[16,329,330,331,334,335,339,340,267],{},"根据项目 README 的描述，我们应当使用 nginx 去反代 ",[50,332,333],{},"127.0.0.1:8011"," 端口，但我是 caddy 用户，此前也",[32,336,338],{"href":337},"/2022/05/30/use-caddy-to-proxy-wikipedia/","有过使用 caddy 反代","的经验，所以很容易写出一段使得程序可以正确运行的 ",[50,341,342],{},"Caddyfile",[65,344,348],{"className":345,"code":346,"language":347,"meta":70,"style":70},"language-nginx shiki shiki-themes one-light one-dark-pro","example.com {\n        reverse_proxy   127.0.0.1:8011 {\n                header_up Host {upstream_hostport}\n                header_up X-Real-IP {http.request.remote.host}\n                header_up X-Forwarded-For {http.request.remote.host}\n                header_up X-Forwarded-Port {http.request.port}\n                header_up X-Forwarded-Proto {http.request.scheme}\n                header_up Accept-Encoding identity\n        }\n}\n","nginx",[50,349,350,362,370,379,387,395,403,411,419,425],{"__ignoreMap":70},[74,351,352,355,359],{"class":76,"line":77},[74,353,354],{"class":80},"example.",[74,356,358],{"class":357},"sLKXg","com",[74,360,361],{"class":80}," {\n",[74,363,364,367],{"class":76,"line":273},[74,365,366],{"class":357},"        reverse_proxy",[74,368,369],{"class":80},"   127.0.0.1:8011 {\n",[74,371,373,376],{"class":76,"line":372},3,[74,374,375],{"class":357},"                header_up",[74,377,378],{"class":80}," Host {upstream_hostport}\n",[74,380,382,384],{"class":76,"line":381},4,[74,383,375],{"class":357},[74,385,386],{"class":80}," X-Real-IP {http.request.remote.host}\n",[74,388,390,392],{"class":76,"line":389},5,[74,391,375],{"class":357},[74,393,394],{"class":80}," X-Forwarded-For {http.request.remote.host}\n",[74,396,398,400],{"class":76,"line":397},6,[74,399,375],{"class":357},[74,401,402],{"class":80}," X-Forwarded-Port {http.request.port}\n",[74,404,406,408],{"class":76,"line":405},7,[74,407,375],{"class":357},[74,409,410],{"class":80}," X-Forwarded-Proto {http.request.scheme}\n",[74,412,414,416],{"class":76,"line":413},8,[74,415,375],{"class":357},[74,417,418],{"class":80}," Accept-Encoding identity\n",[74,420,422],{"class":76,"line":421},9,[74,423,424],{"class":80},"        }\n",[74,426,428],{"class":76,"line":427},10,[74,429,430],{"class":80},"}\n",[16,432,172,433,436,437,440],{},[50,434,435],{},"example.com"," 的 A 记录解析到 vps 主机的 ip，并使用 ",[50,438,439],{},"systemctl"," 重新启动 caddy，这一步就算完成了。",[324,442,444],{"id":443},"安装-nodejs","安装 nodejs",[16,446,447,448,451,452,455,456,458],{},"我在 vps 上安装的发行版是 Archlinux，所以直接 ",[50,449,450],{},"pacman -S nodejs"," 安装完就是了，别的发行版应该也可以直接调用系统默认的包管理器安装 ",[50,453,454],{},"node"," 或者 ",[50,457,283],{}," 完成这一步。",[324,460,461],{"id":461},"下载程序",[16,463,464,465,468],{},"首先，我们需要一个地方来存放我们下载的程序，我使用的是 ",[50,466,467],{},"/opt"," 路径。",[16,470,471],{},"我们可以直接根据 README 所说的，直接 clone 整个项目，但我本人并不想这么做，项目里似乎有太多对于 vps 用户没有用的东西了。此外，整个项目首页我也不想要，首页的导航指向了一些比较敏感的网站，而我的反代就想安安心心的一个人用。",[16,473,474],{},"综合以上需求，我所需要的文件一共就五个:",[65,476,480],{"className":477,"code":478,"language":479,"meta":70,"style":70},"language-bash shiki shiki-themes one-light one-dark-pro","├── config.js\n├── index.js\n├── logger.js\n├── package.json\n└── Proxy.js\n","bash",[50,481,482,491,498,505,512],{"__ignoreMap":70},[74,483,484,488],{"class":76,"line":77},[74,485,487],{"class":486},"sAdtL","├──",[74,489,490],{"class":109}," config.js\n",[74,492,493,495],{"class":76,"line":273},[74,494,487],{"class":486},[74,496,497],{"class":109}," index.js\n",[74,499,500,502],{"class":76,"line":372},[74,501,487],{"class":486},[74,503,504],{"class":109}," logger.js\n",[74,506,507,509],{"class":76,"line":381},[74,508,487],{"class":486},[74,510,511],{"class":109}," package.json\n",[74,513,514,517],{"class":76,"line":389},[74,515,516],{"class":486},"└──",[74,518,519],{"class":109}," Proxy.js\n",[65,521,523],{"className":477,"code":522,"language":479,"meta":70,"style":70},"mkdir -p /opt/siteproxy\ncd /opt/siteproxy\nwget https://raw.githubusercontent.com/netptop/siteproxy/master/{config.js,index.js,logger.js,package.json,Proxy.js}\n",[50,524,525,536,544],{"__ignoreMap":70},[74,526,527,530,533],{"class":76,"line":77},[74,528,529],{"class":486},"mkdir",[74,531,532],{"class":88}," -p",[74,534,535],{"class":109}," /opt/siteproxy\n",[74,537,538,542],{"class":76,"line":273},[74,539,541],{"class":540},"s_Sar","cd",[74,543,535],{"class":109},[74,545,546,549],{"class":76,"line":372},[74,547,548],{"class":486},"wget",[74,550,551],{"class":109}," https://raw.githubusercontent.com/netptop/siteproxy/master/{config.js,index.js,logger.js,package.json,Proxy.js}\n",[16,553,554,555],{},"然后补上一个 ",[50,556,190],{},[16,558,559],{},"我这边选择直接使用 JavaScript 将对于 / 的访问直接重定向到我的博客。",[65,561,565],{"className":562,"code":563,"language":564,"meta":70,"style":70},"language-javascript shiki shiki-themes one-light one-dark-pro","\u003Chtml>\u003Chead>\u003Cmeta http-equiv=\"refresh\" content=\"0; url=https://zhul.in/\" />\u003C/head>\u003Cbody>Redirect to \u003Ca href=\"\">https://zhul.in/\u003C/a>\u003C/body>\u003C/html>\n","javascript",[50,566,567],{"__ignoreMap":70},[74,568,569,572,574,576,579,581,584,588,591,594,597,599,602,605,607,609,612,615,617,619,621,624,627,629,631,633,635,637],{"class":76,"line":77},[74,570,571],{"class":80},"\u003C",[74,573,69],{"class":84},[74,575,92],{"class":80},[74,577,578],{"class":84},"head",[74,580,92],{"class":80},[74,582,583],{"class":84},"meta",[74,585,587],{"class":586},"so_Uh"," http-equiv",[74,589,106],{"class":590},"sknuh",[74,592,593],{"class":109},"\"refresh\"",[74,595,596],{"class":586}," content",[74,598,106],{"class":590},[74,600,601],{"class":109},"\"0; url=https://zhul.in/\"",[74,603,604],{"class":80}," />\u003C/",[74,606,578],{"class":84},[74,608,92],{"class":80},[74,610,611],{"class":84},"body",[74,613,614],{"class":80},">Redirect to \u003C",[74,616,32],{"class":84},[74,618,135],{"class":586},[74,620,106],{"class":590},[74,622,623],{"class":109},"\"\"",[74,625,626],{"class":80},">https://zhul.in/\u003C/",[74,628,32],{"class":84},[74,630,147],{"class":80},[74,632,611],{"class":84},[74,634,147],{"class":80},[74,636,69],{"class":84},[74,638,160],{"class":80},[640,641,642],"h3",{"id":642},"安装依赖",[16,644,645,646,649],{},"在 ",[50,647,648],{},"/opt/siteproxy"," 目录下执行",[65,651,653],{"className":477,"code":652,"language":479,"meta":70,"style":70},"npm install\n",[50,654,655],{"__ignoreMap":70},[74,656,657,660],{"class":76,"line":77},[74,658,659],{"class":486},"npm",[74,661,662],{"class":109}," install\n",[16,664,665,666,669],{},"npm 将会根据 ",[50,667,668],{},"package.json"," 的内容自动安装所需的依赖。",[324,671,672],{"id":672},"修改配置文件",[65,674,676],{"className":477,"code":675,"language":479,"meta":70,"style":70},"$EDITOR /opt/siteproxy/config.js\n",[50,677,678],{"__ignoreMap":70},[74,679,680,683],{"class":76,"line":77},[74,681,682],{"class":84},"$EDITOR",[74,684,685],{"class":80}," /opt/siteproxy/config.js\n",[16,687,688,689,692],{},"按照 README 所说，修改 ",[50,690,691],{},"serverName"," 字段",[16,694,695],{},[22,696],{"alt":697,"src":698},"需要修改的 serverName 字段","https://static.031130.xyz/uploads/2024/08/12/63da866e26712.webp",[324,700,701],{"id":701},"设置开机自启动",[16,703,704],{},"这里我选择使用 systemd 帮助我实现 siteproxy 程序的开机自启动，service 文件是我直接根据 frp 程序提供的 service 改的。",[65,706,711],{"className":707,"code":709,"language":710},[708],"language-text","cat /usr/lib/systemd/system/siteproxy.service \n-----\n[Unit]\nDescription=SiteProxy\nAfter=network-online.target\nWants=network-online.target\n\n[Service]\nType=simple\nUser=nobody\nRestart=on-failure\nRestartSec=5s\nEnvironment=\"NODE_PATH=/opt/siteproxy/\"\nExecStart=node --tls-min-v1.0 /opt/siteproxy/index.js \n\n[Install]\nWantedBy=multi-user.target\n","text",[50,712,709],{"__ignoreMap":70},[16,714,715,716,719],{},"随后使用 ",[50,717,718],{},"systemctl enable siteproxy --now"," 启动即可访问。",[324,721,723],{"id":722},"为反代站点添加访问密码可选","为反代站点添加访问密码（可选）",[16,725,726,727,267],{},"参考",[32,728,730],{"href":729},"/2021/10/21/picuploader-on-archlinux-with-caddy/#%E8%AE%BE%E7%BD%AE%E8%AE%BF%E9%97%AE%E5%AF%86%E7%A0%81%EF%BC%88%E5%8F%AF%E9%80%89%EF%BC%89","我的另一篇博客",[324,732,734],{"id":733},"使用防火墙程序禁止-8011-的公网访问可选","使用防火墙程序禁止 8011 的公网访问（可选）",[269,736,737],{},"html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html pre.shiki code .sLKXg, html code.shiki .sLKXg{--shiki-default:#A626A4;--shiki-dark:#C678DD}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html pre.shiki code .s_Sar, html code.shiki .s_Sar{--shiki-default:#0184BC;--shiki-dark:#56B6C2}html pre.shiki code .sJa8x, html code.shiki .sJa8x{--shiki-default:#E45649;--shiki-dark:#E06C75}html pre.shiki code .so_Uh, html code.shiki .so_Uh{--shiki-default:#986801;--shiki-default-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic}html pre.shiki code .sknuh, html code.shiki .sknuh{--shiki-default:#383A42;--shiki-dark:#56B6C2}",{"title":70,"searchDepth":273,"depth":273,"links":739},[740,741,742,745,746,747,748],{"id":326,"depth":273,"text":327},{"id":443,"depth":273,"text":444},{"id":461,"depth":273,"text":461,"children":743},[744],{"id":642,"depth":372,"text":642},{"id":672,"depth":273,"text":672},{"id":701,"depth":273,"text":701},{"id":722,"depth":273,"text":723},{"id":733,"depth":273,"text":734},{"title":750,"date":751,"path":752,"tags":753,"body":757},"onedrive(by abraunegg) —— 一个 Linux 下的开源 OneDrive 客户端(cli)","2022-12-24 22:40:13","/2022/12/24/onedrive-abraunegg-recommendation",[754,282,280,755,756],"Linux","Experience","OneDrive",{"type":13,"value":758,"toc":1074},[759,768,771,780,787,806,809,820,827,833,836,847,853,859,862,873,875,902,904,911,917,945,951,957,961,970,973,976,988,991,995,1001,1005,1011,1015,1020,1024,1029,1033,1042,1046,1052,1071],[40,760,761],{},[16,762,763,764],{},"这款 Linux 下的 OneDrive 客户端我其实一年前就已经在用了，最近打算给自己的 vps 重装系统并重新部署下 aria 的下载服务，顺便把上传到 OneDrive 的功能增加进去，便又想到了这款运行在命令行中的第三方开源 Linux 客户端，去谷歌上搜索了一番，依然没有什么成规模的中文博客去写它的用法，于是就打算自己来写。",[765,766,767],"del",{},"那肯定不是因为我博客这个月没有什么题材",[324,769,770],{"id":770},"安装",[16,772,773,774,779],{},"abraunegg 用 D 语言写的 OneDrive 客户端安装起来并不是什么难事，Ubuntu/Debian/Fedora 等常见发行版的仓库中均有它的身影，具体情况在 ",[32,775,778],{"href":776,"rel":777},"https://github.com/abraunegg/onedrive/blob/master/docs/INSTALL.md",[36],"Github 项目页面","中都有描述。",[16,781,782,783,786],{},"在 Archlinux 下，我可以直接从 AUR/ArchlinuxCN 中安装 ",[50,784,785],{},"onedrive-abraunegg"," 这个包来安装这个项目。",[65,788,790],{"className":477,"code":789,"language":479,"meta":70,"style":70},"sudo pacman -S onedrive-abraunegg\n",[50,791,792],{"__ignoreMap":70},[74,793,794,797,800,803],{"class":76,"line":77},[74,795,796],{"class":486},"sudo",[74,798,799],{"class":109}," pacman",[74,801,802],{"class":88}," -S",[74,804,805],{"class":109}," onedrive-abraunegg\n",[324,807,808],{"id":808},"运行前配置",[40,810,811],{},[16,812,813,814,819],{},"本章内容中的所用到的和没有用到的命令都可以在",[32,815,818],{"href":816,"rel":817},"https://github.com/abraunegg/onedrive/blob/master/docs/USAGE.md",[36],"该项目的 Github 仓库","中找到。",[16,821,822,823,826],{},"在终端直接运行 ",[50,824,825],{},"onedrive"," 命令，程序将打印出一行地址。",[16,828,829],{},[22,830],{"alt":831,"src":832},"登陆地址","https://static.031130.xyz/uploads/2024/08/12/63a71dbfd6ed3.webp",[16,834,835],{},"使用浏览器打开地址，就会跳出微软的登陆页面，正常登陆即可。",[16,837,838,839,842,843,846],{},"登陆成功后，浏览器将会显示一片白屏，不必慌张，直接将浏览器地址栏中的网址复制后粘贴进终端中即可完成配置，获取到的 ",[50,840,841],{},"refresh_token"," 将会被保存到 ",[50,844,845],{},"$HOME/.config/onedrive"," 下。",[16,848,849],{},[22,850],{"alt":851,"src":852},"浏览器显示白屏","https://static.031130.xyz/uploads/2024/08/12/63a71e1f9c916.webp",[16,854,855],{},[22,856],{"alt":857,"src":858},"授权成功","https://static.031130.xyz/uploads/2024/08/12/63a71ec6d5aca.webp",[16,860,861],{},"账号授权成功以后我有两个迫切的需求需要在开始同步前解决:",[208,863,864,867],{},[211,865,866],{},"我不希望把我 OneDrive 里所有的文件下载下来，我在 OneDrive 中存放了至少 1T 的数据，而我的系统盘就只有 512G，这绝对是放不下的，所以我想仅同步部分文件夹。",[211,868,869,870,846],{},"我需要修改被同步到的文件夹的路径，我不想把 OneDrive 上的文件下载到我的 ",[50,871,872],{},"/home",[245,874],{},[16,876,877,878,881,882,884,885,887,888,891,892,895,896,901],{},"要解决第一个需求，我们可以通过创建 ",[50,879,880],{},"sync_list"," 的方式指定我们要同步的文件，在 ",[50,883,845],{}," 路径下创建 ",[50,886,880],{}," ，并填入需要的文件或文件夹名，或在 ",[50,889,890],{},"!","或",[50,893,894],{},"-"," 后面写上不想同步的文件或文件夹名即可，支持通配符，在",[32,897,900],{"href":898,"rel":899},"https://github.com/abraunegg/onedrive/blob/master/docs/USAGE.md#performing-a-selective-sync-via-sync_list-file",[36],"原仓库的文档中","给出了非常详细的描述。",[245,903],{},[16,905,906,907,910],{},"我们可以先使用 ",[50,908,909],{},"onedrive --display-config"," 命令查看我们当前的配置情况。（我这边直接应用 Github 文档中展示的内容）",[65,912,915],{"className":913,"code":914,"language":710},[708],"onedrive version                             = vX.Y.Z-A-bcdefghi\nConfig path                                  = /home/alex/.config/onedrive\nConfig file found in config path             = true\nConfig option 'sync_dir'                     = /home/alex/OneDrive\nConfig option 'enable_logging'               = false\n...\nSelective sync 'sync_list' configured        = false\nConfig option 'sync_business_shared_folders' = false\nBusiness Shared Folders configured           = false\nConfig option 'webhook_enabled'              = false\n",[50,916,914],{"__ignoreMap":70},[16,918,919,920,923,924,927,928,931,932,937,938,941,942],{},"这很显然，OneDrive 中的文件默认将会被保存到 ",[50,921,922],{},"$HOME/OneDrive"," 中。为了修改这个位置项，我们直接在 ",[50,925,926],{},"$HOME/.config/onedrive/"," 路径下创建一个名为 ",[50,929,930],{},"config"," 的文件，把此处给的 c",[32,933,936],{"href":934,"rel":935},"https://github.com/abraunegg/onedrive/blob/master/docs/USAGE.md#the-default-configuration-file-is-listed-below",[36],"onfiguration examples"," 全部复制进去，找到 ",[50,939,940],{},"sync_dir"," 把前面的注释删掉，改成自己喜欢的路径 ",[765,943,944],{},"（别问我为什么写 /tmp，问就是我内存够大",[16,946,947],{},[22,948],{"alt":949,"src":950},"修改同步路径！","https://static.031130.xyz/uploads/2024/08/12/63a7282ee55e7.webp",[16,952,953,954,956],{},"修改好此处的配置文件后，可以再次运行 ",[50,955,909],{}," 检查自己的配置文件格式有没有问题、自己更改的配置项有没有生效，这样就解决了我的第二个需求。",[324,958,960],{"id":959},"standalone-mode-monitor-mode","Standalone Mode / Monitor Mode?",[16,962,963,964,969],{},"这款 OneDrive 客户端支持以两种方式运行，monitor 模式将会监控本地磁盘上的文件状态，因而在同步路径内的文件从一个路径移动到另一个路径时，客户端将不会傻傻地执行「在原路径删除远端文件-重新上传新路径的本地文件」的这一个过程，具体使用 monitor 或 standalone 模式还请自行斟酌，可参考 ",[32,965,968],{"href":966,"rel":967},"https://github.com/abraunegg/onedrive/blob/master/docs/known-issues.md#moving-files-into-different-folders-should-not-cause-data-to-delete-and-be-re-uploaded",[36],"Moving files into different folders should not cause data to delete and be re-uploaded"," .",[324,971,972],{"id":972},"开始同步",[16,974,975],{},"使用该客户端执行同步的命令很简单，即",[65,977,979],{"className":477,"code":978,"language":479,"meta":70,"style":70},"onedrive --synchronize\n",[50,980,981],{"__ignoreMap":70},[74,982,983,985],{"class":76,"line":77},[74,984,825],{"class":486},[74,986,987],{"class":88}," --synchronize\n",[16,989,990],{},"但可选的运行参数很多，我只举出最常用的几个例子",[640,992,994],{"id":993},"dry-run","--dry-run",[16,996,997,998,1000],{},"使用 ",[50,999,994],{}," 选项后，OneDrive 将不会执行同步操作，它将在终端输出原本将会被执行的操作以供你排查自己的配置是否正确。",[640,1002,1004],{"id":1003},"local-first","--local-first",[16,1006,1007,1008,1010],{},"字面意思，",[50,1009,1004],{}," 即为本地优先，同步时如果遇到文件冲突将会优先参考本地的情况。",[640,1012,1014],{"id":1013},"single-directory","--single-directory",[16,1016,1017,1019],{},[50,1018,1014],{}," 后面需要跟一个子文件夹在 OneDrive 根目录中的相对路径，这将使本次的同步操作仅对单个文件夹生效。",[640,1021,1023],{"id":1022},"download-only","--download-only",[16,1025,1007,1026,1028],{},[50,1027,1023],{}," 即为仅下载模式。",[640,1030,1032],{"id":1031},"upload-only","--upload-only",[16,1034,1007,1035,1037,1038,1041],{},[50,1036,1032],{},"即为仅上传模式，后跟 ",[50,1039,1040],{},"--no-remote-delete","将不会在 OneDrive 网盘中删除本地相较于网盘中缺少的文件，真正做到 upload only.",[640,1043,1045],{"id":1044},"resync","--resync",[16,1047,1048,1049,1051],{},"当下列配置项被更改时，需要执行 ",[50,1050,1045],{}," 来确保客户端正在按照更新后的配置文件来同步你的数据",[208,1053,1054,1056,1059,1062,1065,1068],{},[211,1055,940],{},[211,1057,1058],{},"skip_dir",[211,1060,1061],{},"skip_file",[211,1063,1064],{},"drive_id",[211,1066,1067],{},"Modifying sync_list",[211,1069,1070],{},"Modifying business_shared_folders",[269,1072,1073],{},"html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}",{"title":70,"searchDepth":273,"depth":273,"links":1075},[1076,1077,1078,1079],{"id":770,"depth":273,"text":770},{"id":808,"depth":273,"text":808},{"id":959,"depth":273,"text":960},{"id":972,"depth":273,"text":972,"children":1080},[1081,1082,1083,1084,1085,1086],{"id":993,"depth":372,"text":994},{"id":1003,"depth":372,"text":1004},{"id":1013,"depth":372,"text":1014},{"id":1022,"depth":372,"text":1023},{"id":1031,"depth":372,"text":1032},{"id":1044,"depth":372,"text":1045},{"title":1088,"date":1089,"path":1090,"tags":1091,"body":1094},"【翻译】关于2022年11月的事件的一些话[Z-Library]","2022-11-21 13:24:33","/2022/11/21/a-few-words-about-the-events-of-november-2022",[1092,1093],"Translation","Z-Library",{"type":13,"value":1095,"toc":1160},[1096,1107,1109,1120,1128,1133,1136,1141,1144,1154],[40,1097,1098],{},[16,1099,1100,1101,1106],{},"正如我们所知道的那样，Z-Library 的主域名在前不久已经被美国警方给 take down 了，目前仅剩下 Telegram Bot 和 Tor 网络两种访问方式是我们仍然可以信任的。在11月18日，Z-Library 于其博客上发布了",[32,1102,1105],{"href":1103,"rel":1104},"http://bookszlibb74ugqojhzhg2a63w5i2atv5bqarulgczawnbmsb6s6qead.onion/blog/36",[36],"一篇新的文章（onion链接）","，此处是我的翻译版本。",[245,1108],{},[40,1110,1111],{},[16,1112,1113,1114,1119],{},"As many of you know, on November 3rd most of our domains were seized and some our servers were suspended by the United States Department of  Justice and Federal Bureau of Investigation. In addition, on November 16 the United States Department of Justice ",[32,1115,1118],{"href":1116,"rel":1117},"https://www.justice.gov/usao-edny/pr/two-russian-nationals-charged-running-massive-e-book-piracy-website",[36],"published"," the indictment against two citizens of Russia, Anton and Valeria. They  are accused of criminal copyright infringement, wire fraud and money  laundering to operate the Z-Library.",[16,1121,1122,1123,1127],{},"正如你们大多数人所知道的那样，在11月3日，我们大多数的域名和一部分服务器被美国司法部和联邦调查局封禁了。此外，在11月16日，美国司法部出",[32,1124,1126],{"href":1116,"rel":1125},[36],"发布了","针对两个俄罗斯公民—— Anton 和 Valeria 的指控。他们因经营 Z-Library 而被指控犯有侵犯版权、电汇欺诈和洗钱等罪名。",[40,1129,1130],{},[16,1131,1132],{},"We refrain commenting on the alleged Anton and Valeria involvement in  the Z-Library project and the charges against them. We are very sorry  they are arrested. We also regret that some authors have suffered  because of Z-Library and ask for their forgiveness. We do our best to  respond to all complaints about files hosted in our library if it  violates author's rights.",[16,1134,1135],{},"我们不评论 Anton 和 Valeria 涉嫌参与 Z-Library 项目的行为以及对他们的指控。我们对他们的被捕感到非常抱歉，也对一些因为 Z-Library 而遭受的损失的作者表示歉意，并请求他们的原谅。如果我们的网站中托管的文件侵犯了作者的权利，我们会尽最大努力回应所有的投诉。",[40,1137,1138],{},[16,1139,1140],{},"We see the resonance recent events caused, we see how many  people support and believe in Z-Library. Thank you for your support, it  is extremely valuable to us. Thank you for each donation you make. You  are the ones who making the existence of the Z-Library possible. We  believe the knowledge and cultural heritage of mankind should be  accessible to all people around the world, regardless of their wealth,  social status, nationality, citizenship, etc. This is the only purpose  Z-Library is made for.",[16,1142,1143],{},"我们看到最近发生的事件所引起的共鸣，我们看到了有多少人支持并信任 Z-Library。 感谢您的支持，这对我们来说极其珍贵。我们感激您的每一笔捐款，你们是使 Z-Library 的存在成为可能的人。 我们认为，人类的知识和文化遗产应该为全世界所有人所用，无论其财富、社会地位、国籍、公民身份等，而这，正是 Z-Library 存在的唯一目的。",[40,1145,1146],{},[16,1147,1149,1150,1153],{"align":1148},"right","My makeup may be flaking",[1151,1152],"br",{},"But my smile still stays on",[16,1155,1156,1157,1159],{"align":1148},"我的妆容可能会脱落",[1151,1158],{},"但我的笑容将会永存",{"title":70,"searchDepth":273,"depth":273,"links":1161},[],{"title":1163,"date":1164,"path":1165,"tags":1166,"body":1169},"【已过期】使用 vercel+supabase 免费部署 umami","2022-11-08 13:37:53","/2022/11/08/free-umami-deploy-plan",[11,1167,280,1168],"umami","Vercel",{"type":13,"value":1170,"toc":1327},[1171,1182,1185,1188,1191,1197,1205,1219,1225,1228,1234,1240,1246,1252,1264,1270,1273,1279,1290,1296,1302,1308,1311,1317],[40,1172,1173,1179],{},[16,1174,1175,1176,267],{},"讲起静态网站的访客统计，我最先使用的是百度统计，但后来转到了 umeng，发现后续的几天百度爬虫的光顾次数反而多了起来。好家伙，使用百度统计相当于把自己网站访问量向百度全盘托出，",[765,1177,1178],{},"我说我的博客怎么还不被百度收录呢",[16,1180,1181],{},"后来，umeng 推出了新的服务条款，好像是说不再向未备案的站点提供服务，随后不得不转向自部署的开源网站统计程序。",[16,1183,1184],{},"umami 提供了多种部署方式，在 vps 上可以非常轻松地使用 docker 一键部署，但上次 vps 到期时用 1Mbps 的小水管拖了好久都没有把博客前几个月的访客数据拖下来，一气之下我选择直接丢掉了这些可有可无的数据。",[16,1186,1187],{},"所以这一次，我决定放弃在自己的 vps 上部署，转去探索免费的部署方案。",[16,1189,1190],{},"umami 的官方文档上提供了非常多的部署方案，我个人比较喜欢 vercel，本站的随机图片 api 就是挂在 vercel 上的，界面比较简洁，且境内访问还算OK。",[16,1192,1193],{},[22,1194],{"alt":1195,"src":1196},"umami官方文档提供的部署方案","https://static.031130.xyz/uploads/2024/08/12/6369ee9308dc3.webp",[16,1198,1199,1200,267],{},"但问题在于 vercel 本身并不提供免费的数据库，所以我们不得不去寻找一些长期免费提供数据库的供应商，我选择了 ",[32,1201,1204],{"href":1202,"rel":1203},"https://supabase.com/pricing",[36],"supabase",[16,1206,1207,1208,1211,1212,1215,1216],{},"在下图中选择顶栏的 ",[45,1209,1210],{},"Pricing"," 后看到这个 ",[45,1213,1214],{},"$0/month"," 就",[765,1217,1218],{},"疯狂戳烂这个 Get Started",[16,1220,1221],{},[22,1222],{"alt":1223,"src":1224},"supabase价目表","https://static.031130.xyz/uploads/2024/08/12/6369ef8d3451e.webp",[16,1226,1227],{},"随便填写个项目名然后输入一个足够强大的密码，地区选择美国就行，东部西部无所谓（毕竟我也不知道 vercel 的机房是在东部还是西部）",[16,1229,1230],{},[22,1231],{"alt":1232,"src":1233},"创建项目ing","https://static.031130.xyz/uploads/2024/08/12/6369f03faba15.webp",[16,1235,1236,1237],{},"看到这个小小的绿标就说明数据库正在初始化(",[765,1238,1239],{},"你先别急，让我先急",[16,1241,1242],{},[22,1243],{"alt":1244,"src":1245},"项目初始化中","https://static.031130.xyz/uploads/2024/08/12/6369f0d98a59c.webp",[16,1247,1248],{},[22,1249],{"alt":1250,"src":1251},"进行一通设置，把网站关闭后直接打入冷宫（x","https://static.031130.xyz/uploads/2024/08/12/6369f209c27aa.webp",[16,1253,1254,1255,1260,1261],{},"随后打开官方文档，点击其",[32,1256,1259],{"href":1257,"rel":1258},"https://umami.is/docs/running-on-vercel",[36],"描述 vercel 那一页","中大大的 ",[45,1262,1263],{},"Deploy",[16,1265,1266],{},[22,1267],{"alt":1268,"src":1269},"vercel on Document","https://static.031130.xyz/uploads/2024/08/12/6369f2bda5f78.webp",[16,1271,1272],{},"初始化过程中，vercel 会要求你创建一个 git 仓库，一般私有库就够了。",[16,1274,1275],{},[22,1276],{"alt":1277,"src":1278},"创建仓库","https://static.031130.xyz/uploads/2024/08/12/6369f33ccf6d0.webp",[16,1280,1281,1282,1285,1286,1289],{},"随后需要我们设置两个环境变量，第一个 ",[50,1283,1284],{},"DATABASE_URL"," 就是我们刚刚从 supabase 中复制下来并替换好 password 的 url，第二个 ",[50,1287,1288],{},"HASH_SALT","需要你随意生成一长串字符串~~（比如你可以找一个新手让他帮你退出 vim~~",[16,1291,1292],{},[22,1293],{"alt":1294,"src":1295},"设置环境变量","https://static.031130.xyz/uploads/2024/08/12/6369f3adbd34d.webp",[16,1297,1298,1299,1301],{},"点击 ",[45,1300,1263],{}," 并等上两分钟，我们就部署完啦（首页没东西，白屏是正常的",[16,1303,1304],{},[22,1305],{"alt":1306,"src":1307},"部署成功","https://static.031130.xyz/uploads/2024/08/12/6369f58f6acd4.webp",[16,1309,1310],{},"来到项目首页，点击任意域名即可访问到我们部署的 umami，不过 vercel 的域名近年来也有被污染的情况，建议在设置里绑定自己的域名。",[16,1312,1313],{},[22,1314],{"alt":1315,"src":1316},"项目首页","https://static.031130.xyz/uploads/2024/08/12/6369f5ec7a0e2.webp",[16,1318,1319,1320,1323,1324,1326],{},"哦对了，别忘了 umami 的默认用户名密码是",[50,1321,1322],{},"admin","和",[50,1325,1167],{},"，别到时候点击进去看到登陆框一脸懵，这是在文档里写过的。",{"title":70,"searchDepth":273,"depth":273,"links":1328},[],{"title":1330,"date":1331,"path":1332,"tags":1333,"body":1337},"我的博客部署方案","2022-11-04 16:41:28","/2022/11/04/my-blog-plan",[11,1334,1335,1336],"Github Action","Hexo","Blog",{"type":13,"value":1338,"toc":1621},[1339,1342,1353,1365,1368,1377,1383,1390,1399,1609,1611,1618],[16,1340,1341],{},"一直以来，我的博客使用的几乎都是 Hexo 框架。",[16,1343,1344,1345,1348,1349,1352],{},"静态博客的一大优点就是可以支持 Serverless 部署，这使得我们可以直接在 Github Pages、Vercel 等平台直接部署上我的博客，如果用上 ",[50,1346,1347],{},".eu.org"," ",[765,1350,1351],{},"或者非洲国家免费域名","就可以实现零成本的博客部署。",[16,1354,1355,1356,1359,1360,1364],{},"当然，我现在的博客并非是零成本搭建的，如你所见，我购入了印度国别域名 ",[50,1357,1358],{},"zhul.in"," 来凑出 ",[1361,1362,1363],"em",{},"竹林"," 的谐音。并在 Github Pages、Vercel 等平台的访问质量每况愈下的情况下又购入了位于香港的 VPS，这就引申出了今天的内容——介绍我博客的部署方案。",[16,1366,1367],{},"我的博客是使用 HK vps + Github Pages 两处部署实现的，通过 dnspod 免费版的域名分境内/外解析实现了分流。当境内的访客访问我的博客时，他们将会被解析到香港的 vps 上以获得更好的体验，而境外的访客将会被解析到 Github pages，毕竟 Github Pages 在境外的速度并不慢，并且稳定性肯定比我这小鸡要好得多。",[16,1369,1370,1371,1376],{},"不过关于通过 dns 解析分流这件事，之前看",[32,1372,1375],{"href":1373,"rel":1374},"https://www.cities.ee/read-1553.html",[36],"城南旧事","的博客中有提到可以使用境外的 GeoScaling 完成，其免费支持全球分as、城市、经纬等智能解析，也支持自编辑脚本，看起来以后可以去试一试。",[16,1378,1379],{},[22,1380],{"alt":1381,"src":1382},"Dnspod截图","https://static.031130.xyz/uploads/2024/08/12/6364d4f46ff1c.webp",[16,1384,1385,1386,1389],{},"而 Hexo 框架最被人诟病的一点是更新麻烦。这一点不可否认，使用 ",[50,1387,1388],{},"hexo generate"," 生成静态网页文件再部署到服务器上的过程在一台新设备上是不小的工作量，它涉及 git、nodejs 的安装，涉及到 ssh key 和 rsync，整个环境的搭建就要废上不小的工夫。",[16,1391,1392,1393,1398],{},"在博客内容的更新方面，我选择了将整个 Hexo 的 workdir 全部上传到 github，使用 Github Action 帮助我同时完成静态页面的生成和 Github Pages 及 vps 的部署工作。具体的代码可以直接",[32,1394,1397],{"href":1395,"rel":1396},"https://github.com/zhullyb/zhullyb.github.io/blob/master/.github/workflows/deploy.yml",[36],"见我的 GIthub 仓库","，我在这里简单讲下思路。",[1400,1401,1402,1410,1420,1521,1549,1565,1573,1594],"ol",{},[211,1403,444,1404,1406,1407,267],{},[1151,1405],{},"这个没什么可说的，有现成的 Github Action 去完成这件事，我这边直接使用了",[50,1408,1409],{},"actions/setup-node@v2",[211,1411,1412,1413,1415,1416,1419],{},"使用 npm/yarn 安装相关依赖",[1151,1414],{},"这个直接跑 ",[50,1417,1418],{},"yarn install"," 即可。",[211,1421,1422,1423,1425,1426,1428,1429,1434,1435],{},"为每个文件重新设定最后修改时间",[1151,1424],{},"这一步其实是挺重要的，Hexo框架生成每篇文章的最后修改时间的依据是该文件的最后修改时间，而对于 Github Action 的容器来说，每一个文件都刚刚被下载下来，都是最新的，这就会导致你的每一篇文章每次部署时都会被认为刚才修改过。",[1151,1427],{},"我们这边可以直接使用 git 记录的时间来作为文件的最后修改时间。（参考 ",[32,1430,1433],{"href":1431,"rel":1432},"https://mrseawave.github.io/blogs/articles/2021/01/07/ci-hexo-update-time/",[36],"Sea's Blog","）",[65,1436,1438],{"className":477,"code":1437,"language":479,"meta":70,"style":70},"git ls-files | while read filepath; do touch -d \"$(git log -1 --format='@%ct' $filepath)\" \"$filepath\" && echo \"Fixed: $filepath\"; done\n",[50,1439,1440],{"__ignoreMap":70},[74,1441,1442,1445,1448,1451,1454,1457,1460,1463,1466,1469,1472,1475,1477,1480,1483,1486,1489,1492,1495,1498,1500,1503,1506,1509,1512,1514,1516,1518],{"class":76,"line":77},[74,1443,1444],{"class":486},"git",[74,1446,1447],{"class":109}," ls-files",[74,1449,1450],{"class":80}," | ",[74,1452,1453],{"class":357},"while",[74,1455,1456],{"class":540}," read",[74,1458,1459],{"class":109}," filepath",[74,1461,1462],{"class":80},"; ",[74,1464,1465],{"class":357},"do",[74,1467,1468],{"class":486}," touch",[74,1470,1471],{"class":88}," -d",[74,1473,1474],{"class":109}," \"$(",[74,1476,1444],{"class":486},[74,1478,1479],{"class":109}," log ",[74,1481,1482],{"class":88},"-1",[74,1484,1485],{"class":88}," --format=",[74,1487,1488],{"class":109},"'@%ct' ",[74,1490,1491],{"class":84},"$filepath",[74,1493,1494],{"class":109},")\"",[74,1496,1497],{"class":109}," \"",[74,1499,1491],{"class":84},[74,1501,1502],{"class":109},"\"",[74,1504,1505],{"class":80}," && ",[74,1507,1508],{"class":540},"echo",[74,1510,1511],{"class":109}," \"Fixed: ",[74,1513,1491],{"class":84},[74,1515,1502],{"class":109},[74,1517,1462],{"class":80},[74,1519,1520],{"class":357},"done\n",[211,1522,1523,1524,1526,1527,1530,1531],{},"设置时区",[1151,1525],{},"读我的博客的人应该大多都是东八区的人，那我们应当把 Github Action 容器的时区设置为东八区，和自己 ",[50,1528,1529],{},"git commit"," 时所使用的设备的时间保持一致，否则某些文章的日期可能会发生一天的偏移。",[65,1532,1534],{"className":477,"code":1533,"language":479,"meta":70,"style":70},"export TZ='Asia/Shanghai'\n",[50,1535,1536],{"__ignoreMap":70},[74,1537,1538,1541,1544,1546],{"class":76,"line":77},[74,1539,1540],{"class":357},"export",[74,1542,1543],{"class":84}," TZ",[74,1545,106],{"class":590},[74,1547,1548],{"class":109},"'Asia/Shanghai'\n",[211,1550,1551,1552],{},"生成静态网页文件",[65,1553,1555],{"className":477,"code":1554,"language":479,"meta":70,"style":70},"yarn build\n",[50,1556,1557],{"__ignoreMap":70},[74,1558,1559,1562],{"class":76,"line":77},[74,1560,1561],{"class":486},"yarn",[74,1563,1564],{"class":109}," build\n",[211,1566,1567,1568,997,1570],{},"部署到 Github Pages",[1151,1569],{},[50,1571,1572],{},"peaceiris/actions-gh-pages@v3",[211,1574,1575,1576,1578,1579,1581,1585,1587,1588,1593],{},"初始化 Github Action 容器上的 ssh 私钥",[1151,1577],{},"应当在 Github 仓库的设置里先新建一个 secret，填入自己的 ssh 私钥（更加标准的做法应当是为 github action 专门生成一对 ssh 密钥，将公钥上传到自己的 vps，将私钥上传到 Github 仓库的 secret 中）。",[1151,1580],{},[22,1582],{"alt":1583,"src":1584},"github secret setting","https://static.031130.xyz/uploads/2024/08/12/6364dbbfeb8f6.webp",[1151,1586],{},"我这边直接从",[32,1589,1592],{"href":1590,"rel":1591},"https://blog.m-l.cc/2021/07/06/yong-github-actions-bu-shu-hexo/",[36],"点墨阁","那边抄了点代码直接用。",[211,1595,1596,1597],{},"使用 hexo 的 deploy 插件调用 rsync 将静态文件上传到自己服务器的对应目录（static server 你应当已经设置好了）",[65,1598,1600],{"className":477,"code":1599,"language":479,"meta":70,"style":70},"yarn deploy\n",[50,1601,1602],{"__ignoreMap":70},[74,1603,1604,1606],{"class":76,"line":77},[74,1605,1561],{"class":486},[74,1607,1608],{"class":109}," deploy\n",[245,1610],{},[16,1612,1613,1614,1617],{},"注: 本篇博客中引用的所有博客页面均在 ",[50,1615,1616],{},"web.archive.org"," 进行了存档，如后续遇到页面打不开的问题请自行前往查询存档。",[269,1619,1620],{},"html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html pre.shiki code .sLKXg, html code.shiki .sLKXg{--shiki-default:#A626A4;--shiki-dark:#C678DD}html pre.shiki code .s_Sar, html code.shiki .s_Sar{--shiki-default:#0184BC;--shiki-dark:#56B6C2}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html pre.shiki code .sJa8x, html code.shiki .sJa8x{--shiki-default:#E45649;--shiki-dark:#E06C75}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html pre.shiki code .sknuh, html code.shiki .sknuh{--shiki-default:#383A42;--shiki-dark:#56B6C2}",{"title":70,"searchDepth":273,"depth":273,"links":1622},[],{"title":1624,"date":1625,"path":1626,"tags":1627,"body":1629},"使用 VirtScreen 将 Pad 作为副屏","2022-10-04 00:19:20","/2022/10/04/use-virtscreen-to-turn-pad-into-another-screen",[754,1628],"Hardware",{"type":13,"value":1630,"toc":1743},[1631,1636,1645,1647,1650,1658,1673,1676,1683,1689,1692,1695,1702,1705,1713,1716,1719,1722,1725,1728,1731,1734,1737],[40,1632,1633],{},[16,1634,1635],{},"由于浙江工地大专的朝晖尚9宿舍实在是太小了，我没有办法放下一块便携显示屏，所以只能把家中闲置的 Huawei Pad M6 作为自己的副屏。",[16,1637,1638,1639,1644],{},"经过一轮搜索下来，我找到了 ",[32,1640,1643],{"href":1641,"rel":1642},"https://github.com/kbumsik/VirtScreen",[36],"VirtScreen"," 作为工具。",[324,1646,770],{"id":770},[16,1648,1649],{},"在 Archlinux 上，大概有三种以上的方式进行安装:",[16,1651,1652,1653],{},"一、使用 AUR 上的 ",[32,1654,1657],{"href":1655,"rel":1656},"https://aur.archlinux.org/package/virtscreen/",[36],"virtscreen",[16,1659,1660,1661,1664,1665,1668,1669,1672],{},"遇到的唯一一个麻烦是作为依赖之一的 ",[50,1662,1663],{},"python-quamash"," 在 python3.10 上无法直接安装。通过 AUR 的评论区得知，需要将 ",[50,1666,1667],{},"collections.Mapping"," 改为 ",[50,1670,1671],{},"collections.abc.Mapping"," 方可通过安装。",[16,1674,1675],{},"二、使用 dderjoel 的 fork 进行安装",[16,1677,1678,1679],{},"见 ",[32,1680,1681],{"href":1681,"rel":1682},"https://github.com/dderjoel/VirtScreen/blob/master/package/archlinux/PKGBUILD",[36],[16,1684,1685,1686],{},"三、直接通过 appimage 安装，不过需要自己手动安装 ",[50,1687,1688],{},"x11vnc",[324,1690,1691],{"id":1691},"配置",[640,1693,1694],{"id":1694},"系统层",[16,1696,1697,1698,1701],{},"打开软件以后，我们需要先在 ",[50,1699,1700],{},"Display->Virtual Display->Advaced"," 选择 VIRTUAL1 作为显示屏。",[16,1703,1704],{},"如果没有这个选项，可能需要根据自己的显卡做出相应的调整。",[16,1706,1707,1708,267],{},"可以参考 ",[32,1709,1712],{"href":1710,"rel":1711},"https://wiki.archlinux.org/title/Extreme_Multihead#Using_a_virtual_output",[36],"ArchWiki",[640,1714,1715],{"id":1715},"软件层",[16,1717,1718],{},"在这里，我们需要根据我们作为副屏的设备的屏幕分辨率来计算我们需要在 VirtScreen 中设置的分辨率参数。",[16,1720,1721],{},"我的 Huawei Pad M6 是 2560*1600 的分辨率，但 VirtScreen 最高支持只有 1920*1080，所以我们需要选择 1280*800，并开启高分辨率选项。",[16,1723,1724],{},"VNC 那边只需要根据自己的需求设置一下密码即可。",[324,1726,1727],{"id":1727},"使用",[16,1729,1730],{},"在 VirtScreen 的 Display 界面点击 \"Enable Virtual Screen\"，切换到 VNC 界面点击 \"Start VNC Server\"，可以勾选右侧的 \"Auto\"。",[16,1732,1733],{},"Pad 端只需要安装任意一个 VNC 客户端即可，我这里使用的是\"VNC Viewer\"。",[324,1735,1736],{"id":1736},"图片",[16,1738,1739],{},[22,1740],{"alt":1741,"src":1742},"效果图","https://static.031130.xyz/uploads/2024/08/12/633b1bd1ba8f4.webp",{"title":70,"searchDepth":273,"depth":273,"links":1744},[1745,1746,1750,1751],{"id":770,"depth":273,"text":770},{"id":1691,"depth":273,"text":1691,"children":1747},[1748,1749],{"id":1694,"depth":372,"text":1694},{"id":1715,"depth":372,"text":1715},{"id":1727,"depth":273,"text":1727},{"id":1736,"depth":273,"text":1736},{"title":1753,"date":1754,"path":1755,"tags":1756,"body":1757},"在 Archlinux 下使用 l2tp 协议连接校园网","2022-09-29 14:30:46","/2022/09/29/use-l2tp-protocol-to-connect-internet",[282,11],{"type":13,"value":1758,"toc":1833},[1759,1764,1771,1777,1780,1788,1797,1800,1816,1819,1825,1831],[40,1760,1761],{},[16,1762,1763],{},"由于高考爆炸，所以不得不进入浙江工地大专来度过自己接下来四年的人生（希望到时候可以借助学校的力量润出去）。",[16,1765,1766,1767,1770],{},"学校这边由于某些不可描述的原因，将校园卡与宽带捆绑销售，且每次登陆校园网时都需要使用定制的 l2tp 协议客户端进行上网，且该客户端将会禁用用户的无线网卡（",[765,1768,1769],{},"这不明摆着想让我们宿舍每个人都花一次钱","）。",[16,1772,1773],{},[22,1774],{"alt":1775,"src":1776},"学校定制的 l2tp 拨号客户端","https://static.031130.xyz/uploads/2024/08/12/63353e0e1978c.webp",[16,1778,1779],{},"更惨的是，学校仅提供了 Windows 与 MacOS 的客户端。",[16,1781,645,1782,1787],{},[32,1783,1786],{"href":1784,"rel":1785},"https://imbearchild.cyou/",[36],"BearChild"," 的提醒下，我意识到 Linux 下也可以有 l2tp 协议。",[16,1789,1790,1791,1796],{},"谷歌搜索了一番，我在简书上捞到了这篇文章",[32,1792,1795],{"href":1793,"rel":1794},"https://www.jianshu.com/p/85cd5bd3c7a2",[36],"《ubuntu 连校园网 via l2tp》","。不过这显然有些麻烦，我们的客户端不需要 pppoe 拨号，只需要插上网线后连接 l2tp 协议即可联网。",[16,1798,1799],{},"所幸，NetworkManager 非常贴心地为我们提供了 l2tp 的插件，在 Archlinux 下使用如下命令即可完成安装。",[65,1801,1803],{"className":477,"code":1802,"language":479,"meta":70,"style":70},"sudo pacman -S networkmanager-l2tp\n",[50,1804,1805],{"__ignoreMap":70},[74,1806,1807,1809,1811,1813],{"class":76,"line":77},[74,1808,796],{"class":486},[74,1810,799],{"class":109},[74,1812,802],{"class":88},[74,1814,1815],{"class":109}," networkmanager-l2tp\n",[16,1817,1818],{},"安装完成后，就可以在图形化界面下进行我们的设置操作。",[16,1820,1821,1822,1419],{},"由于定制的客户端已经把 l2tp 服务器 ip 写死且显示在界面上了，我们就不需要再去抓包截取服务器 ip，直接使用这边的 ",[50,1823,1824],{},"192.168.115.1",[16,1826,1827],{},[22,1828],{"alt":1829,"src":1830},"KDE 下的 NetworkManager l2tp 设置界面","https://static.031130.xyz/uploads/2024/08/12/63354161dbe28.webp",[269,1832,1073],{},{"title":70,"searchDepth":273,"depth":273,"links":1834},[],{"title":1836,"date":1837,"path":1838,"tags":1839,"body":1840},"为 Element 添加自己喜欢的贴纸","2022-08-10 19:51:19","/2022/08/10/add-sticker-support-for-element",null,{"type":13,"value":1841,"toc":2267},[1842,1847,1850,1864,1872,1875,1897,1901,1904,1920,1924,1927,1948,1951,1954,1979,1986,1990,1997,2014,2017,2028,2034,2037,2040,2042,2062,2066,2069,2076,2082,2088,2094,2101,2107,2110,2247,2253,2256,2259,2264],[40,1843,1844],{},[16,1845,1846],{},"在读这篇文章之前，你应该已经知道 element、matrix 是什么，这部分内容咱就不过多展开讲了。",[324,1848,1849],{"id":1849},"需要准备的",[208,1851,1852,1855,1858,1861],{},[211,1853,1854],{},"PC 端 element",[211,1856,1857],{},"python3.6+ 环境",[211,1859,1860],{},"能够挂静态资源的站点（比如 Github Pages、Gitlab Pages、Vercel 等免费平台的账号）",[211,1862,1863],{},"可能需要能够突破大局域网限制的网络环境",[16,1865,1866,1867],{},"需要用到的项目 ",[32,1868,1871],{"href":1869,"rel":1870},"https://github.com/maunium/stickerpicker",[36],"maunium/stickerpicker",[324,1873,1874],{"id":1874},"克隆主项目",[65,1876,1878],{"className":477,"code":1877,"language":479,"meta":70,"style":70},"git clone https://github.com/maunium/stickerpicker.git && cd stickerpicker\n",[50,1879,1880],{"__ignoreMap":70},[74,1881,1882,1884,1887,1890,1892,1894],{"class":76,"line":77},[74,1883,1444],{"class":486},[74,1885,1886],{"class":109}," clone",[74,1888,1889],{"class":109}," https://github.com/maunium/stickerpicker.git",[74,1891,1505],{"class":80},[74,1893,541],{"class":540},[74,1895,1896],{"class":109}," stickerpicker\n",[324,1898,1900],{"id":1899},"使用-pip-安装依赖","使用 pip 安装依赖",[16,1902,1903],{},"其实本来想直接用包管理去安装这个项目的依赖的，可惜我看了一眼依赖列表，有整整一半的依赖没有被 Fedora 打包，所以干脆就直接用 pip 安装算了。",[65,1905,1907],{"className":477,"code":1906,"language":479,"meta":70,"style":70},"pip install .\n",[50,1908,1909],{"__ignoreMap":70},[74,1910,1911,1914,1917],{"class":76,"line":77},[74,1912,1913],{"class":486},"pip",[74,1915,1916],{"class":109}," install",[74,1918,1919],{"class":109}," .\n",[324,1921,1923],{"id":1922},"选择一将本地图片制成贴纸包","选择一：将本地图片制成贴纸包",[16,1925,1926],{},"在项目根目录下创新一个新的目录。",[65,1928,1930],{"className":477,"code":1929,"language":479,"meta":70,"style":70},"mkdir \u003Cpack directory>\n",[50,1931,1932],{"__ignoreMap":70},[74,1933,1934,1936,1939,1942,1945],{"class":76,"line":77},[74,1935,529],{"class":486},[74,1937,1938],{"class":80}," \u003C",[74,1940,1941],{"class":109},"pack",[74,1943,1944],{"class":109}," director",[74,1946,1947],{"class":80},"y>\n",[16,1949,1950],{},"将需要的图片放入其中。如果需要排序，可以在图片的文件名最前面加上数字标号。",[16,1952,1953],{},"执行命令进行打包",[65,1955,1957],{"className":477,"code":1956,"language":479,"meta":70,"style":70},"sticker-pack \u003Cpack directory> --add-to-index web/packs/\n",[50,1958,1959],{"__ignoreMap":70},[74,1960,1961,1964,1966,1968,1970,1973,1976],{"class":76,"line":77},[74,1962,1963],{"class":486},"sticker-pack",[74,1965,1938],{"class":80},[74,1967,1941],{"class":109},[74,1969,1944],{"class":109},[74,1971,1972],{"class":80},"y> ",[74,1974,1975],{"class":88},"--add-to-index",[74,1977,1978],{"class":109}," web/packs/\n",[16,1980,1981,1982,1985],{},"如果想要给目录贴纸包命名，则可以追加",[50,1983,1984],{},"--title \u003Ccustom title>","，否则将直接设置为目录名",[324,1987,1989],{"id":1988},"选择二从-tg-获取现成的贴纸包","选择二：从 tg 获取现成的贴纸包",[16,1991,1992,1993,1996],{},"项目内已经为我们准备了 ",[50,1994,1995],{},"sticker-import"," 命令来帮助我们直接从 tg 获取表情包，那我们直接收下",[65,1998,2000],{"className":477,"code":1999,"language":479,"meta":70,"style":70},"sticker-import \u003Cpack_url>\n",[50,2001,2002],{"__ignoreMap":70},[74,2003,2004,2006,2008,2011],{"class":76,"line":77},[74,2005,1995],{"class":486},[74,2007,1938],{"class":80},[74,2009,2010],{"class":109},"pack_ur",[74,2012,2013],{"class":80},"l>\n",[16,2015,2016],{},"第一次使用时，会要求我们登陆 matrix 和 tg 账号",[16,2018,2019,2020,2023,2024,2027],{},"matrix 的 ",[50,2021,2022],{},"homeserver"," 和 ",[50,2025,2026],{},"access token"," 可以在 PC 端 element 的设置里找到",[16,2029,2030],{},[22,2031],{"alt":2032,"src":2033},"element 在 pc 端上而设置界面","https://static.031130.xyz/uploads/2024/08/12/62f4dab8c7647.webp",[16,2035,2036],{},"tg 登陆时需要你输入手机号码，或者某一个 tg bot 的 token，这个大家都懂。",[16,2038,2039],{},"运行完成后，贴纸包就被上传到了你所使用的 matrix homeserver 上。",[245,2041],{},[16,2043,2044,2045,2048,2049,2052,2053,2058,2059],{},"接着我们需要做的事情就是将 ",[50,2046,2047],{},"web"," 文件夹部署到 github pages 等做成静态站点，这个比较简单，不再赘述，我这里直接部署在了 ",[50,2050,2051],{},"https://matrix-sticker.zhullyb.top"," 我们下文就直接拿它做演示，看得上的也可以直接拿来用。另外，",[32,2054,2057],{"href":2055,"rel":2056},"https://blog.zhaose.cyou/",[36],"@朝色"," 的 url 也可以直接拿来使用 ",[50,2060,2061],{},"https://sticker.zhaose.cyou/web/",[324,2063,2065],{"id":2064},"添加到-element","添加到 element",[16,2067,2068],{},"这是本篇文章最吊诡的地方，element 其实并没有为我们准备这么一个添加自定义 sticker 的地方，从某种意义上讲，我们是把我们的 sticker 给 hack 进去。",[16,2070,2071,2072,2075],{},"在 element 的 pc 端找到任意一个对话框，输入 ",[50,2073,2074],{},"/devtools"," 并发送",[16,2077,2078],{},[22,2079],{"alt":2080,"src":2081},"如图","https://static.031130.xyz/uploads/2024/08/12/62f4f4d55f4d3.webp",[16,2083,2084,2085],{},"将会出现如下页面，选择 ",[50,2086,2087],{},"Explore account data",[16,2089,2090],{},[22,2091],{"alt":2092,"src":2093},"1660220693791.png","https://static.031130.xyz/uploads/2024/08/12/62f4f5179fd73.webp",[16,2095,2096,2097,2100],{},"找到 ",[50,2098,2099],{},"m.widgets","，如果没有，就点击下图标出的按钮",[16,2102,2103],{},[22,2104],{"alt":2105,"src":2106},"1660220786171.png","https://static.031130.xyz/uploads/2024/08/12/62f4f57459b6f.webp",[16,2108,2109],{},"在新的页面中，填写如下内容，url 那一行应当改为自己部署的页面，并发送请求",[65,2111,2115],{"className":2112,"code":2113,"language":2114,"meta":70,"style":70},"language-json shiki shiki-themes one-light one-dark-pro","{\n    \"stickerpicker\": {\n        \"content\": {\n            \"type\": \"m.stickerpicker\",\n            \"url\": \"https://matrix-sticker.zhullyb.top/?theme=$theme\",\n            \"name\": \"Stickerpicker\",\n            \"data\": {}\n        },\n        \"sender\": \"@you:matrix.server.name\",\n        \"state_key\": \"stickerpicker\",\n        \"type\": \"m.widget\",\n        \"id\": \"stickerpicker\"\n    }\n}\n","json",[50,2116,2117,2122,2130,2137,2151,2163,2175,2183,2188,2200,2212,2225,2236,2242],{"__ignoreMap":70},[74,2118,2119],{"class":76,"line":77},[74,2120,2121],{"class":80},"{\n",[74,2123,2124,2127],{"class":76,"line":273},[74,2125,2126],{"class":84},"    \"stickerpicker\"",[74,2128,2129],{"class":80},": {\n",[74,2131,2132,2135],{"class":76,"line":372},[74,2133,2134],{"class":84},"        \"content\"",[74,2136,2129],{"class":80},[74,2138,2139,2142,2145,2148],{"class":76,"line":381},[74,2140,2141],{"class":84},"            \"type\"",[74,2143,2144],{"class":80},": ",[74,2146,2147],{"class":109},"\"m.stickerpicker\"",[74,2149,2150],{"class":80},",\n",[74,2152,2153,2156,2158,2161],{"class":76,"line":389},[74,2154,2155],{"class":84},"            \"url\"",[74,2157,2144],{"class":80},[74,2159,2160],{"class":109},"\"https://matrix-sticker.zhullyb.top/?theme=$theme\"",[74,2162,2150],{"class":80},[74,2164,2165,2168,2170,2173],{"class":76,"line":397},[74,2166,2167],{"class":84},"            \"name\"",[74,2169,2144],{"class":80},[74,2171,2172],{"class":109},"\"Stickerpicker\"",[74,2174,2150],{"class":80},[74,2176,2177,2180],{"class":76,"line":405},[74,2178,2179],{"class":84},"            \"data\"",[74,2181,2182],{"class":80},": {}\n",[74,2184,2185],{"class":76,"line":413},[74,2186,2187],{"class":80},"        },\n",[74,2189,2190,2193,2195,2198],{"class":76,"line":421},[74,2191,2192],{"class":84},"        \"sender\"",[74,2194,2144],{"class":80},[74,2196,2197],{"class":109},"\"@you:matrix.server.name\"",[74,2199,2150],{"class":80},[74,2201,2202,2205,2207,2210],{"class":76,"line":427},[74,2203,2204],{"class":84},"        \"state_key\"",[74,2206,2144],{"class":80},[74,2208,2209],{"class":109},"\"stickerpicker\"",[74,2211,2150],{"class":80},[74,2213,2215,2218,2220,2223],{"class":76,"line":2214},11,[74,2216,2217],{"class":84},"        \"type\"",[74,2219,2144],{"class":80},[74,2221,2222],{"class":109},"\"m.widget\"",[74,2224,2150],{"class":80},[74,2226,2228,2231,2233],{"class":76,"line":2227},12,[74,2229,2230],{"class":84},"        \"id\"",[74,2232,2144],{"class":80},[74,2234,2235],{"class":109},"\"stickerpicker\"\n",[74,2237,2239],{"class":76,"line":2238},13,[74,2240,2241],{"class":80},"    }\n",[74,2243,2245],{"class":76,"line":2244},14,[74,2246,430],{"class":80},[16,2248,2249],{},[22,2250],{"alt":2251,"src":2252},"发送请求","https://static.031130.xyz/uploads/2024/08/12/62f4f6d9e120e.webp",[16,2254,2255],{},"重启 element，此时就可以享受到自己导入的 sticker 了，手机端的 element 设置也将会被同步。",[16,2257,2258],{},"补一张效果图",[16,2260,2261],{},[22,2262],{"alt":1741,"src":2263},"https://static.031130.xyz/uploads/2024/08/12/62f4f7728b1e6.webp",[269,2265,2266],{},"html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html pre.shiki code .s_Sar, html code.shiki .s_Sar{--shiki-default:#0184BC;--shiki-dark:#56B6C2}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html pre.shiki code .sJa8x, html code.shiki .sJa8x{--shiki-default:#E45649;--shiki-dark:#E06C75}",{"title":70,"searchDepth":273,"depth":273,"links":2268},[2269,2270,2271,2272,2273,2274],{"id":1849,"depth":273,"text":1849},{"id":1874,"depth":273,"text":1874},{"id":1899,"depth":273,"text":1900},{"id":1922,"depth":273,"text":1923},{"id":1988,"depth":273,"text":1989},{"id":2064,"depth":273,"text":2065},{"title":2276,"date":2277,"path":2278,"tags":2279,"body":2282},"nodejs16：是我配不上 openssl 3 咯？","2022-08-04 17:31:49","/2022/08/04/a-fucking-store-about-openssl3-and-nodejs16",[2280,283,2281],"Fedora","OpenSSL",{"type":13,"value":2283,"toc":2425},[2284,2290,2293,2309,2323,2326,2329,2331,2334,2343,2349,2352,2395,2397,2420],[16,2285,2286],{},[22,2287],{"alt":2288,"src":2289},"长毛象的截图.png","https://static.031130.xyz/uploads/2024/08/12/62eba4eabc963.webp",[16,2291,2292],{},"今年上半年升级 Fedora 36 的时候遇到了这个问题。",[16,2294,2295,2296,2299,2300,2305,2306,2308],{},"那会儿很无奈，一直在等 nodejs16 合并提供 ",[50,2297,2298],{},"--openssl-legacy-provider"," 的",[32,2301,2304],{"href":2302,"rel":2303},"https://github.com/nodejs/node/pull/42972",[36],"那个 PR","。nodejs16 是一个 lts 版本，照道理来说，既然要提供 Long-term Support，而 openssl 1 作为它的依赖之一，生命周期结束又在 nodejs16 之前，那是不是应该给 nodejs16 backport 在 nodejs17 上实现的 ",[50,2307,2298],{}," 参数选项呢？否则绝大多数发行版都会在 openssl 1 的生命周期结束之前切换到 openssl 3，那 nodejs16 不就没法用了嘛。",[16,2310,2311,2312,2317,2318,1434],{},"然而，nodejs 在他们的官网上发布的",[32,2313,2316],{"href":2314,"rel":2315},"https://nodejs.org/en/blog/announcements/nodejs16-eol/",[36],"一篇博客","刷新了我的世界观，而此前的那个 PR 甚至一度被关停。（此处有",[32,2319,2322],{"href":2320,"rel":2321},"https://whiteboard-ui8.pages.dev/translation/nodejs-eol-v16-0626/",[36],"寒晶雪提供的中文翻译",[16,2324,2325],{},"博客称他们将会把 nodejs16 的生命周期结束时间提前以防止 openssl 1 生命周期在 nodejs16 生命周期结束之前结束（这种做法甚至还有先例）",[16,2327,2328],{},"很无奈，那会儿有两个 npm 管理的软件没法在 Fedora 36 上编译出来，就一直搁置了下去。",[245,2330],{},[16,2332,2333],{},"不过好在，事情还是有转机的。（要不然就这档子鸡毛蒜皮的小事我也不会专门去写篇博客出来）",[16,2335,2336,2337,2342],{},"前几天我给 ",[32,2338,2341],{"href":2339,"rel":2340},"https://github.com/atpoossfl/repo",[36],"atpoossfl 仓库","打了 rpm 版本的 nvm 以后，意外地发现 nvm 所提供的 nodejs 会自带 openssl。",[16,2344,2345],{},[22,2346],{"alt":2347,"src":2348},"此为 nvm 安装的 nodejs14 目录","https://static.031130.xyz/uploads/2024/08/12/62ebadf02a5b3.webp",[16,2350,2351],{},"所以我们只需要使用 nvm 安装的 nodejs16 即可解决 Fedora36 以后没有 openssl 1 的问题。",[40,2353,2354],{},[16,2355,2356,2357,2360,2361,2364,2365,2368,2369,2372,2373,2378,2379,2381,2382,2385,2386,2389,2390,2023,2392,2394],{},"使用 Fedora 的用户需要注意，Fedora 官方源中的",[50,2358,2359],{},"yarnpkg","在打包时遇到了错误，他们将 ",[50,2362,2363],{},"/usr/lib/node_modules/yarn/bin/yarn.js"," 的 shebang 给改成了 ",[50,2366,2367],{},"#!/usr/bin/node","，应当改回 ",[50,2370,2371],{},"#!/usr/bin/env node","才能让 yarn 正常使用上 nvm 提供的 nodejs；或者干脆添加 ",[32,2374,2377],{"href":2375,"rel":2376},"https://dl.yarnpkg.com/rpm/yarn.repo",[36],"dl.yarnpkg.com"," 提供的 ",[50,2380,1561],{}," 软件包。在写 specfile 的 ",[50,2383,2384],{},"BuildRequires"," 时，可以直接写成 ",[50,2387,2388],{},"/usr/bin/yarn"," 来避免频繁在 ",[50,2391,1561],{},[50,2393,2359],{}," 这两个包名间改动。",[245,2396],{},[16,2398,2399,2400,2023,2403,2406,2407,2409,2410,2415,2416,2419],{},"更好的消息是，nodejs 已经在 ",[50,2401,2402],{},"v16.17.0-proposal",[50,2404,2405],{},"v16.x-staging"," 分支收下了这个为 nodejs16 提供 ",[50,2408,2298],{}," 的 ",[32,2411,2414],{"href":2412,"rel":2413},"https://github.com/nodejs/node/commit/e7b99e8c8d229ee2cc1d657ae44f715e7e5f852f",[36],"commit","。相信在不久的将来，这个 commit 将会进入主线，并在 ",[50,2417,2418],{},"v16.17"," 版本的 nodejs16 上发挥它的作用。",[16,2421,2422],{},[22,2423],{"alt":2414,"src":2424},"https://static.031130.xyz/uploads/2024/08/12/62ebb0927943f.webp",{"title":70,"searchDepth":273,"depth":273,"links":2426},[],133,1769818308526]
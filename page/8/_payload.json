[{"data":1,"prerenderedAt":2623},["ShallowReactive",2],{"randomIndex/page/8/":3,"language-switch-/page/8/-en":4,"index-page-8-zh":5,"posts-total-zh":2622},7,"/en/",[6,187,502,636,725,1175,1328,1563,1772,2260],{"title":7,"date":8,"path":9,"tags":10,"body":15},"【已过期】使用 vercel+supabase 免费部署 umami","2022-11-08 13:37:53","/2022/11/08/free-umami-deploy-plan",[11,12,13,14],"Network","umami","OpenSource Project","Vercel",{"type":16,"value":17,"toc":183},"minimark",[18,33,36,39,42,49,59,74,80,83,89,95,101,107,119,125,128,134,146,152,158,164,167,173],[19,20,21,30],"blockquote",{},[22,23,24,25,29],"p",{},"讲起静态网站的访客统计，我最先使用的是百度统计，但后来转到了 umeng，发现后续的几天百度爬虫的光顾次数反而多了起来。好家伙，使用百度统计相当于把自己网站访问量向百度全盘托出，",[26,27,28],"del",{},"我说我的博客怎么还不被百度收录呢","。",[22,31,32],{},"后来，umeng 推出了新的服务条款，好像是说不再向未备案的站点提供服务，随后不得不转向自部署的开源网站统计程序。",[22,34,35],{},"umami 提供了多种部署方式，在 vps 上可以非常轻松地使用 docker 一键部署，但上次 vps 到期时用 1Mbps 的小水管拖了好久都没有把博客前几个月的访客数据拖下来，一气之下我选择直接丢掉了这些可有可无的数据。",[22,37,38],{},"所以这一次，我决定放弃在自己的 vps 上部署，转去探索免费的部署方案。",[22,40,41],{},"umami 的官方文档上提供了非常多的部署方案，我个人比较喜欢 vercel，本站的随机图片 api 就是挂在 vercel 上的，界面比较简洁，且境内访问还算OK。",[22,43,44],{},[45,46],"img",{"alt":47,"src":48},"umami官方文档提供的部署方案","https://static.031130.xyz/uploads/2024/08/12/6369ee9308dc3.webp",[22,50,51,52,29],{},"但问题在于 vercel 本身并不提供免费的数据库，所以我们不得不去寻找一些长期免费提供数据库的供应商，我选择了 ",[53,54,58],"a",{"href":55,"rel":56},"https://supabase.com/pricing",[57],"nofollow","supabase",[22,60,61,62,66,67,70,71],{},"在下图中选择顶栏的 ",[63,64,65],"strong",{},"Pricing"," 后看到这个 ",[63,68,69],{},"$0/month"," 就",[26,72,73],{},"疯狂戳烂这个 Get Started",[22,75,76],{},[45,77],{"alt":78,"src":79},"supabase价目表","https://static.031130.xyz/uploads/2024/08/12/6369ef8d3451e.webp",[22,81,82],{},"随便填写个项目名然后输入一个足够强大的密码，地区选择美国就行，东部西部无所谓（毕竟我也不知道 vercel 的机房是在东部还是西部）",[22,84,85],{},[45,86],{"alt":87,"src":88},"创建项目ing","https://static.031130.xyz/uploads/2024/08/12/6369f03faba15.webp",[22,90,91,92],{},"看到这个小小的绿标就说明数据库正在初始化(",[26,93,94],{},"你先别急，让我先急",[22,96,97],{},[45,98],{"alt":99,"src":100},"项目初始化中","https://static.031130.xyz/uploads/2024/08/12/6369f0d98a59c.webp",[22,102,103],{},[45,104],{"alt":105,"src":106},"进行一通设置，把网站关闭后直接打入冷宫（x","https://static.031130.xyz/uploads/2024/08/12/6369f209c27aa.webp",[22,108,109,110,115,116],{},"随后打开官方文档，点击其",[53,111,114],{"href":112,"rel":113},"https://umami.is/docs/running-on-vercel",[57],"描述 vercel 那一页","中大大的 ",[63,117,118],{},"Deploy",[22,120,121],{},[45,122],{"alt":123,"src":124},"vercel on Document","https://static.031130.xyz/uploads/2024/08/12/6369f2bda5f78.webp",[22,126,127],{},"初始化过程中，vercel 会要求你创建一个 git 仓库，一般私有库就够了。",[22,129,130],{},[45,131],{"alt":132,"src":133},"创建仓库","https://static.031130.xyz/uploads/2024/08/12/6369f33ccf6d0.webp",[22,135,136,137,141,142,145],{},"随后需要我们设置两个环境变量，第一个 ",[138,139,140],"code",{},"DATABASE_URL"," 就是我们刚刚从 supabase 中复制下来并替换好 password 的 url，第二个 ",[138,143,144],{},"HASH_SALT","需要你随意生成一长串字符串~~（比如你可以找一个新手让他帮你退出 vim~~",[22,147,148],{},[45,149],{"alt":150,"src":151},"设置环境变量","https://static.031130.xyz/uploads/2024/08/12/6369f3adbd34d.webp",[22,153,154,155,157],{},"点击 ",[63,156,118],{}," 并等上两分钟，我们就部署完啦（首页没东西，白屏是正常的",[22,159,160],{},[45,161],{"alt":162,"src":163},"部署成功","https://static.031130.xyz/uploads/2024/08/12/6369f58f6acd4.webp",[22,165,166],{},"来到项目首页，点击任意域名即可访问到我们部署的 umami，不过 vercel 的域名近年来也有被污染的情况，建议在设置里绑定自己的域名。",[22,168,169],{},[45,170],{"alt":171,"src":172},"项目首页","https://static.031130.xyz/uploads/2024/08/12/6369f5ec7a0e2.webp",[22,174,175,176,179,180,182],{},"哦对了，别忘了 umami 的默认用户名密码是",[138,177,178],{},"admin","和",[138,181,12],{},"，别到时候点击进去看到登陆框一脸懵，这是在文档里写过的。",{"title":184,"searchDepth":185,"depth":185,"links":186},"",2,[],{"title":188,"date":189,"path":190,"tags":191,"body":195},"我的博客部署方案","2022-11-04 16:41:28","/2022/11/04/my-blog-plan",[11,192,193,194],"Github Action","Hexo","Blog",{"type":16,"value":196,"toc":500},[197,200,211,223,226,235,241,248,257,486,489,496],[22,198,199],{},"一直以来，我的博客使用的几乎都是 Hexo 框架。",[22,201,202,203,206,207,210],{},"静态博客的一大优点就是可以支持 Serverless 部署，这使得我们可以直接在 Github Pages、Vercel 等平台直接部署上我的博客，如果用上 ",[138,204,205],{},".eu.org"," ",[26,208,209],{},"或者非洲国家免费域名","就可以实现零成本的博客部署。",[22,212,213,214,217,218,222],{},"当然，我现在的博客并非是零成本搭建的，如你所见，我购入了印度国别域名 ",[138,215,216],{},"zhul.in"," 来凑出 ",[219,220,221],"em",{},"竹林"," 的谐音。并在 Github Pages、Vercel 等平台的访问质量每况愈下的情况下又购入了位于香港的 VPS，这就引申出了今天的内容——介绍我博客的部署方案。",[22,224,225],{},"我的博客是使用 HK vps + Github Pages 两处部署实现的，通过 dnspod 免费版的域名分境内/外解析实现了分流。当境内的访客访问我的博客时，他们将会被解析到香港的 vps 上以获得更好的体验，而境外的访客将会被解析到 Github pages，毕竟 Github Pages 在境外的速度并不慢，并且稳定性肯定比我这小鸡要好得多。",[22,227,228,229,234],{},"不过关于通过 dns 解析分流这件事，之前看",[53,230,233],{"href":231,"rel":232},"https://www.cities.ee/read-1553.html",[57],"城南旧事","的博客中有提到可以使用境外的 GeoScaling 完成，其免费支持全球分as、城市、经纬等智能解析，也支持自编辑脚本，看起来以后可以去试一试。",[22,236,237],{},[45,238],{"alt":239,"src":240},"Dnspod截图","https://static.031130.xyz/uploads/2024/08/12/6364d4f46ff1c.webp",[22,242,243,244,247],{},"而 Hexo 框架最被人诟病的一点是更新麻烦。这一点不可否认，使用 ",[138,245,246],{},"hexo generate"," 生成静态网页文件再部署到服务器上的过程在一台新设备上是不小的工作量，它涉及 git、nodejs 的安装，涉及到 ssh key 和 rsync，整个环境的搭建就要废上不小的工夫。",[22,249,250,251,256],{},"在博客内容的更新方面，我选择了将整个 Hexo 的 workdir 全部上传到 github，使用 Github Action 帮助我同时完成静态页面的生成和 Github Pages 及 vps 的部署工作。具体的代码可以直接",[53,252,255],{"href":253,"rel":254},"https://github.com/zhullyb/zhullyb.github.io/blob/master/.github/workflows/deploy.yml",[57],"见我的 GIthub 仓库","，我在这里简单讲下思路。",[258,259,260,271,281,395,425,441,450,471],"ol",{},[261,262,263,264,267,268,29],"li",{},"安装 nodejs",[265,266],"br",{},"这个没什么可说的，有现成的 Github Action 去完成这件事，我这边直接使用了",[138,269,270],{},"actions/setup-node@v2",[261,272,273,274,276,277,280],{},"使用 npm/yarn 安装相关依赖",[265,275],{},"这个直接跑 ",[138,278,279],{},"yarn install"," 即可。",[261,282,283,284,286,287,289,290,295,296],{},"为每个文件重新设定最后修改时间",[265,285],{},"这一步其实是挺重要的，Hexo框架生成每篇文章的最后修改时间的依据是该文件的最后修改时间，而对于 Github Action 的容器来说，每一个文件都刚刚被下载下来，都是最新的，这就会导致你的每一篇文章每次部署时都会被认为刚才修改过。",[265,288],{},"我们这边可以直接使用 git 记录的时间来作为文件的最后修改时间。（参考 ",[53,291,294],{"href":292,"rel":293},"https://mrseawave.github.io/blogs/articles/2021/01/07/ci-hexo-update-time/",[57],"Sea's Blog","）",[297,298,302],"pre",{"className":299,"code":300,"language":301,"meta":184,"style":184},"language-bash shiki shiki-themes one-light one-dark-pro","git ls-files | while read filepath; do touch -d \"$(git log -1 --format='@%ct' $filepath)\" \"$filepath\" && echo \"Fixed: $filepath\"; done\n","bash",[138,303,304],{"__ignoreMap":184},[305,306,309,313,317,321,325,329,332,335,338,341,345,348,350,353,356,359,362,366,369,372,374,377,380,383,386,388,390,392],"span",{"class":307,"line":308},"line",1,[305,310,312],{"class":311},"sAdtL","git",[305,314,316],{"class":315},"sDhpE"," ls-files",[305,318,320],{"class":319},"s5ixo"," | ",[305,322,324],{"class":323},"sLKXg","while",[305,326,328],{"class":327},"s_Sar"," read",[305,330,331],{"class":315}," filepath",[305,333,334],{"class":319},"; ",[305,336,337],{"class":323},"do",[305,339,340],{"class":311}," touch",[305,342,344],{"class":343},"sAGMh"," -d",[305,346,347],{"class":315}," \"$(",[305,349,312],{"class":311},[305,351,352],{"class":315}," log ",[305,354,355],{"class":343},"-1",[305,357,358],{"class":343}," --format=",[305,360,361],{"class":315},"'@%ct' ",[305,363,365],{"class":364},"sJa8x","$filepath",[305,367,368],{"class":315},")\"",[305,370,371],{"class":315}," \"",[305,373,365],{"class":364},[305,375,376],{"class":315},"\"",[305,378,379],{"class":319}," && ",[305,381,382],{"class":327},"echo",[305,384,385],{"class":315}," \"Fixed: ",[305,387,365],{"class":364},[305,389,376],{"class":315},[305,391,334],{"class":319},[305,393,394],{"class":323},"done\n",[261,396,397,398,400,401,404,405],{},"设置时区",[265,399],{},"读我的博客的人应该大多都是东八区的人，那我们应当把 Github Action 容器的时区设置为东八区，和自己 ",[138,402,403],{},"git commit"," 时所使用的设备的时间保持一致，否则某些文章的日期可能会发生一天的偏移。",[297,406,408],{"className":299,"code":407,"language":301,"meta":184,"style":184},"export TZ='Asia/Shanghai'\n",[138,409,410],{"__ignoreMap":184},[305,411,412,415,418,422],{"class":307,"line":308},[305,413,414],{"class":323},"export",[305,416,417],{"class":364}," TZ",[305,419,421],{"class":420},"sknuh","=",[305,423,424],{"class":315},"'Asia/Shanghai'\n",[261,426,427,428],{},"生成静态网页文件",[297,429,431],{"className":299,"code":430,"language":301,"meta":184,"style":184},"yarn build\n",[138,432,433],{"__ignoreMap":184},[305,434,435,438],{"class":307,"line":308},[305,436,437],{"class":311},"yarn",[305,439,440],{"class":315}," build\n",[261,442,443,444,446,447],{},"部署到 Github Pages",[265,445],{},"使用 ",[138,448,449],{},"peaceiris/actions-gh-pages@v3",[261,451,452,453,455,456,458,462,464,465,470],{},"初始化 Github Action 容器上的 ssh 私钥",[265,454],{},"应当在 Github 仓库的设置里先新建一个 secret，填入自己的 ssh 私钥（更加标准的做法应当是为 github action 专门生成一对 ssh 密钥，将公钥上传到自己的 vps，将私钥上传到 Github 仓库的 secret 中）。",[265,457],{},[45,459],{"alt":460,"src":461},"github secret setting","https://static.031130.xyz/uploads/2024/08/12/6364dbbfeb8f6.webp",[265,463],{},"我这边直接从",[53,466,469],{"href":467,"rel":468},"https://blog.m-l.cc/2021/07/06/yong-github-actions-bu-shu-hexo/",[57],"点墨阁","那边抄了点代码直接用。",[261,472,473,474],{},"使用 hexo 的 deploy 插件调用 rsync 将静态文件上传到自己服务器的对应目录（static server 你应当已经设置好了）",[297,475,477],{"className":299,"code":476,"language":301,"meta":184,"style":184},"yarn deploy\n",[138,478,479],{"__ignoreMap":184},[305,480,481,483],{"class":307,"line":308},[305,482,437],{"class":311},[305,484,485],{"class":315}," deploy\n",[487,488],"hr",{},[22,490,491,492,495],{},"注: 本篇博客中引用的所有博客页面均在 ",[138,493,494],{},"web.archive.org"," 进行了存档，如后续遇到页面打不开的问题请自行前往查询存档。",[497,498,499],"style",{},"html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html pre.shiki code .sLKXg, html code.shiki .sLKXg{--shiki-default:#A626A4;--shiki-dark:#C678DD}html pre.shiki code .s_Sar, html code.shiki .s_Sar{--shiki-default:#0184BC;--shiki-dark:#56B6C2}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html pre.shiki code .sJa8x, html code.shiki .sJa8x{--shiki-default:#E45649;--shiki-dark:#E06C75}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html pre.shiki code .sknuh, html code.shiki .sknuh{--shiki-default:#383A42;--shiki-dark:#56B6C2}",{"title":184,"searchDepth":185,"depth":185,"links":501},[],{"title":503,"date":504,"path":505,"tags":506,"body":509},"使用 VirtScreen 将 Pad 作为副屏","2022-10-04 00:19:20","/2022/10/04/use-virtscreen-to-turn-pad-into-another-screen",[507,508],"Linux","Hardware",{"type":16,"value":510,"toc":626},[511,516,525,529,532,540,555,558,565,571,574,578,585,588,596,599,602,605,608,611,614,617,620],[19,512,513],{},[22,514,515],{},"由于浙江工地大专的朝晖尚9宿舍实在是太小了，我没有办法放下一块便携显示屏，所以只能把家中闲置的 Huawei Pad M6 作为自己的副屏。",[22,517,518,519,524],{},"经过一轮搜索下来，我找到了 ",[53,520,523],{"href":521,"rel":522},"https://github.com/kbumsik/VirtScreen",[57],"VirtScreen"," 作为工具。",[526,527,528],"h2",{"id":528},"安装",[22,530,531],{},"在 Archlinux 上，大概有三种以上的方式进行安装:",[22,533,534,535],{},"一、使用 AUR 上的 ",[53,536,539],{"href":537,"rel":538},"https://aur.archlinux.org/package/virtscreen/",[57],"virtscreen",[22,541,542,543,546,547,550,551,554],{},"遇到的唯一一个麻烦是作为依赖之一的 ",[138,544,545],{},"python-quamash"," 在 python3.10 上无法直接安装。通过 AUR 的评论区得知，需要将 ",[138,548,549],{},"collections.Mapping"," 改为 ",[138,552,553],{},"collections.abc.Mapping"," 方可通过安装。",[22,556,557],{},"二、使用 dderjoel 的 fork 进行安装",[22,559,560,561],{},"见 ",[53,562,563],{"href":563,"rel":564},"https://github.com/dderjoel/VirtScreen/blob/master/package/archlinux/PKGBUILD",[57],[22,566,567,568],{},"三、直接通过 appimage 安装，不过需要自己手动安装 ",[138,569,570],{},"x11vnc",[526,572,573],{"id":573},"配置",[575,576,577],"h3",{"id":577},"系统层",[22,579,580,581,584],{},"打开软件以后，我们需要先在 ",[138,582,583],{},"Display->Virtual Display->Advaced"," 选择 VIRTUAL1 作为显示屏。",[22,586,587],{},"如果没有这个选项，可能需要根据自己的显卡做出相应的调整。",[22,589,590,591,29],{},"可以参考 ",[53,592,595],{"href":593,"rel":594},"https://wiki.archlinux.org/title/Extreme_Multihead#Using_a_virtual_output",[57],"ArchWiki",[575,597,598],{"id":598},"软件层",[22,600,601],{},"在这里，我们需要根据我们作为副屏的设备的屏幕分辨率来计算我们需要在 VirtScreen 中设置的分辨率参数。",[22,603,604],{},"我的 Huawei Pad M6 是 2560*1600 的分辨率，但 VirtScreen 最高支持只有 1920*1080，所以我们需要选择 1280*800，并开启高分辨率选项。",[22,606,607],{},"VNC 那边只需要根据自己的需求设置一下密码即可。",[526,609,610],{"id":610},"使用",[22,612,613],{},"在 VirtScreen 的 Display 界面点击 \"Enable Virtual Screen\"，切换到 VNC 界面点击 \"Start VNC Server\"，可以勾选右侧的 \"Auto\"。",[22,615,616],{},"Pad 端只需要安装任意一个 VNC 客户端即可，我这里使用的是\"VNC Viewer\"。",[526,618,619],{"id":619},"图片",[22,621,622],{},[45,623],{"alt":624,"src":625},"效果图","https://static.031130.xyz/uploads/2024/08/12/633b1bd1ba8f4.webp",{"title":184,"searchDepth":185,"depth":185,"links":627},[628,629,634,635],{"id":528,"depth":185,"text":528},{"id":573,"depth":185,"text":573,"children":630},[631,633],{"id":577,"depth":632,"text":577},3,{"id":598,"depth":632,"text":598},{"id":610,"depth":185,"text":610},{"id":619,"depth":185,"text":619},{"title":637,"date":638,"path":639,"tags":640,"body":642},"在 Archlinux 下使用 l2tp 协议连接校园网","2022-09-29 14:30:46","/2022/09/29/use-l2tp-protocol-to-connect-internet",[641,11],"Archlinux",{"type":16,"value":643,"toc":723},[644,649,656,662,665,674,683,686,705,708,714,720],[19,645,646],{},[22,647,648],{},"由于高考爆炸，所以不得不进入浙江工地大专来度过自己接下来四年的人生（希望到时候可以借助学校的力量润出去）。",[22,650,651,652,655],{},"学校这边由于某些不可描述的原因，将校园卡与宽带捆绑销售，且每次登陆校园网时都需要使用定制的 l2tp 协议客户端进行上网，且该客户端将会禁用用户的无线网卡（",[26,653,654],{},"这不明摆着想让我们宿舍每个人都花一次钱","）。",[22,657,658],{},[45,659],{"alt":660,"src":661},"学校定制的 l2tp 拨号客户端","https://static.031130.xyz/uploads/2024/08/12/63353e0e1978c.webp",[22,663,664],{},"更惨的是，学校仅提供了 Windows 与 MacOS 的客户端。",[22,666,667,668,673],{},"在 ",[53,669,672],{"href":670,"rel":671},"https://imbearchild.cyou/",[57],"BearChild"," 的提醒下，我意识到 Linux 下也可以有 l2tp 协议。",[22,675,676,677,682],{},"谷歌搜索了一番，我在简书上捞到了这篇文章",[53,678,681],{"href":679,"rel":680},"https://www.jianshu.com/p/85cd5bd3c7a2",[57],"《ubuntu 连校园网 via l2tp》","。不过这显然有些麻烦，我们的客户端不需要 pppoe 拨号，只需要插上网线后连接 l2tp 协议即可联网。",[22,684,685],{},"所幸，NetworkManager 非常贴心地为我们提供了 l2tp 的插件，在 Archlinux 下使用如下命令即可完成安装。",[297,687,689],{"className":299,"code":688,"language":301,"meta":184,"style":184},"sudo pacman -S networkmanager-l2tp\n",[138,690,691],{"__ignoreMap":184},[305,692,693,696,699,702],{"class":307,"line":308},[305,694,695],{"class":311},"sudo",[305,697,698],{"class":315}," pacman",[305,700,701],{"class":343}," -S",[305,703,704],{"class":315}," networkmanager-l2tp\n",[22,706,707],{},"安装完成后，就可以在图形化界面下进行我们的设置操作。",[22,709,710,711,280],{},"由于定制的客户端已经把 l2tp 服务器 ip 写死且显示在界面上了，我们就不需要再去抓包截取服务器 ip，直接使用这边的 ",[138,712,713],{},"192.168.115.1",[22,715,716],{},[45,717],{"alt":718,"src":719},"KDE 下的 NetworkManager l2tp 设置界面","https://static.031130.xyz/uploads/2024/08/12/63354161dbe28.webp",[497,721,722],{},"html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}",{"title":184,"searchDepth":185,"depth":185,"links":724},[],{"title":726,"date":727,"path":728,"tags":729,"body":730},"为 Element 添加自己喜欢的贴纸","2022-08-10 19:51:19","/2022/08/10/add-sticker-support-for-element",null,{"type":16,"value":731,"toc":1167},[732,737,740,755,763,766,789,793,796,812,816,819,841,844,847,872,879,883,890,907,910,921,927,930,933,935,955,959,962,969,975,981,987,994,1000,1003,1147,1153,1156,1159,1164],[19,733,734],{},[22,735,736],{},"在读这篇文章之前，你应该已经知道 element、matrix 是什么，这部分内容咱就不过多展开讲了。",[526,738,739],{"id":739},"需要准备的",[741,742,743,746,749,752],"ul",{},[261,744,745],{},"PC 端 element",[261,747,748],{},"python3.6+ 环境",[261,750,751],{},"能够挂静态资源的站点（比如 Github Pages、Gitlab Pages、Vercel 等免费平台的账号）",[261,753,754],{},"可能需要能够突破大局域网限制的网络环境",[22,756,757,758],{},"需要用到的项目 ",[53,759,762],{"href":760,"rel":761},"https://github.com/maunium/stickerpicker",[57],"maunium/stickerpicker",[526,764,765],{"id":765},"克隆主项目",[297,767,769],{"className":299,"code":768,"language":301,"meta":184,"style":184},"git clone https://github.com/maunium/stickerpicker.git && cd stickerpicker\n",[138,770,771],{"__ignoreMap":184},[305,772,773,775,778,781,783,786],{"class":307,"line":308},[305,774,312],{"class":311},[305,776,777],{"class":315}," clone",[305,779,780],{"class":315}," https://github.com/maunium/stickerpicker.git",[305,782,379],{"class":319},[305,784,785],{"class":327},"cd",[305,787,788],{"class":315}," stickerpicker\n",[526,790,792],{"id":791},"使用-pip-安装依赖","使用 pip 安装依赖",[22,794,795],{},"其实本来想直接用包管理去安装这个项目的依赖的，可惜我看了一眼依赖列表，有整整一半的依赖没有被 Fedora 打包，所以干脆就直接用 pip 安装算了。",[297,797,799],{"className":299,"code":798,"language":301,"meta":184,"style":184},"pip install .\n",[138,800,801],{"__ignoreMap":184},[305,802,803,806,809],{"class":307,"line":308},[305,804,805],{"class":311},"pip",[305,807,808],{"class":315}," install",[305,810,811],{"class":315}," .\n",[526,813,815],{"id":814},"选择一将本地图片制成贴纸包","选择一：将本地图片制成贴纸包",[22,817,818],{},"在项目根目录下创新一个新的目录。",[297,820,822],{"className":299,"code":821,"language":301,"meta":184,"style":184},"mkdir \u003Cpack directory>\n",[138,823,824],{"__ignoreMap":184},[305,825,826,829,832,835,838],{"class":307,"line":308},[305,827,828],{"class":311},"mkdir",[305,830,831],{"class":319}," \u003C",[305,833,834],{"class":315},"pack",[305,836,837],{"class":315}," director",[305,839,840],{"class":319},"y>\n",[22,842,843],{},"将需要的图片放入其中。如果需要排序，可以在图片的文件名最前面加上数字标号。",[22,845,846],{},"执行命令进行打包",[297,848,850],{"className":299,"code":849,"language":301,"meta":184,"style":184},"sticker-pack \u003Cpack directory> --add-to-index web/packs/\n",[138,851,852],{"__ignoreMap":184},[305,853,854,857,859,861,863,866,869],{"class":307,"line":308},[305,855,856],{"class":311},"sticker-pack",[305,858,831],{"class":319},[305,860,834],{"class":315},[305,862,837],{"class":315},[305,864,865],{"class":319},"y> ",[305,867,868],{"class":343},"--add-to-index",[305,870,871],{"class":315}," web/packs/\n",[22,873,874,875,878],{},"如果想要给目录贴纸包命名，则可以追加",[138,876,877],{},"--title \u003Ccustom title>","，否则将直接设置为目录名",[526,880,882],{"id":881},"选择二从-tg-获取现成的贴纸包","选择二：从 tg 获取现成的贴纸包",[22,884,885,886,889],{},"项目内已经为我们准备了 ",[138,887,888],{},"sticker-import"," 命令来帮助我们直接从 tg 获取表情包，那我们直接收下",[297,891,893],{"className":299,"code":892,"language":301,"meta":184,"style":184},"sticker-import \u003Cpack_url>\n",[138,894,895],{"__ignoreMap":184},[305,896,897,899,901,904],{"class":307,"line":308},[305,898,888],{"class":311},[305,900,831],{"class":319},[305,902,903],{"class":315},"pack_ur",[305,905,906],{"class":319},"l>\n",[22,908,909],{},"第一次使用时，会要求我们登陆 matrix 和 tg 账号",[22,911,912,913,916,917,920],{},"matrix 的 ",[138,914,915],{},"homeserver"," 和 ",[138,918,919],{},"access token"," 可以在 PC 端 element 的设置里找到",[22,922,923],{},[45,924],{"alt":925,"src":926},"element 在 pc 端上而设置界面","https://static.031130.xyz/uploads/2024/08/12/62f4dab8c7647.webp",[22,928,929],{},"tg 登陆时需要你输入手机号码，或者某一个 tg bot 的 token，这个大家都懂。",[22,931,932],{},"运行完成后，贴纸包就被上传到了你所使用的 matrix homeserver 上。",[487,934],{},[22,936,937,938,941,942,945,946,951,952],{},"接着我们需要做的事情就是将 ",[138,939,940],{},"web"," 文件夹部署到 github pages 等做成静态站点，这个比较简单，不再赘述，我这里直接部署在了 ",[138,943,944],{},"https://matrix-sticker.zhullyb.top"," 我们下文就直接拿它做演示，看得上的也可以直接拿来用。另外，",[53,947,950],{"href":948,"rel":949},"https://blog.zhaose.cyou/",[57],"@朝色"," 的 url 也可以直接拿来使用 ",[138,953,954],{},"https://sticker.zhaose.cyou/web/",[526,956,958],{"id":957},"添加到-element","添加到 element",[22,960,961],{},"这是本篇文章最吊诡的地方，element 其实并没有为我们准备这么一个添加自定义 sticker 的地方，从某种意义上讲，我们是把我们的 sticker 给 hack 进去。",[22,963,964,965,968],{},"在 element 的 pc 端找到任意一个对话框，输入 ",[138,966,967],{},"/devtools"," 并发送",[22,970,971],{},[45,972],{"alt":973,"src":974},"如图","https://static.031130.xyz/uploads/2024/08/12/62f4f4d55f4d3.webp",[22,976,977,978],{},"将会出现如下页面，选择 ",[138,979,980],{},"Explore account data",[22,982,983],{},[45,984],{"alt":985,"src":986},"1660220693791.png","https://static.031130.xyz/uploads/2024/08/12/62f4f5179fd73.webp",[22,988,989,990,993],{},"找到 ",[138,991,992],{},"m.widgets","，如果没有，就点击下图标出的按钮",[22,995,996],{},[45,997],{"alt":998,"src":999},"1660220786171.png","https://static.031130.xyz/uploads/2024/08/12/62f4f57459b6f.webp",[22,1001,1002],{},"在新的页面中，填写如下内容，url 那一行应当改为自己部署的页面，并发送请求",[297,1004,1008],{"className":1005,"code":1006,"language":1007,"meta":184,"style":184},"language-json shiki shiki-themes one-light one-dark-pro","{\n    \"stickerpicker\": {\n        \"content\": {\n            \"type\": \"m.stickerpicker\",\n            \"url\": \"https://matrix-sticker.zhullyb.top/?theme=$theme\",\n            \"name\": \"Stickerpicker\",\n            \"data\": {}\n        },\n        \"sender\": \"@you:matrix.server.name\",\n        \"state_key\": \"stickerpicker\",\n        \"type\": \"m.widget\",\n        \"id\": \"stickerpicker\"\n    }\n}\n","json",[138,1009,1010,1015,1023,1030,1045,1058,1071,1079,1085,1098,1111,1124,1135,1141],{"__ignoreMap":184},[305,1011,1012],{"class":307,"line":308},[305,1013,1014],{"class":319},"{\n",[305,1016,1017,1020],{"class":307,"line":185},[305,1018,1019],{"class":364},"    \"stickerpicker\"",[305,1021,1022],{"class":319},": {\n",[305,1024,1025,1028],{"class":307,"line":632},[305,1026,1027],{"class":364},"        \"content\"",[305,1029,1022],{"class":319},[305,1031,1033,1036,1039,1042],{"class":307,"line":1032},4,[305,1034,1035],{"class":364},"            \"type\"",[305,1037,1038],{"class":319},": ",[305,1040,1041],{"class":315},"\"m.stickerpicker\"",[305,1043,1044],{"class":319},",\n",[305,1046,1048,1051,1053,1056],{"class":307,"line":1047},5,[305,1049,1050],{"class":364},"            \"url\"",[305,1052,1038],{"class":319},[305,1054,1055],{"class":315},"\"https://matrix-sticker.zhullyb.top/?theme=$theme\"",[305,1057,1044],{"class":319},[305,1059,1061,1064,1066,1069],{"class":307,"line":1060},6,[305,1062,1063],{"class":364},"            \"name\"",[305,1065,1038],{"class":319},[305,1067,1068],{"class":315},"\"Stickerpicker\"",[305,1070,1044],{"class":319},[305,1072,1073,1076],{"class":307,"line":3},[305,1074,1075],{"class":364},"            \"data\"",[305,1077,1078],{"class":319},": {}\n",[305,1080,1082],{"class":307,"line":1081},8,[305,1083,1084],{"class":319},"        },\n",[305,1086,1088,1091,1093,1096],{"class":307,"line":1087},9,[305,1089,1090],{"class":364},"        \"sender\"",[305,1092,1038],{"class":319},[305,1094,1095],{"class":315},"\"@you:matrix.server.name\"",[305,1097,1044],{"class":319},[305,1099,1101,1104,1106,1109],{"class":307,"line":1100},10,[305,1102,1103],{"class":364},"        \"state_key\"",[305,1105,1038],{"class":319},[305,1107,1108],{"class":315},"\"stickerpicker\"",[305,1110,1044],{"class":319},[305,1112,1114,1117,1119,1122],{"class":307,"line":1113},11,[305,1115,1116],{"class":364},"        \"type\"",[305,1118,1038],{"class":319},[305,1120,1121],{"class":315},"\"m.widget\"",[305,1123,1044],{"class":319},[305,1125,1127,1130,1132],{"class":307,"line":1126},12,[305,1128,1129],{"class":364},"        \"id\"",[305,1131,1038],{"class":319},[305,1133,1134],{"class":315},"\"stickerpicker\"\n",[305,1136,1138],{"class":307,"line":1137},13,[305,1139,1140],{"class":319},"    }\n",[305,1142,1144],{"class":307,"line":1143},14,[305,1145,1146],{"class":319},"}\n",[22,1148,1149],{},[45,1150],{"alt":1151,"src":1152},"发送请求","https://static.031130.xyz/uploads/2024/08/12/62f4f6d9e120e.webp",[22,1154,1155],{},"重启 element，此时就可以享受到自己导入的 sticker 了，手机端的 element 设置也将会被同步。",[22,1157,1158],{},"补一张效果图",[22,1160,1161],{},[45,1162],{"alt":624,"src":1163},"https://static.031130.xyz/uploads/2024/08/12/62f4f7728b1e6.webp",[497,1165,1166],{},"html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html pre.shiki code .s_Sar, html code.shiki .s_Sar{--shiki-default:#0184BC;--shiki-dark:#56B6C2}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html pre.shiki code .sJa8x, html code.shiki .sJa8x{--shiki-default:#E45649;--shiki-dark:#E06C75}",{"title":184,"searchDepth":185,"depth":185,"links":1168},[1169,1170,1171,1172,1173,1174],{"id":739,"depth":185,"text":739},{"id":765,"depth":185,"text":765},{"id":791,"depth":185,"text":792},{"id":814,"depth":185,"text":815},{"id":881,"depth":185,"text":882},{"id":957,"depth":185,"text":958},{"title":1176,"date":1177,"path":1178,"tags":1179,"body":1183},"nodejs16：是我配不上 openssl 3 咯？","2022-08-04 17:31:49","/2022/08/04/a-fucking-store-about-openssl3-and-nodejs16",[1180,1181,1182],"Fedora","nodejs","OpenSSL",{"type":16,"value":1184,"toc":1326},[1185,1191,1194,1210,1224,1227,1230,1232,1235,1244,1250,1253,1296,1298,1321],[22,1186,1187],{},[45,1188],{"alt":1189,"src":1190},"长毛象的截图.png","https://static.031130.xyz/uploads/2024/08/12/62eba4eabc963.webp",[22,1192,1193],{},"今年上半年升级 Fedora 36 的时候遇到了这个问题。",[22,1195,1196,1197,1200,1201,1206,1207,1209],{},"那会儿很无奈，一直在等 nodejs16 合并提供 ",[138,1198,1199],{},"--openssl-legacy-provider"," 的",[53,1202,1205],{"href":1203,"rel":1204},"https://github.com/nodejs/node/pull/42972",[57],"那个 PR","。nodejs16 是一个 lts 版本，照道理来说，既然要提供 Long-term Support，而 openssl 1 作为它的依赖之一，生命周期结束又在 nodejs16 之前，那是不是应该给 nodejs16 backport 在 nodejs17 上实现的 ",[138,1208,1199],{}," 参数选项呢？否则绝大多数发行版都会在 openssl 1 的生命周期结束之前切换到 openssl 3，那 nodejs16 不就没法用了嘛。",[22,1211,1212,1213,1218,1219,295],{},"然而，nodejs 在他们的官网上发布的",[53,1214,1217],{"href":1215,"rel":1216},"https://nodejs.org/en/blog/announcements/nodejs16-eol/",[57],"一篇博客","刷新了我的世界观，而此前的那个 PR 甚至一度被关停。（此处有",[53,1220,1223],{"href":1221,"rel":1222},"https://whiteboard-ui8.pages.dev/translation/nodejs-eol-v16-0626/",[57],"寒晶雪提供的中文翻译",[22,1225,1226],{},"博客称他们将会把 nodejs16 的生命周期结束时间提前以防止 openssl 1 生命周期在 nodejs16 生命周期结束之前结束（这种做法甚至还有先例）",[22,1228,1229],{},"很无奈，那会儿有两个 npm 管理的软件没法在 Fedora 36 上编译出来，就一直搁置了下去。",[487,1231],{},[22,1233,1234],{},"不过好在，事情还是有转机的。（要不然就这档子鸡毛蒜皮的小事我也不会专门去写篇博客出来）",[22,1236,1237,1238,1243],{},"前几天我给 ",[53,1239,1242],{"href":1240,"rel":1241},"https://github.com/atpoossfl/repo",[57],"atpoossfl 仓库","打了 rpm 版本的 nvm 以后，意外地发现 nvm 所提供的 nodejs 会自带 openssl。",[22,1245,1246],{},[45,1247],{"alt":1248,"src":1249},"此为 nvm 安装的 nodejs14 目录","https://static.031130.xyz/uploads/2024/08/12/62ebadf02a5b3.webp",[22,1251,1252],{},"所以我们只需要使用 nvm 安装的 nodejs16 即可解决 Fedora36 以后没有 openssl 1 的问题。",[19,1254,1255],{},[22,1256,1257,1258,1261,1262,1265,1266,1269,1270,1273,1274,1279,1280,1282,1283,1286,1287,1290,1291,916,1293,1295],{},"使用 Fedora 的用户需要注意，Fedora 官方源中的",[138,1259,1260],{},"yarnpkg","在打包时遇到了错误，他们将 ",[138,1263,1264],{},"/usr/lib/node_modules/yarn/bin/yarn.js"," 的 shebang 给改成了 ",[138,1267,1268],{},"#!/usr/bin/node","，应当改回 ",[138,1271,1272],{},"#!/usr/bin/env node","才能让 yarn 正常使用上 nvm 提供的 nodejs；或者干脆添加 ",[53,1275,1278],{"href":1276,"rel":1277},"https://dl.yarnpkg.com/rpm/yarn.repo",[57],"dl.yarnpkg.com"," 提供的 ",[138,1281,437],{}," 软件包。在写 specfile 的 ",[138,1284,1285],{},"BuildRequires"," 时，可以直接写成 ",[138,1288,1289],{},"/usr/bin/yarn"," 来避免频繁在 ",[138,1292,437],{},[138,1294,1260],{}," 这两个包名间改动。",[487,1297],{},[22,1299,1300,1301,916,1304,1307,1308,1310,1311,1316,1317,1320],{},"更好的消息是，nodejs 已经在 ",[138,1302,1303],{},"v16.17.0-proposal",[138,1305,1306],{},"v16.x-staging"," 分支收下了这个为 nodejs16 提供 ",[138,1309,1199],{}," 的 ",[53,1312,1315],{"href":1313,"rel":1314},"https://github.com/nodejs/node/commit/e7b99e8c8d229ee2cc1d657ae44f715e7e5f852f",[57],"commit","。相信在不久的将来，这个 commit 将会进入主线，并在 ",[138,1318,1319],{},"v16.17"," 版本的 nodejs16 上发挥它的作用。",[22,1322,1323],{},[45,1324],{"alt":1315,"src":1325},"https://static.031130.xyz/uploads/2024/08/12/62ebb0927943f.webp",{"title":184,"searchDepth":185,"depth":185,"links":1327},[],{"title":1329,"date":1330,"path":1331,"tags":1332,"body":1334},"如何拯救失声的 hollywood","2022-07-25 11:25:44","/2022/07/25/restore-the-sound-of-hollywood",[1333,507],"Fun",{"type":16,"value":1335,"toc":1561},[1336,1339,1348,1351,1356,1359,1362,1370,1381,1401,1412,1421,1424,1438,1555,1558],[22,1337,1338],{},"我刚开始接触 Linux 下的 hollywood 时，我记得它运行时是有声音的，应该是 007 的主题音乐，如今再次装上 hollywood，却发现音乐没了。",[22,1340,1341,1342,1347],{},"在 Github 找到 hollywood，发现有一个 ",[53,1343,1346],{"href":1344,"rel":1345},"https://github.com/dustinkirkland/hollywood/issues/58",[57],"issue"," 也提到了这个问题。",[22,1349,1350],{},"原作者在该 issue 中回复道",[19,1352,1353],{},[22,1354,1355],{},"没错，它只是一段视频，音频受到版权保护。",[22,1357,1358],{},"所以不难看出，作者因为版权问题而去掉了音频，进而导致 hollywood 失声。但我们作为用户，是不是可以想办法获取到老版本中那段带有音频的 mp4 文件呢？",[22,1360,1361],{},"答案是肯定的。",[22,1363,1364,1365,29],{},"得益于 git 的版本控制特色，在 hollywood 的 github 仓库中，我们可以找到原来的 ",[53,1366,1369],{"href":1367,"rel":1368},"https://github.com/dustinkirkland/hollywood/blob/67839229f878a08521885e9fc05dd2d3ba10ddd1/share/hollywood/mi.mp4",[57],"mp4 文件",[22,1371,1372,1373,1376,1377,1380],{},"下载这个 mp4 文件后，我们将其放入 ",[138,1374,1375],{},"/usr/share/hollywood/"," 路径下，重命名为 ",[138,1378,1379],{},"soundwave.mp4","，并确保其被正确设定为 0644 权限。",[297,1382,1384],{"className":299,"code":1383,"language":301,"meta":184,"style":184},"sudo install -Dm644 ./mi.mp4 /usr/share/hollywood/soundwave.mp4\n",[138,1385,1386],{"__ignoreMap":184},[305,1387,1388,1390,1392,1395,1398],{"class":307,"line":308},[305,1389,695],{"class":311},[305,1391,808],{"class":315},[305,1393,1394],{"class":343}," -Dm644",[305,1396,1397],{"class":315}," ./mi.mp4",[305,1399,1400],{"class":315}," /usr/share/hollywood/soundwave.mp4\n",[22,1402,1403,1404,1407,1408,1411],{},"接下来试着跑一跑 ",[138,1405,1406],{},"hollywood","，发现依然没有声音。再次查阅源码，发现缺少了 ",[138,1409,1410],{},"mplayer"," 这个依赖。",[22,1413,1414,1415,1417,1418,1420],{},"使用包管理器安装 ",[138,1416,1410],{}," 后，运行 ",[138,1419,1406],{}," 就可以听到声音了。",[22,1422,1423],{},"然而，你觉不觉得这个音乐。。。听上去怪怪的。。。",[22,1425,1426,1427,206,1429,1434,1435],{},"没错，作者在去掉音频后，给 ",[138,1428,1379],{},[53,1430,1433],{"href":1431,"rel":1432},"https://github.com/dustinkirkland/hollywood/commit/95f77d570d86cd8b8fe0e0939049609f81d1bae0#diff-3e2bf53af1a38136a109ac4fa1b11189e7b6fcd4385e1c68683093f73c6ac485",[57],"设定了加速播放","。而我们现在需要这段视频被原速播放。编辑 ",[138,1436,1437],{},"/usr/lib/hollywood/mplayer",[297,1439,1443],{"className":1440,"code":1441,"language":1442,"meta":184,"style":184},"language-diff shiki shiki-themes one-light one-dark-pro","#!/bin/bash\n#\n# Copyright 2014 Dustin Kirkland \u003Cdustin.kirkland@gmail.com>\n#\n# Licensed under the Apache License, Version 2.0 (the \"License\");\n# you may not use this file except in compliance with the License.\n# You may obtain a copy of the License at\n#\n#    http://www.apache.org/licenses/LICENSE-2.0\n#\n# Unless required by applicable law or agreed to in writing, software\n# distributed under the License is distributed on an \"AS IS\" BASIS,\n# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n# See the License for the specific language governing permissions and\n# limitations under the License.\ncommand -v mplayer >/dev/null 2>&1 || exit 1\ntrap \"pkill -f -9 lib/hollywood/ >/dev/null 2>&1; exit\" INT\nPKG=hollywood\ndir=\"$(dirname $0)/../../share/$PKG\"\n-DISPLAY= mplayer -vo caca -loop 0 -ss $((RANDOM % 100)) -speed 100 $MPLAYER_OPTS $dir/soundwave.mp4\n+DISPLAY= mplayer -vo caca -loop 0 $MPLAYER_OPTS $dir/soundwave.mp4\n","diff",[138,1444,1445,1451,1456,1461,1465,1470,1475,1480,1484,1489,1493,1498,1503,1508,1513,1519,1525,1531,1537,1543,1549],{"__ignoreMap":184},[305,1446,1447],{"class":307,"line":308},[305,1448,1450],{"class":1449},"sW2Sy","#!/bin/bash\n",[305,1452,1453],{"class":307,"line":185},[305,1454,1455],{"class":1449},"#\n",[305,1457,1458],{"class":307,"line":632},[305,1459,1460],{"class":1449},"# Copyright 2014 Dustin Kirkland \u003Cdustin.kirkland@gmail.com>\n",[305,1462,1463],{"class":307,"line":1032},[305,1464,1455],{"class":1449},[305,1466,1467],{"class":307,"line":1047},[305,1468,1469],{"class":1449},"# Licensed under the Apache License, Version 2.0 (the \"License\");\n",[305,1471,1472],{"class":307,"line":1060},[305,1473,1474],{"class":1449},"# you may not use this file except in compliance with the License.\n",[305,1476,1477],{"class":307,"line":3},[305,1478,1479],{"class":1449},"# You may obtain a copy of the License at\n",[305,1481,1482],{"class":307,"line":1081},[305,1483,1455],{"class":1449},[305,1485,1486],{"class":307,"line":1087},[305,1487,1488],{"class":1449},"#    http://www.apache.org/licenses/LICENSE-2.0\n",[305,1490,1491],{"class":307,"line":1100},[305,1492,1455],{"class":1449},[305,1494,1495],{"class":307,"line":1113},[305,1496,1497],{"class":1449},"# Unless required by applicable law or agreed to in writing, software\n",[305,1499,1500],{"class":307,"line":1126},[305,1501,1502],{"class":1449},"# distributed under the License is distributed on an \"AS IS\" BASIS,\n",[305,1504,1505],{"class":307,"line":1137},[305,1506,1507],{"class":1449},"# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n",[305,1509,1510],{"class":307,"line":1143},[305,1511,1512],{"class":1449},"# See the License for the specific language governing permissions and\n",[305,1514,1516],{"class":307,"line":1515},15,[305,1517,1518],{"class":1449},"# limitations under the License.\n",[305,1520,1522],{"class":307,"line":1521},16,[305,1523,1524],{"class":319},"command -v mplayer >/dev/null 2>&1 || exit 1\n",[305,1526,1528],{"class":307,"line":1527},17,[305,1529,1530],{"class":319},"trap \"pkill -f -9 lib/hollywood/ >/dev/null 2>&1; exit\" INT\n",[305,1532,1534],{"class":307,"line":1533},18,[305,1535,1536],{"class":319},"PKG=hollywood\n",[305,1538,1540],{"class":307,"line":1539},19,[305,1541,1542],{"class":319},"dir=\"$(dirname $0)/../../share/$PKG\"\n",[305,1544,1546],{"class":307,"line":1545},20,[305,1547,1548],{"class":364},"-DISPLAY= mplayer -vo caca -loop 0 -ss $((RANDOM % 100)) -speed 100 $MPLAYER_OPTS $dir/soundwave.mp4\n",[305,1550,1552],{"class":307,"line":1551},21,[305,1553,1554],{"class":315},"+DISPLAY= mplayer -vo caca -loop 0 $MPLAYER_OPTS $dir/soundwave.mp4\n",[22,1556,1557],{},"再次运行，确认修改已经成功。",[497,1559,1560],{},"html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html pre.shiki code .sW2Sy, html code.shiki .sW2Sy{--shiki-default:#A0A1A7;--shiki-default-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic}html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html pre.shiki code .sJa8x, html code.shiki .sJa8x{--shiki-default:#E45649;--shiki-dark:#E06C75}",{"title":184,"searchDepth":185,"depth":185,"links":1562},[],{"title":1564,"date":1565,"path":1566,"tags":1567,"body":1570},"处理 fcitx5 的文字候选框在 tg 客户端上闪烁的问题","2022-07-03 13:52:44","/2022/07/03/fcitx5-blinking-on-tg-under-wayland-kde",[507,1568,1569],"Notes","KDE",{"type":16,"value":1571,"toc":1762},[1572,1583,1586,1589,1595,1598,1601,1609,1612,1615,1618,1624,1631,1642,1645,1648,1651,1654,1669,1672,1676,1679,1700,1703,1711,1714,1718,1724,1727,1734,1741,1748,1759],[19,1573,1574],{},[22,1575,1576,1577,1582],{},"文章开头，先要感谢 fcitx5 的开发者 ",[53,1578,1581],{"href":1579,"rel":1580},"https://www.csslayer.info/wordpress/",[57],"老K"," 帮我 debug 这个问题",[526,1584,1585],{"id":1585},"鬼畜的文字候选框",[22,1587,1588],{},"在新装的 Fedora 36 KDE Wayland 下使用 fcitx5 时遇到了文字候选框前后移动晃眼的问题（如下图）",[22,1590,1591],{},[45,1592],{"alt":1593,"src":1594},"fcitx5 blinking","https://static.031130.xyz/uploads/2024/08/12/62c13162a6efc.gif",[526,1596,1597],{"id":1597},"解决方案",[22,1599,1600],{},"当我向老K提出这个问题上的时候，老K告诉我这是预期行为，一共有两个解决方案。",[741,1602,1603,1606],{},[261,1604,1605],{},"使用 qt 的 text input",[261,1607,1608],{},"关掉 kwin 的淡入淡出特效",[22,1610,1611],{},"但由于我并不熟悉 KWin 的特效，所以我选择了前者的方案。",[22,1613,1614],{},"首先，需要确保自己的 Plasma 版本在 5.24 或以上，fcitx5 的版本号在 5.0.14 以上。",[22,1616,1617],{},"然后我们需要让 KWin 去启动 fcitx5。KCM 为此提供了一个非常简单的方式，如下图",[22,1619,1620],{},[45,1621],{"alt":1622,"src":1623},"选择 fcitx5 就好啦","https://static.031130.xyz/uploads/2024/08/12/62c134907ada9.webp",[22,1625,1626,1627,1630],{},"随后需要确保环境变量没有设置 ",[138,1628,1629],{},"QT_IM_MODULE ","。一定要确保这个变量不存在，连空也不行，必须是 unset。",[22,1632,1633,1634,1637,1638,1641],{},"理论上来说，是不需要重启的，但我的环境变量是 ",[138,1635,1636],{},"fcitx5-autostart"," 这个 rpm 包在 ",[138,1639,1640],{},"/etc/profile.d/fcitx5.sh","里面设置的，我需要重启系统来使新的环境变量生效。",[22,1643,1644],{},"重启后，如果没有什么意外的话，就算成功了。",[526,1646,1647],{"id":1647},"绝对不会缺席的意外",[22,1649,1650],{},"很遗憾，我遇到了意外。",[22,1652,1653],{},"完成上述操作后，文字候选框依然有问题。",[22,1655,1656,1657,1660,1661,1664,1665,1668],{},"在老K的正确推测下，是因为我在 Fedora 下曾经使用过 ",[138,1658,1659],{},"im-settings","，该程序在 ",[138,1662,1663],{},"$HOME/.config/environment.d/"," 路径下重新帮我设置回了 ",[138,1666,1667],{},"QT_IM_MODULE"," 这个变量，从而使得 tg 启动时还在使用 IM MODULE，而不是预期的 qt text input。",[22,1670,1671],{},"删除这两个影响环境变量的文件后，在 tg 输入时，fcitx5 的文字候选框恢复了正常。",[526,1673,1675],{"id":1674},"debug-过程中用到的两个方式","debug 过程中用到的两个方式",[575,1677,1678],{"id":1678},"dbus-send",[297,1680,1682],{"className":299,"code":1681,"language":301,"meta":184,"style":184},"dbus-send --print-reply=literal --dest=org.fcitx.Fcitx5 /controller org.fcitx.Fcitx.Controller1.DebugInfo\n",[138,1683,1684],{"__ignoreMap":184},[305,1685,1686,1688,1691,1694,1697],{"class":307,"line":308},[305,1687,1678],{"class":311},[305,1689,1690],{"class":343}," --print-reply=literal",[305,1692,1693],{"class":343}," --dest=org.fcitx.Fcitx5",[305,1695,1696],{"class":315}," /controller",[305,1698,1699],{"class":315}," org.fcitx.Fcitx.Controller1.DebugInfo\n",[22,1701,1702],{},"运行如上命令后，我得到了如下的输出",[297,1704,1709],{"className":1705,"code":1707,"language":1708},[1706],"language-text","   Group [x11::1] has 0 InputContext(s)\nGroup [wayland:] has 5 InputContext(s)\n  IC [a50fe208d42e4611b240c0b66a2fa0b9] program:konsole frontend:dbus cap:e001800060 focus:1\n  IC [d7d4d5c05e9c445aab1af9c7dfb5fbd4] program:telegram-desktop frontend:dbus cap:e001800060 focus:0\n  IC [ac72ec3edf58481bbdf838352520efd5] program:krunner frontend:dbus cap:e001820060 focus:0\n  IC [d8b450176e204953837248f786204c29] program:plasmashell frontend:dbus cap:e001800060 focus:0\n  IC [df252979343d42ebbe9bd82ead6ff194] program: frontend:wayland cap:40 focus:0\nInput Context without group\n","text",[138,1710,1707],{"__ignoreMap":184},[22,1712,1713],{},"老K指出，出现了 telegram 的那一行表明 tg 还是在用 IM Module，所以是环境变量有问题",[575,1715,1717],{"id":1716},"proc-查看程序运行时的环境变量","/proc 查看程序运行时的环境变量",[22,1719,1720],{},[45,1721],{"alt":1722,"src":1723},"获取到的环境变量","https://static.031130.xyz/uploads/2024/08/12/62c138b030469.webp",[526,1725,1726],{"id":1726},"参考资料",[22,1728,1729],{},[53,1730,1733],{"href":1731,"rel":1732},"https://www.csslayer.info/wordpress/linux/use-plasma-5-24-to-type-in-alacritty-or-any-other-text-input-v3-client-with-fcitx-5-on-wayland/",[57],"Use Plasma 5.24 to type in Alacritty (Or any other text-input-v3 client) with Fcitx 5 on Wayland",[22,1735,1736],{},[53,1737,1740],{"href":1738,"rel":1739},"https://fcitx-im.org/wiki/FAQ#Candidate_window_is_blinking_under_wayland_with_Fcitx_5",[57],"Candidate window is blinking under wayland with Fcitx 5",[22,1742,1743],{},[53,1744,1747],{"href":1745,"rel":1746},"https://www.cnblogs.com/hupeng1234/p/6735403.html",[57],"查看进程的环境变量",[22,1749,1750],{},[219,1751,1752,1753,916,1755,1758],{},"注: 上述参考资料均已在 ",[138,1754,494],{},[138,1756,1757],{},"archive.ph"," 做过存档，如遇到原站点无法访问的情况，可自行前往这两个站点查看存档。",[497,1760,1761],{},"html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}",{"title":184,"searchDepth":185,"depth":185,"links":1763},[1764,1765,1766,1767,1771],{"id":1585,"depth":185,"text":1585},{"id":1597,"depth":185,"text":1597},{"id":1647,"depth":185,"text":1647},{"id":1674,"depth":185,"text":1675,"children":1768},[1769,1770],{"id":1678,"depth":632,"text":1678},{"id":1716,"depth":632,"text":1717},{"id":1726,"depth":185,"text":1726},{"title":1773,"date":1774,"path":1775,"tags":1776,"body":1778},"使用caddy反向代理维基百科中文站点","2022-05-30 08:59:21","/2022/05/30/use-caddy-to-proxy-wikipedia",[1777],"Caddy",{"type":16,"value":1779,"toc":2254},[1780,1783,1791,1794,1797,1827,1831,2192,2195,2201,2208,2215,2222,2224,2246,2251],[22,1781,1782],{},"反代的目的无非是两点",[741,1784,1785,1788],{},[261,1786,1787],{},"满足自己在无代理情况下访问无法访问的站点的需求",[261,1789,1790],{},"方便将站点分享给亲朋好友。",[22,1792,1793],{},"一直以来，我都想用 caddy 去反代一份维基百科来用，今天刚好就顺手解决了。",[526,1795,1796],{"id":1796},"注意事项",[741,1798,1799,1802,1805,1808],{},[261,1800,1801],{},"用于反代的机子需要有对目标站点的访问能力",[261,1803,1804],{},"最好准备一个新的域名作为白手套，防止被污染",[261,1806,1807],{},"建议增加密码保护，一来使得小鸡流量不被滥用，二来防止防火墙检测到站点内容",[261,1809,1810,1811,1814,1815,1818,1819,1823,1824,1826],{},"本文使用的 caddy 开启了 ",[138,1812,1813],{},"replace_response"," 插件，可以使用 ",[138,1816,1817],{},"xcaddy"," 编译或直接前往 ",[53,1820,1821],{"href":1821,"rel":1822},"https://caddyserver.com/download",[57]," 勾选相应插件后下载。安装时，建议先根据官方文档安装原版 caddy，再用启用了 ",[138,1825,1813],{}," 插件的 caddy 二进制文件覆盖掉原版 caddy，这样就不需要去手写 systemd 相关的文件了。",[526,1828,1830],{"id":1829},"caddyfile","Caddyfile",[297,1832,1836],{"className":1833,"code":1834,"language":1835,"meta":184,"style":184},"language-nginx shiki shiki-themes one-light one-dark-pro","{\n        order replace after encode\n}\n\nhttps://zhwiki.example.com {\n\n        reverse_proxy * https://zh.wikipedia.org {\n                header_up Host {upstream_hostport}\n                header_up X-Real-IP {http.request.remote.host}\n                header_up X-Forwarded-For {http.request.remote.host}\n                header_up X-Forwarded-Port {http.request.port}\n                header_up X-Forwarded-Proto {http.request.scheme}\n                header_up Accept-Encoding identity\n                header_down location (https://zh.wikipedia.org/)(.*) https://zhwiki.example.com/$2\n                header_down location (https://zh.m.wikipedia.org/)(.*) http://m.zhwiki.example.com/$2\n        }\n\n        replace {\n                \"upload.wikimedia.org\" \"up.zhwiki.example.com\"\n                \"zh.wikipedia.org\" \"zhwiki.example.com\"\n                \"zh.m.wikipedia.org\" \"m.zhwiki.example.com\"\n        }\n}\n\nhttps://m.zhwiki.example.com {\n\n        reverse_proxy * https://zh.m.wikipedia.org {\n                header_up Host {upstream_hostport}\n                header_up X-Real-IP {http.request.remote.host}\n                header_up X-Forwarded-For {http.request.remote.host}\n                header_up X-Forwarded-Port {http.request.port}\n                header_up X-Forwarded-Proto {http.request.scheme}\n                header_up Accept-Encoding identity\n                header_down location (https://zh.wikipedia.org/)(.*) https://zhwiki.example.com/$2\n                header_down location (https://zh.m.wikipedia.org/)(.*) http://m.zhwiki.example.com/$2\n        }\n\n        replace {\n                \"upload.wikimedia.org\" \"up.zhwiki.example.com\"\n                \"zh.wikipedia.org\" \"zhwiki.example.com\"\n                \"zh.m.wikipedia.org\" \"m.zhwiki.example.com\"\n        }\n}\n\nhttps://up.zhwiki.example.com {\n        reverse_proxy * https://upload.wikimedia.org {\n                header_up Host {upstream_hostport}\n                header_up X-Real-IP {http.request.remote.host}\n                header_up X-Forwarded-For {http.request.remote.host}\n                header_up X-Forwarded-Port {http.request.port}\n                header_up X-Forwarded-Proto {http.request.scheme}\n                header_up Accept-Encoding identity\n        }\n}\n\n","nginx",[138,1837,1838,1842,1850,1854,1860,1871,1875,1883,1891,1898,1905,1912,1919,1926,1937,1946,1951,1955,1962,1967,1972,1977,1982,1987,1992,2002,2007,2015,2022,2029,2036,2043,2050,2057,2066,2075,2080,2085,2092,2097,2102,2107,2112,2117,2122,2132,2140,2147,2154,2161,2168,2175,2182,2187],{"__ignoreMap":184},[305,1839,1840],{"class":307,"line":308},[305,1841,1014],{"class":319},[305,1843,1844,1847],{"class":307,"line":185},[305,1845,1846],{"class":323},"        order",[305,1848,1849],{"class":319}," replace after encode\n",[305,1851,1852],{"class":307,"line":632},[305,1853,1146],{"class":319},[305,1855,1856],{"class":307,"line":1032},[305,1857,1859],{"emptyLinePlaceholder":1858},true,"\n",[305,1861,1862,1865,1868],{"class":307,"line":1047},[305,1863,1864],{"class":319},"https://zhwiki.example.",[305,1866,1867],{"class":323},"com",[305,1869,1870],{"class":319}," {\n",[305,1872,1873],{"class":307,"line":1060},[305,1874,1859],{"emptyLinePlaceholder":1858},[305,1876,1877,1880],{"class":307,"line":3},[305,1878,1879],{"class":323},"        reverse_proxy",[305,1881,1882],{"class":319}," * https://zh.wikipedia.org {\n",[305,1884,1885,1888],{"class":307,"line":1081},[305,1886,1887],{"class":323},"                header_up",[305,1889,1890],{"class":319}," Host {upstream_hostport}\n",[305,1892,1893,1895],{"class":307,"line":1087},[305,1894,1887],{"class":323},[305,1896,1897],{"class":319}," X-Real-IP {http.request.remote.host}\n",[305,1899,1900,1902],{"class":307,"line":1100},[305,1901,1887],{"class":323},[305,1903,1904],{"class":319}," X-Forwarded-For {http.request.remote.host}\n",[305,1906,1907,1909],{"class":307,"line":1113},[305,1908,1887],{"class":323},[305,1910,1911],{"class":319}," X-Forwarded-Port {http.request.port}\n",[305,1913,1914,1916],{"class":307,"line":1126},[305,1915,1887],{"class":323},[305,1917,1918],{"class":319}," X-Forwarded-Proto {http.request.scheme}\n",[305,1920,1921,1923],{"class":307,"line":1137},[305,1922,1887],{"class":323},[305,1924,1925],{"class":319}," Accept-Encoding identity\n",[305,1927,1928,1931,1934],{"class":307,"line":1143},[305,1929,1930],{"class":323},"                header_down",[305,1932,1933],{"class":319}," location (https://zh.wikipedia.org/)(.*) https://zhwiki.example.com/$",[305,1935,1936],{"class":364},"2\n",[305,1938,1939,1941,1944],{"class":307,"line":1515},[305,1940,1930],{"class":323},[305,1942,1943],{"class":319}," location (https://zh.m.wikipedia.org/)(.*) http://m.zhwiki.example.com/$",[305,1945,1936],{"class":364},[305,1947,1948],{"class":307,"line":1521},[305,1949,1950],{"class":319},"        }\n",[305,1952,1953],{"class":307,"line":1527},[305,1954,1859],{"emptyLinePlaceholder":1858},[305,1956,1957,1960],{"class":307,"line":1533},[305,1958,1959],{"class":323},"        replace",[305,1961,1870],{"class":319},[305,1963,1964],{"class":307,"line":1539},[305,1965,1966],{"class":319},"                \"upload.wikimedia.org\" \"up.zhwiki.example.com\"\n",[305,1968,1969],{"class":307,"line":1545},[305,1970,1971],{"class":319},"                \"zh.wikipedia.org\" \"zhwiki.example.com\"\n",[305,1973,1974],{"class":307,"line":1551},[305,1975,1976],{"class":319},"                \"zh.m.wikipedia.org\" \"m.zhwiki.example.com\"\n",[305,1978,1980],{"class":307,"line":1979},22,[305,1981,1950],{"class":319},[305,1983,1985],{"class":307,"line":1984},23,[305,1986,1146],{"class":319},[305,1988,1990],{"class":307,"line":1989},24,[305,1991,1859],{"emptyLinePlaceholder":1858},[305,1993,1995,1998,2000],{"class":307,"line":1994},25,[305,1996,1997],{"class":319},"https://m.zhwiki.example.",[305,1999,1867],{"class":323},[305,2001,1870],{"class":319},[305,2003,2005],{"class":307,"line":2004},26,[305,2006,1859],{"emptyLinePlaceholder":1858},[305,2008,2010,2012],{"class":307,"line":2009},27,[305,2011,1879],{"class":323},[305,2013,2014],{"class":319}," * https://zh.m.wikipedia.org {\n",[305,2016,2018,2020],{"class":307,"line":2017},28,[305,2019,1887],{"class":323},[305,2021,1890],{"class":319},[305,2023,2025,2027],{"class":307,"line":2024},29,[305,2026,1887],{"class":323},[305,2028,1897],{"class":319},[305,2030,2032,2034],{"class":307,"line":2031},30,[305,2033,1887],{"class":323},[305,2035,1904],{"class":319},[305,2037,2039,2041],{"class":307,"line":2038},31,[305,2040,1887],{"class":323},[305,2042,1911],{"class":319},[305,2044,2046,2048],{"class":307,"line":2045},32,[305,2047,1887],{"class":323},[305,2049,1918],{"class":319},[305,2051,2053,2055],{"class":307,"line":2052},33,[305,2054,1887],{"class":323},[305,2056,1925],{"class":319},[305,2058,2060,2062,2064],{"class":307,"line":2059},34,[305,2061,1930],{"class":323},[305,2063,1933],{"class":319},[305,2065,1936],{"class":364},[305,2067,2069,2071,2073],{"class":307,"line":2068},35,[305,2070,1930],{"class":323},[305,2072,1943],{"class":319},[305,2074,1936],{"class":364},[305,2076,2078],{"class":307,"line":2077},36,[305,2079,1950],{"class":319},[305,2081,2083],{"class":307,"line":2082},37,[305,2084,1859],{"emptyLinePlaceholder":1858},[305,2086,2088,2090],{"class":307,"line":2087},38,[305,2089,1959],{"class":323},[305,2091,1870],{"class":319},[305,2093,2095],{"class":307,"line":2094},39,[305,2096,1966],{"class":319},[305,2098,2100],{"class":307,"line":2099},40,[305,2101,1971],{"class":319},[305,2103,2105],{"class":307,"line":2104},41,[305,2106,1976],{"class":319},[305,2108,2110],{"class":307,"line":2109},42,[305,2111,1950],{"class":319},[305,2113,2115],{"class":307,"line":2114},43,[305,2116,1146],{"class":319},[305,2118,2120],{"class":307,"line":2119},44,[305,2121,1859],{"emptyLinePlaceholder":1858},[305,2123,2125,2128,2130],{"class":307,"line":2124},45,[305,2126,2127],{"class":319},"https://up.zhwiki.example.",[305,2129,1867],{"class":323},[305,2131,1870],{"class":319},[305,2133,2135,2137],{"class":307,"line":2134},46,[305,2136,1879],{"class":323},[305,2138,2139],{"class":319}," * https://upload.wikimedia.org {\n",[305,2141,2143,2145],{"class":307,"line":2142},47,[305,2144,1887],{"class":323},[305,2146,1890],{"class":319},[305,2148,2150,2152],{"class":307,"line":2149},48,[305,2151,1887],{"class":323},[305,2153,1897],{"class":319},[305,2155,2157,2159],{"class":307,"line":2156},49,[305,2158,1887],{"class":323},[305,2160,1904],{"class":319},[305,2162,2164,2166],{"class":307,"line":2163},50,[305,2165,1887],{"class":323},[305,2167,1911],{"class":319},[305,2169,2171,2173],{"class":307,"line":2170},51,[305,2172,1887],{"class":323},[305,2174,1918],{"class":319},[305,2176,2178,2180],{"class":307,"line":2177},52,[305,2179,1887],{"class":323},[305,2181,1925],{"class":319},[305,2183,2185],{"class":307,"line":2184},53,[305,2186,1950],{"class":319},[305,2188,2190],{"class":307,"line":2189},54,[305,2191,1146],{"class":319},[526,2193,2194],{"id":2194},"简单解释",[22,2196,2197,2198,2200],{},"第一大段是启用 ",[138,2199,1813],{}," 插件的部分，直接照抄即可。",[22,2202,2203,2204,2207],{},"第二和第三大段的思路是一致的，分别反向代理了 PC 端和移动段的网页。两行 ",[138,2205,2206],{}," header_down"," 的写法是受到了知乎上那篇 Github 反代的启发，避免了源站发出 302 重定向时访客被带到源站去。replace 部分不用多说，就是将针对三个源站域名的请求改到反代站域名。",[22,2209,2210,2211,2214],{},"第四大段就是中规中举地反代了 ",[138,2212,2213],{},"upload.wikimedia.org"," 这个域名，上面存放的大多数是媒体文件，如果条件允许的话其实可以考虑使用多个服务器反代。",[22,2216,2217,2218,29],{},"密码保护在我这份 Caddyfile 中没有启用，如果有需要的话可以参考我的",[53,2219,2221],{"href":2220},"/2021/10/21/picuploader-on-archlinux-with-caddy/#%E8%AE%BE%E7%BD%AE%E8%AE%BF%E9%97%AE%E5%AF%86%E7%A0%81%EF%BC%88%E5%8F%AF%E9%80%89%EF%BC%89","另一篇博客",[526,2223,1726],{"id":1726},[22,2225,2226,2231,2236,2241],{},[53,2227,2230],{"href":2228,"rel":2229},"https://caddyserver.com/docs/",[57],"Caddy 官方文档",[53,2232,2235],{"href":2233,"rel":2234},"https://zhuanlan.zhihu.com/p/476390779",[57],"The Road to Serfdom——如何为GitHub搭建反向代理",[53,2237,2240],{"href":2238,"rel":2239},"https://ichon.me/post/1026.html",[57],"使用 Caddy 配置 Wikipedia 反向代理",[53,2242,2245],{"href":2243,"rel":2244},"https://learningman.top/archives/365",[57],"使用 Caddy 反代 ghcr.io",[22,2247,2248],{},[219,2249,2250],{},"所有参考资料除官方文档外均使用 web.archive.org 和 archive.ph 进行存档，如有无法访问的情况，请自行前往存档站获取历史存档。",[497,2252,2253],{},"html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html pre.shiki code .sLKXg, html code.shiki .sLKXg{--shiki-default:#A626A4;--shiki-dark:#C678DD}html pre.shiki code .sJa8x, html code.shiki .sJa8x{--shiki-default:#E45649;--shiki-dark:#E06C75}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}",{"title":184,"searchDepth":185,"depth":185,"links":2255},[2256,2257,2258,2259],{"id":1796,"depth":185,"text":1796},{"id":1829,"depth":185,"text":1830},{"id":2194,"depth":185,"text":2194},{"id":1726,"depth":185,"text":1726},{"title":2261,"date":2262,"path":2263,"tags":2264,"body":2265},"创建一个本地的 Fedora 镜像源","2022-05-11 04:18:26","/2022/05/11/setup-a-local-fedora-source",[1180,1777],{"type":16,"value":2266,"toc":2613},[2267,2276,2279,2300,2303,2306,2313,2316,2319,2330,2337,2349,2355,2361,2364,2372,2389,2394,2400,2404,2407,2410,2419,2422,2428,2431,2450,2453,2459,2462,2468,2475,2540,2547,2601,2610],[19,2268,2269],{},[22,2270,2271,2272,2275],{},"Fedora 36 在多次跳票后，总算是在 5月10日正式发布了。截止北京时间 5月11日凌晨两点，上海交通大学开源镜像站的上游 ",[138,2273,2274],{},"rsync://download-ib01.fedoraproject.org/","  仍然没有同步 Fedora 36 的 Release 源。鉴于 Release 自 freeze 以后基本是不会有什么大变动的，也不需要及时同步更新，干脆就直接建立一个本地的镜像源。",[526,2277,2278],{"id":2278},"准备",[258,2280,2281,2287,2297],{},[261,2282,2283,2284,2286],{},"一块足够大的硬盘",[265,2285],{},"根据我个人实测，单 Fedora 36 的 x86_64 架构 的 Release 源中的 binary rpm 就占用了 89.6 GB，具体准备多的的硬盘空间还得看你具体需要同步些什么。",[261,2288,2289,2290,2292,2293,2296],{},"符合要求的上游",[265,2291],{},"这里所说的符合要求一共是两个方面，一是允许 rsync 同步，二是有你想要的文件。我通过 getfedora.org 的下载按钮的转发目标得知 ",[138,2294,2295],{},"mirror.karneval.cz"," 已经完成了 Fedora 36 Release 源的同步。",[261,2298,2299],{},"良好的网络条件",[22,2301,2302],{},"这里说的良好的网络条件，并不一定是说需要访问境外站点的能力，而是你和你的上游之间的网络访问畅通，不要动不动就i断开连接那种。如果你选择的是国内镜像站作为你的上游，那一般不会有什么问题。",[526,2304,2305],{"id":2305},"开始同步",[22,2307,2308,2309,2312],{},"现在的主流方案一般都是选择 ",[138,2310,2311],{},"rsync"," 直接开整。",[575,2314,2315],{"id":2315},"试探环节",[22,2317,2318],{},"很多镜像站的 rsync 文件路径和 http 文件路径路径是不同的。",[22,2320,2321,2322,2325,2326,2329],{},"比如说，我这里用的 mirror.karneval.cz 的 http 页面显示的 fedora 仓库路径在 ",[138,2323,2324],{},"/pub/fedora","，但 rsync 同步时需要使用 ",[138,2327,2328],{},"/fedora"," 路径。",[22,2331,2332,2333,2336],{},"为了确定这一点，我们可以先通过 ",[138,2334,2335],{},"rsync rsync://example.com"," 进行预览",[297,2338,2340],{"className":299,"code":2339,"language":301,"meta":184,"style":184},"rsync rsync://mirror.karneval.cz\n",[138,2341,2342],{"__ignoreMap":184},[305,2343,2344,2346],{"class":307,"line":308},[305,2345,2311],{"class":311},[305,2347,2348],{"class":315}," rsync://mirror.karneval.cz\n",[22,2350,2351],{},[45,2352],{"alt":2353,"src":2354},"image-20220511103736493","https://static.031130.xyz/uploads/2024/08/12/627b2177c4da2.webp",[22,2356,2357,2358],{},"通过一层一层预览目录的方式，找到需要同步的路径是 ",[138,2359,2360],{},"/fedora/linux/releases/36/Everything/x86_64/os/",[575,2362,2363],{"id":2363},"同步环节",[22,2365,2366,2367,916,2369,2371],{},"通过 ",[138,2368,828],{},[138,2370,785],{}," 创建并进入我们准备用于同步源码的文件夹，然后开始执行同步命令。",[297,2373,2375],{"className":299,"code":2374,"language":301,"meta":184,"style":184},"rsync -avP rsync://mirror.karneval.cz/fedora/linux/releases/36/Everything/x86_64/os/ .\n",[138,2376,2377],{"__ignoreMap":184},[305,2378,2379,2381,2384,2387],{"class":307,"line":308},[305,2380,2311],{"class":311},[305,2382,2383],{"class":343}," -avP",[305,2385,2386],{"class":315}," rsync://mirror.karneval.cz/fedora/linux/releases/36/Everything/x86_64/os/",[305,2388,811],{"class":315},[22,2390,2391],{},[219,2392,2393],{},"Ps: 中途如果由于各种原因而中断了同步过程，可以再次使用上述命令继续同步，rsync 会保证文件完整性。",[22,2395,2396],{},[45,2397],{"alt":2398,"src":2399},"耗费两个半小时，同步成功","https://static.031130.xyz/uploads/2024/08/12/627b22fa44446.webp",[526,2401,2403],{"id":2402},"安装配置并启用-static-server-可选","安装、配置并启用 static server (可选)",[22,2405,2406],{},"如果只需要本机使用，那么直接跳过这一步即可；如果需要给局域网内的其他机器提供镜像源，那么需要启用 static server。",[22,2408,2409],{},"我这里选择的是 caddy，性能虽然比 nginx 略逊一筹，但胜在配置简单。",[22,2411,2412,2413,2418],{},"caddy 的安装可以直接参考",[53,2414,2417],{"href":2415,"rel":2416},"https://caddyserver.com/docs/install",[57],"官方文档","，这里不再赘述。",[22,2420,2421],{},"配置也不过那么几行的事情，我给个 example。端口号只要和别的程序没有冲突，就可以随意指定。443 端口需要 ssl 证书比较麻烦，局域网内直接用非标准端口即可。",[297,2423,2426],{"className":2424,"code":2425,"language":1708},[1706],":14567 {\n        root * /the/directory/you/use\n\n        file_server {\n                browse\n        }\n}\n",[138,2427,2425],{"__ignoreMap":184},[22,2429,2430],{},"配置完后直接以普通用户的权限启用即可，使用 systemd 启用需要解决 caddy 用户对目标无权限的问题。",[297,2432,2434],{"className":299,"code":2433,"language":301,"meta":184,"style":184},"caddy run --config /etc/caddy/Caddyfile\n",[138,2435,2436],{"__ignoreMap":184},[305,2437,2438,2441,2444,2447],{"class":307,"line":308},[305,2439,2440],{"class":311},"caddy",[305,2442,2443],{"class":315}," run",[305,2445,2446],{"class":343}," --config",[305,2448,2449],{"class":315}," /etc/caddy/Caddyfile\n",[22,2451,2452],{},"浏览器输入对应的 ip 和端口，应该就可以访问了。",[22,2454,2455],{},[45,2456],{"alt":2457,"src":2458},"image-20220511113417004","https://static.031130.xyz/uploads/2024/08/12/627b2ebd23331.webp",[526,2460,2461],{"id":2461},"修改源配置文件",[22,2463,2464,2465,280],{},"由于我们仅同步了 Release 源，就只需要修改 ",[138,2466,2467],{},"/etc/yum.repo.d/fedora.repo",[22,2469,2470,2471,2474],{},"如果镜像源在本机上，可以直接使用 ",[138,2472,2473],{},"file://"," 协议头:",[297,2476,2478],{"className":1440,"code":2477,"language":1442,"meta":184,"style":184},"[fedora]\nname=Fedora $releasever - $basearch\n+ baseurl=file:///the/directory/you/use\n- metalink=https://mirrors.fedoraproject.org/metalink?repo=fedora-$releasever&arch=$basearch\nenabled=1\ncountme=1\nmetadata_expire=7d\nrepo_gpgcheck=0\ntype=rpm\ngpgcheck=1\ngpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-fedora-$releasever-$basearch\nskip_if_unavailable=False\n",[138,2479,2480,2485,2490,2495,2500,2505,2510,2515,2520,2525,2530,2535],{"__ignoreMap":184},[305,2481,2482],{"class":307,"line":308},[305,2483,2484],{"class":319},"[fedora]\n",[305,2486,2487],{"class":307,"line":185},[305,2488,2489],{"class":319},"name=Fedora $releasever - $basearch\n",[305,2491,2492],{"class":307,"line":632},[305,2493,2494],{"class":315},"+ baseurl=file:///the/directory/you/use\n",[305,2496,2497],{"class":307,"line":1032},[305,2498,2499],{"class":364},"- metalink=https://mirrors.fedoraproject.org/metalink?repo=fedora-$releasever&arch=$basearch\n",[305,2501,2502],{"class":307,"line":1047},[305,2503,2504],{"class":319},"enabled=1\n",[305,2506,2507],{"class":307,"line":1060},[305,2508,2509],{"class":319},"countme=1\n",[305,2511,2512],{"class":307,"line":3},[305,2513,2514],{"class":319},"metadata_expire=7d\n",[305,2516,2517],{"class":307,"line":1081},[305,2518,2519],{"class":319},"repo_gpgcheck=0\n",[305,2521,2522],{"class":307,"line":1087},[305,2523,2524],{"class":319},"type=rpm\n",[305,2526,2527],{"class":307,"line":1100},[305,2528,2529],{"class":319},"gpgcheck=1\n",[305,2531,2532],{"class":307,"line":1113},[305,2533,2534],{"class":319},"gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-fedora-$releasever-$basearch\n",[305,2536,2537],{"class":307,"line":1126},[305,2538,2539],{"class":319},"skip_if_unavailable=False\n",[22,2541,2542,2543,2546],{},"如果镜像源在同局域网设备上，通过 ",[138,2544,2545],{},"http://"," 协议也能达到相同的效果:",[297,2548,2550],{"className":1440,"code":2549,"language":1442,"meta":184,"style":184},"[fedora]\nname=Fedora $releasever - $basearch\n+ baseurl=http://192.168.1.233:14567\n- metalink=https://mirrors.fedoraproject.org/metalink?repo=fedora-$releasever&arch=$basearch\nenabled=1\ncountme=1\nmetadata_expire=7d\nrepo_gpgcheck=0\ntype=rpm\ngpgcheck=1\ngpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-fedora-$releasever-$basearch\nskip_if_unavailable=False\n",[138,2551,2552,2556,2560,2565,2569,2573,2577,2581,2585,2589,2593,2597],{"__ignoreMap":184},[305,2553,2554],{"class":307,"line":308},[305,2555,2484],{"class":319},[305,2557,2558],{"class":307,"line":185},[305,2559,2489],{"class":319},[305,2561,2562],{"class":307,"line":632},[305,2563,2564],{"class":315},"+ baseurl=http://192.168.1.233:14567\n",[305,2566,2567],{"class":307,"line":1032},[305,2568,2499],{"class":364},[305,2570,2571],{"class":307,"line":1047},[305,2572,2504],{"class":319},[305,2574,2575],{"class":307,"line":1060},[305,2576,2509],{"class":319},[305,2578,2579],{"class":307,"line":3},[305,2580,2514],{"class":319},[305,2582,2583],{"class":307,"line":1081},[305,2584,2519],{"class":319},[305,2586,2587],{"class":307,"line":1087},[305,2588,2524],{"class":319},[305,2590,2591],{"class":307,"line":1100},[305,2592,2529],{"class":319},[305,2594,2595],{"class":307,"line":1113},[305,2596,2534],{"class":319},[305,2598,2599],{"class":307,"line":1126},[305,2600,2539],{"class":319},[22,2602,2603],{},[219,2604,2605,2606,2609],{},"Ps: 提供镜像源的机子的局域网 ip 可以通过 ",[138,2607,2608],{},"ip -br a"," 命令获取",[497,2611,2612],{},"html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html pre.shiki code .sJa8x, html code.shiki .sJa8x{--shiki-default:#E45649;--shiki-dark:#E06C75}",{"title":184,"searchDepth":185,"depth":185,"links":2614},[2615,2616,2620,2621],{"id":2278,"depth":185,"text":2278},{"id":2305,"depth":185,"text":2305,"children":2617},[2618,2619],{"id":2315,"depth":632,"text":2315},{"id":2363,"depth":632,"text":2363},{"id":2402,"depth":185,"text":2403},{"id":2461,"depth":185,"text":2461},129,1763654604148]
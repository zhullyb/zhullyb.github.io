[{"data":1,"prerenderedAt":4350},["ShallowReactive",2],{"randomIndex/page/11/":3,"language-switch-/page/11/-en":4,"index-page-11-zh":5,"posts-total-zh":4349},10,"/en/",[6,1051,1375,1550,1649,2093,2209,2909,3288,3646],{"title":7,"date":8,"path":9,"tags":10,"body":15},"PicUploader使用系列（一）——在Archlinux上使用Caddy部署PicUploader","2021-10-21 22:15:33","/2021/10/21/picuploader-on-archlinux-with-caddy",[11,12,13,14],"Archlinux","Caddy","PicUploader","PHP",{"type":16,"value":17,"toc":1032},"minimark",[18,36,50,91,97,106,130,395,402,408,423,430,587,598,785,789,792,810,813,834,837,857,861,868,871,878,886,900,904,911,935,938,944,948,951,969,972,975,983,1006,1009,1017,1020,1028],[19,20,21,25],"blockquote",{},[22,23,24],"p",{},"之前找对大陆网络友好的图床时，找到了cloudinary，但是全英文界面对操作增加了不少难度，其页面也不是很简洁，让我一下打消了使用网页版的念头。通过搜索，找到了 PicUploader 这一方案，使用php编写，支持cloudinary的api。",[22,26,27,28,35],{},"作者在其",[29,30,34],"a",{"href":31,"rel":32},"https://www.xiebruce.top/17.html",[33],"nofollow","博客","中仅提供了nginx的部署方案，我参考其配置文件成功实现了在caddy下的部署，并且花费了数个小时排坑，故写下本文帮助后来者节省时间。",[37,38,40,41,45,46,49],"h2",{"id":39},"安装caddy和php-fpm以及所需的拓展","安装",[42,43,44],"code",{},"caddy","和",[42,47,48],{},"php-fpm","以及所需的拓展",[51,52,57],"pre",{"className":53,"code":54,"language":55,"meta":56,"style":56},"language-bash shiki shiki-themes one-light one-dark-pro","sudo pacman -S caddy php-fpm php-gd php-sqlite --needed\n","bash","",[42,58,59],{"__ignoreMap":56},[60,61,64,68,72,76,79,82,85,88],"span",{"class":62,"line":63},"line",1,[60,65,67],{"class":66},"sAdtL","sudo",[60,69,71],{"class":70},"sDhpE"," pacman",[60,73,75],{"class":74},"sAGMh"," -S",[60,77,78],{"class":70}," caddy",[60,80,81],{"class":70}," php-fpm",[60,83,84],{"class":70}," php-gd",[60,86,87],{"class":70}," php-sqlite",[60,89,90],{"class":74}," --needed\n",[37,92,94,95],{"id":93},"配置php-fpm","配置",[42,96,48],{},[98,99,101,102,105],"h3",{"id":100},"在etcphpphpini启用picuploader所需拓展","在",[42,103,104],{},"/etc/php/php.ini","启用PicUploader所需拓展",[22,107,108,109,112,113,112,116,112,119,112,122,125,126,129],{},"PicUploaer依赖于",[42,110,111],{},"fileinfo","、",[42,114,115],{},"gd",[42,117,118],{},"curl",[42,120,121],{},"exif",[42,123,124],{},"pdo_sqlite","拓展，可以使用",[42,127,128],{},"php -m","命令来查看目前加载成功了的插件。",[51,131,135],{"className":132,"code":133,"language":134,"meta":56,"style":56},"language-diff shiki shiki-themes one-light one-dark-pro",";extension=bcmath\n;extension=bz2\n;extension=calendar\n- extension=curl\n+ extension=curl\n;extension=dba\n;extension=enchant\n- extension=exif\n+ extension=exif\n;extension=ffi\n;extension=ftp\n- extension=gd\n+ extension=gd\n;extension=gettext\n;extension=gmp\n;extension=iconv\n;extension=imap\n;extension=intl\n;extension=ldap\n;extension=mysqli\n;extension=odbc\n;zend_extension=opcache\n;extension=pdo_dblib\n;extension=pdo_mysql\n;extension=pdo_odbc\n;extension=pdo_pgsql\n- extension=pdo_sqlite\n+ extension=pdo_sqlite\n;extension=pgsql\n;extension=pspell\n;extension=shmop\n;extension=snmp\n;extension=soap\n;extension=sockets\n;extension=sodium\n;extension=sqlite3\n;extension=sysvmsg\n;extension=sysvsem\n;extension=sysvshm\n;extension=tidy\n;extension=xmlrpc\n;extension=xsl\nextension=zip\n","diff",[42,136,137,143,149,155,162,168,174,180,186,192,197,203,209,215,221,227,233,239,245,251,257,263,269,275,281,287,293,299,305,311,317,323,329,335,341,347,353,359,365,371,377,383,389],{"__ignoreMap":56},[60,138,139],{"class":62,"line":63},[60,140,142],{"class":141},"s5ixo",";extension=bcmath\n",[60,144,146],{"class":62,"line":145},2,[60,147,148],{"class":141},";extension=bz2\n",[60,150,152],{"class":62,"line":151},3,[60,153,154],{"class":141},";extension=calendar\n",[60,156,158],{"class":62,"line":157},4,[60,159,161],{"class":160},"sJa8x","- extension=curl\n",[60,163,165],{"class":62,"line":164},5,[60,166,167],{"class":70},"+ extension=curl\n",[60,169,171],{"class":62,"line":170},6,[60,172,173],{"class":141},";extension=dba\n",[60,175,177],{"class":62,"line":176},7,[60,178,179],{"class":141},";extension=enchant\n",[60,181,183],{"class":62,"line":182},8,[60,184,185],{"class":160},"- extension=exif\n",[60,187,189],{"class":62,"line":188},9,[60,190,191],{"class":70},"+ extension=exif\n",[60,193,194],{"class":62,"line":3},[60,195,196],{"class":141},";extension=ffi\n",[60,198,200],{"class":62,"line":199},11,[60,201,202],{"class":141},";extension=ftp\n",[60,204,206],{"class":62,"line":205},12,[60,207,208],{"class":160},"- extension=gd\n",[60,210,212],{"class":62,"line":211},13,[60,213,214],{"class":70},"+ extension=gd\n",[60,216,218],{"class":62,"line":217},14,[60,219,220],{"class":141},";extension=gettext\n",[60,222,224],{"class":62,"line":223},15,[60,225,226],{"class":141},";extension=gmp\n",[60,228,230],{"class":62,"line":229},16,[60,231,232],{"class":141},";extension=iconv\n",[60,234,236],{"class":62,"line":235},17,[60,237,238],{"class":141},";extension=imap\n",[60,240,242],{"class":62,"line":241},18,[60,243,244],{"class":141},";extension=intl\n",[60,246,248],{"class":62,"line":247},19,[60,249,250],{"class":141},";extension=ldap\n",[60,252,254],{"class":62,"line":253},20,[60,255,256],{"class":141},";extension=mysqli\n",[60,258,260],{"class":62,"line":259},21,[60,261,262],{"class":141},";extension=odbc\n",[60,264,266],{"class":62,"line":265},22,[60,267,268],{"class":141},";zend_extension=opcache\n",[60,270,272],{"class":62,"line":271},23,[60,273,274],{"class":141},";extension=pdo_dblib\n",[60,276,278],{"class":62,"line":277},24,[60,279,280],{"class":141},";extension=pdo_mysql\n",[60,282,284],{"class":62,"line":283},25,[60,285,286],{"class":141},";extension=pdo_odbc\n",[60,288,290],{"class":62,"line":289},26,[60,291,292],{"class":141},";extension=pdo_pgsql\n",[60,294,296],{"class":62,"line":295},27,[60,297,298],{"class":160},"- extension=pdo_sqlite\n",[60,300,302],{"class":62,"line":301},28,[60,303,304],{"class":70},"+ extension=pdo_sqlite\n",[60,306,308],{"class":62,"line":307},29,[60,309,310],{"class":141},";extension=pgsql\n",[60,312,314],{"class":62,"line":313},30,[60,315,316],{"class":141},";extension=pspell\n",[60,318,320],{"class":62,"line":319},31,[60,321,322],{"class":141},";extension=shmop\n",[60,324,326],{"class":62,"line":325},32,[60,327,328],{"class":141},";extension=snmp\n",[60,330,332],{"class":62,"line":331},33,[60,333,334],{"class":141},";extension=soap\n",[60,336,338],{"class":62,"line":337},34,[60,339,340],{"class":141},";extension=sockets\n",[60,342,344],{"class":62,"line":343},35,[60,345,346],{"class":141},";extension=sodium\n",[60,348,350],{"class":62,"line":349},36,[60,351,352],{"class":141},";extension=sqlite3\n",[60,354,356],{"class":62,"line":355},37,[60,357,358],{"class":141},";extension=sysvmsg\n",[60,360,362],{"class":62,"line":361},38,[60,363,364],{"class":141},";extension=sysvsem\n",[60,366,368],{"class":62,"line":367},39,[60,369,370],{"class":141},";extension=sysvshm\n",[60,372,374],{"class":62,"line":373},40,[60,375,376],{"class":141},";extension=tidy\n",[60,378,380],{"class":62,"line":379},41,[60,381,382],{"class":141},";extension=xmlrpc\n",[60,384,386],{"class":62,"line":385},42,[60,387,388],{"class":141},";extension=xsl\n",[60,390,392],{"class":62,"line":391},43,[60,393,394],{"class":141},"extension=zip\n",[98,396,398,399,401],{"id":397},"编辑etcphpphpini以增加单文件上传大小限制","编辑",[42,400,104],{},"以增加单文件上传大小限制",[22,403,404],{},[405,406,407],"del",{},"查出这个问题浪费了我整整4小时时间。",[51,409,411],{"className":132,"code":410,"language":134,"meta":56,"style":56},"- upload_max_filesize = 2M\n+ upload_max_filesize = 100M\n",[42,412,413,418],{"__ignoreMap":56},[60,414,415],{"class":62,"line":63},[60,416,417],{"class":160},"- upload_max_filesize = 2M\n",[60,419,420],{"class":62,"line":145},[60,421,422],{"class":70},"+ upload_max_filesize = 100M\n",[98,424,398,426,429],{"id":425},"编辑etcphpphp-fpmdwwwconf使其在运行时使用caddy用户",[42,427,428],{},"/etc/php/php-fpm.d/www.conf","使其在运行时使用caddy用户。",[51,431,433],{"className":132,"code":432,"language":134,"meta":56,"style":56},"---\n; Unix user/group of processes\n; Note: The user is mandatory. If the group is not set, the default user's group\n;       will be used.\n- user = http\n+ user = caddy\n- group = http\n+ group = caddy\n; The address on which to accept FastCGI requests.\n; Valid syntaxes are:\n;   'ip.add.re.ss:port'    - to listen on a TCP socket to a specific IPv4 address on\n;                            a specific port;\n;   '[ip:6:addr:ess]:port' - to listen on a TCP socket to a specific IPv6 address on\n---\n---\n; Note: This value is mandatory.\nlisten = /run/php-fpm/php-fpm.sock\n; and group can be specified either by name or by their numeric IDs.\n; Default Values: user and group are set as the running user\n;                 mode is set to 0660\n- listen.owner = http\n+ listen.owner = caddy\n- listen.group = http\n+ listen.group = caddy\n;listen.mode = 0660\n; When POSIX Access Control Lists are supported you can set them using\n; these options, value is a comma separated list of user/group names.\n; When set, listen.owner and listen.group are ignored\n;listen.acl_users =\n;listen.acl_groups =\n---\n",[42,434,435,440,445,450,455,460,465,470,475,480,485,490,495,500,504,508,513,518,523,528,533,538,543,548,553,558,563,568,573,578,583],{"__ignoreMap":56},[60,436,437],{"class":62,"line":63},[60,438,439],{"class":141},"---\n",[60,441,442],{"class":62,"line":145},[60,443,444],{"class":141},"; Unix user/group of processes\n",[60,446,447],{"class":62,"line":151},[60,448,449],{"class":141},"; Note: The user is mandatory. If the group is not set, the default user's group\n",[60,451,452],{"class":62,"line":157},[60,453,454],{"class":141},";       will be used.\n",[60,456,457],{"class":62,"line":164},[60,458,459],{"class":160},"- user = http\n",[60,461,462],{"class":62,"line":170},[60,463,464],{"class":70},"+ user = caddy\n",[60,466,467],{"class":62,"line":176},[60,468,469],{"class":160},"- group = http\n",[60,471,472],{"class":62,"line":182},[60,473,474],{"class":70},"+ group = caddy\n",[60,476,477],{"class":62,"line":188},[60,478,479],{"class":141},"; The address on which to accept FastCGI requests.\n",[60,481,482],{"class":62,"line":3},[60,483,484],{"class":141},"; Valid syntaxes are:\n",[60,486,487],{"class":62,"line":199},[60,488,489],{"class":141},";   'ip.add.re.ss:port'    - to listen on a TCP socket to a specific IPv4 address on\n",[60,491,492],{"class":62,"line":205},[60,493,494],{"class":141},";                            a specific port;\n",[60,496,497],{"class":62,"line":211},[60,498,499],{"class":141},";   '[ip:6:addr:ess]:port' - to listen on a TCP socket to a specific IPv6 address on\n",[60,501,502],{"class":62,"line":217},[60,503,439],{"class":141},[60,505,506],{"class":62,"line":223},[60,507,439],{"class":141},[60,509,510],{"class":62,"line":229},[60,511,512],{"class":141},"; Note: This value is mandatory.\n",[60,514,515],{"class":62,"line":235},[60,516,517],{"class":141},"listen = /run/php-fpm/php-fpm.sock\n",[60,519,520],{"class":62,"line":241},[60,521,522],{"class":141},"; and group can be specified either by name or by their numeric IDs.\n",[60,524,525],{"class":62,"line":247},[60,526,527],{"class":141},"; Default Values: user and group are set as the running user\n",[60,529,530],{"class":62,"line":253},[60,531,532],{"class":141},";                 mode is set to 0660\n",[60,534,535],{"class":62,"line":259},[60,536,537],{"class":160},"- listen.owner = http\n",[60,539,540],{"class":62,"line":265},[60,541,542],{"class":70},"+ listen.owner = caddy\n",[60,544,545],{"class":62,"line":271},[60,546,547],{"class":160},"- listen.group = http\n",[60,549,550],{"class":62,"line":277},[60,551,552],{"class":70},"+ listen.group = caddy\n",[60,554,555],{"class":62,"line":283},[60,556,557],{"class":141},";listen.mode = 0660\n",[60,559,560],{"class":62,"line":289},[60,561,562],{"class":141},"; When POSIX Access Control Lists are supported you can set them using\n",[60,564,565],{"class":62,"line":295},[60,566,567],{"class":141},"; these options, value is a comma separated list of user/group names.\n",[60,569,570],{"class":62,"line":301},[60,571,572],{"class":141},"; When set, listen.owner and listen.group are ignored\n",[60,574,575],{"class":62,"line":307},[60,576,577],{"class":141},";listen.acl_users =\n",[60,579,580],{"class":62,"line":313},[60,581,582],{"class":141},";listen.acl_groups =\n",[60,584,585],{"class":62,"line":319},[60,586,439],{"class":141},[22,588,589,593,594,597],{},[590,591,592],"strong",{},"2022年1月14日更新","：在 Fedora 尝试部署的时候遇到了新的坑，Fedora 的相应配置文件为 ",[42,595,596],{},"/etc/php-fpm.d/www.conf","，相应修改如下",[51,599,601],{"className":132,"code":600,"language":134,"meta":56,"style":56},"; Unix user/group of processes\n; Note: The user is mandatory. If the group is not set, the default user's group\n;       will be used.\n; RPM: apache user chosen to provide access to the same directories as httpd\n-user = apache\n+user = caddy\n; RPM: Keep a group allowed to write in log dir.\n-user = apache\n+group = caddy\n\n; The address on which to accept FastCGI requests.\n; Valid syntaxes are:\n;   'ip.add.re.ss:port'    - to listen on a TCP socket to a specific IPv4 address on\n;             a specific port;\n---\n---\n; Set permissions for unix socket, if one is used. In Linux, read/write\n; permissions must be set in order to allow connections from a web server.\n; Default Values: user and group are set as the running user\n;                 mode is set to 0660\n-;listen.owner = nobody\n+listen.owner = caddy\n-;listen.owner = nobody\n+listen.group = caddy\n;listen.mode = 0660\n\n; When POSIX Access Control Lists are supported you can set them using\n; these options, value is a comma separated list of user/group names.\n; When set, listen.owner and listen.group are ignored\n-listen.acl_users = apache,nginx\n+;listen.acl_users = apache,nginx\n;listen.acl_groups =\n\n; List of addresses (IPv4/IPv6) of FastCGI clients which are allowed to connect.\n; Equivalent to the FCGI_WEB_SERVER_ADDRS environment variable in the original\n; PHP FCGI (5.2.2+). Makes sense only with a tcp listening socket. Each address\n; must be separated by a comma. If this value is left blank, connections will be\n; accepted from any ip address.\n; Default Value: any\nlisten.allowed_clients = 127.0.0.1\n",[42,602,603,607,611,615,620,625,630,635,639,644,650,654,658,662,667,671,675,680,685,689,693,698,703,707,712,716,720,724,728,732,737,742,746,750,755,760,765,770,775,780],{"__ignoreMap":56},[60,604,605],{"class":62,"line":63},[60,606,444],{"class":141},[60,608,609],{"class":62,"line":145},[60,610,449],{"class":141},[60,612,613],{"class":62,"line":151},[60,614,454],{"class":141},[60,616,617],{"class":62,"line":157},[60,618,619],{"class":141},"; RPM: apache user chosen to provide access to the same directories as httpd\n",[60,621,622],{"class":62,"line":164},[60,623,624],{"class":160},"-user = apache\n",[60,626,627],{"class":62,"line":170},[60,628,629],{"class":70},"+user = caddy\n",[60,631,632],{"class":62,"line":176},[60,633,634],{"class":141},"; RPM: Keep a group allowed to write in log dir.\n",[60,636,637],{"class":62,"line":182},[60,638,624],{"class":160},[60,640,641],{"class":62,"line":188},[60,642,643],{"class":70},"+group = caddy\n",[60,645,646],{"class":62,"line":3},[60,647,649],{"emptyLinePlaceholder":648},true,"\n",[60,651,652],{"class":62,"line":199},[60,653,479],{"class":141},[60,655,656],{"class":62,"line":205},[60,657,484],{"class":141},[60,659,660],{"class":62,"line":211},[60,661,489],{"class":141},[60,663,664],{"class":62,"line":217},[60,665,666],{"class":141},";             a specific port;\n",[60,668,669],{"class":62,"line":223},[60,670,439],{"class":141},[60,672,673],{"class":62,"line":229},[60,674,439],{"class":141},[60,676,677],{"class":62,"line":235},[60,678,679],{"class":141},"; Set permissions for unix socket, if one is used. In Linux, read/write\n",[60,681,682],{"class":62,"line":241},[60,683,684],{"class":141},"; permissions must be set in order to allow connections from a web server.\n",[60,686,687],{"class":62,"line":247},[60,688,527],{"class":141},[60,690,691],{"class":62,"line":253},[60,692,532],{"class":141},[60,694,695],{"class":62,"line":259},[60,696,697],{"class":160},"-;listen.owner = nobody\n",[60,699,700],{"class":62,"line":265},[60,701,702],{"class":70},"+listen.owner = caddy\n",[60,704,705],{"class":62,"line":271},[60,706,697],{"class":160},[60,708,709],{"class":62,"line":277},[60,710,711],{"class":70},"+listen.group = caddy\n",[60,713,714],{"class":62,"line":283},[60,715,557],{"class":141},[60,717,718],{"class":62,"line":289},[60,719,649],{"emptyLinePlaceholder":648},[60,721,722],{"class":62,"line":295},[60,723,562],{"class":141},[60,725,726],{"class":62,"line":301},[60,727,567],{"class":141},[60,729,730],{"class":62,"line":307},[60,731,572],{"class":141},[60,733,734],{"class":62,"line":313},[60,735,736],{"class":160},"-listen.acl_users = apache,nginx\n",[60,738,739],{"class":62,"line":319},[60,740,741],{"class":70},"+;listen.acl_users = apache,nginx\n",[60,743,744],{"class":62,"line":325},[60,745,582],{"class":141},[60,747,748],{"class":62,"line":331},[60,749,649],{"emptyLinePlaceholder":648},[60,751,752],{"class":62,"line":337},[60,753,754],{"class":141},"; List of addresses (IPv4/IPv6) of FastCGI clients which are allowed to connect.\n",[60,756,757],{"class":62,"line":343},[60,758,759],{"class":141},"; Equivalent to the FCGI_WEB_SERVER_ADDRS environment variable in the original\n",[60,761,762],{"class":62,"line":349},[60,763,764],{"class":141},"; PHP FCGI (5.2.2+). Makes sense only with a tcp listening socket. Each address\n",[60,766,767],{"class":62,"line":355},[60,768,769],{"class":141},"; must be separated by a comma. If this value is left blank, connections will be\n",[60,771,772],{"class":62,"line":361},[60,773,774],{"class":141},"; accepted from any ip address.\n",[60,776,777],{"class":62,"line":367},[60,778,779],{"class":141},"; Default Value: any\n",[60,781,782],{"class":62,"line":373},[60,783,784],{"class":141},"listen.allowed_clients = 127.0.0.1\n",[37,786,788],{"id":787},"拉取-picuploader-最新代码","拉取 PicUploader 最新代码",[22,790,791],{},"首先创建一个用于存放代码的目录",[51,793,795],{"className":53,"code":794,"language":55,"meta":56,"style":56},"sudo mkdir -p /var/www/\n",[42,796,797],{"__ignoreMap":56},[60,798,799,801,804,807],{"class":62,"line":63},[60,800,67],{"class":66},[60,802,803],{"class":70}," mkdir",[60,805,806],{"class":74}," -p",[60,808,809],{"class":70}," /var/www/\n",[22,811,812],{},"clone 最新源码",[51,814,816],{"className":53,"code":815,"language":55,"meta":56,"style":56},"sudo git clone https://github.com/xiebruce/PicUploader.git /var/www/picuploader\n",[42,817,818],{"__ignoreMap":56},[60,819,820,822,825,828,831],{"class":62,"line":63},[60,821,67],{"class":66},[60,823,824],{"class":70}," git",[60,826,827],{"class":70}," clone",[60,829,830],{"class":70}," https://github.com/xiebruce/PicUploader.git",[60,832,833],{"class":70}," /var/www/picuploader\n",[22,835,836],{},"将代码所有权转交给caddy用户",[51,838,840],{"className":53,"code":839,"language":55,"meta":56,"style":56},"sudo chown -R caddy:caddy /var/www/picuploader\n",[42,841,842],{"__ignoreMap":56},[60,843,844,846,849,852,855],{"class":62,"line":63},[60,845,67],{"class":66},[60,847,848],{"class":70}," chown",[60,850,851],{"class":74}," -R",[60,853,854],{"class":70}," caddy:caddy",[60,856,833],{"class":70},[37,858,860],{"id":859},"编辑caddyfile","编辑Caddyfile",[22,862,863,864,867],{},"caddy默认使用",[42,865,866],{},"/etc/caddy/Caddyfile","，因此如果你就部署这一个站点，直接修改这个就好了。",[22,869,870],{},"caddy的语法非常简洁易懂，因此我随手写了几行就能跑起来了。",[22,872,873,874,877],{},"下面是我用的Caddyfile，如果你在服务器上部署，请把",[42,875,876],{},"http://api.picuploader.com","更换为你服务器所需要绑定的域名(不带http协议头)，caddy将自动为你申请ssl证书。",[51,879,884],{"className":880,"code":882,"language":883},[881],"language-text","http://api.picuploader.com {\n        root * /var/www/picuploader\n\n        php_fastcgi * unix//run/php-fpm/php-fpm.sock {\n                index dashboard.php\n        }\n\n        file_server {\n                index index.php\n        }\n\n        handle_errors {\n        root * /etc/caddy/error\n                rewrite * /error.html\n                templates\n                file_server\n        }\n}\n\n# Import additional caddy config files in /etc/caddy/conf.d/\nimport /etc/caddy/conf.d/*\n","text",[42,885,882],{"__ignoreMap":56},[22,887,888,889,892,893,895,896,899],{},"php我选择了监听本地",[42,890,891],{},"unix//run/php-fpm/php-fpm.sock","的方案，这个路径在上文的",[42,894,428],{},"可以设置，如需查询，直接使用 ",[42,897,898],{},"grep listen\\ = /etc/php/php-fpm.d/www.conf","应该就能看见。",[98,901,903],{"id":902},"设置访问密码可选","设置访问密码（可选）",[22,905,906,907,910],{},"caddy2开始不允许在caddyfile中直接指定明文密码，因此我们需要用",[42,908,909],{},"hash-password","获取加密后的密码密文",[51,912,914],{"className":53,"code":913,"language":55,"meta":56,"style":56},"caddy hash-password  --plaintext \u003CYourPassword>\n",[42,915,916],{"__ignoreMap":56},[60,917,918,920,923,926,929,932],{"class":62,"line":63},[60,919,44],{"class":66},[60,921,922],{"class":70}," hash-password",[60,924,925],{"class":74},"  --plaintext",[60,927,928],{"class":141}," \u003C",[60,930,931],{"class":70},"YourPasswor",[60,933,934],{"class":141},"d>\n",[22,936,937],{},"再在Caddyfile中，加上",[51,939,942],{"className":940,"code":941,"language":883},[881],"basicauth /* {\n        \u003Cusername> \u003Chashed_password>\n}\n",[42,943,941],{"__ignoreMap":56},[37,945,947],{"id":946},"修改hosts设置dns解析","修改hosts/设置DNS解析",[22,949,950],{},"由于 api.picuploader.com 这个域名不在我手里，而我只是想在本地使用，并不打算部署到服务器，因此修改hosts将这个域名解析到本地是个不错的选择。",[51,952,954],{"className":53,"code":953,"language":55,"meta":56,"style":56},"sudo sh -c \"echo '127.0.0.1     api.picuploader.com'  /etc/hosts\"\n",[42,955,956],{"__ignoreMap":56},[60,957,958,960,963,966],{"class":62,"line":63},[60,959,67],{"class":66},[60,961,962],{"class":70}," sh",[60,964,965],{"class":74}," -c",[60,967,968],{"class":70}," \"echo '127.0.0.1     api.picuploader.com'  /etc/hosts\"\n",[22,970,971],{},"而你若是在服务器上部署，应当去设置DNS解析，这个应该不需要我多说。",[37,973,974],{"id":974},"开启服务",[22,976,977,978,45,980,982],{},"在Archlinux下，我习惯直接用systemd运行",[42,979,44],{},[42,981,48],{},"以开机自启动。",[51,984,986],{"className":53,"code":985,"language":55,"meta":56,"style":56},"sudo systemctl enable --now caddy php-fpm\n",[42,987,988],{"__ignoreMap":56},[60,989,990,992,995,998,1001,1003],{"class":62,"line":63},[60,991,67],{"class":66},[60,993,994],{"class":70}," systemctl",[60,996,997],{"class":70}," enable",[60,999,1000],{"class":74}," --now",[60,1002,78],{"class":70},[60,1004,1005],{"class":70}," php-fpm\n",[37,1007,1008],{"id":1008},"最终测试",[22,1010,1011,1012,1016],{},"在浏览器内访问 ",[29,1013,1015],{"href":876,"rel":1014},[33],"api.picuploader.com"," ，如果能看到页面，就算是成功啦。",[37,1018,1019],{"id":1019},"设置上传参数",[22,1021,1022,1023],{},"见作者博客：",[29,1024,1027],{"href":1025,"rel":1026},"https://www.xiebruce.top/117.html",[33],"PicUploader: 各图床获取上传图片参数的方法",[1029,1030,1031],"style",{},"html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html pre.shiki code .sJa8x, html code.shiki .sJa8x{--shiki-default:#E45649;--shiki-dark:#E06C75}",{"title":56,"searchDepth":145,"depth":145,"links":1033},[1034,1035,1043,1044,1047,1048,1049,1050],{"id":39,"depth":145,"text":39},{"id":93,"depth":145,"text":93,"children":1036},[1037,1039,1041],{"id":100,"depth":151,"text":1038},"在/etc/php/php.ini启用PicUploader所需拓展",{"id":397,"depth":151,"text":1040},"编辑/etc/php/php.ini以增加单文件上传大小限制",{"id":425,"depth":151,"text":1042},"编辑/etc/php/php-fpm.d/www.conf使其在运行时使用caddy用户。",{"id":787,"depth":145,"text":788},{"id":859,"depth":145,"text":860,"children":1045},[1046],{"id":902,"depth":151,"text":903},{"id":946,"depth":145,"text":947},{"id":974,"depth":145,"text":974},{"id":1008,"depth":145,"text":1008},{"id":1019,"depth":145,"text":1019},{"title":1052,"date":1053,"path":1054,"tags":1055,"body":1056},"Archlinux坚果云踩坑实录","2021-10-02 00:21:34","/2021/10/02/nutstore-guide-on-archlinux-kde",[11],{"type":16,"value":1057,"toc":1367},[1058,1063,1065,1080,1083,1086,1089,1095,1102,1108,1114,1135,1138,1141,1147,1153,1159,1163,1169,1177,1207,1213,1217,1220,1226,1233,1263,1267,1270,1288,1294,1364],[19,1059,1060],{},[22,1061,1062],{},"在Archlinux上，坚果云似乎出现了一些问题。",[37,1064,40],{"id":40},[51,1066,1068],{"className":53,"code":1067,"language":55,"meta":56,"style":56},"yay -S nutstore\n",[42,1069,1070],{"__ignoreMap":56},[60,1071,1072,1075,1077],{"class":62,"line":63},[60,1073,1074],{"class":66},"yay",[60,1076,75],{"class":74},[60,1078,1079],{"class":70}," nutstore\n",[22,1081,1082],{},"这个没什么可说的，AUR还是Archlinuxcn都无所谓，都是一模一样的。",[37,1084,1085],{"id":1085},"白屏",[22,1087,1088],{},"双击图标，咦？怎么白屏了？",[22,1090,1091],{},[1092,1093],"img",{"alt":1085,"src":1094},"https://static.031130.xyz/uploads/2024/08/12/62f3cc797bc09.webp",[22,1096,1097,1098,1101],{},"看看AUR评论区，有人说",[42,1099,1100],{},"nutstore-experimental","修了？",[22,1103,1104],{},[1092,1105],{"alt":1106,"src":1107},"AUR评论区","https://static.031130.xyz/uploads/2024/08/12/62f3cc7df08ad.webp",[22,1109,1110,1111],{},"对比了一下，就是改了改",[42,1112,1113],{},"/opt/nutstore/conf/nutstore.properties",[51,1115,1117],{"className":53,"code":1116,"language":55,"meta":56,"style":56},"sudo sed -i 's|webui.enable=true|webui.enable=false|' /opt/nutstore/conf/nutstore.properties\n",[42,1118,1119],{"__ignoreMap":56},[60,1120,1121,1123,1126,1129,1132],{"class":62,"line":63},[60,1122,67],{"class":66},[60,1124,1125],{"class":70}," sed",[60,1127,1128],{"class":74}," -i",[60,1130,1131],{"class":70}," 's|webui.enable=true|webui.enable=false|'",[60,1133,1134],{"class":70}," /opt/nutstore/conf/nutstore.properties\n",[22,1136,1137],{},"轻松解决",[37,1139,1140],{"id":1140},"窗口太小不能登陆",[22,1142,1143],{},[1092,1144],{"alt":1145,"src":1146},"调出窗口规则设置界面","https://static.031130.xyz/uploads/2024/08/12/62f3cc822fbe9.webp",[22,1148,1149],{},[1092,1150],{"alt":1151,"src":1152},"进行设置","https://static.031130.xyz/uploads/2024/08/12/62f3cc864a783.webp",[22,1154,1155],{},[1092,1156],{"alt":1157,"src":1158},"完成","https://static.031130.xyz/uploads/2024/08/12/62f3cc89ca4eb.webp",[37,1160,1162],{"id":1161},"桌面使用了暗色主题导致部分字体不清晰","桌面使用了暗色主题导致部分字体不清晰？",[22,1164,1165],{},[1092,1166],{"alt":1167,"src":1168},"这字体鬼看得见？","https://static.031130.xyz/uploads/2024/08/12/62f3cc8f193b1.webp",[22,1170,1171,1172,1176],{},"参考",[29,1173,1175],{"href":1174},"/2021/09/05/wrong-fonts-color-fix-under-kde-with-a-dark-theme/","使用fakehome方案暂时解决跑在KDE暗色主题下的程序使用亮色字体的问题","编写启动命令",[51,1178,1180],{"className":53,"code":1179,"language":55,"meta":56,"style":56},"bwrap --dev-bind / / --tmpfs $HOME/.config /usr/bin/nutstore\n",[42,1181,1182],{"__ignoreMap":56},[60,1183,1184,1187,1190,1193,1195,1198,1201,1204],{"class":62,"line":63},[60,1185,1186],{"class":66},"bwrap",[60,1188,1189],{"class":74}," --dev-bind",[60,1191,1192],{"class":70}," /",[60,1194,1192],{"class":70},[60,1196,1197],{"class":74}," --tmpfs",[60,1199,1200],{"class":160}," $HOME",[60,1202,1203],{"class":70},"/.config",[60,1205,1206],{"class":70}," /usr/bin/nutstore\n",[22,1208,1209],{},[1092,1210],{"alt":1211,"src":1212},"测试通过","https://static.031130.xyz/uploads/2024/08/12/62f3cc9245d26.webp",[37,1214,1216],{"id":1215},"本地markdown文件的文件类型被识别成了坚果云-markdown","本地markdown文件的文件类型被识别成了「坚果云 Markdown」",[22,1218,1219],{},"这个是由于坚果云自作主张推广他自己并不好用的lightapp，写了几条 mime 的规则，如图",[22,1221,1222],{},[1092,1223],{"alt":1224,"src":1225},"没错，整整5个xml","https://static.031130.xyz/uploads/2024/08/12/62f3cc95f0dd1.webp",[22,1227,1228,1229,1232],{},"看来在我们的启动命令中也需要防止坚果云接触到",[42,1230,1231],{},"$HOME/.local/share/","这个路径，所以现在的启动命令得写成这样。",[51,1234,1236],{"className":53,"code":1235,"language":55,"meta":56,"style":56},"bwrap --dev-bind / / --tmpfs $HOME/.config --tmpfs $HOME/.local/share/ /usr/bin/nutstore\n",[42,1237,1238],{"__ignoreMap":56},[60,1239,1240,1242,1244,1246,1248,1250,1252,1254,1256,1258,1261],{"class":62,"line":63},[60,1241,1186],{"class":66},[60,1243,1189],{"class":74},[60,1245,1192],{"class":70},[60,1247,1192],{"class":70},[60,1249,1197],{"class":74},[60,1251,1200],{"class":160},[60,1253,1203],{"class":70},[60,1255,1197],{"class":74},[60,1257,1200],{"class":160},[60,1259,1260],{"class":70},"/.local/share/",[60,1262,1206],{"class":70},[37,1264,1266],{"id":1265},"修改desktop文件使其使用我们自己攥写的启动命令","修改desktop文件，使其使用我们自己攥写的启动命令",[22,1268,1269],{},"首先，复制一份desktop文件到我们的 $HOME 目录下，好处是下次更新的时候我们所做的更改不会被包管理器覆盖。",[51,1271,1273],{"className":53,"code":1272,"language":55,"meta":56,"style":56},"cp /usr/share/applications/nutstore.desktop $HOME/.local/share/applications/\n",[42,1274,1275],{"__ignoreMap":56},[60,1276,1277,1280,1283,1285],{"class":62,"line":63},[60,1278,1279],{"class":66},"cp",[60,1281,1282],{"class":70}," /usr/share/applications/nutstore.desktop",[60,1284,1200],{"class":160},[60,1286,1287],{"class":70},"/.local/share/applications/\n",[22,1289,1290,1291],{},"再修改",[42,1292,1293],{},"$HOME/.local/share/applications/nutstore.desktop",[51,1295,1297],{"className":132,"code":1296,"language":134,"meta":56,"style":56},"[Desktop Entry]\nEncoding=UTF-8\nType=Application\nTerminal=false\nIcon=nutstore\n-Exec=/usr/bin/nutstore\n+Exec=bwrap --dev-bind / / --tmpfs $HOME/.config --tmpfs $HOME/.local/share/applications --tmpfs $HOME/.local/share/mime /usr/bin/nutstore\nStartupWMClass=Nutstore\nName=Nutstore\nName[zh_CN]=坚果云 \nComment=Data Sync, Sharing, Backup\nComment[zh_CN]=数据同步,共享和备份\nCategories=Network;Application;\n",[42,1298,1299,1304,1309,1314,1319,1324,1329,1334,1339,1344,1349,1354,1359],{"__ignoreMap":56},[60,1300,1301],{"class":62,"line":63},[60,1302,1303],{"class":141},"[Desktop Entry]\n",[60,1305,1306],{"class":62,"line":145},[60,1307,1308],{"class":141},"Encoding=UTF-8\n",[60,1310,1311],{"class":62,"line":151},[60,1312,1313],{"class":141},"Type=Application\n",[60,1315,1316],{"class":62,"line":157},[60,1317,1318],{"class":141},"Terminal=false\n",[60,1320,1321],{"class":62,"line":164},[60,1322,1323],{"class":141},"Icon=nutstore\n",[60,1325,1326],{"class":62,"line":170},[60,1327,1328],{"class":160},"-Exec=/usr/bin/nutstore\n",[60,1330,1331],{"class":62,"line":176},[60,1332,1333],{"class":70},"+Exec=bwrap --dev-bind / / --tmpfs $HOME/.config --tmpfs $HOME/.local/share/applications --tmpfs $HOME/.local/share/mime /usr/bin/nutstore\n",[60,1335,1336],{"class":62,"line":182},[60,1337,1338],{"class":141},"StartupWMClass=Nutstore\n",[60,1340,1341],{"class":62,"line":188},[60,1342,1343],{"class":141},"Name=Nutstore\n",[60,1345,1346],{"class":62,"line":3},[60,1347,1348],{"class":141},"Name[zh_CN]=坚果云 \n",[60,1350,1351],{"class":62,"line":199},[60,1352,1353],{"class":141},"Comment=Data Sync, Sharing, Backup\n",[60,1355,1356],{"class":62,"line":205},[60,1357,1358],{"class":141},"Comment[zh_CN]=数据同步,共享和备份\n",[60,1360,1361],{"class":62,"line":211},[60,1362,1363],{"class":141},"Categories=Network;Application;\n",[1029,1365,1366],{},"html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html pre.shiki code .sJa8x, html code.shiki .sJa8x{--shiki-default:#E45649;--shiki-dark:#E06C75}html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}",{"title":56,"searchDepth":145,"depth":145,"links":1368},[1369,1370,1371,1372,1373,1374],{"id":40,"depth":145,"text":40},{"id":1085,"depth":145,"text":1085},{"id":1140,"depth":145,"text":1140},{"id":1161,"depth":145,"text":1162},{"id":1215,"depth":145,"text":1216},{"id":1265,"depth":145,"text":1266},{"title":1376,"date":1377,"path":1378,"tags":1379,"body":1383},"把老版的火狐顶栏UI带回来","2021-10-01 19:20:23","/2021/10/01/bring-firefox-old-topbar-back",[1380,1381,1382],"Firefox","Linux","Bwrap",{"type":16,"value":1384,"toc":1545},[1385,1391,1397,1408,1411,1417,1446,1453,1460,1465,1476,1482,1485,1491,1494,1503,1509,1512,1530,1536,1542],[22,1386,1387],{},[1092,1388],{"alt":1389,"src":1390},"这是最新版火狐的顶栏","https://static.031130.xyz/uploads/2024/08/12/62f3cca6bb523.webp",[22,1392,1393],{},[1092,1394],{"alt":1395,"src":1396},"这是去掉标题栏后的样子","https://static.031130.xyz/uploads/2024/08/12/62f3ccaa2b91c.webp",[19,1398,1399],{},[22,1400,1401,1402,1407],{},"在Firefox更新UI以后，我就一直感觉不太适应。顶栏的一个个标签页占用的体积达到了原来的1.5~2倍。Thanks to ",[29,1403,1406],{"href":1404,"rel":1405},"https://github.com/black7375/Firefox-UI-Fix",[33],"black7375/Firefox-UI-Fix"," ，我们得以把以前的顶栏找回来。",[98,1409,1410],{"id":1410},"加载新的css",[22,1412,1413,1414],{},"clone该github项目并进入对应路径后，执行",[42,1415,1416],{},"install.sh",[51,1418,1420],{"className":53,"code":1419,"language":55,"meta":56,"style":56},"git clone https://github.com/black7375/Firefox-UI-Fix.git\ncd Firefox-UI-Fix.git\n./install.sh\n",[42,1421,1422,1432,1441],{"__ignoreMap":56},[60,1423,1424,1427,1429],{"class":62,"line":63},[60,1425,1426],{"class":66},"git",[60,1428,827],{"class":70},[60,1430,1431],{"class":70}," https://github.com/black7375/Firefox-UI-Fix.git\n",[60,1433,1434,1438],{"class":62,"line":145},[60,1435,1437],{"class":1436},"s_Sar","cd",[60,1439,1440],{"class":70}," Firefox-UI-Fix.git\n",[60,1442,1443],{"class":62,"line":151},[60,1444,1445],{"class":66},"./install.sh\n",[22,1447,1448,1449,1452],{},"在接下来的对话中，我们选择",[42,1450,1451],{},"Photon-Style","，这是最接近老版UI的。",[22,1454,1455,1456,1459],{},"紧接着脚本会要求我们选择我们的Firefox数据文件夹，我们可以打开Firefox，在浏览器地址栏输入",[42,1457,1458],{},"about:support","查看到我们所使用的数据文件夹路径。",[22,1461,1462],{},[1092,1463],{"alt":1458,"src":1464},"https://static.031130.xyz/uploads/2024/08/12/62f3ccadd6ce8.webp",[22,1466,1467,1468,1471,1472,1475],{},"使用空格键选择我们的数据文件夹后，在终端上该路径开头处的",[42,1469,1470],{},"[ ]","中会被打上",[42,1473,1474],{},"X","，确认无误后，敲回车。",[22,1477,1478],{},[1092,1479],{"alt":1480,"src":1481},"终端显示","https://static.031130.xyz/uploads/2024/08/12/62f3ccb1b0ebf.webp",[22,1483,1484],{},"重启浏览器，顶栏就长成了这样。",[22,1486,1487],{},[1092,1488],{"alt":1489,"src":1490},"Fix后的顶栏效果","https://static.031130.xyz/uploads/2024/08/12/62f3ccb49ff10.webp",[98,1492,1493],{"id":1493},"添加主题",[22,1495,1496,1497,1502],{},"为了进一步模仿Firefox经典的配色，我们可以安装上",[29,1498,1501],{"href":1499,"rel":1500},"https://addons.mozilla.org/zh-CN/firefox/addon/photon-colors/",[33],"这个主题","，变成这样",[22,1504,1505],{},[1092,1506],{"alt":1507,"src":1508},"应用主题后的样子","https://static.031130.xyz/uploads/2024/08/12/62f3ccb7bc14f.webp",[98,1510,1511],{"id":1511},"禁用暗色模式",[22,1513,1514,1515,1520,1521,1529],{},"如果你的系统主题使用的是深色，导致了诸如",[29,1516,1519],{"href":1517,"rel":1518},"https://mirrors.tuna.tsinghua.edu.cn",[33],"TUNA镜像站","自动为你启用了暗色模式，而你想禁用的话，",[29,1522,1524,1525,1528],{"href":1523},"/2021/04/23/disable-firefox-nightmode-when-your-system-is-using-that/","之前通过修改",[42,1526,1527],{},"about:config","方案","依然适用。",[22,1531,1532],{},[1092,1533],{"alt":1534,"src":1535},"修改前","https://static.031130.xyz/uploads/2024/08/12/62f3ccbb36c5e.webp",[22,1537,1538],{},[1092,1539],{"alt":1540,"src":1541},"修改后","https://static.031130.xyz/uploads/2024/08/12/62f3ccbe6f31a.webp",[1029,1543,1544],{},"html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html pre.shiki code .s_Sar, html code.shiki .s_Sar{--shiki-default:#0184BC;--shiki-dark:#56B6C2}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}",{"title":56,"searchDepth":145,"depth":145,"links":1546},[1547,1548,1549],{"id":1410,"depth":151,"text":1410},{"id":1493,"depth":151,"text":1493},{"id":1511,"depth":151,"text":1511},{"title":1551,"date":1552,"path":1553,"tags":1554,"body":1556},"记录一次原创文章被抄袭","2021-09-21","/2021/09/21/csdn-copied-my-article",[1555],"Blog",{"type":16,"value":1557,"toc":1647},[1558,1567,1570,1576,1579,1582,1588,1594,1600,1606,1612,1615,1638,1644],[22,1559,1560,1561,1566],{},"今天在网站自搜的时候偶然间发现了一个叫「程序员宝宝」的站点转载了我去年在知乎专栏上发的一篇文章",[29,1562,1565],{"href":1563,"rel":1564},"https://zhuanlan.zhihu.com/p/141107518",[33],"《Ubuntu下对deepin-wine的使用详解》","。",[22,1568,1569],{},"转载的质量并不高，超链接都没有转载上去，只有干巴巴的图片和文字。翻到结尾处，我一口老血喷出。",[22,1571,1572],{},[1092,1573],{"alt":1574,"src":1575},"都不知道哪里来的版权申明","https://static.031130.xyz/uploads/2024/08/12/62f3cacc1ff3f.webp",[22,1577,1578],{},"我就纳闷了，我作为原创博主，自己都没有给这篇文章挂上CC的版权协议，怎么就有人自称是原创给我挂上了CC协议，要知道我知乎还明确勾选了「转载需要申请」呢。",[22,1580,1581],{},"抱着吃瓜的心态在谷歌上搜索，我发现了五篇抄袭我的文章。CSDN三篇，还有「程序员宝宝」和「程序员宅基地」使用相同UI的、被我怀疑是机器人搬运的站点。",[22,1583,1584],{},[1092,1585],{"alt":1586,"src":1587},"谷歌搜索结果","https://static.031130.xyz/uploads/2024/08/12/62f3cad01576d.webp",[22,1589,1590,1591],{},"CSDN那边，我在页面页脚处找到了「在线客服」，注册帐号后联系了客服，客服反应非常迅速，",[590,1592,1593],{},"5分钟内就对抄袭文章进行了下架处理，这点值得表扬。",[22,1595,1596],{},[1092,1597],{"alt":1598,"src":1599},"CSDN客服聊天记录1","https://static.031130.xyz/uploads/2024/08/12/62f3cad3ceaa6.webp",[22,1601,1602],{},[1092,1603],{"alt":1604,"src":1605},"CSDN客服聊天记录2","https://static.031130.xyz/uploads/2024/08/12/62f3cad833827.webp",[22,1607,1608],{},[1092,1609],{"alt":1610,"src":1611},"CSDN客服聊天记录3","https://static.031130.xyz/uploads/2024/08/12/62f3cadacac4d.webp",[22,1613,1614],{},"至于「程序员宝宝」和「程序员宅基地」这两个站点，在他们的版权申明中写得很清楚。",[19,1616,1617,1622,1625,1635],{},[22,1618,1619],{},[590,1620,1621],{},"如果你是文章作者：",[22,1623,1624],{},"请通过邮件联系我们，邮件内容包括：",[1626,1627,1628,1632],"ol",{},[1629,1630,1631],"li",{},"待删除的文章链接",[1629,1633,1634],{},"发件人是待删除文章作者的证明（如果发件人邮箱地址能证明你是文章作者，此项内容可以为空）",[22,1636,1637],{},"我们会在收到邮件后7个工作日内进行处理。",[22,1639,1640,1641],{},"但我找遍了整个网站，",[590,1642,1643],{},"根本没有发现站点方的邮箱。",[22,1645,1646],{},"不知诸位有何解决方案？",{"title":56,"searchDepth":145,"depth":145,"links":1648},[],{"title":1650,"date":1651,"path":1652,"tags":1653,"body":1654},"使用AUR(Helper)安装软件时究竟发生了什么？对于常见的构建错误如何解决？","2021-09-11 19:22:29","/2021/09/11/detailed-explanation-for-aur",[1381,11],{"type":16,"value":1655,"toc":2079},[1656,1661,1665,1672,1679,1685,1720,1723,1726,1751,1754,1775,1781,1785,1792,1798,1802,1805,1809,1816,1822,1825,1846,1848,1851,1857,1863,1867,1992,1996,1999,2006,2013,2026,2030,2033,2035,2038,2044,2047,2065,2068,2076],[19,1657,1658],{},[22,1659,1660],{},"虽然对于没有能力手动修改/编写PKGBUILD的Arch用户其实是不应该使用AUR中的包的，这些软件的PKGBUILD可以由个人随意发布，并不能保证安全性，但是作为Archlinux的特色，但随着AUR Helper的趋于便利，还是吸引了不少小白使用AUR。本文将主要讲一讲 AUR Helper 帮助我们安装软件时到底做了些什么事情，并提供一些使用AUR Helper构建时常见错误的解决方案。",[37,1662,1664],{"id":1663},"partⅰ基本原理","PartⅠ基本原理",[98,1666,1668,1671],{"id":1667},"makepkg是如何工作的",[42,1669,1670],{},"makepkg","是如何工作的？",[22,1673,1674,1675,1678],{},"以钉钉举例，我们可以从AUR上使用 ",[42,1676,1677],{},"git clone https://aur.archlinux.org/dingtalk-bin.git"," 获取到由这个包的维护者为我们提前写好的构建脚本。他的目录大概是长成下面这个样子:",[51,1680,1683],{"className":1681,"code":1682,"language":883},[881],"dingtalk-bin\n├── com.alibabainc.dingtalk.desktop\n├── dingtalk.sh\n├── .git\n├── .gitignore\n├── PKGBUILD\n├── service-terms-zh\n└── .SRCINFO\n",[42,1684,1682],{"__ignoreMap":56},[1686,1687,1688,1695,1701,1707],"ul",{},[1629,1689,1690,1691,1694],{},"其中，",[42,1692,1693],{},".git","是git的工作目录，可以忽视。",[1629,1696,1697,1700],{},[42,1698,1699],{},".gitignore","属于git的配置文件之一，我们也不用管。",[1629,1702,1703,1706],{},[42,1704,1705],{},"PKGBUILD","是这个目录下最重要的东西，是一个用于提供参数的脚本。makepkg通过执行PKGBUILD脚本来获取到参数，自动进行下载和构建过程。",[1629,1708,1709,1712,1713,1712,1716,1719],{},[42,1710,1711],{},"service-terms-zh",", ",[42,1714,1715],{},"com.alibabainc.dingtalk.desktop",[42,1717,1718],{},"dingtalk.sh","是包里所需要用到的东西。",[1721,1722],"hr",{},[22,1724,1725],{},"当我们cd到这个目录下执行makepkg时，",[22,1727,1728,1729,1731,1732,1734,1735,1738,1739,1742,1743,1746,1747,1750],{},"makepkg会调用",[42,1730,118],{}," / ",[42,1733,1426],{},"下载PKGBUILD中",[42,1736,1737],{},"source=()","部分中以",[42,1740,1741],{},"http(s)","协议头或者",[42,1744,1745],{},"git+","开头的链接，这些东西将会被下载到这个目录的",[42,1748,1749],{},"src","文件夹下。",[22,1752,1753],{},"对于curl下载的东西，makepkg会使用校验码核对下载到的文件是否完整、是否是当初这个包的维护者下载到的这一个。",[22,1755,1756,1757,112,1760,112,1763,1766,1767,1771,1772,1750],{},"校验通过后，makepkg会依次执行",[42,1758,1759],{},"prepare(){}",[42,1761,1762],{},"build(){}",[42,1764,1765],{},"package(){}","函数中的命令陆续完成",[1768,1769,1770],"em",{},"准备、编译","过程，并将最终要打进包里的文件放置到",[42,1773,1774],{},"pkg",[22,1776,1777,1778,1780],{},"最后，makepkg将会将",[42,1779,1774],{},"文件夹的内容压缩成包。",[98,1782,1784],{"id":1783},"aur-helper-干了些什么","AUR Helper 干了些什么",[22,1786,1787,1788,1791],{},"我们还是以钉钉为例，看看我们执行",[42,1789,1790],{},"yay dingtalk-bin","时到底发生了什么。",[22,1793,1794],{},[1092,1795],{"alt":1796,"src":1797},"当你使用yay安装软件到底发生了什么","https://static.031130.xyz/uploads/2024/08/12/62f3cdb03ec8c.webp",[37,1799,1801],{"id":1800},"partⅱ常见错误解决方案","PartⅡ常见错误解决方案",[22,1803,1804],{},"如果有其他情况觉得可以完善的，欢迎在评论区留言。",[98,1806,1808],{"id":1807},"_1-base-devel-没有安装","1. base-devel 没有安装",[22,1810,1811,1812,1815],{},"正如上面所说的，没有安装",[42,1813,1814],{},"base-devel","组，赶紧补上!",[22,1817,1818,1819,1821],{},"由于",[42,1820,1814],{},"并不是一个具体的包，而是由多个包构成的包组，其实并没有很好的方法来检测你是否已经安装。",[22,1823,1824],{},"所以如果你不确定，你也可以执行下面的命令来确保自己已经安装。",[51,1826,1828],{"className":53,"code":1827,"language":55,"meta":56,"style":56},"sudo pacman -S base-devel --noconfirm --needed\n",[42,1829,1830],{"__ignoreMap":56},[60,1831,1832,1834,1836,1838,1841,1844],{"class":62,"line":63},[60,1833,67],{"class":66},[60,1835,71],{"class":70},[60,1837,75],{"class":74},[60,1839,1840],{"class":70}," base-devel",[60,1842,1843],{"class":74}," --noconfirm",[60,1845,90],{"class":74},[1721,1847],{},[22,1849,1850],{},"常见表现:",[51,1852,1855],{"className":1853,"code":1854,"language":883},[881],"ERROR: Cannot find the strip binary required for object file stripping.\n",[42,1856,1854],{"__ignoreMap":56},[51,1858,1861],{"className":1859,"code":1860,"language":883},[881],"PKGBUILD: line XXX XXX: command not found\n",[42,1862,1860],{"__ignoreMap":56},[98,1864,1866],{"id":1865},"_2-source源文件下载失败","2. source源文件下载失败",[1626,1868,1869,1977,1983],{},[1629,1870,1871,1875,1876,1879,1883,1885,1886,1566,1889,1907,1909,1920,1928,1930,1931,1934,1935,1938,1939,1941,1944,1946,1947,1974,1976],{},[1872,1873,1874],"h4",{"id":1874},"网络问题","国内的网络问题不用多说了，大多数情况下都是Github连接不上。",[1877,1878],"br",{},[1092,1880],{"alt":1881,"src":1882},"yay下载失败","https://static.031130.xyz/uploads/2024/08/12/62f3cc9c9dda8.webp",[1877,1884],{},"最简单的解决方案就是把source里下载失败的东西通过特殊手段（比如你浏览器设置下代理，或者找找fastgit这种反代）下载下来以后直接扔到PKGBUILD所在的路径，然后手动执行",[42,1887,1888],{},"makepkg -si",[19,1890,1891,1894],{},[22,1892,1893],{},"-s代表自动下载makedepend，-i表示构建成功以后自动安装",[22,1895,1896,1897,1900,1901,1906],{},"yay存放PKGBUILD的默认路径是在",[42,1898,1899],{},"$HOME/.cache/yay/$pkgname","下面，具体可以参考我的另一篇关于",[29,1902,1905],{"href":1903,"rel":1904},"https://blog.zhullyb.top/2021/04/04/yay-more/#builddir-lt-dir-gt",[33],"yay的用法详解","的博客。",[1877,1908],{},[590,1910,1911,1912,1919],{},"我在这里再讲一种使用 ",[29,1913,1916],{"href":1914,"rel":1915},"http://fastgit.org/",[33],[1768,1917,1918],{},"fastgit"," 作为反代加速github下载的方法。",[405,1921,1922,1923,1566],{},"如果觉得fastgit帮助到了你，你可以考虑",[29,1924,1927],{"href":1925,"rel":1926},"http://fastgit.org/donate.html",[33],"给fastgit项目打钱",[1877,1929],{},"当你的yay出现这个询问菜单时，（也就是出现",[42,1932,1933],{},"Diffs to show","/",[42,1936,1937],{},"显示哪些差异？","字样时）",[1877,1940],{},[1092,1942],{"alt":56,"src":1943},"https://static.031130.xyz/uploads/2024/08/12/62f3cca0c7aba.webp",[1877,1945],{},"我们再开一个终端，输入",[51,1948,1950],{"className":53,"code":1949,"language":55,"meta":56,"style":56},"sed -i \"s|github.com|hub.fastgit.org|g\" $HOME/.cache/yay/*/PKGBUILD\n",[42,1951,1952],{"__ignoreMap":56},[60,1953,1954,1957,1959,1962,1964,1967,1971],{"class":62,"line":63},[60,1955,1956],{"class":66},"sed",[60,1958,1128],{"class":74},[60,1960,1961],{"class":70}," \"s|github.com|hub.fastgit.org|g\"",[60,1963,1200],{"class":160},[60,1965,1966],{"class":70},"/.cache/yay/",[60,1968,1970],{"class":1969},"s2QsP","*",[60,1972,1973],{"class":70},"/PKGBUILD\n",[1877,1975],{},"接着就下一步安装即可。",[1629,1978,1979,1982],{},[1872,1980,1981],{"id":1981},"链接失效","这种情况多见于维护者维护不到位，上游放出了新版本包并删除老版本包以后维护者没有及时跟进的。你可以去逛一逛AUR的评论区查看解决方案，或者去查找上游的最新版本是多少，尝试更改PKGBUILD中的pkgver参数和checksum以后尝试makepkg。",[1629,1984,1985,1988,1989],{},[1872,1986,1987],{"id":1987},"需要手动下载","一般情况下是上游没有提供直链，makepkg无法自行下载，需要人工介入。解决方法同上面的",[29,1990,1874],{"href":1991},"#%E7%BD%91%E7%BB%9C%E9%97%AE%E9%A2%98",[98,1993,1995],{"id":1994},"_3-checksum-错误","3. checksum 错误",[22,1997,1998],{},"上文已经提到过，checksum用于判断你所下载到的软件和维护者当初下载到的是否一致。但是有些情况下，确实是维护者忘了更新checksum值了，因此我们需要做一个判断。",[22,2000,2001,2002,2005],{},"打开",[42,2003,2004],{},".SCRINFO","，找到checksum报错的那个文件的链接。",[22,2007,2008,2009,2012],{},"使用wget/curl等工具将他下载下来，可以通过",[42,2010,2011],{},"md5sum+文件名","的方式获取他们的md5值。连续下载两次，核对两次的检验值是否一致。",[22,2014,2015,2016,2019,2020,2023,2024,1566],{},"如果结果一致，那么说明并不是网络波动导致的检验值不符，而是维护者没有及时跟进导致的，你可以使用",[42,2017,2018],{},"yay -S $pkgname --skipchecksums","的方式跳过验证校验值的过程，或者你可以修改PKGBUILD中的校验值为",[42,2021,2022],{},"\"SKIP\"","来跳过某一文件的校验后手动",[42,2025,1670],{},[98,2027,2029],{"id":2028},"_4-tuna反代受限","4. tuna反代受限",[22,2031,2032],{},"tuna的服务器只有一个ip，但当使用他提供的AUR的反代服务时，全国的使用者都会被AUR认为是tuna这一个ip，过大的请求数量可能导致tuna的服务器超出AUR每天给每个ip限制的请求次数。",[1721,2034],{},[22,2036,2037],{},"具体表现:",[51,2039,2042],{"className":2040,"code":2041,"language":883},[881],"Rate limit reached\n",[42,2043,2041],{"__ignoreMap":56},[22,2045,2046],{},"解决方案，改回AUR的服务器，使用自己的ip进行请求",[51,2048,2050],{"className":53,"code":2049,"language":55,"meta":56,"style":56},"yay --aururl \"https://aur.archlinux.org\" --save\n",[42,2051,2052],{"__ignoreMap":56},[60,2053,2054,2056,2059,2062],{"class":62,"line":63},[60,2055,1074],{"class":66},[60,2057,2058],{"class":74}," --aururl",[60,2060,2061],{"class":70}," \"https://aur.archlinux.org\"",[60,2063,2064],{"class":74}," --save\n",[37,2066,2067],{"id":2067},"写在最后",[22,2069,2070,2071],{},"关于AUR使用的更多细节可以阅读 ",[29,2072,2075],{"href":2073,"rel":2074},"https://blog.zhullyb.top/2021/04/04/yay-more/",[33],"《yay进阶》",[1029,2077,2078],{},"html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html pre.shiki code .sJa8x, html code.shiki .sJa8x{--shiki-default:#E45649;--shiki-dark:#E06C75}html pre.shiki code .s2QsP, html code.shiki .s2QsP{--shiki-default:#E45649;--shiki-dark:#E5C07B}",{"title":56,"searchDepth":145,"depth":145,"links":2080},[2081,2086,2092],{"id":1663,"depth":145,"text":1664,"children":2082},[2083,2085],{"id":1667,"depth":151,"text":2084},"makepkg是如何工作的？",{"id":1783,"depth":151,"text":1784},{"id":1800,"depth":145,"text":1801,"children":2087},[2088,2089,2090,2091],{"id":1807,"depth":151,"text":1808},{"id":1865,"depth":151,"text":1866},{"id":1994,"depth":151,"text":1995},{"id":2028,"depth":151,"text":2029},{"id":2067,"depth":145,"text":2067},{"title":1175,"date":2094,"path":2095,"tags":2096,"body":2097},"2021-09-05","/2021/09/05/wrong-fonts-color-fix-under-kde-with-a-dark-theme",[1381,11,1382],{"type":16,"value":2098,"toc":2207},[2099,2108,2121,2124,2127,2135,2140,2147,2150,2174,2177,2192,2199,2204],[22,2100,2101],{},[590,2102,2103,2104,2107],{},"9月6日更新：AUR的",[42,2105,2106],{},"wemeet-bin","维护者sukanka已经将咱的运行指令直接打进了包内，故本文已经基本失去原本的应用意义，但仍可以作为一个案例来解决类似问题。",[19,2109,2110,2113,2116],{},[22,2111,2112],{},"在使用腾讯最近推出的Linux原生腾讯会议的时候，咱遇到了个十分影响体验的问题。",[22,2114,2115],{},"我在使用KDE的暗色主题，腾讯回忆自作主张将字体颜色调成了白色。然而，字体背景是白色的没，因此导致对比度下降，字体难以辨认。效果大概是这个鬼样子:",[22,2117,2118],{},[1092,2119],{"alt":56,"src":2120},"https://static.031130.xyz/uploads/2024/08/12/62f3cb059b229.webp",[22,2122,2123],{},"然而我一时半会儿却找不到合适的变量在运行腾讯会议之前unset，无法指定它使用一个正确的字体颜色。",[22,2125,2126],{},"此时，我想到了fakehome的解决方案——bwrap。",[22,2128,2129,2130,2134],{},"关于bwrap，依云在ta的",[29,2131,34],{"href":2132,"rel":2133},"https://blog.lilydjwg.me/2021/8/12/using-bwrap.215869.html",[33],"里讲过运行原理，我在这里直接摘一小段过来",[19,2136,2137],{},[22,2138,2139],{},"bwrap 的原理是，把 / 放到一个 tmpfs 上，然后需要允许访问的目录通过 bind mount 弄进来。所以没弄进来的部分就是不存在，写数据的话就存在内存里，用完就扔掉了。",[22,2141,2142,2143,2146],{},"而我们要做的，就是开一个tmpfs作为",[42,2144,2145],{},"$HOME/.config","，让腾讯会议读取不到KDE的主题配置文件。",[22,2148,2149],{},"使用如下命令",[51,2151,2153],{"className":53,"code":2152,"language":55,"meta":56,"style":56},"bwrap --dev-bind / / --tmpfs $HOME/.config wemeet\n",[42,2154,2155],{"__ignoreMap":56},[60,2156,2157,2159,2161,2163,2165,2167,2169,2171],{"class":62,"line":63},[60,2158,1186],{"class":66},[60,2160,1189],{"class":74},[60,2162,1192],{"class":70},[60,2164,1192],{"class":70},[60,2166,1197],{"class":74},[60,2168,1200],{"class":160},[60,2170,1203],{"class":70},[60,2172,2173],{"class":70}," wemeet\n",[22,2175,2176],{},"软件启动确认没有问题后，我们可以更改腾讯会议desktop中的启动命令",[51,2178,2180],{"className":53,"code":2179,"language":55,"meta":56,"style":56},"sudo $EDITOR /usr/share/applications/wemeetapp.desktop\n",[42,2181,2182],{"__ignoreMap":56},[60,2183,2184,2186,2189],{"class":62,"line":63},[60,2185,67],{"class":66},[60,2187,2188],{"class":160}," $EDITOR",[60,2190,2191],{"class":70}," /usr/share/applications/wemeetapp.desktop\n",[22,2193,2194,2195,2198],{},"将",[42,2196,2197],{},"Exec=","后面的命令改成我们刚刚启动所使用的命令即可。",[19,2200,2201],{},[22,2202,2203],{},"关键词: bwrap, linux, 暗色模式, 深色模式, 夜间模式, 白色字体, 亮色字体",[1029,2205,2206],{},"html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html pre.shiki code .sJa8x, html code.shiki .sJa8x{--shiki-default:#E45649;--shiki-dark:#E06C75}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}",{"title":56,"searchDepth":145,"depth":145,"links":2208},[],{"title":2210,"date":2211,"path":2212,"tags":2213,"body":2216},"来，从AUR给Fedora偷个包","2021-07-23 01:50:09","/2021/07/23/build-a-rpm-package-from-aur-with-archlinux",[1381,11,2214,2215],"Fedora","RPM Package",{"type":16,"value":2217,"toc":2897},[2218,2226,2231,2234,2241,2244,2252,2255,2262,2279,2283,2289,2295,2299,2302,2315,2326,2333,2339,2356,2379,2385,2388,2394,2410,2413,2431,2435,2648,2651,2656,2662,2676,2679,2685,2690,2696,2699,2705,2711,2714,2732,2737,2739,2746,2779,2828,2833,2844,2859,2871,2883,2894],[19,2219,2220,2223],{},[22,2221,2222],{},"前一阵子，某Q群里的某初中生居然跳上了Fedora这辆灵车，还一直缠着我要我给他整个打rpm包的教程，说什么要复兴FedoraCN之类的我听不懂的话。碰巧听说Fedora似乎还没有wechat-uos，于是我就寻思着给Fedora打一个，顺便熟悉一下dnf的操作。",[22,2224,2225],{},"事实上，Fedora和Archlinux的目录结构很相似，理论上来讲Archlinux的大部分包都可以直接解压后塞到Fedora里直接用，对于咱这种日常偷Deb包的Arch用户来说基本没什么难度，唯一的难点在于处理依赖关系。",[22,2227,2228],{},[590,2229,2230],{},"Tips1: 使用电脑端的访客可以在页面左下角打开侧栏以获取目录。",[98,2232,2233],{"id":2233},"下载链接",[22,2235,2236,2237],{},"如果你是为了wechat-uos这个包而非教程而来的，下载链接在这里。",[29,2238,2239],{"href":2239,"rel":2240},"https://zhullyb.lanzoui.com/ikN55rqr7ah",[33],[98,2242,2243],{"id":2243},"偷包环境",[1686,2245,2246,2249],{},[1629,2247,2248],{},"Archlinux实体机(打包)",[1629,2250,2251],{},"Fedora虚拟机(依赖查询、测试)",[98,2253,2254],{"id":2254},"准备好wechat-uos",[22,2256,2257,2258,2261],{},"首先，咱们先在Archlinux上把我们的",[42,2259,2260],{},"wechat-uos","先打包好，这个老生常谈的问题我不多赘述了。",[51,2263,2265],{"className":53,"code":2264,"language":55,"meta":56,"style":56},"yay -S wechat-uos --noconfirm\n",[42,2266,2267],{"__ignoreMap":56},[60,2268,2269,2271,2273,2276],{"class":62,"line":63},[60,2270,1074],{"class":66},[60,2272,75],{"class":74},[60,2274,2275],{"class":70}," wechat-uos",[60,2277,2278],{"class":74}," --noconfirm\n",[98,2280,2282],{"id":2281},"查找wechat-uos在archlinux上所需的依赖","查找wechat-uos在Archlinux上所需的依赖",[22,2284,2285,2286,2288],{},"再去查看",[42,2287,2260],{},"所需要的依赖",[51,2290,2293],{"className":2291,"code":2292,"language":883},[881],"[zhullyb@Archlinux ~]$ yay -Si wechat-uos\n:: Querying AUR...\nRepository      : aur\nName            : wechat-uos\nKeywords        : electron  patched  uos  wechat  weixin\nVersion         : 2:2.0.0-1145141919\nDescription     : UOS专业版微信 (迫真魔改版)\nURL             : https://www.chinauos.com/resource/download-professional\nAUR URL         : https://aur.archlinux.org/packages/wechat-uos\nGroups          : None\nLicenses        : MIT\nProvides        : None\nDepends On      : gtk2  gtk3  libxss  gconf  nss  lsb-release  bubblewrap\nMake Deps       : imagemagick\nCheck Deps      : None\nOptional Deps   : None\nConflicts With  : None\nMaintainer      : DuckSoft\nVotes           : 16\nPopularity      : 0.603501\nFirst Submitted : Wed 30 Dec 2020 12:21:51 PM CST\nLast Modified   : Sat 20 Feb 2021 06:53:24 AM CST\nOut-of-date     : No\n",[42,2294,2292],{"__ignoreMap":56},[98,2296,2298],{"id":2297},"查找fedora上的对应依赖包名","查找Fedora上的对应依赖包名",[22,2300,2301],{},"然后我们需要去Fedora上找一找这些依赖在Fedora上的包名都叫什么。",[22,2303,2304,2305,2308,2309,2311,2312],{},"比如这个",[42,2306,2307],{},"bubblewrap","，我们需要的是他提供的",[42,2310,1186],{},"，所以我们直接在Fedora上",[42,2313,2314],{},"sudo dnf provides bwrap",[22,2316,2317,2318,2321,2322,2325],{},"再比如",[42,2319,2320],{},"gconf","并没有在",[42,2323,2324],{},"/usr/bin","路径下直接留下什么非常具有代表性的可执行文件，所以在Fedora里面寻找等效包就稍微复杂一些，但也并非不能找。",[22,2327,2328,2329,2332],{},"先在Archlinux下使用",[42,2330,2331],{},"pacman -Ql gconf","，输出结果有点长，我就截一小段上来。",[51,2334,2337],{"className":2335,"code":2336,"language":883},[881],"[zhullyb@Archlinux ~]$ pacman -Qlq gconf\n/etc/\n/etc/gconf/\n/etc/gconf/2/\n/etc/gconf/2/evoldap.conf\n/etc/gconf/2/path\n/etc/gconf/gconf.xml.defaults/\n/etc/gconf/gconf.xml.mandatory/\n/etc/gconf/gconf.xml.system/\n/etc/xdg/\n/etc/xdg/autostart/\n/etc/xdg/autostart/gsettings-data-convert.desktop\n/usr/\n/usr/bin/\n/usr/bin/gconf-merge-schema\n/usr/bin/gconf-merge-tree\n/usr/bin/gconfpkg\n/usr/bin/gconftool-2\n......\n",[42,2338,2336],{"__ignoreMap":56},[22,2340,2341,2342,2344,2345,2348,2349,2352,2353,1566],{},"可以发现，",[42,2343,2320],{},"还是有不少文件是非常具有代表性的，比如这里的",[42,2346,2347],{},"/usr/bin/gconf-merge-tree","，我们在Fedora上使用",[42,2350,2351],{},"sudo dnf provides gconf-merge-tree","很容易就能找到对应的包是",[42,2354,2355],{},"GConf2",[22,2357,2358,2361,2362,2365,2366,2369,2370,2372,2373,2375,2376,2378],{},[42,2359,2360],{},"lsb-release","这个依赖中，我们只是需要",[42,2363,2364],{},"/etc/lsb-release","这个文件存在让我们的bwrap可以顺利地伪装成uos的样子。Fedora中虽然有",[42,2367,2368],{},"redhat-lsb-core","这个包算是",[42,2371,2360],{},"的等效包，但是并不提供这个文件，因此我们只需要在待会儿打包的时候带一个",[42,2374,2364],{},"的空文件即可，不需要将",[42,2377,2368],{},"写进依赖。",[22,2380,2381,2382,1566],{},"最终我们可以确定下来需要的依赖为",[42,2383,2384],{},"gtk2,gtk3,libXScrnSaver,nss,bubblewrap,GConf2",[98,2386,2387],{"id":2387},"准备打包",[1872,2389,40,2391],{"id":2390},"安装rpm-tools",[42,2392,2393],{},"rpm-tools",[51,2395,2397],{"className":53,"code":2396,"language":55,"meta":56,"style":56},"sudo pacman -S rpm-tools\n",[42,2398,2399],{"__ignoreMap":56},[60,2400,2401,2403,2405,2407],{"class":62,"line":63},[60,2402,67],{"class":66},[60,2404,71],{"class":70},[60,2406,75],{"class":74},[60,2408,2409],{"class":70}," rpm-tools\n",[1872,2411,2412],{"id":2412},"生成工作路径",[51,2414,2416],{"className":53,"code":2415,"language":55,"meta":56,"style":56},"mkdir -pv $HOME/rpmbuild/{BUILD,BUILDROOT,RPMS,SOURCES,SPECS,SRPMS}\n",[42,2417,2418],{"__ignoreMap":56},[60,2419,2420,2423,2426,2428],{"class":62,"line":63},[60,2421,2422],{"class":66},"mkdir",[60,2424,2425],{"class":74}," -pv",[60,2427,1200],{"class":160},[60,2429,2430],{"class":70},"/rpmbuild/{BUILD,BUILDROOT,RPMS,SOURCES,SPECS,SRPMS}\n",[1872,2432,2434],{"id":2433},"编写-spec-文件","编写 spec 文件",[51,2436,2438],{"className":53,"code":2437,"language":55,"meta":56,"style":56},"Name: wechat-uos\nVersion: 2.0.0\nRelease: 1\nSummary: A wechat client based on electron.\nLicense: None\nURL: https://www.chinauos.com/resource/download-professional\nPackager: zhullyb\n\nRequires: gtk2,gtk3,libXScrnSaver,nss,bubblewrap,GConf2\n\nAutoReqProv: no\n\n%description\n\n%prep\n\n%pre\n\n%post\n\n%preun\n\n%postun\n\n%files\n/etc/lsb-release\n/opt/wechat-uos/\n/usr/bin/wechat-uos\n/usr/lib/license/libuosdevicea.so\n/usr/share/applications/wechat-uos.desktop\n/usr/share/icons/hicolor/128x128/apps/wechat.png\n/usr/share/icons/hicolor/16x16/apps/wechat.png\n/usr/share/icons/hicolor/256x256/apps/wechat.png\n/usr/share/icons/hicolor/48x48/apps/wechat.png\n/usr/share/icons/hicolor/64x64/apps/wechat.png\n",[42,2439,2440,2448,2456,2464,2487,2495,2503,2511,2515,2523,2527,2535,2539,2544,2548,2553,2557,2562,2566,2571,2575,2580,2584,2589,2593,2598,2603,2608,2613,2618,2623,2628,2633,2638,2643],{"__ignoreMap":56},[60,2441,2442,2445],{"class":62,"line":63},[60,2443,2444],{"class":66},"Name:",[60,2446,2447],{"class":70}," wechat-uos\n",[60,2449,2450,2453],{"class":62,"line":145},[60,2451,2452],{"class":66},"Version:",[60,2454,2455],{"class":74}," 2.0.0\n",[60,2457,2458,2461],{"class":62,"line":151},[60,2459,2460],{"class":66},"Release:",[60,2462,2463],{"class":74}," 1\n",[60,2465,2466,2469,2472,2475,2478,2481,2484],{"class":62,"line":157},[60,2467,2468],{"class":66},"Summary:",[60,2470,2471],{"class":70}," A",[60,2473,2474],{"class":70}," wechat",[60,2476,2477],{"class":70}," client",[60,2479,2480],{"class":70}," based",[60,2482,2483],{"class":70}," on",[60,2485,2486],{"class":70}," electron.\n",[60,2488,2489,2492],{"class":62,"line":164},[60,2490,2491],{"class":66},"License:",[60,2493,2494],{"class":70}," None\n",[60,2496,2497,2500],{"class":62,"line":170},[60,2498,2499],{"class":66},"URL:",[60,2501,2502],{"class":70}," https://www.chinauos.com/resource/download-professional\n",[60,2504,2505,2508],{"class":62,"line":176},[60,2506,2507],{"class":66},"Packager:",[60,2509,2510],{"class":70}," zhullyb\n",[60,2512,2513],{"class":62,"line":182},[60,2514,649],{"emptyLinePlaceholder":648},[60,2516,2517,2520],{"class":62,"line":188},[60,2518,2519],{"class":66},"Requires:",[60,2521,2522],{"class":70}," gtk2,gtk3,libXScrnSaver,nss,bubblewrap,GConf2\n",[60,2524,2525],{"class":62,"line":3},[60,2526,649],{"emptyLinePlaceholder":648},[60,2528,2529,2532],{"class":62,"line":199},[60,2530,2531],{"class":66},"AutoReqProv:",[60,2533,2534],{"class":70}," no\n",[60,2536,2537],{"class":62,"line":205},[60,2538,649],{"emptyLinePlaceholder":648},[60,2540,2541],{"class":62,"line":211},[60,2542,2543],{"class":66},"%description\n",[60,2545,2546],{"class":62,"line":217},[60,2547,649],{"emptyLinePlaceholder":648},[60,2549,2550],{"class":62,"line":223},[60,2551,2552],{"class":66},"%prep\n",[60,2554,2555],{"class":62,"line":229},[60,2556,649],{"emptyLinePlaceholder":648},[60,2558,2559],{"class":62,"line":235},[60,2560,2561],{"class":66},"%pre\n",[60,2563,2564],{"class":62,"line":241},[60,2565,649],{"emptyLinePlaceholder":648},[60,2567,2568],{"class":62,"line":247},[60,2569,2570],{"class":66},"%post\n",[60,2572,2573],{"class":62,"line":253},[60,2574,649],{"emptyLinePlaceholder":648},[60,2576,2577],{"class":62,"line":259},[60,2578,2579],{"class":66},"%preun\n",[60,2581,2582],{"class":62,"line":265},[60,2583,649],{"emptyLinePlaceholder":648},[60,2585,2586],{"class":62,"line":271},[60,2587,2588],{"class":66},"%postun\n",[60,2590,2591],{"class":62,"line":277},[60,2592,649],{"emptyLinePlaceholder":648},[60,2594,2595],{"class":62,"line":283},[60,2596,2597],{"class":66},"%files\n",[60,2599,2600],{"class":62,"line":289},[60,2601,2602],{"class":66},"/etc/lsb-release\n",[60,2604,2605],{"class":62,"line":295},[60,2606,2607],{"class":66},"/opt/wechat-uos/\n",[60,2609,2610],{"class":62,"line":301},[60,2611,2612],{"class":66},"/usr/bin/wechat-uos\n",[60,2614,2615],{"class":62,"line":307},[60,2616,2617],{"class":66},"/usr/lib/license/libuosdevicea.so\n",[60,2619,2620],{"class":62,"line":313},[60,2621,2622],{"class":66},"/usr/share/applications/wechat-uos.desktop\n",[60,2624,2625],{"class":62,"line":319},[60,2626,2627],{"class":66},"/usr/share/icons/hicolor/128x128/apps/wechat.png\n",[60,2629,2630],{"class":62,"line":325},[60,2631,2632],{"class":66},"/usr/share/icons/hicolor/16x16/apps/wechat.png\n",[60,2634,2635],{"class":62,"line":331},[60,2636,2637],{"class":66},"/usr/share/icons/hicolor/256x256/apps/wechat.png\n",[60,2639,2640],{"class":62,"line":337},[60,2641,2642],{"class":66},"/usr/share/icons/hicolor/48x48/apps/wechat.png\n",[60,2644,2645],{"class":62,"line":343},[60,2646,2647],{"class":66},"/usr/share/icons/hicolor/64x64/apps/wechat.png\n",[1872,2649,2650],{"id":2650},"处理source",[19,2652,2653],{},[22,2654,2655],{},"一般来说，我们需要配置各种奇奇怪怪的编译命令，但是我这里直接选择了打包二进制文件，一来是减少了对于spec的学习成本，二来是因为wechat-uos本来就不开源，也没什么好编译的。",[22,2657,2658,2659,2661],{},"创建我们",[42,2660,2260],{},"的二进制文件所需要放入的文件夹。",[51,2663,2665],{"className":53,"code":2664,"language":55,"meta":56,"style":56},"mkdir $HOME/rpmbuild/BUILDROOT/wechat-uos-2.0.0-1.x86_64\n",[42,2666,2667],{"__ignoreMap":56},[60,2668,2669,2671,2673],{"class":62,"line":63},[60,2670,2422],{"class":66},[60,2672,1200],{"class":160},[60,2674,2675],{"class":70},"/rpmbuild/BUILDROOT/wechat-uos-2.0.0-1.x86_64\n",[22,2677,2678],{},"将我们的wechat-uos直接放入对应的文件夹中",[22,2680,2681],{},[1092,2682],{"alt":2683,"src":2684},"解压原先打包好的wechat-uos","https://static.031130.xyz/uploads/2024/08/12/62f3cadde8d65.webp",[22,2686,2687,2688],{},"补上我们的",[42,2689,2364],{},[51,2691,2694],{"className":2692,"code":2693,"language":883},[881],"mkdir $HOME/rpmbuild/BUILDROOT/wechat-uos-2.0.0-1.x86_64/etc/\ntouch $HOME/rpmbuild/BUILDROOT/wechat-uos-2.0.0-1.x86_64/etc/lsb-release\n",[42,2695,2693],{"__ignoreMap":56},[98,2697,2698],{"id":2698},"正式打包",[51,2700,2703],{"className":2701,"code":2702,"language":883},[881],"rpmbuild -bb --target=x86_64 SPECS/wechat-uos.spec --nodeps\n",[42,2704,2702],{"__ignoreMap":56},[22,2706,2707],{},[1092,2708],{"alt":2709,"src":2710},"打包成功","https://static.031130.xyz/uploads/2024/08/12/62f3cae15fdcf.webp",[98,2712,2713],{"id":2713},"安装测试",[51,2715,2717],{"className":53,"code":2716,"language":55,"meta":56,"style":56},"sudo dnf install ./wechat-uos-2.0.0-1.x86_64.rpm\n",[42,2718,2719],{"__ignoreMap":56},[60,2720,2721,2723,2726,2729],{"class":62,"line":63},[60,2722,67],{"class":66},[60,2724,2725],{"class":70}," dnf",[60,2727,2728],{"class":70}," install",[60,2730,2731],{"class":70}," ./wechat-uos-2.0.0-1.x86_64.rpm\n",[22,2733,2734],{},[1092,2735],{"alt":1211,"src":2736},"https://static.031130.xyz/uploads/2024/08/12/62f3cae5aa4b0.webp",[98,2738,2067],{"id":2067},[22,2740,2741,2742,2745],{},"rpm的打包工具是我近期",[590,2743,2744],{},"最","想吐槽的东西了，主要槽点有两个。",[22,2747,2748,2749,2752,2753,1934,2756,1934,2759,2762,2763,2770,2771,2774,2775,2778],{},"其一是：rpm在打包时的默认状态下，会使用 ",[42,2750,2751],{},"file"," 命令判断文件，如果是二进制的，用ldd判断依赖；如果是脚本，过滤文件中对应的 ",[42,2754,2755],{},"use",[42,2757,2758],{},"requires",[42,2760,2761],{},"import"," 语句，以此来找出内部依赖。**这固然是个非常贴心的小善举，**能够确保软件正常运行，",[590,2764,2765,2766,2769],{},"但完全有可能造成比较奇怪的问题。",[590,2767,2768],{},"比如我本次打包中rpm","自作聪明","地给我添加了一个",[42,2772,2773],{},"libffmpeg.so","的依赖，这东西整个Fedora自带的四个源里都不存在，在安装测试的时候出现了找不到依赖的情况。想我这种添加了找不到依赖的情况还算是运气好的，之前听说有人在使用opensuse的某个私人源的时候发现安装网易云音乐居然吧wps-office都给依赖上了，我想就是rpm自动检测到了网易云需要某个库，而wps恰好自带了这个库而导致的依赖误报。在Archlinux中，我们有一个叫",[42,2776,2777],{},"namcap","的小工具能够使用类似的方法检测软件运行时可能所需要的内部依赖，但他并不会默认启用，更不会自说自话的就直接把他添加为依赖，连一声也不吭。",[22,2780,2781,2782,2785,2786,2788,2789,2792,2793,112,2795,2798,2799,2801,2802,2805,2806,2808,2809,45,2811,2814,2815,2817,2818,2820,2821,2823,2824,2827],{},"其二是：rpm检测新增包内文件是否与系统已安装的软件包内的文件因为使用相同路径而冲突时，不仅会核对是否有冲突的同路径同名文件，他",[590,2783,2784],{},"还会核对文件夹","的文件占用情况。这说起来可能会有些抽象，我举个例子。在Fedora中，",[42,2787,2324],{},"路径是被",[42,2790,2791],{},"filesystem","这个包所占有的，所以其他包在打包时是不能直接使用",[42,2794,2324],{},[42,2796,2797],{},"/usr","、甚至",[42,2800,1934],{},"来限定包内文件的范围的（也就是上面spec文件中的%files区域）。而我在第一次打包时，想要直接打包",[42,2803,2804],{},"BUILDROOT","下的所有文件，于是%files就直接填写了",[42,2807,1934],{},"作为限定，安装时提示",[42,2810,2324],{},[42,2812,2813],{},"/usr/lib","被",[42,2816,2791],{},"这个包所占用，文件冲突。为此我还特意去仔细对比了Fedora自带的",[42,2819,2791],{},"和我这个",[42,2822,2260],{},"是否有冲突的文件，实则证明并没有，只是单纯这个",[590,2825,2826],{},"检测机制过于死板","罢了。而在Archlinux中，pacman安装时只会检测包内的文件是否与系统内的现有文件路径产生冲突，而不会非常无意义的去限定哪个文件夹是属于哪个包的。",[98,2829,2831],{"id":2830},"附上本文的参考资料",[590,2832,2830],{},[19,2834,2835],{},[22,2836,2837,2838,2843],{},"为了避免源网页失效，我特意去",[29,2839,2842],{"href":2840,"rel":2841},"http://web.archive.org",[33],"互联网档案馆","做了备份",[22,2845,2846,2847,2852,2853,2858],{},"「",[29,2848,2851],{"href":2849,"rel":2850},"https://blog.csdn.net/get_set/article/details/53453320",[33],"RPM打包原理、示例、详解及备查","」\t\t\t\t\t\t\t 「",[29,2854,2857],{"href":2855,"rel":2856},"http://web.archive.org/web/20210722180835/https://blog.konghy.cn/2015/11/13/rpmbuild/",[33],"Archive","」",[22,2860,2846,2861,2866,2867,2858],{},[29,2862,2865],{"href":2863,"rel":2864},"https://blog.konghy.cn/2015/11/13/rpmbuild/",[33],"在 Ubuntu 下直接将二进制文件制作成 rpm 包","」\t\t「",[29,2868,2857],{"href":2869,"rel":2870},"http://web.archive.org/web/20210722180859/http://blog.sina.cn/dpool/blog/s/blog_6a5aee670101r1si.html",[33],[22,2872,2846,2873,2878,2879,2858],{},[29,2874,2877],{"href":2875,"rel":2876},"http://blog.sina.cn/dpool/blog/s/blog_6a5aee670101r1si.html",[33],"解除RPM包的依赖的方法","」\t\t\t\t\t\t\t\t\t\t\t「",[29,2880,2857],{"href":2881,"rel":2882},"http://web.archive.org/web/20210722180936/https://blog.csdn.net/get_set/article/details/53453320",[33],[22,2884,2885],{},[1768,2886,2887,2888,2893],{},"本文同时发布于「",[29,2889,2892],{"href":2890,"rel":2891},"https://zhuanlan.zhihu.com/p/392650904",[33],"知乎专栏","」，如果你恰好有知乎帐号的话或许可以考虑帮我点个赞？",[1029,2895,2896],{},"html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html pre.shiki code .sJa8x, html code.shiki .sJa8x{--shiki-default:#E45649;--shiki-dark:#E06C75}",{"title":56,"searchDepth":145,"depth":145,"links":2898},[2899,2900,2901,2902,2903,2904,2905,2906,2907,2908],{"id":2233,"depth":151,"text":2233},{"id":2243,"depth":151,"text":2243},{"id":2254,"depth":151,"text":2254},{"id":2281,"depth":151,"text":2282},{"id":2297,"depth":151,"text":2298},{"id":2387,"depth":151,"text":2387},{"id":2698,"depth":151,"text":2698},{"id":2713,"depth":151,"text":2713},{"id":2067,"depth":151,"text":2067},{"id":2830,"depth":151,"text":2830},{"title":2910,"date":2911,"path":2912,"tags":2913,"body":2914},"下载一份openharmony的源码","2021-06-06 16:47:34","/2021/06/06/download-openharmony-source-code",null,{"type":16,"value":2915,"toc":3285},[2916,2921,2924,2935,2949,2955,2963,3078,3085,3097,3104,3115,3122,3144,3154,3161,3173,3183,3186,3192,3195,3198,3204,3211,3231,3237,3244,3247,3253,3259,3265,3270,3276,3282],[19,2917,2918],{},[22,2919,2920],{},"不知道为什么，总是有人告诉我鸿蒙已经开源了，不信可以自己去看源码balabala，其实鸿蒙的手机端目前为止依然没有开源，或者说没有完整完整开源。本文我将介绍如何拉取一份openharmony开源的源码。",[22,2922,2923],{},"首先需要准备以下东西",[1686,2925,2926,2929,2932],{},[1629,2927,2928],{},"一台装有类unix环境的电脑（wsl大概也行）",[1629,2930,2931],{},"6G磁盘剩余空间",[1629,2933,2934],{},"互联网（如果使用手机流量的话大概是1.5G）",[1626,2936,2938,2944],{"start":2937},0,[1629,2939,2940,2943],{},[1872,2941,2942],{"id":2942},"安装git","没什么好说的，不再赘述。",[1629,2945,2946],{},[1872,2947,2948],{"id":2948},"设置git用户名和邮箱",[51,2950,2953],{"className":2951,"code":2952,"language":883},[881],"git config --global user.email \"you@example.com\"\ngit config --global user.name \"Your Name\"\n",[42,2954,2952],{"__ignoreMap":56},[1626,2956,2957],{"start":145},[1629,2958,2959],{},[1872,2960,2962],{"id":2961},"下载repo这个大多数发行版自己都有打包但是都比较滞后不如直接下载最新版的二进制文件设置好path变量直接用","下载repo（这个大多数发行版自己都有打包，但是都比较滞后，不如直接下载最新版的二进制文件设置好path变量直接用）",[51,2964,2966],{"className":53,"code":2965,"language":55,"meta":56,"style":56},"mkdir -p ~/bin\ncurl https://storage.googleapis.com/git-repo-downloads/repo > ~/bin/repo\nchmod a+x ~/bin/repo\n\ncat >> ~/.bashrc \u003C\u003CEOF\n\n# set PATH so it includes user's private bin if it exists\nif [ -d \"\\$HOME/bin\" ] ; then\n    PATH=\"\\$HOME/bin:\\$PATH\"\nfi\nEOF\n\nsource ~/.bashrc\n",[42,2967,2968,2977,2990,3001,3005,3022,3026,3031,3042,3057,3062,3066,3070],{"__ignoreMap":56},[60,2969,2970,2972,2974],{"class":62,"line":63},[60,2971,2422],{"class":66},[60,2973,806],{"class":74},[60,2975,2976],{"class":70}," ~/bin\n",[60,2978,2979,2981,2984,2987],{"class":62,"line":145},[60,2980,118],{"class":66},[60,2982,2983],{"class":70}," https://storage.googleapis.com/git-repo-downloads/repo",[60,2985,2986],{"class":141}," > ",[60,2988,2989],{"class":70},"~/bin/repo\n",[60,2991,2992,2995,2998],{"class":62,"line":151},[60,2993,2994],{"class":66},"chmod",[60,2996,2997],{"class":70}," a+x",[60,2999,3000],{"class":70}," ~/bin/repo\n",[60,3002,3003],{"class":62,"line":157},[60,3004,649],{"emptyLinePlaceholder":648},[60,3006,3007,3010,3013,3016,3019],{"class":62,"line":164},[60,3008,3009],{"class":66},"cat",[60,3011,3012],{"class":141}," >> ",[60,3014,3015],{"class":70},"~/.bashrc",[60,3017,3018],{"class":141}," \u003C\u003C",[60,3020,3021],{"class":141},"EOF\n",[60,3023,3024],{"class":62,"line":170},[60,3025,649],{"emptyLinePlaceholder":648},[60,3027,3028],{"class":62,"line":176},[60,3029,3030],{"class":70},"# set PATH so it includes user's private bin if it exists\n",[60,3032,3033,3036,3039],{"class":62,"line":182},[60,3034,3035],{"class":70},"if [ -d \"",[60,3037,3038],{"class":1436},"\\$",[60,3040,3041],{"class":70},"HOME/bin\" ] ; then\n",[60,3043,3044,3047,3049,3052,3054],{"class":62,"line":188},[60,3045,3046],{"class":70},"    PATH=\"",[60,3048,3038],{"class":1436},[60,3050,3051],{"class":70},"HOME/bin:",[60,3053,3038],{"class":1436},[60,3055,3056],{"class":70},"PATH\"\n",[60,3058,3059],{"class":62,"line":3},[60,3060,3061],{"class":70},"fi\n",[60,3063,3064],{"class":62,"line":199},[60,3065,3021],{"class":141},[60,3067,3068],{"class":62,"line":205},[60,3069,649],{"emptyLinePlaceholder":648},[60,3071,3072,3075],{"class":62,"line":211},[60,3073,3074],{"class":1436},"source",[60,3076,3077],{"class":70}," ~/.bashrc\n",[1626,3079,3080],{"start":151},[1629,3081,3082],{},[1872,3083,3084],{"id":3084},"新建一个文件夹以同步源码",[51,3086,3088],{"className":53,"code":3087,"language":55,"meta":56,"style":56},"mkdir openharmony\n",[42,3089,3090],{"__ignoreMap":56},[60,3091,3092,3094],{"class":62,"line":63},[60,3093,2422],{"class":66},[60,3095,3096],{"class":70}," openharmony\n",[1626,3098,3099],{"start":157},[1629,3100,3101],{},[1872,3102,3103],{"id":3103},"进入这个文件夹",[51,3105,3107],{"className":53,"code":3106,"language":55,"meta":56,"style":56},"cd openharmony\n",[42,3108,3109],{"__ignoreMap":56},[60,3110,3111,3113],{"class":62,"line":63},[60,3112,1437],{"class":1436},[60,3114,3096],{"class":70},[1626,3116,3117],{"start":164},[1629,3118,3119],{},[1872,3120,3121],{"id":3121},"初始化repo",[51,3123,3125],{"className":53,"code":3124,"language":55,"meta":56,"style":56},"repo init -u https://gitee.com/openharmony/manifest.git --depth=1\n",[42,3126,3127],{"__ignoreMap":56},[60,3128,3129,3132,3135,3138,3141],{"class":62,"line":63},[60,3130,3131],{"class":66},"repo",[60,3133,3134],{"class":70}," init",[60,3136,3137],{"class":74}," -u",[60,3139,3140],{"class":70}," https://gitee.com/openharmony/manifest.git",[60,3142,3143],{"class":74}," --depth=1\n",[22,3145,3146,3147,3150,3151,3153],{},"​\t注:  ",[42,3148,3149],{},"--depth=1","是为了仅保留一层commit记录，防止过多的历史commit占用空间，如果你想保留历\t史commit，那可以把这里的",[42,3152,3149],{},"去掉。",[1626,3155,3156],{"start":170},[1629,3157,3158],{},[1872,3159,3160],{"id":3160},"使用repo正式开始同步源码",[51,3162,3164],{"className":53,"code":3163,"language":55,"meta":56,"style":56},"repo sync\n",[42,3165,3166],{"__ignoreMap":56},[60,3167,3168,3170],{"class":62,"line":63},[60,3169,3131],{"class":66},[60,3171,3172],{"class":70}," sync\n",[22,3174,3175,3176,3179,3180],{},"repo在sync的时候其实可以加很多选项，可以通过",[42,3177,3178],{},"repo help","自行研究，我自己常用的是",[42,3181,3182],{},"repo sync  --force-sync --current-branch --no-tags --no-clone-bundle --optimized-fetch --prune -j$(nproc --all) -f1",[22,3184,3185],{},"看到以下提示代表同步成功",[51,3187,3190],{"className":3188,"code":3189,"language":883},[881],"repo sync has finished successfully.\n",[42,3191,3189],{"__ignoreMap":56},[98,3193,3194],{"id":3194},"后话",[22,3196,3197],{},"结果就当源码下载好并开始checkout后，出现了以下错误",[51,3199,3202],{"className":3200,"code":3201,"language":883},[881],"Garbage collecting: 100% (220/220), done in 1.204s\nUpdating files: 100% (35/35), done.\nUpdating files: 100% (27/27), done.\ngit-lfs filter-process --skip: line 1: git-lfs: command not found\nfatal: the remote end hung up unexpectedly\nerror.GitError: Cannot checkout device_hisilicon_modules: Cannot initialize work tree for device_hisilicon_modules\nerror: Cannot checkout device_hisilicon_modules\n",[42,3203,3201],{"__ignoreMap":56},[22,3205,3206,3207,3210],{},"看着error很容易可以发现是我的系统没有",[42,3208,3209],{},"git-lfs","的原因，看样子openharmony使用了git-lfs来储存了某个大文件。",[51,3212,3214],{"className":53,"code":3213,"language":55,"meta":56,"style":56},"sudo pacman -S git-lfs  #别的发行版请自行查找相关安装方法\n",[42,3215,3216],{"__ignoreMap":56},[60,3217,3218,3220,3222,3224,3227],{"class":62,"line":63},[60,3219,67],{"class":66},[60,3221,71],{"class":70},[60,3223,75],{"class":74},[60,3225,3226],{"class":70}," git-lfs",[60,3228,3230],{"class":3229},"sW2Sy","  #别的发行版请自行查找相关安装方法\n",[22,3232,3233,3234,3236],{},"于是乎，安装好",[42,3235,3209],{},"重新sync源码",[22,3238,3239,3240,3243],{},"oepnharmony目录下，",[42,3241,3242],{},".repo","文件夹内是你从git服务器上下载下来的原始数据，repo将在所有数据下载完成以后将他们自动checkout成代码。",[22,3245,3246],{},"源码结构是下面这个样子",[51,3248,3251],{"className":3249,"code":3250,"language":883},[881],".\n├── applications\n├── base\n├── build\n├── build.py -> build/lite/build.py\n├── build.sh -> build/build_scripts/build.sh\n├── developtools\n├── device\n├── docs\n├── domains\n├── drivers\n├── foundation\n├── .gn -> build/core/gn/dotfile.gn\n├── interface\n├── kernel\n├── prebuilts\n├── productdefine\n├── .repo\n├── test\n├── third_party\n├── utils\n└── vendor\n\n18 directories, 3 files\n",[42,3252,3250],{"__ignoreMap":56},[22,3254,3255],{},[1092,3256],{"alt":3257,"src":3258},"这里是OpenHarmony包含.repo原始数据的全部大小","https://static.031130.xyz/uploads/2024/08/12/62f3cb1057a22.webp",[22,3260,3261],{},[1092,3262],{"alt":3263,"src":3264},"这里是OpenHarmony的.repo原始数据的大小","https://static.031130.xyz/uploads/2024/08/12/62f3cb13027fb.webp",[22,3266,3267],{},[590,3268,3269],{},"我提供个参考数据，AOSP源码不含.repo原始数据的大小是40G，就openharmony这个代码量，恐怕很难让我相信这是一个兼容安卓应用的系统的完整代码。",[22,3271,3272],{},[1092,3273],{"alt":3274,"src":3275},"这里是AOSP的.repo原始数据大小","https://static.031130.xyz/uploads/2024/08/12/62f3cb15ccbf1.webp",[22,3277,3278],{},[1092,3279],{"alt":3280,"src":3281},"这里是AOSP包含.repo原始数据的大小","https://static.031130.xyz/uploads/2024/08/12/62f3cb182333b.webp",[1029,3283,3284],{},"html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html pre.shiki code .s_Sar, html code.shiki .s_Sar{--shiki-default:#0184BC;--shiki-dark:#56B6C2}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html pre.shiki code .sW2Sy, html code.shiki .sW2Sy{--shiki-default:#A0A1A7;--shiki-default-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic}",{"title":56,"searchDepth":145,"depth":145,"links":3286},[3287],{"id":3194,"depth":151,"text":3194},{"title":3289,"date":3290,"path":3291,"tags":3292,"body":3294},"在Windows与Linux双系统下共享蓝牙鼠标","2021-05-30","/2021/05/30/share-xiaomi-bluetooth-mouse-on-both-windows-and-linux",[1381,11,3293],"Windows",{"type":16,"value":3295,"toc":3644},[3296,3313,3316,3329,3335,3341,3344,3355,3361,3364,3370,3375,3378,3498,3504,3507,3513,3560,3563,3634,3641],[19,3297,3298,3307,3310],{},[22,3299,3300,3301,3306],{},"我自己使用的鼠标是一只",[29,3302,3305],{"href":3303,"rel":3304},"https://www.mi.com/mouse",[33],"小米的无线蓝牙双模鼠标","。但是由于我的USB接口不是很充裕，我平时还是蓝牙鼠标用的比较多。",[22,3308,3309],{},"但是，每当我在Windows和Archlinux上切换时，我不得不重新配对我的蓝牙鼠标。原因我在翻译Archwiki上关于蓝牙鼠标相关叙述时已经解释得非常清楚了，我摘在下面：",[22,3311,3312],{},"“首先，计算机保存蓝牙设备的 MAC 地址和配对密钥；然后，蓝牙设备保存计算机的 MAC 地址和配对密钥。这两步通常不会有问题，不过设备蓝牙端口的 MAC 地址在 Linux 和 Windows 上都是相同的 (这在硬件层面上就设定好了)。然而，当在 Windows 或 Linux  中重新配对设备时，它会生成一个新密钥，覆盖了蓝牙设备之前保存的密钥，即与 Windows 配对产生的密钥会覆盖原先与 Linux  配对的密钥，反之亦然。“",[22,3314,3315],{},"先在Linux上连接蓝牙鼠标，再重启到Windows重新配对蓝牙蓝牙鼠标。",[22,3317,3318,3319,3324,3325,3328],{},"到",[29,3320,3323],{"href":3321,"rel":3322},"https://docs.microsoft.com/en-us/sysinternals/downloads/psexec",[33],"微软官网","下载",[42,3326,3327],{},"PsExec.zip","，解压后，记住你所解压的路径。",[22,3330,3331,3332],{},"在Windows中，使用管理员权限打开",[42,3333,3334],{},"cmd.exe",[22,3336,3337],{},[1092,3338],{"alt":3339,"src":3340},"在Windows下使用管理员权限打开cmd","https://static.031130.xyz/uploads/2024/08/12/62f3cb081565a.webp",[22,3342,3343],{},"cd到PsExec解压目录，使用如下命令将我们所需要的蓝牙密钥信息保存到C盘根目录下。",[51,3345,3349],{"className":3346,"code":3347,"language":3348,"meta":56,"style":56},"language-cmd shiki shiki-themes one-light one-dark-pro","psexec.exe -s -i regedit /e C:\\BTKeys.reg HKEY_LOCAL_MACHINE\\SYSTEM\\ControlSet001\\Services\\BTHPORT\\Parameters\\Keys\n","cmd",[42,3350,3351],{"__ignoreMap":56},[60,3352,3353],{"class":62,"line":63},[60,3354,3347],{},[22,3356,3357],{},[1092,3358],{"alt":3359,"src":3360},"使用psexec获取蓝牙信息","https://static.031130.xyz/uploads/2024/08/12/62f3cb0aae88f.webp",[22,3362,3363],{},"根目录的BTkeys.reg可以直接用记事本打开，内容大概是下面这个样子",[22,3365,3366],{},[1092,3367],{"alt":3368,"src":3369},"BTkeys.reg","https://static.031130.xyz/uploads/2024/08/12/62f3cb0d9e04f.webp",[19,3371,3372],{},[22,3373,3374],{},"为了方便后面的解说，我用各种颜色标注了起来。",[22,3376,3377],{},"在Linux下获取su权限以后，我们需要将Linux下随机分配给鼠标的蓝牙地址改成在Windows上获取的那个地址。上图中「红部分」划出来的就是Windows下获取的地址。",[51,3379,3381],{"className":53,"code":3380,"language":55,"meta":56,"style":56},"[zhullyb@Archlinux ~]$ su\nPassword: \n[root@Archlinux zhullyb]# cd /var/lib/bluetooth/E0\\:94\\:67\\:74\\:0D\\:5F/\n[root@Archlinux E0:94:67:74:0D:5F]# ls\nC6:2A:1B:33:2E:71  cache  settings\n[root@Archlinux E0:94:67:74:0D:5F]# mv C6\\:2A\\:1B\\:33\\:2E\\:71/ C4\\:F6\\:B3\\:2C\\:BD\\:7E\n",[42,3382,3383,3388,3396,3427,3432,3443],{"__ignoreMap":56},[60,3384,3385],{"class":62,"line":63},[60,3386,3387],{"class":141},"[zhullyb@Archlinux ~]$ su\n",[60,3389,3390,3393],{"class":62,"line":145},[60,3391,3392],{"class":66},"Password:",[60,3394,3395],{"class":141}," \n",[60,3397,3398,3401,3404,3407,3409,3412,3414,3417,3419,3422,3424],{"class":62,"line":151},[60,3399,3400],{"class":141},"[root@Archlinux zhullyb]# cd /var/lib/bluetooth/E0",[60,3402,3403],{"class":1436},"\\:",[60,3405,3406],{"class":141},"94",[60,3408,3403],{"class":1436},[60,3410,3411],{"class":141},"67",[60,3413,3403],{"class":1436},[60,3415,3416],{"class":141},"74",[60,3418,3403],{"class":1436},[60,3420,3421],{"class":141},"0D",[60,3423,3403],{"class":1436},[60,3425,3426],{"class":141},"5F/\n",[60,3428,3429],{"class":62,"line":157},[60,3430,3431],{"class":141},"[root@Archlinux E0:94:67:74:0D:5F]# ls\n",[60,3433,3434,3437,3440],{"class":62,"line":164},[60,3435,3436],{"class":66},"C6:2A:1B:33:2E:71",[60,3438,3439],{"class":70},"  cache",[60,3441,3442],{"class":70},"  settings\n",[60,3444,3445,3448,3450,3453,3455,3458,3460,3463,3465,3468,3470,3473,3475,3478,3480,3483,3485,3488,3490,3493,3495],{"class":62,"line":170},[60,3446,3447],{"class":141},"[root@Archlinux E0:94:67:74:0D:5F]# mv C6",[60,3449,3403],{"class":1436},[60,3451,3452],{"class":141},"2A",[60,3454,3403],{"class":1436},[60,3456,3457],{"class":141},"1B",[60,3459,3403],{"class":1436},[60,3461,3462],{"class":141},"33",[60,3464,3403],{"class":1436},[60,3466,3467],{"class":141},"2E",[60,3469,3403],{"class":1436},[60,3471,3472],{"class":141},"71/ C4",[60,3474,3403],{"class":1436},[60,3476,3477],{"class":141},"F6",[60,3479,3403],{"class":1436},[60,3481,3482],{"class":141},"B3",[60,3484,3403],{"class":1436},[60,3486,3487],{"class":141},"2C",[60,3489,3403],{"class":1436},[60,3491,3492],{"class":141},"BD",[60,3494,3403],{"class":1436},[60,3496,3497],{"class":141},"7E\n",[22,3499,3500,3501],{},"再编辑",[42,3502,3503],{},"/var/lib/bluetooth/\u003C本机蓝牙地址>/\u003C鼠标蓝牙地址>/info",[22,3505,3506],{},"原文件如下：",[51,3508,3511],{"className":3509,"code":3510,"language":883},[881],"[General]\nName=MiMouse\nAppearance=0x03c2\nAddressType=static\nSupportedTechnologies=LE;\nTrusted=true\nBlocked=false\nWakeAllowed=true\nServices=00001530-1212-efde-1523-785feabcd123;00001800-0000-1000-8000-00805f9b34fb;00001801-0000-1000-8000-00805f9b34fb;0000180a-0000-1000-8000-00805f9b34fb;0000180f-0000-1000-8000-00805f9b34fb;00001812-0000-1000-8000-00805f9b34fb;\n\n[IdentityResolvingKey]\nKey=067764BF59A7531E978AFDC6BB5EC8E1\n\n[LongTermKey]\nKey=E3C49B4F3256018192942EB0CDDEE6A3\nAuthenticated=0\nEncSize=16\nEDiv=28209\nRand=15970850852728832717\n\n[DeviceID]\nSource=2\nVendor=10007\nProduct=64\nVersion=40\n\n[ConnectionParameters]\nMinInterval=6\nMaxInterval=9\nLatency=100\nTimeout=600\n",[42,3512,3510],{"__ignoreMap":56},[1686,3514,3515,3530,3550],{},[1629,3516,3517,3518,3521,3522,3525,3526,3529],{},"「黄色部分」",[42,3519,3520],{},"LTK"," 对应 ",[42,3523,3524],{},"LongTermKey"," 下的 ",[42,3527,3528],{},"Key","，把小写转换成大写并删去逗号即可。",[1629,3531,3532,3533,3521,3536,3539,3540,3543,3544,3543,3547],{},"「绿色部分」",[42,3534,3535],{},"ERand",[42,3537,3538],{},"Rand","。这里比较特殊的是，我们必须先将 Windows 中的值倒转过来再转换为 10 进制。即",[42,3541,3542],{},"c2,83,7f,8f,7c,76,b4,02","->",[42,3545,3546],{},"02,b4,76,7c,8f,7f,83,c2",[42,3548,3549],{},"194910961239294914",[1629,3551,3552,3553,3521,3556,3559],{},"「蓝色部分」",[42,3554,3555],{},"EDIV",[42,3557,3558],{},"EDiv","。把 16 进制转换成 10 进制即可，这里就不用倒转了。",[22,3561,3562],{},"具体的转换方法我不再赘述，我把我的转换过程放在下面，我相信各位读者能够看懂。",[51,3564,3566],{"className":53,"code":3565,"language":55,"meta":56,"style":56},"[zhullyb@Archlinux ~]$ echo 'e3,c0,b2,8e,64,2b,12,16,d8,c2,d7,d4,59,55,92,cd' | tr a-z A-Z | sed 's/[[:punct:]]//g'\nE3C0B28E642B1216D8C2D7D4595592CD\n[zhullyb@Archlinux ~]$ echo $((16#02B4767C8F7F83C2))    #这里我是手动倒叙的\n194910961239294914\n[zhullyb@Archlinux ~]$ echo $((16#000055a3))\n21923\n",[42,3567,3568,3595,3600,3614,3619,3629],{"__ignoreMap":56},[60,3569,3570,3573,3576,3579,3582,3585,3588,3590,3592],{"class":62,"line":63},[60,3571,3572],{"class":141},"[zhullyb@Archlinux ~]$ echo ",[60,3574,3575],{"class":70},"'e3,c0,b2,8e,64,2b,12,16,d8,c2,d7,d4,59,55,92,cd'",[60,3577,3578],{"class":141}," | ",[60,3580,3581],{"class":66},"tr",[60,3583,3584],{"class":70}," a-z",[60,3586,3587],{"class":70}," A-Z",[60,3589,3578],{"class":141},[60,3591,1956],{"class":66},[60,3593,3594],{"class":70}," 's/[[:punct:]]//g'\n",[60,3596,3597],{"class":62,"line":145},[60,3598,3599],{"class":66},"E3C0B28E642B1216D8C2D7D4595592CD\n",[60,3601,3602,3605,3608,3611],{"class":62,"line":151},[60,3603,3604],{"class":141},"[zhullyb@Archlinux ~]$ echo $((",[60,3606,3607],{"class":66},"16#02B4767C8F7F83C2",[60,3609,3610],{"class":141},"))    ",[60,3612,3613],{"class":3229},"#这里我是手动倒叙的\n",[60,3615,3616],{"class":62,"line":157},[60,3617,3618],{"class":66},"194910961239294914\n",[60,3620,3621,3623,3626],{"class":62,"line":164},[60,3622,3604],{"class":141},[60,3624,3625],{"class":66},"16#000055a3",[60,3627,3628],{"class":141},"))\n",[60,3630,3631],{"class":62,"line":170},[60,3632,3633],{"class":66},"21923\n",[22,3635,3636,3637,3640],{},"做完这些操作以后，",[42,3638,3639],{},"sudo systemctl start bluetooth","即可",[1029,3642,3643],{},"html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .s_Sar, html code.shiki .s_Sar{--shiki-default:#0184BC;--shiki-dark:#56B6C2}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html pre.shiki code .sW2Sy, html code.shiki .sW2Sy{--shiki-default:#A0A1A7;--shiki-default-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic}",{"title":56,"searchDepth":145,"depth":145,"links":3645},[],{"title":3647,"date":3648,"path":3649,"tags":3650,"body":3652},"选择最新的Archlinux镜像源","2021-05-29","/2021/05/29/choose-the-last-archlinux-mirror-site-in-china",[11,3651],"Mirror Site",{"type":16,"value":3653,"toc":4345},[3654,3658,3661,3670,3673,3679,3689,3695,4233,4236,4242,4245,4248,4256,4259,4320,4327,4333,4339,4342],[98,3655,3657],{"id":3656},"找到最新的archlinux镜像源","找到最新的Archlinux镜像源",[22,3659,3660],{},"我是testing+kde-unstable用户，平均每天更新4次，对于我而言，选择最新的Archlinux镜像是非常重要的。",[22,3662,3663,3664,3669],{},"Archlinux的主源并不开放给个人用户使用，仅开放给",[29,3665,3668],{"href":3666,"rel":3667},"https://archlinux.org/mirrors/tier/1/",[33],"一级镜像站","进行同步，因此我们需要手动寻找国内较新的镜像站。（理论上来说一级镜像站应该比二级镜像站更新，但是有些一级镜像站的同步频率并不高，同步延迟可能会比某些二级镜像站还要高）",[22,3671,3672],{},"一个archlinux的镜像目录大概是长下面这个样子",[51,3674,3677],{"className":3675,"code":3676,"language":883},[881],"archlinux/\n├── community\n├── community-staging\n├── community-testing\n├── core\n├── extra\n├── gnome-unstable\n├── images\n├── iso\n├── kde-unstable\n├── lastsync\n├── lastupdate\n├── multilib\n├── multilib-staging\n├── multilib-testing\n├── pool\n├── staging\n└── testing\n",[42,3678,3676],{"__ignoreMap":56},[22,3680,3681,3682,45,3685,3688],{},"其中的",[42,3683,3684],{},"lastsync",[42,3686,3687],{},"lastupdate","用unix时间戳记录着上一次同步时间和镜像的上一次变更时间。",[22,3690,3691,3692,3694],{},"因此，我们只需要对比各个镜像站的",[42,3693,3684],{},"谁比较新就行了，我写了如下的辣鸡脚本",[51,3696,3698],{"className":53,"code":3697,"language":55,"meta":56,"style":56},"#!/bin/bash\n\ntuna=$(curl -s https://mirrors.tuna.tsinghua.edu.cn/archlinux/lastsync)\nbfsu=$(curl -s https://mirrors.bfsu.edu.cn/archlinux/lastsync)\nsjtug=$(curl -s https://mirror.sjtu.edu.cn/archlinux/lastsync)\naliyun=$(curl -s https://mirrors.aliyun.com/archlinux/lastsync)\nustc=$(curl -s https://mirrors.ustc.edu.cn/archlinux/lastsync)\nzju=$(curl -s https://mirrors.zju.edu.cn/archlinux/lastsync)\ncqu=$(curl -s https://mirrors.cqu.edu.cn/archlinux/lastsync)\nlzu=$(curl -s https://mirror.lzu.edu.cn/archlinux/lastsync)\nneusoft=$(curl -s https://mirrors.neusoft.edu.cn/archlinux/lastsync)\ndgut=$(curl -s https://mirrors.dgut.edu.cn/archlinux/lastsync)\nnetease=$(curl -s https://mirrors.163.com/archlinux/lastsync)\ntencent=$(curl -s https://mirrors.tencent.com/archlinux/lastsync)\nhit=$(curl -s https://mirrors.hit.edu.cn/archlinux/lastsync)\nhuaweicloud=$(curl -s https://mirrors.huaweicloud.com/archlinux/lastsync)\nsohu=$(curl -s https://mirrors.sohu.com/archlinux/lastsync)\nopentuna=$(curl -s https://opentuna.cn/archlinux/lastsync)\npku=$(curl -s https://mirrors.pku.edu.cn/archlinux/lastsync)\nnju=$(curl -s https://mirrors.nju.edu.cn/archlinux/lastsync)\nnjupt=$(curl -s https://mirrors.nju.edu.cn/archlinux/lastsync)\n\necho \"\"\"\n$tuna        #tuna\n$bfsu        #bfsu\n$sjtug       #sjtug\n$aliyun      #aliyun\n$ustc        #ustc\n$zju         #zju\n$cqu         #cqu\n$lzu         #lzu\n$neusoft     #neusoft\n$dgut        #dgut\n$netease     #netease\n$tencent     #tencent\n$hit         #hit\n$huaweicloud #huaweicloud\n$sohu        #sohu\n$opentuna    #opentuna\n$pku         #pku\n$nju         #nju\n$njupt       #njupt\n\"\"\"  | sort -r\n",[42,3699,3700,3705,3709,3732,3750,3768,3786,3804,3822,3840,3858,3876,3894,3912,3930,3948,3966,3984,4002,4020,4038,4055,4059,4067,4075,4083,4091,4099,4107,4115,4123,4131,4139,4147,4155,4163,4171,4179,4187,4195,4203,4211,4219],{"__ignoreMap":56},[60,3701,3702],{"class":62,"line":63},[60,3703,3704],{"class":3229},"#!/bin/bash\n",[60,3706,3707],{"class":62,"line":145},[60,3708,649],{"emptyLinePlaceholder":648},[60,3710,3711,3714,3718,3721,3723,3726,3729],{"class":62,"line":151},[60,3712,3713],{"class":160},"tuna",[60,3715,3717],{"class":3716},"sknuh","=",[60,3719,3720],{"class":141},"$(",[60,3722,118],{"class":66},[60,3724,3725],{"class":74}," -s",[60,3727,3728],{"class":70}," https://mirrors.tuna.tsinghua.edu.cn/archlinux/lastsync",[60,3730,3731],{"class":141},")\n",[60,3733,3734,3737,3739,3741,3743,3745,3748],{"class":62,"line":157},[60,3735,3736],{"class":160},"bfsu",[60,3738,3717],{"class":3716},[60,3740,3720],{"class":141},[60,3742,118],{"class":66},[60,3744,3725],{"class":74},[60,3746,3747],{"class":70}," https://mirrors.bfsu.edu.cn/archlinux/lastsync",[60,3749,3731],{"class":141},[60,3751,3752,3755,3757,3759,3761,3763,3766],{"class":62,"line":164},[60,3753,3754],{"class":160},"sjtug",[60,3756,3717],{"class":3716},[60,3758,3720],{"class":141},[60,3760,118],{"class":66},[60,3762,3725],{"class":74},[60,3764,3765],{"class":70}," https://mirror.sjtu.edu.cn/archlinux/lastsync",[60,3767,3731],{"class":141},[60,3769,3770,3773,3775,3777,3779,3781,3784],{"class":62,"line":170},[60,3771,3772],{"class":160},"aliyun",[60,3774,3717],{"class":3716},[60,3776,3720],{"class":141},[60,3778,118],{"class":66},[60,3780,3725],{"class":74},[60,3782,3783],{"class":70}," https://mirrors.aliyun.com/archlinux/lastsync",[60,3785,3731],{"class":141},[60,3787,3788,3791,3793,3795,3797,3799,3802],{"class":62,"line":176},[60,3789,3790],{"class":160},"ustc",[60,3792,3717],{"class":3716},[60,3794,3720],{"class":141},[60,3796,118],{"class":66},[60,3798,3725],{"class":74},[60,3800,3801],{"class":70}," https://mirrors.ustc.edu.cn/archlinux/lastsync",[60,3803,3731],{"class":141},[60,3805,3806,3809,3811,3813,3815,3817,3820],{"class":62,"line":182},[60,3807,3808],{"class":160},"zju",[60,3810,3717],{"class":3716},[60,3812,3720],{"class":141},[60,3814,118],{"class":66},[60,3816,3725],{"class":74},[60,3818,3819],{"class":70}," https://mirrors.zju.edu.cn/archlinux/lastsync",[60,3821,3731],{"class":141},[60,3823,3824,3827,3829,3831,3833,3835,3838],{"class":62,"line":188},[60,3825,3826],{"class":160},"cqu",[60,3828,3717],{"class":3716},[60,3830,3720],{"class":141},[60,3832,118],{"class":66},[60,3834,3725],{"class":74},[60,3836,3837],{"class":70}," https://mirrors.cqu.edu.cn/archlinux/lastsync",[60,3839,3731],{"class":141},[60,3841,3842,3845,3847,3849,3851,3853,3856],{"class":62,"line":3},[60,3843,3844],{"class":160},"lzu",[60,3846,3717],{"class":3716},[60,3848,3720],{"class":141},[60,3850,118],{"class":66},[60,3852,3725],{"class":74},[60,3854,3855],{"class":70}," https://mirror.lzu.edu.cn/archlinux/lastsync",[60,3857,3731],{"class":141},[60,3859,3860,3863,3865,3867,3869,3871,3874],{"class":62,"line":199},[60,3861,3862],{"class":160},"neusoft",[60,3864,3717],{"class":3716},[60,3866,3720],{"class":141},[60,3868,118],{"class":66},[60,3870,3725],{"class":74},[60,3872,3873],{"class":70}," https://mirrors.neusoft.edu.cn/archlinux/lastsync",[60,3875,3731],{"class":141},[60,3877,3878,3881,3883,3885,3887,3889,3892],{"class":62,"line":205},[60,3879,3880],{"class":160},"dgut",[60,3882,3717],{"class":3716},[60,3884,3720],{"class":141},[60,3886,118],{"class":66},[60,3888,3725],{"class":74},[60,3890,3891],{"class":70}," https://mirrors.dgut.edu.cn/archlinux/lastsync",[60,3893,3731],{"class":141},[60,3895,3896,3899,3901,3903,3905,3907,3910],{"class":62,"line":211},[60,3897,3898],{"class":160},"netease",[60,3900,3717],{"class":3716},[60,3902,3720],{"class":141},[60,3904,118],{"class":66},[60,3906,3725],{"class":74},[60,3908,3909],{"class":70}," https://mirrors.163.com/archlinux/lastsync",[60,3911,3731],{"class":141},[60,3913,3914,3917,3919,3921,3923,3925,3928],{"class":62,"line":217},[60,3915,3916],{"class":160},"tencent",[60,3918,3717],{"class":3716},[60,3920,3720],{"class":141},[60,3922,118],{"class":66},[60,3924,3725],{"class":74},[60,3926,3927],{"class":70}," https://mirrors.tencent.com/archlinux/lastsync",[60,3929,3731],{"class":141},[60,3931,3932,3935,3937,3939,3941,3943,3946],{"class":62,"line":223},[60,3933,3934],{"class":160},"hit",[60,3936,3717],{"class":3716},[60,3938,3720],{"class":141},[60,3940,118],{"class":66},[60,3942,3725],{"class":74},[60,3944,3945],{"class":70}," https://mirrors.hit.edu.cn/archlinux/lastsync",[60,3947,3731],{"class":141},[60,3949,3950,3953,3955,3957,3959,3961,3964],{"class":62,"line":229},[60,3951,3952],{"class":160},"huaweicloud",[60,3954,3717],{"class":3716},[60,3956,3720],{"class":141},[60,3958,118],{"class":66},[60,3960,3725],{"class":74},[60,3962,3963],{"class":70}," https://mirrors.huaweicloud.com/archlinux/lastsync",[60,3965,3731],{"class":141},[60,3967,3968,3971,3973,3975,3977,3979,3982],{"class":62,"line":235},[60,3969,3970],{"class":160},"sohu",[60,3972,3717],{"class":3716},[60,3974,3720],{"class":141},[60,3976,118],{"class":66},[60,3978,3725],{"class":74},[60,3980,3981],{"class":70}," https://mirrors.sohu.com/archlinux/lastsync",[60,3983,3731],{"class":141},[60,3985,3986,3989,3991,3993,3995,3997,4000],{"class":62,"line":241},[60,3987,3988],{"class":160},"opentuna",[60,3990,3717],{"class":3716},[60,3992,3720],{"class":141},[60,3994,118],{"class":66},[60,3996,3725],{"class":74},[60,3998,3999],{"class":70}," https://opentuna.cn/archlinux/lastsync",[60,4001,3731],{"class":141},[60,4003,4004,4007,4009,4011,4013,4015,4018],{"class":62,"line":247},[60,4005,4006],{"class":160},"pku",[60,4008,3717],{"class":3716},[60,4010,3720],{"class":141},[60,4012,118],{"class":66},[60,4014,3725],{"class":74},[60,4016,4017],{"class":70}," https://mirrors.pku.edu.cn/archlinux/lastsync",[60,4019,3731],{"class":141},[60,4021,4022,4025,4027,4029,4031,4033,4036],{"class":62,"line":253},[60,4023,4024],{"class":160},"nju",[60,4026,3717],{"class":3716},[60,4028,3720],{"class":141},[60,4030,118],{"class":66},[60,4032,3725],{"class":74},[60,4034,4035],{"class":70}," https://mirrors.nju.edu.cn/archlinux/lastsync",[60,4037,3731],{"class":141},[60,4039,4040,4043,4045,4047,4049,4051,4053],{"class":62,"line":259},[60,4041,4042],{"class":160},"njupt",[60,4044,3717],{"class":3716},[60,4046,3720],{"class":141},[60,4048,118],{"class":66},[60,4050,3725],{"class":74},[60,4052,4035],{"class":70},[60,4054,3731],{"class":141},[60,4056,4057],{"class":62,"line":265},[60,4058,649],{"emptyLinePlaceholder":648},[60,4060,4061,4064],{"class":62,"line":271},[60,4062,4063],{"class":1436},"echo",[60,4065,4066],{"class":70}," \"\"\"\n",[60,4068,4069,4072],{"class":62,"line":277},[60,4070,4071],{"class":160},"$tuna",[60,4073,4074],{"class":70},"        #tuna\n",[60,4076,4077,4080],{"class":62,"line":283},[60,4078,4079],{"class":160},"$bfsu",[60,4081,4082],{"class":70},"        #bfsu\n",[60,4084,4085,4088],{"class":62,"line":289},[60,4086,4087],{"class":160},"$sjtug",[60,4089,4090],{"class":70},"       #sjtug\n",[60,4092,4093,4096],{"class":62,"line":295},[60,4094,4095],{"class":160},"$aliyun",[60,4097,4098],{"class":70},"      #aliyun\n",[60,4100,4101,4104],{"class":62,"line":301},[60,4102,4103],{"class":160},"$ustc",[60,4105,4106],{"class":70},"        #ustc\n",[60,4108,4109,4112],{"class":62,"line":307},[60,4110,4111],{"class":160},"$zju",[60,4113,4114],{"class":70},"         #zju\n",[60,4116,4117,4120],{"class":62,"line":313},[60,4118,4119],{"class":160},"$cqu",[60,4121,4122],{"class":70},"         #cqu\n",[60,4124,4125,4128],{"class":62,"line":319},[60,4126,4127],{"class":160},"$lzu",[60,4129,4130],{"class":70},"         #lzu\n",[60,4132,4133,4136],{"class":62,"line":325},[60,4134,4135],{"class":160},"$neusoft",[60,4137,4138],{"class":70},"     #neusoft\n",[60,4140,4141,4144],{"class":62,"line":331},[60,4142,4143],{"class":160},"$dgut",[60,4145,4146],{"class":70},"        #dgut\n",[60,4148,4149,4152],{"class":62,"line":337},[60,4150,4151],{"class":160},"$netease",[60,4153,4154],{"class":70},"     #netease\n",[60,4156,4157,4160],{"class":62,"line":343},[60,4158,4159],{"class":160},"$tencent",[60,4161,4162],{"class":70},"     #tencent\n",[60,4164,4165,4168],{"class":62,"line":349},[60,4166,4167],{"class":160},"$hit",[60,4169,4170],{"class":70},"         #hit\n",[60,4172,4173,4176],{"class":62,"line":355},[60,4174,4175],{"class":160},"$huaweicloud",[60,4177,4178],{"class":70}," #huaweicloud\n",[60,4180,4181,4184],{"class":62,"line":361},[60,4182,4183],{"class":160},"$sohu",[60,4185,4186],{"class":70},"        #sohu\n",[60,4188,4189,4192],{"class":62,"line":367},[60,4190,4191],{"class":160},"$opentuna",[60,4193,4194],{"class":70},"    #opentuna\n",[60,4196,4197,4200],{"class":62,"line":373},[60,4198,4199],{"class":160},"$pku",[60,4201,4202],{"class":70},"         #pku\n",[60,4204,4205,4208],{"class":62,"line":379},[60,4206,4207],{"class":160},"$nju",[60,4209,4210],{"class":70},"         #nju\n",[60,4212,4213,4216],{"class":62,"line":385},[60,4214,4215],{"class":160},"$njupt",[60,4217,4218],{"class":70},"       #njupt\n",[60,4220,4221,4224,4227,4230],{"class":62,"line":391},[60,4222,4223],{"class":70},"\"\"\"",[60,4225,4226],{"class":141},"  | ",[60,4228,4229],{"class":66},"sort",[60,4231,4232],{"class":74}," -r\n",[22,4234,4235],{},"其运行结果如下",[51,4237,4240],{"className":4238,"code":4239,"language":883},[881],"1622248120     #neusoft\n1622247879        #dgut\n1622247698         #hit\n1622246042         #zju\n1622246042        #tuna\n1622246042        #bfsu\n1622242426       #sjtug\n1622242426       #njupt\n1622242426         #nju\n1622240702        #ustc\n1622240522         #cqu\n1622238783     #netease\n1622235120         #lzu\n1622232241 #huaweicloud\n1622230871     #tencent\n1622217845      #aliyun\n1622217001         #pku\n1622203750        #sohu\n1622166379    #opentuna\n",[42,4241,4239],{"__ignoreMap":56},[22,4243,4244],{},"通过不同时刻的多次测试可以看出，国内同步频率最高的是东软（neusoft）的镜像。顺手一查，没错，是个一级镜像站。通过unix时间戳得知，东软的archlinux镜像几乎是每分钟同步一次，恐怖如斯。。。",[37,4246,4247],{"id":4247},"获得更好的下载速度",[22,4249,4250,4251],{},"我们已经得知东软是国内同步频率最高的Archlinux镜像站了，但是我用东软镜像站的下载速度并不太好看。此时，我们就要搬出依云大佬的神器——",[29,4252,4255],{"href":4253,"rel":4254},"https://blog.lilydjwg.me/2020/10/29/pacsync.215578.html",[33],"pacsync",[22,4257,4258],{},"在root用户下使用如下命令装载pacysnc后",[51,4260,4262],{"className":53,"code":4261,"language":55,"meta":56,"style":56},"echo '#!/bin/bash -e\n\nunshare -m bash \u003C\u003C'EOF'\nmount --make-rprivate /\nfor f in /etc/pacman.d/*.sync; do\n  filename=\"${f%.*}\"\n  mount --bind \"$f\" \"$filename\"\ndone\npacman -Sy\nEOF' > /usr/bin/pacsync\n",[42,4263,4264,4271,4275,4280,4285,4290,4295,4300,4305,4310],{"__ignoreMap":56},[60,4265,4266,4268],{"class":62,"line":63},[60,4267,4063],{"class":1436},[60,4269,4270],{"class":70}," '#!/bin/bash -e\n",[60,4272,4273],{"class":62,"line":145},[60,4274,649],{"emptyLinePlaceholder":648},[60,4276,4277],{"class":62,"line":151},[60,4278,4279],{"class":70},"unshare -m bash \u003C\u003C'EOF'\n",[60,4281,4282],{"class":62,"line":157},[60,4283,4284],{"class":70},"mount --make-rprivate /\n",[60,4286,4287],{"class":62,"line":164},[60,4288,4289],{"class":70},"for f in /etc/pacman.d/*.sync; do\n",[60,4291,4292],{"class":62,"line":170},[60,4293,4294],{"class":70},"  filename=\"${f%.*}\"\n",[60,4296,4297],{"class":62,"line":176},[60,4298,4299],{"class":70},"  mount --bind \"$f\" \"$filename\"\n",[60,4301,4302],{"class":62,"line":182},[60,4303,4304],{"class":70},"done\n",[60,4306,4307],{"class":62,"line":188},[60,4308,4309],{"class":70},"pacman -Sy\n",[60,4311,4312,4315,4317],{"class":62,"line":3},[60,4313,4314],{"class":70},"EOF'",[60,4316,2986],{"class":141},[60,4318,4319],{"class":70},"/usr/bin/pacsync\n",[22,4321,4322,4323,4326],{},"创建",[42,4324,4325],{},"/etc/pacman.d/mirrorlist.sync","指定我们用来同步pacman数据库（比如东软）",[22,4328,4329,4332],{},[42,4330,4331],{},"/etc/pacman.d/mirrorlist","中存放其他国内镜像源地址（按照同步速度从上到下）",[22,4334,4335,4336],{},"以后的同步命令为 ",[42,4337,4338],{},"sudo pacsync && yay -Su",[22,4340,4341],{},"觉得命令过长的话设置alias可以是个不错的选择。",[1029,4343,4344],{},"html pre.shiki code .sW2Sy, html code.shiki .sW2Sy{--shiki-default:#A0A1A7;--shiki-default-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic}html pre.shiki code .sJa8x, html code.shiki .sJa8x{--shiki-default:#E45649;--shiki-dark:#E06C75}html pre.shiki code .sknuh, html code.shiki .sknuh{--shiki-default:#383A42;--shiki-dark:#56B6C2}html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html pre.shiki code .s_Sar, html code.shiki .s_Sar{--shiki-default:#0184BC;--shiki-dark:#56B6C2}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}",{"title":56,"searchDepth":145,"depth":145,"links":4346},[4347,4348],{"id":3656,"depth":151,"text":3657},{"id":4247,"depth":145,"text":4247},134,1771553316848]
[{"data":1,"prerenderedAt":2633},["ShallowReactive",2],{"randomIndex/page/9/":3,"language-switch-/page/9/-en":4,"index-page-9-zh":5,"posts-total-zh":2632},10,"/en/",[6,172,435,650,1141,1509,1593,2030,2105,2290],{"title":7,"date":8,"path":9,"tags":10,"body":14},"nodejs16：是我配不上 openssl 3 咯？","2022-08-04 17:31:49","/2022/08/04/a-fucking-store-about-openssl3-and-nodejs16",[11,12,13],"Fedora","nodejs","OpenSSL",{"type":15,"value":16,"toc":168},"minimark",[17,25,28,47,62,65,68,71,74,83,89,92,138,140,163],[18,19,20],"p",{},[21,22],"img",{"alt":23,"src":24},"长毛象的截图.png","https://static.031130.xyz/uploads/2024/08/12/62eba4eabc963.webp",[18,26,27],{},"今年上半年升级 Fedora 36 的时候遇到了这个问题。",[18,29,30,31,35,36,43,44,46],{},"那会儿很无奈，一直在等 nodejs16 合并提供 ",[32,33,34],"code",{},"--openssl-legacy-provider"," 的",[37,38,42],"a",{"href":39,"rel":40},"https://github.com/nodejs/node/pull/42972",[41],"nofollow","那个 PR","。nodejs16 是一个 lts 版本，照道理来说，既然要提供 Long-term Support，而 openssl 1 作为它的依赖之一，生命周期结束又在 nodejs16 之前，那是不是应该给 nodejs16 backport 在 nodejs17 上实现的 ",[32,45,34],{}," 参数选项呢？否则绝大多数发行版都会在 openssl 1 的生命周期结束之前切换到 openssl 3，那 nodejs16 不就没法用了嘛。",[18,48,49,50,55,56,61],{},"然而，nodejs 在他们的官网上发布的",[37,51,54],{"href":52,"rel":53},"https://nodejs.org/en/blog/announcements/nodejs16-eol/",[41],"一篇博客","刷新了我的世界观，而此前的那个 PR 甚至一度被关停。（此处有",[37,57,60],{"href":58,"rel":59},"https://whiteboard-ui8.pages.dev/translation/nodejs-eol-v16-0626/",[41],"寒晶雪提供的中文翻译","）",[18,63,64],{},"博客称他们将会把 nodejs16 的生命周期结束时间提前以防止 openssl 1 生命周期在 nodejs16 生命周期结束之前结束（这种做法甚至还有先例）",[18,66,67],{},"很无奈，那会儿有两个 npm 管理的软件没法在 Fedora 36 上编译出来，就一直搁置了下去。",[69,70],"hr",{},[18,72,73],{},"不过好在，事情还是有转机的。（要不然就这档子鸡毛蒜皮的小事我也不会专门去写篇博客出来）",[18,75,76,77,82],{},"前几天我给 ",[37,78,81],{"href":79,"rel":80},"https://github.com/atpoossfl/repo",[41],"atpoossfl 仓库","打了 rpm 版本的 nvm 以后，意外地发现 nvm 所提供的 nodejs 会自带 openssl。",[18,84,85],{},[21,86],{"alt":87,"src":88},"此为 nvm 安装的 nodejs14 目录","https://static.031130.xyz/uploads/2024/08/12/62ebadf02a5b3.webp",[18,90,91],{},"所以我们只需要使用 nvm 安装的 nodejs16 即可解决 Fedora36 以后没有 openssl 1 的问题。",[93,94,95],"blockquote",{},[18,96,97,98,101,102,105,106,109,110,113,114,119,120,123,124,127,128,131,132,134,135,137],{},"使用 Fedora 的用户需要注意，Fedora 官方源中的",[32,99,100],{},"yarnpkg","在打包时遇到了错误，他们将 ",[32,103,104],{},"/usr/lib/node_modules/yarn/bin/yarn.js"," 的 shebang 给改成了 ",[32,107,108],{},"#!/usr/bin/node","，应当改回 ",[32,111,112],{},"#!/usr/bin/env node","才能让 yarn 正常使用上 nvm 提供的 nodejs；或者干脆添加 ",[37,115,118],{"href":116,"rel":117},"https://dl.yarnpkg.com/rpm/yarn.repo",[41],"dl.yarnpkg.com"," 提供的 ",[32,121,122],{},"yarn"," 软件包。在写 specfile 的 ",[32,125,126],{},"BuildRequires"," 时，可以直接写成 ",[32,129,130],{},"/usr/bin/yarn"," 来避免频繁在 ",[32,133,122],{}," 和 ",[32,136,100],{}," 这两个包名间改动。",[69,139],{},[18,141,142,143,134,146,149,150,152,153,158,159,162],{},"更好的消息是，nodejs 已经在 ",[32,144,145],{},"v16.17.0-proposal",[32,147,148],{},"v16.x-staging"," 分支收下了这个为 nodejs16 提供 ",[32,151,34],{}," 的 ",[37,154,157],{"href":155,"rel":156},"https://github.com/nodejs/node/commit/e7b99e8c8d229ee2cc1d657ae44f715e7e5f852f",[41],"commit","。相信在不久的将来，这个 commit 将会进入主线，并在 ",[32,160,161],{},"v16.17"," 版本的 nodejs16 上发挥它的作用。",[18,164,165],{},[21,166],{"alt":157,"src":167},"https://static.031130.xyz/uploads/2024/08/12/62ebb0927943f.webp",{"title":169,"searchDepth":170,"depth":170,"links":171},"",2,[],{"title":173,"date":174,"path":175,"tags":176,"body":179},"如何拯救失声的 hollywood","2022-07-25 11:25:44","/2022/07/25/restore-the-sound-of-hollywood",[177,178],"Fun","Linux",{"type":15,"value":180,"toc":433},[181,184,193,196,201,204,207,216,227,258,269,278,281,296,426,429],[18,182,183],{},"我刚开始接触 Linux 下的 hollywood 时，我记得它运行时是有声音的，应该是 007 的主题音乐，如今再次装上 hollywood，却发现音乐没了。",[18,185,186,187,192],{},"在 Github 找到 hollywood，发现有一个 ",[37,188,191],{"href":189,"rel":190},"https://github.com/dustinkirkland/hollywood/issues/58",[41],"issue"," 也提到了这个问题。",[18,194,195],{},"原作者在该 issue 中回复道",[93,197,198],{},[18,199,200],{},"没错，它只是一段视频，音频受到版权保护。",[18,202,203],{},"所以不难看出，作者因为版权问题而去掉了音频，进而导致 hollywood 失声。但我们作为用户，是不是可以想办法获取到老版本中那段带有音频的 mp4 文件呢？",[18,205,206],{},"答案是肯定的。",[18,208,209,210,215],{},"得益于 git 的版本控制特色，在 hollywood 的 github 仓库中，我们可以找到原来的 ",[37,211,214],{"href":212,"rel":213},"https://github.com/dustinkirkland/hollywood/blob/67839229f878a08521885e9fc05dd2d3ba10ddd1/share/hollywood/mi.mp4",[41],"mp4 文件","。",[18,217,218,219,222,223,226],{},"下载这个 mp4 文件后，我们将其放入 ",[32,220,221],{},"/usr/share/hollywood/"," 路径下，重命名为 ",[32,224,225],{},"soundwave.mp4","，并确保其被正确设定为 0644 权限。",[228,229,233],"pre",{"className":230,"code":231,"language":232,"meta":169,"style":169},"language-bash shiki shiki-themes one-light one-dark-pro","sudo install -Dm644 ./mi.mp4 /usr/share/hollywood/soundwave.mp4\n","bash",[32,234,235],{"__ignoreMap":169},[236,237,240,244,248,252,255],"span",{"class":238,"line":239},"line",1,[236,241,243],{"class":242},"sAdtL","sudo",[236,245,247],{"class":246},"sDhpE"," install",[236,249,251],{"class":250},"sAGMh"," -Dm644",[236,253,254],{"class":246}," ./mi.mp4",[236,256,257],{"class":246}," /usr/share/hollywood/soundwave.mp4\n",[18,259,260,261,264,265,268],{},"接下来试着跑一跑 ",[32,262,263],{},"hollywood","，发现依然没有声音。再次查阅源码，发现缺少了 ",[32,266,267],{},"mplayer"," 这个依赖。",[18,270,271,272,274,275,277],{},"使用包管理器安装 ",[32,273,267],{}," 后，运行 ",[32,276,263],{}," 就可以听到声音了。",[18,279,280],{},"然而，你觉不觉得这个音乐。。。听上去怪怪的。。。",[18,282,283,284,286,287,292,293],{},"没错，作者在去掉音频后，给 ",[32,285,225],{}," ",[37,288,291],{"href":289,"rel":290},"https://github.com/dustinkirkland/hollywood/commit/95f77d570d86cd8b8fe0e0939049609f81d1bae0#diff-3e2bf53af1a38136a109ac4fa1b11189e7b6fcd4385e1c68683093f73c6ac485",[41],"设定了加速播放","。而我们现在需要这段视频被原速播放。编辑 ",[32,294,295],{},"/usr/lib/hollywood/mplayer",[228,297,301],{"className":298,"code":299,"language":300,"meta":169,"style":169},"language-diff shiki shiki-themes one-light one-dark-pro","#!/bin/bash\n#\n# Copyright 2014 Dustin Kirkland \u003Cdustin.kirkland@gmail.com>\n#\n# Licensed under the Apache License, Version 2.0 (the \"License\");\n# you may not use this file except in compliance with the License.\n# You may obtain a copy of the License at\n#\n#    http://www.apache.org/licenses/LICENSE-2.0\n#\n# Unless required by applicable law or agreed to in writing, software\n# distributed under the License is distributed on an \"AS IS\" BASIS,\n# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n# See the License for the specific language governing permissions and\n# limitations under the License.\ncommand -v mplayer >/dev/null 2>&1 || exit 1\ntrap \"pkill -f -9 lib/hollywood/ >/dev/null 2>&1; exit\" INT\nPKG=hollywood\ndir=\"$(dirname $0)/../../share/$PKG\"\n-DISPLAY= mplayer -vo caca -loop 0 -ss $((RANDOM % 100)) -speed 100 $MPLAYER_OPTS $dir/soundwave.mp4\n+DISPLAY= mplayer -vo caca -loop 0 $MPLAYER_OPTS $dir/soundwave.mp4\n","diff",[32,302,303,309,314,320,325,331,337,343,348,354,358,364,370,376,382,388,395,401,407,413,420],{"__ignoreMap":169},[236,304,305],{"class":238,"line":239},[236,306,308],{"class":307},"sW2Sy","#!/bin/bash\n",[236,310,311],{"class":238,"line":170},[236,312,313],{"class":307},"#\n",[236,315,317],{"class":238,"line":316},3,[236,318,319],{"class":307},"# Copyright 2014 Dustin Kirkland \u003Cdustin.kirkland@gmail.com>\n",[236,321,323],{"class":238,"line":322},4,[236,324,313],{"class":307},[236,326,328],{"class":238,"line":327},5,[236,329,330],{"class":307},"# Licensed under the Apache License, Version 2.0 (the \"License\");\n",[236,332,334],{"class":238,"line":333},6,[236,335,336],{"class":307},"# you may not use this file except in compliance with the License.\n",[236,338,340],{"class":238,"line":339},7,[236,341,342],{"class":307},"# You may obtain a copy of the License at\n",[236,344,346],{"class":238,"line":345},8,[236,347,313],{"class":307},[236,349,351],{"class":238,"line":350},9,[236,352,353],{"class":307},"#    http://www.apache.org/licenses/LICENSE-2.0\n",[236,355,356],{"class":238,"line":3},[236,357,313],{"class":307},[236,359,361],{"class":238,"line":360},11,[236,362,363],{"class":307},"# Unless required by applicable law or agreed to in writing, software\n",[236,365,367],{"class":238,"line":366},12,[236,368,369],{"class":307},"# distributed under the License is distributed on an \"AS IS\" BASIS,\n",[236,371,373],{"class":238,"line":372},13,[236,374,375],{"class":307},"# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n",[236,377,379],{"class":238,"line":378},14,[236,380,381],{"class":307},"# See the License for the specific language governing permissions and\n",[236,383,385],{"class":238,"line":384},15,[236,386,387],{"class":307},"# limitations under the License.\n",[236,389,391],{"class":238,"line":390},16,[236,392,394],{"class":393},"s5ixo","command -v mplayer >/dev/null 2>&1 || exit 1\n",[236,396,398],{"class":238,"line":397},17,[236,399,400],{"class":393},"trap \"pkill -f -9 lib/hollywood/ >/dev/null 2>&1; exit\" INT\n",[236,402,404],{"class":238,"line":403},18,[236,405,406],{"class":393},"PKG=hollywood\n",[236,408,410],{"class":238,"line":409},19,[236,411,412],{"class":393},"dir=\"$(dirname $0)/../../share/$PKG\"\n",[236,414,416],{"class":238,"line":415},20,[236,417,419],{"class":418},"sJa8x","-DISPLAY= mplayer -vo caca -loop 0 -ss $((RANDOM % 100)) -speed 100 $MPLAYER_OPTS $dir/soundwave.mp4\n",[236,421,423],{"class":238,"line":422},21,[236,424,425],{"class":246},"+DISPLAY= mplayer -vo caca -loop 0 $MPLAYER_OPTS $dir/soundwave.mp4\n",[18,427,428],{},"再次运行，确认修改已经成功。",[430,431,432],"style",{},"html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html pre.shiki code .sW2Sy, html code.shiki .sW2Sy{--shiki-default:#A0A1A7;--shiki-default-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic}html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html pre.shiki code .sJa8x, html code.shiki .sJa8x{--shiki-default:#E45649;--shiki-dark:#E06C75}",{"title":169,"searchDepth":170,"depth":170,"links":434},[],{"title":436,"date":437,"path":438,"tags":439,"body":442},"处理 fcitx5 的文字候选框在 tg 客户端上闪烁的问题","2022-07-03 13:52:44","/2022/07/03/fcitx5-blinking-on-tg-under-wayland-kde",[178,440,441],"Notes","KDE",{"type":15,"value":443,"toc":640},[444,455,459,462,468,471,474,484,487,490,493,499,506,517,520,523,526,529,544,547,551,555,576,579,587,590,594,600,603,610,617,624,637],[93,445,446],{},[18,447,448,449,454],{},"文章开头，先要感谢 fcitx5 的开发者 ",[37,450,453],{"href":451,"rel":452},"https://www.csslayer.info/wordpress/",[41],"老K"," 帮我 debug 这个问题",[456,457,458],"h2",{"id":458},"鬼畜的文字候选框",[18,460,461],{},"在新装的 Fedora 36 KDE Wayland 下使用 fcitx5 时遇到了文字候选框前后移动晃眼的问题（如下图）",[18,463,464],{},[21,465],{"alt":466,"src":467},"fcitx5 blinking","https://static.031130.xyz/uploads/2024/08/12/62c13162a6efc.gif",[456,469,470],{"id":470},"解决方案",[18,472,473],{},"当我向老K提出这个问题上的时候，老K告诉我这是预期行为，一共有两个解决方案。",[475,476,477,481],"ul",{},[478,479,480],"li",{},"使用 qt 的 text input",[478,482,483],{},"关掉 kwin 的淡入淡出特效",[18,485,486],{},"但由于我并不熟悉 KWin 的特效，所以我选择了前者的方案。",[18,488,489],{},"首先，需要确保自己的 Plasma 版本在 5.24 或以上，fcitx5 的版本号在 5.0.14 以上。",[18,491,492],{},"然后我们需要让 KWin 去启动 fcitx5。KCM 为此提供了一个非常简单的方式，如下图",[18,494,495],{},[21,496],{"alt":497,"src":498},"选择 fcitx5 就好啦","https://static.031130.xyz/uploads/2024/08/12/62c134907ada9.webp",[18,500,501,502,505],{},"随后需要确保环境变量没有设置 ",[32,503,504],{},"QT_IM_MODULE ","。一定要确保这个变量不存在，连空也不行，必须是 unset。",[18,507,508,509,512,513,516],{},"理论上来说，是不需要重启的，但我的环境变量是 ",[32,510,511],{},"fcitx5-autostart"," 这个 rpm 包在 ",[32,514,515],{},"/etc/profile.d/fcitx5.sh","里面设置的，我需要重启系统来使新的环境变量生效。",[18,518,519],{},"重启后，如果没有什么意外的话，就算成功了。",[456,521,522],{"id":522},"绝对不会缺席的意外",[18,524,525],{},"很遗憾，我遇到了意外。",[18,527,528],{},"完成上述操作后，文字候选框依然有问题。",[18,530,531,532,535,536,539,540,543],{},"在老K的正确推测下，是因为我在 Fedora 下曾经使用过 ",[32,533,534],{},"im-settings","，该程序在 ",[32,537,538],{},"$HOME/.config/environment.d/"," 路径下重新帮我设置回了 ",[32,541,542],{},"QT_IM_MODULE"," 这个变量，从而使得 tg 启动时还在使用 IM MODULE，而不是预期的 qt text input。",[18,545,546],{},"删除这两个影响环境变量的文件后，在 tg 输入时，fcitx5 的文字候选框恢复了正常。",[456,548,550],{"id":549},"debug-过程中用到的两个方式","debug 过程中用到的两个方式",[552,553,554],"h3",{"id":554},"dbus-send",[228,556,558],{"className":230,"code":557,"language":232,"meta":169,"style":169},"dbus-send --print-reply=literal --dest=org.fcitx.Fcitx5 /controller org.fcitx.Fcitx.Controller1.DebugInfo\n",[32,559,560],{"__ignoreMap":169},[236,561,562,564,567,570,573],{"class":238,"line":239},[236,563,554],{"class":242},[236,565,566],{"class":250}," --print-reply=literal",[236,568,569],{"class":250}," --dest=org.fcitx.Fcitx5",[236,571,572],{"class":246}," /controller",[236,574,575],{"class":246}," org.fcitx.Fcitx.Controller1.DebugInfo\n",[18,577,578],{},"运行如上命令后，我得到了如下的输出",[228,580,585],{"className":581,"code":583,"language":584},[582],"language-text","   Group [x11::1] has 0 InputContext(s)\nGroup [wayland:] has 5 InputContext(s)\n  IC [a50fe208d42e4611b240c0b66a2fa0b9] program:konsole frontend:dbus cap:e001800060 focus:1\n  IC [d7d4d5c05e9c445aab1af9c7dfb5fbd4] program:telegram-desktop frontend:dbus cap:e001800060 focus:0\n  IC [ac72ec3edf58481bbdf838352520efd5] program:krunner frontend:dbus cap:e001820060 focus:0\n  IC [d8b450176e204953837248f786204c29] program:plasmashell frontend:dbus cap:e001800060 focus:0\n  IC [df252979343d42ebbe9bd82ead6ff194] program: frontend:wayland cap:40 focus:0\nInput Context without group\n","text",[32,586,583],{"__ignoreMap":169},[18,588,589],{},"老K指出，出现了 telegram 的那一行表明 tg 还是在用 IM Module，所以是环境变量有问题",[552,591,593],{"id":592},"proc-查看程序运行时的环境变量","/proc 查看程序运行时的环境变量",[18,595,596],{},[21,597],{"alt":598,"src":599},"获取到的环境变量","https://static.031130.xyz/uploads/2024/08/12/62c138b030469.webp",[456,601,602],{"id":602},"参考资料",[18,604,605],{},[37,606,609],{"href":607,"rel":608},"https://www.csslayer.info/wordpress/linux/use-plasma-5-24-to-type-in-alacritty-or-any-other-text-input-v3-client-with-fcitx-5-on-wayland/",[41],"Use Plasma 5.24 to type in Alacritty (Or any other text-input-v3 client) with Fcitx 5 on Wayland",[18,611,612],{},[37,613,616],{"href":614,"rel":615},"https://fcitx-im.org/wiki/FAQ#Candidate_window_is_blinking_under_wayland_with_Fcitx_5",[41],"Candidate window is blinking under wayland with Fcitx 5",[18,618,619],{},[37,620,623],{"href":621,"rel":622},"https://www.cnblogs.com/hupeng1234/p/6735403.html",[41],"查看进程的环境变量",[18,625,626],{},[627,628,629,630,134,633,636],"em",{},"注: 上述参考资料均已在 ",[32,631,632],{},"web.archive.org",[32,634,635],{},"archive.ph"," 做过存档，如遇到原站点无法访问的情况，可自行前往这两个站点查看存档。",[430,638,639],{},"html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}",{"title":169,"searchDepth":170,"depth":170,"links":641},[642,643,644,645,649],{"id":458,"depth":170,"text":458},{"id":470,"depth":170,"text":470},{"id":522,"depth":170,"text":522},{"id":549,"depth":170,"text":550,"children":646},[647,648],{"id":554,"depth":316,"text":554},{"id":592,"depth":316,"text":593},{"id":602,"depth":170,"text":602},{"title":651,"date":652,"path":653,"tags":654,"body":656},"使用caddy反向代理维基百科中文站点","2022-05-30 08:59:21","/2022/05/30/use-caddy-to-proxy-wikipedia",[655],"Caddy",{"type":15,"value":657,"toc":1135},[658,661,669,672,675,705,709,1073,1076,1082,1089,1096,1103,1105,1127,1132],[18,659,660],{},"反代的目的无非是两点",[475,662,663,666],{},[478,664,665],{},"满足自己在无代理情况下访问无法访问的站点的需求",[478,667,668],{},"方便将站点分享给亲朋好友。",[18,670,671],{},"一直以来，我都想用 caddy 去反代一份维基百科来用，今天刚好就顺手解决了。",[456,673,674],{"id":674},"注意事项",[475,676,677,680,683,686],{},[478,678,679],{},"用于反代的机子需要有对目标站点的访问能力",[478,681,682],{},"最好准备一个新的域名作为白手套，防止被污染",[478,684,685],{},"建议增加密码保护，一来使得小鸡流量不被滥用，二来防止防火墙检测到站点内容",[478,687,688,689,692,693,696,697,701,702,704],{},"本文使用的 caddy 开启了 ",[32,690,691],{},"replace_response"," 插件，可以使用 ",[32,694,695],{},"xcaddy"," 编译或直接前往 ",[37,698,699],{"href":699,"rel":700},"https://caddyserver.com/download",[41]," 勾选相应插件后下载。安装时，建议先根据官方文档安装原版 caddy，再用启用了 ",[32,703,691],{}," 插件的 caddy 二进制文件覆盖掉原版 caddy，这样就不需要去手写 systemd 相关的文件了。",[456,706,708],{"id":707},"caddyfile","Caddyfile",[228,710,714],{"className":711,"code":712,"language":713,"meta":169,"style":169},"language-nginx shiki shiki-themes one-light one-dark-pro","{\n        order replace after encode\n}\n\nhttps://zhwiki.example.com {\n\n        reverse_proxy * https://zh.wikipedia.org {\n                header_up Host {upstream_hostport}\n                header_up X-Real-IP {http.request.remote.host}\n                header_up X-Forwarded-For {http.request.remote.host}\n                header_up X-Forwarded-Port {http.request.port}\n                header_up X-Forwarded-Proto {http.request.scheme}\n                header_up Accept-Encoding identity\n                header_down location (https://zh.wikipedia.org/)(.*) https://zhwiki.example.com/$2\n                header_down location (https://zh.m.wikipedia.org/)(.*) http://m.zhwiki.example.com/$2\n        }\n\n        replace {\n                \"upload.wikimedia.org\" \"up.zhwiki.example.com\"\n                \"zh.wikipedia.org\" \"zhwiki.example.com\"\n                \"zh.m.wikipedia.org\" \"m.zhwiki.example.com\"\n        }\n}\n\nhttps://m.zhwiki.example.com {\n\n        reverse_proxy * https://zh.m.wikipedia.org {\n                header_up Host {upstream_hostport}\n                header_up X-Real-IP {http.request.remote.host}\n                header_up X-Forwarded-For {http.request.remote.host}\n                header_up X-Forwarded-Port {http.request.port}\n                header_up X-Forwarded-Proto {http.request.scheme}\n                header_up Accept-Encoding identity\n                header_down location (https://zh.wikipedia.org/)(.*) https://zhwiki.example.com/$2\n                header_down location (https://zh.m.wikipedia.org/)(.*) http://m.zhwiki.example.com/$2\n        }\n\n        replace {\n                \"upload.wikimedia.org\" \"up.zhwiki.example.com\"\n                \"zh.wikipedia.org\" \"zhwiki.example.com\"\n                \"zh.m.wikipedia.org\" \"m.zhwiki.example.com\"\n        }\n}\n\nhttps://up.zhwiki.example.com {\n        reverse_proxy * https://upload.wikimedia.org {\n                header_up Host {upstream_hostport}\n                header_up X-Real-IP {http.request.remote.host}\n                header_up X-Forwarded-For {http.request.remote.host}\n                header_up X-Forwarded-Port {http.request.port}\n                header_up X-Forwarded-Proto {http.request.scheme}\n                header_up Accept-Encoding identity\n        }\n}\n\n","nginx",[32,715,716,721,730,735,741,752,756,764,772,779,786,793,800,807,818,827,832,836,843,848,853,858,863,868,873,883,888,896,903,910,917,924,931,938,947,956,961,966,973,978,983,988,993,998,1003,1013,1021,1028,1035,1042,1049,1056,1063,1068],{"__ignoreMap":169},[236,717,718],{"class":238,"line":239},[236,719,720],{"class":393},"{\n",[236,722,723,727],{"class":238,"line":170},[236,724,726],{"class":725},"sLKXg","        order",[236,728,729],{"class":393}," replace after encode\n",[236,731,732],{"class":238,"line":316},[236,733,734],{"class":393},"}\n",[236,736,737],{"class":238,"line":322},[236,738,740],{"emptyLinePlaceholder":739},true,"\n",[236,742,743,746,749],{"class":238,"line":327},[236,744,745],{"class":393},"https://zhwiki.example.",[236,747,748],{"class":725},"com",[236,750,751],{"class":393}," {\n",[236,753,754],{"class":238,"line":333},[236,755,740],{"emptyLinePlaceholder":739},[236,757,758,761],{"class":238,"line":339},[236,759,760],{"class":725},"        reverse_proxy",[236,762,763],{"class":393}," * https://zh.wikipedia.org {\n",[236,765,766,769],{"class":238,"line":345},[236,767,768],{"class":725},"                header_up",[236,770,771],{"class":393}," Host {upstream_hostport}\n",[236,773,774,776],{"class":238,"line":350},[236,775,768],{"class":725},[236,777,778],{"class":393}," X-Real-IP {http.request.remote.host}\n",[236,780,781,783],{"class":238,"line":3},[236,782,768],{"class":725},[236,784,785],{"class":393}," X-Forwarded-For {http.request.remote.host}\n",[236,787,788,790],{"class":238,"line":360},[236,789,768],{"class":725},[236,791,792],{"class":393}," X-Forwarded-Port {http.request.port}\n",[236,794,795,797],{"class":238,"line":366},[236,796,768],{"class":725},[236,798,799],{"class":393}," X-Forwarded-Proto {http.request.scheme}\n",[236,801,802,804],{"class":238,"line":372},[236,803,768],{"class":725},[236,805,806],{"class":393}," Accept-Encoding identity\n",[236,808,809,812,815],{"class":238,"line":378},[236,810,811],{"class":725},"                header_down",[236,813,814],{"class":393}," location (https://zh.wikipedia.org/)(.*) https://zhwiki.example.com/$",[236,816,817],{"class":418},"2\n",[236,819,820,822,825],{"class":238,"line":384},[236,821,811],{"class":725},[236,823,824],{"class":393}," location (https://zh.m.wikipedia.org/)(.*) http://m.zhwiki.example.com/$",[236,826,817],{"class":418},[236,828,829],{"class":238,"line":390},[236,830,831],{"class":393},"        }\n",[236,833,834],{"class":238,"line":397},[236,835,740],{"emptyLinePlaceholder":739},[236,837,838,841],{"class":238,"line":403},[236,839,840],{"class":725},"        replace",[236,842,751],{"class":393},[236,844,845],{"class":238,"line":409},[236,846,847],{"class":393},"                \"upload.wikimedia.org\" \"up.zhwiki.example.com\"\n",[236,849,850],{"class":238,"line":415},[236,851,852],{"class":393},"                \"zh.wikipedia.org\" \"zhwiki.example.com\"\n",[236,854,855],{"class":238,"line":422},[236,856,857],{"class":393},"                \"zh.m.wikipedia.org\" \"m.zhwiki.example.com\"\n",[236,859,861],{"class":238,"line":860},22,[236,862,831],{"class":393},[236,864,866],{"class":238,"line":865},23,[236,867,734],{"class":393},[236,869,871],{"class":238,"line":870},24,[236,872,740],{"emptyLinePlaceholder":739},[236,874,876,879,881],{"class":238,"line":875},25,[236,877,878],{"class":393},"https://m.zhwiki.example.",[236,880,748],{"class":725},[236,882,751],{"class":393},[236,884,886],{"class":238,"line":885},26,[236,887,740],{"emptyLinePlaceholder":739},[236,889,891,893],{"class":238,"line":890},27,[236,892,760],{"class":725},[236,894,895],{"class":393}," * https://zh.m.wikipedia.org {\n",[236,897,899,901],{"class":238,"line":898},28,[236,900,768],{"class":725},[236,902,771],{"class":393},[236,904,906,908],{"class":238,"line":905},29,[236,907,768],{"class":725},[236,909,778],{"class":393},[236,911,913,915],{"class":238,"line":912},30,[236,914,768],{"class":725},[236,916,785],{"class":393},[236,918,920,922],{"class":238,"line":919},31,[236,921,768],{"class":725},[236,923,792],{"class":393},[236,925,927,929],{"class":238,"line":926},32,[236,928,768],{"class":725},[236,930,799],{"class":393},[236,932,934,936],{"class":238,"line":933},33,[236,935,768],{"class":725},[236,937,806],{"class":393},[236,939,941,943,945],{"class":238,"line":940},34,[236,942,811],{"class":725},[236,944,814],{"class":393},[236,946,817],{"class":418},[236,948,950,952,954],{"class":238,"line":949},35,[236,951,811],{"class":725},[236,953,824],{"class":393},[236,955,817],{"class":418},[236,957,959],{"class":238,"line":958},36,[236,960,831],{"class":393},[236,962,964],{"class":238,"line":963},37,[236,965,740],{"emptyLinePlaceholder":739},[236,967,969,971],{"class":238,"line":968},38,[236,970,840],{"class":725},[236,972,751],{"class":393},[236,974,976],{"class":238,"line":975},39,[236,977,847],{"class":393},[236,979,981],{"class":238,"line":980},40,[236,982,852],{"class":393},[236,984,986],{"class":238,"line":985},41,[236,987,857],{"class":393},[236,989,991],{"class":238,"line":990},42,[236,992,831],{"class":393},[236,994,996],{"class":238,"line":995},43,[236,997,734],{"class":393},[236,999,1001],{"class":238,"line":1000},44,[236,1002,740],{"emptyLinePlaceholder":739},[236,1004,1006,1009,1011],{"class":238,"line":1005},45,[236,1007,1008],{"class":393},"https://up.zhwiki.example.",[236,1010,748],{"class":725},[236,1012,751],{"class":393},[236,1014,1016,1018],{"class":238,"line":1015},46,[236,1017,760],{"class":725},[236,1019,1020],{"class":393}," * https://upload.wikimedia.org {\n",[236,1022,1024,1026],{"class":238,"line":1023},47,[236,1025,768],{"class":725},[236,1027,771],{"class":393},[236,1029,1031,1033],{"class":238,"line":1030},48,[236,1032,768],{"class":725},[236,1034,778],{"class":393},[236,1036,1038,1040],{"class":238,"line":1037},49,[236,1039,768],{"class":725},[236,1041,785],{"class":393},[236,1043,1045,1047],{"class":238,"line":1044},50,[236,1046,768],{"class":725},[236,1048,792],{"class":393},[236,1050,1052,1054],{"class":238,"line":1051},51,[236,1053,768],{"class":725},[236,1055,799],{"class":393},[236,1057,1059,1061],{"class":238,"line":1058},52,[236,1060,768],{"class":725},[236,1062,806],{"class":393},[236,1064,1066],{"class":238,"line":1065},53,[236,1067,831],{"class":393},[236,1069,1071],{"class":238,"line":1070},54,[236,1072,734],{"class":393},[456,1074,1075],{"id":1075},"简单解释",[18,1077,1078,1079,1081],{},"第一大段是启用 ",[32,1080,691],{}," 插件的部分，直接照抄即可。",[18,1083,1084,1085,1088],{},"第二和第三大段的思路是一致的，分别反向代理了 PC 端和移动段的网页。两行 ",[32,1086,1087],{}," header_down"," 的写法是受到了知乎上那篇 Github 反代的启发，避免了源站发出 302 重定向时访客被带到源站去。replace 部分不用多说，就是将针对三个源站域名的请求改到反代站域名。",[18,1090,1091,1092,1095],{},"第四大段就是中规中举地反代了 ",[32,1093,1094],{},"upload.wikimedia.org"," 这个域名，上面存放的大多数是媒体文件，如果条件允许的话其实可以考虑使用多个服务器反代。",[18,1097,1098,1099,215],{},"密码保护在我这份 Caddyfile 中没有启用，如果有需要的话可以参考我的",[37,1100,1102],{"href":1101},"/2021/10/21/picuploader-on-archlinux-with-caddy/#%E8%AE%BE%E7%BD%AE%E8%AE%BF%E9%97%AE%E5%AF%86%E7%A0%81%EF%BC%88%E5%8F%AF%E9%80%89%EF%BC%89","另一篇博客",[456,1104,602],{"id":602},[18,1106,1107,1112,1117,1122],{},[37,1108,1111],{"href":1109,"rel":1110},"https://caddyserver.com/docs/",[41],"Caddy 官方文档",[37,1113,1116],{"href":1114,"rel":1115},"https://zhuanlan.zhihu.com/p/476390779",[41],"The Road to Serfdom——如何为GitHub搭建反向代理",[37,1118,1121],{"href":1119,"rel":1120},"https://ichon.me/post/1026.html",[41],"使用 Caddy 配置 Wikipedia 反向代理",[37,1123,1126],{"href":1124,"rel":1125},"https://learningman.top/archives/365",[41],"使用 Caddy 反代 ghcr.io",[18,1128,1129],{},[627,1130,1131],{},"所有参考资料除官方文档外均使用 web.archive.org 和 archive.ph 进行存档，如有无法访问的情况，请自行前往存档站获取历史存档。",[430,1133,1134],{},"html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html pre.shiki code .sLKXg, html code.shiki .sLKXg{--shiki-default:#A626A4;--shiki-dark:#C678DD}html pre.shiki code .sJa8x, html code.shiki .sJa8x{--shiki-default:#E45649;--shiki-dark:#E06C75}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}",{"title":169,"searchDepth":170,"depth":170,"links":1136},[1137,1138,1139,1140],{"id":674,"depth":170,"text":674},{"id":707,"depth":170,"text":708},{"id":1075,"depth":170,"text":1075},{"id":602,"depth":170,"text":602},{"title":1142,"date":1143,"path":1144,"tags":1145,"body":1146},"创建一个本地的 Fedora 镜像源","2022-05-11 04:18:26","/2022/05/11/setup-a-local-fedora-source",[11,655],{"type":15,"value":1147,"toc":1500},[1148,1157,1160,1183,1186,1189,1196,1199,1202,1213,1220,1232,1238,1244,1247,1257,1275,1280,1286,1290,1293,1296,1305,1308,1314,1317,1336,1339,1345,1348,1355,1362,1427,1434,1488,1497],[93,1149,1150],{},[18,1151,1152,1153,1156],{},"Fedora 36 在多次跳票后，总算是在 5月10日正式发布了。截止北京时间 5月11日凌晨两点，上海交通大学开源镜像站的上游 ",[32,1154,1155],{},"rsync://download-ib01.fedoraproject.org/","  仍然没有同步 Fedora 36 的 Release 源。鉴于 Release 自 freeze 以后基本是不会有什么大变动的，也不需要及时同步更新，干脆就直接建立一个本地的镜像源。",[456,1158,1159],{"id":1159},"准备",[1161,1162,1163,1170,1180],"ol",{},[478,1164,1165,1166,1169],{},"一块足够大的硬盘",[1167,1168],"br",{},"根据我个人实测，单 Fedora 36 的 x86_64 架构 的 Release 源中的 binary rpm 就占用了 89.6 GB，具体准备多的的硬盘空间还得看你具体需要同步些什么。",[478,1171,1172,1173,1175,1176,1179],{},"符合要求的上游",[1167,1174],{},"这里所说的符合要求一共是两个方面，一是允许 rsync 同步，二是有你想要的文件。我通过 getfedora.org 的下载按钮的转发目标得知 ",[32,1177,1178],{},"mirror.karneval.cz"," 已经完成了 Fedora 36 Release 源的同步。",[478,1181,1182],{},"良好的网络条件",[18,1184,1185],{},"这里说的良好的网络条件，并不一定是说需要访问境外站点的能力，而是你和你的上游之间的网络访问畅通，不要动不动就i断开连接那种。如果你选择的是国内镜像站作为你的上游，那一般不会有什么问题。",[456,1187,1188],{"id":1188},"开始同步",[18,1190,1191,1192,1195],{},"现在的主流方案一般都是选择 ",[32,1193,1194],{},"rsync"," 直接开整。",[552,1197,1198],{"id":1198},"试探环节",[18,1200,1201],{},"很多镜像站的 rsync 文件路径和 http 文件路径路径是不同的。",[18,1203,1204,1205,1208,1209,1212],{},"比如说，我这里用的 mirror.karneval.cz 的 http 页面显示的 fedora 仓库路径在 ",[32,1206,1207],{},"/pub/fedora","，但 rsync 同步时需要使用 ",[32,1210,1211],{},"/fedora"," 路径。",[18,1214,1215,1216,1219],{},"为了确定这一点，我们可以先通过 ",[32,1217,1218],{},"rsync rsync://example.com"," 进行预览",[228,1221,1223],{"className":230,"code":1222,"language":232,"meta":169,"style":169},"rsync rsync://mirror.karneval.cz\n",[32,1224,1225],{"__ignoreMap":169},[236,1226,1227,1229],{"class":238,"line":239},[236,1228,1194],{"class":242},[236,1230,1231],{"class":246}," rsync://mirror.karneval.cz\n",[18,1233,1234],{},[21,1235],{"alt":1236,"src":1237},"image-20220511103736493","https://static.031130.xyz/uploads/2024/08/12/627b2177c4da2.webp",[18,1239,1240,1241],{},"通过一层一层预览目录的方式，找到需要同步的路径是 ",[32,1242,1243],{},"/fedora/linux/releases/36/Everything/x86_64/os/",[552,1245,1246],{"id":1246},"同步环节",[18,1248,1249,1250,134,1253,1256],{},"通过 ",[32,1251,1252],{},"mkdir",[32,1254,1255],{},"cd"," 创建并进入我们准备用于同步源码的文件夹，然后开始执行同步命令。",[228,1258,1260],{"className":230,"code":1259,"language":232,"meta":169,"style":169},"rsync -avP rsync://mirror.karneval.cz/fedora/linux/releases/36/Everything/x86_64/os/ .\n",[32,1261,1262],{"__ignoreMap":169},[236,1263,1264,1266,1269,1272],{"class":238,"line":239},[236,1265,1194],{"class":242},[236,1267,1268],{"class":250}," -avP",[236,1270,1271],{"class":246}," rsync://mirror.karneval.cz/fedora/linux/releases/36/Everything/x86_64/os/",[236,1273,1274],{"class":246}," .\n",[18,1276,1277],{},[627,1278,1279],{},"Ps: 中途如果由于各种原因而中断了同步过程，可以再次使用上述命令继续同步，rsync 会保证文件完整性。",[18,1281,1282],{},[21,1283],{"alt":1284,"src":1285},"耗费两个半小时，同步成功","https://static.031130.xyz/uploads/2024/08/12/627b22fa44446.webp",[456,1287,1289],{"id":1288},"安装配置并启用-static-server-可选","安装、配置并启用 static server (可选)",[18,1291,1292],{},"如果只需要本机使用，那么直接跳过这一步即可；如果需要给局域网内的其他机器提供镜像源，那么需要启用 static server。",[18,1294,1295],{},"我这里选择的是 caddy，性能虽然比 nginx 略逊一筹，但胜在配置简单。",[18,1297,1298,1299,1304],{},"caddy 的安装可以直接参考",[37,1300,1303],{"href":1301,"rel":1302},"https://caddyserver.com/docs/install",[41],"官方文档","，这里不再赘述。",[18,1306,1307],{},"配置也不过那么几行的事情，我给个 example。端口号只要和别的程序没有冲突，就可以随意指定。443 端口需要 ssl 证书比较麻烦，局域网内直接用非标准端口即可。",[228,1309,1312],{"className":1310,"code":1311,"language":584},[582],":14567 {\n        root * /the/directory/you/use\n\n        file_server {\n                browse\n        }\n}\n",[32,1313,1311],{"__ignoreMap":169},[18,1315,1316],{},"配置完后直接以普通用户的权限启用即可，使用 systemd 启用需要解决 caddy 用户对目标无权限的问题。",[228,1318,1320],{"className":230,"code":1319,"language":232,"meta":169,"style":169},"caddy run --config /etc/caddy/Caddyfile\n",[32,1321,1322],{"__ignoreMap":169},[236,1323,1324,1327,1330,1333],{"class":238,"line":239},[236,1325,1326],{"class":242},"caddy",[236,1328,1329],{"class":246}," run",[236,1331,1332],{"class":250}," --config",[236,1334,1335],{"class":246}," /etc/caddy/Caddyfile\n",[18,1337,1338],{},"浏览器输入对应的 ip 和端口，应该就可以访问了。",[18,1340,1341],{},[21,1342],{"alt":1343,"src":1344},"image-20220511113417004","https://static.031130.xyz/uploads/2024/08/12/627b2ebd23331.webp",[456,1346,1347],{"id":1347},"修改源配置文件",[18,1349,1350,1351,1354],{},"由于我们仅同步了 Release 源，就只需要修改 ",[32,1352,1353],{},"/etc/yum.repo.d/fedora.repo"," 即可。",[18,1356,1357,1358,1361],{},"如果镜像源在本机上，可以直接使用 ",[32,1359,1360],{},"file://"," 协议头:",[228,1363,1365],{"className":298,"code":1364,"language":300,"meta":169,"style":169},"[fedora]\nname=Fedora $releasever - $basearch\n+ baseurl=file:///the/directory/you/use\n- metalink=https://mirrors.fedoraproject.org/metalink?repo=fedora-$releasever&arch=$basearch\nenabled=1\ncountme=1\nmetadata_expire=7d\nrepo_gpgcheck=0\ntype=rpm\ngpgcheck=1\ngpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-fedora-$releasever-$basearch\nskip_if_unavailable=False\n",[32,1366,1367,1372,1377,1382,1387,1392,1397,1402,1407,1412,1417,1422],{"__ignoreMap":169},[236,1368,1369],{"class":238,"line":239},[236,1370,1371],{"class":393},"[fedora]\n",[236,1373,1374],{"class":238,"line":170},[236,1375,1376],{"class":393},"name=Fedora $releasever - $basearch\n",[236,1378,1379],{"class":238,"line":316},[236,1380,1381],{"class":246},"+ baseurl=file:///the/directory/you/use\n",[236,1383,1384],{"class":238,"line":322},[236,1385,1386],{"class":418},"- metalink=https://mirrors.fedoraproject.org/metalink?repo=fedora-$releasever&arch=$basearch\n",[236,1388,1389],{"class":238,"line":327},[236,1390,1391],{"class":393},"enabled=1\n",[236,1393,1394],{"class":238,"line":333},[236,1395,1396],{"class":393},"countme=1\n",[236,1398,1399],{"class":238,"line":339},[236,1400,1401],{"class":393},"metadata_expire=7d\n",[236,1403,1404],{"class":238,"line":345},[236,1405,1406],{"class":393},"repo_gpgcheck=0\n",[236,1408,1409],{"class":238,"line":350},[236,1410,1411],{"class":393},"type=rpm\n",[236,1413,1414],{"class":238,"line":3},[236,1415,1416],{"class":393},"gpgcheck=1\n",[236,1418,1419],{"class":238,"line":360},[236,1420,1421],{"class":393},"gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-fedora-$releasever-$basearch\n",[236,1423,1424],{"class":238,"line":366},[236,1425,1426],{"class":393},"skip_if_unavailable=False\n",[18,1428,1429,1430,1433],{},"如果镜像源在同局域网设备上，通过 ",[32,1431,1432],{},"http://"," 协议也能达到相同的效果:",[228,1435,1437],{"className":298,"code":1436,"language":300,"meta":169,"style":169},"[fedora]\nname=Fedora $releasever - $basearch\n+ baseurl=http://192.168.1.233:14567\n- metalink=https://mirrors.fedoraproject.org/metalink?repo=fedora-$releasever&arch=$basearch\nenabled=1\ncountme=1\nmetadata_expire=7d\nrepo_gpgcheck=0\ntype=rpm\ngpgcheck=1\ngpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-fedora-$releasever-$basearch\nskip_if_unavailable=False\n",[32,1438,1439,1443,1447,1452,1456,1460,1464,1468,1472,1476,1480,1484],{"__ignoreMap":169},[236,1440,1441],{"class":238,"line":239},[236,1442,1371],{"class":393},[236,1444,1445],{"class":238,"line":170},[236,1446,1376],{"class":393},[236,1448,1449],{"class":238,"line":316},[236,1450,1451],{"class":246},"+ baseurl=http://192.168.1.233:14567\n",[236,1453,1454],{"class":238,"line":322},[236,1455,1386],{"class":418},[236,1457,1458],{"class":238,"line":327},[236,1459,1391],{"class":393},[236,1461,1462],{"class":238,"line":333},[236,1463,1396],{"class":393},[236,1465,1466],{"class":238,"line":339},[236,1467,1401],{"class":393},[236,1469,1470],{"class":238,"line":345},[236,1471,1406],{"class":393},[236,1473,1474],{"class":238,"line":350},[236,1475,1411],{"class":393},[236,1477,1478],{"class":238,"line":3},[236,1479,1416],{"class":393},[236,1481,1482],{"class":238,"line":360},[236,1483,1421],{"class":393},[236,1485,1486],{"class":238,"line":366},[236,1487,1426],{"class":393},[18,1489,1490],{},[627,1491,1492,1493,1496],{},"Ps: 提供镜像源的机子的局域网 ip 可以通过 ",[32,1494,1495],{},"ip -br a"," 命令获取",[430,1498,1499],{},"html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html pre.shiki code .sJa8x, html code.shiki .sJa8x{--shiki-default:#E45649;--shiki-dark:#E06C75}",{"title":169,"searchDepth":170,"depth":170,"links":1501},[1502,1503,1507,1508],{"id":1159,"depth":170,"text":1159},{"id":1188,"depth":170,"text":1188,"children":1504},[1505,1506],{"id":1198,"depth":316,"text":1198},{"id":1246,"depth":316,"text":1246},{"id":1288,"depth":170,"text":1289},{"id":1347,"depth":170,"text":1347},{"title":1510,"date":1511,"path":1512,"tags":1513,"body":1516},"好软推荐——FastOCR","2022-04-14 05:55:18","/2022/04/14/fastocr-experience",[1514,1515],"Experience","OpenSource Project",{"type":15,"value":1517,"toc":1591},[1518,1521,1535,1556,1562,1576,1582,1585],[18,1519,1520],{},"前两天在 PC 端有 OCR 的需求，需求如下",[475,1522,1523,1526,1529,1532],{},[478,1524,1525],{},"自带框选功能或者图片上传前的编辑功能",[478,1527,1528],{},"硬盘占用小，不要 electron (((已经受够了",[478,1530,1531],{},"支持系统托盘或者快捷键快速调出",[478,1533,1534],{},"免费",[18,1536,1537,1538,1543,1544,1549,1550,1555],{},"在",[37,1539,1542],{"href":1540,"rel":1541},"https://liolok.com/",[41],"李皓奇","的推荐下试用了 Arch 群",[37,1545,1548],{"href":1546,"rel":1547},"https://github.com/BruceZhang1993",[41],"兔兔","拿 python 和 qt 写的 ",[37,1551,1554],{"href":1552,"rel":1553},"https://github.com/BruceZhang1993/FastOCR",[41],"fastocr","，体验可以说是相当不错了。四个要求基本都能完美满足！",[18,1557,1558],{},[21,1559],{"alt":1560,"src":1561},"操作简单快捷","https://static.031130.xyz/uploads/2024/08/12/a4ddb3b05e19c.gif",[18,1563,1564,1565,1568,1569,1568,1572,1575],{},"支持 ",[627,1566,1567],{},"百度","、",[627,1570,1571],{},"有道",[627,1573,1574],{},"旷视Face++"," 三家的接口，免费额度绝对够我试用的（大不了一家用完了换一家嘛",[18,1577,1578],{},[21,1579],{"alt":1580,"src":1581},"设置界面","https://static.031130.xyz/uploads/2024/08/12/488835757d5e3.webp",[18,1583,1584],{},"此外，空间占用小，算上依赖也不过 31MB 的硬盘空间占用，连半个 electron 都不到，运行起来反而更加流畅 \u003C^_^>",[18,1586,1587],{},[21,1588],{"alt":1589,"src":1590},"诶？哪里来的atpoossfl","https://static.031130.xyz/uploads/2024/08/12/a404346841d02.webp",{"title":169,"searchDepth":170,"depth":170,"links":1592},[],{"title":1594,"date":1595,"path":1596,"tags":1597,"body":1601},"抛弃PicGo，直接使用curl将图片上传到LskyPro","2022-03-31 19:19:14","/2022/03/31/upload-pic-to-lskypro-with-curl",[1598,1599,1600],"Shell Script","Image Hosting","Lsky Pro",{"type":15,"value":1602,"toc":2028},[1603,1610,1628,1641,1650,1655,1658,1661,1672,1675,2009,2014,2017,2020,2025],[18,1604,1605,1606,1609],{},"前一阵子为了图床折腾了好长一段时间。刚开始用的是 cloudinary，虽然每月有限制，但强在境内访问速度还不错，可惜后来 ",[32,1607,1608],{},"res.cloudinary.com"," 这个域名在某些地方被 DNS 污染了，而自定义域名是付费版的功能，就不得不放弃了。",[18,1611,1612,1613,1616,1617,1622,1623,215],{},"后来也尝试过 npm图床 的方案，可惜面对这种滥用公共资源的行为我无法接受~~（肯定不是因为受不了那繁琐的上传步骤，随便传张图都得 bump 下版本号的原因）~~，而且现在境内的能作为图床使用的 npm 镜像似乎也就只剩下 ",[32,1614,1615],{},"npm.elemecdn.com"," 这一个能够正常回源了，没准哪天就用不了了，所以就去投奔了",[37,1618,1621],{"href":1619,"rel":1620},"https://dusays.com/",[41],"杜老师","的",[37,1624,1627],{"href":1625,"rel":1626},"https://7bu.top/",[41],"去不图床",[18,1629,1630,1631,1635,1636,1640],{},"去不图床采用开源图床程序 ",[37,1632,1600],{"href":1633,"rel":1634},"https://www.lsky.pro/",[41]," 搭建，没有免费服务，且配置了鉴黄服务，看起来就是打算长久做下去的图床站点。境内使用腾讯云cdn，境外采用 cloudflare cdn，速度都挺让我满意的。",[1637,1638,1639],"del",{},"（杜老师看见请给我打钱，或者多送我点空间也行","（x",[18,1642,1643,1644,1649],{},"Typora 一直是我写博客的主用 Markdown 编辑器，之前我采用 Typora 调用 ",[37,1645,1648],{"href":1646,"rel":1647},"https://github.com/xiebruce/PicUploader",[41],"PicUploader(php)"," 自动上传图片的方案写博客，体验相当不错，如图:",[18,1651,1652],{},[21,1653],{"alt":169,"src":1654},"https://static.031130.xyz/uploads/2024/08/12/62f3b881e3c4c.gif",[18,1656,1657],{},"可惜 PicUploader 目前仍然没有支持 LskyPro 的上传，我采用的是现在烂大街的 Typora+PicGo+LskyPro插件 的方案去实现 Typora 的自动上传图片功能。",[18,1659,1660],{},"这个方案有明显的弊端：",[475,1662,1663,1666,1669],{},[478,1664,1665],{},"PicGo 运行依赖于 electron，极大地消耗了系统资源。",[478,1667,1668],{},"PicGo 面对多张图片( >=4张 )同时上传时容易报错。",[478,1670,1671],{},"PicGo 对于 Linux 的支持比较有限，作者可能不熟悉 Linux，直到半个月前我去交了一个 pr 才支持 wayland 下使用 wl-clipboard 将图片链接复制到粘贴版。",[18,1673,1674],{},"正好 LskyPro 有详细的文档，应该可以用 curl 手糊一段 Shell 脚本实现直接上传，资源占用小，唯一的弊端是上传完成后的图片不容易管理。脚本如下",[228,1676,1678],{"className":230,"code":1677,"language":232,"meta":169,"style":169},"#!/bin/bash\n\nAPI_URL=\"https://7bu.top/api/v1\"\n\nAUTH_TOKEN=\"\"\n\nmarkdown=false\nwhile [[ \"$#\" -gt 0 ]]; do\n    case $1 in\n        -m|--markdown) markdown=true; shift ;;\n        *) break ;;\n    esac\ndone\n\nfor images in \"$@\"; do\n    UPLOAD_RESPONSE=$(curl -s -X POST \"$API_URL/upload\" \\\n        -H 'Content-Type: multipart/form-data' \\\n        -H \"Authorization: Bearer $AUTH_TOKEN\" \\\n        -F \"file=@$images\")\n\n    if [ \"$markdown\" = true ]; then\n        echo \"$UPLOAD_RESPONSE\" | jq -r .data.links.markdown\n    else\n        echo \"$UPLOAD_RESPONSE\" | jq -r .data.links.url\n    fi\ndone\n",[32,1679,1680,1684,1688,1700,1704,1714,1718,1728,1757,1769,1801,1811,1816,1821,1825,1848,1881,1891,1905,1921,1925,1952,1976,1981,2000,2005],{"__ignoreMap":169},[236,1681,1682],{"class":238,"line":239},[236,1683,308],{"class":307},[236,1685,1686],{"class":238,"line":170},[236,1687,740],{"emptyLinePlaceholder":739},[236,1689,1690,1693,1697],{"class":238,"line":316},[236,1691,1692],{"class":418},"API_URL",[236,1694,1696],{"class":1695},"sknuh","=",[236,1698,1699],{"class":246},"\"https://7bu.top/api/v1\"\n",[236,1701,1702],{"class":238,"line":322},[236,1703,740],{"emptyLinePlaceholder":739},[236,1705,1706,1709,1711],{"class":238,"line":327},[236,1707,1708],{"class":418},"AUTH_TOKEN",[236,1710,1696],{"class":1695},[236,1712,1713],{"class":246},"\"\"\n",[236,1715,1716],{"class":238,"line":333},[236,1717,740],{"emptyLinePlaceholder":739},[236,1719,1720,1723,1725],{"class":238,"line":339},[236,1721,1722],{"class":418},"markdown",[236,1724,1696],{"class":1695},[236,1726,1727],{"class":246},"false\n",[236,1729,1730,1733,1736,1739,1743,1745,1748,1751,1754],{"class":238,"line":345},[236,1731,1732],{"class":725},"while",[236,1734,1735],{"class":393}," [[ ",[236,1737,1738],{"class":246},"\"",[236,1740,1742],{"class":1741},"s2QsP","$#",[236,1744,1738],{"class":246},[236,1746,1747],{"class":1695}," -gt",[236,1749,1750],{"class":250}," 0",[236,1752,1753],{"class":393}," ]]; ",[236,1755,1756],{"class":725},"do\n",[236,1758,1759,1762,1766],{"class":238,"line":350},[236,1760,1761],{"class":725},"    case",[236,1763,1765],{"class":1764},"s8iYz"," $1",[236,1767,1768],{"class":725}," in\n",[236,1770,1771,1775,1778,1781,1784,1786,1788,1791,1794,1798],{"class":238,"line":3},[236,1772,1774],{"class":1773},"sDaw7","        -m",[236,1776,1777],{"class":393},"|",[236,1779,1780],{"class":1773},"--markdown",[236,1782,1783],{"class":393},") ",[236,1785,1722],{"class":418},[236,1787,1696],{"class":1695},[236,1789,1790],{"class":246},"true",[236,1792,1793],{"class":393},"; ",[236,1795,1797],{"class":1796},"s_Sar","shift",[236,1799,1800],{"class":393}," ;;\n",[236,1802,1803,1806,1809],{"class":238,"line":360},[236,1804,1805],{"class":393},"        *) ",[236,1807,1808],{"class":725},"break",[236,1810,1800],{"class":393},[236,1812,1813],{"class":238,"line":366},[236,1814,1815],{"class":725},"    esac\n",[236,1817,1818],{"class":238,"line":372},[236,1819,1820],{"class":725},"done\n",[236,1822,1823],{"class":238,"line":378},[236,1824,740],{"emptyLinePlaceholder":739},[236,1826,1827,1830,1833,1836,1839,1842,1844,1846],{"class":238,"line":384},[236,1828,1829],{"class":725},"for",[236,1831,1832],{"class":418}," images",[236,1834,1835],{"class":725}," in",[236,1837,1838],{"class":246}," \"",[236,1840,1841],{"class":1764},"$@",[236,1843,1738],{"class":246},[236,1845,1793],{"class":393},[236,1847,1756],{"class":725},[236,1849,1850,1853,1855,1858,1861,1864,1867,1870,1872,1875,1878],{"class":238,"line":390},[236,1851,1852],{"class":418},"    UPLOAD_RESPONSE",[236,1854,1696],{"class":1695},[236,1856,1857],{"class":393},"$(",[236,1859,1860],{"class":242},"curl",[236,1862,1863],{"class":250}," -s",[236,1865,1866],{"class":250}," -X",[236,1868,1869],{"class":246}," POST",[236,1871,1838],{"class":246},[236,1873,1874],{"class":418},"$API_URL",[236,1876,1877],{"class":246},"/upload\"",[236,1879,1880],{"class":1796}," \\\n",[236,1882,1883,1886,1889],{"class":238,"line":397},[236,1884,1885],{"class":250},"        -H",[236,1887,1888],{"class":246}," 'Content-Type: multipart/form-data'",[236,1890,1880],{"class":1796},[236,1892,1893,1895,1898,1901,1903],{"class":238,"line":403},[236,1894,1885],{"class":250},[236,1896,1897],{"class":246}," \"Authorization: Bearer ",[236,1899,1900],{"class":418},"$AUTH_TOKEN",[236,1902,1738],{"class":246},[236,1904,1880],{"class":1796},[236,1906,1907,1910,1913,1916,1918],{"class":238,"line":409},[236,1908,1909],{"class":250},"        -F",[236,1911,1912],{"class":246}," \"file=@",[236,1914,1915],{"class":418},"$images",[236,1917,1738],{"class":246},[236,1919,1920],{"class":393},")\n",[236,1922,1923],{"class":238,"line":415},[236,1924,740],{"emptyLinePlaceholder":739},[236,1926,1927,1930,1933,1935,1938,1940,1943,1946,1949],{"class":238,"line":422},[236,1928,1929],{"class":725},"    if",[236,1931,1932],{"class":393}," [ ",[236,1934,1738],{"class":246},[236,1936,1937],{"class":418},"$markdown",[236,1939,1738],{"class":246},[236,1941,1942],{"class":1695}," =",[236,1944,1945],{"class":250}," true",[236,1947,1948],{"class":393}," ]; ",[236,1950,1951],{"class":725},"then\n",[236,1953,1954,1957,1959,1962,1964,1967,1970,1973],{"class":238,"line":860},[236,1955,1956],{"class":1796},"        echo",[236,1958,1838],{"class":246},[236,1960,1961],{"class":418},"$UPLOAD_RESPONSE",[236,1963,1738],{"class":246},[236,1965,1966],{"class":393}," | ",[236,1968,1969],{"class":242},"jq",[236,1971,1972],{"class":250}," -r",[236,1974,1975],{"class":246}," .data.links.markdown\n",[236,1977,1978],{"class":238,"line":865},[236,1979,1980],{"class":725},"    else\n",[236,1982,1983,1985,1987,1989,1991,1993,1995,1997],{"class":238,"line":870},[236,1984,1956],{"class":1796},[236,1986,1838],{"class":246},[236,1988,1961],{"class":418},[236,1990,1738],{"class":246},[236,1992,1966],{"class":393},[236,1994,1969],{"class":242},[236,1996,1972],{"class":250},[236,1998,1999],{"class":246}," .data.links.url\n",[236,2001,2002],{"class":238,"line":875},[236,2003,2004],{"class":725},"    fi\n",[236,2006,2007],{"class":238,"line":885},[236,2008,1820],{"class":725},[93,2010,2011],{},[18,2012,2013],{},"2022/04/02更新: 第六行 $@ - \"$@\"，解决文件名中出现空格时导致的上传失败问题。",[18,2015,2016],{},"需要借助 jq 来读取返回的 json，各 Linux 发行版源内应该都有打包，自行安装即可。",[18,2018,2019],{},"授予x可执行权限后，Typora 内直接填写自定义命令输入脚本所在位置即可实现 Typora 自动上传图片了。",[93,2021,2022],{},[18,2023,2024],{},"2023/12/12更新: 支持 -m 或 --markdown 参数，使脚本输出 markdown 格式的链接。",[430,2026,2027],{},"html pre.shiki code .sW2Sy, html code.shiki .sW2Sy{--shiki-default:#A0A1A7;--shiki-default-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic}html pre.shiki code .sJa8x, html code.shiki .sJa8x{--shiki-default:#E45649;--shiki-dark:#E06C75}html pre.shiki code .sknuh, html code.shiki .sknuh{--shiki-default:#383A42;--shiki-dark:#56B6C2}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html pre.shiki code .sLKXg, html code.shiki .sLKXg{--shiki-default:#A626A4;--shiki-dark:#C678DD}html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html pre.shiki code .s2QsP, html code.shiki .s2QsP{--shiki-default:#E45649;--shiki-dark:#E5C07B}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html pre.shiki code .s8iYz, html code.shiki .s8iYz{--shiki-default:#383A42;--shiki-default-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic}html pre.shiki code .sDaw7, html code.shiki .sDaw7{--shiki-default:#0184BC;--shiki-dark:#E06C75}html pre.shiki code .s_Sar, html code.shiki .s_Sar{--shiki-default:#0184BC;--shiki-dark:#56B6C2}html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}",{"title":169,"searchDepth":170,"depth":170,"links":2029},[],{"title":2031,"date":2032,"path":2033,"tags":2034,"body":2037},"使用 Github Action 跑 rpmbuild","2022-03-06 16:02:54","/2022/03/06/run-rpmbuild-with-github-action",[11,2035,2036],"RPM Package","Github Action",{"type":15,"value":2038,"toc":2103},[2039,2042,2045,2060,2063,2080,2085,2094],[18,2040,2041],{},"一直打算用 Github Action 跑 rpmbuild 构建 rpm 包，然后传到 Action 的 Artifacts 里面，用户就可以在登陆 Github 帐号的情况下进行下载。只要不发 Release，应该就不算「再分发」的行为，也就自然规避了再分发闭源软件的法律风险。",[18,2043,2044],{},"然而，现有的那些 Action 几乎全都是针对 CentOS 老古董定制的，，有些甚至连 buildrequires 都不帮你安装，而且大部分情况下都不支持 Source 直接填写一个链接，需要你直接提供 Source 文件。我自己又不可能在 Github 的仓库里用 lfs 强行存一个 200MB+ 的二进制文件，显然是不符合我要求的。还有几个项目使用 mock 去构建的，但使用 mock 构建需要提前用 rpmbuild 生成 srpm，在我们的个人电脑上可以理解为用一个干净的 chroot 打包防止自己的环境受污染，但在一个全新的、用完一次就要扔掉的 docker 里面还要防止环境被污染似乎有些画蛇添足的嫌疑。",[18,2046,2047,2048,2053,2054,2059],{},"最终，我选择了 ",[37,2049,2052],{"href":2050,"rel":2051},"https://github.com/marketplace/actions/rpm-build",[41],"naveenrajm7/rpmbuild"," 这个项目。（虽然我并不理解为什么他要用 nodejs 去调用系统命令去执行 rpmbuild 等一系列步骤，我也没学过这类语言。不过项目的 ",[37,2055,2058],{"href":2056,"rel":2057},"https://github.com/naveenrajm7/rpmbuild/blob/master/src/main.ts",[41],"main.ts"," 我还是能仿写的。）",[18,2061,2062],{},"在经过三四个小时的摸爬滚打下，我还是成功地将这个项目按照我的想法改完了。",[475,2064,2065,2068,2071,2074,2077],{},[478,2066,2067],{},"采用 Fedora 35 作为 host 进行 rpmbuild",[478,2069,2070],{},"自动安装 buildrequires",[478,2072,2073],{},"自动下载 source",[478,2075,2076],{},"允许仓库内自带本地 source",[478,2078,2079],{},"移除针对 srpm 的构建",[18,2081,2082],{},[21,2083],{"alt":169,"src":2084},"https://static.031130.xyz/uploads/2024/08/12/bb263c91c7bf4.webp",[18,2086,2087,2088,2093],{},"改完后的 action 在 ",[37,2089,2092],{"href":2090,"rel":2091},"https://github.com/zhullyb/rpmbuild-github-action",[41],"zhullyb/rpmbuild-github-action","，欢迎使用。",[18,2095,2096,2097,2102],{},"最终是在 ",[37,2098,2101],{"href":2099,"rel":2100},"https://github.com/zhullyb/dingtalk-for-fedora",[41],"zhullyb/dingtalk-for-fedora"," 项目成功实装了，有兴趣的访客们可以去尝试着一起来白嫖 Github Action 呀！ >_\u003C",{"title":169,"searchDepth":170,"depth":170,"links":2104},[],{"title":2106,"date":2107,"path":2108,"tags":2109,"body":2110},"如何打出一个「-git」的rpm包","2022-02-07 10:23:29","/2022/02/07/how-to-package-a-git-rpm-package",[11,2035],{"type":15,"value":2111,"toc":2282},[2112,2119,2123,2130,2149,2153,2160,2164,2179,2183,2200,2204,2226,2232,2238,2258,2262,2268],[18,2113,2114,2115,2118],{},"本文中，笔者通过 github api 获取最新的 commit_id ，以一种曲线救国的方式成功为 rpm 打下了一个 ",[32,2116,2117],{},"-git"," 包。",[456,2120,2122],{"id":2121},"on-archlinux","On Archlinux",[18,2124,2125,2126,2129],{},"用过 AUR 的 Arch 用户应该知道，makepkg 支持 \"-git\" 包。当我们执行 makepkg 时，PKGBUILD 中的 ",[32,2127,2128],{},"pkgver"," 函数会自动被运行，并将输出的结果作为本次打包的版本号。这是一个非常棒的设计，我们不需要去手动更新 PKGBUILD，就可以直接从 git 服务区拉取最新的 master 分支编译打包，对于跟进开发进度而言非常方便。",[18,2131,2132,2133,2135,2136,134,2139,2142,2143,2145,2146,2148],{},"一般来说，一个 ",[32,2134,2117],{}," 包的版本号会分成 2~4 个部分，最为核心的是 ",[32,2137,2138],{},"count",[32,2140,2141],{},"commit_id","：",[32,2144,2138],{},"用于记录这是第几次提交，通过提交的次数作为版本号的靠前部分可以帮助包管理器比较版本号的新旧，比如第21次提交的代码一定比第18次的更加新，而21也正好比18大，包管理器也就凭借着这个数字来保证其可以在用户在更新的时候为用户选择一个更新版本的包；而 ",[32,2147,2141],{},"则可以帮助人类更快定位这个包是在哪一次代码提交以后编译的，以帮助 开发者/用户 定位问题。",[456,2150,2152],{"id":2151},"on-fedora","On Fedora",[18,2154,2155,2156,2159],{},"然而，这个思路在 rpm 上似乎无法实现。rpmbuild 执行的时候会事先根据版本号在 BUILDROOT 路径下创造一个 ",[32,2157,2158],{},"%{name}-%{version}-%{release}-%{arch}","的目录，如此一来，就必须先确定版本号，无法像 PKGBUILD 那样使用一个 pkgver 的函数去自动更新版本号。此外，rpm 似乎专注于软件包的 Reproducibility，也就是希望拿到了指导 rpmbuild 打包的 specfile 以后打出一个相同包的能力，因此，使用同一份 specfile 在不同时间打出一个不同包的这种行为似乎并不符合 Fedora/Redhat 的哲学，所以我们怕是等不到 rpm 支持这个功能的那一天了。",[456,2161,2163],{"id":2162},"turn-of-events","Turn of events",[18,2165,2166,2167,2172,2173,2178],{},"当然，这也并非不可能完成的任务，在 ",[37,2168,2171],{"href":2169,"rel":2170},"https://yanqiyu.info/",[41],"西木野羰基"," 的指引下，我在 Fedora Docs 找到了",[37,2174,2177],{"href":2175,"rel":2176},"https://docs.fedoraproject.org/en-US/packaging-guidelines/SourceURL/#_branch_example",[41],"对于某个 Branch 的打包样版","。其实也就是直接从 github 下载 master 分支的 master.tar.gz 压缩包来获取最新的源码，这样就确保了每一次 rpmbuild 的时候都能获取最新的源码。接下来需要处理的就是版本号的问题。",[456,2180,2182],{"id":2181},"sad-story","Sad Story",[18,2184,2185,2186,2189,2190,2193,2194,2196,2197,2199],{},"很可惜，master.tar.gz 压缩包中并不包括 ",[32,2187,2188],{},".git"," 文件，我们无法通过 ",[32,2191,2192],{},"git rev-list --count HEAD"," 来获取 ",[32,2195,2138],{}," 计数，此外，最新的 ",[32,2198,2141],{}," 我们也不得而知。即使我们知道这些参数，也无法在 rpmbuild 执行之前自动把这些参数填进 specfile 中。",[456,2201,2203],{"id":2202},"improvement","Improvement",[18,2205,2206,2207,2212,2213,2216,2217,152,2220,2225],{},"好在天无绝人之路，在 Liu Sen 的 ",[37,2208,2211],{"href":2209,"rel":2210},"https://forum.suse.org.cn/t/topic/13626",[41],"RPM 中宏的简单介绍"," 一文中发现宏其实也可以类似 bash 中的 ",[32,2214,2215],{},"$()"," 一样定义成系统运行某些命令后的结果，通过仿写 copr 上 ",[627,2218,2219],{},"atim/fractal",[37,2221,2224],{"href":2222,"rel":2223},"https://download.copr.fedorainfracloud.org/results/atim/fractal/fedora-35-x86_64/03000082-fractal-master/fractal-master.spec",[41],"specfile"," 定义了下面两个宏。",[228,2227,2230],{"className":2228,"code":2229,"language":584},[582],"%global timenow %(echo $(date +%Y%m%d.%H%M))\n%global commit_short_id %(api_result=$(curl -s https://api.github.com/repos/\u003Cusername>/\u003Creponame>/branches/master | head -n 4 | tail -n 1); echo ${api_result:12:7})\n",[32,2231,2229],{"__ignoreMap":169},[18,2233,2234,2235],{},"版本号就可以直接写成 ",[32,2236,2237],{},"%{timenow}.%{commit_id_short}",[475,2239,2240,2249],{},[478,2241,2242,2245,2246,2248],{},[32,2243,2244],{},"%{timenow}"," 是直接通过运行系统的 date 命令获得一个精确到分钟的时间来当作 ",[32,2247,2138],{}," 给 dnf 判断版本号大小使用",[478,2250,2251,2254,2255,2257],{},[32,2252,2253],{},"%{commit_id_short}"," 从 api.github.com 获取到该仓库最新的 commit 号，配合粗制滥造的 shell 命令做切片，提取前7 位，帮助用户和开发者快速定位源码版本使用。当然，也可以选择直接使用 ",[32,2256,1969],{}," 作为 json 的解释器，不过 copr 大概率没有预装，生成 srpm 的时候估计就会报错。",[456,2259,2261],{"id":2260},"review","Review",[18,2263,2264,2265,2267],{},"至此，我们成功解决了在 rpm 上打 ",[32,2266,2117],{}," 包的问题，不过仍然有以下缺点",[475,2269,2270,2273,2276,2279],{},[478,2271,2272],{},"仅支持 github 上的项目，对于其他的 git 托管服务商还需要去查阅他们的 api 文档",[478,2274,2275],{},"粗制滥造的 shell 命令可能不足以应对以后的 github api 变更",[478,2277,2278],{},"使用了精确到分钟的时间作为计数器，导致版本号过长",[478,2280,2281],{},"使用 copr 打包的时候，有概率出现 srpm 与 rpm 之间版本号出现分钟级的差异",{"title":169,"searchDepth":170,"depth":170,"links":2283},[2284,2285,2286,2287,2288,2289],{"id":2121,"depth":170,"text":2122},{"id":2151,"depth":170,"text":2152},{"id":2162,"depth":170,"text":2163},{"id":2181,"depth":170,"text":2182},{"id":2202,"depth":170,"text":2203},{"id":2260,"depth":170,"text":2261},{"title":2291,"date":2292,"path":2293,"tags":2294,"body":2295},"雪藏在开源镜像站点中的那些常用却不为人知的软件","2022-01-19 13:01:30","/2022/01/19/the-common-software-hidden-in-mirrors",null,{"type":15,"value":2296,"toc":2630},[2297,2300,2306],[18,2298,2299],{},"前两天在下载 微PE 的时候眼睛突然一瞥，发现了山东大学的开源镜像站。突然间才发现在各个开源镜像站点中提供了许多那些我们误以为只能顶着断断续续的 Github  网络才能下载的软件。",[18,2301,2302,2303],{},"下面这张列表主要来自山东大学的镜像站中的「常用软件」和南京大学的「github-release」。",[1637,2304,2305],{},"我严重怀疑南京大学就是把整个 tuna 给搬了一遍过来。",[2307,2308,2309,2339],"table",{},[2310,2311,2312],"thead",{},[2313,2314,2315,2318,2325,2332],"tr",{},[2316,2317],"th",{},[2316,2319,2320],{},[37,2321,2324],{"href":2322,"rel":2323},"https://mirrors.sdu.edu.cn",[41],"山东大学",[2316,2326,2327],{},[37,2328,2331],{"href":2329,"rel":2330},"https://mirrors.nju.edu.cn",[41],"南京大学",[2316,2333,2334],{},[37,2335,2338],{"href":2336,"rel":2337},"https://mirrors.tuna.tsinghua.edu.cn",[41],"清华大学",[2340,2341,2342,2362,2377,2400,2415,2430,2449,2464,2487,2502,2517,2536,2558,2577,2596,2615],"tbody",{},[2313,2343,2344,2348,2350,2356],{},[2345,2346,2347],"td",{},"balena-io/etcher",[2345,2349],{},[2345,2351,2352],{},[37,2353,2354],{"href":2354,"rel":2355},"https://mirrors.nju.edu.cn/github-release/balena-io/etcher/LatestRelease/",[41],[2345,2357,2358],{},[37,2359,2360],{"href":2360,"rel":2361},"https://mirrors.tuna.tsinghua.edu.cn/github-release/balena-io/etcher/LatestRelease/",[41],[2313,2363,2364,2367,2373,2375],{},[2345,2365,2366],{},"drawio-desktop",[2345,2368,2369],{},[37,2370,2371],{"href":2371,"rel":2372},"https://mirrors.sdu.edu.cn/github-release/jgraph_drawio-desktop/",[41],[2345,2374],{},[2345,2376],{},[2313,2378,2379,2382,2388,2394],{},[2345,2380,2381],{},"git-for-windows",[2345,2383,2384],{},[37,2385,2386],{"href":2386,"rel":2387},"https://mirrors.sdu.edu.cn/github-release/git-for-windows_git/",[41],[2345,2389,2390],{},[37,2391,2392],{"href":2392,"rel":2393},"https://mirrors.nju.edu.cn/github-release/git-for-windows/git/LatestRelease/",[41],[2345,2395,2396],{},[37,2397,2398],{"href":2398,"rel":2399},"https://mirrors.tuna.tsinghua.edu.cn/github-release/git-for-windows/git/LatestRelease/",[41],[2313,2401,2402,2405,2407,2413],{},[2345,2403,2404],{},"Krita",[2345,2406],{},[2345,2408,2409],{},[37,2410,2411],{"href":2411,"rel":2412},"https://mirrors.nju.edu.cn/kde/stable/krita/",[41],[2345,2414],{},[2313,2416,2417,2420,2422,2424],{},[2345,2418,2419],{},"libreoffice",[2345,2421],{},[2345,2423],{},[2345,2425,2426],{},[37,2427,2428],{"href":2428,"rel":2429},"https://mirrors.tuna.tsinghua.edu.cn/libreoffice/libreoffice/",[41],[2313,2431,2432,2435,2437,2443],{},[2345,2433,2434],{},"Magisk",[2345,2436],{},[2345,2438,2439],{},[37,2440,2441],{"href":2441,"rel":2442},"https://mirrors.nju.edu.cn/github-release/topjohnwu/Magisk/LatestRelease/",[41],[2345,2444,2445],{},[37,2446,2447],{"href":2447,"rel":2448},"https://mirrors.tuna.tsinghua.edu.cn/github-release/topjohnwu/Magisk/LatestRelease/",[41],[2313,2450,2451,2454,2460,2462],{},[2345,2452,2453],{},"Motrix",[2345,2455,2456],{},[37,2457,2458],{"href":2458,"rel":2459},"https://mirrors.sdu.edu.cn/github-release/agalwood_Motrix/",[41],[2345,2461],{},[2345,2463],{},[2313,2465,2466,2469,2475,2481],{},[2345,2467,2468],{},"obs-studio",[2345,2470,2471],{},[37,2472,2473],{"href":2473,"rel":2474},"https://mirrors.sdu.edu.cn/github-release/obsproject_obs-studio/https://mirrors.sdu.edu.cn/software/Windows/OBS%20Studio/",[41],[2345,2476,2477],{},[37,2478,2479],{"href":2479,"rel":2480},"https://mirrors.nju.edu.cn/github-release/obsproject/obs-studio/LatestRelease/",[41],[2345,2482,2483],{},[37,2484,2485],{"href":2485,"rel":2486},"https://mirrors.tuna.tsinghua.edu.cn/github-release/obsproject/obs-studio/LatestRelease/",[41],[2313,2488,2489,2492,2498,2500],{},[2345,2490,2491],{},"office tool plus",[2345,2493,2494],{},[37,2495,2496],{"href":2496,"rel":2497},"https://mirrors.sdu.edu.cn/github-release/YerongAI_Office-Tool/",[41],[2345,2499],{},[2345,2501],{},[2313,2503,2504,2507,2513,2515],{},[2345,2505,2506],{},"picgo",[2345,2508,2509],{},[37,2510,2511],{"href":2511,"rel":2512},"https://mirrors.sdu.edu.cn/github-release/pbatard_rufus/",[41],[2345,2514],{},[2345,2516],{},[2313,2518,2519,2522,2528,2534],{},[2345,2520,2521],{},"rufus",[2345,2523,2524],{},[37,2525,2526],{"href":2526,"rel":2527},"https://mirrors.sdu.edu.cn/software/Windows/Rufus/",[41],[2345,2529,2530],{},[37,2531,2532],{"href":2532,"rel":2533},"https://mirrors.nju.edu.cn/github-release/pbatard/rufus/LatestRelease/",[41],[2345,2535],{},[2313,2537,2538,2544,2550,2556],{},[2345,2539,2540],{},[37,2541,2542],{"href":2542,"rel":2543},"https://mirrors.sdu.edu.cn/software/Windows/WePE/ventoy",[41],[2345,2545,2546],{},[37,2547,2548],{"href":2548,"rel":2549},"https://mirrors.sdu.edu.cn/github-release/ventoy_Ventoy/",[41],[2345,2551,2552],{},[37,2553,2554],{"href":2554,"rel":2555},"https://mirrors.nju.edu.cn/github-release/ventoy/Ventoy/LatestRelease/",[41],[2345,2557],{},[2313,2559,2560,2563,2565,2571],{},[2345,2561,2562],{},"virtualbox",[2345,2564],{},[2345,2566,2567],{},[37,2568,2569],{"href":2569,"rel":2570},"https://mirrors.nju.edu.cn/virtualbox/",[41],[2345,2572,2573],{},[37,2574,2575],{"href":2575,"rel":2576},"https://mirrors.tuna.tsinghua.edu.cn/virtualbox/",[41],[2313,2578,2579,2582,2584,2590],{},[2345,2580,2581],{},"vlc",[2345,2583],{},[2345,2585,2586],{},[37,2587,2588],{"href":2588,"rel":2589},"https://mirrors.nju.edu.cn/videolan-ftp/",[41],[2345,2591,2592],{},[37,2593,2594],{"href":2594,"rel":2595},"https://mirrors.tuna.tsinghua.edu.cn/videolan-ftp/",[41],[2313,2597,2598,2601,2603,2609],{},[2345,2599,2600],{},"winehq",[2345,2602],{},[2345,2604,2605],{},[37,2606,2607],{"href":2607,"rel":2608},"https://mirrors.nju.edu.cn/winehq/",[41],[2345,2610,2611],{},[37,2612,2613],{"href":2613,"rel":2614},"https://mirrors.bfsu.edu.cn/winehq/",[41],[2313,2616,2617,2620,2626,2628],{},[2345,2618,2619],{},"wepe",[2345,2621,2622],{},[37,2623,2624],{"href":2624,"rel":2625},"https://mirrors.sdu.edu.cn/software/Windows/WePE/",[41],[2345,2627],{},[2345,2629],{},{"title":169,"searchDepth":170,"depth":170,"links":2631},[],134,1771555483403]
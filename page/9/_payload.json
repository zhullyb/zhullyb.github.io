[{"data":1,"prerenderedAt":2698},["ShallowReactive",2],{"randomIndex/page/9/":3,"language-switch-/page/9/-en":4,"index-page-9-zh":5,"posts-total-zh":2697},8,"/en/",[6,535,917,1001,1440,1515,1701,2043,2275,2381],{"title":7,"date":8,"path":9,"tags":10,"body":12},"使用caddy反向代理维基百科中文站点","2022-05-30 08:59:21","/2022/05/30/use-caddy-to-proxy-wikipedia",[11],"Caddy",{"type":13,"value":14,"toc":529},"minimark",[15,19,29,32,36,69,73,463,466,472,479,486,494,497,519,525],[16,17,18],"p",{},"反代的目的无非是两点",[20,21,22,26],"ul",{},[23,24,25],"li",{},"满足自己在无代理情况下访问无法访问的站点的需求",[23,27,28],{},"方便将站点分享给亲朋好友。",[16,30,31],{},"一直以来，我都想用 caddy 去反代一份维基百科来用，今天刚好就顺手解决了。",[33,34,35],"h2",{"id":35},"注意事项",[20,37,38,41,44,47],{},[23,39,40],{},"用于反代的机子需要有对目标站点的访问能力",[23,42,43],{},"最好准备一个新的域名作为白手套，防止被污染",[23,45,46],{},"建议增加密码保护，一来使得小鸡流量不被滥用，二来防止防火墙检测到站点内容",[23,48,49,50,54,55,58,59,65,66,68],{},"本文使用的 caddy 开启了 ",[51,52,53],"code",{},"replace_response"," 插件，可以使用 ",[51,56,57],{},"xcaddy"," 编译或直接前往 ",[60,61,62],"a",{"href":62,"rel":63},"https://caddyserver.com/download",[64],"nofollow"," 勾选相应插件后下载。安装时，建议先根据官方文档安装原版 caddy，再用启用了 ",[51,67,53],{}," 插件的 caddy 二进制文件覆盖掉原版 caddy，这样就不需要去手写 systemd 相关的文件了。",[33,70,72],{"id":71},"caddyfile","Caddyfile",[74,75,80],"pre",{"className":76,"code":77,"language":78,"meta":79,"style":79},"language-nginx shiki shiki-themes one-light one-dark-pro","{\n        order replace after encode\n}\n\nhttps://zhwiki.example.com {\n\n        reverse_proxy * https://zh.wikipedia.org {\n                header_up Host {upstream_hostport}\n                header_up X-Real-IP {http.request.remote.host}\n                header_up X-Forwarded-For {http.request.remote.host}\n                header_up X-Forwarded-Port {http.request.port}\n                header_up X-Forwarded-Proto {http.request.scheme}\n                header_up Accept-Encoding identity\n                header_down location (https://zh.wikipedia.org/)(.*) https://zhwiki.example.com/$2\n                header_down location (https://zh.m.wikipedia.org/)(.*) http://m.zhwiki.example.com/$2\n        }\n\n        replace {\n                \"upload.wikimedia.org\" \"up.zhwiki.example.com\"\n                \"zh.wikipedia.org\" \"zhwiki.example.com\"\n                \"zh.m.wikipedia.org\" \"m.zhwiki.example.com\"\n        }\n}\n\nhttps://m.zhwiki.example.com {\n\n        reverse_proxy * https://zh.m.wikipedia.org {\n                header_up Host {upstream_hostport}\n                header_up X-Real-IP {http.request.remote.host}\n                header_up X-Forwarded-For {http.request.remote.host}\n                header_up X-Forwarded-Port {http.request.port}\n                header_up X-Forwarded-Proto {http.request.scheme}\n                header_up Accept-Encoding identity\n                header_down location (https://zh.wikipedia.org/)(.*) https://zhwiki.example.com/$2\n                header_down location (https://zh.m.wikipedia.org/)(.*) http://m.zhwiki.example.com/$2\n        }\n\n        replace {\n                \"upload.wikimedia.org\" \"up.zhwiki.example.com\"\n                \"zh.wikipedia.org\" \"zhwiki.example.com\"\n                \"zh.m.wikipedia.org\" \"m.zhwiki.example.com\"\n        }\n}\n\nhttps://up.zhwiki.example.com {\n        reverse_proxy * https://upload.wikimedia.org {\n                header_up Host {upstream_hostport}\n                header_up X-Real-IP {http.request.remote.host}\n                header_up X-Forwarded-For {http.request.remote.host}\n                header_up X-Forwarded-Port {http.request.port}\n                header_up X-Forwarded-Proto {http.request.scheme}\n                header_up Accept-Encoding identity\n        }\n}\n\n","nginx","",[51,81,82,91,101,107,114,126,131,140,148,156,164,172,180,188,201,211,217,222,230,236,242,248,253,258,263,273,278,286,293,300,307,314,321,328,337,346,351,356,363,368,373,378,383,388,393,403,411,418,425,432,439,446,453,458],{"__ignoreMap":79},[83,84,87],"span",{"class":85,"line":86},"line",1,[83,88,90],{"class":89},"s5ixo","{\n",[83,92,94,98],{"class":85,"line":93},2,[83,95,97],{"class":96},"sLKXg","        order",[83,99,100],{"class":89}," replace after encode\n",[83,102,104],{"class":85,"line":103},3,[83,105,106],{"class":89},"}\n",[83,108,110],{"class":85,"line":109},4,[83,111,113],{"emptyLinePlaceholder":112},true,"\n",[83,115,117,120,123],{"class":85,"line":116},5,[83,118,119],{"class":89},"https://zhwiki.example.",[83,121,122],{"class":96},"com",[83,124,125],{"class":89}," {\n",[83,127,129],{"class":85,"line":128},6,[83,130,113],{"emptyLinePlaceholder":112},[83,132,134,137],{"class":85,"line":133},7,[83,135,136],{"class":96},"        reverse_proxy",[83,138,139],{"class":89}," * https://zh.wikipedia.org {\n",[83,141,142,145],{"class":85,"line":3},[83,143,144],{"class":96},"                header_up",[83,146,147],{"class":89}," Host {upstream_hostport}\n",[83,149,151,153],{"class":85,"line":150},9,[83,152,144],{"class":96},[83,154,155],{"class":89}," X-Real-IP {http.request.remote.host}\n",[83,157,159,161],{"class":85,"line":158},10,[83,160,144],{"class":96},[83,162,163],{"class":89}," X-Forwarded-For {http.request.remote.host}\n",[83,165,167,169],{"class":85,"line":166},11,[83,168,144],{"class":96},[83,170,171],{"class":89}," X-Forwarded-Port {http.request.port}\n",[83,173,175,177],{"class":85,"line":174},12,[83,176,144],{"class":96},[83,178,179],{"class":89}," X-Forwarded-Proto {http.request.scheme}\n",[83,181,183,185],{"class":85,"line":182},13,[83,184,144],{"class":96},[83,186,187],{"class":89}," Accept-Encoding identity\n",[83,189,191,194,197],{"class":85,"line":190},14,[83,192,193],{"class":96},"                header_down",[83,195,196],{"class":89}," location (https://zh.wikipedia.org/)(.*) https://zhwiki.example.com/$",[83,198,200],{"class":199},"sJa8x","2\n",[83,202,204,206,209],{"class":85,"line":203},15,[83,205,193],{"class":96},[83,207,208],{"class":89}," location (https://zh.m.wikipedia.org/)(.*) http://m.zhwiki.example.com/$",[83,210,200],{"class":199},[83,212,214],{"class":85,"line":213},16,[83,215,216],{"class":89},"        }\n",[83,218,220],{"class":85,"line":219},17,[83,221,113],{"emptyLinePlaceholder":112},[83,223,225,228],{"class":85,"line":224},18,[83,226,227],{"class":96},"        replace",[83,229,125],{"class":89},[83,231,233],{"class":85,"line":232},19,[83,234,235],{"class":89},"                \"upload.wikimedia.org\" \"up.zhwiki.example.com\"\n",[83,237,239],{"class":85,"line":238},20,[83,240,241],{"class":89},"                \"zh.wikipedia.org\" \"zhwiki.example.com\"\n",[83,243,245],{"class":85,"line":244},21,[83,246,247],{"class":89},"                \"zh.m.wikipedia.org\" \"m.zhwiki.example.com\"\n",[83,249,251],{"class":85,"line":250},22,[83,252,216],{"class":89},[83,254,256],{"class":85,"line":255},23,[83,257,106],{"class":89},[83,259,261],{"class":85,"line":260},24,[83,262,113],{"emptyLinePlaceholder":112},[83,264,266,269,271],{"class":85,"line":265},25,[83,267,268],{"class":89},"https://m.zhwiki.example.",[83,270,122],{"class":96},[83,272,125],{"class":89},[83,274,276],{"class":85,"line":275},26,[83,277,113],{"emptyLinePlaceholder":112},[83,279,281,283],{"class":85,"line":280},27,[83,282,136],{"class":96},[83,284,285],{"class":89}," * https://zh.m.wikipedia.org {\n",[83,287,289,291],{"class":85,"line":288},28,[83,290,144],{"class":96},[83,292,147],{"class":89},[83,294,296,298],{"class":85,"line":295},29,[83,297,144],{"class":96},[83,299,155],{"class":89},[83,301,303,305],{"class":85,"line":302},30,[83,304,144],{"class":96},[83,306,163],{"class":89},[83,308,310,312],{"class":85,"line":309},31,[83,311,144],{"class":96},[83,313,171],{"class":89},[83,315,317,319],{"class":85,"line":316},32,[83,318,144],{"class":96},[83,320,179],{"class":89},[83,322,324,326],{"class":85,"line":323},33,[83,325,144],{"class":96},[83,327,187],{"class":89},[83,329,331,333,335],{"class":85,"line":330},34,[83,332,193],{"class":96},[83,334,196],{"class":89},[83,336,200],{"class":199},[83,338,340,342,344],{"class":85,"line":339},35,[83,341,193],{"class":96},[83,343,208],{"class":89},[83,345,200],{"class":199},[83,347,349],{"class":85,"line":348},36,[83,350,216],{"class":89},[83,352,354],{"class":85,"line":353},37,[83,355,113],{"emptyLinePlaceholder":112},[83,357,359,361],{"class":85,"line":358},38,[83,360,227],{"class":96},[83,362,125],{"class":89},[83,364,366],{"class":85,"line":365},39,[83,367,235],{"class":89},[83,369,371],{"class":85,"line":370},40,[83,372,241],{"class":89},[83,374,376],{"class":85,"line":375},41,[83,377,247],{"class":89},[83,379,381],{"class":85,"line":380},42,[83,382,216],{"class":89},[83,384,386],{"class":85,"line":385},43,[83,387,106],{"class":89},[83,389,391],{"class":85,"line":390},44,[83,392,113],{"emptyLinePlaceholder":112},[83,394,396,399,401],{"class":85,"line":395},45,[83,397,398],{"class":89},"https://up.zhwiki.example.",[83,400,122],{"class":96},[83,402,125],{"class":89},[83,404,406,408],{"class":85,"line":405},46,[83,407,136],{"class":96},[83,409,410],{"class":89}," * https://upload.wikimedia.org {\n",[83,412,414,416],{"class":85,"line":413},47,[83,415,144],{"class":96},[83,417,147],{"class":89},[83,419,421,423],{"class":85,"line":420},48,[83,422,144],{"class":96},[83,424,155],{"class":89},[83,426,428,430],{"class":85,"line":427},49,[83,429,144],{"class":96},[83,431,163],{"class":89},[83,433,435,437],{"class":85,"line":434},50,[83,436,144],{"class":96},[83,438,171],{"class":89},[83,440,442,444],{"class":85,"line":441},51,[83,443,144],{"class":96},[83,445,179],{"class":89},[83,447,449,451],{"class":85,"line":448},52,[83,450,144],{"class":96},[83,452,187],{"class":89},[83,454,456],{"class":85,"line":455},53,[83,457,216],{"class":89},[83,459,461],{"class":85,"line":460},54,[83,462,106],{"class":89},[33,464,465],{"id":465},"简单解释",[16,467,468,469,471],{},"第一大段是启用 ",[51,470,53],{}," 插件的部分，直接照抄即可。",[16,473,474,475,478],{},"第二和第三大段的思路是一致的，分别反向代理了 PC 端和移动段的网页。两行 ",[51,476,477],{}," header_down"," 的写法是受到了知乎上那篇 Github 反代的启发，避免了源站发出 302 重定向时访客被带到源站去。replace 部分不用多说，就是将针对三个源站域名的请求改到反代站域名。",[16,480,481,482,485],{},"第四大段就是中规中举地反代了 ",[51,483,484],{},"upload.wikimedia.org"," 这个域名，上面存放的大多数是媒体文件，如果条件允许的话其实可以考虑使用多个服务器反代。",[16,487,488,489,493],{},"密码保护在我这份 Caddyfile 中没有启用，如果有需要的话可以参考我的",[60,490,492],{"href":491},"/2021/10/21/picuploader-on-archlinux-with-caddy/#%E8%AE%BE%E7%BD%AE%E8%AE%BF%E9%97%AE%E5%AF%86%E7%A0%81%EF%BC%88%E5%8F%AF%E9%80%89%EF%BC%89","另一篇博客","。",[33,495,496],{"id":496},"参考资料",[16,498,499,504,509,514],{},[60,500,503],{"href":501,"rel":502},"https://caddyserver.com/docs/",[64],"Caddy 官方文档",[60,505,508],{"href":506,"rel":507},"https://zhuanlan.zhihu.com/p/476390779",[64],"The Road to Serfdom——如何为GitHub搭建反向代理",[60,510,513],{"href":511,"rel":512},"https://ichon.me/post/1026.html",[64],"使用 Caddy 配置 Wikipedia 反向代理",[60,515,518],{"href":516,"rel":517},"https://learningman.top/archives/365",[64],"使用 Caddy 反代 ghcr.io",[16,520,521],{},[522,523,524],"em",{},"所有参考资料除官方文档外均使用 web.archive.org 和 archive.ph 进行存档，如有无法访问的情况，请自行前往存档站获取历史存档。",[526,527,528],"style",{},"html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html pre.shiki code .sLKXg, html code.shiki .sLKXg{--shiki-default:#A626A4;--shiki-dark:#C678DD}html pre.shiki code .sJa8x, html code.shiki .sJa8x{--shiki-default:#E45649;--shiki-dark:#E06C75}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}",{"title":79,"searchDepth":93,"depth":93,"links":530},[531,532,533,534],{"id":35,"depth":93,"text":35},{"id":71,"depth":93,"text":72},{"id":465,"depth":93,"text":465},{"id":496,"depth":93,"text":496},{"title":536,"date":537,"path":538,"tags":539,"body":541},"创建一个本地的 Fedora 镜像源","2022-05-11 04:18:26","/2022/05/11/setup-a-local-fedora-source",[540,11],"Fedora",{"type":13,"value":542,"toc":908},[543,553,556,579,582,585,592,596,599,610,617,633,640,646,649,660,679,684,690,694,697,700,709,712,720,723,742,745,751,754,761,768,835,842,896,905],[544,545,546],"blockquote",{},[16,547,548,549,552],{},"Fedora 36 在多次跳票后，总算是在 5月10日正式发布了。截止北京时间 5月11日凌晨两点，上海交通大学开源镜像站的上游 ",[51,550,551],{},"rsync://download-ib01.fedoraproject.org/","  仍然没有同步 Fedora 36 的 Release 源。鉴于 Release 自 freeze 以后基本是不会有什么大变动的，也不需要及时同步更新，干脆就直接建立一个本地的镜像源。",[33,554,555],{"id":555},"准备",[557,558,559,566,576],"ol",{},[23,560,561,562,565],{},"一块足够大的硬盘",[563,564],"br",{},"根据我个人实测，单 Fedora 36 的 x86_64 架构 的 Release 源中的 binary rpm 就占用了 89.6 GB，具体准备多的的硬盘空间还得看你具体需要同步些什么。",[23,567,568,569,571,572,575],{},"符合要求的上游",[563,570],{},"这里所说的符合要求一共是两个方面，一是允许 rsync 同步，二是有你想要的文件。我通过 getfedora.org 的下载按钮的转发目标得知 ",[51,573,574],{},"mirror.karneval.cz"," 已经完成了 Fedora 36 Release 源的同步。",[23,577,578],{},"良好的网络条件",[16,580,581],{},"这里说的良好的网络条件，并不一定是说需要访问境外站点的能力，而是你和你的上游之间的网络访问畅通，不要动不动就i断开连接那种。如果你选择的是国内镜像站作为你的上游，那一般不会有什么问题。",[33,583,584],{"id":584},"开始同步",[16,586,587,588,591],{},"现在的主流方案一般都是选择 ",[51,589,590],{},"rsync"," 直接开整。",[593,594,595],"h3",{"id":595},"试探环节",[16,597,598],{},"很多镜像站的 rsync 文件路径和 http 文件路径路径是不同的。",[16,600,601,602,605,606,609],{},"比如说，我这里用的 mirror.karneval.cz 的 http 页面显示的 fedora 仓库路径在 ",[51,603,604],{},"/pub/fedora","，但 rsync 同步时需要使用 ",[51,607,608],{},"/fedora"," 路径。",[16,611,612,613,616],{},"为了确定这一点，我们可以先通过 ",[51,614,615],{},"rsync rsync://example.com"," 进行预览",[74,618,622],{"className":619,"code":620,"language":621,"meta":79,"style":79},"language-bash shiki shiki-themes one-light one-dark-pro","rsync rsync://mirror.karneval.cz\n","bash",[51,623,624],{"__ignoreMap":79},[83,625,626,629],{"class":85,"line":86},[83,627,590],{"class":628},"sAdtL",[83,630,632],{"class":631},"sDhpE"," rsync://mirror.karneval.cz\n",[16,634,635],{},[636,637],"img",{"alt":638,"src":639},"image-20220511103736493","https://static.031130.xyz/uploads/2024/08/12/627b2177c4da2.webp",[16,641,642,643],{},"通过一层一层预览目录的方式，找到需要同步的路径是 ",[51,644,645],{},"/fedora/linux/releases/36/Everything/x86_64/os/",[593,647,648],{"id":648},"同步环节",[16,650,651,652,655,656,659],{},"通过 ",[51,653,654],{},"mkdir"," 和 ",[51,657,658],{},"cd"," 创建并进入我们准备用于同步源码的文件夹，然后开始执行同步命令。",[74,661,663],{"className":619,"code":662,"language":621,"meta":79,"style":79},"rsync -avP rsync://mirror.karneval.cz/fedora/linux/releases/36/Everything/x86_64/os/ .\n",[51,664,665],{"__ignoreMap":79},[83,666,667,669,673,676],{"class":85,"line":86},[83,668,590],{"class":628},[83,670,672],{"class":671},"sAGMh"," -avP",[83,674,675],{"class":631}," rsync://mirror.karneval.cz/fedora/linux/releases/36/Everything/x86_64/os/",[83,677,678],{"class":631}," .\n",[16,680,681],{},[522,682,683],{},"Ps: 中途如果由于各种原因而中断了同步过程，可以再次使用上述命令继续同步，rsync 会保证文件完整性。",[16,685,686],{},[636,687],{"alt":688,"src":689},"耗费两个半小时，同步成功","https://static.031130.xyz/uploads/2024/08/12/627b22fa44446.webp",[33,691,693],{"id":692},"安装配置并启用-static-server-可选","安装、配置并启用 static server (可选)",[16,695,696],{},"如果只需要本机使用，那么直接跳过这一步即可；如果需要给局域网内的其他机器提供镜像源，那么需要启用 static server。",[16,698,699],{},"我这里选择的是 caddy，性能虽然比 nginx 略逊一筹，但胜在配置简单。",[16,701,702,703,708],{},"caddy 的安装可以直接参考",[60,704,707],{"href":705,"rel":706},"https://caddyserver.com/docs/install",[64],"官方文档","，这里不再赘述。",[16,710,711],{},"配置也不过那么几行的事情，我给个 example。端口号只要和别的程序没有冲突，就可以随意指定。443 端口需要 ssl 证书比较麻烦，局域网内直接用非标准端口即可。",[74,713,718],{"className":714,"code":716,"language":717},[715],"language-text",":14567 {\n        root * /the/directory/you/use\n\n        file_server {\n                browse\n        }\n}\n","text",[51,719,716],{"__ignoreMap":79},[16,721,722],{},"配置完后直接以普通用户的权限启用即可，使用 systemd 启用需要解决 caddy 用户对目标无权限的问题。",[74,724,726],{"className":619,"code":725,"language":621,"meta":79,"style":79},"caddy run --config /etc/caddy/Caddyfile\n",[51,727,728],{"__ignoreMap":79},[83,729,730,733,736,739],{"class":85,"line":86},[83,731,732],{"class":628},"caddy",[83,734,735],{"class":631}," run",[83,737,738],{"class":671}," --config",[83,740,741],{"class":631}," /etc/caddy/Caddyfile\n",[16,743,744],{},"浏览器输入对应的 ip 和端口，应该就可以访问了。",[16,746,747],{},[636,748],{"alt":749,"src":750},"image-20220511113417004","https://static.031130.xyz/uploads/2024/08/12/627b2ebd23331.webp",[33,752,753],{"id":753},"修改源配置文件",[16,755,756,757,760],{},"由于我们仅同步了 Release 源，就只需要修改 ",[51,758,759],{},"/etc/yum.repo.d/fedora.repo"," 即可。",[16,762,763,764,767],{},"如果镜像源在本机上，可以直接使用 ",[51,765,766],{},"file://"," 协议头:",[74,769,773],{"className":770,"code":771,"language":772,"meta":79,"style":79},"language-diff shiki shiki-themes one-light one-dark-pro","[fedora]\nname=Fedora $releasever - $basearch\n+ baseurl=file:///the/directory/you/use\n- metalink=https://mirrors.fedoraproject.org/metalink?repo=fedora-$releasever&arch=$basearch\nenabled=1\ncountme=1\nmetadata_expire=7d\nrepo_gpgcheck=0\ntype=rpm\ngpgcheck=1\ngpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-fedora-$releasever-$basearch\nskip_if_unavailable=False\n","diff",[51,774,775,780,785,790,795,800,805,810,815,820,825,830],{"__ignoreMap":79},[83,776,777],{"class":85,"line":86},[83,778,779],{"class":89},"[fedora]\n",[83,781,782],{"class":85,"line":93},[83,783,784],{"class":89},"name=Fedora $releasever - $basearch\n",[83,786,787],{"class":85,"line":103},[83,788,789],{"class":631},"+ baseurl=file:///the/directory/you/use\n",[83,791,792],{"class":85,"line":109},[83,793,794],{"class":199},"- metalink=https://mirrors.fedoraproject.org/metalink?repo=fedora-$releasever&arch=$basearch\n",[83,796,797],{"class":85,"line":116},[83,798,799],{"class":89},"enabled=1\n",[83,801,802],{"class":85,"line":128},[83,803,804],{"class":89},"countme=1\n",[83,806,807],{"class":85,"line":133},[83,808,809],{"class":89},"metadata_expire=7d\n",[83,811,812],{"class":85,"line":3},[83,813,814],{"class":89},"repo_gpgcheck=0\n",[83,816,817],{"class":85,"line":150},[83,818,819],{"class":89},"type=rpm\n",[83,821,822],{"class":85,"line":158},[83,823,824],{"class":89},"gpgcheck=1\n",[83,826,827],{"class":85,"line":166},[83,828,829],{"class":89},"gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-fedora-$releasever-$basearch\n",[83,831,832],{"class":85,"line":174},[83,833,834],{"class":89},"skip_if_unavailable=False\n",[16,836,837,838,841],{},"如果镜像源在同局域网设备上，通过 ",[51,839,840],{},"http://"," 协议也能达到相同的效果:",[74,843,845],{"className":770,"code":844,"language":772,"meta":79,"style":79},"[fedora]\nname=Fedora $releasever - $basearch\n+ baseurl=http://192.168.1.233:14567\n- metalink=https://mirrors.fedoraproject.org/metalink?repo=fedora-$releasever&arch=$basearch\nenabled=1\ncountme=1\nmetadata_expire=7d\nrepo_gpgcheck=0\ntype=rpm\ngpgcheck=1\ngpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-fedora-$releasever-$basearch\nskip_if_unavailable=False\n",[51,846,847,851,855,860,864,868,872,876,880,884,888,892],{"__ignoreMap":79},[83,848,849],{"class":85,"line":86},[83,850,779],{"class":89},[83,852,853],{"class":85,"line":93},[83,854,784],{"class":89},[83,856,857],{"class":85,"line":103},[83,858,859],{"class":631},"+ baseurl=http://192.168.1.233:14567\n",[83,861,862],{"class":85,"line":109},[83,863,794],{"class":199},[83,865,866],{"class":85,"line":116},[83,867,799],{"class":89},[83,869,870],{"class":85,"line":128},[83,871,804],{"class":89},[83,873,874],{"class":85,"line":133},[83,875,809],{"class":89},[83,877,878],{"class":85,"line":3},[83,879,814],{"class":89},[83,881,882],{"class":85,"line":150},[83,883,819],{"class":89},[83,885,886],{"class":85,"line":158},[83,887,824],{"class":89},[83,889,890],{"class":85,"line":166},[83,891,829],{"class":89},[83,893,894],{"class":85,"line":174},[83,895,834],{"class":89},[16,897,898],{},[522,899,900,901,904],{},"Ps: 提供镜像源的机子的局域网 ip 可以通过 ",[51,902,903],{},"ip -br a"," 命令获取",[526,906,907],{},"html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html pre.shiki code .sJa8x, html code.shiki .sJa8x{--shiki-default:#E45649;--shiki-dark:#E06C75}",{"title":79,"searchDepth":93,"depth":93,"links":909},[910,911,915,916],{"id":555,"depth":93,"text":555},{"id":584,"depth":93,"text":584,"children":912},[913,914],{"id":595,"depth":103,"text":595},{"id":648,"depth":103,"text":648},{"id":692,"depth":93,"text":693},{"id":753,"depth":93,"text":753},{"title":918,"date":919,"path":920,"tags":921,"body":924},"好软推荐——FastOCR","2022-04-14 05:55:18","/2022/04/14/fastocr-experience",[922,923],"Experience","OpenSource Project",{"type":13,"value":925,"toc":999},[926,929,943,964,970,984,990,993],[16,927,928],{},"前两天在 PC 端有 OCR 的需求，需求如下",[20,930,931,934,937,940],{},[23,932,933],{},"自带框选功能或者图片上传前的编辑功能",[23,935,936],{},"硬盘占用小，不要 electron (((已经受够了",[23,938,939],{},"支持系统托盘或者快捷键快速调出",[23,941,942],{},"免费",[16,944,945,946,951,952,957,958,963],{},"在",[60,947,950],{"href":948,"rel":949},"https://liolok.com/",[64],"李皓奇","的推荐下试用了 Arch 群",[60,953,956],{"href":954,"rel":955},"https://github.com/BruceZhang1993",[64],"兔兔","拿 python 和 qt 写的 ",[60,959,962],{"href":960,"rel":961},"https://github.com/BruceZhang1993/FastOCR",[64],"fastocr","，体验可以说是相当不错了。四个要求基本都能完美满足！",[16,965,966],{},[636,967],{"alt":968,"src":969},"操作简单快捷","https://static.031130.xyz/uploads/2024/08/12/a4ddb3b05e19c.gif",[16,971,972,973,976,977,976,980,983],{},"支持 ",[522,974,975],{},"百度","、",[522,978,979],{},"有道",[522,981,982],{},"旷视Face++"," 三家的接口，免费额度绝对够我试用的（大不了一家用完了换一家嘛",[16,985,986],{},[636,987],{"alt":988,"src":989},"设置界面","https://static.031130.xyz/uploads/2024/08/12/488835757d5e3.webp",[16,991,992],{},"此外，空间占用小，算上依赖也不过 31MB 的硬盘空间占用，连半个 electron 都不到，运行起来反而更加流畅 \u003C^_^>",[16,994,995],{},[636,996],{"alt":997,"src":998},"诶？哪里来的atpoossfl","https://static.031130.xyz/uploads/2024/08/12/a404346841d02.webp",{"title":79,"searchDepth":93,"depth":93,"links":1000},[],{"title":1002,"date":1003,"path":1004,"tags":1005,"body":1009},"抛弃PicGo，直接使用curl将图片上传到LskyPro","2022-03-31 19:19:14","/2022/03/31/upload-pic-to-lskypro-with-curl",[1006,1007,1008],"Shell Script","Image Hosting","Lsky Pro",{"type":13,"value":1010,"toc":1438},[1011,1018,1036,1049,1058,1063,1066,1069,1080,1083,1419,1424,1427,1430,1435],[16,1012,1013,1014,1017],{},"前一阵子为了图床折腾了好长一段时间。刚开始用的是 cloudinary，虽然每月有限制，但强在境内访问速度还不错，可惜后来 ",[51,1015,1016],{},"res.cloudinary.com"," 这个域名在某些地方被 DNS 污染了，而自定义域名是付费版的功能，就不得不放弃了。",[16,1019,1020,1021,1024,1025,1030,1031,493],{},"后来也尝试过 npm图床 的方案，可惜面对这种滥用公共资源的行为我无法接受~~（肯定不是因为受不了那繁琐的上传步骤，随便传张图都得 bump 下版本号的原因）~~，而且现在境内的能作为图床使用的 npm 镜像似乎也就只剩下 ",[51,1022,1023],{},"npm.elemecdn.com"," 这一个能够正常回源了，没准哪天就用不了了，所以就去投奔了",[60,1026,1029],{"href":1027,"rel":1028},"https://dusays.com/",[64],"杜老师","的",[60,1032,1035],{"href":1033,"rel":1034},"https://7bu.top/",[64],"去不图床",[16,1037,1038,1039,1043,1044,1048],{},"去不图床采用开源图床程序 ",[60,1040,1008],{"href":1041,"rel":1042},"https://www.lsky.pro/",[64]," 搭建，没有免费服务，且配置了鉴黄服务，看起来就是打算长久做下去的图床站点。境内使用腾讯云cdn，境外采用 cloudflare cdn，速度都挺让我满意的。",[1045,1046,1047],"del",{},"（杜老师看见请给我打钱，或者多送我点空间也行","（x",[16,1050,1051,1052,1057],{},"Typora 一直是我写博客的主用 Markdown 编辑器，之前我采用 Typora 调用 ",[60,1053,1056],{"href":1054,"rel":1055},"https://github.com/xiebruce/PicUploader",[64],"PicUploader(php)"," 自动上传图片的方案写博客，体验相当不错，如图:",[16,1059,1060],{},[636,1061],{"alt":79,"src":1062},"https://static.031130.xyz/uploads/2024/08/12/62f3b881e3c4c.gif",[16,1064,1065],{},"可惜 PicUploader 目前仍然没有支持 LskyPro 的上传，我采用的是现在烂大街的 Typora+PicGo+LskyPro插件 的方案去实现 Typora 的自动上传图片功能。",[16,1067,1068],{},"这个方案有明显的弊端：",[20,1070,1071,1074,1077],{},[23,1072,1073],{},"PicGo 运行依赖于 electron，极大地消耗了系统资源。",[23,1075,1076],{},"PicGo 面对多张图片( >=4张 )同时上传时容易报错。",[23,1078,1079],{},"PicGo 对于 Linux 的支持比较有限，作者可能不熟悉 Linux，直到半个月前我去交了一个 pr 才支持 wayland 下使用 wl-clipboard 将图片链接复制到粘贴版。",[16,1081,1082],{},"正好 LskyPro 有详细的文档，应该可以用 curl 手糊一段 Shell 脚本实现直接上传，资源占用小，唯一的弊端是上传完成后的图片不容易管理。脚本如下",[74,1084,1086],{"className":619,"code":1085,"language":621,"meta":79,"style":79},"#!/bin/bash\n\nAPI_URL=\"https://7bu.top/api/v1\"\n\nAUTH_TOKEN=\"\"\n\nmarkdown=false\nwhile [[ \"$#\" -gt 0 ]]; do\n    case $1 in\n        -m|--markdown) markdown=true; shift ;;\n        *) break ;;\n    esac\ndone\n\nfor images in \"$@\"; do\n    UPLOAD_RESPONSE=$(curl -s -X POST \"$API_URL/upload\" \\\n        -H 'Content-Type: multipart/form-data' \\\n        -H \"Authorization: Bearer $AUTH_TOKEN\" \\\n        -F \"file=@$images\")\n\n    if [ \"$markdown\" = true ]; then\n        echo \"$UPLOAD_RESPONSE\" | jq -r .data.links.markdown\n    else\n        echo \"$UPLOAD_RESPONSE\" | jq -r .data.links.url\n    fi\ndone\n",[51,1087,1088,1094,1098,1110,1114,1124,1128,1138,1167,1179,1211,1221,1226,1231,1235,1258,1291,1301,1315,1331,1335,1362,1386,1391,1410,1415],{"__ignoreMap":79},[83,1089,1090],{"class":85,"line":86},[83,1091,1093],{"class":1092},"sW2Sy","#!/bin/bash\n",[83,1095,1096],{"class":85,"line":93},[83,1097,113],{"emptyLinePlaceholder":112},[83,1099,1100,1103,1107],{"class":85,"line":103},[83,1101,1102],{"class":199},"API_URL",[83,1104,1106],{"class":1105},"sknuh","=",[83,1108,1109],{"class":631},"\"https://7bu.top/api/v1\"\n",[83,1111,1112],{"class":85,"line":109},[83,1113,113],{"emptyLinePlaceholder":112},[83,1115,1116,1119,1121],{"class":85,"line":116},[83,1117,1118],{"class":199},"AUTH_TOKEN",[83,1120,1106],{"class":1105},[83,1122,1123],{"class":631},"\"\"\n",[83,1125,1126],{"class":85,"line":128},[83,1127,113],{"emptyLinePlaceholder":112},[83,1129,1130,1133,1135],{"class":85,"line":133},[83,1131,1132],{"class":199},"markdown",[83,1134,1106],{"class":1105},[83,1136,1137],{"class":631},"false\n",[83,1139,1140,1143,1146,1149,1153,1155,1158,1161,1164],{"class":85,"line":3},[83,1141,1142],{"class":96},"while",[83,1144,1145],{"class":89}," [[ ",[83,1147,1148],{"class":631},"\"",[83,1150,1152],{"class":1151},"s2QsP","$#",[83,1154,1148],{"class":631},[83,1156,1157],{"class":1105}," -gt",[83,1159,1160],{"class":671}," 0",[83,1162,1163],{"class":89}," ]]; ",[83,1165,1166],{"class":96},"do\n",[83,1168,1169,1172,1176],{"class":85,"line":150},[83,1170,1171],{"class":96},"    case",[83,1173,1175],{"class":1174},"s8iYz"," $1",[83,1177,1178],{"class":96}," in\n",[83,1180,1181,1185,1188,1191,1194,1196,1198,1201,1204,1208],{"class":85,"line":158},[83,1182,1184],{"class":1183},"sDaw7","        -m",[83,1186,1187],{"class":89},"|",[83,1189,1190],{"class":1183},"--markdown",[83,1192,1193],{"class":89},") ",[83,1195,1132],{"class":199},[83,1197,1106],{"class":1105},[83,1199,1200],{"class":631},"true",[83,1202,1203],{"class":89},"; ",[83,1205,1207],{"class":1206},"s_Sar","shift",[83,1209,1210],{"class":89}," ;;\n",[83,1212,1213,1216,1219],{"class":85,"line":166},[83,1214,1215],{"class":89},"        *) ",[83,1217,1218],{"class":96},"break",[83,1220,1210],{"class":89},[83,1222,1223],{"class":85,"line":174},[83,1224,1225],{"class":96},"    esac\n",[83,1227,1228],{"class":85,"line":182},[83,1229,1230],{"class":96},"done\n",[83,1232,1233],{"class":85,"line":190},[83,1234,113],{"emptyLinePlaceholder":112},[83,1236,1237,1240,1243,1246,1249,1252,1254,1256],{"class":85,"line":203},[83,1238,1239],{"class":96},"for",[83,1241,1242],{"class":199}," images",[83,1244,1245],{"class":96}," in",[83,1247,1248],{"class":631}," \"",[83,1250,1251],{"class":1174},"$@",[83,1253,1148],{"class":631},[83,1255,1203],{"class":89},[83,1257,1166],{"class":96},[83,1259,1260,1263,1265,1268,1271,1274,1277,1280,1282,1285,1288],{"class":85,"line":213},[83,1261,1262],{"class":199},"    UPLOAD_RESPONSE",[83,1264,1106],{"class":1105},[83,1266,1267],{"class":89},"$(",[83,1269,1270],{"class":628},"curl",[83,1272,1273],{"class":671}," -s",[83,1275,1276],{"class":671}," -X",[83,1278,1279],{"class":631}," POST",[83,1281,1248],{"class":631},[83,1283,1284],{"class":199},"$API_URL",[83,1286,1287],{"class":631},"/upload\"",[83,1289,1290],{"class":1206}," \\\n",[83,1292,1293,1296,1299],{"class":85,"line":219},[83,1294,1295],{"class":671},"        -H",[83,1297,1298],{"class":631}," 'Content-Type: multipart/form-data'",[83,1300,1290],{"class":1206},[83,1302,1303,1305,1308,1311,1313],{"class":85,"line":224},[83,1304,1295],{"class":671},[83,1306,1307],{"class":631}," \"Authorization: Bearer ",[83,1309,1310],{"class":199},"$AUTH_TOKEN",[83,1312,1148],{"class":631},[83,1314,1290],{"class":1206},[83,1316,1317,1320,1323,1326,1328],{"class":85,"line":232},[83,1318,1319],{"class":671},"        -F",[83,1321,1322],{"class":631}," \"file=@",[83,1324,1325],{"class":199},"$images",[83,1327,1148],{"class":631},[83,1329,1330],{"class":89},")\n",[83,1332,1333],{"class":85,"line":238},[83,1334,113],{"emptyLinePlaceholder":112},[83,1336,1337,1340,1343,1345,1348,1350,1353,1356,1359],{"class":85,"line":244},[83,1338,1339],{"class":96},"    if",[83,1341,1342],{"class":89}," [ ",[83,1344,1148],{"class":631},[83,1346,1347],{"class":199},"$markdown",[83,1349,1148],{"class":631},[83,1351,1352],{"class":1105}," =",[83,1354,1355],{"class":671}," true",[83,1357,1358],{"class":89}," ]; ",[83,1360,1361],{"class":96},"then\n",[83,1363,1364,1367,1369,1372,1374,1377,1380,1383],{"class":85,"line":250},[83,1365,1366],{"class":1206},"        echo",[83,1368,1248],{"class":631},[83,1370,1371],{"class":199},"$UPLOAD_RESPONSE",[83,1373,1148],{"class":631},[83,1375,1376],{"class":89}," | ",[83,1378,1379],{"class":628},"jq",[83,1381,1382],{"class":671}," -r",[83,1384,1385],{"class":631}," .data.links.markdown\n",[83,1387,1388],{"class":85,"line":255},[83,1389,1390],{"class":96},"    else\n",[83,1392,1393,1395,1397,1399,1401,1403,1405,1407],{"class":85,"line":260},[83,1394,1366],{"class":1206},[83,1396,1248],{"class":631},[83,1398,1371],{"class":199},[83,1400,1148],{"class":631},[83,1402,1376],{"class":89},[83,1404,1379],{"class":628},[83,1406,1382],{"class":671},[83,1408,1409],{"class":631}," .data.links.url\n",[83,1411,1412],{"class":85,"line":265},[83,1413,1414],{"class":96},"    fi\n",[83,1416,1417],{"class":85,"line":275},[83,1418,1230],{"class":96},[544,1420,1421],{},[16,1422,1423],{},"2022/04/02更新: 第六行 $@ - \"$@\"，解决文件名中出现空格时导致的上传失败问题。",[16,1425,1426],{},"需要借助 jq 来读取返回的 json，各 Linux 发行版源内应该都有打包，自行安装即可。",[16,1428,1429],{},"授予x可执行权限后，Typora 内直接填写自定义命令输入脚本所在位置即可实现 Typora 自动上传图片了。",[544,1431,1432],{},[16,1433,1434],{},"2023/12/12更新: 支持 -m 或 --markdown 参数，使脚本输出 markdown 格式的链接。",[526,1436,1437],{},"html pre.shiki code .sW2Sy, html code.shiki .sW2Sy{--shiki-default:#A0A1A7;--shiki-default-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic}html pre.shiki code .sJa8x, html code.shiki .sJa8x{--shiki-default:#E45649;--shiki-dark:#E06C75}html pre.shiki code .sknuh, html code.shiki .sknuh{--shiki-default:#383A42;--shiki-dark:#56B6C2}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html pre.shiki code .sLKXg, html code.shiki .sLKXg{--shiki-default:#A626A4;--shiki-dark:#C678DD}html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html pre.shiki code .s2QsP, html code.shiki .s2QsP{--shiki-default:#E45649;--shiki-dark:#E5C07B}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html pre.shiki code .s8iYz, html code.shiki .s8iYz{--shiki-default:#383A42;--shiki-default-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic}html pre.shiki code .sDaw7, html code.shiki .sDaw7{--shiki-default:#0184BC;--shiki-dark:#E06C75}html pre.shiki code .s_Sar, html code.shiki .s_Sar{--shiki-default:#0184BC;--shiki-dark:#56B6C2}html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}",{"title":79,"searchDepth":93,"depth":93,"links":1439},[],{"title":1441,"date":1442,"path":1443,"tags":1444,"body":1447},"使用 Github Action 跑 rpmbuild","2022-03-06 16:02:54","/2022/03/06/run-rpmbuild-with-github-action",[540,1445,1446],"RPM Package","Github Action",{"type":13,"value":1448,"toc":1513},[1449,1452,1455,1470,1473,1490,1495,1504],[16,1450,1451],{},"一直打算用 Github Action 跑 rpmbuild 构建 rpm 包，然后传到 Action 的 Artifacts 里面，用户就可以在登陆 Github 帐号的情况下进行下载。只要不发 Release，应该就不算「再分发」的行为，也就自然规避了再分发闭源软件的法律风险。",[16,1453,1454],{},"然而，现有的那些 Action 几乎全都是针对 CentOS 老古董定制的，，有些甚至连 buildrequires 都不帮你安装，而且大部分情况下都不支持 Source 直接填写一个链接，需要你直接提供 Source 文件。我自己又不可能在 Github 的仓库里用 lfs 强行存一个 200MB+ 的二进制文件，显然是不符合我要求的。还有几个项目使用 mock 去构建的，但使用 mock 构建需要提前用 rpmbuild 生成 srpm，在我们的个人电脑上可以理解为用一个干净的 chroot 打包防止自己的环境受污染，但在一个全新的、用完一次就要扔掉的 docker 里面还要防止环境被污染似乎有些画蛇添足的嫌疑。",[16,1456,1457,1458,1463,1464,1469],{},"最终，我选择了 ",[60,1459,1462],{"href":1460,"rel":1461},"https://github.com/marketplace/actions/rpm-build",[64],"naveenrajm7/rpmbuild"," 这个项目。（虽然我并不理解为什么他要用 nodejs 去调用系统命令去执行 rpmbuild 等一系列步骤，我也没学过这类语言。不过项目的 ",[60,1465,1468],{"href":1466,"rel":1467},"https://github.com/naveenrajm7/rpmbuild/blob/master/src/main.ts",[64],"main.ts"," 我还是能仿写的。）",[16,1471,1472],{},"在经过三四个小时的摸爬滚打下，我还是成功地将这个项目按照我的想法改完了。",[20,1474,1475,1478,1481,1484,1487],{},[23,1476,1477],{},"采用 Fedora 35 作为 host 进行 rpmbuild",[23,1479,1480],{},"自动安装 buildrequires",[23,1482,1483],{},"自动下载 source",[23,1485,1486],{},"允许仓库内自带本地 source",[23,1488,1489],{},"移除针对 srpm 的构建",[16,1491,1492],{},[636,1493],{"alt":79,"src":1494},"https://static.031130.xyz/uploads/2024/08/12/bb263c91c7bf4.webp",[16,1496,1497,1498,1503],{},"改完后的 action 在 ",[60,1499,1502],{"href":1500,"rel":1501},"https://github.com/zhullyb/rpmbuild-github-action",[64],"zhullyb/rpmbuild-github-action","，欢迎使用。",[16,1505,1506,1507,1512],{},"最终是在 ",[60,1508,1511],{"href":1509,"rel":1510},"https://github.com/zhullyb/dingtalk-for-fedora",[64],"zhullyb/dingtalk-for-fedora"," 项目成功实装了，有兴趣的访客们可以去尝试着一起来白嫖 Github Action 呀！ >_\u003C",{"title":79,"searchDepth":93,"depth":93,"links":1514},[],{"title":1516,"date":1517,"path":1518,"tags":1519,"body":1520},"如何打出一个「-git」的rpm包","2022-02-07 10:23:29","/2022/02/07/how-to-package-a-git-rpm-package",[540,1445],{"type":13,"value":1521,"toc":1693},[1522,1529,1533,1540,1559,1563,1570,1574,1589,1593,1610,1614,1637,1643,1649,1669,1673,1679],[16,1523,1524,1525,1528],{},"本文中，笔者通过 github api 获取最新的 commit_id ，以一种曲线救国的方式成功为 rpm 打下了一个 ",[51,1526,1527],{},"-git"," 包。",[33,1530,1532],{"id":1531},"on-archlinux","On Archlinux",[16,1534,1535,1536,1539],{},"用过 AUR 的 Arch 用户应该知道，makepkg 支持 \"-git\" 包。当我们执行 makepkg 时，PKGBUILD 中的 ",[51,1537,1538],{},"pkgver"," 函数会自动被运行，并将输出的结果作为本次打包的版本号。这是一个非常棒的设计，我们不需要去手动更新 PKGBUILD，就可以直接从 git 服务区拉取最新的 master 分支编译打包，对于跟进开发进度而言非常方便。",[16,1541,1542,1543,1545,1546,655,1549,1552,1553,1555,1556,1558],{},"一般来说，一个 ",[51,1544,1527],{}," 包的版本号会分成 2~4 个部分，最为核心的是 ",[51,1547,1548],{},"count",[51,1550,1551],{},"commit_id","：",[51,1554,1548],{},"用于记录这是第几次提交，通过提交的次数作为版本号的靠前部分可以帮助包管理器比较版本号的新旧，比如第21次提交的代码一定比第18次的更加新，而21也正好比18大，包管理器也就凭借着这个数字来保证其可以在用户在更新的时候为用户选择一个更新版本的包；而 ",[51,1557,1551],{},"则可以帮助人类更快定位这个包是在哪一次代码提交以后编译的，以帮助 开发者/用户 定位问题。",[33,1560,1562],{"id":1561},"on-fedora","On Fedora",[16,1564,1565,1566,1569],{},"然而，这个思路在 rpm 上似乎无法实现。rpmbuild 执行的时候会事先根据版本号在 BUILDROOT 路径下创造一个 ",[51,1567,1568],{},"%{name}-%{version}-%{release}-%{arch}","的目录，如此一来，就必须先确定版本号，无法像 PKGBUILD 那样使用一个 pkgver 的函数去自动更新版本号。此外，rpm 似乎专注于软件包的 Reproducibility，也就是希望拿到了指导 rpmbuild 打包的 specfile 以后打出一个相同包的能力，因此，使用同一份 specfile 在不同时间打出一个不同包的这种行为似乎并不符合 Fedora/Redhat 的哲学，所以我们怕是等不到 rpm 支持这个功能的那一天了。",[33,1571,1573],{"id":1572},"turn-of-events","Turn of events",[16,1575,1576,1577,1582,1583,1588],{},"当然，这也并非不可能完成的任务，在 ",[60,1578,1581],{"href":1579,"rel":1580},"https://yanqiyu.info/",[64],"西木野羰基"," 的指引下，我在 Fedora Docs 找到了",[60,1584,1587],{"href":1585,"rel":1586},"https://docs.fedoraproject.org/en-US/packaging-guidelines/SourceURL/#_branch_example",[64],"对于某个 Branch 的打包样版","。其实也就是直接从 github 下载 master 分支的 master.tar.gz 压缩包来获取最新的源码，这样就确保了每一次 rpmbuild 的时候都能获取最新的源码。接下来需要处理的就是版本号的问题。",[33,1590,1592],{"id":1591},"sad-story","Sad Story",[16,1594,1595,1596,1599,1600,1603,1604,1606,1607,1609],{},"很可惜，master.tar.gz 压缩包中并不包括 ",[51,1597,1598],{},".git"," 文件，我们无法通过 ",[51,1601,1602],{},"git rev-list --count HEAD"," 来获取 ",[51,1605,1548],{}," 计数，此外，最新的 ",[51,1608,1551],{}," 我们也不得而知。即使我们知道这些参数，也无法在 rpmbuild 执行之前自动把这些参数填进 specfile 中。",[33,1611,1613],{"id":1612},"improvement","Improvement",[16,1615,1616,1617,1622,1623,1626,1627,1630,1631,1636],{},"好在天无绝人之路，在 Liu Sen 的 ",[60,1618,1621],{"href":1619,"rel":1620},"https://forum.suse.org.cn/t/topic/13626",[64],"RPM 中宏的简单介绍"," 一文中发现宏其实也可以类似 bash 中的 ",[51,1624,1625],{},"$()"," 一样定义成系统运行某些命令后的结果，通过仿写 copr 上 ",[522,1628,1629],{},"atim/fractal"," 的 ",[60,1632,1635],{"href":1633,"rel":1634},"https://download.copr.fedorainfracloud.org/results/atim/fractal/fedora-35-x86_64/03000082-fractal-master/fractal-master.spec",[64],"specfile"," 定义了下面两个宏。",[74,1638,1641],{"className":1639,"code":1640,"language":717},[715],"%global timenow %(echo $(date +%Y%m%d.%H%M))\n%global commit_short_id %(api_result=$(curl -s https://api.github.com/repos/\u003Cusername>/\u003Creponame>/branches/master | head -n 4 | tail -n 1); echo ${api_result:12:7})\n",[51,1642,1640],{"__ignoreMap":79},[16,1644,1645,1646],{},"版本号就可以直接写成 ",[51,1647,1648],{},"%{timenow}.%{commit_id_short}",[20,1650,1651,1660],{},[23,1652,1653,1656,1657,1659],{},[51,1654,1655],{},"%{timenow}"," 是直接通过运行系统的 date 命令获得一个精确到分钟的时间来当作 ",[51,1658,1548],{}," 给 dnf 判断版本号大小使用",[23,1661,1662,1665,1666,1668],{},[51,1663,1664],{},"%{commit_id_short}"," 从 api.github.com 获取到该仓库最新的 commit 号，配合粗制滥造的 shell 命令做切片，提取前7 位，帮助用户和开发者快速定位源码版本使用。当然，也可以选择直接使用 ",[51,1667,1379],{}," 作为 json 的解释器，不过 copr 大概率没有预装，生成 srpm 的时候估计就会报错。",[33,1670,1672],{"id":1671},"review","Review",[16,1674,1675,1676,1678],{},"至此，我们成功解决了在 rpm 上打 ",[51,1677,1527],{}," 包的问题，不过仍然有以下缺点",[20,1680,1681,1684,1687,1690],{},[23,1682,1683],{},"仅支持 github 上的项目，对于其他的 git 托管服务商还需要去查阅他们的 api 文档",[23,1685,1686],{},"粗制滥造的 shell 命令可能不足以应对以后的 github api 变更",[23,1688,1689],{},"使用了精确到分钟的时间作为计数器，导致版本号过长",[23,1691,1692],{},"使用 copr 打包的时候，有概率出现 srpm 与 rpm 之间版本号出现分钟级的差异",{"title":79,"searchDepth":93,"depth":93,"links":1694},[1695,1696,1697,1698,1699,1700],{"id":1531,"depth":93,"text":1532},{"id":1561,"depth":93,"text":1562},{"id":1572,"depth":93,"text":1573},{"id":1591,"depth":93,"text":1592},{"id":1612,"depth":93,"text":1613},{"id":1671,"depth":93,"text":1672},{"title":1702,"date":1703,"path":1704,"tags":1705,"body":1706},"雪藏在开源镜像站点中的那些常用却不为人知的软件","2022-01-19 13:01:30","/2022/01/19/the-common-software-hidden-in-mirrors",null,{"type":13,"value":1707,"toc":2041},[1708,1711,1717],[16,1709,1710],{},"前两天在下载 微PE 的时候眼睛突然一瞥，发现了山东大学的开源镜像站。突然间才发现在各个开源镜像站点中提供了许多那些我们误以为只能顶着断断续续的 Github  网络才能下载的软件。",[16,1712,1713,1714],{},"下面这张列表主要来自山东大学的镜像站中的「常用软件」和南京大学的「github-release」。",[1045,1715,1716],{},"我严重怀疑南京大学就是把整个 tuna 给搬了一遍过来。",[1718,1719,1720,1750],"table",{},[1721,1722,1723],"thead",{},[1724,1725,1726,1729,1736,1743],"tr",{},[1727,1728],"th",{},[1727,1730,1731],{},[60,1732,1735],{"href":1733,"rel":1734},"https://mirrors.sdu.edu.cn",[64],"山东大学",[1727,1737,1738],{},[60,1739,1742],{"href":1740,"rel":1741},"https://mirrors.nju.edu.cn",[64],"南京大学",[1727,1744,1745],{},[60,1746,1749],{"href":1747,"rel":1748},"https://mirrors.tuna.tsinghua.edu.cn",[64],"清华大学",[1751,1752,1753,1773,1788,1811,1826,1841,1860,1875,1898,1913,1928,1947,1969,1988,2007,2026],"tbody",{},[1724,1754,1755,1759,1761,1767],{},[1756,1757,1758],"td",{},"balena-io/etcher",[1756,1760],{},[1756,1762,1763],{},[60,1764,1765],{"href":1765,"rel":1766},"https://mirrors.nju.edu.cn/github-release/balena-io/etcher/LatestRelease/",[64],[1756,1768,1769],{},[60,1770,1771],{"href":1771,"rel":1772},"https://mirrors.tuna.tsinghua.edu.cn/github-release/balena-io/etcher/LatestRelease/",[64],[1724,1774,1775,1778,1784,1786],{},[1756,1776,1777],{},"drawio-desktop",[1756,1779,1780],{},[60,1781,1782],{"href":1782,"rel":1783},"https://mirrors.sdu.edu.cn/github-release/jgraph_drawio-desktop/",[64],[1756,1785],{},[1756,1787],{},[1724,1789,1790,1793,1799,1805],{},[1756,1791,1792],{},"git-for-windows",[1756,1794,1795],{},[60,1796,1797],{"href":1797,"rel":1798},"https://mirrors.sdu.edu.cn/github-release/git-for-windows_git/",[64],[1756,1800,1801],{},[60,1802,1803],{"href":1803,"rel":1804},"https://mirrors.nju.edu.cn/github-release/git-for-windows/git/LatestRelease/",[64],[1756,1806,1807],{},[60,1808,1809],{"href":1809,"rel":1810},"https://mirrors.tuna.tsinghua.edu.cn/github-release/git-for-windows/git/LatestRelease/",[64],[1724,1812,1813,1816,1818,1824],{},[1756,1814,1815],{},"Krita",[1756,1817],{},[1756,1819,1820],{},[60,1821,1822],{"href":1822,"rel":1823},"https://mirrors.nju.edu.cn/kde/stable/krita/",[64],[1756,1825],{},[1724,1827,1828,1831,1833,1835],{},[1756,1829,1830],{},"libreoffice",[1756,1832],{},[1756,1834],{},[1756,1836,1837],{},[60,1838,1839],{"href":1839,"rel":1840},"https://mirrors.tuna.tsinghua.edu.cn/libreoffice/libreoffice/",[64],[1724,1842,1843,1846,1848,1854],{},[1756,1844,1845],{},"Magisk",[1756,1847],{},[1756,1849,1850],{},[60,1851,1852],{"href":1852,"rel":1853},"https://mirrors.nju.edu.cn/github-release/topjohnwu/Magisk/LatestRelease/",[64],[1756,1855,1856],{},[60,1857,1858],{"href":1858,"rel":1859},"https://mirrors.tuna.tsinghua.edu.cn/github-release/topjohnwu/Magisk/LatestRelease/",[64],[1724,1861,1862,1865,1871,1873],{},[1756,1863,1864],{},"Motrix",[1756,1866,1867],{},[60,1868,1869],{"href":1869,"rel":1870},"https://mirrors.sdu.edu.cn/github-release/agalwood_Motrix/",[64],[1756,1872],{},[1756,1874],{},[1724,1876,1877,1880,1886,1892],{},[1756,1878,1879],{},"obs-studio",[1756,1881,1882],{},[60,1883,1884],{"href":1884,"rel":1885},"https://mirrors.sdu.edu.cn/github-release/obsproject_obs-studio/https://mirrors.sdu.edu.cn/software/Windows/OBS%20Studio/",[64],[1756,1887,1888],{},[60,1889,1890],{"href":1890,"rel":1891},"https://mirrors.nju.edu.cn/github-release/obsproject/obs-studio/LatestRelease/",[64],[1756,1893,1894],{},[60,1895,1896],{"href":1896,"rel":1897},"https://mirrors.tuna.tsinghua.edu.cn/github-release/obsproject/obs-studio/LatestRelease/",[64],[1724,1899,1900,1903,1909,1911],{},[1756,1901,1902],{},"office tool plus",[1756,1904,1905],{},[60,1906,1907],{"href":1907,"rel":1908},"https://mirrors.sdu.edu.cn/github-release/YerongAI_Office-Tool/",[64],[1756,1910],{},[1756,1912],{},[1724,1914,1915,1918,1924,1926],{},[1756,1916,1917],{},"picgo",[1756,1919,1920],{},[60,1921,1922],{"href":1922,"rel":1923},"https://mirrors.sdu.edu.cn/github-release/pbatard_rufus/",[64],[1756,1925],{},[1756,1927],{},[1724,1929,1930,1933,1939,1945],{},[1756,1931,1932],{},"rufus",[1756,1934,1935],{},[60,1936,1937],{"href":1937,"rel":1938},"https://mirrors.sdu.edu.cn/software/Windows/Rufus/",[64],[1756,1940,1941],{},[60,1942,1943],{"href":1943,"rel":1944},"https://mirrors.nju.edu.cn/github-release/pbatard/rufus/LatestRelease/",[64],[1756,1946],{},[1724,1948,1949,1955,1961,1967],{},[1756,1950,1951],{},[60,1952,1953],{"href":1953,"rel":1954},"https://mirrors.sdu.edu.cn/software/Windows/WePE/ventoy",[64],[1756,1956,1957],{},[60,1958,1959],{"href":1959,"rel":1960},"https://mirrors.sdu.edu.cn/github-release/ventoy_Ventoy/",[64],[1756,1962,1963],{},[60,1964,1965],{"href":1965,"rel":1966},"https://mirrors.nju.edu.cn/github-release/ventoy/Ventoy/LatestRelease/",[64],[1756,1968],{},[1724,1970,1971,1974,1976,1982],{},[1756,1972,1973],{},"virtualbox",[1756,1975],{},[1756,1977,1978],{},[60,1979,1980],{"href":1980,"rel":1981},"https://mirrors.nju.edu.cn/virtualbox/",[64],[1756,1983,1984],{},[60,1985,1986],{"href":1986,"rel":1987},"https://mirrors.tuna.tsinghua.edu.cn/virtualbox/",[64],[1724,1989,1990,1993,1995,2001],{},[1756,1991,1992],{},"vlc",[1756,1994],{},[1756,1996,1997],{},[60,1998,1999],{"href":1999,"rel":2000},"https://mirrors.nju.edu.cn/videolan-ftp/",[64],[1756,2002,2003],{},[60,2004,2005],{"href":2005,"rel":2006},"https://mirrors.tuna.tsinghua.edu.cn/videolan-ftp/",[64],[1724,2008,2009,2012,2014,2020],{},[1756,2010,2011],{},"winehq",[1756,2013],{},[1756,2015,2016],{},[60,2017,2018],{"href":2018,"rel":2019},"https://mirrors.nju.edu.cn/winehq/",[64],[1756,2021,2022],{},[60,2023,2024],{"href":2024,"rel":2025},"https://mirrors.bfsu.edu.cn/winehq/",[64],[1724,2027,2028,2031,2037,2039],{},[1756,2029,2030],{},"wepe",[1756,2032,2033],{},[60,2034,2035],{"href":2035,"rel":2036},"https://mirrors.sdu.edu.cn/software/Windows/WePE/",[64],[1756,2038],{},[1756,2040],{},{"title":79,"searchDepth":93,"depth":93,"links":2042},[],{"title":2044,"date":2045,"path":2046,"tags":2047,"body":2048},"在Fedora搭建jekyll环境——dnf module","2022-01-12 22:11:42","/2022/01/12/dnf-module-in-setting-up-the-jekyll",[540],{"type":13,"value":2049,"toc":2267},[2050,2053,2070,2073,2077,2089,2092,2095,2098,2117,2120,2139,2142,2161,2165,2218,2228,2234,2237,2243,2250,2264],[33,2051,2052],{"id":2052},"起因",[16,2054,2055,2056,2061,2062,2065,2066,2069],{},"我之前的博客一直用的是",[60,2057,2060],{"href":2058,"rel":2059},"https://github.com/qiubaiying/qiubaiying.github.io",[64],"这个主题","，直接使用 Fedora 官方源里的 ",[51,2063,2064],{},"rubygem-jekyll"," 似乎无法正常安装 Gemfile 中的依赖。之前使用 Archlinux 的时候，我是直接从 AUR 安装了一个 ",[51,2067,2068],{},"ruby-2.6"," 来使用的，但最近转到 Fedora 以后似乎就没法用这样的方案来解决了。",[16,2071,2072],{},"好在天无绝人之路，Fedora 也提供了安装老版本的 ruby 的方案——使用 dnf 的 module 功能。",[33,2074,2076],{"id":2075},"关于-dnf-module","关于 dnf module",[16,2078,2079,2080,2085,2086,493],{},"关于 dnf 的 module 功能到底是用来做什么的，其实我并不清楚。虽说 Fedora 提供了",[60,2081,2084],{"href":2082,"rel":2083},"https://docs.fedoraproject.org/en-US/modularity/",[64],"文档","，但就凭我的读中文文档都吃力的水准，似乎没有办法通过英文文档来理解这个全新的概念，",[1045,2087,2088],{},"所以我选择直接莽过去",[16,2090,2091],{},"就我目前的理解而言，dnf 的 module 似乎并不致力于帮助用户完成系统内某一程序的新老版本共存的难题，而仅仅是给用户提供了停留在老版本软件的权利。module 所负责的，是保证老版本的程序能在你的系统上正常运行起来，而不会因为其他组件的更新而导致老版本的程序无法正常使用。",[593,2093,2094],{"id":2094},"基本的使用方法",[16,2096,2097],{},"通过下列命令可以查看目前所支持的 module",[74,2099,2101],{"className":619,"code":2100,"language":621,"meta":79,"style":79},"sudo dnf module list\n",[51,2102,2103],{"__ignoreMap":79},[83,2104,2105,2108,2111,2114],{"class":85,"line":86},[83,2106,2107],{"class":628},"sudo",[83,2109,2110],{"class":631}," dnf",[83,2112,2113],{"class":631}," module",[83,2115,2116],{"class":631}," list\n",[16,2118,2119],{},"通过下列命令可以选择 module 所要停留的版本( 以 ruby 2.7 为例 )",[74,2121,2123],{"className":619,"code":2122,"language":621,"meta":79,"style":79},"sudo dnf module enable ruby:2.7\n",[51,2124,2125],{"__ignoreMap":79},[83,2126,2127,2129,2131,2133,2136],{"class":85,"line":86},[83,2128,2107],{"class":628},[83,2130,2110],{"class":631},[83,2132,2113],{"class":631},[83,2134,2135],{"class":631}," enable",[83,2137,2138],{"class":631}," ruby:2.7\n",[16,2140,2141],{},"通过下列命令可以取消锁定 module 程序所要停留的版本( 以 ruby 为例 )",[74,2143,2145],{"className":619,"code":2144,"language":621,"meta":79,"style":79},"sudo dnf module reset ruby\n",[51,2146,2147],{"__ignoreMap":79},[83,2148,2149,2151,2153,2155,2158],{"class":85,"line":86},[83,2150,2107],{"class":628},[83,2152,2110],{"class":631},[83,2154,2113],{"class":631},[83,2156,2157],{"class":631}," reset",[83,2159,2160],{"class":631}," ruby\n",[33,2162,2164],{"id":2163},"开始配置该-jekyll-主题的运行环境","开始配置该 jekyll 主题的运行环境",[74,2166,2168],{"className":619,"code":2167,"language":621,"meta":79,"style":79},"sudo dnf module install ruby:2.7\nsudo dnf install ruby-devel\n\ncd /path/to/the/jekyll-blog/\nbundle install --path vendor/bundle\n",[51,2169,2170,2183,2194,2198,2205],{"__ignoreMap":79},[83,2171,2172,2174,2176,2178,2181],{"class":85,"line":86},[83,2173,2107],{"class":628},[83,2175,2110],{"class":631},[83,2177,2113],{"class":631},[83,2179,2180],{"class":631}," install",[83,2182,2138],{"class":631},[83,2184,2185,2187,2189,2191],{"class":85,"line":93},[83,2186,2107],{"class":628},[83,2188,2110],{"class":631},[83,2190,2180],{"class":631},[83,2192,2193],{"class":631}," ruby-devel\n",[83,2195,2196],{"class":85,"line":103},[83,2197,113],{"emptyLinePlaceholder":112},[83,2199,2200,2202],{"class":85,"line":109},[83,2201,658],{"class":1206},[83,2203,2204],{"class":631}," /path/to/the/jekyll-blog/\n",[83,2206,2207,2210,2212,2215],{"class":85,"line":116},[83,2208,2209],{"class":628},"bundle",[83,2211,2180],{"class":631},[83,2213,2214],{"class":671}," --path",[83,2216,2217],{"class":631}," vendor/bundle\n",[16,2219,2220,2221,2224,2225],{},"完成后，我们即可在 jekyll-blog 目录下 使用 ",[51,2222,2223],{},"bundle exec jekyll"," 来正常运行 jekyll 了。试着跑一下 ",[51,2226,2227],{},"bundle exec jekyll server",[16,2229,2230],{},[636,2231],{"alt":2232,"src":2233},"成功，彻彻底底！","https://static.031130.xyz/uploads/2024/08/12/62f3caeec8ef6.webp",[33,2235,2236],{"id":2236},"参考材料",[16,2238,2239],{},[60,2240,2242],{"href":2082,"rel":2241},[64],"Fedora Docs",[16,2244,2245],{},[60,2246,2249],{"href":2247,"rel":2248},"https://github.com/openSUSE-zh/page-opensuse-zh/blob/main/CONTRIBUTING.md",[64],"openSUSE 中文社区主页贡献指南",[16,2251,2252,2257,2258,2263],{},[60,2253,2256],{"href":2254,"rel":2255},"https://blog.kagesenshi.org/2021/05/ruby24-fedora34.html",[64],"Switching to use Ruby 2.7 (or older) in Fedora 34 using DNF Modules"," 「",[60,2259,2262],{"href":2260,"rel":2261},"https://web.archive.org/web/20220112143005/https://blog.kagesenshi.org/2021/05/ruby24-fedora34.html",[64],"WebArchive","」",[526,2265,2266],{},"html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html pre.shiki code .s_Sar, html code.shiki .s_Sar{--shiki-default:#0184BC;--shiki-dark:#56B6C2}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}",{"title":79,"searchDepth":93,"depth":93,"links":2268},[2269,2270,2273,2274],{"id":2052,"depth":93,"text":2052},{"id":2075,"depth":93,"text":2076,"children":2271},[2272],{"id":2094,"depth":103,"text":2094},{"id":2163,"depth":93,"text":2164},{"id":2236,"depth":93,"text":2236},{"title":2276,"date":2277,"path":2278,"tags":2279,"body":2281},"pacman更新时遇到「GPGME 错误：无数据」","2022-01-01 23:42:09","/2022/01/01/pacman-gpgme-error-no-data",[2280],"Archlinux",{"type":13,"value":2282,"toc":2376},[2283,2286,2289,2295,2298,2304,2307,2313,2316,2319,2330,2341,2348,2351,2357,2370],[33,2284,2285],{"id":2285},"情景再现",[16,2287,2288],{},"当初是使用 pacman 更新时遇上了「GPGME 错误：无数据」的问题，我尝试复现了下，大概是下面这样的情况。",[74,2290,2293],{"className":2291,"code":2292,"language":717},[715],"[zhullyb@Archlinux ~]$ sudo pacman -Syu\n错误：GPGME 错误：无数据\n错误：GPGME 错误：无数据\n错误：GPGME 错误：无数据\n:: 正在同步软件包数据库...\n core                                137.6 KiB   598 KiB/s 00:00 [------------------------------------] 100%\n extra                              1566.0 KiB  6.12 MiB/s 00:00 [------------------------------------] 100%\n community                             6.0 MiB  20.6 MiB/s 00:00 [------------------------------------] 100%\n错误：GPGME 错误：无数据\n错误：GPGME 错误：无数据\n错误：GPGME 错误：无数据\n错误：未能同步所有数据库（无效或已损坏的数据库 (PGP 签名)）\n",[51,2294,2292],{"__ignoreMap":79},[16,2296,2297],{},"英文版的提示应该是长成下面这个样子",[74,2299,2302],{"className":2300,"code":2301,"language":717},[715],"[zhullyb@Archlinux ~]$ sudo pacman -Syu\nerror: GPGME error: No data\nerror: GPGME error: No data\nerror: GPGME error: No data\n:: Synchronizing package databases...\n core                                137.6 KiB   574 KiB/s 00:00 [------------------------------------] 100%\n extra                              1566.0 KiB  5.66 MiB/s 00:00 [------------------------------------] 100%\n community                             6.0 MiB  18.1 MiB/s 00:00 [------------------------------------] 100%\nerror: GPGME error: No data\nerror: GPGME error: No data\nerror: GPGME error: No data\nerror: failed to synchronize all databases (invalid or corrupted database (PGP signature))\n",[51,2303,2301],{"__ignoreMap":79},[33,2305,2306],{"id":2306},"解决方案",[74,2308,2311],{"className":2309,"code":2310,"language":717},[715],"sudo rm /var/lib/pacman/sync/*.sig\n",[51,2312,2310],{"__ignoreMap":79},[16,2314,2315],{},"很简单，就这一条命令就够了。",[33,2317,2318],{"id":2318},"问题原因",[16,2320,2321,2322,2325,2326,2329],{},"pacman在更新数据库文件时也会尝试下载",[51,2323,2324],{},"$repo.db.sig","，这里的",[51,2327,2328],{},"$repo","可以是 core、extra、community、archlinuxcn 等仓库名。",[16,2331,2332,2333,2337,2338,493],{},"但是无论是官方源还是 archlinuxcn 源，",[2334,2335,2336],"strong",{},"大多数源的数据库文件","都不会被签名，也就",[2334,2339,2340],{},"不会存在 .db.sig 文件",[16,2342,2343,2344,2347],{},"pacman 尝试下载时这些数据库文件的签名文件时，镜像站就会返回 ",[2334,2345,2346],{},"404 的 http 状态码","告诉pacman: “你个傻叉，神他妈没有这个文件！”",[16,2349,2350],{},"pacman 挨了一顿骂，也就善罢甘休，没有再动这个念头，所以我们每次更新也都相安无事。",[16,2352,2353,2354,493],{},"而出现这种错误的情况大多是发生在 校园网、酒店免费 WIFI 这种",[2334,2355,2356],{},"需要登陆以后才能上网的网络环境",[16,2358,2359,2360,2363,2364,2366,2367,2369],{},"因为 pacman 尝试下载 ",[51,2361,2362],{},".db.sig"," 文件时被登陆网页劫持了（这点你们应该深有感受，如果你在这种网络环境下没有登陆，你无论访问什么网页都会被重定向到登录界面，http 的状态码此时是200，不是404）。从没见过 ",[51,2365,2362],{},"的 pacman 此时两眼放光，由于没有挨骂，他就迅速地把登录界面当成是",[51,2368,2362],{},"下载下来了。",[16,2371,2372,2373,2375],{},"下载下来以后，pacman 激动地摆弄起 ",[51,2374,2362],{},"，甚至发现里面没有自己期待已久的 GPG签名数据并开始报错时仍然不愿意撒手，因此此时无论再怎么同步源码、再怎么 Syyu 也不会有效果，必须人工干预。",{"title":79,"searchDepth":93,"depth":93,"links":2377},[2378,2379,2380],{"id":2285,"depth":93,"text":2285},{"id":2306,"depth":93,"text":2306},{"id":2318,"depth":93,"text":2318},{"title":2382,"date":2383,"path":2384,"tags":2385,"body":2386},"Cutefish的前世今生","2021-12-12 00:10:34","/2021/12/12/the-history-of-cutefish",[923],{"type":13,"value":2387,"toc":2685},[2388,2393,2396,2399,2402,2405,2409,2413,2416,2422,2433,2437,2440,2469,2472,2481,2485,2493,2502,2506,2524,2527,2536,2540,2545,2548,2597,2600,2614,2616],[544,2389,2390],{},[16,2391,2392],{},"CutefishOS是由我们国内的开发者主导（目前也主要是他们在开发）的桌面环境。不过似乎对于他的前世今生，似乎很多人都有误解。尤其是很多人认为他是一个Archlinux-based发行版；部分用户分不清他到底是基于Debian还是基于Ubuntu；还有人把它和 JingOS 弄混了。",[16,2394,2395],{},"先把这些问题的回答写在最前面:",[16,2397,2398],{},"CutefishOS 是一个基于Debian的发行版，他的前身 CyberOS 是一个基于 Archlinux 的发行版。但要注意: Cutefish （不加OS）可以单独指代 CutefishOS 所使用的桌面环境，为了避免混淆，本文中我将使用CutefishDE来指代他的桌面环境。",[16,2400,2401],{},"CutefishOS 和 JingOS 目前只是官网互加友链的关系，并不是相同的东西。Cutefish的开发方向是基于qt重写一套UI，而JingOS则更像是在开发一套KDE的主题。",[2403,2404],"hr",{},[33,2406,2408],{"id":2407},"cutefish的历史","Cutefish的历史",[593,2410,2412],{"id":2411},"cyberos的故事","CyberOS的故事",[16,2414,2415],{},"第一次体验到这个UI其实是在21年的3月，在Archlinux的QQ群里，群主向我们推荐了 CyberOS ，这是一个基于 Archlinux 的发行版。",[16,2417,2418],{},[636,2419],{"alt":2420,"src":2421},"QQ群公告","https://static.031130.xyz/uploads/2024/08/12/62f3cae911901.webp",[16,2423,2424,2425],{},"由于基于 Archlinux，我直接就添加了CyberOS的源作为第三方源安装上了CyberDE，",[1045,2426,2427,2428,493],{},"那会儿还顺手水了篇博客，由于后来事情发展太快，这篇博客早就不适用了，就干脆删了，现在在我的Github还能找到那会儿的",[60,2429,2432],{"href":2430,"rel":2431},"https://github.com/zhullyb/blog/blob/20210430/_posts/2021-03-21-install-cyber-desktop-on-your-archlinux.md",[64],"存档",[593,2434,2436],{"id":2435},"更名cutefishos","更名CutefishOS",[16,2438,2439],{},"后来根据 CutefishOS 的QQ群的群主所说，是因为当时没注重海外平台的宣发，导致 CyberOS 的用户名在 Twitter 被抢注，因此决定改名 CutefishOS 。由于时间较为久远，QQ群的聊天记录已经几乎找不到了，我无法放出。",[16,2441,2442,2443,2453,2461],{},"关于CutefishOS的创始时间我已经记不清了，但是可以推测是在21年的4~5月份左右。",[2444,2445,2446],"sup",{},[60,2447,2452],{"href":2448,"ariaDescribedBy":2449,"dataFootnoteRef":79,"id":2451},"#user-content-fn-1",[2450],"footnote-label","user-content-fnref-1","1",[2444,2454,2455],{},[60,2456,2460],{"href":2457,"ariaDescribedBy":2458,"dataFootnoteRef":79,"id":2459},"#user-content-fn-2",[2450],"user-content-fnref-2","2",[2444,2462,2463],{},[60,2464,2468],{"href":2465,"ariaDescribedBy":2466,"dataFootnoteRef":79,"id":2467},"#user-content-fn-3",[2450],"user-content-fnref-3","3",[593,2470,2471],{"id":2471},"官网上线",[16,2473,2474,2475,2480],{},"21年5月12日，",[60,2476,2479],{"href":2477,"rel":2478},"https://cutefishos.com",[64],"cutefishos.com"," 上线，暂时不提供安装镜像。",[593,2482,2484],{"id":2483},"进军arch系","进军Arch系",[16,2486,2487,2488,493],{},"5月26日，CutefishDE进入 ",[60,2489,2492],{"href":2490,"rel":2491},"https://archlinux.org/groups/x86_64/cutefish/",[64],"Archlinux官方源",[16,2494,2495,2496,2501],{},"同日，Github 组织 manjaro-cutefish 放出了使用 CutefishDE 的 ",[60,2497,2500],{"href":2498,"rel":2499},"https://github.com/manjaro-cutefish/download/releases",[64],"manjaro安装镜像","。这个组织和官方的 github.com/cutefishos 没有共同维护者，因此可以基本断定是第三方打包的。",[593,2503,2505],{"id":2504},"ubuntu第三方打包版的跟进","Ubuntu第三方打包版的跟进",[16,2507,2508,2509,2517,2518,2523],{},"大约在7月中旬左右",[2444,2510,2511],{},[60,2512,2516],{"href":2513,"ariaDescribedBy":2514,"dataFootnoteRef":79,"id":2515},"#user-content-fn-4",[2450],"user-content-fnref-4","4","，Github出现了一位名为 cutefish-ubuntu 的用户，开始在 Ubutnu 上编译 CutefishDE ，并通过 ",[60,2519,2522],{"href":2520,"rel":2521},"https://cutefish-ubuntu.github.io/",[64],"GithubPages"," 发布安装镜像，依然是第三方打包的安装镜像。",[593,2525,2526],{"id":2526},"官方版本释出",[16,2528,2529,2530,2535],{},"21年国庆长假期间，cutefishos.com 释出由 Cutefish官方发布的",[60,2531,2534],{"href":2532,"rel":2533},"https://cutefishos.com/download",[64],"基于Debian的CutefishOS镜像","，搭载的DE是 0.5 版本的，英文版网页提供 Google Drive 和 Mega 的下载链接，中文版本网页非常贴心地添加了使用飞书下载的方式方便国内用户下载。",[593,2537,2539],{"id":2538},"rpm系的跟进","RPM系的跟进",[2541,2542,2544],"h4",{"id":2543},"copr","COPR",[16,2546,2547],{},"copr上分别有三名用户打包了CutefishDE/CyberDE，我以表格形式简单罗列一下",[1718,2549,2550,2563],{},[1721,2551,2552],{},[1724,2553,2554,2557,2560],{},[1727,2555,2556],{},"用户名",[1727,2558,2559],{},"打包的DE",[1727,2561,2562],{},"第一次打包日期",[1751,2564,2565,2576,2587],{},[1724,2566,2567,2570,2573],{},[1756,2568,2569],{},"rmnscnce",[1756,2571,2572],{},"cutefish",[1756,2574,2575],{},"2021.8.19",[1724,2577,2578,2581,2584],{},[1756,2579,2580],{},"cappyishihara",[1756,2582,2583],{},"cyber",[1756,2585,2586],{},"2021.11.17",[1724,2588,2589,2592,2594],{},[1756,2590,2591],{},"jesonlay",[1756,2593,2572],{},[1756,2595,2596],{},"2021.12.06",[2541,2598,2599],{"id":2599},"论坛用户",[16,2601,2602,2603,2608,2609,493],{},"21年12月2日，一为名为",[60,2604,2607],{"href":2605,"rel":2606},"https://bbs.cutefishos.com/u/gesangtome",[64],"gesangtome","的网友在CutefishOS的论坛上",[60,2610,2613],{"href":2611,"rel":2612},"https://bbs.cutefishos.com/d/331-fedoracutefish",[64],"发布了自己编译的CutefishDE",[2403,2615],{},[2617,2618,2621,2626],"section",{"className":2619,"dataFootnotes":79},[2620],"footnotes",[33,2622,2625],{"className":2623,"id":2450},[2624],"sr-only","Footnotes",[557,2627,2628,2642,2656,2670],{},[23,2629,2631,2632,2634,2635],{"id":2630},"user-content-fn-1","通过whois查询得知",[51,2633,2479],{}," 这个域名注册时间为21年3月31日 ",[60,2636,2641],{"href":2637,"ariaLabel":2638,"className":2639,"dataFootnoteBackref":79},"#user-content-fnref-1","Back to reference 1",[2640],"data-footnote-backref","↩",[23,2643,2645,2650,2651],{"id":2644},"user-content-fn-2",[60,2646,2649],{"href":2647,"rel":2648},"https://github.com/archlinux/svntogit-community/commit/b92bb9ae8fd35178cdfebb6f56b55f20722aa7dd",[64],"Cutefish进入Archlinux官方源","是在5月26日 ",[60,2652,2641],{"href":2653,"ariaLabel":2654,"className":2655,"dataFootnoteBackref":79},"#user-content-fnref-2","Back to reference 2",[2640],[23,2657,2659,2664,2665],{"id":2658},"user-content-fn-3",[60,2660,2663],{"href":2661,"rel":2662},"https://github.com/cyberos",[64],"CyberOS的Github仓库","最后一次内容变更是在21年的5月23日 ",[60,2666,2641],{"href":2667,"ariaLabel":2668,"className":2669,"dataFootnoteBackref":79},"#user-content-fnref-3","Back to reference 3",[2640],[23,2671,2673,2674,2679,2680],{"id":2672},"user-content-fn-4","这里参考的是 cutefish-ubuntu/cutefish-ubuntu.github.io 仓库的",[60,2675,2678],{"href":2676,"rel":2677},"https://github.com/cutefish-ubuntu/cutefish-ubuntu.github.io/commit/237a480992a74d8c75c1f4ec51511550ce97c64b",[64],"第一个commit","的时间 ",[60,2681,2641],{"href":2682,"ariaLabel":2683,"className":2684,"dataFootnoteBackref":79},"#user-content-fnref-4","Back to reference 4",[2640],{"title":79,"searchDepth":93,"depth":93,"links":2686},[2687,2696],{"id":2407,"depth":93,"text":2408,"children":2688},[2689,2690,2691,2692,2693,2694,2695],{"id":2411,"depth":103,"text":2412},{"id":2435,"depth":103,"text":2436},{"id":2471,"depth":103,"text":2471},{"id":2483,"depth":103,"text":2484},{"id":2504,"depth":103,"text":2505},{"id":2526,"depth":103,"text":2526},{"id":2538,"depth":103,"text":2539},{"id":2450,"depth":93,"text":2625},131,1766337209685]
[{"data":1,"prerenderedAt":5630},["ShallowReactive",2],{"randomIndex/page/7/":3,"language-switch-/page/7/-en":4,"index-page-7-zh":5,"posts-total-zh":5629},0,"/en/",[6,386,818,2253,3474,4422,4760,4856,4943,5186],{"title":7,"date":8,"path":9,"tags":10,"body":15},"jinja2 中如何优雅地实现换行","2023-09-03 13:37:35","/2023/09/03/jinja2-nl-to-br",[11,12,13,14],"Linux","Python","jinja2","CSS",{"type":16,"value":17,"toc":384},"minimark",[18,30,42,350,353,362,373,380],[19,20,21,22,26,27,29],"p",{},"在使用 python 的 jinja2 模板引擎生成 html 的时候，会遇到 ",[23,24,25],"code",{},"\\n"," 换行符无法被正常换行的问题。我本能的想法就是将 ",[23,28,25],{}," 替换成 html 标签 \u003Cbr />，但失败了，jinja2 有自动转义的功能，直接将标签原模原样地渲染了出来，并没有生效。而为这一段代码块关闭自动转义则会有被 js 注入的风险，因此这也不是上策。",[19,31,32,33,35,36],{},"在 jinja2 的官方文档中，提出了使用 filter 的方案。也就是说，filter 将 ",[23,34,25],{}," 识别出来，并自动替换成 \u003Cbr /> 标签，并且使用 Markup 函数将这一段 html 文本标记成安全且无需转义的。见: ",[37,38,39],"a",{"href":39,"rel":40},"https://jinja.palletsprojects.com/en/3.1.x/api/#custom-filters",[41],"nofollow",[43,44,45],"blockquote",{},[46,47,52],"pre",{"className":48,"code":49,"language":50,"meta":51,"style":51},"language-python shiki shiki-themes one-light one-dark-pro","import re\nfrom jinja2 import pass_eval_context\nfrom markupsafe import Markup, escape\n\n@pass_eval_context\ndef nl2br(eval_ctx, value):\n    br = \"\u003Cbr>\\n\"\n\n    if eval_ctx.autoescape:\n        value = escape(value)\n        br = Markup(br)\n\n    result = \"\\n\\n\".join(\n        f\"\u003Cp>{br.join(p.splitlines())}\u003C\\p>\"\n        for p in re.split(r\"(?:\\r\\n|\\r(?!\\n)|\\n){2,}\", value)\n    )\n    return Markup(result) if autoescape else result\n","python","",[23,53,54,67,81,94,101,108,133,153,158,167,182,196,201,227,260,321,327],{"__ignoreMap":51},[55,56,59,63],"span",{"class":57,"line":58},"line",1,[55,60,62],{"class":61},"sLKXg","import",[55,64,66],{"class":65},"s5ixo"," re\n",[55,68,70,73,76,78],{"class":57,"line":69},2,[55,71,72],{"class":61},"from",[55,74,75],{"class":65}," jinja2 ",[55,77,62],{"class":61},[55,79,80],{"class":65}," pass_eval_context\n",[55,82,84,86,89,91],{"class":57,"line":83},3,[55,85,72],{"class":61},[55,87,88],{"class":65}," markupsafe ",[55,90,62],{"class":61},[55,92,93],{"class":65}," Markup, escape\n",[55,95,97],{"class":57,"line":96},4,[55,98,100],{"emptyLinePlaceholder":99},true,"\n",[55,102,104],{"class":57,"line":103},5,[55,105,107],{"class":106},"sAdtL","@pass_eval_context\n",[55,109,111,114,117,120,124,127,130],{"class":57,"line":110},6,[55,112,113],{"class":61},"def",[55,115,116],{"class":106}," nl2br",[55,118,119],{"class":65},"(",[55,121,123],{"class":122},"so_Uh","eval_ctx",[55,125,126],{"class":65},",",[55,128,129],{"class":122}," value",[55,131,132],{"class":65},"):\n",[55,134,136,139,143,147,150],{"class":57,"line":135},7,[55,137,138],{"class":65},"    br ",[55,140,142],{"class":141},"sknuh","=",[55,144,146],{"class":145},"sDhpE"," \"\u003Cbr>",[55,148,25],{"class":149},"s_Sar",[55,151,152],{"class":145},"\"\n",[55,154,156],{"class":57,"line":155},8,[55,157,100],{"emptyLinePlaceholder":99},[55,159,161,164],{"class":57,"line":160},9,[55,162,163],{"class":61},"    if",[55,165,166],{"class":65}," eval_ctx.autoescape:\n",[55,168,170,173,175,179],{"class":57,"line":169},10,[55,171,172],{"class":65},"        value ",[55,174,142],{"class":141},[55,176,178],{"class":177},"slOjB"," escape",[55,180,181],{"class":65},"(value)\n",[55,183,185,188,190,193],{"class":57,"line":184},11,[55,186,187],{"class":65},"        br ",[55,189,142],{"class":141},[55,191,192],{"class":177}," Markup",[55,194,195],{"class":65},"(br)\n",[55,197,199],{"class":57,"line":198},12,[55,200,100],{"emptyLinePlaceholder":99},[55,202,204,207,209,212,215,218,221,224],{"class":57,"line":203},13,[55,205,206],{"class":65},"    result ",[55,208,142],{"class":141},[55,210,211],{"class":145}," \"",[55,213,214],{"class":149},"\\n\\n",[55,216,217],{"class":145},"\"",[55,219,220],{"class":65},".",[55,222,223],{"class":177},"join",[55,225,226],{"class":65},"(\n",[55,228,230,233,236,240,243,245,248,251,254,257],{"class":57,"line":229},14,[55,231,232],{"class":61},"        f",[55,234,235],{"class":145},"\"\u003Cp>",[55,237,239],{"class":238},"sAGMh","{",[55,241,242],{"class":65},"br.",[55,244,223],{"class":177},[55,246,247],{"class":65},"(p.",[55,249,250],{"class":177},"splitlines",[55,252,253],{"class":65},"())",[55,255,256],{"class":238},"}",[55,258,259],{"class":145},"\u003C\\p>\"\n",[55,261,263,266,269,272,275,278,280,283,286,290,293,296,299,302,304,307,309,312,316,318],{"class":57,"line":262},15,[55,264,265],{"class":61},"        for",[55,267,268],{"class":65}," p ",[55,270,271],{"class":61},"in",[55,273,274],{"class":65}," re.",[55,276,277],{"class":177},"split",[55,279,119],{"class":65},[55,281,282],{"class":61},"r",[55,284,217],{"class":285},"sDaw7",[55,287,289],{"class":288},"sYoRg","(?:",[55,291,292],{"class":149},"\\r\\n",[55,294,295],{"class":65},"|",[55,297,298],{"class":149},"\\r",[55,300,301],{"class":65},"(?!",[55,303,25],{"class":149},[55,305,306],{"class":65},")|",[55,308,25],{"class":149},[55,310,311],{"class":288},")",[55,313,315],{"class":314},"sYebD","{2,}",[55,317,217],{"class":285},[55,319,320],{"class":65},", value)\n",[55,322,324],{"class":57,"line":323},16,[55,325,326],{"class":65},"    )\n",[55,328,330,333,335,338,341,344,347],{"class":57,"line":329},17,[55,331,332],{"class":61},"    return",[55,334,192],{"class":177},[55,336,337],{"class":65},"(result) ",[55,339,340],{"class":61},"if",[55,342,343],{"class":65}," autoescape ",[55,345,346],{"class":61},"else",[55,348,349],{"class":65}," result\n",[19,351,352],{},"使用这段代码后，我遇到了连续两个换行符被识别成一个换行符的问题，依然不满意。",[19,354,355,356,361],{},"在 ",[37,357,360],{"href":358,"rel":359},"https://github.com/pallets/flask/issues/2628",[41],"issue#2628"," 中，我找到了一个相对优雅的解决方案——使用 css 样式来完成这个任务。",[19,363,364,365,368,369,372],{},"通过设置 ",[23,366,367],{},"white-space: pre-line;"," 的 css 样式，html 在被渲染时将会不再忽略换行符，浏览器就能够在没有 br 标签标注的情况下实现自动换行。而如果设置为 ",[23,370,371],{},"white-space: pre-wrap;"," 则多个空格将不会再被合并成一个空格，直接治好了我在入门 html 时的各种不适。",[19,374,375,376,379],{},"此外，通过 ",[23,377,378],{},"word-break: break-word;"," 的 css 样式可以实现只有当一个单词一整行都显示不下时，才会拆分换行该单词的效果，可以避免 break-all 拆分所有单词或者 normal 时遇到长单词直接元素溢出的问题。",[381,382,383],"style",{},"html pre.shiki code .sLKXg, html code.shiki .sLKXg{--shiki-default:#A626A4;--shiki-dark:#C678DD}html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .so_Uh, html code.shiki .so_Uh{--shiki-default:#986801;--shiki-default-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic}html pre.shiki code .sknuh, html code.shiki .sknuh{--shiki-default:#383A42;--shiki-dark:#56B6C2}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html pre.shiki code .s_Sar, html code.shiki .s_Sar{--shiki-default:#0184BC;--shiki-dark:#56B6C2}html pre.shiki code .slOjB, html code.shiki .slOjB{--shiki-default:#383A42;--shiki-dark:#61AFEF}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html pre.shiki code .sDaw7, html code.shiki .sDaw7{--shiki-default:#0184BC;--shiki-dark:#E06C75}html pre.shiki code .sYoRg, html code.shiki .sYoRg{--shiki-default:#0184BC;--shiki-dark:#D19A66}html pre.shiki code .sYebD, html code.shiki .sYebD{--shiki-default:#383A42;--shiki-dark:#D19A66}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}",{"title":51,"searchDepth":69,"depth":69,"links":385},[],{"title":387,"date":388,"path":389,"tags":390,"body":393},"手动指定 python-selenium 的 driver path 以解决在中国大陆网络环境下启动卡住的问题","2023-09-02 01:59:18","/2023/09/02/python-selenium-start-difficult-in-china-mainland",[12,391,11,392],"selenium","Firefox",{"type":16,"value":394,"toc":816},[395,404,407,531,539,544,547,560,568,689,692,810,813],[19,396,397,398,403],{},"之前因为学校社团迎新的需求，就临时写了一个 QQ Bot，最近又给 bot 加上了 ",[37,399,402],{"href":400,"rel":401},"https://github.com/zhullyb/qq-quote-generator",[41],"/q 的功能","，原理是通过 python 的 selenium 去启动一个 headless Firefox 去截由 jinja2 模板引擎生成的 html 的图。",[19,405,406],{},"每次这个 bot 重启的时候都因为 selenium 而需要花费好几秒的时间，甚至经常概率性启动失败。我就寻思者应该把这个图片生成的 generator 从 bot 中抽出来，这样就不至于每次重启 bot 都要遭此一劫。但就在我将 generator 打包成 docker 部署上云服务器的时候，发现居然无法启动。于是手动进 docker 的 shell 开 python 的交互式终端，发现在创建 firefox 的 webdriver 对象的时候异常缓慢，等了半分钟以后蹲到一个报错如下:",[46,408,412],{"className":409,"code":410,"language":411,"meta":51,"style":51},"language-pyth shiki shiki-themes one-light one-dark-pro","Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/selenium/webdriver/common/driver_finder.py\", line 38, in get_path\n    path = SeleniumManager().driver_location(options) if path is None else path\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/selenium/webdriver/common/selenium_manager.py\", line 95, in driver_location\n    output = self.run(args)\n             ^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/selenium/webdriver/common/selenium_manager.py\", line 141, in run\n    raise WebDriverException(f\"Unsuccessful command executed: {command}.\\n{result}{stderr}\")\nselenium.common.exceptions.WebDriverException: Message: Unsuccessful command executed: /usr/local/lib/python3.11/site-packages/selenium/webdriver/common/linux/selenium-manager --browser firefox --output json.\n{'code': 65, 'message': 'error sending request for url (https://github.com/mozilla/geckodriver/releases/latest): connection error: unexpected end of file', 'driver_path': '', 'browser_path': ''}\n\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"\u003Cstdin>\", line 1, in \u003Cmodule>\n  File \"/usr/local/lib/python3.11/site-packages/selenium/webdriver/firefox/webdriver.py\", line 59, in __init__\n    self.service.path = DriverFinder.get_path(self.service, options)\n                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/selenium/webdriver/common/driver_finder.py\", line 41, in get_path\n    raise NoSuchDriverException(msg) from err\nselenium.common.exceptions.NoSuchDriverException: Message: Unable to obtain driver for firefox using Selenium Manager.; For documentation on this error, please visit: https://www.selenium.dev/documentation/webdriver/troubleshooting/errors/driver_location\n","pyth",[23,413,414,419,424,429,434,439,444,449,454,459,464,469,473,477,482,486,490,495,501,507,513,519,525],{"__ignoreMap":51},[55,415,416],{"class":57,"line":58},[55,417,418],{},"Traceback (most recent call last):\n",[55,420,421],{"class":57,"line":69},[55,422,423],{},"  File \"/usr/local/lib/python3.11/site-packages/selenium/webdriver/common/driver_finder.py\", line 38, in get_path\n",[55,425,426],{"class":57,"line":83},[55,427,428],{},"    path = SeleniumManager().driver_location(options) if path is None else path\n",[55,430,431],{"class":57,"line":96},[55,432,433],{},"           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n",[55,435,436],{"class":57,"line":103},[55,437,438],{},"  File \"/usr/local/lib/python3.11/site-packages/selenium/webdriver/common/selenium_manager.py\", line 95, in driver_location\n",[55,440,441],{"class":57,"line":110},[55,442,443],{},"    output = self.run(args)\n",[55,445,446],{"class":57,"line":135},[55,447,448],{},"             ^^^^^^^^^^^^^^\n",[55,450,451],{"class":57,"line":155},[55,452,453],{},"  File \"/usr/local/lib/python3.11/site-packages/selenium/webdriver/common/selenium_manager.py\", line 141, in run\n",[55,455,456],{"class":57,"line":160},[55,457,458],{},"    raise WebDriverException(f\"Unsuccessful command executed: {command}.\\n{result}{stderr}\")\n",[55,460,461],{"class":57,"line":169},[55,462,463],{},"selenium.common.exceptions.WebDriverException: Message: Unsuccessful command executed: /usr/local/lib/python3.11/site-packages/selenium/webdriver/common/linux/selenium-manager --browser firefox --output json.\n",[55,465,466],{"class":57,"line":184},[55,467,468],{},"{'code': 65, 'message': 'error sending request for url (https://github.com/mozilla/geckodriver/releases/latest): connection error: unexpected end of file', 'driver_path': '', 'browser_path': ''}\n",[55,470,471],{"class":57,"line":198},[55,472,100],{"emptyLinePlaceholder":99},[55,474,475],{"class":57,"line":203},[55,476,100],{"emptyLinePlaceholder":99},[55,478,479],{"class":57,"line":229},[55,480,481],{},"The above exception was the direct cause of the following exception:\n",[55,483,484],{"class":57,"line":262},[55,485,100],{"emptyLinePlaceholder":99},[55,487,488],{"class":57,"line":323},[55,489,418],{},[55,491,492],{"class":57,"line":329},[55,493,494],{},"  File \"\u003Cstdin>\", line 1, in \u003Cmodule>\n",[55,496,498],{"class":57,"line":497},18,[55,499,500],{},"  File \"/usr/local/lib/python3.11/site-packages/selenium/webdriver/firefox/webdriver.py\", line 59, in __init__\n",[55,502,504],{"class":57,"line":503},19,[55,505,506],{},"    self.service.path = DriverFinder.get_path(self.service, options)\n",[55,508,510],{"class":57,"line":509},20,[55,511,512],{},"                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n",[55,514,516],{"class":57,"line":515},21,[55,517,518],{},"  File \"/usr/local/lib/python3.11/site-packages/selenium/webdriver/common/driver_finder.py\", line 41, in get_path\n",[55,520,522],{"class":57,"line":521},22,[55,523,524],{},"    raise NoSuchDriverException(msg) from err\n",[55,526,528],{"class":57,"line":527},23,[55,529,530],{},"selenium.common.exceptions.NoSuchDriverException: Message: Unable to obtain driver for firefox using Selenium Manager.; For documentation on this error, please visit: https://www.selenium.dev/documentation/webdriver/troubleshooting/errors/driver_location\n",[19,532,533,534,538],{},"我才发现 selenium 试图访问 ",[37,535,536],{"href":536,"rel":537},"https://github.com/mozilla/geckodriver/releases/latest",[41]," 且访问失败了。仔细阅读了 selenium 项目的文档发现新版本的 selenium 会尝试自动下载 webdriver:",[43,540,541],{},[19,542,543],{},"As of Selenium 4.6, Selenium downloads the correct driver for you. You shouldn’t need to do anything.",[19,545,546],{},"表面上看上去我不需要做任何事情，但项目组忽略了中国大陆的网络环境。",[19,548,549,550,555,556,559],{},"服务是要在境内的云服务器上跑的，我也不敢开代理，现在比较靠谱的方案是我去手动指定 Firefox 的 geckodriver，避免 selenium 去帮我自动下载一份。在 ",[37,551,554],{"href":552,"rel":553},"https://selenium-python.readthedocs.io/api.html#module-selenium.webdriver.firefox.webdriver",[41],"python-selenium 的官方文档","中是让我们创建 Firefox 的 webdriver 时去传入一个 ",[23,557,558],{},"executable_path='geckodriver'"," 的关键词参数，可惜这是过时的用法，应该是维护者还没来得及更新文档。",[19,561,562,563],{},"随后便在 stackoverflow 上找到了新版 selenium ",[37,564,567],{"href":565,"rel":566},"https://stackoverflow.com/questions/76550506/typeerror-webdriver-init-got-an-unexpected-keyword-argument-executable-p",[41],"手动指定 Chrome 的 chromedriver 的方法",[43,569,570],{},[46,571,573],{"className":48,"code":572,"language":50,"meta":51,"style":51},"from selenium import webdriver\nfrom selenium.webdriver.chrome.service import Service\n\nservice = Service(executable_path='chromedriver.exe') \noptions = webdriver.ChromeOptions()\ndriver = webdriver.Chrome(service=service, options=options)\n# ...\ndriver.quit()\n",[23,574,575,587,599,603,627,643,673,679],{"__ignoreMap":51},[55,576,577,579,582,584],{"class":57,"line":58},[55,578,72],{"class":61},[55,580,581],{"class":65}," selenium ",[55,583,62],{"class":61},[55,585,586],{"class":65}," webdriver\n",[55,588,589,591,594,596],{"class":57,"line":69},[55,590,72],{"class":61},[55,592,593],{"class":65}," selenium.webdriver.chrome.service ",[55,595,62],{"class":61},[55,597,598],{"class":65}," Service\n",[55,600,601],{"class":57,"line":83},[55,602,100],{"emptyLinePlaceholder":99},[55,604,605,608,610,613,615,619,621,624],{"class":57,"line":96},[55,606,607],{"class":65},"service ",[55,609,142],{"class":141},[55,611,612],{"class":177}," Service",[55,614,119],{"class":65},[55,616,618],{"class":617},"sp7wS","executable_path",[55,620,142],{"class":141},[55,622,623],{"class":145},"'chromedriver.exe'",[55,625,626],{"class":65},") \n",[55,628,629,632,634,637,640],{"class":57,"line":103},[55,630,631],{"class":65},"options ",[55,633,142],{"class":141},[55,635,636],{"class":65}," webdriver.",[55,638,639],{"class":177},"ChromeOptions",[55,641,642],{"class":65},"()\n",[55,644,645,648,650,652,655,657,660,662,665,668,670],{"class":57,"line":110},[55,646,647],{"class":65},"driver ",[55,649,142],{"class":141},[55,651,636],{"class":65},[55,653,654],{"class":177},"Chrome",[55,656,119],{"class":65},[55,658,659],{"class":617},"service",[55,661,142],{"class":141},[55,663,664],{"class":65},"service, ",[55,666,667],{"class":617},"options",[55,669,142],{"class":141},[55,671,672],{"class":65},"options)\n",[55,674,675],{"class":57,"line":135},[55,676,678],{"class":677},"sW2Sy","# ...\n",[55,680,681,684,687],{"class":57,"line":155},[55,682,683],{"class":65},"driver.",[55,685,686],{"class":177},"quit",[55,688,642],{"class":65},[19,690,691],{},"原文给的是 chrome 的方案，但 Firefox 的方案基本也是一致的，应该也是去创建一个 service 对象，猜一猜就能猜到。",[46,693,695],{"className":48,"code":694,"language":50,"meta":51,"style":51},"from selenium import webdriver\nfrom selenium.webdriver.firefox.service import Service\nfrom selenium.webdriver.firefox.options import Options\n\nservice = Service(executable_path='/root/geckodriver') # 我这里是 docker 打包，懒得创建一个普通用户了，就直接用了 root 用户的 home 目录\noptions = Options(\"--headless\")\ndriver = webdriver.Firefox(service=service, options=options)\n# ...\ndriver.quit()\n",[23,696,697,707,718,730,734,757,774,798,802],{"__ignoreMap":51},[55,698,699,701,703,705],{"class":57,"line":58},[55,700,72],{"class":61},[55,702,581],{"class":65},[55,704,62],{"class":61},[55,706,586],{"class":65},[55,708,709,711,714,716],{"class":57,"line":69},[55,710,72],{"class":61},[55,712,713],{"class":65}," selenium.webdriver.firefox.service ",[55,715,62],{"class":61},[55,717,598],{"class":65},[55,719,720,722,725,727],{"class":57,"line":83},[55,721,72],{"class":61},[55,723,724],{"class":65}," selenium.webdriver.firefox.options ",[55,726,62],{"class":61},[55,728,729],{"class":65}," Options\n",[55,731,732],{"class":57,"line":96},[55,733,100],{"emptyLinePlaceholder":99},[55,735,736,738,740,742,744,746,748,751,754],{"class":57,"line":103},[55,737,607],{"class":65},[55,739,142],{"class":141},[55,741,612],{"class":177},[55,743,119],{"class":65},[55,745,618],{"class":617},[55,747,142],{"class":141},[55,749,750],{"class":145},"'/root/geckodriver'",[55,752,753],{"class":65},") ",[55,755,756],{"class":677},"# 我这里是 docker 打包，懒得创建一个普通用户了，就直接用了 root 用户的 home 目录\n",[55,758,759,761,763,766,768,771],{"class":57,"line":110},[55,760,631],{"class":65},[55,762,142],{"class":141},[55,764,765],{"class":177}," Options",[55,767,119],{"class":65},[55,769,770],{"class":145},"\"--headless\"",[55,772,773],{"class":65},")\n",[55,775,776,778,780,782,784,786,788,790,792,794,796],{"class":57,"line":135},[55,777,647],{"class":65},[55,779,142],{"class":141},[55,781,636],{"class":65},[55,783,392],{"class":177},[55,785,119],{"class":65},[55,787,659],{"class":617},[55,789,142],{"class":141},[55,791,664],{"class":65},[55,793,667],{"class":617},[55,795,142],{"class":141},[55,797,672],{"class":65},[55,799,800],{"class":57,"line":155},[55,801,678],{"class":677},[55,803,804,806,808],{"class":57,"line":160},[55,805,683],{"class":65},[55,807,686],{"class":177},[55,809,642],{"class":65},[19,811,812],{},"手动指定 geckodriver 后，在我 1 核 1 G 的小主机上创建 webdriver 对象，基本都可以秒完成。",[381,814,815],{},"html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html pre.shiki code .sLKXg, html code.shiki .sLKXg{--shiki-default:#A626A4;--shiki-dark:#C678DD}html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html pre.shiki code .sknuh, html code.shiki .sknuh{--shiki-default:#383A42;--shiki-dark:#56B6C2}html pre.shiki code .slOjB, html code.shiki .slOjB{--shiki-default:#383A42;--shiki-dark:#61AFEF}html pre.shiki code .sp7wS, html code.shiki .sp7wS{--shiki-default:#986801;--shiki-default-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html pre.shiki code .sW2Sy, html code.shiki .sW2Sy{--shiki-default:#A0A1A7;--shiki-default-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic}",{"title":51,"searchDepth":69,"depth":69,"links":817},[],{"title":819,"date":820,"path":821,"tags":822,"body":827},"从零开始的静态网页部署（到个人云服务器）","2023-08-04 01:19:22","/2023/08/04/static-webpage-deployment-for-a-beginner",[11,823,824,825,826],"Network","Vue.js","Caddy","Web",{"type":16,"value":828,"toc":2222},[829,846,851,854,867,870,874,877,880,889,892,900,909,912,915,918,921,925,928,931,934,937,940,943,946,949,952,955,959,962,966,969,972,996,1085,1088,1091,1094,1107,1114,1125,1128,1135,1140,1143,1149,1152,1157,1161,1174,1284,1288,1296,1299,1427,1430,1462,1465,1472,1515,1518,1522,1526,1531,1534,1547,1550,1568,1575,1610,1624,1641,1647,1663,1669,1684,1693,1713,1720,1723,1726,1729,1732,1735,1739,1744,1747,1777,1780,1783,1789,1792,1857,1861,1865,1869,1872,1879,1947,1951,1954,1958,1965,1971,2009,2013,2019,2024,2068,2078,2086,2089,2092,2095,2098,2114,2117,2134,2137,2154,2157,2173,2176,2192,2195,2209,2212,2216,2219],[43,830,831,840,843],{},[19,832,833,834,839],{},"这篇博客是受 ",[37,835,838],{"href":836,"rel":837},"https://blog.tiancy.cn/",[41],"Tiancy"," 之托，在2023年精弘网络暑期授课的前端系列第七节课时针对项目部署这一块内容时所产生的产物。在授课视频中，受时长所限，我不得不采用宝塔面板+纯 ip 访问的方式来完成一个简单的部署，但这终究不是什么优雅的方案: 宝塔的安全性堪忧、其隐私性也是备受争议，而纯 ip 访问的方式也过于简陋，且没有支持 https 访问。",[19,841,842],{},"因此这篇博客将以面对初学者的口吻去讲述如何从零开始部署一个 Vue.js 的项目到云服务器，以解我心头的愧疚。但是，我没有备案过的域名，且国内云服务器厂商众多，这篇博客终究不可能做到像保姆级教学那样去一一演示每一家云服务器厂商网页面板上的操作过程，而一些比较基础的概念我会给出简单的解释和例子以及引用一些外部链接，但终究不会全面覆盖到，诸位还请见谅。",[19,844,845],{},"本文采用了一些 ChatGPT 和 Google Bard 提供的内容，准确性经过我本人核阅。",[847,848,850],"h2",{"id":849},"基础-web-知识","基础 Web 知识",[19,852,853],{},"针对以下三个知识点，我是在初中的信息课上学到的，互联网上应该不乏对于这三个问题的权威解释，因此我也不在此赘述，不知道的小伙伴请自行搜索。",[855,856,857,861,864],"ul",{},[858,859,860],"li",{},"ip 地址是什么",[858,862,863],{},"域名是什么",[858,865,866],{},"DNS 服务器是干什么的",[847,868,869],{"id":869},"关于备案",[871,872,873],"h3",{"id":873},"不备案的影响",[19,875,876],{},"当你通过域名去访问境内服务器的 80 (http 默认端口) 和 443 (https 默认端口)时，如果该域名没有备案或者境内这台云服务器的云服务器商不知道你在别的服务商那里有备案的情况下，则会对请求进行拦截。对于访问 80 的请求，将会直接劫持 http 请求以重定向到他们的备案提示页面；对于访问 443 的请求，由于 https 没法被劫持，则会通过连接重置的方式阻止你访问。如果你确定你需要使用中国大陆境内的云服务器，应当采取「备案」和「接入备案」两种方式分别解决上述两种情况。",[871,878,879],{"id":879},"备案方法",[19,881,882,883,888],{},"每个省都有自己对应的管局，而各省的管局对于备案的规则都有些差异，而个人备案一般是找自己户籍所在地的管局去备案，详细的可以看",[37,884,887],{"href":885,"rel":886},"https://help.aliyun.com/zh/icp-filing/user-guide/icp-filing-regulations-of-the-miit-for-different-regions",[41],"阿里云写的文档","。",[871,890,891],{"id":891},"使用中国大陆境外的云服务器",[19,893,894,895,899],{},"可以选择和我一样去中国大陆以外的地区部署云服务，但由于众所周知的原因，访问别的国家或地区的服务器可能会有速度慢、延迟高等问题，这涉及到线路优化，也比较复杂。更糟糕的情况是，你甚至有可能刚开出来一台机子就发现这个 ip 在中国大陆境内是无法访问到的，这也是比较尴尬的地方。一般来说，可以选择在境内的云服务器商那里实名认证（不是备案）去购买他们的境外服务器（比如 ucloud 新用户优惠的香港云服务器，",[896,897,898],"del",{},"ucloud 的客户经理看到了能不能再送我一台机子啊","），这种机子是线路相对比较好的。",[19,901,902,903,908],{},"选购中国大陆境外的云服务器时，厂商可能会提供测试 ip 来帮助你判断线路质量，可以使用 ipip.net 提供的 ",[37,904,907],{"href":905,"rel":906},"https://www.ipip.net/product/client.html",[41],"besttrace"," 程序来查看数据包经过的地方，很可能你买一台香港的服务器，数据却要从日本或者美国绕一圈，这就非常尴尬。",[847,910,911],{"id":911},"域名部分",[871,913,914],{"id":914},"域名注册",[19,916,917],{},"要获得一个域名，最简单的方式是花钱。境内的阿里云、腾讯云、华为云等几家比较有名的云服务器厂商均有域名注册的业务且价格基本差距不大，可以随便找一个注册。而境外的域名注册商，我这边个人推荐 namesilo，这家支持支付宝付款且价格尚可，首次购买前可以去搜索引擎搜一搜近期的优惠码，可能会有一些优惠折扣。（可恶我没有拿到 aff 回扣）",[871,919,920],{"id":920},"域名解析",[922,923,924],"h4",{"id":924},"域名解析的作用",[19,926,927],{},"如果你了解了 dns 的作用，那我们可以来简单讲讲域名解析是干什么的。dns 服务器将会告诉用户的设备某一个域名它对应的 ip 是多少，而域名解析这一步就是告诉世界上所有的 dns 服务器这个域名从此刻开始对应的 ip 是多少，以便世界上所有的 dns 服务器向网民在需要时告知他们正确的 ip 地址。",[19,929,930],{},"要实现这一步骤并不复杂，作为初学者我们也不必去担心会不会有人把你花钱买来的域名指向错误的 ip 地址，这些都交给域名解析服务去解决。几乎每一家提供的域名解析服务页面上都会指导你去将域名的 NameServer 设置为他们家的服务器，这里也不做教学。",[922,932,933],{"id":933},"域名解析服务推荐",[19,935,936],{},"凡是提供域名注册服务的云服务商基本也都会提供域名解析服务，在这里我主要推荐两家云服务商（我没拿广告费啊）—— cloudflare 和 dnspod。这两家免费版套餐的操作页面都简洁明了，没有非常扎眼的广告。前者提供了除中国大陆以外地区的 cdn 加速服务，而后者可以提供境内境外分线路解析的功能（把来自境内的用户指向 ip 地址 A，来自境外的用户指向 ip 地址 B）。",[922,938,939],{"id":939},"解析记录类型",[19,941,942],{},"作为初学者只需要了解 A 记录和 CNAME 记录就行了。",[19,944,945],{},"A 记录的意思就是将一个域名指向一个 ipv4 地址，也就是去实现 dns 服务器最主要的作用。而 CNAME 记录是将一个域名指向另一个域名，通俗来讲就是「和它一样」。比如 a.com 如果 CNAME 指向 b.com，意思就是说我现在不确定 a.com 的 ip 是多少，但我知道 a.com 的 ip 和 b.com 一样，所以你去查 b.com 就行了。",[847,947,948],{"id":948},"服务器部分",[871,950,951],{"id":951},"云服务器的购买",[19,953,954],{},"这部分我直接忽略过去了，本文在「关于备案」这一部分已经详细阐述了备案相关的内容，购买中国大陆境内还是境外的服务器需要由屏幕前的各位自己决定~~（应该没人会把我的博客打印成纸质稿看吧）~~。",[871,956,958],{"id":957},"如何选择云服务器上要运行的-linux-发行版","如何选择云服务器上要运行的 Linux 发行版",[19,960,961],{},"服务器上常用的 Linux 发行版主要是 Debian、Ubuntu、CentOS(这个死得差不多了) 这三个，那我个人更熟悉的是 Ubuntu，版本号越新越好，截止本文发出最新的 lts 版本是 22.04 lts，所以直接选择这个就行。",[871,963,965],{"id":964},"使用-ssh-连接上服务器","使用 ssh 连接上服务器",[19,967,968],{},"在云服务器的网页面板上选择好服务器的配置与运行的操作系统后，云服务商应该至少给你提供两样东西: 云服务器的 ip 和 root 用户的登陆密码。这可能是在网页面板上展示的，一些境外的云服务商可能是直接发送到你注册时预留的邮箱中的，这都无所谓。拿到这两样东西我们就可以使用 ssh 连接到服务器的终端，进行配置操作。",[19,970,971],{},"打开自己系统的终端，使用如下命令去连接云服务器（Win10 以上的系统应该也已经自带 openssh 了）",[46,973,977],{"className":974,"code":975,"language":976,"meta":51,"style":51},"language-bash shiki shiki-themes one-light one-dark-pro","ssh root@\u003Cyour_server_ip>\n","bash",[23,978,979],{"__ignoreMap":51},[55,980,981,984,987,990,993],{"class":57,"line":58},[55,982,983],{"class":106},"ssh",[55,985,986],{"class":145}," root@",[55,988,989],{"class":65},"\u003C",[55,991,992],{"class":145},"your_server_i",[55,994,995],{"class":65},"p>\n",[46,997,999],{"className":974,"code":998,"language":976,"meta":51,"style":51},"[zhullyb@Archlinux ~]$ ssh root@120.55.63.96\nThe authenticity of host '120.55.63.96 (120.55.63.96)' can't be established.\nED25519 key fingerprint is SHA256:Op8u4Fv+NvtOxJDKeBQ/jIsFpuR4EYTUt53qjG8k6ok.\nThis key is not known by any other names.\nAre you sure you want to continue connecting (yes/no/[fingerprint])? yes\nWarning: Permanently added '120.55.63.96' (ED25519) to the list of known hosts.\nroot@120.55.63.96's password: \nWelcome to Ubuntu 22.04.2 LTS (GNU/Linux 5.15.0-78-generic x86_64)\n",[23,1000,1001,1006,1026,1031,1036,1041,1046,1057],{"__ignoreMap":51},[55,1002,1003],{"class":57,"line":58},[55,1004,1005],{"class":65},"[zhullyb@Archlinux ~]$ ssh root@120.55.63.96\n",[55,1007,1008,1011,1014,1017,1020,1023],{"class":57,"line":69},[55,1009,1010],{"class":106},"The",[55,1012,1013],{"class":145}," authenticity",[55,1015,1016],{"class":145}," of",[55,1018,1019],{"class":145}," host",[55,1021,1022],{"class":145}," '120.55.63.96 (120.55.63.96)'",[55,1024,1025],{"class":145}," can't be established.\n",[55,1027,1028],{"class":57,"line":83},[55,1029,1030],{"class":145},"ED25519 key fingerprint is SHA256:Op8u4Fv+NvtOxJDKeBQ/jIsFpuR4EYTUt53qjG8k6ok.\n",[55,1032,1033],{"class":57,"line":96},[55,1034,1035],{"class":145},"This key is not known by any other names.\n",[55,1037,1038],{"class":57,"line":103},[55,1039,1040],{"class":145},"Are you sure you want to continue connecting (yes/no/[fingerprint])? yes\n",[55,1042,1043],{"class":57,"line":110},[55,1044,1045],{"class":145},"Warning: Permanently added '120.55.63.96' (ED25519) to the list of known hosts.\n",[55,1047,1048,1051,1054],{"class":57,"line":135},[55,1049,1050],{"class":145},"root@120.55.63.96's",[55,1052,1053],{"class":145}," password:",[55,1055,1056],{"class":65}," \n",[55,1058,1059,1062,1065,1068,1071,1074,1077,1080,1083],{"class":57,"line":155},[55,1060,1061],{"class":106},"Welcome",[55,1063,1064],{"class":145}," to",[55,1066,1067],{"class":145}," Ubuntu",[55,1069,1070],{"class":238}," 22.04.2",[55,1072,1073],{"class":145}," LTS",[55,1075,1076],{"class":65}," (GNU/Linux ",[55,1078,1079],{"class":145},"5.15.0-78-generic",[55,1081,1082],{"class":145}," x86_64",[55,1084,773],{"class":65},[19,1086,1087],{},"输入密码时，已经输入的密码部分在屏幕上不会显示，但无需理会，只要将云服务器的密码粘贴后直接敲回车就好。",[871,1089,1090],{"id":1090},"如何编辑一个服务器上的文件",[19,1092,1093],{},"一般来说，网上的教程会推荐你使用 vim 这个 tui 界面的编辑器去编辑这个文件，但 vim 的学习成本有点高，如果只是临时编辑服务器上的文件的话，我个人更加推荐使用 nano",[46,1095,1097],{"className":974,"code":1096,"language":976,"meta":51,"style":51},"nano /etc/caddy/conf.d/example.conf\n",[23,1098,1099],{"__ignoreMap":51},[55,1100,1101,1104],{"class":57,"line":58},[55,1102,1103],{"class":106},"nano",[55,1105,1106],{"class":145}," /etc/caddy/conf.d/example.conf\n",[19,1108,1109,1110,1113],{},"这行命令表示我要编辑 ",[23,1111,1112],{},"/etc/caddy/conf.d/example.conf"," 这个文件，如果这个文件不存在则去创建这个文件。",[19,1115,1116,1117,1120,1121,1124],{},"随后你可以根据自己的需求去编辑文件了，上下左右按键可以调整光标位置，直接敲键盘上的字母按键就可以把字母敲进去，想推出时使用 ",[23,1118,1119],{},"ctrl+s"," 保存，再使用 ",[23,1122,1123],{},"ctrl+x"," 退出就可以了。",[871,1126,1127],{"id":1127},"云服务器的安全组规则",[19,1129,1130,1131],{},"一般是国内的云服务厂商会有安全组规则这种东西，你可以理解成一个额外的防火墙。一般来说，80 和 443 两个端口被我们约定作为网页的默认端口，80 是 http 的端口，而 443 则是 https 的端口。因此，我们需要在安全组规则这里去允许 80 和 443 两个端口能被外部访问到。截图中是阿里云的控制面板。",[1132,1133],"img",{"alt":51,"src":1134},"https://static.031130.xyz/uploads/2024/08/12/64d4e31fd5270.webp",[19,1136,1137],{},[1132,1138],{"alt":51,"src":1139},"https://static.031130.xyz/uploads/2024/08/12/64d4e34db94ee.webp",[19,1141,1142],{},"云服务商给的默认规则应该是下面这个样子的:",[19,1144,1145],{},[1132,1146],{"alt":1147,"src":1148},"image-20230810151900653","https://static.031130.xyz/uploads/2024/08/12/64d4e3ca6aa29.webp",[19,1150,1151],{},"这里开放的 22 端口用于 ssh 连接服务器，而3389 则是 Windows 的远程桌面。我们可以使用「快速添加」按钮来开放 80 和 443 端口",[19,1153,1154],{},[1132,1155],{"alt":51,"src":1156},"https://static.031130.xyz/uploads/2024/08/12/64d4e4e5b1e68.webp",[871,1158,1160],{"id":1159},"linux-下常见的文件路径及对应作用","Linux 下常见的文件路径及对应作用",[19,1162,1163,1164,1169,1170,1173],{},"在这一章节中，我只罗列了几个比较常见的路径，更多的资料推荐查阅",[37,1165,1168],{"href":1166,"rel":1167},"https://www.runoob.com/linux/linux-system-contents.html",[41],"菜鸟教程","，写得还不错。",[23,1171,1172],{},"$USER"," 指当前用户的用户名",[1175,1176,1177,1190],"table",{},[1178,1179,1180],"thead",{},[1181,1182,1183,1187],"tr",{},[1184,1185,1186],"th",{},"路径",[1184,1188,1189],{},"作用",[1191,1192,1193,1208,1218,1231,1244,1254,1264,1274],"tbody",{},[1181,1194,1195,1201],{},[1196,1197,1198],"td",{},[23,1199,1200],{},"/home/$USER",[1196,1202,1203,1204,1207],{},"用户的家目录，下有 Desktop，Download，Picture 等多个文件夹（root 用户的家目录是 ",[23,1205,1206],{},"/root","）",[1181,1209,1210,1215],{},[1196,1211,1212],{},[23,1213,1214],{},"/etc",[1196,1216,1217],{},"存放软件的配置文件的地方",[1181,1219,1220,1225],{},[1196,1221,1222],{},[23,1223,1224],{},"/usr/bin",[1196,1226,1227,1228],{},"存放二进制可执行文件的地方，一般也会被链接到 ",[23,1229,1230],{},"/bin",[1181,1232,1233,1238],{},[1196,1234,1235],{},[23,1236,1237],{},"/usr/lib",[1196,1239,1240,1241],{},"一般用于存放依赖库(动态链接库)，一般会被链接到 ",[23,1242,1243],{},"/lib",[1181,1245,1246,1251],{},[1196,1247,1248],{},[23,1249,1250],{},"/usr/share",[1196,1252,1253],{},"一些共享数据，比如帮助文档、软件需要的资源文件等等",[1181,1255,1256,1261],{},[1196,1257,1258],{},[23,1259,1260],{},"/opt",[1196,1262,1263],{},"optional(可选) 的缩写，一些由官网提供的（区别于发行版自带的）软件可能被安装到这里",[1181,1265,1266,1271],{},[1196,1267,1268],{},[23,1269,1270],{},"/boot",[1196,1272,1273],{},"开机引导使用的路径，一般在正常使用时不会去操作这里",[1181,1275,1276,1281],{},[1196,1277,1278],{},[23,1279,1280],{},"/var",[1196,1282,1283],{},"variable(变量) 的缩写，存放那些经常被变更的东西，比如运行日志、网站数据等等",[871,1285,1287],{"id":1286},"caddy-的配置与使用","caddy 的配置与使用",[19,1289,1290,1291,1295],{},"caddy 是一个 web 服务器，他是使用 golang 写的一个平替品，拥有配置更简单、自动申请 Let's Encrypt 证书的优势，我个人非常推荐非专业运维去使用这个。caddy 的官方文档在 ",[37,1292,1293],{"href":1293,"rel":1294},"https://caddyserver.com/docs/",[41]," ，但我相信你们不会去看（我也没有认真看过），有问题可以尝试去问问 chatgpt 看看能不能得到想要的配置文件。caddy 现在已经迭代到 V2 版本了，与 V1 版本相比有一些语法差异以支持更多的功能，且许可证允许商用更加自由。",[19,1297,1298],{},"caddy V2 支持使用 json 配置文件或者 Caddyfile，对于不复杂的需求我个人更推荐后者，简洁易懂。下面是我博客所使用的 Caddyfile 示例:",[46,1300,1304],{"className":1301,"code":1302,"language":1303,"meta":51,"style":51},"language-nginx shiki shiki-themes one-light one-dark-pro","# 这里表示，使用 zhul.in 这个域名访问 443 端口时，提供以下内容\nzhul.in:443 {\n        # 这里设置了所需提供内容的目录\n        root * /var/www/blog\n\n        # 这里设置的是开启 https 支持时所需要使用的 ssl 证书文件，但如果不设置也不碍事，caddy 会自动帮你申请 Let's Encrypt 的 ssl 证书\n        tls /var/www/key/zhul.in.cert /var/www/key/zhul.in.key\n\n        # 这里表示我们开启了 zstd 和 gzip 两种压缩算法，来减少数据传输量，不设置也没问题\n        encode zstd gzip\n        # 这里表示我们开启了一个文件服务器，当你访问 https://zhul.in/example_file 时，caddy 会提供 /var/www/blog/example_file 这个文件的内容\n        file_server\n\n        # 这里是错误处理部分\n        handle_errors {\n                # 这里表示当发生错误时，将请求重定向到 /404.html 这个文件\n                rewrite * /404.html\n                # 这里使用了模板来处理错误页面。当发生错误时，Caddy会使用模板引擎来填充错误页面的内容，以便向用户显示有关错误的相关信息。\n                templates\n                #这里表示继续使用文件服务器来提供错误页面\n                file_server\n        }\n}\n","nginx",[23,1305,1306,1311,1322,1327,1335,1339,1344,1349,1353,1358,1363,1368,1373,1377,1382,1387,1392,1397,1402,1407,1412,1417,1422],{"__ignoreMap":51},[55,1307,1308],{"class":57,"line":58},[55,1309,1310],{"class":677},"# 这里表示，使用 zhul.in 这个域名访问 443 端口时，提供以下内容\n",[55,1312,1313,1316,1319],{"class":57,"line":69},[55,1314,1315],{"class":65},"zhul.in:",[55,1317,1318],{"class":61},"443",[55,1320,1321],{"class":65}," {\n",[55,1323,1324],{"class":57,"line":83},[55,1325,1326],{"class":677},"        # 这里设置了所需提供内容的目录\n",[55,1328,1329,1332],{"class":57,"line":96},[55,1330,1331],{"class":61},"        root ",[55,1333,1334],{"class":65},"* /var/www/blog\n",[55,1336,1337],{"class":57,"line":103},[55,1338,100],{"emptyLinePlaceholder":99},[55,1340,1341],{"class":57,"line":110},[55,1342,1343],{"class":677},"        # 这里设置的是开启 https 支持时所需要使用的 ssl 证书文件，但如果不设置也不碍事，caddy 会自动帮你申请 Let's Encrypt 的 ssl 证书\n",[55,1345,1346],{"class":57,"line":135},[55,1347,1348],{"class":65},"        tls /var/www/key/zhul.in.cert /var/www/key/zhul.in.key\n",[55,1350,1351],{"class":57,"line":155},[55,1352,100],{"emptyLinePlaceholder":99},[55,1354,1355],{"class":57,"line":160},[55,1356,1357],{"class":677},"        # 这里表示我们开启了 zstd 和 gzip 两种压缩算法，来减少数据传输量，不设置也没问题\n",[55,1359,1360],{"class":57,"line":169},[55,1361,1362],{"class":65},"        encode zstd gzip\n",[55,1364,1365],{"class":57,"line":184},[55,1366,1367],{"class":677},"        # 这里表示我们开启了一个文件服务器，当你访问 https://zhul.in/example_file 时，caddy 会提供 /var/www/blog/example_file 这个文件的内容\n",[55,1369,1370],{"class":57,"line":198},[55,1371,1372],{"class":65},"        file_server\n",[55,1374,1375],{"class":57,"line":203},[55,1376,100],{"emptyLinePlaceholder":99},[55,1378,1379],{"class":57,"line":229},[55,1380,1381],{"class":677},"        # 这里是错误处理部分\n",[55,1383,1384],{"class":57,"line":262},[55,1385,1386],{"class":65},"        handle_errors {\n",[55,1388,1389],{"class":57,"line":323},[55,1390,1391],{"class":677},"                # 这里表示当发生错误时，将请求重定向到 /404.html 这个文件\n",[55,1393,1394],{"class":57,"line":329},[55,1395,1396],{"class":65},"                rewrite * /404.html\n",[55,1398,1399],{"class":57,"line":497},[55,1400,1401],{"class":677},"                # 这里使用了模板来处理错误页面。当发生错误时，Caddy会使用模板引擎来填充错误页面的内容，以便向用户显示有关错误的相关信息。\n",[55,1403,1404],{"class":57,"line":503},[55,1405,1406],{"class":65},"                templates\n",[55,1408,1409],{"class":57,"line":509},[55,1410,1411],{"class":677},"                #这里表示继续使用文件服务器来提供错误页面\n",[55,1413,1414],{"class":57,"line":515},[55,1415,1416],{"class":65},"                file_server\n",[55,1418,1419],{"class":57,"line":521},[55,1420,1421],{"class":65},"        }\n",[55,1423,1424],{"class":57,"line":527},[55,1425,1426],{"class":65},"}\n",[19,1428,1429],{},"你可以发现，如果要把这个 Caddyfile 写到最简单，仅仅是能跑的状态，只需要这几行:",[46,1431,1433],{"className":1301,"code":1432,"language":1303,"meta":51,"style":51},"zhul.in:443 {\n        root * /var/www/blog\n        \n        file_server\n}\n",[23,1434,1435,1443,1449,1454,1458],{"__ignoreMap":51},[55,1436,1437,1439,1441],{"class":57,"line":58},[55,1438,1315],{"class":65},[55,1440,1318],{"class":61},[55,1442,1321],{"class":65},[55,1444,1445,1447],{"class":57,"line":69},[55,1446,1331],{"class":61},[55,1448,1334],{"class":65},[55,1450,1451],{"class":57,"line":83},[55,1452,1453],{"class":65},"        \n",[55,1455,1456],{"class":57,"line":96},[55,1457,1372],{"class":65},[55,1459,1460],{"class":57,"line":103},[55,1461,1426],{"class":65},[19,1463,1464],{},"这就是我为什么推荐非专业运维去使用 caddy 的原因，只需要三行代码就可以跑起来一个简单的服务。",[19,1466,1467,1468,1471],{},"而部署一个 Vue.js 项目，我们可能会需要多加一行 ",[23,1469,1470],{},"try_files {path} {path}/ /index.html"," ，这一行代码的意思是当用户尝试访问 /example 时，实际需要用户的浏览器去访问 /index.html 这个地方，因为使用了 vue-router 的项目的编译产物只有 /index.html 而没有 /example.html，而后者的内容是包括在前者中的。以下的 Caddyfile 是精弘的首页正在使用的配置文件，应该可以适用于绝大多数的 Vue 项目:",[46,1473,1475],{"className":1301,"code":1474,"language":1303,"meta":51,"style":51},"www.myzjut.org {\n        root * /var/www/jh\n\n        encode zstd gzip\n        file_server\n        try_files {path} {path} /index.html\n}\n",[23,1476,1477,1487,1494,1498,1502,1506,1511],{"__ignoreMap":51},[55,1478,1479,1482,1485],{"class":57,"line":58},[55,1480,1481],{"class":65},"www.myzjut.",[55,1483,1484],{"class":61},"org",[55,1486,1321],{"class":65},[55,1488,1489,1491],{"class":57,"line":69},[55,1490,1331],{"class":61},[55,1492,1493],{"class":65},"* /var/www/jh\n",[55,1495,1496],{"class":57,"line":83},[55,1497,100],{"emptyLinePlaceholder":99},[55,1499,1500],{"class":57,"line":96},[55,1501,1362],{"class":65},[55,1503,1504],{"class":57,"line":103},[55,1505,1372],{"class":65},[55,1507,1508],{"class":57,"line":110},[55,1509,1510],{"class":65},"        try_files {path} {path} /index.html\n",[55,1512,1513],{"class":57,"line":135},[55,1514,1426],{"class":65},[19,1516,1517],{},"第一行省略了端口号，说明 80 和 443 端口都支持。",[871,1519,1521],{"id":1520},"通过sftprsync将本地的静态网页上传到云服务器的对应目录","通过sftp/rsync将本地的静态网页上传到云服务器的对应目录",[922,1523,1525],{"id":1524},"使用-sftp-部署","使用 sftp 部署",[43,1527,1528],{},[19,1529,1530],{},"sftp 是一个交互性比较强的上下传工具，如果不喜欢背命令的话可以考虑使用 sftp，操作起来都比较顺其自然",[19,1532,1533],{},"首先，我们在本地 cd 到静态网页文件所在的路径，比如一个 Vue 项目编译产生的文件可能就会在 dist 下面",[46,1535,1537],{"className":974,"code":1536,"language":976,"meta":51,"style":51},"cd dist/\n",[23,1538,1539],{"__ignoreMap":51},[55,1540,1541,1544],{"class":57,"line":58},[55,1542,1543],{"class":149},"cd",[55,1545,1546],{"class":145}," dist/\n",[19,1548,1549],{},"然后，我们使用 sftp 连接到服务器，这和 ssh 命令没什么两样的，就换了个命令名。",[46,1551,1553],{"className":974,"code":1552,"language":976,"meta":51,"style":51},"sftp root@\u003Cyour_server_ip>\n",[23,1554,1555],{"__ignoreMap":51},[55,1556,1557,1560,1562,1564,1566],{"class":57,"line":58},[55,1558,1559],{"class":106},"sftp",[55,1561,986],{"class":145},[55,1563,989],{"class":65},[55,1565,992],{"class":145},[55,1567,995],{"class":65},[19,1569,1570,1571,1574],{},"输入 root 用户的密码后，命令行的提示符就会变成 ",[23,1572,1573],{},"sftp >"," 的样子",[46,1576,1578],{"className":974,"code":1577,"language":976,"meta":51,"style":51},"[zhullyb@Archlinux ~]$ sftp root@\u003Cyour_server_ip>\nConnected to \u003Cyour_server_ip>.\nsftp>\n",[23,1579,1580,1585,1603],{"__ignoreMap":51},[55,1581,1582],{"class":57,"line":58},[55,1583,1584],{"class":65},"[zhullyb@Archlinux ~]$ sftp root@\u003Cyour_server_ip>\n",[55,1586,1587,1590,1592,1595,1597,1600],{"class":57,"line":69},[55,1588,1589],{"class":106},"Connected",[55,1591,1064],{"class":145},[55,1593,1594],{"class":65}," \u003C",[55,1596,992],{"class":145},[55,1598,1599],{"class":65},"p>",[55,1601,1602],{"class":145},".\n",[55,1604,1605,1607],{"class":57,"line":83},[55,1606,1559],{"class":106},[55,1608,1609],{"class":65},">\n",[19,1611,1612,1613,1615,1616,1619,1620,1623],{},"这是一个交互式的命令行窗口，可以使用 ",[23,1614,1543],{},"、",[23,1617,1618],{},"mkdir"," 等几个简单的命令。我们先创建 ",[23,1621,1622],{},"/var/www"," 这个文件夹:",[46,1625,1627],{"className":974,"code":1626,"language":976,"meta":51,"style":51},"sftp> mkdir /var/www\n",[23,1628,1629],{"__ignoreMap":51},[55,1630,1631,1633,1636,1638],{"class":57,"line":58},[55,1632,1559],{"class":106},[55,1634,1635],{"class":65},"> ",[55,1637,1618],{"class":145},[55,1639,1640],{"class":145}," /var/www\n",[19,1642,1643,1644,1623],{},"再创建 ",[23,1645,1646],{},"/var/www/jh",[46,1648,1650],{"className":974,"code":1649,"language":976,"meta":51,"style":51},"sftp> mkdir /var/www/jh\n",[23,1651,1652],{"__ignoreMap":51},[55,1653,1654,1656,1658,1660],{"class":57,"line":58},[55,1655,1559],{"class":106},[55,1657,1635],{"class":65},[55,1659,1618],{"class":145},[55,1661,1662],{"class":145}," /var/www/jh\n",[19,1664,1665,1666,1668],{},"随后，我们就可以进入远程服务器的 ",[23,1667,1646],{}," 目录下",[46,1670,1672],{"className":974,"code":1671,"language":976,"meta":51,"style":51},"sftp> cd /var/www/jh\n",[23,1673,1674],{"__ignoreMap":51},[55,1675,1676,1678,1680,1682],{"class":57,"line":58},[55,1677,1559],{"class":106},[55,1679,1635],{"class":65},[55,1681,1543],{"class":145},[55,1683,1662],{"class":145},[19,1685,1686,1687,1690,1691],{},"这样我们就可以把本地的静态网页文件上传到服务器，使用 ",[23,1688,1689],{},"put"," 命令即可，下面的命令表示将本地当前目录下的所有文件以及其子文件夹全部内容都上传到服务器的当前文件夹，也就是 ",[23,1692,1646],{},[46,1694,1696],{"className":974,"code":1695,"language":976,"meta":51,"style":51},"sftp> put -r *\n",[23,1697,1698],{"__ignoreMap":51},[55,1699,1700,1702,1704,1706,1709],{"class":57,"line":58},[55,1701,1559],{"class":106},[55,1703,1635],{"class":65},[55,1705,1689],{"class":145},[55,1707,1708],{"class":238}," -r",[55,1710,1712],{"class":1711},"s2QsP"," *\n",[19,1714,1715,1716,1719],{},"再输入 ",[23,1717,1718],{},"exit"," 即可推出 sftp 状态。",[19,1721,1722],{},"这边再教一些 sftp 使用中的常用命令:",[19,1724,1725],{},"ls: 查看远程服务器中当前目录中所有非隐藏文件",[19,1727,1728],{},"lls: 查看本地当前路径中的所有非隐藏文件",[19,1730,1731],{},"pwd: 查看远程服务器中当前的路径",[19,1733,1734],{},"lpwd: 查看本地当前的路径",[922,1736,1738],{"id":1737},"使用-rsync-部署","使用 rsync 部署",[43,1740,1741],{},[19,1742,1743],{},"rsync 的交互性就不太强，是在本机操作的，需要提前写好一行比较长的命令去执行操作，比较适合写在脚本里。",[19,1745,1746],{},"下面这行代码是我们精弘网络首页使用 github action 部署时的命令",[46,1748,1750],{"className":974,"code":1749,"language":976,"meta":51,"style":51},"rsync -avzP --delete dist/ root@\u003Cyour_server_ip>:/var/www/jh/\n",[23,1751,1752],{"__ignoreMap":51},[55,1753,1754,1757,1760,1763,1766,1768,1770,1772,1774],{"class":57,"line":58},[55,1755,1756],{"class":106},"rsync",[55,1758,1759],{"class":238}," -avzP",[55,1761,1762],{"class":238}," --delete",[55,1764,1765],{"class":145}," dist/",[55,1767,986],{"class":145},[55,1769,989],{"class":65},[55,1771,992],{"class":145},[55,1773,1599],{"class":65},[55,1775,1776],{"class":145},":/var/www/jh/\n",[19,1778,1779],{},"dist/ 表示我想要上传当前路径下的 dist 文件夹下的所有文件",[19,1781,1782],{},"root@\u003Cyour_server_ip> 这一段和前面的 ssh 与 sftp 一样，都表示用户名和对应的服务器 ip，",[19,1784,1785,1788],{},[23,1786,1787],{},":var/www/jh"," 表示文件将被上传到服务器的这个路径下。",[19,1790,1791],{},"以下是 rsync 的一些常用参数：",[855,1793,1794,1800,1806,1812,1818],{},[858,1795,1796,1799],{},[23,1797,1798],{},"-a","：以归档模式进行同步，即保持文件的所有属性（如权限、属主、属组、时间戳等）。",[858,1801,1802,1805],{},[23,1803,1804],{},"-v","：显示详细的同步过程。",[858,1807,1808,1811],{},[23,1809,1810],{},"-z","：使用压缩算法进行数据传输，以减少网络带宽的占用。",[858,1813,1814,1817],{},[23,1815,1816],{},"--delete","：在目标目录中删除源目录中不存在的文件。",[858,1819,1820,1823,1824,1826,1827,1830,1831,1834,1835,1850,1853,1854,1856],{},[23,1821,1822],{},"-P","选项是",[23,1825,1756],{},"命令的一个常用选项，它的作用是将",[23,1828,1829],{},"--partial","和",[23,1832,1833],{},"--progress","选项组合在一起使用。",[855,1836,1837,1845],{},[858,1838,1839,1841,1842,1844],{},[23,1840,1829],{},"选项表示如果文件传输被中断，",[23,1843,1756],{},"会保留已经传输的部分文件，下次继续传输时可以从上次中断的地方继续。",[858,1846,1847,1849],{},[23,1848,1833],{},"选项表示显示文件传输的进度信息，包括已经传输的字节数、传输速度和估计剩余时间等。",[1851,1852],"br",{},"使用",[23,1855,1822],{},"选项可以方便地同时启用这两个选项，以便在文件传输期间显示进度信息，并在中断后继续传输。",[847,1858,1860],{"id":1859},"附-其他相关的一些操作技巧还没写完等我填坑","附 : 其他相关的一些操作技巧（还没写完，等我填坑）",[871,1862,1864],{"id":1863},"使用-ssh-copy-id-将本地的-ssh-公钥复制到服务器上","使用 ssh-copy-id 将本地的 ssh 公钥复制到服务器上",[871,1866,1868],{"id":1867},"配置-sshd-以加强服务器的安全性","配置 sshd 以加强服务器的安全性",[19,1870,1871],{},"sshd 是 Secure Shell Daemon 的缩写，它是一个 ssh 的守护进程，允许用户通过 SSH 协议安全地连接到远程服务器。",[19,1873,1874,1875,1878],{},"sshd 的配置文件应该在 ",[23,1876,1877],{},"/etc/ssh/sshd_config"," 文件中，通过更改其中一些配置项，我们可以让我们的服务器更安全。",[1175,1880,1881,1891],{},[1178,1882,1883],{},[1181,1884,1885,1888],{},[1184,1886,1887],{},"建议",[1184,1889,1890],{},"修改方式",[1191,1892,1893,1909,1923,1934],{},[1181,1894,1895,1898],{},[1196,1896,1897],{},"禁用 root 用户通过 SSH 登录",[1196,1899,1900,1901,1904,1905,1908],{},"在 sshd配置文件中将 ",[23,1902,1903],{},"PermitRootLogin"," 选项设置为 ",[23,1906,1907],{},"no","。（在此之前，你应该创建一个非 root 用户并设置好对应的账号密码，修改好 /etc/sudoers 文件确保该用户能够通过 sudo 执行一些需要 root 权限去执行的语句）",[1181,1910,1911,1914],{},[1196,1912,1913],{},"强制使用 SSH 密钥登录",[1196,1915,1916,1917,1904,1920,1922],{},"在 sshd 配置文件中将 ",[23,1918,1919],{},"PasswordAuthentication",[23,1921,1907],{},"。（在此之前，你应该完成上一步 ssh-copy-id 将本地的 ssh 公钥复制到服务器上）",[1181,1924,1925,1928],{},[1196,1926,1927],{},"更改 SSH 端口",[1196,1929,1916,1930,1933],{},[23,1931,1932],{},"Port"," 选项设置为一个未使用的端口。（在此之前，使用 ssh 命令连接到服务器时，需要使用 -p \u003Cport> 参数去指定端口）",[1181,1935,1936,1939],{},[1196,1937,1938],{},"启用 SSH 日志记录",[1196,1940,1916,1941,1904,1944,888],{},[23,1942,1943],{},"SyslogFacility",[23,1945,1946],{},"auth",[871,1948,1950],{"id":1949},"systemd-的作用与使用方法","systemd 的作用与使用方法",[19,1952,1953],{},"systemd 是一个用于管理 Linux 系统的服务管理器和初始化系统。",[922,1955,1957],{"id":1956},"使用-systemctl-命令管理服务状态","使用 systemctl 命令管理服务状态",[19,1959,1960,1961,1964],{},"在我们静态网页部署这一块，我们主要用 ",[23,1962,1963],{},"systemctl"," 命令去管理一些服务的状态，比如我们想要将 caddy 设置为开机自启，这样我们即使重启了服务器，caddy 也能自动开始提供服务。",[19,1966,1967,1968,1970],{},"以下是一些常见的 ",[23,1969,1963],{}," 命令：",[855,1972,1973,1979,1985,1991,1997,2003],{},[858,1974,1975,1978],{},[23,1976,1977],{},"systemctl start","：启动服务。",[858,1980,1981,1984],{},[23,1982,1983],{},"systemctl stop","：停止服务。",[858,1986,1987,1990],{},[23,1988,1989],{},"systemctl restart","：重新启动服务。",[858,1992,1993,1996],{},[23,1994,1995],{},"systemctl status","：查看服务的状态。",[858,1998,1999,2002],{},[23,2000,2001],{},"systemctl enable","：使服务在启动时自动启动。",[858,2004,2005,2008],{},[23,2006,2007],{},"systemctl disable","：使服务在启动时不自动启动。",[922,2010,2012],{"id":2011},"使用-journalctl-命令来查看日志消息","使用 journalctl 命令来查看日志消息",[19,2014,2015,2016,2018],{},"在服务出现问题的时候，我们可以通过 ",[23,2017,1963],{}," 命令去查看服务在运行过程中留下的日志消息，方便我们去排错。",[19,2020,1967,2021,1970],{},[23,2022,2023],{},"journalctl",[855,2025,2026,2032,2038,2044,2050,2056,2062],{},[858,2027,2028,2031],{},[23,2029,2030],{},"journalctl -b",": 显示当前系统日志。",[858,2033,2034,2037],{},[23,2035,2036],{},"journalctl -b -1",": 显示最近一条系统日志。",[858,2039,2040,2043],{},[23,2041,2042],{},"journalctl -b -10",": 显示最近 10 条系统日志。",[858,2045,2046,2049],{},[23,2047,2048],{},"journalctl -u \u003Cunit>",": 显示指定单元的日志。",[858,2051,2052,2055],{},[23,2053,2054],{},"journalctl -u \u003Cunit> -b",": 显示指定单元的最近系统日志。",[858,2057,2058,2061],{},[23,2059,2060],{},"journalctl -u \u003Cunit> -b -1",": 显示指定单元的最近一条系统日志。",[858,2063,2064,2067],{},[23,2065,2066],{},"journalctl -u \u003Cunit> -b -10",": 显示指定单元的最近 10 条系统日志。",[19,2069,2070,2071,2073,2074,2077],{},"还可以使用 ",[23,2072,2023],{}," 命令来导出日志消息到文件。例如，以下命令将当前系统日志导出到 ",[23,2075,2076],{},"/home/user/journal.log"," 文件：",[46,2079,2084],{"className":2080,"code":2082,"language":2083},[2081],"language-text","journalctl > /home/user/journal.log\n","text",[23,2085,2082],{"__ignoreMap":51},[871,2087,2088],{"id":2088},"防火墙的配置",[19,2090,2091],{},"关于防火墙，iptables 是 Linux 系统中最早使用的防火墙工具，它基于内核模块来过滤网络数据包。nftables 是 iptables 的继任者，与 iptables 相比，nftables 更简单易用，同时性能也更好。",[19,2093,2094],{},"但我这边想要推荐的是 ufw，他是 iptables 的一个前端，它提供一个更简单、更易于使用的命令行界面。UFW 基于 iptables 来实现其功能，但它不被用来直接使用 iptables 命令。UFW 使用自己的命令来配置防火墙，这些命令被转换为 iptables 命令并执行。",[19,2096,2097],{},"查看 ufw 状态",[46,2099,2101],{"className":974,"code":2100,"language":976,"meta":51,"style":51},"sudo ufw status\n",[23,2102,2103],{"__ignoreMap":51},[55,2104,2105,2108,2111],{"class":57,"line":58},[55,2106,2107],{"class":106},"sudo",[55,2109,2110],{"class":145}," ufw",[55,2112,2113],{"class":145}," status\n",[19,2115,2116],{},"禁用所有端口",[46,2118,2120],{"className":974,"code":2119,"language":976,"meta":51,"style":51},"sudo ufw deny all\n",[23,2121,2122],{"__ignoreMap":51},[55,2123,2124,2126,2128,2131],{"class":57,"line":58},[55,2125,2107],{"class":106},[55,2127,2110],{"class":145},[55,2129,2130],{"class":145}," deny",[55,2132,2133],{"class":145}," all\n",[19,2135,2136],{},"开放 22 端口(ssh 的默认端口，禁用可能导致服务器失联)",[46,2138,2140],{"className":974,"code":2139,"language":976,"meta":51,"style":51},"sudo ufw allow 22\n",[23,2141,2142],{"__ignoreMap":51},[55,2143,2144,2146,2148,2151],{"class":57,"line":58},[55,2145,2107],{"class":106},[55,2147,2110],{"class":145},[55,2149,2150],{"class":145}," allow",[55,2152,2153],{"class":238}," 22\n",[19,2155,2156],{},"开放 80 端口",[46,2158,2160],{"className":974,"code":2159,"language":976,"meta":51,"style":51},"sudo ufw allow 80\n",[23,2161,2162],{"__ignoreMap":51},[55,2163,2164,2166,2168,2170],{"class":57,"line":58},[55,2165,2107],{"class":106},[55,2167,2110],{"class":145},[55,2169,2150],{"class":145},[55,2171,2172],{"class":238}," 80\n",[19,2174,2175],{},"开放 443 端口",[46,2177,2179],{"className":974,"code":2178,"language":976,"meta":51,"style":51},"sudo ufw allow 443\n",[23,2180,2181],{"__ignoreMap":51},[55,2182,2183,2185,2187,2189],{"class":57,"line":58},[55,2184,2107],{"class":106},[55,2186,2110],{"class":145},[55,2188,2150],{"class":145},[55,2190,2191],{"class":238}," 443\n",[19,2193,2194],{},"启用 ufw",[46,2196,2198],{"className":974,"code":2197,"language":976,"meta":51,"style":51},"sudo ufw enable\n",[23,2199,2200],{"__ignoreMap":51},[55,2201,2202,2204,2206],{"class":57,"line":58},[55,2203,2107],{"class":106},[55,2205,2110],{"class":145},[55,2207,2208],{"class":145}," enable\n",[871,2210,2211],{"id":2211},"包管理器是什么",[871,2213,2215],{"id":2214},"linux-常用命令","Linux 常用命令",[871,2217,2218],{"id":2218},"常用的一些debug手段",[381,2220,2221],{},"html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html pre.shiki code .sW2Sy, html code.shiki .sW2Sy{--shiki-default:#A0A1A7;--shiki-default-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic}html pre.shiki code .sLKXg, html code.shiki .sLKXg{--shiki-default:#A626A4;--shiki-dark:#C678DD}html pre.shiki code .s_Sar, html code.shiki .s_Sar{--shiki-default:#0184BC;--shiki-dark:#56B6C2}html pre.shiki code .s2QsP, html code.shiki .s2QsP{--shiki-default:#E45649;--shiki-dark:#E5C07B}",{"title":51,"searchDepth":69,"depth":69,"links":2223},[2224,2225,2230,2234,2244],{"id":849,"depth":69,"text":850},{"id":869,"depth":69,"text":869,"children":2226},[2227,2228,2229],{"id":873,"depth":83,"text":873},{"id":879,"depth":83,"text":879},{"id":891,"depth":83,"text":891},{"id":911,"depth":69,"text":911,"children":2231},[2232,2233],{"id":914,"depth":83,"text":914},{"id":920,"depth":83,"text":920},{"id":948,"depth":69,"text":948,"children":2235},[2236,2237,2238,2239,2240,2241,2242,2243],{"id":951,"depth":83,"text":951},{"id":957,"depth":83,"text":958},{"id":964,"depth":83,"text":965},{"id":1090,"depth":83,"text":1090},{"id":1127,"depth":83,"text":1127},{"id":1159,"depth":83,"text":1160},{"id":1286,"depth":83,"text":1287},{"id":1520,"depth":83,"text":1521},{"id":1859,"depth":69,"text":1860,"children":2245},[2246,2247,2248,2249,2250,2251,2252],{"id":1863,"depth":83,"text":1864},{"id":1867,"depth":83,"text":1868},{"id":1949,"depth":83,"text":1950},{"id":2088,"depth":83,"text":2088},{"id":2211,"depth":83,"text":2211},{"id":2214,"depth":83,"text":2215},{"id":2218,"depth":83,"text":2218},{"title":2254,"date":2255,"path":2256,"tags":2257,"body":2259},"在运行OpenWRT的N1盒子上部署 QQBot","2023-07-31 04:11:31","/2023/07/31/run-qq-bot-on-phicomm-n1-openwrt",[11,823,2258],"Bot",{"type":16,"value":2260,"toc":3465},[2261,2264,2268,2287,2369,2384,2388,2397,2420,2424,2433,2437,2440,2444,2447,2451,2454,2457,2464,2467,3445,3462],[19,2262,2263],{},"由于学校社团的招新需要，我写了一个依赖于 go-cqhttp 运行的 QQ Bot，并没有实现什么花里胡哨的功能，只是实现了关键词回复和新人入群时的欢迎语。因为没考虑后续维护的问题，代码也写得比较草，但毕竟是能跑。这么一个小型的程序并不会占用的多少的服务器资源，单独为这么一个 Bot 去开一台国内的 vps 似乎是有些大材小用了，刚好我手上有一台运行在 OpenWRT 上的 Phicomm N1 盒子，反正也是 Linux 系统，便打算拿来挂 QQ Bot。",[847,2265,2267],{"id":2266},"安装-jdk","安装 JDK",[19,2269,2270,2271,2276,2277,2280,2281,2286],{},"由于腾讯近几个月对于 Bot 风控非常严格，所以不得不采用 SignServer 项目 ",[37,2272,2275],{"href":2273,"rel":2274},"https://github.com/fuqiuluo/unidbg-fetch-qsign",[41],"fuqiuluo/unidbg-fetch-qsign"," 来确保 Bot 账号不会被风控一次保证 Bot 运行的稳定性。而这个项目又是使用 Java 开发的，因此需要先安装 JDK/JRE。但 OpenWRT 的开发者可能并没有考虑到在路由器设备上运行 Java 程序的需求，因此 OpenWRT 的源里面是没有预先打包 JDK 的，因此我们需要额外安装。我直接 google 搜索了 ",[23,2278,2279],{},"install java on openwrt"," 的关键词，在 Github 找到了这个脚本: ",[37,2282,2285],{"href":2283,"rel":2284},"https://gist.github.com/simonswine/64773a80e748f36615e3251234f29d1d%E3%80%82%E4%BD%86%E5%BE%88%E9%81%97%E6%86%BE%EF%BC%8C%E4%BB%A3%E7%A0%81%E8%B7%91%E4%B8%8D%E8%B5%B7%E6%9D%A5%EF%BC%8C%E4%B8%8B%E8%BD%BD%E6%97%B6%E6%8F%90%E7%A4%BA",[41],"https://gist.github.com/simonswine/64773a80e748f36615e3251234f29d1d。但很遗憾，代码跑不起来，下载时提示"," 404。于是我打开脚本细细一看，脚本中 jdk 的版本号和设备的架构均需要改动。具体改动如下:",[46,2288,2292],{"className":2289,"code":2290,"language":2291,"meta":51,"style":51},"language-diff shiki shiki-themes one-light one-dark-pro","- REVISION=8.212.04-r0\n+ REVISION=8.302.08-r1\n# 版本号请自行去仓库内翻最新的\n......\n- URL=http://dl-cdn.alpinelinux.org/alpine/v3.10/community/armv7/\n+ URL=http://dl-cdn.alpinelinux.org/alpine/v3.14/community/aarch64/\n......\n- # verify packages\n- sha256sum -c \u003C\u003CEOF\n- e2fce9ee7348e9322c542206c3c3949e40690716d65e9f0e44dbbfca95d59d8c  openjdk8-8.212.04-r0.apk\n- 26ad786ff1ebeeb7cd24abee10bc56211a026a2d871cf161bb309563e1fcbabc  openjdk8-jre-8.212.04-r0.apk\n- 947d5f72ed2dc367c97d1429158913c9366f9c6ae01b7311dd8546b10ded8743  openjdk8-jre-base-- 8.212.04-r0.apk\n- c6a65402bf0a7051c60b45e1c6a8f4277a68a8b7e807078f20db17e0233dea8e  openjdk8-jre-lib-8.212.04-r0.apk\n- EOF\n# 我这里直接将 sha256 校验给删除了，有兴趣可以自己去更新这几个文件的文件名和其对应的哈希值\n","diff",[23,2293,2294,2300,2305,2310,2315,2320,2325,2329,2334,2339,2344,2349,2354,2359,2364],{"__ignoreMap":51},[55,2295,2296],{"class":57,"line":58},[55,2297,2299],{"class":2298},"sJa8x","- REVISION=8.212.04-r0\n",[55,2301,2302],{"class":57,"line":69},[55,2303,2304],{"class":145},"+ REVISION=8.302.08-r1\n",[55,2306,2307],{"class":57,"line":83},[55,2308,2309],{"class":677},"# 版本号请自行去仓库内翻最新的\n",[55,2311,2312],{"class":57,"line":96},[55,2313,2314],{"class":65},"......\n",[55,2316,2317],{"class":57,"line":103},[55,2318,2319],{"class":2298},"- URL=http://dl-cdn.alpinelinux.org/alpine/v3.10/community/armv7/\n",[55,2321,2322],{"class":57,"line":110},[55,2323,2324],{"class":145},"+ URL=http://dl-cdn.alpinelinux.org/alpine/v3.14/community/aarch64/\n",[55,2326,2327],{"class":57,"line":135},[55,2328,2314],{"class":65},[55,2330,2331],{"class":57,"line":155},[55,2332,2333],{"class":2298},"- # verify packages\n",[55,2335,2336],{"class":57,"line":160},[55,2337,2338],{"class":2298},"- sha256sum -c \u003C\u003CEOF\n",[55,2340,2341],{"class":57,"line":169},[55,2342,2343],{"class":2298},"- e2fce9ee7348e9322c542206c3c3949e40690716d65e9f0e44dbbfca95d59d8c  openjdk8-8.212.04-r0.apk\n",[55,2345,2346],{"class":57,"line":184},[55,2347,2348],{"class":2298},"- 26ad786ff1ebeeb7cd24abee10bc56211a026a2d871cf161bb309563e1fcbabc  openjdk8-jre-8.212.04-r0.apk\n",[55,2350,2351],{"class":57,"line":198},[55,2352,2353],{"class":2298},"- 947d5f72ed2dc367c97d1429158913c9366f9c6ae01b7311dd8546b10ded8743  openjdk8-jre-base-- 8.212.04-r0.apk\n",[55,2355,2356],{"class":57,"line":203},[55,2357,2358],{"class":2298},"- c6a65402bf0a7051c60b45e1c6a8f4277a68a8b7e807078f20db17e0233dea8e  openjdk8-jre-lib-8.212.04-r0.apk\n",[55,2360,2361],{"class":57,"line":229},[55,2362,2363],{"class":2298},"- EOF\n",[55,2365,2366],{"class":57,"line":262},[55,2367,2368],{"class":677},"# 我这里直接将 sha256 校验给删除了，有兴趣可以自己去更新这几个文件的文件名和其对应的哈希值\n",[19,2370,2371,2372,2375,2376,2379,2380,2383],{},"随后 ",[23,2373,2374],{},"chmod +x"," 授予脚本可执行权限后直接执行，我们就将 alpine linux 上的 openjdk 成功解包并安装到了我们的 OpenWRT 中，我们只需要配置好环境变量即可完成安装。但我又比较懒，我看见 SignServer 的启动脚本里是可以通过读取 ",[23,2377,2378],{},"$JAVA_HOME"," 来获取 Java 二进制可执行文件的代码逻辑，于是我便在每次启动 SignServer 脚本前提前执行 ",[23,2381,2382],{},"export JAVA_HOME=/opt/java-1.8-openjdk"," 即可。",[847,2385,2387],{"id":2386},"安装-screen","安装 screen",[19,2389,2390,2391,2396],{},"相比起前面 JDK 的安装，这一步 screen 的安装反而没有那么麻烦，",[37,2392,2395],{"href":2393,"rel":2394},"https://openwrt.org/packages/pkgdata/screen",[41],"在最新版本的 OpenWRT 源中，screen 已经被包括进去了","，我们直接把 OpenWRT 换好源，从源里就可以安装。",[46,2398,2400],{"className":974,"code":2399,"language":976,"meta":51,"style":51},"opkg update\nopkg install screen\n",[23,2401,2402,2410],{"__ignoreMap":51},[55,2403,2404,2407],{"class":57,"line":58},[55,2405,2406],{"class":106},"opkg",[55,2408,2409],{"class":145}," update\n",[55,2411,2412,2414,2417],{"class":57,"line":69},[55,2413,2406],{"class":106},[55,2415,2416],{"class":145}," install",[55,2418,2419],{"class":145}," screen\n",[847,2421,2423],{"id":2422},"下载-fixed-版本的-go-cqhttp","下载 fixed 版本的 go-cqhttp",[19,2425,2426,2427,2432],{},"由于 SignServer 更新，在其请求中多添加了 key 的参数要求，导致原版 go-cqhttp 的最新 release 中释出的二进制文件无法适配最新版的 SignServer，我暂时选用了一个",[37,2428,2431],{"href":2429,"rel":2430},"https://github.com/tomato-aoarasi/go-cqhttp-1.1.0-sign-fixed/",[41],"修复了这个问题的 fork"," 去运行 Bot。下载到 OpenWRT 后记得也要授予可执行文件。",[847,2434,2436],{"id":2435},"安装-python-脚本中所需要使用到的库","安装 Python 脚本中所需要使用到的库",[19,2438,2439],{},"OpenWRT 自带了 python 和 pip，这让我很欣慰。直接使用 pip 安装 flask 和 xlrd 等库即可，完全没有难度。",[847,2441,2443],{"id":2442},"运行-signserver","运行 SignServer",[19,2445,2446],{},"这一步很简单，将原项目的 Release 下载下来解压后上传到 OpenWRT 的某个路径后，开个 screen 窗口，设置好 JAVA_HOME 变量后再去调用 SignServer 中自带的 shell 脚本即可",[847,2448,2450],{"id":2449},"运行-go-cqhttp","运行 go-cqhttp",[19,2452,2453],{},"这一步也很简单，得益于 go 静态链接的特性，我们不需要为 go-cqhttp 安装任何额外的依赖就可以执行 Release 中的二进制文件，直接将我们在 PC 上登录好的 session、配置好的 device.json、config.yml 等文件上传到 N1 ，开个 screen 窗口运行即可。",[847,2455,2456],{"id":2456},"运行主程序",[19,2458,2459,2460,2463],{},"这个没什么好讲的，同样是开个 screen 窗口运行 ",[23,2461,2462],{},"python main.py"," 的事情",[19,2465,2466],{},"python 代码如下:",[46,2468,2470],{"className":48,"code":2469,"language":50,"meta":51,"style":51},"from flask import Flask,request\nimport requests\nimport xlrd\n\n# 读取 xls 中的关键词以及回应语句，将其加载到 dict 数据结构中\n_data2 = xlrd.open_workbook('/root/8yue222.xls')\nmain_table2 = _data2.sheets()[0]\nkey_lst2 = main_table2.col_values(0)[1:]\nvalue_lst2 = main_table2.col_values(1)[1:]\nfinal_dict = dict(zip(key_lst2,value_lst2))\n# 读取第二份 xls，并对相同的关键词做覆盖\n_data = xlrd.open_workbook('/root/daihao.xls')\nmain_table = _data.sheets()[0]\nkey_lst = main_table.col_values(4)[1:]\nkey_lst = [str(int(item)) if type(item) == float else item for item in key_lst if item != '']\nkey_lst.remove('Gary')\nvalue_lst = main_table.col_values(5)[1:]\nvalue_lst = [str(int(item)) if type(item) == float else item for item in value_lst if item != '']\nfinal_dict.update(dict(zip(key_lst,value_lst)))\n\napp = Flask(__name__)\nclass API:\n        @staticmethod\n        def send(message):\n                url = \"http://127.0.0.1:5700/send_msg\"\n                data = request.get_json()\n                params = {\n                        \"group_id\":data['group_id'],\n                        \"message\":message\n                }\n                requests.get(url,params=params)\n\n@app.route('/', methods=[\"POST\"])\ndef post_data():\n    data = request.get_json()\n    print(data)\n    if data['post_type'] == 'message':\n        message = data['message']\n        messagex()\n    elif data['post_type'] == 'notice' and data['notice_type'] == 'group_increase':\n        welcome()\n    else:\n        print(\"忽略消息\")\n\n    return \"OK\"\n\ndef messagex():\n        data = request.get_json()\n        message = data['message'].replace('％','%')\n        for key in final_dict.keys():\n                if key == message:\n                        API.send(final_dict[key])\n                        break\n\ndef welcome():\n        data = request.get_json()\n        group_id = data['group_id']\n        user_id = data['user_id']\n        API.send(\"[CQ:at,qq={}] 欢迎来到浙江工业大学，精弘网络欢迎各位的到来！如果想进一步了解我们，请戳精弘首页：www.jh.zjut.edu.cn\\n输入 菜单 获取精小弘机器人的菜单 哦！\\n请及时修改群名片\\n格式如下：姓名+专业/大类\".format(user_id))\n\nif __name__ == '__main__':\n    app.run(host='0.0.0.0', port=5701)\n",[23,2471,2472,2484,2491,2498,2502,2507,2527,2549,2575,2596,2614,2619,2637,2655,2678,2740,2755,2777,2826,2846,2850,2867,2879,2887,2903,2914,2930,2940,2955,2964,2970,2990,2995,3028,3039,3053,3062,3083,3098,3106,3140,3148,3156,3169,3174,3182,3187,3197,3211,3240,3258,3271,3285,3291,3296,3306,3319,3333,3348,3392,3397,3413],{"__ignoreMap":51},[55,2473,2474,2476,2479,2481],{"class":57,"line":58},[55,2475,72],{"class":61},[55,2477,2478],{"class":65}," flask ",[55,2480,62],{"class":61},[55,2482,2483],{"class":65}," Flask,request\n",[55,2485,2486,2488],{"class":57,"line":69},[55,2487,62],{"class":61},[55,2489,2490],{"class":65}," requests\n",[55,2492,2493,2495],{"class":57,"line":83},[55,2494,62],{"class":61},[55,2496,2497],{"class":65}," xlrd\n",[55,2499,2500],{"class":57,"line":96},[55,2501,100],{"emptyLinePlaceholder":99},[55,2503,2504],{"class":57,"line":103},[55,2505,2506],{"class":677},"# 读取 xls 中的关键词以及回应语句，将其加载到 dict 数据结构中\n",[55,2508,2509,2512,2514,2517,2520,2522,2525],{"class":57,"line":110},[55,2510,2511],{"class":65},"_data2 ",[55,2513,142],{"class":141},[55,2515,2516],{"class":65}," xlrd.",[55,2518,2519],{"class":177},"open_workbook",[55,2521,119],{"class":65},[55,2523,2524],{"class":145},"'/root/8yue222.xls'",[55,2526,773],{"class":65},[55,2528,2529,2532,2534,2537,2540,2543,2546],{"class":57,"line":135},[55,2530,2531],{"class":65},"main_table2 ",[55,2533,142],{"class":141},[55,2535,2536],{"class":65}," _data2.",[55,2538,2539],{"class":177},"sheets",[55,2541,2542],{"class":65},"()[",[55,2544,2545],{"class":238},"0",[55,2547,2548],{"class":65},"]\n",[55,2550,2551,2554,2556,2559,2562,2564,2566,2569,2572],{"class":57,"line":155},[55,2552,2553],{"class":65},"key_lst2 ",[55,2555,142],{"class":141},[55,2557,2558],{"class":65}," main_table2.",[55,2560,2561],{"class":177},"col_values",[55,2563,119],{"class":65},[55,2565,2545],{"class":238},[55,2567,2568],{"class":65},")[",[55,2570,2571],{"class":238},"1",[55,2573,2574],{"class":65},":]\n",[55,2576,2577,2580,2582,2584,2586,2588,2590,2592,2594],{"class":57,"line":160},[55,2578,2579],{"class":65},"value_lst2 ",[55,2581,142],{"class":141},[55,2583,2558],{"class":65},[55,2585,2561],{"class":177},[55,2587,119],{"class":65},[55,2589,2571],{"class":238},[55,2591,2568],{"class":65},[55,2593,2571],{"class":238},[55,2595,2574],{"class":65},[55,2597,2598,2601,2603,2606,2608,2611],{"class":57,"line":169},[55,2599,2600],{"class":65},"final_dict ",[55,2602,142],{"class":141},[55,2604,2605],{"class":149}," dict",[55,2607,119],{"class":65},[55,2609,2610],{"class":149},"zip",[55,2612,2613],{"class":65},"(key_lst2,value_lst2))\n",[55,2615,2616],{"class":57,"line":184},[55,2617,2618],{"class":677},"# 读取第二份 xls，并对相同的关键词做覆盖\n",[55,2620,2621,2624,2626,2628,2630,2632,2635],{"class":57,"line":198},[55,2622,2623],{"class":65},"_data ",[55,2625,142],{"class":141},[55,2627,2516],{"class":65},[55,2629,2519],{"class":177},[55,2631,119],{"class":65},[55,2633,2634],{"class":145},"'/root/daihao.xls'",[55,2636,773],{"class":65},[55,2638,2639,2642,2644,2647,2649,2651,2653],{"class":57,"line":203},[55,2640,2641],{"class":65},"main_table ",[55,2643,142],{"class":141},[55,2645,2646],{"class":65}," _data.",[55,2648,2539],{"class":177},[55,2650,2542],{"class":65},[55,2652,2545],{"class":238},[55,2654,2548],{"class":65},[55,2656,2657,2660,2662,2665,2667,2669,2672,2674,2676],{"class":57,"line":229},[55,2658,2659],{"class":65},"key_lst ",[55,2661,142],{"class":141},[55,2663,2664],{"class":65}," main_table.",[55,2666,2561],{"class":177},[55,2668,119],{"class":65},[55,2670,2671],{"class":238},"4",[55,2673,2568],{"class":65},[55,2675,2571],{"class":238},[55,2677,2574],{"class":65},[55,2679,2680,2682,2684,2687,2690,2692,2695,2698,2700,2703,2706,2709,2712,2715,2718,2721,2723,2725,2728,2730,2732,2735,2738],{"class":57,"line":262},[55,2681,2659],{"class":65},[55,2683,142],{"class":141},[55,2685,2686],{"class":65}," [",[55,2688,2689],{"class":149},"str",[55,2691,119],{"class":65},[55,2693,2694],{"class":149},"int",[55,2696,2697],{"class":65},"(item)) ",[55,2699,340],{"class":61},[55,2701,2702],{"class":149}," type",[55,2704,2705],{"class":65},"(item) ",[55,2707,2708],{"class":141},"==",[55,2710,2711],{"class":149}," float",[55,2713,2714],{"class":61}," else",[55,2716,2717],{"class":65}," item ",[55,2719,2720],{"class":61},"for",[55,2722,2717],{"class":65},[55,2724,271],{"class":61},[55,2726,2727],{"class":65}," key_lst ",[55,2729,340],{"class":61},[55,2731,2717],{"class":65},[55,2733,2734],{"class":141},"!=",[55,2736,2737],{"class":145}," ''",[55,2739,2548],{"class":65},[55,2741,2742,2745,2748,2750,2753],{"class":57,"line":323},[55,2743,2744],{"class":65},"key_lst.",[55,2746,2747],{"class":177},"remove",[55,2749,119],{"class":65},[55,2751,2752],{"class":145},"'Gary'",[55,2754,773],{"class":65},[55,2756,2757,2760,2762,2764,2766,2768,2771,2773,2775],{"class":57,"line":329},[55,2758,2759],{"class":65},"value_lst ",[55,2761,142],{"class":141},[55,2763,2664],{"class":65},[55,2765,2561],{"class":177},[55,2767,119],{"class":65},[55,2769,2770],{"class":238},"5",[55,2772,2568],{"class":65},[55,2774,2571],{"class":238},[55,2776,2574],{"class":65},[55,2778,2779,2781,2783,2785,2787,2789,2791,2793,2795,2797,2799,2801,2803,2805,2807,2809,2811,2813,2816,2818,2820,2822,2824],{"class":57,"line":497},[55,2780,2759],{"class":65},[55,2782,142],{"class":141},[55,2784,2686],{"class":65},[55,2786,2689],{"class":149},[55,2788,119],{"class":65},[55,2790,2694],{"class":149},[55,2792,2697],{"class":65},[55,2794,340],{"class":61},[55,2796,2702],{"class":149},[55,2798,2705],{"class":65},[55,2800,2708],{"class":141},[55,2802,2711],{"class":149},[55,2804,2714],{"class":61},[55,2806,2717],{"class":65},[55,2808,2720],{"class":61},[55,2810,2717],{"class":65},[55,2812,271],{"class":61},[55,2814,2815],{"class":65}," value_lst ",[55,2817,340],{"class":61},[55,2819,2717],{"class":65},[55,2821,2734],{"class":141},[55,2823,2737],{"class":145},[55,2825,2548],{"class":65},[55,2827,2828,2831,2834,2836,2839,2841,2843],{"class":57,"line":503},[55,2829,2830],{"class":65},"final_dict.",[55,2832,2833],{"class":177},"update",[55,2835,119],{"class":65},[55,2837,2838],{"class":149},"dict",[55,2840,119],{"class":65},[55,2842,2610],{"class":149},[55,2844,2845],{"class":65},"(key_lst,value_lst)))\n",[55,2847,2848],{"class":57,"line":509},[55,2849,100],{"emptyLinePlaceholder":99},[55,2851,2852,2855,2857,2860,2862,2865],{"class":57,"line":515},[55,2853,2854],{"class":65},"app ",[55,2856,142],{"class":141},[55,2858,2859],{"class":177}," Flask",[55,2861,119],{"class":65},[55,2863,2864],{"class":2298},"__name__",[55,2866,773],{"class":65},[55,2868,2869,2872,2876],{"class":57,"line":521},[55,2870,2871],{"class":61},"class",[55,2873,2875],{"class":2874},"sC09Y"," API",[55,2877,2878],{"class":65},":\n",[55,2880,2881,2884],{"class":57,"line":527},[55,2882,2883],{"class":106},"        @",[55,2885,2886],{"class":149},"staticmethod\n",[55,2888,2890,2893,2896,2898,2901],{"class":57,"line":2889},24,[55,2891,2892],{"class":61},"        def",[55,2894,2895],{"class":106}," send",[55,2897,119],{"class":65},[55,2899,2900],{"class":122},"message",[55,2902,132],{"class":65},[55,2904,2906,2909,2911],{"class":57,"line":2905},25,[55,2907,2908],{"class":65},"                url ",[55,2910,142],{"class":141},[55,2912,2913],{"class":145}," \"http://127.0.0.1:5700/send_msg\"\n",[55,2915,2917,2920,2922,2925,2928],{"class":57,"line":2916},26,[55,2918,2919],{"class":65},"                data ",[55,2921,142],{"class":141},[55,2923,2924],{"class":65}," request.",[55,2926,2927],{"class":177},"get_json",[55,2929,642],{"class":65},[55,2931,2933,2936,2938],{"class":57,"line":2932},27,[55,2934,2935],{"class":65},"                params ",[55,2937,142],{"class":141},[55,2939,1321],{"class":65},[55,2941,2943,2946,2949,2952],{"class":57,"line":2942},28,[55,2944,2945],{"class":145},"                        \"group_id\"",[55,2947,2948],{"class":65},":data[",[55,2950,2951],{"class":145},"'group_id'",[55,2953,2954],{"class":65},"],\n",[55,2956,2958,2961],{"class":57,"line":2957},29,[55,2959,2960],{"class":145},"                        \"message\"",[55,2962,2963],{"class":65},":message\n",[55,2965,2967],{"class":57,"line":2966},30,[55,2968,2969],{"class":65},"                }\n",[55,2971,2973,2976,2979,2982,2985,2987],{"class":57,"line":2972},31,[55,2974,2975],{"class":65},"                requests.",[55,2977,2978],{"class":177},"get",[55,2980,2981],{"class":65},"(url,",[55,2983,2984],{"class":617},"params",[55,2986,142],{"class":141},[55,2988,2989],{"class":65},"params)\n",[55,2991,2993],{"class":57,"line":2992},32,[55,2994,100],{"emptyLinePlaceholder":99},[55,2996,2998,3001,3004,3007,3009,3012,3014,3017,3019,3022,3025],{"class":57,"line":2997},33,[55,2999,3000],{"class":106},"@app",[55,3002,220],{"class":3003},"siaei",[55,3005,3006],{"class":106},"route",[55,3008,119],{"class":65},[55,3010,3011],{"class":145},"'/'",[55,3013,126],{"class":65},[55,3015,3016],{"class":617}," methods",[55,3018,142],{"class":141},[55,3020,3021],{"class":65},"[",[55,3023,3024],{"class":145},"\"POST\"",[55,3026,3027],{"class":65},"])\n",[55,3029,3031,3033,3036],{"class":57,"line":3030},34,[55,3032,113],{"class":61},[55,3034,3035],{"class":106}," post_data",[55,3037,3038],{"class":65},"():\n",[55,3040,3042,3045,3047,3049,3051],{"class":57,"line":3041},35,[55,3043,3044],{"class":65},"    data ",[55,3046,142],{"class":141},[55,3048,2924],{"class":65},[55,3050,2927],{"class":177},[55,3052,642],{"class":65},[55,3054,3056,3059],{"class":57,"line":3055},36,[55,3057,3058],{"class":149},"    print",[55,3060,3061],{"class":65},"(data)\n",[55,3063,3065,3067,3070,3073,3076,3078,3081],{"class":57,"line":3064},37,[55,3066,163],{"class":61},[55,3068,3069],{"class":65}," data[",[55,3071,3072],{"class":145},"'post_type'",[55,3074,3075],{"class":65},"] ",[55,3077,2708],{"class":141},[55,3079,3080],{"class":145}," 'message'",[55,3082,2878],{"class":65},[55,3084,3086,3089,3091,3093,3096],{"class":57,"line":3085},38,[55,3087,3088],{"class":65},"        message ",[55,3090,142],{"class":141},[55,3092,3069],{"class":65},[55,3094,3095],{"class":145},"'message'",[55,3097,2548],{"class":65},[55,3099,3101,3104],{"class":57,"line":3100},39,[55,3102,3103],{"class":177},"        messagex",[55,3105,642],{"class":65},[55,3107,3109,3112,3114,3116,3118,3120,3123,3126,3128,3131,3133,3135,3138],{"class":57,"line":3108},40,[55,3110,3111],{"class":61},"    elif",[55,3113,3069],{"class":65},[55,3115,3072],{"class":145},[55,3117,3075],{"class":65},[55,3119,2708],{"class":141},[55,3121,3122],{"class":145}," 'notice'",[55,3124,3125],{"class":61}," and",[55,3127,3069],{"class":65},[55,3129,3130],{"class":145},"'notice_type'",[55,3132,3075],{"class":65},[55,3134,2708],{"class":141},[55,3136,3137],{"class":145}," 'group_increase'",[55,3139,2878],{"class":65},[55,3141,3143,3146],{"class":57,"line":3142},41,[55,3144,3145],{"class":177},"        welcome",[55,3147,642],{"class":65},[55,3149,3151,3154],{"class":57,"line":3150},42,[55,3152,3153],{"class":61},"    else",[55,3155,2878],{"class":65},[55,3157,3159,3162,3164,3167],{"class":57,"line":3158},43,[55,3160,3161],{"class":149},"        print",[55,3163,119],{"class":65},[55,3165,3166],{"class":145},"\"忽略消息\"",[55,3168,773],{"class":65},[55,3170,3172],{"class":57,"line":3171},44,[55,3173,100],{"emptyLinePlaceholder":99},[55,3175,3177,3179],{"class":57,"line":3176},45,[55,3178,332],{"class":61},[55,3180,3181],{"class":145}," \"OK\"\n",[55,3183,3185],{"class":57,"line":3184},46,[55,3186,100],{"emptyLinePlaceholder":99},[55,3188,3190,3192,3195],{"class":57,"line":3189},47,[55,3191,113],{"class":61},[55,3193,3194],{"class":106}," messagex",[55,3196,3038],{"class":65},[55,3198,3200,3203,3205,3207,3209],{"class":57,"line":3199},48,[55,3201,3202],{"class":65},"        data ",[55,3204,142],{"class":141},[55,3206,2924],{"class":65},[55,3208,2927],{"class":177},[55,3210,642],{"class":65},[55,3212,3214,3216,3218,3220,3222,3225,3228,3230,3233,3235,3238],{"class":57,"line":3213},49,[55,3215,3088],{"class":65},[55,3217,142],{"class":141},[55,3219,3069],{"class":65},[55,3221,3095],{"class":145},[55,3223,3224],{"class":65},"].",[55,3226,3227],{"class":177},"replace",[55,3229,119],{"class":65},[55,3231,3232],{"class":145},"'％'",[55,3234,126],{"class":65},[55,3236,3237],{"class":145},"'%'",[55,3239,773],{"class":65},[55,3241,3243,3245,3248,3250,3253,3256],{"class":57,"line":3242},50,[55,3244,265],{"class":61},[55,3246,3247],{"class":65}," key ",[55,3249,271],{"class":61},[55,3251,3252],{"class":65}," final_dict.",[55,3254,3255],{"class":177},"keys",[55,3257,3038],{"class":65},[55,3259,3261,3264,3266,3268],{"class":57,"line":3260},51,[55,3262,3263],{"class":61},"                if",[55,3265,3247],{"class":65},[55,3267,2708],{"class":141},[55,3269,3270],{"class":65}," message:\n",[55,3272,3274,3277,3279,3282],{"class":57,"line":3273},52,[55,3275,3276],{"class":314},"                        API",[55,3278,220],{"class":65},[55,3280,3281],{"class":177},"send",[55,3283,3284],{"class":65},"(final_dict[key])\n",[55,3286,3288],{"class":57,"line":3287},53,[55,3289,3290],{"class":61},"                        break\n",[55,3292,3294],{"class":57,"line":3293},54,[55,3295,100],{"emptyLinePlaceholder":99},[55,3297,3299,3301,3304],{"class":57,"line":3298},55,[55,3300,113],{"class":61},[55,3302,3303],{"class":106}," welcome",[55,3305,3038],{"class":65},[55,3307,3309,3311,3313,3315,3317],{"class":57,"line":3308},56,[55,3310,3202],{"class":65},[55,3312,142],{"class":141},[55,3314,2924],{"class":65},[55,3316,2927],{"class":177},[55,3318,642],{"class":65},[55,3320,3322,3325,3327,3329,3331],{"class":57,"line":3321},57,[55,3323,3324],{"class":65},"        group_id ",[55,3326,142],{"class":141},[55,3328,3069],{"class":65},[55,3330,2951],{"class":145},[55,3332,2548],{"class":65},[55,3334,3336,3339,3341,3343,3346],{"class":57,"line":3335},58,[55,3337,3338],{"class":65},"        user_id ",[55,3340,142],{"class":141},[55,3342,3069],{"class":65},[55,3344,3345],{"class":145},"'user_id'",[55,3347,2548],{"class":65},[55,3349,3351,3354,3356,3358,3360,3363,3366,3369,3371,3374,3376,3379,3381,3384,3386,3389],{"class":57,"line":3350},59,[55,3352,3353],{"class":314},"        API",[55,3355,220],{"class":65},[55,3357,3281],{"class":177},[55,3359,119],{"class":65},[55,3361,3362],{"class":145},"\"[CQ:at,qq=",[55,3364,3365],{"class":238},"{}",[55,3367,3368],{"class":145},"] 欢迎来到浙江工业大学，精弘网络欢迎各位的到来！如果想进一步了解我们，请戳精弘首页：www.jh.zjut.edu.cn",[55,3370,25],{"class":149},[55,3372,3373],{"class":145},"输入 菜单 获取精小弘机器人的菜单 哦！",[55,3375,25],{"class":149},[55,3377,3378],{"class":145},"请及时修改群名片",[55,3380,25],{"class":149},[55,3382,3383],{"class":145},"格式如下：姓名+专业/大类\"",[55,3385,220],{"class":65},[55,3387,3388],{"class":177},"format",[55,3390,3391],{"class":65},"(user_id))\n",[55,3393,3395],{"class":57,"line":3394},60,[55,3396,100],{"emptyLinePlaceholder":99},[55,3398,3400,3402,3405,3408,3411],{"class":57,"line":3399},61,[55,3401,340],{"class":61},[55,3403,3404],{"class":2298}," __name__",[55,3406,3407],{"class":141}," ==",[55,3409,3410],{"class":145}," '__main__'",[55,3412,2878],{"class":65},[55,3414,3416,3419,3422,3424,3427,3429,3432,3435,3438,3440,3443],{"class":57,"line":3415},62,[55,3417,3418],{"class":65},"    app.",[55,3420,3421],{"class":177},"run",[55,3423,119],{"class":65},[55,3425,3426],{"class":617},"host",[55,3428,142],{"class":141},[55,3430,3431],{"class":145},"'0.0.0.0'",[55,3433,3434],{"class":65},", ",[55,3436,3437],{"class":617},"port",[55,3439,142],{"class":141},[55,3441,3442],{"class":238},"5701",[55,3444,773],{"class":65},[43,3446,3447,3450,3456],{},[19,3448,3449],{},"参考资料:",[19,3451,3452],{},[37,3453,3454],{"href":3454,"rel":3455},"https://gist.github.com/simonswine/64773a80e748f36615e3251234f29d1d",[41],[19,3457,3458],{},[37,3459,3460],{"href":3460,"rel":3461},"https://blog.csdn.net/qq_64126275/article/details/128586651",[41],[381,3463,3464],{},"html pre.shiki code .sJa8x, html code.shiki .sJa8x{--shiki-default:#E45649;--shiki-dark:#E06C75}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html pre.shiki code .sW2Sy, html code.shiki .sW2Sy{--shiki-default:#A0A1A7;--shiki-default-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic}html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .sLKXg, html code.shiki .sLKXg{--shiki-default:#A626A4;--shiki-dark:#C678DD}html pre.shiki code .sknuh, html code.shiki .sknuh{--shiki-default:#383A42;--shiki-dark:#56B6C2}html pre.shiki code .slOjB, html code.shiki .slOjB{--shiki-default:#383A42;--shiki-dark:#61AFEF}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html pre.shiki code .s_Sar, html code.shiki .s_Sar{--shiki-default:#0184BC;--shiki-dark:#56B6C2}html pre.shiki code .sC09Y, html code.shiki .sC09Y{--shiki-default:#C18401;--shiki-dark:#E5C07B}html pre.shiki code .so_Uh, html code.shiki .so_Uh{--shiki-default:#986801;--shiki-default-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic}html pre.shiki code .sp7wS, html code.shiki .sp7wS{--shiki-default:#986801;--shiki-default-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic}html pre.shiki code .siaei, html code.shiki .siaei{--shiki-default:#4078F2;--shiki-dark:#ABB2BF}html pre.shiki code .sYebD, html code.shiki .sYebD{--shiki-default:#383A42;--shiki-dark:#D19A66}",{"title":51,"searchDepth":69,"depth":69,"links":3466},[3467,3468,3469,3470,3471,3472,3473],{"id":2266,"depth":69,"text":2267},{"id":2386,"depth":69,"text":2387},{"id":2422,"depth":69,"text":2423},{"id":2435,"depth":69,"text":2436},{"id":2442,"depth":69,"text":2443},{"id":2449,"depth":69,"text":2450},{"id":2456,"depth":69,"text":2456},{"title":3475,"date":3476,"path":3477,"tags":3478,"body":3480},"在浙工大宿舍使用路由器连接移动网络(校园网)","2023-06-24 14:30:24","/2023/06/24/connect-china-mobile-with-router-in-zjut-dormitory",[823,3479],"Router",{"type":16,"value":3481,"toc":4418},[3482,3488,3497,3500,3503,3508,3511,3513,3518,3525,3533,3535,3540,3545,3551,3553,3559,3574,3578,3581,3587,3590,3593,3599,3602,3607,3616,3619,3624,4311,4314,4320,4327,4333,4336,4349,4352,4355,4370,4376,4383,4388,4394,4397,4403,4409,4415],[19,3483,3484],{},[3485,3486,3487],"strong",{},"2025.09.01 Updates:",[19,3489,3490,3491,3496],{},"最近看到这篇博客的热度还挺高，应该是最近新生开学有不少都在看。但移动的认证方式于今年的 8 月 15 日发生了变更，具体可以看",[37,3492,3495],{"href":3493,"rel":3494},"https://mp.weixin.qq.com/s/KtaP62A3h96FETerPdnQmw",[41],"这篇微信公众号文章","。我近期不在学校，没有环境去研究新的认证方式，但据我身边的人说不再需要什么 l2tp 了，找台常见的路由器直接走 dhcp 以后过一遍网页验证就好了。",[19,3498,3499],{},"祝各位新生在工大能渡过愉快的四年！",[3501,3502],"hr",{},[19,3504,3505],{},[3485,3506,3507],{},"2024.04.09 Updates:",[19,3509,3510],{},"几天前移动对网页认证的页面进行了更新，原有的脚本失效，本博客已更新适配新版网页认证的脚本。",[3501,3512],{},[19,3514,3515],{},[3485,3516,3517],{},"2023.7.10 Updates:",[19,3519,3520,3521,3524],{},"首先，",[3485,3522,3523],{},"搬到屏峰校区以后，l2tp 服务器确实依然为 192.168.115.1","，这点挺奇怪的。",[19,3526,3527,3528,888],{},"然后我发现 6.26 我的那个解决方案过于复杂，原先写的认证脚本完全可以胜任这项工作，之前失败的原因是因为我在朝晖抓的脚本参数不适用于屏峰校区，目前已经修复。脚本的变动情况可以看",[37,3529,3532],{"href":3530,"rel":3531},"https://gist.github.com/zhullyb/4c8708df5724c42f913d3d86ed49d929/revisions#diff-c33ee93215d3dddc16517dae8107b3473f7abc77f56ff5afedc1f263e7e22b27",[41],"这里",[3501,3534],{},[19,3536,3537],{},[3485,3538,3539],{},"2023.6.26 Updates:",[19,3541,3542],{},[896,3543,3544],{},"在我于 2023 年 6 月 26 日搬去屏峰校区以后，发生了连不上网的情况。目前一个可行的方案: 在 192.168.210.100 将自己的 MAC 地址全部解绑，然后使用自己的一台设备连接网线接口，正常通过网页验证。随后在 192.168.210.100 查看刚才通过网页验证的设备的 MAC 地址，将这一串 MAC 地址复制到 Padavan 的「外部网络（WAN）- MAC 地址」中，且将 l2tp 服务器改为 192.168.115.1 （没错，填朝晖的可以用）并重新连接 l2tp。",[19,3546,3547],{},[1132,3548],{"alt":3549,"src":3550},"MAC 地址设置","https://static.031130.xyz/uploads/2024/08/12/649987173e542.webp",[3501,3552],{},[19,3554,3555],{},[1132,3556],{"alt":3557,"src":3558},"这是我们上一篇博客的成果","https://static.031130.xyz/uploads/2024/08/12/6496ac4f3170f.webp",[43,3560,3561],{},[19,3562,3563,3567,3568,3573],{},[37,3564,3566],{"href":3565},"/2023/06/24/redmi-ac2100-router-with-padavan/","上一篇博客","中，我为 Redmi AC2100 刷入了 Padavan，接下来就打算使用这台路由器进行联网。其实",[37,3569,3572],{"href":3570,"rel":3571},"https://static.031130.xyz/uploads/2024/08/12/6496ab42d74bf.webp",[41],"小米大多数路由器都是支持 l2tp 的协议的","，只需要在路由器后台稍微设置一下就能上网，服务器 ip 填 192.168.113.1，账号密码就是 hxzha+手机尾号后8位，密码就是手机尾号后6位。我使用 Padavan 是我个人有一些别的官方固件所不能提供的功能。",[847,3575,3577],{"id":3576},"l2tp-相关设置","l2tp 相关设置",[19,3579,3580],{},"我们将 WAN 口插上墙壁一侧的网口，左侧菜单栏点击外部网络，将外网连接类型改为 l2tp",[19,3582,3583],{},[1132,3584],{"alt":3585,"src":3586},"外网连接类型","https://static.031130.xyz/uploads/2024/08/12/6496acaf4435b.webp",[19,3588,3589],{},"DNS 建议前两个填写学校的内网 DNS 地址( 172.16.7.10 ， 172.16.7.30)，最后一个填一个稳定的公共 DNS 即可，由于这一步是可选项，所以就不提供截图了。",[19,3591,3592],{},"往下拉，设置 l2tp 相关的设置项，只需要设置红色框框内的设置项即可。朝晖的 l2tp 服务器 ip 是 192.168.115.1 ， 屏峰校区是 192.168.113.1 ，这里不要填错了。",[19,3594,3595],{},[1132,3596],{"alt":3597,"src":3598},"Screenshot_20230623_213510.webp","https://static.031130.xyz/uploads/2024/08/12/6496ae85a4d4f.webp",[847,3600,3601],{"id":3601},"网页认证脚本",[43,3603,3604],{},[19,3605,3606],{},"做完这些步骤，其实就可以正常上网了，只不过每次断网以后可能都需要重新过一遍验证，所以我专门写了一个脚本去过这个验证。",[19,3608,3609,3610,3615],{},"这份脚本我已经开源到 ",[37,3611,3614],{"href":3612,"rel":3613},"https://gist.github.com/zhullyb/4c8708df5724c42f913d3d86ed49d929",[41],"github gist"," 了，在顶部填好自己网页认证时的账号密码以后就可以用了。",[19,3617,3618],{},"顶部 TODO 处要写的账号密码就是那个有图书馆背景的网页认证密码。",[19,3620,3621],{},[1132,3622],{"alt":51,"src":3623},"https://static.031130.xyz/uploads/2024/08/12/6506a036d0f55.webp",[46,3625,3627],{"className":974,"code":3626,"language":976,"meta":51,"style":51},"#!/bin/bash\n\n# Login webpage identify for China Mobile in Zhejiang University of Technology automatically\n# Author: zhullyb\n# Email: zhullyb@outlook.com\n\n\n# TODO: Fill Your Account and Password for 192.168.210.112/192.168.210.111 here\nuser_account=\nuser_password=\n\nif `ip route | grep -q 10.129.0.1`; then\n  gateway=10.129.0.1\nelif `ip route | grep -q 10.136.0.1`; then\n  gateway=10.136.0.1\nfi\n\nif whoami | grep -q \"admin\\|root\" && [ -n \"$gateway\" ]; then\n  route add -net 192.168.210.111 netmask 255.255.255.255 gw ${gateway}\n  route add -net 192.168.210.112 netmask 255.255.255.255 gw ${gateway}\n  route add -net 192.168.210.100 netmask 255.255.255.255 gw ${gateway}\n  route add -net 172.16.0.0 netmask 255.255.0.0 gw ${gateway}\nfi\n\n# 尝试访问内网服务器，如果未通过网页认证则会获得 url 跳转信息，用于判断用户为朝晖校区或屏峰校区，并获取用户 ip\ntest_curl=$(curl -s http://172.16.19.160)\nwlan_user_ip=$(echo ${test_curl} | grep -oE 'wlanuserip=[0-9\\.]+' | grep -oE '[0-9\\.]+')\nwlan_ac_ip=$(echo ${test_curl} | grep -oE 'wlanacip=[0-9\\.]+' | grep -oE '[0-9\\.]+')\nwlan_user_mac=$(echo ${test_curl} | grep -oE 'usermac=[[:xdigit:]-]+' | cut -d'=' -f2 | tr -d '-')\nwlan_ac_name=$(echo ${test_curl} | grep -o \"wlanacname=[^&]*\" | cut -d'=' -f2)\n\n# 朝晖校区宿舍楼内的移动宽带的认证请求\nif echo \"${test_curl}\" | grep -q \"192.168.210.112\"; then \\\ncurl \"http://192.168.210.112:801/eportal/portal/login?callback=dr1003&login_method=1&user_account=%2C0%2C${user_account}%40cmcczhyx&user_password=${user_password}&wlan_user_ip=${wlan_user_ip}&wlan_user_ipv6=&wlan_user_mac=${wlan_user_mac}&wlan_ac_ip=${wlan_ac_ip}&wlan_ac_name=${wlan_ac_name}&jsVersion=4.2.1&terminal_type=1&lang=zh-cn&v=5099&lang=zh\"\n# 屏峰校区宿舍楼内的移动宽带的认证请求\nelif echo \"${test_curl}\" | grep -q \"192.168.210.111\"; then \\\ncurl \"http://192.168.210.111:801/eportal/portal/login?callback=dr1003&login_method=1&user_account=%2C0%2C${user_account}%40cmccpfyx&user_password=${user_password}&wlan_user_ip=${wlan_user_ip}&wlan_user_ipv6=&wlan_user_mac=${wlan_user_mac}&wlan_ac_ip=${wlan_ac_ip}&wlan_ac_name=${wlan_ac_name}&jsVersion=4.2.1&terminal_type=1&lang=zh-cn&v=5099&lang=zh\"\nfi\n",[23,3628,3629,3634,3638,3643,3648,3653,3657,3661,3666,3674,3681,3685,3718,3728,3754,3763,3768,3772,3808,3840,3863,3886,3910,3914,3918,3923,3944,3983,4019,4070,4109,4113,4118,4154,4215,4220,4251,4307],{"__ignoreMap":51},[55,3630,3631],{"class":57,"line":58},[55,3632,3633],{"class":677},"#!/bin/bash\n",[55,3635,3636],{"class":57,"line":69},[55,3637,100],{"emptyLinePlaceholder":99},[55,3639,3640],{"class":57,"line":83},[55,3641,3642],{"class":677},"# Login webpage identify for China Mobile in Zhejiang University of Technology automatically\n",[55,3644,3645],{"class":57,"line":96},[55,3646,3647],{"class":677},"# Author: zhullyb\n",[55,3649,3650],{"class":57,"line":103},[55,3651,3652],{"class":677},"# Email: zhullyb@outlook.com\n",[55,3654,3655],{"class":57,"line":110},[55,3656,100],{"emptyLinePlaceholder":99},[55,3658,3659],{"class":57,"line":135},[55,3660,100],{"emptyLinePlaceholder":99},[55,3662,3663],{"class":57,"line":155},[55,3664,3665],{"class":677},"# TODO: Fill Your Account and Password for 192.168.210.112/192.168.210.111 here\n",[55,3667,3668,3671],{"class":57,"line":160},[55,3669,3670],{"class":2298},"user_account",[55,3672,3673],{"class":141},"=\n",[55,3675,3676,3679],{"class":57,"line":169},[55,3677,3678],{"class":2298},"user_password",[55,3680,3673],{"class":141},[55,3682,3683],{"class":57,"line":184},[55,3684,100],{"emptyLinePlaceholder":99},[55,3686,3687,3689,3692,3695,3698,3700,3703,3706,3709,3712,3715],{"class":57,"line":198},[55,3688,340],{"class":61},[55,3690,3691],{"class":145}," `",[55,3693,3694],{"class":106},"ip",[55,3696,3697],{"class":145}," route ",[55,3699,295],{"class":65},[55,3701,3702],{"class":106}," grep",[55,3704,3705],{"class":238}," -q",[55,3707,3708],{"class":238}," 10.129.0.1",[55,3710,3711],{"class":145},"`",[55,3713,3714],{"class":65},"; ",[55,3716,3717],{"class":61},"then\n",[55,3719,3720,3723,3725],{"class":57,"line":203},[55,3721,3722],{"class":2298},"  gateway",[55,3724,142],{"class":141},[55,3726,3727],{"class":145},"10.129.0.1\n",[55,3729,3730,3733,3735,3737,3739,3741,3743,3745,3748,3750,3752],{"class":57,"line":229},[55,3731,3732],{"class":61},"elif",[55,3734,3691],{"class":145},[55,3736,3694],{"class":106},[55,3738,3697],{"class":145},[55,3740,295],{"class":65},[55,3742,3702],{"class":106},[55,3744,3705],{"class":238},[55,3746,3747],{"class":238}," 10.136.0.1",[55,3749,3711],{"class":145},[55,3751,3714],{"class":65},[55,3753,3717],{"class":61},[55,3755,3756,3758,3760],{"class":57,"line":262},[55,3757,3722],{"class":2298},[55,3759,142],{"class":141},[55,3761,3762],{"class":145},"10.136.0.1\n",[55,3764,3765],{"class":57,"line":323},[55,3766,3767],{"class":61},"fi\n",[55,3769,3770],{"class":57,"line":329},[55,3771,100],{"emptyLinePlaceholder":99},[55,3773,3774,3776,3779,3782,3785,3787,3790,3793,3796,3798,3801,3803,3806],{"class":57,"line":497},[55,3775,340],{"class":61},[55,3777,3778],{"class":106}," whoami",[55,3780,3781],{"class":65}," | ",[55,3783,3784],{"class":106},"grep",[55,3786,3705],{"class":238},[55,3788,3789],{"class":145}," \"admin\\|root\"",[55,3791,3792],{"class":65}," && [ ",[55,3794,3795],{"class":141},"-n",[55,3797,211],{"class":145},[55,3799,3800],{"class":2298},"$gateway",[55,3802,217],{"class":145},[55,3804,3805],{"class":65}," ]; ",[55,3807,3717],{"class":61},[55,3809,3810,3813,3816,3819,3822,3825,3828,3831,3835,3838],{"class":57,"line":503},[55,3811,3812],{"class":106},"  route",[55,3814,3815],{"class":145}," add",[55,3817,3818],{"class":238}," -net",[55,3820,3821],{"class":238}," 192.168.210.111",[55,3823,3824],{"class":145}," netmask",[55,3826,3827],{"class":238}," 255.255.255.255",[55,3829,3830],{"class":145}," gw",[55,3832,3834],{"class":3833},"sr1Ac"," ${",[55,3836,3837],{"class":2298},"gateway",[55,3839,1426],{"class":3833},[55,3841,3842,3844,3846,3848,3851,3853,3855,3857,3859,3861],{"class":57,"line":509},[55,3843,3812],{"class":106},[55,3845,3815],{"class":145},[55,3847,3818],{"class":238},[55,3849,3850],{"class":238}," 192.168.210.112",[55,3852,3824],{"class":145},[55,3854,3827],{"class":238},[55,3856,3830],{"class":145},[55,3858,3834],{"class":3833},[55,3860,3837],{"class":2298},[55,3862,1426],{"class":3833},[55,3864,3865,3867,3869,3871,3874,3876,3878,3880,3882,3884],{"class":57,"line":515},[55,3866,3812],{"class":106},[55,3868,3815],{"class":145},[55,3870,3818],{"class":238},[55,3872,3873],{"class":238}," 192.168.210.100",[55,3875,3824],{"class":145},[55,3877,3827],{"class":238},[55,3879,3830],{"class":145},[55,3881,3834],{"class":3833},[55,3883,3837],{"class":2298},[55,3885,1426],{"class":3833},[55,3887,3888,3890,3892,3894,3897,3899,3902,3904,3906,3908],{"class":57,"line":521},[55,3889,3812],{"class":106},[55,3891,3815],{"class":145},[55,3893,3818],{"class":238},[55,3895,3896],{"class":238}," 172.16.0.0",[55,3898,3824],{"class":145},[55,3900,3901],{"class":238}," 255.255.0.0",[55,3903,3830],{"class":145},[55,3905,3834],{"class":3833},[55,3907,3837],{"class":2298},[55,3909,1426],{"class":3833},[55,3911,3912],{"class":57,"line":527},[55,3913,3767],{"class":61},[55,3915,3916],{"class":57,"line":2889},[55,3917,100],{"emptyLinePlaceholder":99},[55,3919,3920],{"class":57,"line":2905},[55,3921,3922],{"class":677},"# 尝试访问内网服务器，如果未通过网页认证则会获得 url 跳转信息，用于判断用户为朝晖校区或屏峰校区，并获取用户 ip\n",[55,3924,3925,3928,3930,3933,3936,3939,3942],{"class":57,"line":2916},[55,3926,3927],{"class":2298},"test_curl",[55,3929,142],{"class":141},[55,3931,3932],{"class":65},"$(",[55,3934,3935],{"class":106},"curl",[55,3937,3938],{"class":238}," -s",[55,3940,3941],{"class":145}," http://172.16.19.160",[55,3943,773],{"class":65},[55,3945,3946,3949,3951,3953,3956,3958,3960,3962,3964,3966,3969,3972,3974,3976,3978,3981],{"class":57,"line":2932},[55,3947,3948],{"class":2298},"wlan_user_ip",[55,3950,142],{"class":141},[55,3952,3932],{"class":65},[55,3954,3955],{"class":149},"echo",[55,3957,3834],{"class":3833},[55,3959,3927],{"class":2298},[55,3961,256],{"class":3833},[55,3963,3781],{"class":65},[55,3965,3784],{"class":106},[55,3967,3968],{"class":238}," -oE",[55,3970,3971],{"class":145}," 'wlanuserip=[0-9\\.]+'",[55,3973,3781],{"class":65},[55,3975,3784],{"class":106},[55,3977,3968],{"class":238},[55,3979,3980],{"class":145}," '[0-9\\.]+'",[55,3982,773],{"class":65},[55,3984,3985,3988,3990,3992,3994,3996,3998,4000,4002,4004,4006,4009,4011,4013,4015,4017],{"class":57,"line":2942},[55,3986,3987],{"class":2298},"wlan_ac_ip",[55,3989,142],{"class":141},[55,3991,3932],{"class":65},[55,3993,3955],{"class":149},[55,3995,3834],{"class":3833},[55,3997,3927],{"class":2298},[55,3999,256],{"class":3833},[55,4001,3781],{"class":65},[55,4003,3784],{"class":106},[55,4005,3968],{"class":238},[55,4007,4008],{"class":145}," 'wlanacip=[0-9\\.]+'",[55,4010,3781],{"class":65},[55,4012,3784],{"class":106},[55,4014,3968],{"class":238},[55,4016,3980],{"class":145},[55,4018,773],{"class":65},[55,4020,4021,4024,4026,4028,4030,4032,4034,4036,4038,4040,4042,4045,4047,4050,4053,4056,4059,4061,4063,4065,4068],{"class":57,"line":2957},[55,4022,4023],{"class":2298},"wlan_user_mac",[55,4025,142],{"class":141},[55,4027,3932],{"class":65},[55,4029,3955],{"class":149},[55,4031,3834],{"class":3833},[55,4033,3927],{"class":2298},[55,4035,256],{"class":3833},[55,4037,3781],{"class":65},[55,4039,3784],{"class":106},[55,4041,3968],{"class":238},[55,4043,4044],{"class":145}," 'usermac=[[:xdigit:]-]+'",[55,4046,3781],{"class":65},[55,4048,4049],{"class":106},"cut",[55,4051,4052],{"class":238}," -d",[55,4054,4055],{"class":145},"'='",[55,4057,4058],{"class":238}," -f2",[55,4060,3781],{"class":65},[55,4062,1181],{"class":106},[55,4064,4052],{"class":238},[55,4066,4067],{"class":145}," '-'",[55,4069,773],{"class":65},[55,4071,4072,4075,4077,4079,4081,4083,4085,4087,4089,4091,4094,4097,4099,4101,4103,4105,4107],{"class":57,"line":2966},[55,4073,4074],{"class":2298},"wlan_ac_name",[55,4076,142],{"class":141},[55,4078,3932],{"class":65},[55,4080,3955],{"class":149},[55,4082,3834],{"class":3833},[55,4084,3927],{"class":2298},[55,4086,256],{"class":3833},[55,4088,3781],{"class":65},[55,4090,3784],{"class":106},[55,4092,4093],{"class":238}," -o",[55,4095,4096],{"class":145}," \"wlanacname=[^&]*\"",[55,4098,3781],{"class":65},[55,4100,4049],{"class":106},[55,4102,4052],{"class":238},[55,4104,4055],{"class":145},[55,4106,4058],{"class":238},[55,4108,773],{"class":65},[55,4110,4111],{"class":57,"line":2972},[55,4112,100],{"emptyLinePlaceholder":99},[55,4114,4115],{"class":57,"line":2992},[55,4116,4117],{"class":677},"# 朝晖校区宿舍楼内的移动宽带的认证请求\n",[55,4119,4120,4122,4125,4127,4131,4133,4135,4137,4139,4141,4143,4146,4148,4151],{"class":57,"line":2997},[55,4121,340],{"class":61},[55,4123,4124],{"class":149}," echo",[55,4126,211],{"class":145},[55,4128,4130],{"class":4129},"sTIpt","${",[55,4132,3927],{"class":2298},[55,4134,256],{"class":4129},[55,4136,217],{"class":145},[55,4138,3781],{"class":65},[55,4140,3784],{"class":106},[55,4142,3705],{"class":238},[55,4144,4145],{"class":145}," \"192.168.210.112\"",[55,4147,3714],{"class":65},[55,4149,4150],{"class":61},"then",[55,4152,4153],{"class":149}," \\\n",[55,4155,4156,4158,4161,4163,4165,4167,4170,4172,4174,4176,4179,4181,4183,4185,4188,4190,4192,4194,4197,4199,4201,4203,4206,4208,4210,4212],{"class":57,"line":3030},[55,4157,3935],{"class":106},[55,4159,4160],{"class":145}," \"http://192.168.210.112:801/eportal/portal/login?callback=dr1003&login_method=1&user_account=%2C0%2C",[55,4162,4130],{"class":4129},[55,4164,3670],{"class":2298},[55,4166,256],{"class":4129},[55,4168,4169],{"class":145},"%40cmcczhyx&user_password=",[55,4171,4130],{"class":4129},[55,4173,3678],{"class":2298},[55,4175,256],{"class":4129},[55,4177,4178],{"class":145},"&wlan_user_ip=",[55,4180,4130],{"class":4129},[55,4182,3948],{"class":2298},[55,4184,256],{"class":4129},[55,4186,4187],{"class":145},"&wlan_user_ipv6=&wlan_user_mac=",[55,4189,4130],{"class":4129},[55,4191,4023],{"class":2298},[55,4193,256],{"class":4129},[55,4195,4196],{"class":145},"&wlan_ac_ip=",[55,4198,4130],{"class":4129},[55,4200,3987],{"class":2298},[55,4202,256],{"class":4129},[55,4204,4205],{"class":145},"&wlan_ac_name=",[55,4207,4130],{"class":4129},[55,4209,4074],{"class":2298},[55,4211,256],{"class":4129},[55,4213,4214],{"class":145},"&jsVersion=4.2.1&terminal_type=1&lang=zh-cn&v=5099&lang=zh\"\n",[55,4216,4217],{"class":57,"line":3041},[55,4218,4219],{"class":677},"# 屏峰校区宿舍楼内的移动宽带的认证请求\n",[55,4221,4222,4224,4226,4228,4230,4232,4234,4236,4238,4240,4242,4245,4247,4249],{"class":57,"line":3055},[55,4223,3732],{"class":61},[55,4225,4124],{"class":149},[55,4227,211],{"class":145},[55,4229,4130],{"class":4129},[55,4231,3927],{"class":2298},[55,4233,256],{"class":4129},[55,4235,217],{"class":145},[55,4237,3781],{"class":65},[55,4239,3784],{"class":106},[55,4241,3705],{"class":238},[55,4243,4244],{"class":145}," \"192.168.210.111\"",[55,4246,3714],{"class":65},[55,4248,4150],{"class":61},[55,4250,4153],{"class":149},[55,4252,4253,4255,4258,4260,4262,4264,4267,4269,4271,4273,4275,4277,4279,4281,4283,4285,4287,4289,4291,4293,4295,4297,4299,4301,4303,4305],{"class":57,"line":3064},[55,4254,3935],{"class":106},[55,4256,4257],{"class":145}," \"http://192.168.210.111:801/eportal/portal/login?callback=dr1003&login_method=1&user_account=%2C0%2C",[55,4259,4130],{"class":4129},[55,4261,3670],{"class":2298},[55,4263,256],{"class":4129},[55,4265,4266],{"class":145},"%40cmccpfyx&user_password=",[55,4268,4130],{"class":4129},[55,4270,3678],{"class":2298},[55,4272,256],{"class":4129},[55,4274,4178],{"class":145},[55,4276,4130],{"class":4129},[55,4278,3948],{"class":2298},[55,4280,256],{"class":4129},[55,4282,4187],{"class":145},[55,4284,4130],{"class":4129},[55,4286,4023],{"class":2298},[55,4288,256],{"class":4129},[55,4290,4196],{"class":145},[55,4292,4130],{"class":4129},[55,4294,3987],{"class":2298},[55,4296,256],{"class":4129},[55,4298,4205],{"class":145},[55,4300,4130],{"class":4129},[55,4302,4074],{"class":2298},[55,4304,256],{"class":4129},[55,4306,4214],{"class":145},[55,4308,4309],{"class":57,"line":3085},[55,4310,3767],{"class":61},[19,4312,4313],{},"在 Padavan 的设置界面中，我们去打开 ssh 服务",[19,4315,4316],{},[1132,4317],{"alt":4318,"src":4319},"打开 ssh 服务","https://static.031130.xyz/uploads/2024/08/12/6496afd695464.webp",[19,4321,4322,4323,4326],{},"在自己的电脑上通过 ssh 连接到路由器的终端 ",[23,4324,4325],{},"ssh admin@192.168.123.1","，默认密码也是 admin，就和进入 Padavan 后台的默认管理密码一样。",[19,4328,4329],{},[1132,4330],{"alt":4331,"src":4332},"进入路由器终端","https://static.031130.xyz/uploads/2024/08/12/6496b029dfe3f.webp",[19,4334,4335],{},"看了一下 Padavan 并没有自带 nano 这个方便的 tui 编辑器，只好用自带的 vi 将就一下将认证代码复制到路由器中。",[46,4337,4339],{"className":974,"code":4338,"language":976,"meta":51,"style":51},"vi /etc/storage/login_edu.sh\n",[23,4340,4341],{"__ignoreMap":51},[55,4342,4343,4346],{"class":57,"line":58},[55,4344,4345],{"class":106},"vi",[55,4347,4348],{"class":145}," /etc/storage/login_edu.sh\n",[19,4350,4351],{},"关于 vi 的使用方法我在这里也不展开讲，我个人也不熟悉这款编辑器。",[19,4353,4354],{},"将脚本复制进去后，记得输入自己网页认证的账号密码，然后保存离开，给这个脚本赋予 x 权限。",[46,4356,4358],{"className":974,"code":4357,"language":976,"meta":51,"style":51},"chmod a+x /etc/storage/login_edu.sh\n",[23,4359,4360],{"__ignoreMap":51},[55,4361,4362,4365,4368],{"class":57,"line":58},[55,4363,4364],{"class":106},"chmod",[55,4366,4367],{"class":145}," a+x",[55,4369,4348],{"class":145},[19,4371,4372],{},[1132,4373],{"alt":4374,"src":4375},"保存认证脚本","https://static.031130.xyz/uploads/2024/08/12/6496b11b7c541.webp",[19,4377,4378,4379,4382],{},"随后运行 ",[23,4380,4381],{},"crontab -e"," ，设置运行脚本为每天早上 6 点 01 分执行一次（因为工作日凌晨 00:30 断网，早上网络恢复以后有可能会要求你通过网页认证后才能再次联网）",[19,4384,4385],{},[23,4386,4387],{},"1 6 * * * /etc/storage/login_edu.sh",[19,4389,4390],{},[1132,4391],{"alt":4392,"src":4393},"设置 crontab","https://static.031130.xyz/uploads/2024/08/12/6496b1132f497.webp",[19,4395,4396],{},"随后来到路由器的设置界面，设置「在 WAN 上行/下行启动后执行」和「在防火墙规则启动后执行」这两个地方分别调用我们的网页认证脚本，防止因停电、网线接口松动等故障恢复后依然没法联网的问题。图中的 logger 命令是给我自己排错看的，不需要设置。",[19,4398,4399],{},[1132,4400],{"alt":4401,"src":4402},"脚本设置界面","https://static.031130.xyz/uploads/2024/08/12/6496b36585000.webp",[19,4404,4405],{},[1132,4406],{"alt":4407,"src":4408},"WAN上下行","https://static.031130.xyz/uploads/2024/08/12/6496b369bbd70.webp",[19,4410,4411],{},[1132,4412],{"alt":4413,"src":4414},"防火墙规则","https://static.031130.xyz/uploads/2024/08/12/6496b3703197f.webp",[381,4416,4417],{},"html pre.shiki code .sW2Sy, html code.shiki .sW2Sy{--shiki-default:#A0A1A7;--shiki-default-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic}html pre.shiki code .sJa8x, html code.shiki .sJa8x{--shiki-default:#E45649;--shiki-dark:#E06C75}html pre.shiki code .sknuh, html code.shiki .sknuh{--shiki-default:#383A42;--shiki-dark:#56B6C2}html pre.shiki code .sLKXg, html code.shiki .sLKXg{--shiki-default:#A626A4;--shiki-dark:#C678DD}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html pre.shiki code .sr1Ac, html code.shiki .sr1Ac{--shiki-default:#E45649;--shiki-dark:#ABB2BF}html pre.shiki code .s_Sar, html code.shiki .s_Sar{--shiki-default:#0184BC;--shiki-dark:#56B6C2}html pre.shiki code .sTIpt, html code.shiki .sTIpt{--shiki-default:#E45649;--shiki-dark:#98C379}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}",{"title":51,"searchDepth":69,"depth":69,"links":4419},[4420,4421],{"id":3576,"depth":69,"text":3577},{"id":3601,"depth":69,"text":3601},{"title":4423,"date":4424,"path":4425,"tags":4426,"body":4427},"为红米 Redmi AC2100 路由器刷入 Padavan","2023-06-24 00:22:53","/2023/06/24/redmi-ac2100-router-with-padavan",[3479,823],{"type":16,"value":4428,"toc":4753},[4429,4434,4437,4440,4443,4446,4449,4455,4458,4463,4466,4471,4474,4479,4482,4488,4492,4495,4506,4509,4518,4525,4531,4534,4540,4546,4552,4555,4561,4564,4586,4592,4596,4599,4606,4612,4623,4629,4632,4638,4644,4651,4657,4660,4666,4670,4673,4680,4686,4689,4695,4698,4704,4707,4710,4716,4719,4724,4750],[43,4430,4431],{},[19,4432,4433],{},"大一一年转眼就要过去了，最近要搬校区了，顺手就把之前刷过的「小米路由器4A千兆版」出手给了同学，自己反手入了一个 「Redmi AC 2100」，尽管是跟着教程走，但过程中依然是遇见了不少坑，因此就开一篇博客记录了一下。",[847,4435,4436],{"id":4436},"重置路由器",[19,4438,4439],{},"这一步其实可有可无，只是我从闲鱼上入手这个路由器，买家并没有告知我密码，于是我只能手动 RESET 这个路由器来进入后台。",[847,4441,4442],{"id":4442},"通过网络设置引导",[19,4444,4445],{},"原本就是连上路由器后简单地通过引导界面，但由于我没有一个正常的网络环境，所以这一步走的其实也是有点困难的，我还是稍微记一下。",[19,4447,4448],{},"首先浏览器地址栏输入 192.168.31.1 (小米家的路由器默认好像都是这个 ip 地址)，看到下图界面，加不加入用户改善计划其实都是无所谓的，反正马上就要刷掉这个系统了。",[19,4450,4451],{},[1132,4452],{"alt":4453,"src":4454},"路由器设置引导界面","https://static.031130.xyz/uploads/2024/08/12/6495c9a227d2c.webp",[19,4456,4457],{},"此处选择「不插网线，继续配置」，因为我们没有标准的网络环境，还指望着这台路由器跑 l2tp 帮我们连校园网呢。",[19,4459,4460],{},[1132,4461],{"alt":4453,"src":4462},"https://static.031130.xyz/uploads/2024/08/12/6495ca724bf14.webp",[19,4464,4465],{},"这里需要选择「自动获取IP」（静态 IP）好像也行，但别的选项在我的网络环境下恐怕都是没法继续配置下去的。",[19,4467,4468],{},[1132,4469],{"alt":4453,"src":4470},"https://static.031130.xyz/uploads/2024/08/12/6495cae48566d.webp",[19,4472,4473],{},"随后随手输个 WIFI 名称和密码，主要是记住密码进路由器后台管理。",[19,4475,4476],{},[1132,4477],{"alt":4453,"src":4478},"https://static.031130.xyz/uploads/2024/08/12/6495cb8eba4b5.webp",[19,4480,4481],{},"设置完上述设置项以后，再次进入 192.168.31.1 ，就能看见路由器后台管理的登陆页面了。",[19,4483,4484],{},[1132,4485],{"alt":4486,"src":4487},"路由器后台管理首页","https://static.031130.xyz/uploads/2024/08/12/6495cc2ff1e02.webp",[847,4489,4491],{"id":4490},"获取-ssh-权限","获取 ssh 权限",[19,4493,4494],{},"输入登陆密码，进入路由器后台管理页面，我们需要通过 bug 去获取打开官方系统的 ssh 功能",[43,4496,4497],{},[19,4498,4499,4500,4505],{},"这里提一嘴，当初我刷小米路由器4A千兆版的时候用的是",[37,4501,4504],{"href":4502,"rel":4503},"https://github.com/acecilia/OpenWRTInvasion/",[41],"这个仓库","来打开 ssh。",[19,4507,4508],{},"首先是确认路由器的版本，我从闲鱼上购得的路由器自带的版本是官方稳定版 2.0.23，一开始跟着别人的思路就降级到了 2.0.7，但后来遇见问题在网上查解决方案的时候看到有人说这个漏洞在 2.0.23 依然可用，但我也没有去试。",[19,4510,4511,4512,4517],{},"在电脑上下载 2.0.7 的",[37,4513,4516],{"href":4514,"rel":4515},"https://cdn.cnbj1.fds.api.mi-img.com/xiaoqiang/rom/rm2100/miwifi_rm2100_firmware_d6234_2.0.7.bin",[41],"升级包","，在路由器设置界面的常用设置->系统状态->手动升级 选择自己下载的升级包，确认等待重启即可。有些教程说可以选择保留数据，但我也懒得试，就直接清除了所有数据，又不得不再次过一遍上面的配置引导。",[19,4519,4520,4521,4524],{},"在地址栏，删除 ",[23,4522,4523],{},"/web/home#router"," 部分，加入下面这串代码",[46,4526,4529],{"className":4527,"code":4528,"language":2083},[2081],"/api/misystem/set_config_iotdev?bssid=Xiaomi&user_id=longdike&ssid=-h%3B%20nvram%20set%20ssh_en%3D1%3B%20nvram%20commit%3B%20sed%20-i%20's%2Fchannel%3D.*%2Fchannel%3D%5C%22debug%5C%22%2Fg'%20%2Fetc%2Finit.d%2Fdropbear%3B%20%2Fetc%2Finit.d%2Fdropbear%20start%3B\n",[23,4530,4528],{"__ignoreMap":51},[19,4532,4533],{},"再次删除后面的代码，加入下面这串代码",[46,4535,4538],{"className":4536,"code":4537,"language":2083},[2081],"/api/misystem/set_config_iotdev?bssid=Xiaomi&user_id=longdike&ssid=-h%3B%20echo%20-e%20'admin%5Cnadmin'%20%7C%20passwd%20root%3B\n",[23,4539,4537],{"__ignoreMap":51},[19,4541,4542],{},[1132,4543],{"alt":4544,"src":4545},"需要被去除的 url 部分","https://static.031130.xyz/uploads/2024/08/12/6495ce20b91d1.webp",[19,4547,4548],{},[1132,4549],{"alt":4550,"src":4551},"被截剩的 url 部分","https://static.031130.xyz/uploads/2024/08/12/6495ce1de2acd.webp",[19,4553,4554],{},"两次请求的正常反馈应该长成下面这个样子。",[19,4556,4557],{},[1132,4558],{"alt":4559,"src":4560},"正常反馈","https://static.031130.xyz/uploads/2024/08/12/6495ce8d86b03.webp",[19,4562,4563],{},"此时应该就可以使用 ssh 访问路由器的 root 账户了，密码已经被改为了 admin",[46,4565,4567],{"className":974,"code":4566,"language":976,"meta":51,"style":51},"ssh -o HostKeyAlgorithms=+ssh-rsa -o PubkeyAcceptedKeyTypes=+ssh-rsa root@192.168.31.1\n",[23,4568,4569],{"__ignoreMap":51},[55,4570,4571,4573,4575,4578,4580,4583],{"class":57,"line":58},[55,4572,983],{"class":106},[55,4574,4093],{"class":238},[55,4576,4577],{"class":145}," HostKeyAlgorithms=+ssh-rsa",[55,4579,4093],{"class":238},[55,4581,4582],{"class":145}," PubkeyAcceptedKeyTypes=+ssh-rsa",[55,4584,4585],{"class":145}," root@192.168.31.1\n",[19,4587,4588],{},[1132,4589],{"alt":4590,"src":4591},"登陆成功","https://static.031130.xyz/uploads/2024/08/12/6495cf0b224c4.webp",[847,4593,4595],{"id":4594},"刷入-breed","刷入 breed",[19,4597,4598],{},"如果用我在安卓刷机的经验来讲 breed 是什么的话，我会把他类比成第三方 Recovery (TWRP)。这是一个能够帮助你去输入系统、备份系统的恢复模式。虽然我们可以直接刷入 padavan，但如果系统没有自带镜像刷写工具或者输入的系统打不开了，那可能就是一台路由器的报废，或许得靠编程器才能救回来。",[19,4600,4601,4602],{},"首先，我们到 breed 下载站上下载 breed 的镜像: ",[37,4603,4604],{"href":4604,"rel":4605},"https://breed.hackpascal.net/",[41],[19,4607,4608],{},[1132,4609],{"alt":4610,"src":4611},"需要下载的 breed 镜像","https://static.031130.xyz/uploads/2024/08/12/6495cf9ca81de.webp",[19,4613,4614,4615,4618,4619,4622],{},"随后，在电脑上这个存放了 breed 镜像的路径上开一个 http server，我这里选择的是 ",[23,4616,4617],{},"darkhttpd","，Windows 或者 MacOS 用户可以选择使用 ",[23,4620,4621],{},"miniserve","，他们呢起的是一样的效果，甚至可以使用 python 直接开一个 local server。",[19,4624,4625],{},[1132,4626],{"alt":4627,"src":4628},"本地 http 服务","https://static.031130.xyz/uploads/2024/08/12/6495d0bd79f4c.webp",[19,4630,4631],{},"接下来，通过自己电脑在路由器局域网内的那个 ip 地址并添加端口号在浏览器上访问你开的 http server，直接右键复制 breed 镜像的下载链接。",[19,4633,4634],{},[1132,4635],{"alt":4636,"src":4637},"查看本机 ip","https://static.031130.xyz/uploads/2024/08/12/6495d0bd79f4d.webp",[19,4639,4640],{},[1132,4641],{"alt":4642,"src":4643},"复制下载链接","https://static.031130.xyz/uploads/2024/08/12/6495d10b09fe0.webp",[19,4645,4646,4647,4650],{},"将 ssh 连接到的路由器终端 cd 到 /tmp 路径下，使用 wget 命令去下载你刚刚复制到的 url，这样我们就简单地将 breed 镜像传输到了路由器的内存上。再使用 ",[23,4648,4649],{},"mtd -r write breed-mt7621-xiaomi-r3g.bin Bootloader"," 刷入 breed，刷入成功后 ssh 将会自动断开连接，但并不会直接进入 breed。",[19,4652,4653],{},[1132,4654],{"alt":4655,"src":4656},"Screenshot_20230623_203903.png","https://static.031130.xyz/uploads/2024/08/12/6495d17602f3a.webp",[19,4658,4659],{},"我们需要先断开路由器的电源，使用一根针（比如取卡针）怼在 RESET 按钮上面，再次接通路由器的电源并持续按压 RESET 按钮几秒钟，浏览器这时就会进入 breed 状态，浏览器访问 192.168.1.1 就可以看到他的控制面板。",[19,4661,4662],{},[1132,4663],{"alt":4664,"src":4665},"Breed Web 界面","https://static.031130.xyz/uploads/2024/08/12/6495d2129a764.webp",[847,4667,4669],{"id":4668},"刷入-padavan","刷入 Padavan",[19,4671,4672],{},"在 Breed 中拥有很多的功能，不过我们用到的只是「固件更新」这一个功能，备份功能什么的可以自己尝试，这只是一个可选项。",[19,4674,4675,4676],{},"首先去下载站下载适配 Redmi AC2100 的 Padavan 镜像: ",[37,4677,4678],{"href":4678,"rel":4679},"https://opt.cn2qq.com/padavan/",[41],[19,4681,4682],{},[1132,4683],{"alt":4684,"src":4685},"适配 Redmi AC2100 的 Padavan 镜像","https://static.031130.xyz/uploads/2024/08/12/6495d5cbbb5b9.webp",[19,4687,4688],{},"然后在 Breed 的 web 端控制台直接选择 Padavan 的系统镜像进行固件更新",[19,4690,4691],{},[1132,4692],{"alt":4693,"src":4694},"固件更新界面","https://static.031130.xyz/uploads/2024/08/12/6495d63261ad4.webp",[19,4696,4697],{},"确认后直接刷入",[19,4699,4700],{},[1132,4701],{"alt":4702,"src":4703},"固件刷入中","https://static.031130.xyz/uploads/2024/08/12/6495d64fd1e0e.webp",[19,4705,4706],{},"自动重启后，Padavan 就刷入完成了。",[19,4708,4709],{},"Padavan 的默认 WIFI 名是 PDCN 和 PDCN_5G，WIFI 密码是 1234567890",[19,4711,4712],{},[1132,4713],{"alt":4714,"src":4715},"Padavan 的默认 WIFI","https://static.031130.xyz/uploads/2024/08/12/6495d6c11aa01.webp",[19,4717,4718],{},"浏览器输入 192.168.123.1 就可以进入默认的后台管理页面，管理页面的用户名和密码都是 admin",[19,4720,4721],{},[1132,4722],{"alt":4723,"src":3558},"Padavan 设置界面",[43,4725,4726,4729,4736,4743],{},[19,4727,4728],{},"参考文章:",[19,4730,4731],{},[37,4732,4735],{"href":4733,"rel":4734},"https://www.bilibili.com/read/cv18237601/",[41],"《小米/红米AC2100刷OpenWrt/Padavan/第三方固件的详细教程（2022年8月23日更新）》",[19,4737,4738],{},[37,4739,4742],{"href":4740,"rel":4741},"https://zhuanlan.zhihu.com/p/260531160",[41],"《小米、红米 AC2100 一键开启 SSH，可自定义安装各种插件》",[19,4744,4745],{},[37,4746,4749],{"href":4747,"rel":4748},"https://blog.alanwei.com/blog/2022/01/24/ssh-no-matching-host-key-type-found/",[41],"《解决SSH no matching host key type found 问题》",[381,4751,4752],{},"html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}",{"title":51,"searchDepth":69,"depth":69,"links":4754},[4755,4756,4757,4758,4759],{"id":4436,"depth":69,"text":4436},{"id":4442,"depth":69,"text":4442},{"id":4490,"depth":69,"text":4491},{"id":4594,"depth":69,"text":4595},{"id":4668,"depth":69,"text":4669},{"title":4761,"date":4762,"path":4763,"tags":4764,"body":4766},"Azure 教育订阅申请时遇到的麻烦","2023-05-12 23:38:29","/2023/05/12/troubles-when-applying-azure-education",[4765],"Azure",{"type":16,"value":4767,"toc":4854},[4768,4775,4788,4794,4797,4803,4806,4809,4815,4827,4830,4836,4839,4845,4848],[19,4769,4770,4771,4774],{},"进入大学已经快一年了，但我的 Azure 教育订阅申请一直没有成功，每年有 100 刀的额度，",[896,4772,4773],{},"再这样下去就要亏掉近 700 元了","，于是便打算趁期中考试刚结束的闲暇时间把 Azure 的教育订阅给过了。",[19,4776,4777,4778,4782,4783,4787],{},"我拥有 *.edu.cn 的邮箱，并且通过了 Github Student Pack 的认证，但每次在 ",[37,4779,4780],{"href":4780,"rel":4781},"https://signup.azure.com/studentverification?offerType=1",[41]," 页面尝试申请 Azure 订阅时，总是会得到一句冷冷的「你没有资格使用 Azure 免费帐户」。于是，我找到了 Azure 订阅支持客服帮忙，链接是这个: ",[37,4784,4785],{"href":4785,"rel":4786},"https://azureforeducation.microsoft.com/en-us/institutions/Contact",[41],"，简要填写了我的基本信息后就开始等待邮件回复了。",[19,4789,4790],{},[1132,4791],{"alt":4792,"src":4793},"提交工单","https://static.031130.xyz/uploads/2024/08/12/645e646bc5b58.webp",[19,4795,4796],{},"我是周四上午申请的，不到一个小时就等来了微软的工单生成通知",[19,4798,4799],{},[1132,4800],{"alt":4801,"src":4802},"微软的工单通知","https://static.031130.xyz/uploads/2024/08/12/645e5fdfb25a3.webp",[19,4804,4805],{},"但光有这工单也没有用，我只能继续等人工客服的介入。",[19,4807,4808],{},"在周五的早上十点，我收到了来自人工客服的邮件，并且在几分钟后收到了来自人工客服的电话（电话是 021 开头的，是归属地为上海的座机打来的，但客服操着严重的港台口音，可能是港台那边的客服通过上海的座机中转打给我的？）:",[19,4810,4811],{},[1132,4812],{"alt":4813,"src":4814},"人工客服的邮件","https://static.031130.xyz/uploads/2024/08/12/645e60ad79001.webp",[19,4816,4817,4818,4821,4822,4826],{},"但很显然，这封邮件并没有提供任何行之有效的方案，我只能按照邮件中的指示将我的截图发了过去。不过客服不知道出于什么原因一定要求全屏截图（如果电话说的是全面屏，那也是指 PC 端的全屏截图），可能是他们有什么工作制度吧。回复邮件的时候一定要选择",[3485,4819,4820],{},"回复全部","，好像是他们只使用 ",[37,4823,4825],{"href":4824},"mailto:support@mail.support.microsoft.com","support@mail.support.microsoft.com"," 这一个邮箱与我们通信，微软的服务器收到内容后会将我们发送的内容再抄送给给我们分配的客服手上，如果不选择「回复全部」的话，客服可能就看不到之前的通信记录了。",[19,4828,4829],{},"于是就在当天下午的2点收到了人工客服的第二封邮件，说是已经帮我提交到了后台处理。",[19,4831,4832],{},[1132,4833],{"alt":4834,"src":4835},"来自人工客服的第二封邮件","https://static.031130.xyz/uploads/2024/08/12/645e62bae0c0a.webp",[19,4837,4838],{},"20 分钟后，我收到了这封应该是系统自动发送的邮件，说明我的账号因异常而触发了审查所以过不了 Azure 的教育订阅，需要我提交能够佐证我的学生身份的东西上去，当晚7点我便按照要求回信。",[19,4840,4841],{},[1132,4842],{"alt":4843,"src":4844},"1683907484369.png","https://static.031130.xyz/uploads/2024/08/12/645e639e2c9d1.webp",[19,4846,4847],{},"当晚8点半，我便收到了来自系统的消息，得知异常已经解除，再次申请 Azure 学生认证就成功了。",[19,4849,4850],{},[1132,4851],{"alt":4852,"src":4853},"异常解除","https://static.031130.xyz/uploads/2024/08/12/645e63e39523f.webp",{"title":51,"searchDepth":69,"depth":69,"links":4855},[],{"title":4857,"date":4858,"path":4859,"tags":4860,"body":4862},"执行 repo sync 后将 git-lfs 中的资源文件 checkout","2023-05-03 01:15:35","/2023/05/03/checkout-lfs-file-after-repo-sync",[4861],"Notes",{"type":16,"value":4863,"toc":4941},[4864,4869,4884,4901,4909,4919,4938],[43,4865,4866],{},[19,4867,4868],{},"最近期中考试挺忙的，五一好不容易有一些自己的时间，于是打算重操旧业，搞点有意思的内容，没想到准备阶段就出了新问题，有点跟不上时代了",[19,4870,4871,4872,4875,4876,4879,4880,4883],{},"本次遇到的问题是在执行 ",[23,4873,4874],{},"repo sync"," 命令后储存在 git-lfs 中的文件没有被自动 pull 并 checkout 出来，尽管我在 ",[23,4877,4878],{},"repo init"," 阶段已经加了 ",[23,4881,4882],{},"--git-lfs"," 参数了。",[19,4885,4886,4887,4892,4893,4896,4897,4900],{},"上 google 简单查了查，查到一篇 ",[37,4888,4891],{"href":4889,"rel":4890},"https://stackoverflow.com/questions/67280310/how-to-run-git-lfs-automatically-after-repo-sync",[41],"stackoverflow"," 的回答，给出的思路是使用 ",[23,4894,4895],{},"repo forall -c 'git lfs pull'"," 的方案解决的，意思是在 repo 同步的每一个 git 仓库中都自动执行 ",[23,4898,4899],{},"git lfs pull"," 命令，但这个解决方案在我这有两个问题。",[855,4902,4903,4906],{},[858,4904,4905],{},"仓库的 git-lfs 没有被安装，所以 git-lfs 会直接报错",[858,4907,4908],{},"将整个安装源码一千多个仓库一一执行这些命令的速度太慢了",[19,4910,4911,4912,4915,4916],{},"解决方案也很简单，直接检测每个 git 仓库下是否存在 ",[23,4913,4914],{},".lfsconfg"," 文件，存在的话就执行 ",[23,4917,4918],{},"git lfs install && git lfs pull",[46,4920,4922],{"className":974,"code":4921,"language":976,"meta":51,"style":51},"repo forall -c 'test -e .lfsconfig && git lfs install && git lfs pull'\n",[23,4923,4924],{"__ignoreMap":51},[55,4925,4926,4929,4932,4935],{"class":57,"line":58},[55,4927,4928],{"class":106},"repo",[55,4930,4931],{"class":145}," forall",[55,4933,4934],{"class":238}," -c",[55,4936,4937],{"class":145}," 'test -e .lfsconfig && git lfs install && git lfs pull'\n",[381,4939,4940],{},"html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}",{"title":51,"searchDepth":69,"depth":69,"links":4942},[],{"title":4944,"date":4945,"path":4946,"tags":4947,"body":4948},"隐式转发——骚套路建站方案","2023-03-26 00:10:02","/2023/03/26/implicit-forwarding-is-a-new-site-deploying-method",[823],{"type":16,"value":4949,"toc":5184},[4950,4953,4959,4962,4970,4989,4992,5078,5081,5087,5094,5099,5102,5109,5114,5118,5121,5124,5138,5141,5159,5161,5181],[19,4951,4952],{},"其实很久以前就接触到了国内 DNS 解析服务商提供的这个「隐式 URL」 这种 “DNS 记录类型”了，但我域名没有备案，一直没有机会去体验。",[19,4954,4955],{},[1132,4956],{"alt":4957,"src":4958},"DNSPOD 的解析面板中提供的记录类型","https://static.031130.xyz/uploads/2024/08/12/641f1e2cd8809.webp",[19,4960,4961],{},"今天社团内某个同学在折腾自己博客的时候又用到了「隐式 URL」，于是就借此机会了解了一下相关内容。",[19,4963,4964,4969],{},[37,4965,4968],{"href":4966,"rel":4967},"https://docs.dnspod.cn/dns/help-redirect-url/",[41],"DNSPOD 文档的描述","如下",[43,4971,4972],{},[19,4973,4974,4977,4978,4981,4982,4985,4986,4988],{},[3485,4975,4976],{},"隐性转发","：用的是 iframe 框架技术、非重定向技术，效果为浏览器地址栏输入 ",[23,4979,4980],{},"http://www.dnspod.cn"," 回车，打开网站内容是目标地址 ",[23,4983,4984],{},"http://cloud.tencent.com/"," 的网站内容，但地址栏显示当前地址 ",[23,4987,4980],{}," 。",[19,4990,4991],{},"也就是说，所谓「隐式 URL」，只不过是域名解析的服务商用他们的服务器去响应了访客的请求，并回应了一段使用了 iframe 的 html 。这段代码打开了一个大小为 100% 的窗口去请求了被“隐式代理”的站点。我这位同学域名是备案在阿里云下的，阿里云所使用的 html 代码如下:",[46,4993,4997],{"className":4994,"code":4995,"language":4996,"meta":51,"style":51},"language-html shiki shiki-themes one-light one-dark-pro","\u003C!doctype html>\u003Chtml>\u003Cframeset rows=\"100%\">\u003Cframe src=\"http://example.com\">\u003Cnoframes>\u003Ca href=\"http://example.com\">Click here\u003C/a>\u003C/noframes>\u003C/frameset>\u003C/html>\n","html",[23,4998,4999],{"__ignoreMap":51},[55,5000,5001,5004,5007,5010,5013,5015,5017,5021,5024,5026,5029,5031,5034,5037,5039,5042,5044,5047,5049,5051,5054,5056,5058,5061,5063,5066,5068,5070,5072,5074,5076],{"class":57,"line":58},[55,5002,5003],{"class":65},"\u003C!",[55,5005,5006],{"class":2298},"doctype",[55,5008,5009],{"class":238}," html",[55,5011,5012],{"class":65},">\u003C",[55,5014,4996],{"class":2298},[55,5016,5012],{"class":65},[55,5018,5020],{"class":5019},"s-dj3","frameset",[55,5022,5023],{"class":238}," rows",[55,5025,142],{"class":65},[55,5027,5028],{"class":145},"\"100%\"",[55,5030,5012],{"class":65},[55,5032,5033],{"class":5019},"frame",[55,5035,5036],{"class":238}," src",[55,5038,142],{"class":65},[55,5040,5041],{"class":145},"\"http://example.com\"",[55,5043,5012],{"class":65},[55,5045,5046],{"class":5019},"noframes",[55,5048,5012],{"class":65},[55,5050,37],{"class":2298},[55,5052,5053],{"class":238}," href",[55,5055,142],{"class":65},[55,5057,5041],{"class":145},[55,5059,5060],{"class":65},">Click here\u003C/",[55,5062,37],{"class":2298},[55,5064,5065],{"class":65},">\u003C/",[55,5067,5046],{"class":5019},[55,5069,5065],{"class":65},[55,5071,5020],{"class":5019},[55,5073,5065],{"class":65},[55,5075,4996],{"class":2298},[55,5077,1609],{"class":65},[19,5079,5080],{},"在下图中，我通过更改 hosts 文件实现将百度的域名在本地被解析到 localhost，并使用 iframe 标签将 b 站嵌入到页面中。当然，这并不能说明什么事情，不过是我个人的恶趣味罢了。",[19,5082,5083],{},[1132,5084],{"alt":5085,"src":5086},"example","https://static.031130.xyz/uploads/2024/08/12/641f2272ab7fb.webp",[19,5088,5089,5090,5093],{},"将 ",[23,5091,5092],{},"http://example.com","改为目标站点，我们完全可以摆脱国内云服务商，在自己的服务器上直接实现「隐式代理」的效果。",[19,5095,5096],{},[3485,5097,5098],{},"而这种方案，恰巧可以用于在境内机子上建站，尤其是针对未备案的域名。",[19,5100,5101],{},"碍于 Github Pages 在境内的访问体验并不好，所以直接把博客部署在 Github Pages 下一直都不是首选，因此很多人都会选择去购买一台境内的小鸡，带宽虽然不大，但跑个博客什么的其实没什么大问题，但备案就很麻烦了。",[19,5103,5104,5105,5108],{},"我们可以通过在 Github Pages（或者其他境外的服务器） 上挂一个 ",[23,5106,5107],{},"index.html"," ，html 中使用 iframe 嵌套一个部署在境内小鸡上的网页来规避掉备案的问题。而境内小鸡可以选用非标准端口去监听请求。",[1132,5110],{"src":5111,"alt":5112,"style":5113},"https://static.031130.xyz/uploads/2024/08/12/642014b05bb43.webp","使用隐式转发","zoom:67%;",[1132,5115],{"src":5116,"alt":5117,"style":5113},"https://static.031130.xyz/uploads/2024/08/12/642014519ce2a.webp","2.drawio.png",[19,5119,5120],{},"这样带来的好处是访客只需要从境外的服务器上获取一个不到 1 KB 大小的 html ，随后的所有请求都是指向境内云服务器的，所以网页打开时的体验会得到改善。",[19,5122,5123],{},"隐式转发拥有以下优势：",[855,5125,5126,5129,5132,5135],{},[858,5127,5128],{},"直接向境内的云服务器发送请求，速度会得到改善 （相比于直接部署在境外服务器上的方案）",[858,5130,5131],{},"不怎么消耗境外服务器的流量 （相比于使用境外服务器反向代理的方案）",[858,5133,5134],{},"浏览器的地址栏不会直接显示 ip 或端口号（相比于未备案使用境内服务器的非标准端口的方案）",[858,5136,5137],{},"不需要备案（相比于备案后使用境内服务器的 80/443 端口的方案）",[19,5139,5140],{},"但也存在以下劣势：",[855,5142,5143,5146,5153,5156],{},[858,5144,5145],{},"移动端设备访问时好像还是会展示 PC 端的界面（存疑",[858,5147,5148,5149,5152],{},"现代浏览器访问时可能会有 ",[23,5150,5151],{},"strict-origin-when-cross-origin"," 的问题（一般好像是出现在 iframe 的 html 是 https 访问，而目标站点是 http 访问的情况？）",[858,5154,5155],{},"一些古老的浏览器可能不支持 iframe （？",[858,5157,5158],{},"访问目标站点的其他路径时，浏览器地址栏的显示的地址不会变",[3501,5160],{},[19,5162,5163,5164,5169,5170,5175,5176,888],{},"那么应",[37,5165,5168],{"href":5166,"rel":5167},"https://static.031130.xyz/uploads/2024/08/12/64201607999e3.webp",[41],"某些群友的要求","，本文的第二作者为 ",[37,5171,5174],{"href":5172,"rel":5173},"https://blog.f1nley.xyz",[41],"Finley","，通信作者为 ",[37,5177,5180],{"href":5178,"rel":5179},"https://blog.chordvers.com/",[41],"LanStarD",[381,5182,5183],{},"html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html pre.shiki code .sJa8x, html code.shiki .sJa8x{--shiki-default:#E45649;--shiki-dark:#E06C75}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html pre.shiki code .s-dj3, html code.shiki .s-dj3{--shiki-default:#000000;--shiki-dark:#FFFFFF}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}",{"title":51,"searchDepth":69,"depth":69,"links":5185},[],{"title":5187,"date":5188,"path":5189,"tags":5190,"body":5195},"在 vps 上配合 caddy 部署 siteproxy","2023-02-01 22:33:53","/2023/02/01/deploy-siteproxy-with-caddy-on-vps",[5191,5192,5193,5194,825],"OpenSource Project","siteproxy","Archlinux","nodejs",{"type":16,"value":5196,"toc":5618},[5197,5205,5212,5215,5230,5233,5237,5252,5326,5335,5339,5353,5356,5362,5365,5368,5410,5439,5444,5447,5523,5526,5532,5545,5552,5555,5568,5575,5581,5584,5587,5593,5600,5604,5611,5615],[19,5198,5199,5200,5204],{},"之前趁着春节活动的时候在某 vps 服务商买了 1 年的 vps，线路不算太好，但勉强够用，于是打算在上面部署一些反代程序。在群友的推荐下，发现了这款名为 ",[37,5201,5192],{"href":5202,"rel":5203},"https://github.com/netptop/siteproxy",[41]," 的开源项目。",[19,5206,5207,5208,5211],{},"siteproxy 相较于我在 ",[23,5209,5210],{},"r.zhullyb.top"," 部署的那个反代，其特点是可以运行在 vps 上，且将会替换被反代页面上的所有 url，因此遇到使用相对路径的网页也可以从容应对。",[19,5213,5214],{},"在项目的 README 中介绍了一种部署方案，但我仍有以下几点不太满意",[855,5216,5217,5220,5227],{},[858,5218,5219],{},"README 中的方案仅支持 nginx 部署，但我希望使用 caddy",[858,5221,5222,5223,5226],{},"README 中的方案使用 npm 安装了 ",[23,5224,5225],{},"forever"," 来达到保活的目的，甚至为此安装了 nvm，但我一不希望使用 npm 在系统上安装软件、二不希望安装 nvm 与 forever",[858,5228,5229],{},"原项目把根目录页做成了一个导航，指向了一些比较敏感的站点，而我希望换掉这个网页。",[19,5231,5232],{},"因此这篇博客也就应运而生。",[847,5234,5236],{"id":5235},"反代-8011-端口","反代 8011 端口",[19,5238,5239,5240,5243,5244,5248,5249,888],{},"根据项目 README 的描述，我们应当使用 nginx 去反代 ",[23,5241,5242],{},"127.0.0.1:8011"," 端口，但我是 caddy 用户，此前也",[37,5245,5247],{"href":5246},"/2022/05/30/use-caddy-to-proxy-wikipedia/","有过使用 caddy 反代","的经验，所以很容易写出一段使得程序可以正确运行的 ",[23,5250,5251],{},"Caddyfile",[46,5253,5255],{"className":1301,"code":5254,"language":1303,"meta":51,"style":51},"example.com {\n        reverse_proxy   127.0.0.1:8011 {\n                header_up Host {upstream_hostport}\n                header_up X-Real-IP {http.request.remote.host}\n                header_up X-Forwarded-For {http.request.remote.host}\n                header_up X-Forwarded-Port {http.request.port}\n                header_up X-Forwarded-Proto {http.request.scheme}\n                header_up Accept-Encoding identity\n        }\n}\n",[23,5256,5257,5267,5275,5283,5290,5297,5304,5311,5318,5322],{"__ignoreMap":51},[55,5258,5259,5262,5265],{"class":57,"line":58},[55,5260,5261],{"class":65},"example.",[55,5263,5264],{"class":61},"com",[55,5266,1321],{"class":65},[55,5268,5269,5272],{"class":57,"line":69},[55,5270,5271],{"class":61},"        reverse_proxy",[55,5273,5274],{"class":65},"   127.0.0.1:8011 {\n",[55,5276,5277,5280],{"class":57,"line":83},[55,5278,5279],{"class":61},"                header_up",[55,5281,5282],{"class":65}," Host {upstream_hostport}\n",[55,5284,5285,5287],{"class":57,"line":96},[55,5286,5279],{"class":61},[55,5288,5289],{"class":65}," X-Real-IP {http.request.remote.host}\n",[55,5291,5292,5294],{"class":57,"line":103},[55,5293,5279],{"class":61},[55,5295,5296],{"class":65}," X-Forwarded-For {http.request.remote.host}\n",[55,5298,5299,5301],{"class":57,"line":110},[55,5300,5279],{"class":61},[55,5302,5303],{"class":65}," X-Forwarded-Port {http.request.port}\n",[55,5305,5306,5308],{"class":57,"line":135},[55,5307,5279],{"class":61},[55,5309,5310],{"class":65}," X-Forwarded-Proto {http.request.scheme}\n",[55,5312,5313,5315],{"class":57,"line":155},[55,5314,5279],{"class":61},[55,5316,5317],{"class":65}," Accept-Encoding identity\n",[55,5319,5320],{"class":57,"line":160},[55,5321,1421],{"class":65},[55,5323,5324],{"class":57,"line":169},[55,5325,1426],{"class":65},[19,5327,5089,5328,5331,5332,5334],{},[23,5329,5330],{},"example.com"," 的 A 记录解析到 vps 主机的 ip，并使用 ",[23,5333,1963],{}," 重新启动 caddy，这一步就算完成了。",[847,5336,5338],{"id":5337},"安装-nodejs","安装 nodejs",[19,5340,5341,5342,5345,5346,5349,5350,5352],{},"我在 vps 上安装的发行版是 Archlinux，所以直接 ",[23,5343,5344],{},"pacman -S nodejs"," 安装完就是了，别的发行版应该也可以直接调用系统默认的包管理器安装 ",[23,5347,5348],{},"node"," 或者 ",[23,5351,5194],{}," 完成这一步。",[847,5354,5355],{"id":5355},"下载程序",[19,5357,5358,5359,5361],{},"首先，我们需要一个地方来存放我们下载的程序，我使用的是 ",[23,5360,1260],{}," 路径。",[19,5363,5364],{},"我们可以直接根据 README 所说的，直接 clone 整个项目，但我本人并不想这么做，项目里似乎有太多对于 vps 用户没有用的东西了。此外，整个项目首页我也不想要，首页的导航指向了一些比较敏感的网站，而我的反代就想安安心心的一个人用。",[19,5366,5367],{},"综合以上需求，我所需要的文件一共就五个:",[46,5369,5371],{"className":974,"code":5370,"language":976,"meta":51,"style":51},"├── config.js\n├── index.js\n├── logger.js\n├── package.json\n└── Proxy.js\n",[23,5372,5373,5381,5388,5395,5402],{"__ignoreMap":51},[55,5374,5375,5378],{"class":57,"line":58},[55,5376,5377],{"class":106},"├──",[55,5379,5380],{"class":145}," config.js\n",[55,5382,5383,5385],{"class":57,"line":69},[55,5384,5377],{"class":106},[55,5386,5387],{"class":145}," index.js\n",[55,5389,5390,5392],{"class":57,"line":83},[55,5391,5377],{"class":106},[55,5393,5394],{"class":145}," logger.js\n",[55,5396,5397,5399],{"class":57,"line":96},[55,5398,5377],{"class":106},[55,5400,5401],{"class":145}," package.json\n",[55,5403,5404,5407],{"class":57,"line":103},[55,5405,5406],{"class":106},"└──",[55,5408,5409],{"class":145}," Proxy.js\n",[46,5411,5413],{"className":974,"code":5412,"language":976,"meta":51,"style":51},"mkdir -p /opt/siteproxy\ncd /opt/siteproxy\nwget https://raw.githubusercontent.com/netptop/siteproxy/master/{config.js,index.js,logger.js,package.json,Proxy.js}\n",[23,5414,5415,5425,5431],{"__ignoreMap":51},[55,5416,5417,5419,5422],{"class":57,"line":58},[55,5418,1618],{"class":106},[55,5420,5421],{"class":238}," -p",[55,5423,5424],{"class":145}," /opt/siteproxy\n",[55,5426,5427,5429],{"class":57,"line":69},[55,5428,1543],{"class":149},[55,5430,5424],{"class":145},[55,5432,5433,5436],{"class":57,"line":83},[55,5434,5435],{"class":106},"wget",[55,5437,5438],{"class":145}," https://raw.githubusercontent.com/netptop/siteproxy/master/{config.js,index.js,logger.js,package.json,Proxy.js}\n",[19,5440,5441,5442],{},"然后补上一个 ",[23,5443,5107],{},[19,5445,5446],{},"我这边选择直接使用 JavaScript 将对于 / 的访问直接重定向到我的博客。",[46,5448,5452],{"className":5449,"code":5450,"language":5451,"meta":51,"style":51},"language-javascript shiki shiki-themes one-light one-dark-pro","\u003Chtml>\u003Chead>\u003Cmeta http-equiv=\"refresh\" content=\"0; url=https://zhul.in/\" />\u003C/head>\u003Cbody>Redirect to \u003Ca href=\"\">https://zhul.in/\u003C/a>\u003C/body>\u003C/html>\n","javascript",[23,5453,5454],{"__ignoreMap":51},[55,5455,5456,5458,5460,5462,5465,5467,5470,5473,5475,5478,5481,5483,5486,5489,5491,5493,5496,5499,5501,5503,5505,5508,5511,5513,5515,5517,5519,5521],{"class":57,"line":58},[55,5457,989],{"class":65},[55,5459,4996],{"class":2298},[55,5461,5012],{"class":65},[55,5463,5464],{"class":2298},"head",[55,5466,5012],{"class":65},[55,5468,5469],{"class":2298},"meta",[55,5471,5472],{"class":122}," http-equiv",[55,5474,142],{"class":141},[55,5476,5477],{"class":145},"\"refresh\"",[55,5479,5480],{"class":122}," content",[55,5482,142],{"class":141},[55,5484,5485],{"class":145},"\"0; url=https://zhul.in/\"",[55,5487,5488],{"class":65}," />\u003C/",[55,5490,5464],{"class":2298},[55,5492,5012],{"class":65},[55,5494,5495],{"class":2298},"body",[55,5497,5498],{"class":65},">Redirect to \u003C",[55,5500,37],{"class":2298},[55,5502,5053],{"class":122},[55,5504,142],{"class":141},[55,5506,5507],{"class":145},"\"\"",[55,5509,5510],{"class":65},">https://zhul.in/\u003C/",[55,5512,37],{"class":2298},[55,5514,5065],{"class":65},[55,5516,5495],{"class":2298},[55,5518,5065],{"class":65},[55,5520,4996],{"class":2298},[55,5522,1609],{"class":65},[871,5524,5525],{"id":5525},"安装依赖",[19,5527,355,5528,5531],{},[23,5529,5530],{},"/opt/siteproxy"," 目录下执行",[46,5533,5535],{"className":974,"code":5534,"language":976,"meta":51,"style":51},"npm install\n",[23,5536,5537],{"__ignoreMap":51},[55,5538,5539,5542],{"class":57,"line":58},[55,5540,5541],{"class":106},"npm",[55,5543,5544],{"class":145}," install\n",[19,5546,5547,5548,5551],{},"npm 将会根据 ",[23,5549,5550],{},"package.json"," 的内容自动安装所需的依赖。",[847,5553,5554],{"id":5554},"修改配置文件",[46,5556,5558],{"className":974,"code":5557,"language":976,"meta":51,"style":51},"$EDITOR /opt/siteproxy/config.js\n",[23,5559,5560],{"__ignoreMap":51},[55,5561,5562,5565],{"class":57,"line":58},[55,5563,5564],{"class":2298},"$EDITOR",[55,5566,5567],{"class":65}," /opt/siteproxy/config.js\n",[19,5569,5570,5571,5574],{},"按照 README 所说，修改 ",[23,5572,5573],{},"serverName"," 字段",[19,5576,5577],{},[1132,5578],{"alt":5579,"src":5580},"需要修改的 serverName 字段","https://static.031130.xyz/uploads/2024/08/12/63da866e26712.webp",[847,5582,5583],{"id":5583},"设置开机自启动",[19,5585,5586],{},"这里我选择使用 systemd 帮助我实现 siteproxy 程序的开机自启动，service 文件是我直接根据 frp 程序提供的 service 改的。",[46,5588,5591],{"className":5589,"code":5590,"language":2083},[2081],"cat /usr/lib/systemd/system/siteproxy.service \n-----\n[Unit]\nDescription=SiteProxy\nAfter=network-online.target\nWants=network-online.target\n\n[Service]\nType=simple\nUser=nobody\nRestart=on-failure\nRestartSec=5s\nEnvironment=\"NODE_PATH=/opt/siteproxy/\"\nExecStart=node --tls-min-v1.0 /opt/siteproxy/index.js \n\n[Install]\nWantedBy=multi-user.target\n",[23,5592,5590],{"__ignoreMap":51},[19,5594,5595,5596,5599],{},"随后使用 ",[23,5597,5598],{},"systemctl enable siteproxy --now"," 启动即可访问。",[847,5601,5603],{"id":5602},"为反代站点添加访问密码可选","为反代站点添加访问密码（可选）",[19,5605,5606,5607,888],{},"参考",[37,5608,5610],{"href":5609},"/2021/10/21/picuploader-on-archlinux-with-caddy/#%E8%AE%BE%E7%BD%AE%E8%AE%BF%E9%97%AE%E5%AF%86%E7%A0%81%EF%BC%88%E5%8F%AF%E9%80%89%EF%BC%89","我的另一篇博客",[847,5612,5614],{"id":5613},"使用防火墙程序禁止-8011-的公网访问可选","使用防火墙程序禁止 8011 的公网访问（可选）",[381,5616,5617],{},"html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html pre.shiki code .sLKXg, html code.shiki .sLKXg{--shiki-default:#A626A4;--shiki-dark:#C678DD}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html pre.shiki code .s_Sar, html code.shiki .s_Sar{--shiki-default:#0184BC;--shiki-dark:#56B6C2}html pre.shiki code .sJa8x, html code.shiki .sJa8x{--shiki-default:#E45649;--shiki-dark:#E06C75}html pre.shiki code .so_Uh, html code.shiki .so_Uh{--shiki-default:#986801;--shiki-default-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic}html pre.shiki code .sknuh, html code.shiki .sknuh{--shiki-default:#383A42;--shiki-dark:#56B6C2}",{"title":51,"searchDepth":69,"depth":69,"links":5619},[5620,5621,5622,5625,5626,5627,5628],{"id":5235,"depth":69,"text":5236},{"id":5337,"depth":69,"text":5338},{"id":5355,"depth":69,"text":5355,"children":5623},[5624],{"id":5525,"depth":83,"text":5525},{"id":5554,"depth":69,"text":5554},{"id":5583,"depth":69,"text":5583},{"id":5602,"depth":69,"text":5603},{"id":5613,"depth":69,"text":5614},131,1765307577952]
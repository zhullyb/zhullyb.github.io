[{"data":1,"prerenderedAt":3375},["ShallowReactive",2],{"randomIndex/page/7/":3,"index-page-7":4,"posts-total":3374},0,[5,638,1605,1934,2030,2119,2363,2797,3132,3207],{"title":6,"date":7,"path":8,"tags":9,"body":13},"在运行OpenWRT的N1盒子上部署 QQBot","2023-07-31 04:11:31","/2023/07/31/run-qq-bot-on-phicomm-n1-openwrt",[10,11,12],"Linux","Network","Bot",{"type":14,"value":15,"toc":629},"minimark",[16,20,25,47,147,162,166,175,202,206,215,219,222,226,229,233,236,239,246,249,607,625],[17,18,19],"p",{},"由于学校社团的招新需要，我写了一个依赖于 go-cqhttp 运行的 QQ Bot，并没有实现什么花里胡哨的功能，只是实现了关键词回复和新人入群时的欢迎语。因为没考虑后续维护的问题，代码也写得比较草，但毕竟是能跑。这么一个小型的程序并不会占用的多少的服务器资源，单独为这么一个 Bot 去开一台国内的 vps 似乎是有些大材小用了，刚好我手上有一台运行在 OpenWRT 上的 Phicomm N1 盒子，反正也是 Linux 系统，便打算拿来挂 QQ Bot。",[21,22,24],"h2",{"id":23},"安装-jdk","安装 JDK",[17,26,27,28,35,36,40,41,46],{},"由于腾讯近几个月对于 Bot 风控非常严格，所以不得不采用 SignServer 项目 ",[29,30,34],"a",{"href":31,"rel":32},"https://github.com/fuqiuluo/unidbg-fetch-qsign",[33],"nofollow","fuqiuluo/unidbg-fetch-qsign"," 来确保 Bot 账号不会被风控一次保证 Bot 运行的稳定性。而这个项目又是使用 Java 开发的，因此需要先安装 JDK/JRE。但 OpenWRT 的开发者可能并没有考虑到在路由器设备上运行 Java 程序的需求，因此 OpenWRT 的源里面是没有预先打包 JDK 的，因此我们需要额外安装。我直接 google 搜索了 ",[37,38,39],"code",{},"install java on openwrt"," 的关键词，在 Github 找到了这个脚本: ",[29,42,45],{"href":43,"rel":44},"https://gist.github.com/simonswine/64773a80e748f36615e3251234f29d1d%E3%80%82%E4%BD%86%E5%BE%88%E9%81%97%E6%86%BE%EF%BC%8C%E4%BB%A3%E7%A0%81%E8%B7%91%E4%B8%8D%E8%B5%B7%E6%9D%A5%EF%BC%8C%E4%B8%8B%E8%BD%BD%E6%97%B6%E6%8F%90%E7%A4%BA",[33],"https://gist.github.com/simonswine/64773a80e748f36615e3251234f29d1d。但很遗憾，代码跑不起来，下载时提示"," 404。于是我打开脚本细细一看，脚本中 jdk 的版本号和设备的架构均需要改动。具体改动如下:",[48,49,54],"pre",{"className":50,"code":51,"language":52,"meta":53,"style":53},"language-diff shiki shiki-themes one-light one-dark-pro","- REVISION=8.212.04-r0\n+ REVISION=8.302.08-r1\n# 版本号请自行去仓库内翻最新的\n......\n- URL=http://dl-cdn.alpinelinux.org/alpine/v3.10/community/armv7/\n+ URL=http://dl-cdn.alpinelinux.org/alpine/v3.14/community/aarch64/\n......\n- # verify packages\n- sha256sum -c \u003C\u003CEOF\n- e2fce9ee7348e9322c542206c3c3949e40690716d65e9f0e44dbbfca95d59d8c  openjdk8-8.212.04-r0.apk\n- 26ad786ff1ebeeb7cd24abee10bc56211a026a2d871cf161bb309563e1fcbabc  openjdk8-jre-8.212.04-r0.apk\n- 947d5f72ed2dc367c97d1429158913c9366f9c6ae01b7311dd8546b10ded8743  openjdk8-jre-base-- 8.212.04-r0.apk\n- c6a65402bf0a7051c60b45e1c6a8f4277a68a8b7e807078f20db17e0233dea8e  openjdk8-jre-lib-8.212.04-r0.apk\n- EOF\n# 我这里直接将 sha256 校验给删除了，有兴趣可以自己去更新这几个文件的文件名和其对应的哈希值\n","diff","",[37,55,56,64,70,76,82,88,94,99,105,111,117,123,129,135,141],{"__ignoreMap":53},[57,58,61],"span",{"class":59,"line":60},"line",1,[57,62,63],{},"- REVISION=8.212.04-r0\n",[57,65,67],{"class":59,"line":66},2,[57,68,69],{},"+ REVISION=8.302.08-r1\n",[57,71,73],{"class":59,"line":72},3,[57,74,75],{},"# 版本号请自行去仓库内翻最新的\n",[57,77,79],{"class":59,"line":78},4,[57,80,81],{},"......\n",[57,83,85],{"class":59,"line":84},5,[57,86,87],{},"- URL=http://dl-cdn.alpinelinux.org/alpine/v3.10/community/armv7/\n",[57,89,91],{"class":59,"line":90},6,[57,92,93],{},"+ URL=http://dl-cdn.alpinelinux.org/alpine/v3.14/community/aarch64/\n",[57,95,97],{"class":59,"line":96},7,[57,98,81],{},[57,100,102],{"class":59,"line":101},8,[57,103,104],{},"- # verify packages\n",[57,106,108],{"class":59,"line":107},9,[57,109,110],{},"- sha256sum -c \u003C\u003CEOF\n",[57,112,114],{"class":59,"line":113},10,[57,115,116],{},"- e2fce9ee7348e9322c542206c3c3949e40690716d65e9f0e44dbbfca95d59d8c  openjdk8-8.212.04-r0.apk\n",[57,118,120],{"class":59,"line":119},11,[57,121,122],{},"- 26ad786ff1ebeeb7cd24abee10bc56211a026a2d871cf161bb309563e1fcbabc  openjdk8-jre-8.212.04-r0.apk\n",[57,124,126],{"class":59,"line":125},12,[57,127,128],{},"- 947d5f72ed2dc367c97d1429158913c9366f9c6ae01b7311dd8546b10ded8743  openjdk8-jre-base-- 8.212.04-r0.apk\n",[57,130,132],{"class":59,"line":131},13,[57,133,134],{},"- c6a65402bf0a7051c60b45e1c6a8f4277a68a8b7e807078f20db17e0233dea8e  openjdk8-jre-lib-8.212.04-r0.apk\n",[57,136,138],{"class":59,"line":137},14,[57,139,140],{},"- EOF\n",[57,142,144],{"class":59,"line":143},15,[57,145,146],{},"# 我这里直接将 sha256 校验给删除了，有兴趣可以自己去更新这几个文件的文件名和其对应的哈希值\n",[17,148,149,150,153,154,157,158,161],{},"随后 ",[37,151,152],{},"chmod +x"," 授予脚本可执行权限后直接执行，我们就将 alpine linux 上的 openjdk 成功解包并安装到了我们的 OpenWRT 中，我们只需要配置好环境变量即可完成安装。但我又比较懒，我看见 SignServer 的启动脚本里是可以通过读取 ",[37,155,156],{},"$JAVA_HOME"," 来获取 Java 二进制可执行文件的代码逻辑，于是我便在每次启动 SignServer 脚本前提前执行 ",[37,159,160],{},"export JAVA_HOME=/opt/java-1.8-openjdk"," 即可。",[21,163,165],{"id":164},"安装-screen","安装 screen",[17,167,168,169,174],{},"相比起前面 JDK 的安装，这一步 screen 的安装反而没有那么麻烦，",[29,170,173],{"href":171,"rel":172},"https://openwrt.org/packages/pkgdata/screen",[33],"在最新版本的 OpenWRT 源中，screen 已经被包括进去了","，我们直接把 OpenWRT 换好源，从源里就可以安装。",[48,176,180],{"className":177,"code":178,"language":179,"meta":53,"style":53},"language-bash shiki shiki-themes one-light one-dark-pro","opkg update\nopkg install screen\n","bash",[37,181,182,192],{"__ignoreMap":53},[57,183,184,188],{"class":59,"line":60},[57,185,187],{"class":186},"sAdtL","opkg",[57,189,191],{"class":190},"sDhpE"," update\n",[57,193,194,196,199],{"class":59,"line":66},[57,195,187],{"class":186},[57,197,198],{"class":190}," install",[57,200,201],{"class":190}," screen\n",[21,203,205],{"id":204},"下载-fixed-版本的-go-cqhttp","下载 fixed 版本的 go-cqhttp",[17,207,208,209,214],{},"由于 SignServer 更新，在其请求中多添加了 key 的参数要求，导致原版 go-cqhttp 的最新 release 中释出的二进制文件无法适配最新版的 SignServer，我暂时选用了一个",[29,210,213],{"href":211,"rel":212},"https://github.com/tomato-aoarasi/go-cqhttp-1.1.0-sign-fixed/",[33],"修复了这个问题的 fork"," 去运行 Bot。下载到 OpenWRT 后记得也要授予可执行文件。",[21,216,218],{"id":217},"安装-python-脚本中所需要使用到的库","安装 Python 脚本中所需要使用到的库",[17,220,221],{},"OpenWRT 自带了 python 和 pip，这让我很欣慰。直接使用 pip 安装 flask 和 xlrd 等库即可，完全没有难度。",[21,223,225],{"id":224},"运行-signserver","运行 SignServer",[17,227,228],{},"这一步很简单，将原项目的 Release 下载下来解压后上传到 OpenWRT 的某个路径后，开个 screen 窗口，设置好 JAVA_HOME 变量后再去调用 SignServer 中自带的 shell 脚本即可",[21,230,232],{"id":231},"运行-go-cqhttp","运行 go-cqhttp",[17,234,235],{},"这一步也很简单，得益于 go 静态链接的特性，我们不需要为 go-cqhttp 安装任何额外的依赖就可以执行 Release 中的二进制文件，直接将我们在 PC 上登录好的 session、配置好的 device.json、config.yml 等文件上传到 N1 ，开个 screen 窗口运行即可。",[21,237,238],{"id":238},"运行主程序",[17,240,241,242,245],{},"这个没什么好讲的，同样是开个 screen 窗口运行 ",[37,243,244],{},"python main.py"," 的事情",[17,247,248],{},"python 代码如下:",[48,250,254],{"className":251,"code":252,"language":253,"meta":53,"style":53},"language-python shiki shiki-themes one-light one-dark-pro","from flask import Flask,request\nimport requests\nimport xlrd\n\n# 读取 xls 中的关键词以及回应语句，将其加载到 dict 数据结构中\n_data2 = xlrd.open_workbook('/root/8yue222.xls')\nmain_table2 = _data2.sheets()[0]\nkey_lst2 = main_table2.col_values(0)[1:]\nvalue_lst2 = main_table2.col_values(1)[1:]\nfinal_dict = dict(zip(key_lst2,value_lst2))\n# 读取第二份 xls，并对相同的关键词做覆盖\n_data = xlrd.open_workbook('/root/daihao.xls')\nmain_table = _data.sheets()[0]\nkey_lst = main_table.col_values(4)[1:]\nkey_lst = [str(int(item)) if type(item) == float else item for item in key_lst if item != '']\nkey_lst.remove('Gary')\nvalue_lst = main_table.col_values(5)[1:]\nvalue_lst = [str(int(item)) if type(item) == float else item for item in value_lst if item != '']\nfinal_dict.update(dict(zip(key_lst,value_lst)))\n\napp = Flask(__name__)\nclass API:\n        @staticmethod\n        def send(message):\n                url = \"http://127.0.0.1:5700/send_msg\"\n                data = request.get_json()\n                params = {\n                        \"group_id\":data['group_id'],\n                        \"message\":message\n                }\n                requests.get(url,params=params)\n\n@app.route('/', methods=[\"POST\"])\ndef post_data():\n    data = request.get_json()\n    print(data)\n    if data['post_type'] == 'message':\n        message = data['message']\n        messagex()\n    elif data['post_type'] == 'notice' and data['notice_type'] == 'group_increase':\n        welcome()\n    else:\n        print(\"忽略消息\")\n\n    return \"OK\"\n\ndef messagex():\n        data = request.get_json()\n        message = data['message'].replace('％','%')\n        for key in final_dict.keys():\n                if key == message:\n                        API.send(final_dict[key])\n                        break\n\ndef welcome():\n        data = request.get_json()\n        group_id = data['group_id']\n        user_id = data['user_id']\n        API.send(\"[CQ:at,qq={}] 欢迎来到浙江工业大学，精弘网络欢迎各位的到来！如果想进一步了解我们，请戳精弘首页：www.jh.zjut.edu.cn\\n输入 菜单 获取精小弘机器人的菜单 哦！\\n请及时修改群名片\\n格式如下：姓名+专业/大类\".format(user_id))\n\nif __name__ == '__main__':\n    app.run(host='0.0.0.0', port=5701)\n","python",[37,255,256,261,266,271,277,282,287,292,297,302,307,312,317,322,327,332,338,344,350,356,361,367,373,379,385,391,397,403,409,415,421,427,432,438,444,450,456,462,468,474,480,486,492,498,503,509,514,520,526,532,538,544,550,556,561,567,572,578,584,590,595,601],{"__ignoreMap":53},[57,257,258],{"class":59,"line":60},[57,259,260],{},"from flask import Flask,request\n",[57,262,263],{"class":59,"line":66},[57,264,265],{},"import requests\n",[57,267,268],{"class":59,"line":72},[57,269,270],{},"import xlrd\n",[57,272,273],{"class":59,"line":78},[57,274,276],{"emptyLinePlaceholder":275},true,"\n",[57,278,279],{"class":59,"line":84},[57,280,281],{},"# 读取 xls 中的关键词以及回应语句，将其加载到 dict 数据结构中\n",[57,283,284],{"class":59,"line":90},[57,285,286],{},"_data2 = xlrd.open_workbook('/root/8yue222.xls')\n",[57,288,289],{"class":59,"line":96},[57,290,291],{},"main_table2 = _data2.sheets()[0]\n",[57,293,294],{"class":59,"line":101},[57,295,296],{},"key_lst2 = main_table2.col_values(0)[1:]\n",[57,298,299],{"class":59,"line":107},[57,300,301],{},"value_lst2 = main_table2.col_values(1)[1:]\n",[57,303,304],{"class":59,"line":113},[57,305,306],{},"final_dict = dict(zip(key_lst2,value_lst2))\n",[57,308,309],{"class":59,"line":119},[57,310,311],{},"# 读取第二份 xls，并对相同的关键词做覆盖\n",[57,313,314],{"class":59,"line":125},[57,315,316],{},"_data = xlrd.open_workbook('/root/daihao.xls')\n",[57,318,319],{"class":59,"line":131},[57,320,321],{},"main_table = _data.sheets()[0]\n",[57,323,324],{"class":59,"line":137},[57,325,326],{},"key_lst = main_table.col_values(4)[1:]\n",[57,328,329],{"class":59,"line":143},[57,330,331],{},"key_lst = [str(int(item)) if type(item) == float else item for item in key_lst if item != '']\n",[57,333,335],{"class":59,"line":334},16,[57,336,337],{},"key_lst.remove('Gary')\n",[57,339,341],{"class":59,"line":340},17,[57,342,343],{},"value_lst = main_table.col_values(5)[1:]\n",[57,345,347],{"class":59,"line":346},18,[57,348,349],{},"value_lst = [str(int(item)) if type(item) == float else item for item in value_lst if item != '']\n",[57,351,353],{"class":59,"line":352},19,[57,354,355],{},"final_dict.update(dict(zip(key_lst,value_lst)))\n",[57,357,359],{"class":59,"line":358},20,[57,360,276],{"emptyLinePlaceholder":275},[57,362,364],{"class":59,"line":363},21,[57,365,366],{},"app = Flask(__name__)\n",[57,368,370],{"class":59,"line":369},22,[57,371,372],{},"class API:\n",[57,374,376],{"class":59,"line":375},23,[57,377,378],{},"        @staticmethod\n",[57,380,382],{"class":59,"line":381},24,[57,383,384],{},"        def send(message):\n",[57,386,388],{"class":59,"line":387},25,[57,389,390],{},"                url = \"http://127.0.0.1:5700/send_msg\"\n",[57,392,394],{"class":59,"line":393},26,[57,395,396],{},"                data = request.get_json()\n",[57,398,400],{"class":59,"line":399},27,[57,401,402],{},"                params = {\n",[57,404,406],{"class":59,"line":405},28,[57,407,408],{},"                        \"group_id\":data['group_id'],\n",[57,410,412],{"class":59,"line":411},29,[57,413,414],{},"                        \"message\":message\n",[57,416,418],{"class":59,"line":417},30,[57,419,420],{},"                }\n",[57,422,424],{"class":59,"line":423},31,[57,425,426],{},"                requests.get(url,params=params)\n",[57,428,430],{"class":59,"line":429},32,[57,431,276],{"emptyLinePlaceholder":275},[57,433,435],{"class":59,"line":434},33,[57,436,437],{},"@app.route('/', methods=[\"POST\"])\n",[57,439,441],{"class":59,"line":440},34,[57,442,443],{},"def post_data():\n",[57,445,447],{"class":59,"line":446},35,[57,448,449],{},"    data = request.get_json()\n",[57,451,453],{"class":59,"line":452},36,[57,454,455],{},"    print(data)\n",[57,457,459],{"class":59,"line":458},37,[57,460,461],{},"    if data['post_type'] == 'message':\n",[57,463,465],{"class":59,"line":464},38,[57,466,467],{},"        message = data['message']\n",[57,469,471],{"class":59,"line":470},39,[57,472,473],{},"        messagex()\n",[57,475,477],{"class":59,"line":476},40,[57,478,479],{},"    elif data['post_type'] == 'notice' and data['notice_type'] == 'group_increase':\n",[57,481,483],{"class":59,"line":482},41,[57,484,485],{},"        welcome()\n",[57,487,489],{"class":59,"line":488},42,[57,490,491],{},"    else:\n",[57,493,495],{"class":59,"line":494},43,[57,496,497],{},"        print(\"忽略消息\")\n",[57,499,501],{"class":59,"line":500},44,[57,502,276],{"emptyLinePlaceholder":275},[57,504,506],{"class":59,"line":505},45,[57,507,508],{},"    return \"OK\"\n",[57,510,512],{"class":59,"line":511},46,[57,513,276],{"emptyLinePlaceholder":275},[57,515,517],{"class":59,"line":516},47,[57,518,519],{},"def messagex():\n",[57,521,523],{"class":59,"line":522},48,[57,524,525],{},"        data = request.get_json()\n",[57,527,529],{"class":59,"line":528},49,[57,530,531],{},"        message = data['message'].replace('％','%')\n",[57,533,535],{"class":59,"line":534},50,[57,536,537],{},"        for key in final_dict.keys():\n",[57,539,541],{"class":59,"line":540},51,[57,542,543],{},"                if key == message:\n",[57,545,547],{"class":59,"line":546},52,[57,548,549],{},"                        API.send(final_dict[key])\n",[57,551,553],{"class":59,"line":552},53,[57,554,555],{},"                        break\n",[57,557,559],{"class":59,"line":558},54,[57,560,276],{"emptyLinePlaceholder":275},[57,562,564],{"class":59,"line":563},55,[57,565,566],{},"def welcome():\n",[57,568,570],{"class":59,"line":569},56,[57,571,525],{},[57,573,575],{"class":59,"line":574},57,[57,576,577],{},"        group_id = data['group_id']\n",[57,579,581],{"class":59,"line":580},58,[57,582,583],{},"        user_id = data['user_id']\n",[57,585,587],{"class":59,"line":586},59,[57,588,589],{},"        API.send(\"[CQ:at,qq={}] 欢迎来到浙江工业大学，精弘网络欢迎各位的到来！如果想进一步了解我们，请戳精弘首页：www.jh.zjut.edu.cn\\n输入 菜单 获取精小弘机器人的菜单 哦！\\n请及时修改群名片\\n格式如下：姓名+专业/大类\".format(user_id))\n",[57,591,593],{"class":59,"line":592},60,[57,594,276],{"emptyLinePlaceholder":275},[57,596,598],{"class":59,"line":597},61,[57,599,600],{},"if __name__ == '__main__':\n",[57,602,604],{"class":59,"line":603},62,[57,605,606],{},"    app.run(host='0.0.0.0', port=5701)\n",[608,609,610,613,619],"blockquote",{},[17,611,612],{},"参考资料:",[17,614,615],{},[29,616,617],{"href":617,"rel":618},"https://gist.github.com/simonswine/64773a80e748f36615e3251234f29d1d",[33],[17,620,621],{},[29,622,623],{"href":623,"rel":624},"https://blog.csdn.net/qq_64126275/article/details/128586651",[33],[626,627,628],"style",{},"html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}",{"title":53,"searchDepth":66,"depth":66,"links":630},[631,632,633,634,635,636,637],{"id":23,"depth":66,"text":24},{"id":164,"depth":66,"text":165},{"id":204,"depth":66,"text":205},{"id":217,"depth":66,"text":218},{"id":224,"depth":66,"text":225},{"id":231,"depth":66,"text":232},{"id":238,"depth":66,"text":238},{"title":639,"date":640,"path":641,"tags":642,"body":644},"在浙工大宿舍使用路由器连接移动网络(校园网)","2023-06-24 14:30:24","/2023/06/24/connect-china-mobile-with-router-in-zjut-dormitory",[11,643],"Router",{"type":14,"value":645,"toc":1601},[646,652,661,664,667,672,675,677,682,689,698,700,705,711,718,720,726,741,745,748,754,757,760,766,769,774,783,786,791,1494,1497,1503,1510,1516,1519,1532,1535,1538,1553,1559,1566,1571,1577,1580,1586,1592,1598],[17,647,648],{},[649,650,651],"strong",{},"2025.09.01 Updates:",[17,653,654,655,660],{},"最近看到这篇博客的热度还挺高，应该是最近新生开学有不少都在看。但移动的认证方式于今年的 8 月 15 日发生了变更，具体可以看",[29,656,659],{"href":657,"rel":658},"https://mp.weixin.qq.com/s/KtaP62A3h96FETerPdnQmw",[33],"这篇微信公众号文章","。我近期不在学校，没有环境去研究新的认证方式，但据我身边的人说不再需要什么 l2tp 了，找台常见的路由器直接走 dhcp 以后过一遍网页验证就好了。",[17,662,663],{},"祝各位新生在工大能渡过愉快的四年！",[665,666],"hr",{},[17,668,669],{},[649,670,671],{},"2024.04.09 Updates:",[17,673,674],{},"几天前移动对网页认证的页面进行了更新，原有的脚本失效，本博客已更新适配新版网页认证的脚本。",[665,676],{},[17,678,679],{},[649,680,681],{},"2023.7.10 Updates:",[17,683,684,685,688],{},"首先，",[649,686,687],{},"搬到屏峰校区以后，l2tp 服务器确实依然为 192.168.115.1","，这点挺奇怪的。",[17,690,691,692,697],{},"然后我发现 6.26 我的那个解决方案过于复杂，原先写的认证脚本完全可以胜任这项工作，之前失败的原因是因为我在朝晖抓的脚本参数不适用于屏峰校区，目前已经修复。脚本的变动情况可以看",[29,693,696],{"href":694,"rel":695},"https://gist.github.com/zhullyb/4c8708df5724c42f913d3d86ed49d929/revisions#diff-c33ee93215d3dddc16517dae8107b3473f7abc77f56ff5afedc1f263e7e22b27",[33],"这里","。",[665,699],{},[17,701,702],{},[649,703,704],{},"2023.6.26 Updates:",[17,706,707],{},[708,709,710],"del",{},"在我于 2023 年 6 月 26 日搬去屏峰校区以后，发生了连不上网的情况。目前一个可行的方案: 在 192.168.210.100 将自己的 MAC 地址全部解绑，然后使用自己的一台设备连接网线接口，正常通过网页验证。随后在 192.168.210.100 查看刚才通过网页验证的设备的 MAC 地址，将这一串 MAC 地址复制到 Padavan 的「外部网络（WAN）- MAC 地址」中，且将 l2tp 服务器改为 192.168.115.1 （没错，填朝晖的可以用）并重新连接 l2tp。",[17,712,713],{},[714,715],"img",{"alt":716,"src":717},"MAC 地址设置","https://static.031130.xyz/uploads/2024/08/12/649987173e542.webp",[665,719],{},[17,721,722],{},[714,723],{"alt":724,"src":725},"这是我们上一篇博客的成果","https://static.031130.xyz/uploads/2024/08/12/6496ac4f3170f.webp",[608,727,728],{},[17,729,730,734,735,740],{},[29,731,733],{"href":732},"/2023/06/24/redmi-ac2100-router-with-padavan/","上一篇博客","中，我为 Redmi AC2100 刷入了 Padavan，接下来就打算使用这台路由器进行联网。其实",[29,736,739],{"href":737,"rel":738},"https://static.031130.xyz/uploads/2024/08/12/6496ab42d74bf.webp",[33],"小米大多数路由器都是支持 l2tp 的协议的","，只需要在路由器后台稍微设置一下就能上网，服务器 ip 填 192.168.113.1，账号密码就是 hxzha+手机尾号后8位，密码就是手机尾号后6位。我使用 Padavan 是我个人有一些别的官方固件所不能提供的功能。",[21,742,744],{"id":743},"l2tp-相关设置","l2tp 相关设置",[17,746,747],{},"我们将 WAN 口插上墙壁一侧的网口，左侧菜单栏点击外部网络，将外网连接类型改为 l2tp",[17,749,750],{},[714,751],{"alt":752,"src":753},"外网连接类型","https://static.031130.xyz/uploads/2024/08/12/6496acaf4435b.webp",[17,755,756],{},"DNS 建议前两个填写学校的内网 DNS 地址( 172.16.7.10 ， 172.16.7.30)，最后一个填一个稳定的公共 DNS 即可，由于这一步是可选项，所以就不提供截图了。",[17,758,759],{},"往下拉，设置 l2tp 相关的设置项，只需要设置红色框框内的设置项即可。朝晖的 l2tp 服务器 ip 是 192.168.115.1 ， 屏峰校区是 192.168.113.1 ，这里不要填错了。",[17,761,762],{},[714,763],{"alt":764,"src":765},"Screenshot_20230623_213510.webp","https://static.031130.xyz/uploads/2024/08/12/6496ae85a4d4f.webp",[21,767,768],{"id":768},"网页认证脚本",[608,770,771],{},[17,772,773],{},"做完这些步骤，其实就可以正常上网了，只不过每次断网以后可能都需要重新过一遍验证，所以我专门写了一个脚本去过这个验证。",[17,775,776,777,782],{},"这份脚本我已经开源到 ",[29,778,781],{"href":779,"rel":780},"https://gist.github.com/zhullyb/4c8708df5724c42f913d3d86ed49d929",[33],"github gist"," 了，在顶部填好自己网页认证时的账号密码以后就可以用了。",[17,784,785],{},"顶部 TODO 处要写的账号密码就是那个有图书馆背景的网页认证密码。",[17,787,788],{},[714,789],{"alt":53,"src":790},"https://static.031130.xyz/uploads/2024/08/12/6506a036d0f55.webp",[48,792,794],{"className":177,"code":793,"language":179,"meta":53,"style":53},"#!/bin/bash\n\n# Login webpage identify for China Mobile in Zhejiang University of Technology automatically\n# Author: zhullyb\n# Email: zhullyb@outlook.com\n\n\n# TODO: Fill Your Account and Password for 192.168.210.112/192.168.210.111 here\nuser_account=\nuser_password=\n\nif `ip route | grep -q 10.129.0.1`; then\n  gateway=10.129.0.1\nelif `ip route | grep -q 10.136.0.1`; then\n  gateway=10.136.0.1\nfi\n\nif whoami | grep -q \"admin\\|root\" && [ -n \"$gateway\" ]; then\n  route add -net 192.168.210.111 netmask 255.255.255.255 gw ${gateway}\n  route add -net 192.168.210.112 netmask 255.255.255.255 gw ${gateway}\n  route add -net 192.168.210.100 netmask 255.255.255.255 gw ${gateway}\n  route add -net 172.16.0.0 netmask 255.255.0.0 gw ${gateway}\nfi\n\n# 尝试访问内网服务器，如果未通过网页认证则会获得 url 跳转信息，用于判断用户为朝晖校区或屏峰校区，并获取用户 ip\ntest_curl=$(curl -s http://172.16.19.160)\nwlan_user_ip=$(echo ${test_curl} | grep -oE 'wlanuserip=[0-9\\.]+' | grep -oE '[0-9\\.]+')\nwlan_ac_ip=$(echo ${test_curl} | grep -oE 'wlanacip=[0-9\\.]+' | grep -oE '[0-9\\.]+')\nwlan_user_mac=$(echo ${test_curl} | grep -oE 'usermac=[[:xdigit:]-]+' | cut -d'=' -f2 | tr -d '-')\nwlan_ac_name=$(echo ${test_curl} | grep -o \"wlanacname=[^&]*\" | cut -d'=' -f2)\n\n# 朝晖校区宿舍楼内的移动宽带的认证请求\nif echo \"${test_curl}\" | grep -q \"192.168.210.112\"; then \\\ncurl \"http://192.168.210.112:801/eportal/portal/login?callback=dr1003&login_method=1&user_account=%2C0%2C${user_account}%40cmcczhyx&user_password=${user_password}&wlan_user_ip=${wlan_user_ip}&wlan_user_ipv6=&wlan_user_mac=${wlan_user_mac}&wlan_ac_ip=${wlan_ac_ip}&wlan_ac_name=${wlan_ac_name}&jsVersion=4.2.1&terminal_type=1&lang=zh-cn&v=5099&lang=zh\"\n# 屏峰校区宿舍楼内的移动宽带的认证请求\nelif echo \"${test_curl}\" | grep -q \"192.168.210.111\"; then \\\ncurl \"http://192.168.210.111:801/eportal/portal/login?callback=dr1003&login_method=1&user_account=%2C0%2C${user_account}%40cmccpfyx&user_password=${user_password}&wlan_user_ip=${wlan_user_ip}&wlan_user_ipv6=&wlan_user_mac=${wlan_user_mac}&wlan_ac_ip=${wlan_ac_ip}&wlan_ac_name=${wlan_ac_name}&jsVersion=4.2.1&terminal_type=1&lang=zh-cn&v=5099&lang=zh\"\nfi\n",[37,795,796,802,806,811,816,821,825,829,834,844,851,855,893,904,930,939,944,948,986,1019,1042,1065,1089,1093,1097,1102,1124,1165,1201,1253,1292,1296,1301,1337,1398,1403,1434,1490],{"__ignoreMap":53},[57,797,798],{"class":59,"line":60},[57,799,801],{"class":800},"sW2Sy","#!/bin/bash\n",[57,803,804],{"class":59,"line":66},[57,805,276],{"emptyLinePlaceholder":275},[57,807,808],{"class":59,"line":72},[57,809,810],{"class":800},"# Login webpage identify for China Mobile in Zhejiang University of Technology automatically\n",[57,812,813],{"class":59,"line":78},[57,814,815],{"class":800},"# Author: zhullyb\n",[57,817,818],{"class":59,"line":84},[57,819,820],{"class":800},"# Email: zhullyb@outlook.com\n",[57,822,823],{"class":59,"line":90},[57,824,276],{"emptyLinePlaceholder":275},[57,826,827],{"class":59,"line":96},[57,828,276],{"emptyLinePlaceholder":275},[57,830,831],{"class":59,"line":101},[57,832,833],{"class":800},"# TODO: Fill Your Account and Password for 192.168.210.112/192.168.210.111 here\n",[57,835,836,840],{"class":59,"line":107},[57,837,839],{"class":838},"sJa8x","user_account",[57,841,843],{"class":842},"sknuh","=\n",[57,845,846,849],{"class":59,"line":113},[57,847,848],{"class":838},"user_password",[57,850,843],{"class":842},[57,852,853],{"class":59,"line":119},[57,854,276],{"emptyLinePlaceholder":275},[57,856,857,861,864,867,870,874,877,881,884,887,890],{"class":59,"line":125},[57,858,860],{"class":859},"sLKXg","if",[57,862,863],{"class":190}," `",[57,865,866],{"class":186},"ip",[57,868,869],{"class":190}," route ",[57,871,873],{"class":872},"s5ixo","|",[57,875,876],{"class":186}," grep",[57,878,880],{"class":879},"sAGMh"," -q",[57,882,883],{"class":879}," 10.129.0.1",[57,885,886],{"class":190},"`",[57,888,889],{"class":872},"; ",[57,891,892],{"class":859},"then\n",[57,894,895,898,901],{"class":59,"line":131},[57,896,897],{"class":838},"  gateway",[57,899,900],{"class":842},"=",[57,902,903],{"class":190},"10.129.0.1\n",[57,905,906,909,911,913,915,917,919,921,924,926,928],{"class":59,"line":137},[57,907,908],{"class":859},"elif",[57,910,863],{"class":190},[57,912,866],{"class":186},[57,914,869],{"class":190},[57,916,873],{"class":872},[57,918,876],{"class":186},[57,920,880],{"class":879},[57,922,923],{"class":879}," 10.136.0.1",[57,925,886],{"class":190},[57,927,889],{"class":872},[57,929,892],{"class":859},[57,931,932,934,936],{"class":59,"line":143},[57,933,897],{"class":838},[57,935,900],{"class":842},[57,937,938],{"class":190},"10.136.0.1\n",[57,940,941],{"class":59,"line":334},[57,942,943],{"class":859},"fi\n",[57,945,946],{"class":59,"line":340},[57,947,276],{"emptyLinePlaceholder":275},[57,949,950,952,955,958,961,963,966,969,972,975,978,981,984],{"class":59,"line":346},[57,951,860],{"class":859},[57,953,954],{"class":186}," whoami",[57,956,957],{"class":872}," | ",[57,959,960],{"class":186},"grep",[57,962,880],{"class":879},[57,964,965],{"class":190}," \"admin\\|root\"",[57,967,968],{"class":872}," && [ ",[57,970,971],{"class":842},"-n",[57,973,974],{"class":190}," \"",[57,976,977],{"class":838},"$gateway",[57,979,980],{"class":190},"\"",[57,982,983],{"class":872}," ]; ",[57,985,892],{"class":859},[57,987,988,991,994,997,1000,1003,1006,1009,1013,1016],{"class":59,"line":352},[57,989,990],{"class":186},"  route",[57,992,993],{"class":190}," add",[57,995,996],{"class":879}," -net",[57,998,999],{"class":879}," 192.168.210.111",[57,1001,1002],{"class":190}," netmask",[57,1004,1005],{"class":879}," 255.255.255.255",[57,1007,1008],{"class":190}," gw",[57,1010,1012],{"class":1011},"sr1Ac"," ${",[57,1014,1015],{"class":838},"gateway",[57,1017,1018],{"class":1011},"}\n",[57,1020,1021,1023,1025,1027,1030,1032,1034,1036,1038,1040],{"class":59,"line":358},[57,1022,990],{"class":186},[57,1024,993],{"class":190},[57,1026,996],{"class":879},[57,1028,1029],{"class":879}," 192.168.210.112",[57,1031,1002],{"class":190},[57,1033,1005],{"class":879},[57,1035,1008],{"class":190},[57,1037,1012],{"class":1011},[57,1039,1015],{"class":838},[57,1041,1018],{"class":1011},[57,1043,1044,1046,1048,1050,1053,1055,1057,1059,1061,1063],{"class":59,"line":363},[57,1045,990],{"class":186},[57,1047,993],{"class":190},[57,1049,996],{"class":879},[57,1051,1052],{"class":879}," 192.168.210.100",[57,1054,1002],{"class":190},[57,1056,1005],{"class":879},[57,1058,1008],{"class":190},[57,1060,1012],{"class":1011},[57,1062,1015],{"class":838},[57,1064,1018],{"class":1011},[57,1066,1067,1069,1071,1073,1076,1078,1081,1083,1085,1087],{"class":59,"line":369},[57,1068,990],{"class":186},[57,1070,993],{"class":190},[57,1072,996],{"class":879},[57,1074,1075],{"class":879}," 172.16.0.0",[57,1077,1002],{"class":190},[57,1079,1080],{"class":879}," 255.255.0.0",[57,1082,1008],{"class":190},[57,1084,1012],{"class":1011},[57,1086,1015],{"class":838},[57,1088,1018],{"class":1011},[57,1090,1091],{"class":59,"line":375},[57,1092,943],{"class":859},[57,1094,1095],{"class":59,"line":381},[57,1096,276],{"emptyLinePlaceholder":275},[57,1098,1099],{"class":59,"line":387},[57,1100,1101],{"class":800},"# 尝试访问内网服务器，如果未通过网页认证则会获得 url 跳转信息，用于判断用户为朝晖校区或屏峰校区，并获取用户 ip\n",[57,1103,1104,1107,1109,1112,1115,1118,1121],{"class":59,"line":393},[57,1105,1106],{"class":838},"test_curl",[57,1108,900],{"class":842},[57,1110,1111],{"class":872},"$(",[57,1113,1114],{"class":186},"curl",[57,1116,1117],{"class":879}," -s",[57,1119,1120],{"class":190}," http://172.16.19.160",[57,1122,1123],{"class":872},")\n",[57,1125,1126,1129,1131,1133,1137,1139,1141,1144,1146,1148,1151,1154,1156,1158,1160,1163],{"class":59,"line":399},[57,1127,1128],{"class":838},"wlan_user_ip",[57,1130,900],{"class":842},[57,1132,1111],{"class":872},[57,1134,1136],{"class":1135},"s_Sar","echo",[57,1138,1012],{"class":1011},[57,1140,1106],{"class":838},[57,1142,1143],{"class":1011},"}",[57,1145,957],{"class":872},[57,1147,960],{"class":186},[57,1149,1150],{"class":879}," -oE",[57,1152,1153],{"class":190}," 'wlanuserip=[0-9\\.]+'",[57,1155,957],{"class":872},[57,1157,960],{"class":186},[57,1159,1150],{"class":879},[57,1161,1162],{"class":190}," '[0-9\\.]+'",[57,1164,1123],{"class":872},[57,1166,1167,1170,1172,1174,1176,1178,1180,1182,1184,1186,1188,1191,1193,1195,1197,1199],{"class":59,"line":405},[57,1168,1169],{"class":838},"wlan_ac_ip",[57,1171,900],{"class":842},[57,1173,1111],{"class":872},[57,1175,1136],{"class":1135},[57,1177,1012],{"class":1011},[57,1179,1106],{"class":838},[57,1181,1143],{"class":1011},[57,1183,957],{"class":872},[57,1185,960],{"class":186},[57,1187,1150],{"class":879},[57,1189,1190],{"class":190}," 'wlanacip=[0-9\\.]+'",[57,1192,957],{"class":872},[57,1194,960],{"class":186},[57,1196,1150],{"class":879},[57,1198,1162],{"class":190},[57,1200,1123],{"class":872},[57,1202,1203,1206,1208,1210,1212,1214,1216,1218,1220,1222,1224,1227,1229,1232,1235,1238,1241,1243,1246,1248,1251],{"class":59,"line":411},[57,1204,1205],{"class":838},"wlan_user_mac",[57,1207,900],{"class":842},[57,1209,1111],{"class":872},[57,1211,1136],{"class":1135},[57,1213,1012],{"class":1011},[57,1215,1106],{"class":838},[57,1217,1143],{"class":1011},[57,1219,957],{"class":872},[57,1221,960],{"class":186},[57,1223,1150],{"class":879},[57,1225,1226],{"class":190}," 'usermac=[[:xdigit:]-]+'",[57,1228,957],{"class":872},[57,1230,1231],{"class":186},"cut",[57,1233,1234],{"class":879}," -d",[57,1236,1237],{"class":190},"'='",[57,1239,1240],{"class":879}," -f2",[57,1242,957],{"class":872},[57,1244,1245],{"class":186},"tr",[57,1247,1234],{"class":879},[57,1249,1250],{"class":190}," '-'",[57,1252,1123],{"class":872},[57,1254,1255,1258,1260,1262,1264,1266,1268,1270,1272,1274,1277,1280,1282,1284,1286,1288,1290],{"class":59,"line":417},[57,1256,1257],{"class":838},"wlan_ac_name",[57,1259,900],{"class":842},[57,1261,1111],{"class":872},[57,1263,1136],{"class":1135},[57,1265,1012],{"class":1011},[57,1267,1106],{"class":838},[57,1269,1143],{"class":1011},[57,1271,957],{"class":872},[57,1273,960],{"class":186},[57,1275,1276],{"class":879}," -o",[57,1278,1279],{"class":190}," \"wlanacname=[^&]*\"",[57,1281,957],{"class":872},[57,1283,1231],{"class":186},[57,1285,1234],{"class":879},[57,1287,1237],{"class":190},[57,1289,1240],{"class":879},[57,1291,1123],{"class":872},[57,1293,1294],{"class":59,"line":423},[57,1295,276],{"emptyLinePlaceholder":275},[57,1297,1298],{"class":59,"line":429},[57,1299,1300],{"class":800},"# 朝晖校区宿舍楼内的移动宽带的认证请求\n",[57,1302,1303,1305,1308,1310,1314,1316,1318,1320,1322,1324,1326,1329,1331,1334],{"class":59,"line":434},[57,1304,860],{"class":859},[57,1306,1307],{"class":1135}," echo",[57,1309,974],{"class":190},[57,1311,1313],{"class":1312},"sTIpt","${",[57,1315,1106],{"class":838},[57,1317,1143],{"class":1312},[57,1319,980],{"class":190},[57,1321,957],{"class":872},[57,1323,960],{"class":186},[57,1325,880],{"class":879},[57,1327,1328],{"class":190}," \"192.168.210.112\"",[57,1330,889],{"class":872},[57,1332,1333],{"class":859},"then",[57,1335,1336],{"class":1135}," \\\n",[57,1338,1339,1341,1344,1346,1348,1350,1353,1355,1357,1359,1362,1364,1366,1368,1371,1373,1375,1377,1380,1382,1384,1386,1389,1391,1393,1395],{"class":59,"line":440},[57,1340,1114],{"class":186},[57,1342,1343],{"class":190}," \"http://192.168.210.112:801/eportal/portal/login?callback=dr1003&login_method=1&user_account=%2C0%2C",[57,1345,1313],{"class":1312},[57,1347,839],{"class":838},[57,1349,1143],{"class":1312},[57,1351,1352],{"class":190},"%40cmcczhyx&user_password=",[57,1354,1313],{"class":1312},[57,1356,848],{"class":838},[57,1358,1143],{"class":1312},[57,1360,1361],{"class":190},"&wlan_user_ip=",[57,1363,1313],{"class":1312},[57,1365,1128],{"class":838},[57,1367,1143],{"class":1312},[57,1369,1370],{"class":190},"&wlan_user_ipv6=&wlan_user_mac=",[57,1372,1313],{"class":1312},[57,1374,1205],{"class":838},[57,1376,1143],{"class":1312},[57,1378,1379],{"class":190},"&wlan_ac_ip=",[57,1381,1313],{"class":1312},[57,1383,1169],{"class":838},[57,1385,1143],{"class":1312},[57,1387,1388],{"class":190},"&wlan_ac_name=",[57,1390,1313],{"class":1312},[57,1392,1257],{"class":838},[57,1394,1143],{"class":1312},[57,1396,1397],{"class":190},"&jsVersion=4.2.1&terminal_type=1&lang=zh-cn&v=5099&lang=zh\"\n",[57,1399,1400],{"class":59,"line":446},[57,1401,1402],{"class":800},"# 屏峰校区宿舍楼内的移动宽带的认证请求\n",[57,1404,1405,1407,1409,1411,1413,1415,1417,1419,1421,1423,1425,1428,1430,1432],{"class":59,"line":452},[57,1406,908],{"class":859},[57,1408,1307],{"class":1135},[57,1410,974],{"class":190},[57,1412,1313],{"class":1312},[57,1414,1106],{"class":838},[57,1416,1143],{"class":1312},[57,1418,980],{"class":190},[57,1420,957],{"class":872},[57,1422,960],{"class":186},[57,1424,880],{"class":879},[57,1426,1427],{"class":190}," \"192.168.210.111\"",[57,1429,889],{"class":872},[57,1431,1333],{"class":859},[57,1433,1336],{"class":1135},[57,1435,1436,1438,1441,1443,1445,1447,1450,1452,1454,1456,1458,1460,1462,1464,1466,1468,1470,1472,1474,1476,1478,1480,1482,1484,1486,1488],{"class":59,"line":458},[57,1437,1114],{"class":186},[57,1439,1440],{"class":190}," \"http://192.168.210.111:801/eportal/portal/login?callback=dr1003&login_method=1&user_account=%2C0%2C",[57,1442,1313],{"class":1312},[57,1444,839],{"class":838},[57,1446,1143],{"class":1312},[57,1448,1449],{"class":190},"%40cmccpfyx&user_password=",[57,1451,1313],{"class":1312},[57,1453,848],{"class":838},[57,1455,1143],{"class":1312},[57,1457,1361],{"class":190},[57,1459,1313],{"class":1312},[57,1461,1128],{"class":838},[57,1463,1143],{"class":1312},[57,1465,1370],{"class":190},[57,1467,1313],{"class":1312},[57,1469,1205],{"class":838},[57,1471,1143],{"class":1312},[57,1473,1379],{"class":190},[57,1475,1313],{"class":1312},[57,1477,1169],{"class":838},[57,1479,1143],{"class":1312},[57,1481,1388],{"class":190},[57,1483,1313],{"class":1312},[57,1485,1257],{"class":838},[57,1487,1143],{"class":1312},[57,1489,1397],{"class":190},[57,1491,1492],{"class":59,"line":464},[57,1493,943],{"class":859},[17,1495,1496],{},"在 Padavan 的设置界面中，我们去打开 ssh 服务",[17,1498,1499],{},[714,1500],{"alt":1501,"src":1502},"打开 ssh 服务","https://static.031130.xyz/uploads/2024/08/12/6496afd695464.webp",[17,1504,1505,1506,1509],{},"在自己的电脑上通过 ssh 连接到路由器的终端 ",[37,1507,1508],{},"ssh admin@192.168.123.1","，默认密码也是 admin，就和进入 Padavan 后台的默认管理密码一样。",[17,1511,1512],{},[714,1513],{"alt":1514,"src":1515},"进入路由器终端","https://static.031130.xyz/uploads/2024/08/12/6496b029dfe3f.webp",[17,1517,1518],{},"看了一下 Padavan 并没有自带 nano 这个方便的 tui 编辑器，只好用自带的 vi 将就一下将认证代码复制到路由器中。",[48,1520,1522],{"className":177,"code":1521,"language":179,"meta":53,"style":53},"vi /etc/storage/login_edu.sh\n",[37,1523,1524],{"__ignoreMap":53},[57,1525,1526,1529],{"class":59,"line":60},[57,1527,1528],{"class":186},"vi",[57,1530,1531],{"class":190}," /etc/storage/login_edu.sh\n",[17,1533,1534],{},"关于 vi 的使用方法我在这里也不展开讲，我个人也不熟悉这款编辑器。",[17,1536,1537],{},"将脚本复制进去后，记得输入自己网页认证的账号密码，然后保存离开，给这个脚本赋予 x 权限。",[48,1539,1541],{"className":177,"code":1540,"language":179,"meta":53,"style":53},"chmod a+x /etc/storage/login_edu.sh\n",[37,1542,1543],{"__ignoreMap":53},[57,1544,1545,1548,1551],{"class":59,"line":60},[57,1546,1547],{"class":186},"chmod",[57,1549,1550],{"class":190}," a+x",[57,1552,1531],{"class":190},[17,1554,1555],{},[714,1556],{"alt":1557,"src":1558},"保存认证脚本","https://static.031130.xyz/uploads/2024/08/12/6496b11b7c541.webp",[17,1560,1561,1562,1565],{},"随后运行 ",[37,1563,1564],{},"crontab -e"," ，设置运行脚本为每天早上 6 点 01 分执行一次（因为工作日凌晨 00:30 断网，早上网络恢复以后有可能会要求你通过网页认证后才能再次联网）",[17,1567,1568],{},[37,1569,1570],{},"1 6 * * * /etc/storage/login_edu.sh",[17,1572,1573],{},[714,1574],{"alt":1575,"src":1576},"设置 crontab","https://static.031130.xyz/uploads/2024/08/12/6496b1132f497.webp",[17,1578,1579],{},"随后来到路由器的设置界面，设置「在 WAN 上行/下行启动后执行」和「在防火墙规则启动后执行」这两个地方分别调用我们的网页认证脚本，防止因停电、网线接口松动等故障恢复后依然没法联网的问题。图中的 logger 命令是给我自己排错看的，不需要设置。",[17,1581,1582],{},[714,1583],{"alt":1584,"src":1585},"脚本设置界面","https://static.031130.xyz/uploads/2024/08/12/6496b36585000.webp",[17,1587,1588],{},[714,1589],{"alt":1590,"src":1591},"WAN上下行","https://static.031130.xyz/uploads/2024/08/12/6496b369bbd70.webp",[17,1593,1594],{},[714,1595],{"alt":1596,"src":1597},"防火墙规则","https://static.031130.xyz/uploads/2024/08/12/6496b3703197f.webp",[626,1599,1600],{},"html pre.shiki code .sW2Sy, html code.shiki .sW2Sy{--shiki-default:#A0A1A7;--shiki-default-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic}html pre.shiki code .sJa8x, html code.shiki .sJa8x{--shiki-default:#E45649;--shiki-dark:#E06C75}html pre.shiki code .sknuh, html code.shiki .sknuh{--shiki-default:#383A42;--shiki-dark:#56B6C2}html pre.shiki code .sLKXg, html code.shiki .sLKXg{--shiki-default:#A626A4;--shiki-dark:#C678DD}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html pre.shiki code .sr1Ac, html code.shiki .sr1Ac{--shiki-default:#E45649;--shiki-dark:#ABB2BF}html pre.shiki code .s_Sar, html code.shiki .s_Sar{--shiki-default:#0184BC;--shiki-dark:#56B6C2}html pre.shiki code .sTIpt, html code.shiki .sTIpt{--shiki-default:#E45649;--shiki-dark:#98C379}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}",{"title":53,"searchDepth":66,"depth":66,"links":1602},[1603,1604],{"id":743,"depth":66,"text":744},{"id":768,"depth":66,"text":768},{"title":1606,"date":1607,"path":1608,"tags":1609,"body":1610},"为红米 Redmi AC2100 路由器刷入 Padavan","2023-06-24 00:22:53","/2023/06/24/redmi-ac2100-router-with-padavan",[643,11],{"type":14,"value":1611,"toc":1927},[1612,1617,1620,1623,1626,1629,1632,1638,1641,1646,1649,1654,1657,1662,1665,1671,1675,1678,1689,1692,1701,1708,1716,1719,1725,1731,1737,1740,1746,1749,1760,1766,1770,1773,1780,1786,1797,1803,1806,1812,1818,1825,1831,1834,1840,1844,1847,1854,1860,1863,1869,1872,1878,1881,1884,1890,1893,1898,1924],[608,1613,1614],{},[17,1615,1616],{},"大一一年转眼就要过去了，最近要搬校区了，顺手就把之前刷过的「小米路由器4A千兆版」出手给了同学，自己反手入了一个 「Redmi AC 2100」，尽管是跟着教程走，但过程中依然是遇见了不少坑，因此就开一篇博客记录了一下。",[21,1618,1619],{"id":1619},"重置路由器",[17,1621,1622],{},"这一步其实可有可无，只是我从闲鱼上入手这个路由器，买家并没有告知我密码，于是我只能手动 RESET 这个路由器来进入后台。",[21,1624,1625],{"id":1625},"通过网络设置引导",[17,1627,1628],{},"原本就是连上路由器后简单地通过引导界面，但由于我没有一个正常的网络环境，所以这一步走的其实也是有点困难的，我还是稍微记一下。",[17,1630,1631],{},"首先浏览器地址栏输入 192.168.31.1 (小米家的路由器默认好像都是这个 ip 地址)，看到下图界面，加不加入用户改善计划其实都是无所谓的，反正马上就要刷掉这个系统了。",[17,1633,1634],{},[714,1635],{"alt":1636,"src":1637},"路由器设置引导界面","https://static.031130.xyz/uploads/2024/08/12/6495c9a227d2c.webp",[17,1639,1640],{},"此处选择「不插网线，继续配置」，因为我们没有标准的网络环境，还指望着这台路由器跑 l2tp 帮我们连校园网呢。",[17,1642,1643],{},[714,1644],{"alt":1636,"src":1645},"https://static.031130.xyz/uploads/2024/08/12/6495ca724bf14.webp",[17,1647,1648],{},"这里需要选择「自动获取IP」（静态 IP）好像也行，但别的选项在我的网络环境下恐怕都是没法继续配置下去的。",[17,1650,1651],{},[714,1652],{"alt":1636,"src":1653},"https://static.031130.xyz/uploads/2024/08/12/6495cae48566d.webp",[17,1655,1656],{},"随后随手输个 WIFI 名称和密码，主要是记住密码进路由器后台管理。",[17,1658,1659],{},[714,1660],{"alt":1636,"src":1661},"https://static.031130.xyz/uploads/2024/08/12/6495cb8eba4b5.webp",[17,1663,1664],{},"设置完上述设置项以后，再次进入 192.168.31.1 ，就能看见路由器后台管理的登陆页面了。",[17,1666,1667],{},[714,1668],{"alt":1669,"src":1670},"路由器后台管理首页","https://static.031130.xyz/uploads/2024/08/12/6495cc2ff1e02.webp",[21,1672,1674],{"id":1673},"获取-ssh-权限","获取 ssh 权限",[17,1676,1677],{},"输入登陆密码，进入路由器后台管理页面，我们需要通过 bug 去获取打开官方系统的 ssh 功能",[608,1679,1680],{},[17,1681,1682,1683,1688],{},"这里提一嘴，当初我刷小米路由器4A千兆版的时候用的是",[29,1684,1687],{"href":1685,"rel":1686},"https://github.com/acecilia/OpenWRTInvasion/",[33],"这个仓库","来打开 ssh。",[17,1690,1691],{},"首先是确认路由器的版本，我从闲鱼上购得的路由器自带的版本是官方稳定版 2.0.23，一开始跟着别人的思路就降级到了 2.0.7，但后来遇见问题在网上查解决方案的时候看到有人说这个漏洞在 2.0.23 依然可用，但我也没有去试。",[17,1693,1694,1695,1700],{},"在电脑上下载 2.0.7 的",[29,1696,1699],{"href":1697,"rel":1698},"https://cdn.cnbj1.fds.api.mi-img.com/xiaoqiang/rom/rm2100/miwifi_rm2100_firmware_d6234_2.0.7.bin",[33],"升级包","，在路由器设置界面的常用设置->系统状态->手动升级 选择自己下载的升级包，确认等待重启即可。有些教程说可以选择保留数据，但我也懒得试，就直接清除了所有数据，又不得不再次过一遍上面的配置引导。",[17,1702,1703,1704,1707],{},"在地址栏，删除 ",[37,1705,1706],{},"/web/home#router"," 部分，加入下面这串代码",[48,1709,1714],{"className":1710,"code":1712,"language":1713,"meta":53},[1711],"language-text","/api/misystem/set_config_iotdev?bssid=Xiaomi&user_id=longdike&ssid=-h%3B%20nvram%20set%20ssh_en%3D1%3B%20nvram%20commit%3B%20sed%20-i%20's%2Fchannel%3D.*%2Fchannel%3D%5C%22debug%5C%22%2Fg'%20%2Fetc%2Finit.d%2Fdropbear%3B%20%2Fetc%2Finit.d%2Fdropbear%20start%3B\n","text",[37,1715,1712],{"__ignoreMap":53},[17,1717,1718],{},"再次删除后面的代码，加入下面这串代码",[48,1720,1723],{"className":1721,"code":1722,"language":1713,"meta":53},[1711],"/api/misystem/set_config_iotdev?bssid=Xiaomi&user_id=longdike&ssid=-h%3B%20echo%20-e%20'admin%5Cnadmin'%20%7C%20passwd%20root%3B\n",[37,1724,1722],{"__ignoreMap":53},[17,1726,1727],{},[714,1728],{"alt":1729,"src":1730},"需要被去除的 url 部分","https://static.031130.xyz/uploads/2024/08/12/6495ce20b91d1.webp",[17,1732,1733],{},[714,1734],{"alt":1735,"src":1736},"被截剩的 url 部分","https://static.031130.xyz/uploads/2024/08/12/6495ce1de2acd.webp",[17,1738,1739],{},"两次请求的正常反馈应该长成下面这个样子。",[17,1741,1742],{},[714,1743],{"alt":1744,"src":1745},"正常反馈","https://static.031130.xyz/uploads/2024/08/12/6495ce8d86b03.webp",[17,1747,1748],{},"此时应该就可以使用 ssh 访问路由器的 root 账户了，密码已经被改为了 admin",[48,1750,1754],{"className":1751,"code":1752,"language":1753,"meta":53,"style":53},"language-ba shiki shiki-themes one-light one-dark-pro","ssh -o HostKeyAlgorithms=+ssh-rsa -o PubkeyAcceptedKeyTypes=+ssh-rsa root@192.168.31.1\n","ba",[37,1755,1756],{"__ignoreMap":53},[57,1757,1758],{"class":59,"line":60},[57,1759,1752],{},[17,1761,1762],{},[714,1763],{"alt":1764,"src":1765},"登陆成功","https://static.031130.xyz/uploads/2024/08/12/6495cf0b224c4.webp",[21,1767,1769],{"id":1768},"刷入-breed","刷入 breed",[17,1771,1772],{},"如果用我在安卓刷机的经验来讲 breed 是什么的话，我会把他类比成第三方 Recovery (TWRP)。这是一个能够帮助你去输入系统、备份系统的恢复模式。虽然我们可以直接刷入 padavan，但如果系统没有自带镜像刷写工具或者输入的系统打不开了，那可能就是一台路由器的报废，或许得靠编程器才能救回来。",[17,1774,1775,1776],{},"首先，我们到 breed 下载站上下载 breed 的镜像: ",[29,1777,1778],{"href":1778,"rel":1779},"https://breed.hackpascal.net/",[33],[17,1781,1782],{},[714,1783],{"alt":1784,"src":1785},"需要下载的 breed 镜像","https://static.031130.xyz/uploads/2024/08/12/6495cf9ca81de.webp",[17,1787,1788,1789,1792,1793,1796],{},"随后，在电脑上这个存放了 breed 镜像的路径上开一个 http server，我这里选择的是 ",[37,1790,1791],{},"darkhttpd","，Windows 或者 MacOS 用户可以选择使用 ",[37,1794,1795],{},"miniserve","，他们呢起的是一样的效果，甚至可以使用 python 直接开一个 local server。",[17,1798,1799],{},[714,1800],{"alt":1801,"src":1802},"本地 http 服务","https://static.031130.xyz/uploads/2024/08/12/6495d0bd79f4c.webp",[17,1804,1805],{},"接下来，通过自己电脑在路由器局域网内的那个 ip 地址并添加端口号在浏览器上访问你开的 http server，直接右键复制 breed 镜像的下载链接。",[17,1807,1808],{},[714,1809],{"alt":1810,"src":1811},"查看本机 ip","https://static.031130.xyz/uploads/2024/08/12/6495d0bd79f4d.webp",[17,1813,1814],{},[714,1815],{"alt":1816,"src":1817},"复制下载链接","https://static.031130.xyz/uploads/2024/08/12/6495d10b09fe0.webp",[17,1819,1820,1821,1824],{},"将 ssh 连接到的路由器终端 cd 到 /tmp 路径下，使用 wget 命令去下载你刚刚复制到的 url，这样我们就简单地将 breed 镜像传输到了路由器的内存上。再使用 ",[37,1822,1823],{},"mtd -r write breed-mt7621-xiaomi-r3g.bin Bootloader"," 刷入 breed，刷入成功后 ssh 将会自动断开连接，但并不会直接进入 breed。",[17,1826,1827],{},[714,1828],{"alt":1829,"src":1830},"Screenshot_20230623_203903.png","https://static.031130.xyz/uploads/2024/08/12/6495d17602f3a.webp",[17,1832,1833],{},"我们需要先断开路由器的电源，使用一根针（比如取卡针）怼在 RESET 按钮上面，再次接通路由器的电源并持续按压 RESET 按钮几秒钟，浏览器这时就会进入 breed 状态，浏览器访问 192.168.1.1 就可以看到他的控制面板。",[17,1835,1836],{},[714,1837],{"alt":1838,"src":1839},"Breed Web 界面","https://static.031130.xyz/uploads/2024/08/12/6495d2129a764.webp",[21,1841,1843],{"id":1842},"刷入-padavan","刷入 Padavan",[17,1845,1846],{},"在 Breed 中拥有很多的功能，不过我们用到的只是「固件更新」这一个功能，备份功能什么的可以自己尝试，这只是一个可选项。",[17,1848,1849,1850],{},"首先去下载站下载适配 Redmi AC2100 的 Padavan 镜像: ",[29,1851,1852],{"href":1852,"rel":1853},"https://opt.cn2qq.com/padavan/",[33],[17,1855,1856],{},[714,1857],{"alt":1858,"src":1859},"适配 Redmi AC2100 的 Padavan 镜像","https://static.031130.xyz/uploads/2024/08/12/6495d5cbbb5b9.webp",[17,1861,1862],{},"然后在 Breed 的 web 端控制台直接选择 Padavan 的系统镜像进行固件更新",[17,1864,1865],{},[714,1866],{"alt":1867,"src":1868},"固件更新界面","https://static.031130.xyz/uploads/2024/08/12/6495d63261ad4.webp",[17,1870,1871],{},"确认后直接刷入",[17,1873,1874],{},[714,1875],{"alt":1876,"src":1877},"固件刷入中","https://static.031130.xyz/uploads/2024/08/12/6495d64fd1e0e.webp",[17,1879,1880],{},"自动重启后，Padavan 就刷入完成了。",[17,1882,1883],{},"Padavan 的默认 WIFI 名是 PDCN 和 PDCN_5G，WIFI 密码是 1234567890",[17,1885,1886],{},[714,1887],{"alt":1888,"src":1889},"Padavan 的默认 WIFI","https://static.031130.xyz/uploads/2024/08/12/6495d6c11aa01.webp",[17,1891,1892],{},"浏览器输入 192.168.123.1 就可以进入默认的后台管理页面，管理页面的用户名和密码都是 admin",[17,1894,1895],{},[714,1896],{"alt":1897,"src":725},"Padavan 设置界面",[608,1899,1900,1903,1910,1917],{},[17,1901,1902],{},"参考文章:",[17,1904,1905],{},[29,1906,1909],{"href":1907,"rel":1908},"https://www.bilibili.com/read/cv18237601/",[33],"《小米/红米AC2100刷OpenWrt/Padavan/第三方固件的详细教程（2022年8月23日更新）》",[17,1911,1912],{},[29,1913,1916],{"href":1914,"rel":1915},"https://zhuanlan.zhihu.com/p/260531160",[33],"《小米、红米 AC2100 一键开启 SSH，可自定义安装各种插件》",[17,1918,1919],{},[29,1920,1923],{"href":1921,"rel":1922},"https://blog.alanwei.com/blog/2022/01/24/ssh-no-matching-host-key-type-found/",[33],"《解决SSH no matching host key type found 问题》",[626,1925,1926],{},"html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}",{"title":53,"searchDepth":66,"depth":66,"links":1928},[1929,1930,1931,1932,1933],{"id":1619,"depth":66,"text":1619},{"id":1625,"depth":66,"text":1625},{"id":1673,"depth":66,"text":1674},{"id":1768,"depth":66,"text":1769},{"id":1842,"depth":66,"text":1843},{"title":1935,"date":1936,"path":1937,"tags":1938,"body":1940},"Azure 教育订阅申请时遇到的麻烦","2023-05-12 23:38:29","/2023/05/12/troubles-when-applying-azure-education",[1939],"Azure",{"type":14,"value":1941,"toc":2028},[1942,1949,1962,1968,1971,1977,1980,1983,1989,2001,2004,2010,2013,2019,2022],[17,1943,1944,1945,1948],{},"进入大学已经快一年了，但我的 Azure 教育订阅申请一直没有成功，每年有 100 刀的额度，",[708,1946,1947],{},"再这样下去就要亏掉近 700 元了","，于是便打算趁期中考试刚结束的闲暇时间把 Azure 的教育订阅给过了。",[17,1950,1951,1952,1956,1957,1961],{},"我拥有 *.edu.cn 的邮箱，并且通过了 Github Student Pack 的认证，但每次在 ",[29,1953,1954],{"href":1954,"rel":1955},"https://signup.azure.com/studentverification?offerType=1",[33]," 页面尝试申请 Azure 订阅时，总是会得到一句冷冷的「你没有资格使用 Azure 免费帐户」。于是，我找到了 Azure 订阅支持客服帮忙，链接是这个: ",[29,1958,1959],{"href":1959,"rel":1960},"https://azureforeducation.microsoft.com/en-us/institutions/Contact",[33],"，简要填写了我的基本信息后就开始等待邮件回复了。",[17,1963,1964],{},[714,1965],{"alt":1966,"src":1967},"提交工单","https://static.031130.xyz/uploads/2024/08/12/645e646bc5b58.webp",[17,1969,1970],{},"我是周四上午申请的，不到一个小时就等来了微软的工单生成通知",[17,1972,1973],{},[714,1974],{"alt":1975,"src":1976},"微软的工单通知","https://static.031130.xyz/uploads/2024/08/12/645e5fdfb25a3.webp",[17,1978,1979],{},"但光有这工单也没有用，我只能继续等人工客服的介入。",[17,1981,1982],{},"在周五的早上十点，我收到了来自人工客服的邮件，并且在几分钟后收到了来自人工客服的电话（电话是 021 开头的，是归属地为上海的座机打来的，但客服操着严重的港台口音，可能是港台那边的客服通过上海的座机中转打给我的？）:",[17,1984,1985],{},[714,1986],{"alt":1987,"src":1988},"人工客服的邮件","https://static.031130.xyz/uploads/2024/08/12/645e60ad79001.webp",[17,1990,1991,1992,1995,1996,2000],{},"但很显然，这封邮件并没有提供任何行之有效的方案，我只能按照邮件中的指示将我的截图发了过去。不过客服不知道出于什么原因一定要求全屏截图（如果电话说的是全面屏，那也是指 PC 端的全屏截图），可能是他们有什么工作制度吧。回复邮件的时候一定要选择",[649,1993,1994],{},"回复全部","，好像是他们只使用 ",[29,1997,1999],{"href":1998},"mailto:support@mail.support.microsoft.com","support@mail.support.microsoft.com"," 这一个邮箱与我们通信，微软的服务器收到内容后会将我们发送的内容再抄送给给我们分配的客服手上，如果不选择「回复全部」的话，客服可能就看不到之前的通信记录了。",[17,2002,2003],{},"于是就在当天下午的2点收到了人工客服的第二封邮件，说是已经帮我提交到了后台处理。",[17,2005,2006],{},[714,2007],{"alt":2008,"src":2009},"来自人工客服的第二封邮件","https://static.031130.xyz/uploads/2024/08/12/645e62bae0c0a.webp",[17,2011,2012],{},"20 分钟后，我收到了这封应该是系统自动发送的邮件，说明我的账号因异常而触发了审查所以过不了 Azure 的教育订阅，需要我提交能够佐证我的学生身份的东西上去，当晚7点我便按照要求回信。",[17,2014,2015],{},[714,2016],{"alt":2017,"src":2018},"1683907484369.png","https://static.031130.xyz/uploads/2024/08/12/645e639e2c9d1.webp",[17,2020,2021],{},"当晚8点半，我便收到了来自系统的消息，得知异常已经解除，再次申请 Azure 学生认证就成功了。",[17,2023,2024],{},[714,2025],{"alt":2026,"src":2027},"异常解除","https://static.031130.xyz/uploads/2024/08/12/645e63e39523f.webp",{"title":53,"searchDepth":66,"depth":66,"links":2029},[],{"title":2031,"date":2032,"path":2033,"tags":2034,"body":2036},"执行 repo sync 后将 git-lfs 中的资源文件 checkout","2023-05-03 01:15:35","/2023/05/03/checkout-lfs-file-after-repo-sync",[2035],"笔记",{"type":14,"value":2037,"toc":2117},[2038,2043,2058,2075,2085,2095,2114],[608,2039,2040],{},[17,2041,2042],{},"最近期中考试挺忙的，五一好不容易有一些自己的时间，于是打算重操旧业，搞点有意思的内容，没想到准备阶段就出了新问题，有点跟不上时代了",[17,2044,2045,2046,2049,2050,2053,2054,2057],{},"本次遇到的问题是在执行 ",[37,2047,2048],{},"repo sync"," 命令后储存在 git-lfs 中的文件没有被自动 pull 并 checkout 出来，尽管我在 ",[37,2051,2052],{},"repo init"," 阶段已经加了 ",[37,2055,2056],{},"--git-lfs"," 参数了。",[17,2059,2060,2061,2066,2067,2070,2071,2074],{},"上 google 简单查了查，查到一篇 ",[29,2062,2065],{"href":2063,"rel":2064},"https://stackoverflow.com/questions/67280310/how-to-run-git-lfs-automatically-after-repo-sync",[33],"stackoverflow"," 的回答，给出的思路是使用 ",[37,2068,2069],{},"repo forall -c 'git lfs pull'"," 的方案解决的，意思是在 repo 同步的每一个 git 仓库中都自动执行 ",[37,2072,2073],{},"git lfs pull"," 命令，但这个解决方案在我这有两个问题。",[2076,2077,2078,2082],"ul",{},[2079,2080,2081],"li",{},"仓库的 git-lfs 没有被安装，所以 git-lfs 会直接报错",[2079,2083,2084],{},"将整个安装源码一千多个仓库一一执行这些命令的速度太慢了",[17,2086,2087,2088,2091,2092],{},"解决方案也很简单，直接检测每个 git 仓库下是否存在 ",[37,2089,2090],{},".lfsconfg"," 文件，存在的话就执行 ",[37,2093,2094],{},"git lfs install && git lfs pull",[48,2096,2098],{"className":177,"code":2097,"language":179,"meta":53,"style":53},"repo forall -c 'test -e .lfsconfig && git lfs install && git lfs pull'\n",[37,2099,2100],{"__ignoreMap":53},[57,2101,2102,2105,2108,2111],{"class":59,"line":60},[57,2103,2104],{"class":186},"repo",[57,2106,2107],{"class":190}," forall",[57,2109,2110],{"class":879}," -c",[57,2112,2113],{"class":190}," 'test -e .lfsconfig && git lfs install && git lfs pull'\n",[626,2115,2116],{},"html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}",{"title":53,"searchDepth":66,"depth":66,"links":2118},[],{"title":2120,"date":2121,"path":2122,"tags":2123,"body":2124},"隐式转发——骚套路建站方案","2023-03-26 00:10:02","/2023/03/26/implicit-forwarding-is-a-new-site-deploying-method",[11],{"type":14,"value":2125,"toc":2361},[2126,2129,2135,2138,2146,2165,2168,2255,2258,2264,2271,2276,2279,2286,2291,2295,2298,2301,2315,2318,2336,2338,2358],[17,2127,2128],{},"其实很久以前就接触到了国内 DNS 解析服务商提供的这个「隐式 URL」 这种 “DNS 记录类型”了，但我域名没有备案，一直没有机会去体验。",[17,2130,2131],{},[714,2132],{"alt":2133,"src":2134},"DNSPOD 的解析面板中提供的记录类型","https://static.031130.xyz/uploads/2024/08/12/641f1e2cd8809.webp",[17,2136,2137],{},"今天社团内某个同学在折腾自己博客的时候又用到了「隐式 URL」，于是就借此机会了解了一下相关内容。",[17,2139,2140,2145],{},[29,2141,2144],{"href":2142,"rel":2143},"https://docs.dnspod.cn/dns/help-redirect-url/",[33],"DNSPOD 文档的描述","如下",[608,2147,2148],{},[17,2149,2150,2153,2154,2157,2158,2161,2162,2164],{},[649,2151,2152],{},"隐性转发","：用的是 iframe 框架技术、非重定向技术，效果为浏览器地址栏输入 ",[37,2155,2156],{},"http://www.dnspod.cn"," 回车，打开网站内容是目标地址 ",[37,2159,2160],{},"http://cloud.tencent.com/"," 的网站内容，但地址栏显示当前地址 ",[37,2163,2156],{}," 。",[17,2166,2167],{},"也就是说，所谓「隐式 URL」，只不过是域名解析的服务商用他们的服务器去响应了访客的请求，并回应了一段使用了 iframe 的 html 。这段代码打开了一个大小为 100% 的窗口去请求了被“隐式代理”的站点。我这位同学域名是备案在阿里云下的，阿里云所使用的 html 代码如下:",[48,2169,2173],{"className":2170,"code":2171,"language":2172,"meta":53,"style":53},"language-html shiki shiki-themes one-light one-dark-pro","\u003C!doctype html>\u003Chtml>\u003Cframeset rows=\"100%\">\u003Cframe src=\"http://example.com\">\u003Cnoframes>\u003Ca href=\"http://example.com\">Click here\u003C/a>\u003C/noframes>\u003C/frameset>\u003C/html>\n","html",[37,2174,2175],{"__ignoreMap":53},[57,2176,2177,2180,2183,2186,2189,2191,2193,2197,2200,2202,2205,2207,2210,2213,2215,2218,2220,2223,2225,2227,2230,2232,2234,2237,2239,2242,2244,2246,2248,2250,2252],{"class":59,"line":60},[57,2178,2179],{"class":872},"\u003C!",[57,2181,2182],{"class":838},"doctype",[57,2184,2185],{"class":879}," html",[57,2187,2188],{"class":872},">\u003C",[57,2190,2172],{"class":838},[57,2192,2188],{"class":872},[57,2194,2196],{"class":2195},"s-dj3","frameset",[57,2198,2199],{"class":879}," rows",[57,2201,900],{"class":872},[57,2203,2204],{"class":190},"\"100%\"",[57,2206,2188],{"class":872},[57,2208,2209],{"class":2195},"frame",[57,2211,2212],{"class":879}," src",[57,2214,900],{"class":872},[57,2216,2217],{"class":190},"\"http://example.com\"",[57,2219,2188],{"class":872},[57,2221,2222],{"class":2195},"noframes",[57,2224,2188],{"class":872},[57,2226,29],{"class":838},[57,2228,2229],{"class":879}," href",[57,2231,900],{"class":872},[57,2233,2217],{"class":190},[57,2235,2236],{"class":872},">Click here\u003C/",[57,2238,29],{"class":838},[57,2240,2241],{"class":872},">\u003C/",[57,2243,2222],{"class":2195},[57,2245,2241],{"class":872},[57,2247,2196],{"class":2195},[57,2249,2241],{"class":872},[57,2251,2172],{"class":838},[57,2253,2254],{"class":872},">\n",[17,2256,2257],{},"在下图中，我通过更改 hosts 文件实现将百度的域名在本地被解析到 localhost，并使用 iframe 标签将 b 站嵌入到页面中。当然，这并不能说明什么事情，不过是我个人的恶趣味罢了。",[17,2259,2260],{},[714,2261],{"alt":2262,"src":2263},"example","https://static.031130.xyz/uploads/2024/08/12/641f2272ab7fb.webp",[17,2265,2266,2267,2270],{},"将 ",[37,2268,2269],{},"http://example.com","改为目标站点，我们完全可以摆脱国内云服务商，在自己的服务器上直接实现「隐式代理」的效果。",[17,2272,2273],{},[649,2274,2275],{},"而这种方案，恰巧可以用于在境内机子上建站，尤其是针对未备案的域名。",[17,2277,2278],{},"碍于 Github Pages 在境内的访问体验并不好，所以直接把博客部署在 Github Pages 下一直都不是首选，因此很多人都会选择去购买一台境内的小鸡，带宽虽然不大，但跑个博客什么的其实没什么大问题，但备案就很麻烦了。",[17,2280,2281,2282,2285],{},"我们可以通过在 Github Pages（或者其他境外的服务器） 上挂一个 ",[37,2283,2284],{},"index.html"," ，html 中使用 iframe 嵌套一个部署在境内小鸡上的网页来规避掉备案的问题。而境内小鸡可以选用非标准端口去监听请求。",[714,2287],{"src":2288,"alt":2289,"style":2290},"https://static.031130.xyz/uploads/2024/08/12/642014b05bb43.webp","使用隐式转发","zoom:67%;",[714,2292],{"src":2293,"alt":2294,"style":2290},"https://static.031130.xyz/uploads/2024/08/12/642014519ce2a.webp","2.drawio.png",[17,2296,2297],{},"这样带来的好处是访客只需要从境外的服务器上获取一个不到 1 KB 大小的 html ，随后的所有请求都是指向境内云服务器的，所以网页打开时的体验会得到改善。",[17,2299,2300],{},"隐式转发拥有以下优势：",[2076,2302,2303,2306,2309,2312],{},[2079,2304,2305],{},"直接向境内的云服务器发送请求，速度会得到改善 （相比于直接部署在境外服务器上的方案）",[2079,2307,2308],{},"不怎么消耗境外服务器的流量 （相比于使用境外服务器反向代理的方案）",[2079,2310,2311],{},"浏览器的地址栏不会直接显示 ip 或端口号（相比于未备案使用境内服务器的非标准端口的方案）",[2079,2313,2314],{},"不需要备案（相比于备案后使用境内服务器的 80/443 端口的方案）",[17,2316,2317],{},"但也存在以下劣势：",[2076,2319,2320,2323,2330,2333],{},[2079,2321,2322],{},"移动端设备访问时好像还是会展示 PC 端的界面（存疑",[2079,2324,2325,2326,2329],{},"现代浏览器访问时可能会有 ",[37,2327,2328],{},"strict-origin-when-cross-origin"," 的问题（一般好像是出现在 iframe 的 html 是 https 访问，而目标站点是 http 访问的情况？）",[2079,2331,2332],{},"一些古老的浏览器可能不支持 iframe （？",[2079,2334,2335],{},"访问目标站点的其他路径时，浏览器地址栏的显示的地址不会变",[665,2337],{},[17,2339,2340,2341,2346,2347,2352,2353,697],{},"那么应",[29,2342,2345],{"href":2343,"rel":2344},"https://static.031130.xyz/uploads/2024/08/12/64201607999e3.webp",[33],"某些群友的要求","，本文的第二作者为 ",[29,2348,2351],{"href":2349,"rel":2350},"https://blog.f1nley.xyz",[33],"Finley","，通信作者为 ",[29,2354,2357],{"href":2355,"rel":2356},"https://blog.chordvers.com/",[33],"LanStarD",[626,2359,2360],{},"html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html pre.shiki code .sJa8x, html code.shiki .sJa8x{--shiki-default:#E45649;--shiki-dark:#E06C75}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html pre.shiki code .s-dj3, html code.shiki .s-dj3{--shiki-default:#000000;--shiki-dark:#FFFFFF}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}",{"title":53,"searchDepth":66,"depth":66,"links":2362},[],{"title":2364,"date":2365,"path":2366,"tags":2367,"body":2373},"在 vps 上配合 caddy 部署 siteproxy","2023-02-01 22:33:53","/2023/02/01/deploy-siteproxy-with-caddy-on-vps",[2368,2369,2370,2371,2372],"OpenSource Project","siteproxy","Archlinux","nodejs","Caddy",{"type":14,"value":2374,"toc":2786},[2375,2383,2390,2393,2408,2411,2415,2430,2486,2496,2500,2514,2517,2524,2527,2530,2572,2603,2608,2611,2689,2693,2700,2713,2720,2723,2736,2743,2749,2752,2755,2761,2768,2772,2779,2783],[17,2376,2377,2378,2382],{},"之前趁着春节活动的时候在某 vps 服务商买了 1 年的 vps，线路不算太好，但勉强够用，于是打算在上面部署一些反代程序。在群友的推荐下，发现了这款名为 ",[29,2379,2369],{"href":2380,"rel":2381},"https://github.com/netptop/siteproxy",[33]," 的开源项目。",[17,2384,2385,2386,2389],{},"siteproxy 相较于我在 ",[37,2387,2388],{},"r.zhullyb.top"," 部署的那个反代，其特点是可以运行在 vps 上，且将会替换被反代页面上的所有 url，因此遇到使用相对路径的网页也可以从容应对。",[17,2391,2392],{},"在项目的 README 中介绍了一种部署方案，但我仍有以下几点不太满意",[2076,2394,2395,2398,2405],{},[2079,2396,2397],{},"README 中的方案仅支持 nginx 部署，但我希望使用 caddy",[2079,2399,2400,2401,2404],{},"README 中的方案使用 npm 安装了 ",[37,2402,2403],{},"forever"," 来达到保活的目的，甚至为此安装了 nvm，但我一不希望使用 npm 在系统上安装软件、二不希望安装 nvm 与 forever",[2079,2406,2407],{},"原项目把根目录页做成了一个导航，指向了一些比较敏感的站点，而我希望换掉这个网页。",[17,2409,2410],{},"因此这篇博客也就应运而生。",[21,2412,2414],{"id":2413},"反代-8011-端口","反代 8011 端口",[17,2416,2417,2418,2421,2422,2426,2427,697],{},"根据项目 README 的描述，我们应当使用 nginx 去反代 ",[37,2419,2420],{},"127.0.0.1:8011"," 端口，但我是 caddy 用户，此前也",[29,2423,2425],{"href":2424},"/2022/05/30/use-caddy-to-proxy-wikipedia/","有过使用 caddy 反代","的经验，所以很容易写出一段使得程序可以正确运行的 ",[37,2428,2429],{},"Caddyfile",[48,2431,2435],{"className":2432,"code":2433,"language":2434,"meta":53,"style":53},"language-nginx shiki shiki-themes one-light one-dark-pro","example.com {\n        reverse_proxy   127.0.0.1:8011 {\n                header_up Host {upstream_hostport}\n                header_up X-Real-IP {http.request.remote.host}\n                header_up X-Forwarded-For {http.request.remote.host}\n                header_up X-Forwarded-Port {http.request.port}\n                header_up X-Forwarded-Proto {http.request.scheme}\n                header_up Accept-Encoding identity\n        }\n}\n","nginx",[37,2436,2437,2442,2447,2452,2457,2462,2467,2472,2477,2482],{"__ignoreMap":53},[57,2438,2439],{"class":59,"line":60},[57,2440,2441],{},"example.com {\n",[57,2443,2444],{"class":59,"line":66},[57,2445,2446],{},"        reverse_proxy   127.0.0.1:8011 {\n",[57,2448,2449],{"class":59,"line":72},[57,2450,2451],{},"                header_up Host {upstream_hostport}\n",[57,2453,2454],{"class":59,"line":78},[57,2455,2456],{},"                header_up X-Real-IP {http.request.remote.host}\n",[57,2458,2459],{"class":59,"line":84},[57,2460,2461],{},"                header_up X-Forwarded-For {http.request.remote.host}\n",[57,2463,2464],{"class":59,"line":90},[57,2465,2466],{},"                header_up X-Forwarded-Port {http.request.port}\n",[57,2468,2469],{"class":59,"line":96},[57,2470,2471],{},"                header_up X-Forwarded-Proto {http.request.scheme}\n",[57,2473,2474],{"class":59,"line":101},[57,2475,2476],{},"                header_up Accept-Encoding identity\n",[57,2478,2479],{"class":59,"line":107},[57,2480,2481],{},"        }\n",[57,2483,2484],{"class":59,"line":113},[57,2485,1018],{},[17,2487,2266,2488,2491,2492,2495],{},[37,2489,2490],{},"example.com"," 的 A 记录解析到 vps 主机的 ip，并使用 ",[37,2493,2494],{},"systemctl"," 重新启动 caddy，这一步就算完成了。",[21,2497,2499],{"id":2498},"安装-nodejs","安装 nodejs",[17,2501,2502,2503,2506,2507,2510,2511,2513],{},"我在 vps 上安装的发行版是 Archlinux，所以直接 ",[37,2504,2505],{},"pacman -S nodejs"," 安装完就是了，别的发行版应该也可以直接调用系统默认的包管理器安装 ",[37,2508,2509],{},"node"," 或者 ",[37,2512,2371],{}," 完成这一步。",[21,2515,2516],{"id":2516},"下载程序",[17,2518,2519,2520,2523],{},"首先，我们需要一个地方来存放我们下载的程序，我使用的是 ",[37,2521,2522],{},"/opt"," 路径。",[17,2525,2526],{},"我们可以直接根据 README 所说的，直接 clone 整个项目，但我本人并不想这么做，项目里似乎有太多对于 vps 用户没有用的东西了。此外，整个项目首页我也不想要，首页的导航指向了一些比较敏感的网站，而我的反代就想安安心心的一个人用。",[17,2528,2529],{},"综合以上需求，我所需要的文件一共就五个:",[48,2531,2533],{"className":177,"code":2532,"language":179,"meta":53,"style":53},"├── config.js\n├── index.js\n├── logger.js\n├── package.json\n└── Proxy.js\n",[37,2534,2535,2543,2550,2557,2564],{"__ignoreMap":53},[57,2536,2537,2540],{"class":59,"line":60},[57,2538,2539],{"class":186},"├──",[57,2541,2542],{"class":190}," config.js\n",[57,2544,2545,2547],{"class":59,"line":66},[57,2546,2539],{"class":186},[57,2548,2549],{"class":190}," index.js\n",[57,2551,2552,2554],{"class":59,"line":72},[57,2553,2539],{"class":186},[57,2555,2556],{"class":190}," logger.js\n",[57,2558,2559,2561],{"class":59,"line":78},[57,2560,2539],{"class":186},[57,2562,2563],{"class":190}," package.json\n",[57,2565,2566,2569],{"class":59,"line":84},[57,2567,2568],{"class":186},"└──",[57,2570,2571],{"class":190}," Proxy.js\n",[48,2573,2575],{"className":177,"code":2574,"language":179,"meta":53,"style":53},"mkdir -p /opt/siteproxy\ncd /opt/siteproxy\nwget https://raw.githubusercontent.com/netptop/siteproxy/master/{config.js,index.js,logger.js,package.json,Proxy.js}\n",[37,2576,2577,2588,2595],{"__ignoreMap":53},[57,2578,2579,2582,2585],{"class":59,"line":60},[57,2580,2581],{"class":186},"mkdir",[57,2583,2584],{"class":879}," -p",[57,2586,2587],{"class":190}," /opt/siteproxy\n",[57,2589,2590,2593],{"class":59,"line":66},[57,2591,2592],{"class":1135},"cd",[57,2594,2587],{"class":190},[57,2596,2597,2600],{"class":59,"line":72},[57,2598,2599],{"class":186},"wget",[57,2601,2602],{"class":190}," https://raw.githubusercontent.com/netptop/siteproxy/master/{config.js,index.js,logger.js,package.json,Proxy.js}\n",[17,2604,2605,2606],{},"然后补上一个 ",[37,2607,2284],{},[17,2609,2610],{},"我这边选择直接使用 JavaScript 将对于 / 的访问直接重定向到我的博客。",[48,2612,2616],{"className":2613,"code":2614,"language":2615,"meta":53,"style":53},"language-javascript shiki shiki-themes one-light one-dark-pro","\u003Chtml>\u003Chead>\u003Cmeta http-equiv=\"refresh\" content=\"0; url=https://zhul.in/\" />\u003C/head>\u003Cbody>Redirect to \u003Ca href=\"\">https://zhul.in/\u003C/a>\u003C/body>\u003C/html>\n","javascript",[37,2617,2618],{"__ignoreMap":53},[57,2619,2620,2623,2625,2627,2630,2632,2635,2639,2641,2644,2647,2649,2652,2655,2657,2659,2662,2665,2667,2669,2671,2674,2677,2679,2681,2683,2685,2687],{"class":59,"line":60},[57,2621,2622],{"class":872},"\u003C",[57,2624,2172],{"class":838},[57,2626,2188],{"class":872},[57,2628,2629],{"class":838},"head",[57,2631,2188],{"class":872},[57,2633,2634],{"class":838},"meta",[57,2636,2638],{"class":2637},"so_Uh"," http-equiv",[57,2640,900],{"class":842},[57,2642,2643],{"class":190},"\"refresh\"",[57,2645,2646],{"class":2637}," content",[57,2648,900],{"class":842},[57,2650,2651],{"class":190},"\"0; url=https://zhul.in/\"",[57,2653,2654],{"class":872}," />\u003C/",[57,2656,2629],{"class":838},[57,2658,2188],{"class":872},[57,2660,2661],{"class":838},"body",[57,2663,2664],{"class":872},">Redirect to \u003C",[57,2666,29],{"class":838},[57,2668,2229],{"class":2637},[57,2670,900],{"class":842},[57,2672,2673],{"class":190},"\"\"",[57,2675,2676],{"class":872},">https://zhul.in/\u003C/",[57,2678,29],{"class":838},[57,2680,2241],{"class":872},[57,2682,2661],{"class":838},[57,2684,2241],{"class":872},[57,2686,2172],{"class":838},[57,2688,2254],{"class":872},[2690,2691,2692],"h3",{"id":2692},"安装依赖",[17,2694,2695,2696,2699],{},"在 ",[37,2697,2698],{},"/opt/siteproxy"," 目录下执行",[48,2701,2703],{"className":177,"code":2702,"language":179,"meta":53,"style":53},"npm install\n",[37,2704,2705],{"__ignoreMap":53},[57,2706,2707,2710],{"class":59,"line":60},[57,2708,2709],{"class":186},"npm",[57,2711,2712],{"class":190}," install\n",[17,2714,2715,2716,2719],{},"npm 将会根据 ",[37,2717,2718],{},"package.json"," 的内容自动安装所需的依赖。",[21,2721,2722],{"id":2722},"修改配置文件",[48,2724,2726],{"className":177,"code":2725,"language":179,"meta":53,"style":53},"$EDITOR /opt/siteproxy/config.js\n",[37,2727,2728],{"__ignoreMap":53},[57,2729,2730,2733],{"class":59,"line":60},[57,2731,2732],{"class":838},"$EDITOR",[57,2734,2735],{"class":872}," /opt/siteproxy/config.js\n",[17,2737,2738,2739,2742],{},"按照 README 所说，修改 ",[37,2740,2741],{},"serverName"," 字段",[17,2744,2745],{},[714,2746],{"alt":2747,"src":2748},"需要修改的 serverName 字段","https://static.031130.xyz/uploads/2024/08/12/63da866e26712.webp",[21,2750,2751],{"id":2751},"设置开机自启动",[17,2753,2754],{},"这里我选择使用 systemd 帮助我实现 siteproxy 程序的开机自启动，service 文件是我直接根据 frp 程序提供的 service 改的。",[48,2756,2759],{"className":2757,"code":2758,"language":1713},[1711],"cat /usr/lib/systemd/system/siteproxy.service \n-----\n[Unit]\nDescription=SiteProxy\nAfter=network-online.target\nWants=network-online.target\n\n[Service]\nType=simple\nUser=nobody\nRestart=on-failure\nRestartSec=5s\nEnvironment=\"NODE_PATH=/opt/siteproxy/\"\nExecStart=node --tls-min-v1.0 /opt/siteproxy/index.js \n\n[Install]\nWantedBy=multi-user.target\n",[37,2760,2758],{"__ignoreMap":53},[17,2762,2763,2764,2767],{},"随后使用 ",[37,2765,2766],{},"systemctl enable siteproxy --now"," 启动即可访问。",[21,2769,2771],{"id":2770},"为反代站点添加访问密码可选","为反代站点添加访问密码（可选）",[17,2773,2774,2775,697],{},"参考",[29,2776,2778],{"href":2777},"/2021/10/21/picuploader-on-archlinux-with-caddy/#%E8%AE%BE%E7%BD%AE%E8%AE%BF%E9%97%AE%E5%AF%86%E7%A0%81%EF%BC%88%E5%8F%AF%E9%80%89%EF%BC%89","我的另一篇博客",[21,2780,2782],{"id":2781},"使用防火墙程序禁止-8011-的公网访问可选","使用防火墙程序禁止 8011 的公网访问（可选）",[626,2784,2785],{},"html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html pre.shiki code .s_Sar, html code.shiki .s_Sar{--shiki-default:#0184BC;--shiki-dark:#56B6C2}html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html pre.shiki code .sJa8x, html code.shiki .sJa8x{--shiki-default:#E45649;--shiki-dark:#E06C75}html pre.shiki code .so_Uh, html code.shiki .so_Uh{--shiki-default:#986801;--shiki-default-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic}html pre.shiki code .sknuh, html code.shiki .sknuh{--shiki-default:#383A42;--shiki-dark:#56B6C2}",{"title":53,"searchDepth":66,"depth":66,"links":2787},[2788,2789,2790,2793,2794,2795,2796],{"id":2413,"depth":66,"text":2414},{"id":2498,"depth":66,"text":2499},{"id":2516,"depth":66,"text":2516,"children":2791},[2792],{"id":2692,"depth":72,"text":2692},{"id":2722,"depth":66,"text":2722},{"id":2751,"depth":66,"text":2751},{"id":2770,"depth":66,"text":2771},{"id":2781,"depth":66,"text":2782},{"title":2798,"date":2799,"path":2800,"tags":2801,"body":2804},"onedrive(by abraunegg) —— 一个 Linux 下的开源 OneDrive 客户端(cli)","2022-12-24 22:40:13","/2022/12/24/onedrive-abraunegg-recommendation",[10,2370,2368,2802,2803],"Experience","OneDrive",{"type":14,"value":2805,"toc":3119},[2806,2814,2817,2826,2833,2852,2855,2866,2873,2879,2882,2893,2899,2905,2908,2919,2921,2948,2950,2957,2963,2991,2997,3003,3007,3016,3019,3022,3034,3037,3041,3047,3051,3057,3061,3066,3070,3075,3079,3088,3092,3098,3117],[608,2807,2808],{},[17,2809,2810,2811],{},"这款 Linux 下的 OneDrive 客户端我其实一年前就已经在用了，最近打算给自己的 vps 重装系统并重新部署下 aria 的下载服务，顺便把上传到 OneDrive 的功能增加进去，便又想到了这款运行在命令行中的第三方开源 Linux 客户端，去谷歌上搜索了一番，依然没有什么成规模的中文博客去写它的用法，于是就打算自己来写。",[708,2812,2813],{},"那肯定不是因为我博客这个月没有什么题材",[21,2815,2816],{"id":2816},"安装",[17,2818,2819,2820,2825],{},"abraunegg 用 D 语言写的 OneDrive 客户端安装起来并不是什么难事，Ubuntu/Debian/Fedora 等常见发行版的仓库中均有它的身影，具体情况在 ",[29,2821,2824],{"href":2822,"rel":2823},"https://github.com/abraunegg/onedrive/blob/master/docs/INSTALL.md",[33],"Github 项目页面","中都有描述。",[17,2827,2828,2829,2832],{},"在 Archlinux 下，我可以直接从 AUR/ArchlinuxCN 中安装 ",[37,2830,2831],{},"onedrive-abraunegg"," 这个包来安装这个项目。",[48,2834,2836],{"className":177,"code":2835,"language":179,"meta":53,"style":53},"sudo pacman -S onedrive-abraunegg\n",[37,2837,2838],{"__ignoreMap":53},[57,2839,2840,2843,2846,2849],{"class":59,"line":60},[57,2841,2842],{"class":186},"sudo",[57,2844,2845],{"class":190}," pacman",[57,2847,2848],{"class":879}," -S",[57,2850,2851],{"class":190}," onedrive-abraunegg\n",[21,2853,2854],{"id":2854},"运行前配置",[608,2856,2857],{},[17,2858,2859,2860,2865],{},"本章内容中的所用到的和没有用到的命令都可以在",[29,2861,2864],{"href":2862,"rel":2863},"https://github.com/abraunegg/onedrive/blob/master/docs/USAGE.md",[33],"该项目的 Github 仓库","中找到。",[17,2867,2868,2869,2872],{},"在终端直接运行 ",[37,2870,2871],{},"onedrive"," 命令，程序将打印出一行地址。",[17,2874,2875],{},[714,2876],{"alt":2877,"src":2878},"登陆地址","https://static.031130.xyz/uploads/2024/08/12/63a71dbfd6ed3.webp",[17,2880,2881],{},"使用浏览器打开地址，就会跳出微软的登陆页面，正常登陆即可。",[17,2883,2884,2885,2888,2889,2892],{},"登陆成功后，浏览器将会显示一片白屏，不必慌张，直接将浏览器地址栏中的网址复制后粘贴进终端中即可完成配置，获取到的 ",[37,2886,2887],{},"refresh_token"," 将会被保存到 ",[37,2890,2891],{},"$HOME/.config/onedrive"," 下。",[17,2894,2895],{},[714,2896],{"alt":2897,"src":2898},"浏览器显示白屏","https://static.031130.xyz/uploads/2024/08/12/63a71e1f9c916.webp",[17,2900,2901],{},[714,2902],{"alt":2903,"src":2904},"授权成功","https://static.031130.xyz/uploads/2024/08/12/63a71ec6d5aca.webp",[17,2906,2907],{},"账号授权成功以后我有两个迫切的需求需要在开始同步前解决:",[2076,2909,2910,2913],{},[2079,2911,2912],{},"我不希望把我 OneDrive 里所有的文件下载下来，我在 OneDrive 中存放了至少 1T 的数据，而我的系统盘就只有 512G，这绝对是放不下的，所以我想仅同步部分文件夹。",[2079,2914,2915,2916,2892],{},"我需要修改被同步到的文件夹的路径，我不想把 OneDrive 上的文件下载到我的 ",[37,2917,2918],{},"/home",[665,2920],{},[17,2922,2923,2924,2927,2928,2930,2931,2933,2934,2937,2938,2941,2942,2947],{},"要解决第一个需求，我们可以通过创建 ",[37,2925,2926],{},"sync_list"," 的方式指定我们要同步的文件，在 ",[37,2929,2891],{}," 路径下创建 ",[37,2932,2926],{}," ，并填入需要的文件或文件夹名，或在 ",[37,2935,2936],{},"!","或",[37,2939,2940],{},"-"," 后面写上不想同步的文件或文件夹名即可，支持通配符，在",[29,2943,2946],{"href":2944,"rel":2945},"https://github.com/abraunegg/onedrive/blob/master/docs/USAGE.md#performing-a-selective-sync-via-sync_list-file",[33],"原仓库的文档中","给出了非常详细的描述。",[665,2949],{},[17,2951,2952,2953,2956],{},"我们可以先使用 ",[37,2954,2955],{},"onedrive --display-config"," 命令查看我们当前的配置情况。（我这边直接应用 Github 文档中展示的内容）",[48,2958,2961],{"className":2959,"code":2960,"language":1713},[1711],"onedrive version                             = vX.Y.Z-A-bcdefghi\nConfig path                                  = /home/alex/.config/onedrive\nConfig file found in config path             = true\nConfig option 'sync_dir'                     = /home/alex/OneDrive\nConfig option 'enable_logging'               = false\n...\nSelective sync 'sync_list' configured        = false\nConfig option 'sync_business_shared_folders' = false\nBusiness Shared Folders configured           = false\nConfig option 'webhook_enabled'              = false\n",[37,2962,2960],{"__ignoreMap":53},[17,2964,2965,2966,2969,2970,2973,2974,2977,2978,2983,2984,2987,2988],{},"这很显然，OneDrive 中的文件默认将会被保存到 ",[37,2967,2968],{},"$HOME/OneDrive"," 中。为了修改这个位置项，我们直接在 ",[37,2971,2972],{},"$HOME/.config/onedrive/"," 路径下创建一个名为 ",[37,2975,2976],{},"config"," 的文件，把此处给的 c",[29,2979,2982],{"href":2980,"rel":2981},"https://github.com/abraunegg/onedrive/blob/master/docs/USAGE.md#the-default-configuration-file-is-listed-below",[33],"onfiguration examples"," 全部复制进去，找到 ",[37,2985,2986],{},"sync_dir"," 把前面的注释删掉，改成自己喜欢的路径 ",[708,2989,2990],{},"（别问我为什么写 /tmp，问就是我内存够大",[17,2992,2993],{},[714,2994],{"alt":2995,"src":2996},"修改同步路径！","https://static.031130.xyz/uploads/2024/08/12/63a7282ee55e7.webp",[17,2998,2999,3000,3002],{},"修改好此处的配置文件后，可以再次运行 ",[37,3001,2955],{}," 检查自己的配置文件格式有没有问题、自己更改的配置项有没有生效，这样就解决了我的第二个需求。",[21,3004,3006],{"id":3005},"standalone-mode-monitor-mode","Standalone Mode / Monitor Mode?",[17,3008,3009,3010,3015],{},"这款 OneDrive 客户端支持以两种方式运行，monitor 模式将会监控本地磁盘上的文件状态，因而在同步路径内的文件从一个路径移动到另一个路径时，客户端将不会傻傻地执行「在原路径删除远端文件-重新上传新路径的本地文件」的这一个过程，具体使用 monitor 或 standalone 模式还请自行斟酌，可参考 ",[29,3011,3014],{"href":3012,"rel":3013},"https://github.com/abraunegg/onedrive/blob/master/docs/known-issues.md#moving-files-into-different-folders-should-not-cause-data-to-delete-and-be-re-uploaded",[33],"Moving files into different folders should not cause data to delete and be re-uploaded"," .",[21,3017,3018],{"id":3018},"开始同步",[17,3020,3021],{},"使用该客户端执行同步的命令很简单，即",[48,3023,3025],{"className":177,"code":3024,"language":179,"meta":53,"style":53},"onedrive --synchronize\n",[37,3026,3027],{"__ignoreMap":53},[57,3028,3029,3031],{"class":59,"line":60},[57,3030,2871],{"class":186},[57,3032,3033],{"class":879}," --synchronize\n",[17,3035,3036],{},"但可选的运行参数很多，我只举出最常用的几个例子",[2690,3038,3040],{"id":3039},"dry-run","--dry-run",[17,3042,3043,3044,3046],{},"使用 ",[37,3045,3040],{}," 选项后，OneDrive 将不会执行同步操作，它将在终端输出原本将会被执行的操作以供你排查自己的配置是否正确。",[2690,3048,3050],{"id":3049},"local-first","--local-first",[17,3052,3053,3054,3056],{},"字面意思，",[37,3055,3050],{}," 即为本地优先，同步时如果遇到文件冲突将会优先参考本地的情况。",[2690,3058,3060],{"id":3059},"single-directory","--single-directory",[17,3062,3063,3065],{},[37,3064,3060],{}," 后面需要跟一个子文件夹在 OneDrive 根目录中的相对路径，这将使本次的同步操作仅对单个文件夹生效。",[2690,3067,3069],{"id":3068},"download-only","--download-only",[17,3071,3053,3072,3074],{},[37,3073,3069],{}," 即为仅下载模式。",[2690,3076,3078],{"id":3077},"upload-only","--upload-only",[17,3080,3053,3081,3083,3084,3087],{},[37,3082,3078],{},"即为仅上传模式，后跟 ",[37,3085,3086],{},"--no-remote-delete","将不会在 OneDrive 网盘中删除本地相较于网盘中缺少的文件，真正做到 upload only.",[2690,3089,3091],{"id":3090},"resync","--resync",[17,3093,3094,3095,3097],{},"当下列配置项被更改时，需要执行 ",[37,3096,3091],{}," 来确保客户端正在按照更新后的配置文件来同步你的数据",[2076,3099,3100,3102,3105,3108,3111,3114],{},[2079,3101,2986],{},[2079,3103,3104],{},"skip_dir",[2079,3106,3107],{},"skip_file",[2079,3109,3110],{},"drive_id",[2079,3112,3113],{},"Modifying sync_list",[2079,3115,3116],{},"Modifying business_shared_folders",[626,3118,2116],{},{"title":53,"searchDepth":66,"depth":66,"links":3120},[3121,3122,3123,3124],{"id":2816,"depth":66,"text":2816},{"id":2854,"depth":66,"text":2854},{"id":3005,"depth":66,"text":3006},{"id":3018,"depth":66,"text":3018,"children":3125},[3126,3127,3128,3129,3130,3131],{"id":3039,"depth":72,"text":3040},{"id":3049,"depth":72,"text":3050},{"id":3059,"depth":72,"text":3060},{"id":3068,"depth":72,"text":3069},{"id":3077,"depth":72,"text":3078},{"id":3090,"depth":72,"text":3091},{"title":3133,"date":3134,"path":3135,"tags":3136,"body":3139},"【翻译】关于2022年11月的事件的一些话[Z-Library]","2022-11-21 13:24:33","/2022/11/21/a-few-words-about-the-events-of-november-2022",[3137,3138],"翻译","Z-Library",{"type":14,"value":3140,"toc":3205},[3141,3152,3154,3165,3173,3178,3181,3186,3189,3199],[608,3142,3143],{},[17,3144,3145,3146,3151],{},"正如我们所知道的那样，Z-Library 的主域名在前不久已经被美国警方给 take down 了，目前仅剩下 Telegram Bot 和 Tor 网络两种访问方式是我们仍然可以信任的。在11月18日，Z-Library 于其博客上发布了",[29,3147,3150],{"href":3148,"rel":3149},"http://bookszlibb74ugqojhzhg2a63w5i2atv5bqarulgczawnbmsb6s6qead.onion/blog/36",[33],"一篇新的文章（onion链接）","，此处是我的翻译版本。",[665,3153],{},[608,3155,3156],{},[17,3157,3158,3159,3164],{},"As many of you know, on November 3rd most of our domains were seized and some our servers were suspended by the United States Department of  Justice and Federal Bureau of Investigation. In addition, on November 16 the United States Department of Justice ",[29,3160,3163],{"href":3161,"rel":3162},"https://www.justice.gov/usao-edny/pr/two-russian-nationals-charged-running-massive-e-book-piracy-website",[33],"published"," the indictment against two citizens of Russia, Anton and Valeria. They  are accused of criminal copyright infringement, wire fraud and money  laundering to operate the Z-Library.",[17,3166,3167,3168,3172],{},"正如你们大多数人所知道的那样，在11月3日，我们大多数的域名和一部分服务器被美国司法部和联邦调查局封禁了。此外，在11月16日，美国司法部出",[29,3169,3171],{"href":3161,"rel":3170},[33],"发布了","针对两个俄罗斯公民—— Anton 和 Valeria 的指控。他们因经营 Z-Library 而被指控犯有侵犯版权、电汇欺诈和洗钱等罪名。",[608,3174,3175],{},[17,3176,3177],{},"We refrain commenting on the alleged Anton and Valeria involvement in  the Z-Library project and the charges against them. We are very sorry  they are arrested. We also regret that some authors have suffered  because of Z-Library and ask for their forgiveness. We do our best to  respond to all complaints about files hosted in our library if it  violates author's rights.",[17,3179,3180],{},"我们不评论 Anton 和 Valeria 涉嫌参与 Z-Library 项目的行为以及对他们的指控。我们对他们的被捕感到非常抱歉，也对一些因为 Z-Library 而遭受的损失的作者表示歉意，并请求他们的原谅。如果我们的网站中托管的文件侵犯了作者的权利，我们会尽最大努力回应所有的投诉。",[608,3182,3183],{},[17,3184,3185],{},"We see the resonance recent events caused, we see how many  people support and believe in Z-Library. Thank you for your support, it  is extremely valuable to us. Thank you for each donation you make. You  are the ones who making the existence of the Z-Library possible. We  believe the knowledge and cultural heritage of mankind should be  accessible to all people around the world, regardless of their wealth,  social status, nationality, citizenship, etc. This is the only purpose  Z-Library is made for.",[17,3187,3188],{},"我们看到最近发生的事件所引起的共鸣，我们看到了有多少人支持并信任 Z-Library。 感谢您的支持，这对我们来说极其珍贵。我们感激您的每一笔捐款，你们是使 Z-Library 的存在成为可能的人。 我们认为，人类的知识和文化遗产应该为全世界所有人所用，无论其财富、社会地位、国籍、公民身份等，而这，正是 Z-Library 存在的唯一目的。",[608,3190,3191],{},[17,3192,3194,3195,3198],{"align":3193},"right","My makeup may be flaking",[3196,3197],"br",{},"But my smile still stays on",[17,3200,3201,3202,3204],{"align":3193},"我的妆容可能会脱落",[3196,3203],{},"但我的笑容将会永存",{"title":53,"searchDepth":66,"depth":66,"links":3206},[],{"title":3208,"date":3209,"path":3210,"tags":3211,"body":3214},"【已过期】使用 vercel+supabase 免费部署 umami","2022-11-08 13:37:53","/2022/11/08/free-umami-deploy-plan",[11,3212,2368,3213],"umami","vercel",{"type":14,"value":3215,"toc":3372},[3216,3227,3230,3233,3236,3242,3250,3264,3270,3273,3279,3285,3291,3297,3309,3315,3318,3324,3335,3341,3347,3353,3356,3362],[608,3217,3218,3224],{},[17,3219,3220,3221,697],{},"讲起静态网站的访客统计，我最先使用的是百度统计，但后来转到了 umeng，发现后续的几天百度爬虫的光顾次数反而多了起来。好家伙，使用百度统计相当于把自己网站访问量向百度全盘托出，",[708,3222,3223],{},"我说我的博客怎么还不被百度收录呢",[17,3225,3226],{},"后来，umeng 推出了新的服务条款，好像是说不再向未备案的站点提供服务，随后不得不转向自部署的开源网站统计程序。",[17,3228,3229],{},"umami 提供了多种部署方式，在 vps 上可以非常轻松地使用 docker 一键部署，但上次 vps 到期时用 1Mbps 的小水管拖了好久都没有把博客前几个月的访客数据拖下来，一气之下我选择直接丢掉了这些可有可无的数据。",[17,3231,3232],{},"所以这一次，我决定放弃在自己的 vps 上部署，转去探索免费的部署方案。",[17,3234,3235],{},"umami 的官方文档上提供了非常多的部署方案，我个人比较喜欢 vercel，本站的随机图片 api 就是挂在 vercel 上的，界面比较简洁，且境内访问还算OK。",[17,3237,3238],{},[714,3239],{"alt":3240,"src":3241},"umami官方文档提供的部署方案","https://static.031130.xyz/uploads/2024/08/12/6369ee9308dc3.webp",[17,3243,3244,3245,697],{},"但问题在于 vercel 本身并不提供免费的数据库，所以我们不得不去寻找一些长期免费提供数据库的供应商，我选择了 ",[29,3246,3249],{"href":3247,"rel":3248},"https://supabase.com/pricing",[33],"supabase",[17,3251,3252,3253,3256,3257,3260,3261],{},"在下图中选择顶栏的 ",[649,3254,3255],{},"Pricing"," 后看到这个 ",[649,3258,3259],{},"$0/month"," 就",[708,3262,3263],{},"疯狂戳烂这个 Get Started",[17,3265,3266],{},[714,3267],{"alt":3268,"src":3269},"supabase价目表","https://static.031130.xyz/uploads/2024/08/12/6369ef8d3451e.webp",[17,3271,3272],{},"随便填写个项目名然后输入一个足够强大的密码，地区选择美国就行，东部西部无所谓（毕竟我也不知道 vercel 的机房是在东部还是西部）",[17,3274,3275],{},[714,3276],{"alt":3277,"src":3278},"创建项目ing","https://static.031130.xyz/uploads/2024/08/12/6369f03faba15.webp",[17,3280,3281,3282],{},"看到这个小小的绿标就说明数据库正在初始化(",[708,3283,3284],{},"你先别急，让我先急",[17,3286,3287],{},[714,3288],{"alt":3289,"src":3290},"项目初始化中","https://static.031130.xyz/uploads/2024/08/12/6369f0d98a59c.webp",[17,3292,3293],{},[714,3294],{"alt":3295,"src":3296},"进行一通设置，把网站关闭后直接打入冷宫（x","https://static.031130.xyz/uploads/2024/08/12/6369f209c27aa.webp",[17,3298,3299,3300,3305,3306],{},"随后打开官方文档，点击其",[29,3301,3304],{"href":3302,"rel":3303},"https://umami.is/docs/running-on-vercel",[33],"描述 vercel 那一页","中大大的 ",[649,3307,3308],{},"Deploy",[17,3310,3311],{},[714,3312],{"alt":3313,"src":3314},"vercel on Document","https://static.031130.xyz/uploads/2024/08/12/6369f2bda5f78.webp",[17,3316,3317],{},"初始化过程中，vercel 会要求你创建一个 git 仓库，一般私有库就够了。",[17,3319,3320],{},[714,3321],{"alt":3322,"src":3323},"创建仓库","https://static.031130.xyz/uploads/2024/08/12/6369f33ccf6d0.webp",[17,3325,3326,3327,3330,3331,3334],{},"随后需要我们设置两个环境变量，第一个 ",[37,3328,3329],{},"DATABASE_URL"," 就是我们刚刚从 supabase 中复制下来并替换好 password 的 url，第二个 ",[37,3332,3333],{},"HASH_SALT","需要你随意生成一长串字符串~~（比如你可以找一个新手让他帮你退出 vim~~",[17,3336,3337],{},[714,3338],{"alt":3339,"src":3340},"设置环境变量","https://static.031130.xyz/uploads/2024/08/12/6369f3adbd34d.webp",[17,3342,3343,3344,3346],{},"点击 ",[649,3345,3308],{}," 并等上两分钟，我们就部署完啦（首页没东西，白屏是正常的",[17,3348,3349],{},[714,3350],{"alt":3351,"src":3352},"部署成功","https://static.031130.xyz/uploads/2024/08/12/6369f58f6acd4.webp",[17,3354,3355],{},"来到项目首页，点击任意域名即可访问到我们部署的 umami，不过 vercel 的域名近年来也有被污染的情况，建议在设置里绑定自己的域名。",[17,3357,3358],{},[714,3359],{"alt":3360,"src":3361},"项目首页","https://static.031130.xyz/uploads/2024/08/12/6369f5ec7a0e2.webp",[17,3363,3364,3365,3368,3369,3371],{},"哦对了，别忘了 umami 的默认用户名密码是",[37,3366,3367],{},"admin","和",[37,3370,3212],{},"，别到时候点击进去看到登陆框一脸懵，这是在文档里写过的。",{"title":53,"searchDepth":66,"depth":66,"links":3373},[],128,1762351285794]
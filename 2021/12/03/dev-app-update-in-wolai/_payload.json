[{"data":1,"prerenderedAt":336},["ShallowReactive",2],{"post-2021-12-03-dev-app-update-in-wolai-zh":3,"surround-2021-12-03-dev-app-update-in-wolai-zh":324,"randomIndex/2021/12/03/dev-app-update-in-wolai/":335},{"id":4,"title":5,"body":6,"date":309,"description":310,"extension":311,"lang":312,"meta":313,"navigation":314,"path":315,"rawbody":316,"seo":317,"stem":318,"sticky":319,"tags":320,"__hash__":323},"posts/posts/zh/dev-app-update-in-wolai.md","wolai再打包遇到的问题--electron应用的dev判断机制",{"type":7,"value":8,"toc":306},"minimark",[9,26,33,36,54,57,68,74,81,93,146,149,152,236,239,245,248,302],[10,11,12,13,20,21,25],"p",{},"之前对于electron懵懵懂懂的时候就把 ",[14,15,19],"a",{"href":16,"rel":17},"https://www.wolai.com/",[18],"nofollow","wolai"," 给打包上了 AUR ，那会儿年少无知，也不懂得把内置的 electron 拆开来换成系统内置的以节省空间。前一阵子给CN源打完 Motrix 以后突然想起来自己在 AUR 上还有维护一个叫 wolai 的electron 应用，于是打算把软件内置的 electron 拆出来。尝试使用 ",[22,23,24],"code",{},"electron /path/to/app.asar"," 命令启动的时候发现了以下的问题。",[10,27,28],{},[29,30],"img",{"alt":31,"src":32},"报错了","https://static.031130.xyz/uploads/2024/08/12/62f3caf822bec.webp",[10,34,35],{},"虽然这个报错无关紧要，直接右上角叉掉也不影响软件正常使用，但是就这样推上 AUR 似乎有些不太妥当。于是使用搜索引擎查找答案。",[10,37,38,39,42,43],{},"发现是使用系统自带的 electron 启动时，app.asar 内置的一个叫 ",[22,40,41],{},"electron-updater"," 的模块在自动检测更新时会误认为我们此时处于开发模式，于是会尝试读取 app.asar 内部的 dev-app-update.yml 以查询更新。",[44,45,46],"sup",{},[14,47,53],{"href":48,"ariaDescribedBy":49,"dataFootnoteRef":51,"id":52},"#user-content-fn-1",[50],"footnote-label","","user-content-fnref-1","1",[10,55,56],{},"但问题在于这个 app.asar 并不是 wolai 开发者在开发时使用 development 模式打出来的包，应该是 production ，所以内置的那个文件名叫 app-update.yml ，少了个dev 前缀，就很尴尬。",[10,58,59,60],{},"以下内容来自一篇简书的文章",[44,61,62],{},[14,63,67],{"href":64,"ariaDescribedBy":65,"dataFootnoteRef":51,"id":66},"#user-content-fn-2",[50],"user-content-fnref-2","2",[69,70,71],"blockquote",{},[10,72,73],{},"所以调试的时候可以建一个default-app.yml文件放在D:\\hzhh123\\workspace\\vue-work\\electron-demo1\\node_modules\\electron\\dist\\resources\\default_app.asar 下，这里就涉及到asar解压缩，但是这样会很麻烦，打包后也需要这样替换，麻烦，所幸electron-updater中提供了这个文件的属性配置updateConfigPath，可以通过设置这个属性来解决这个问题",[10,75,76,77,80],{},"很遗憾，我们并不是该应用的开发者，并不能指定",[22,78,79],{},"electron-uploader","构建时的参数，所以只能考虑解压缩 app.asar 手动放入 dev-app-update.yml 的方案。",[10,82,83,84,92],{},"根据又一篇简书的文章",[44,85,86],{},[14,87,91],{"href":88,"ariaDescribedBy":89,"dataFootnoteRef":51,"id":90},"#user-content-fn-3",[50],"user-content-fnref-3","3","，我们了解到 npm 中有一个叫 asar 的程序可以帮助我们解压缩 app.asar。我这里直接将内容搬过来",[69,94,95,98,125,128],{},[10,96,97],{},"解压",[99,100,104],"pre",{"className":101,"code":102,"language":103,"meta":51,"style":51},"language-bash shiki shiki-themes one-light one-dark-pro","asar extract 压缩文件  解压文件夹\n","bash",[22,105,106],{"__ignoreMap":51},[107,108,111,115,119,122],"span",{"class":109,"line":110},"line",1,[107,112,114],{"class":113},"sAdtL","asar",[107,116,118],{"class":117},"sDhpE"," extract",[107,120,121],{"class":117}," 压缩文件",[107,123,124],{"class":117},"  解压文件夹\n",[10,126,127],{},"压缩：如果压缩文件存在，则会被替换",[99,129,131],{"className":101,"code":130,"language":103,"meta":51,"style":51},"asar pack 文件夹  压缩文件名\n",[22,132,133],{"__ignoreMap":51},[107,134,135,137,140,143],{"class":109,"line":110},[107,136,114],{"class":113},[107,138,139],{"class":117}," pack",[107,141,142],{"class":117}," 文件夹",[107,144,145],{"class":117},"  压缩文件名\n",[10,147,148],{},"原文是让我们直接使用 npm 下载安装 asar 程序，然而这就会让打包过程变得很复杂，所幸 Archlinux 官方源中已经将这个程序打完了，我们可以直接将 asar 写入 makedepends。",[10,150,151],{},"大概就写成了这个样子。",[99,153,155],{"className":101,"code":154,"language":103,"meta":51,"style":51},"asar extract ${srcdir}/squashfs-root/resources/app.asar ${srcdir}/new_app\nmv  ${srcdir}/squashfs-root/resources/app-update.yml ${srcdir}/new_app/dev-app-update.yml\nasar pack ${srcdir}/new_app ${srcdir}/squashfs-root/resources/app.asar\n",[22,156,157,186,211],{"__ignoreMap":51},[107,158,159,161,163,167,171,174,177,179,181,183],{"class":109,"line":110},[107,160,114],{"class":113},[107,162,118],{"class":117},[107,164,166],{"class":165},"sr1Ac"," ${",[107,168,170],{"class":169},"sJa8x","srcdir",[107,172,173],{"class":165},"}",[107,175,176],{"class":117},"/squashfs-root/resources/app.asar",[107,178,166],{"class":165},[107,180,170],{"class":169},[107,182,173],{"class":165},[107,184,185],{"class":117},"/new_app\n",[107,187,189,192,195,197,199,202,204,206,208],{"class":109,"line":188},2,[107,190,191],{"class":113},"mv",[107,193,194],{"class":165},"  ${",[107,196,170],{"class":169},[107,198,173],{"class":165},[107,200,201],{"class":117},"/squashfs-root/resources/app-update.yml",[107,203,166],{"class":165},[107,205,170],{"class":169},[107,207,173],{"class":165},[107,209,210],{"class":117},"/new_app/dev-app-update.yml\n",[107,212,214,216,218,220,222,224,227,229,231,233],{"class":109,"line":213},3,[107,215,114],{"class":113},[107,217,139],{"class":117},[107,219,166],{"class":165},[107,221,170],{"class":169},[107,223,173],{"class":165},[107,225,226],{"class":117},"/new_app",[107,228,166],{"class":165},[107,230,170],{"class":169},[107,232,173],{"class":165},[107,234,235],{"class":117},"/squashfs-root/resources/app.asar\n",[10,237,238],{},"程序正常启动，没有弹出之前的对话框了。",[10,240,241],{},[29,242],{"alt":243,"src":244},"成功啦","https://static.031130.xyz/uploads/2024/08/12/62f3cafb6b04d.webp",[10,246,247],{},"参考:",[249,250,253,259],"section",{"className":251,"dataFootnotes":51},[252],"footnotes",[254,255,258],"h2",{"className":256,"id":50},[257],"sr-only","Footnotes",[260,261,262,278,290],"ol",{},[263,264,266,270,271],"li",{"id":265},"user-content-fn-1",[14,267,268],{"href":268,"rel":269},"https://github.com/electron-userland/electron-builder/issues/1505",[18]," ",[14,272,277],{"href":273,"ariaLabel":274,"className":275,"dataFootnoteBackref":51},"#user-content-fnref-1","Back to reference 1",[276],"data-footnote-backref","↩",[263,279,281,270,285],{"id":280},"user-content-fn-2",[14,282,283],{"href":283,"rel":284},"https://www.jianshu.com/p/15bde714e198",[18],[14,286,277],{"href":287,"ariaLabel":288,"className":289,"dataFootnoteBackref":51},"#user-content-fnref-2","Back to reference 2",[276],[263,291,293,270,297],{"id":292},"user-content-fn-3",[14,294,295],{"href":295,"rel":296},"https://www.jianshu.com/p/17d97e6bf174",[18],[14,298,277],{"href":299,"ariaLabel":300,"className":301,"dataFootnoteBackref":51},"#user-content-fnref-3","Back to reference 3",[276],[303,304,305],"style",{},"html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html pre.shiki code .sr1Ac, html code.shiki .sr1Ac{--shiki-default:#E45649;--shiki-dark:#ABB2BF}html pre.shiki code .sJa8x, html code.shiki .sJa8x{--shiki-default:#E45649;--shiki-dark:#E06C75}",{"title":51,"searchDepth":188,"depth":188,"links":307},[308],{"id":50,"depth":188,"text":258},"2021-12-03 22:53:25","之前对于electron懵懵懂懂的时候就把 wolai 给打包上了 AUR ，那会儿年少无知，也不懂得把内置的 electron 拆开来换成系统内置的以节省空间。前一阵子给CN源打完 Motrix 以后突然想起来自己在 AUR 上还有维护一个叫 wolai 的electron 应用，于是打算把软件内置的 electron 拆出来。尝试使用 electron /path/to/app.asar 命令启动的时候发现了以下的问题。","md","zh-CN",{},true,"/2021/12/03/dev-app-update-in-wolai","---\ntitle: wolai再打包遇到的问题--electron应用的dev判断机制\ndate: 2021-12-03 22:53:25\nsticky:\ntags:\n- Archlinux\n- electron\n---\n\n之前对于electron懵懵懂懂的时候就把 [wolai](https://www.wolai.com/) 给打包上了 AUR ，那会儿年少无知，也不懂得把内置的 electron 拆开来换成系统内置的以节省空间。前一阵子给CN源打完 Motrix 以后突然想起来自己在 AUR 上还有维护一个叫 wolai 的electron 应用，于是打算把软件内置的 electron 拆出来。尝试使用 `electron /path/to/app.asar` 命令启动的时候发现了以下的问题。\n\n![报错了](https://static.031130.xyz/uploads/2024/08/12/62f3caf822bec.webp)\n\n虽然这个报错无关紧要，直接右上角叉掉也不影响软件正常使用，但是就这样推上 AUR 似乎有些不太妥当。于是使用搜索引擎查找答案。\n\n发现是使用系统自带的 electron 启动时，app.asar 内置的一个叫 `electron-updater` 的模块在自动检测更新时会误认为我们此时处于开发模式，于是会尝试读取 app.asar 内部的 dev-app-update.yml 以查询更新。[^1]\n\n但问题在于这个 app.asar 并不是 wolai 开发者在开发时使用 development 模式打出来的包，应该是 production ，所以内置的那个文件名叫 app-update.yml ，少了个dev 前缀，就很尴尬。\n\n以下内容来自一篇简书的文章[^2]\n\n> 所以调试的时候可以建一个default-app.yml文件放在D:\\hzhh123\\workspace\\vue-work\\electron-demo1\\node_modules\\electron\\dist\\resources\\default_app.asar 下，这里就涉及到asar解压缩，但是这样会很麻烦，打包后也需要这样替换，麻烦，所幸electron-updater中提供了这个文件的属性配置updateConfigPath，可以通过设置这个属性来解决这个问题\n\n很遗憾，我们并不是该应用的开发者，并不能指定`electron-uploader`构建时的参数，所以只能考虑解压缩 app.asar 手动放入 dev-app-update.yml 的方案。\n\n根据又一篇简书的文章[^3]，我们了解到 npm 中有一个叫 asar 的程序可以帮助我们解压缩 app.asar。我这里直接将内容搬过来\n\n> 解压\n>\n> ```bash\n> asar extract 压缩文件  解压文件夹\n> ```\n>\n> 压缩：如果压缩文件存在，则会被替换\n>\n> ```bash\n> asar pack 文件夹  压缩文件名\n> ```\n\n原文是让我们直接使用 npm 下载安装 asar 程序，然而这就会让打包过程变得很复杂，所幸 Archlinux 官方源中已经将这个程序打完了，我们可以直接将 asar 写入 makedepends。\n\n大概就写成了这个样子。\n\n```bash\nasar extract ${srcdir}/squashfs-root/resources/app.asar ${srcdir}/new_app\nmv  ${srcdir}/squashfs-root/resources/app-update.yml ${srcdir}/new_app/dev-app-update.yml\nasar pack ${srcdir}/new_app ${srcdir}/squashfs-root/resources/app.asar\n```\n\n程序正常启动，没有弹出之前的对话框了。\n\n![成功啦](https://static.031130.xyz/uploads/2024/08/12/62f3cafb6b04d.webp)\n\n参考:\n\n[^1]: https://github.com/electron-userland/electron-builder/issues/1505\n[^2]: https://www.jianshu.com/p/15bde714e198\n[^3]: https://www.jianshu.com/p/17d97e6bf174\n\n",{"title":5,"description":310},"posts/zh/dev-app-update-in-wolai",false,[321,322],"Archlinux","electron","LM81kj8j8umKgQmrdvT1kRA5-_EOL5EzOZk42D9gZ4s",[325,330],{"title":326,"path":327,"stem":328,"date":329,"lang":312,"children":-1},"Cutefish的前世今生","/2021/12/12/the-history-of-cutefish","posts/zh/the-history-of-cutefish","2021-12-12 00:10:34",{"title":331,"path":332,"stem":333,"date":334,"lang":312,"children":-1},"Typora与我","/2021/11/26/typora-and-me","posts/zh/typora-and-me","2021-11-26 23:05:05",6,1763635478961]
[{"data":1,"prerenderedAt":1062},["ShallowReactive",2],{"post-2021-10-21-picuploader-on-archlinux-with-caddy-zh":3,"surround-2021-10-21-picuploader-on-archlinux-with-caddy-zh":1049,"randomIndex/2021/10/21/picuploader-on-archlinux-with-caddy/":148,"language-switch-/2021/10/21/picuploader-on-archlinux-with-caddy/-en":1061},{"title":4,"date":5,"path":6,"tags":7,"body":12,"description":53},"PicUploader使用系列（一）——在Archlinux上使用Caddy部署PicUploader","2021-10-21 22:15:33","/2021/10/21/picuploader-on-archlinux-with-caddy",[8,9,10,11],"Archlinux","Caddy","PicUploader","PHP",{"type":13,"value":14,"toc":1030},"minimark",[15,33,47,88,94,103,127,393,400,406,421,428,585,596,783,787,790,808,811,832,835,855,859,866,869,876,884,898,902,909,933,936,942,946,949,967,970,973,981,1004,1007,1015,1018,1026],[16,17,18,22],"blockquote",{},[19,20,21],"p",{},"之前找对大陆网络友好的图床时，找到了cloudinary，但是全英文界面对操作增加了不少难度，其页面也不是很简洁，让我一下打消了使用网页版的念头。通过搜索，找到了 PicUploader 这一方案，使用php编写，支持cloudinary的api。",[19,23,24,25,32],{},"作者在其",[26,27,31],"a",{"href":28,"rel":29},"https://www.xiebruce.top/17.html",[30],"nofollow","博客","中仅提供了nginx的部署方案，我参考其配置文件成功实现了在caddy下的部署，并且花费了数个小时排坑，故写下本文帮助后来者节省时间。",[34,35,37,38,42,43,46],"h2",{"id":36},"安装caddy和php-fpm以及所需的拓展","安装",[39,40,41],"code",{},"caddy","和",[39,44,45],{},"php-fpm","以及所需的拓展",[48,49,54],"pre",{"className":50,"code":51,"language":52,"meta":53,"style":53},"language-bash shiki shiki-themes one-light one-dark-pro","sudo pacman -S caddy php-fpm php-gd php-sqlite --needed\n","bash","",[39,55,56],{"__ignoreMap":53},[57,58,61,65,69,73,76,79,82,85],"span",{"class":59,"line":60},"line",1,[57,62,64],{"class":63},"sAdtL","sudo",[57,66,68],{"class":67},"sDhpE"," pacman",[57,70,72],{"class":71},"sAGMh"," -S",[57,74,75],{"class":67}," caddy",[57,77,78],{"class":67}," php-fpm",[57,80,81],{"class":67}," php-gd",[57,83,84],{"class":67}," php-sqlite",[57,86,87],{"class":71}," --needed\n",[34,89,91,92],{"id":90},"配置php-fpm","配置",[39,93,45],{},[95,96,98,99,102],"h3",{"id":97},"在etcphpphpini启用picuploader所需拓展","在",[39,100,101],{},"/etc/php/php.ini","启用PicUploader所需拓展",[19,104,105,106,109,110,109,113,109,116,109,119,122,123,126],{},"PicUploaer依赖于",[39,107,108],{},"fileinfo","、",[39,111,112],{},"gd",[39,114,115],{},"curl",[39,117,118],{},"exif",[39,120,121],{},"pdo_sqlite","拓展，可以使用",[39,124,125],{},"php -m","命令来查看目前加载成功了的插件。",[48,128,132],{"className":129,"code":130,"language":131,"meta":53,"style":53},"language-diff shiki shiki-themes one-light one-dark-pro",";extension=bcmath\n;extension=bz2\n;extension=calendar\n- extension=curl\n+ extension=curl\n;extension=dba\n;extension=enchant\n- extension=exif\n+ extension=exif\n;extension=ffi\n;extension=ftp\n- extension=gd\n+ extension=gd\n;extension=gettext\n;extension=gmp\n;extension=iconv\n;extension=imap\n;extension=intl\n;extension=ldap\n;extension=mysqli\n;extension=odbc\n;zend_extension=opcache\n;extension=pdo_dblib\n;extension=pdo_mysql\n;extension=pdo_odbc\n;extension=pdo_pgsql\n- extension=pdo_sqlite\n+ extension=pdo_sqlite\n;extension=pgsql\n;extension=pspell\n;extension=shmop\n;extension=snmp\n;extension=soap\n;extension=sockets\n;extension=sodium\n;extension=sqlite3\n;extension=sysvmsg\n;extension=sysvsem\n;extension=sysvshm\n;extension=tidy\n;extension=xmlrpc\n;extension=xsl\nextension=zip\n","diff",[39,133,134,140,146,152,159,165,171,177,183,189,195,201,207,213,219,225,231,237,243,249,255,261,267,273,279,285,291,297,303,309,315,321,327,333,339,345,351,357,363,369,375,381,387],{"__ignoreMap":53},[57,135,136],{"class":59,"line":60},[57,137,139],{"class":138},"s5ixo",";extension=bcmath\n",[57,141,143],{"class":59,"line":142},2,[57,144,145],{"class":138},";extension=bz2\n",[57,147,149],{"class":59,"line":148},3,[57,150,151],{"class":138},";extension=calendar\n",[57,153,155],{"class":59,"line":154},4,[57,156,158],{"class":157},"sJa8x","- extension=curl\n",[57,160,162],{"class":59,"line":161},5,[57,163,164],{"class":67},"+ extension=curl\n",[57,166,168],{"class":59,"line":167},6,[57,169,170],{"class":138},";extension=dba\n",[57,172,174],{"class":59,"line":173},7,[57,175,176],{"class":138},";extension=enchant\n",[57,178,180],{"class":59,"line":179},8,[57,181,182],{"class":157},"- extension=exif\n",[57,184,186],{"class":59,"line":185},9,[57,187,188],{"class":67},"+ extension=exif\n",[57,190,192],{"class":59,"line":191},10,[57,193,194],{"class":138},";extension=ffi\n",[57,196,198],{"class":59,"line":197},11,[57,199,200],{"class":138},";extension=ftp\n",[57,202,204],{"class":59,"line":203},12,[57,205,206],{"class":157},"- extension=gd\n",[57,208,210],{"class":59,"line":209},13,[57,211,212],{"class":67},"+ extension=gd\n",[57,214,216],{"class":59,"line":215},14,[57,217,218],{"class":138},";extension=gettext\n",[57,220,222],{"class":59,"line":221},15,[57,223,224],{"class":138},";extension=gmp\n",[57,226,228],{"class":59,"line":227},16,[57,229,230],{"class":138},";extension=iconv\n",[57,232,234],{"class":59,"line":233},17,[57,235,236],{"class":138},";extension=imap\n",[57,238,240],{"class":59,"line":239},18,[57,241,242],{"class":138},";extension=intl\n",[57,244,246],{"class":59,"line":245},19,[57,247,248],{"class":138},";extension=ldap\n",[57,250,252],{"class":59,"line":251},20,[57,253,254],{"class":138},";extension=mysqli\n",[57,256,258],{"class":59,"line":257},21,[57,259,260],{"class":138},";extension=odbc\n",[57,262,264],{"class":59,"line":263},22,[57,265,266],{"class":138},";zend_extension=opcache\n",[57,268,270],{"class":59,"line":269},23,[57,271,272],{"class":138},";extension=pdo_dblib\n",[57,274,276],{"class":59,"line":275},24,[57,277,278],{"class":138},";extension=pdo_mysql\n",[57,280,282],{"class":59,"line":281},25,[57,283,284],{"class":138},";extension=pdo_odbc\n",[57,286,288],{"class":59,"line":287},26,[57,289,290],{"class":138},";extension=pdo_pgsql\n",[57,292,294],{"class":59,"line":293},27,[57,295,296],{"class":157},"- extension=pdo_sqlite\n",[57,298,300],{"class":59,"line":299},28,[57,301,302],{"class":67},"+ extension=pdo_sqlite\n",[57,304,306],{"class":59,"line":305},29,[57,307,308],{"class":138},";extension=pgsql\n",[57,310,312],{"class":59,"line":311},30,[57,313,314],{"class":138},";extension=pspell\n",[57,316,318],{"class":59,"line":317},31,[57,319,320],{"class":138},";extension=shmop\n",[57,322,324],{"class":59,"line":323},32,[57,325,326],{"class":138},";extension=snmp\n",[57,328,330],{"class":59,"line":329},33,[57,331,332],{"class":138},";extension=soap\n",[57,334,336],{"class":59,"line":335},34,[57,337,338],{"class":138},";extension=sockets\n",[57,340,342],{"class":59,"line":341},35,[57,343,344],{"class":138},";extension=sodium\n",[57,346,348],{"class":59,"line":347},36,[57,349,350],{"class":138},";extension=sqlite3\n",[57,352,354],{"class":59,"line":353},37,[57,355,356],{"class":138},";extension=sysvmsg\n",[57,358,360],{"class":59,"line":359},38,[57,361,362],{"class":138},";extension=sysvsem\n",[57,364,366],{"class":59,"line":365},39,[57,367,368],{"class":138},";extension=sysvshm\n",[57,370,372],{"class":59,"line":371},40,[57,373,374],{"class":138},";extension=tidy\n",[57,376,378],{"class":59,"line":377},41,[57,379,380],{"class":138},";extension=xmlrpc\n",[57,382,384],{"class":59,"line":383},42,[57,385,386],{"class":138},";extension=xsl\n",[57,388,390],{"class":59,"line":389},43,[57,391,392],{"class":138},"extension=zip\n",[95,394,396,397,399],{"id":395},"编辑etcphpphpini以增加单文件上传大小限制","编辑",[39,398,101],{},"以增加单文件上传大小限制",[19,401,402],{},[403,404,405],"del",{},"查出这个问题浪费了我整整4小时时间。",[48,407,409],{"className":129,"code":408,"language":131,"meta":53,"style":53},"- upload_max_filesize = 2M\n+ upload_max_filesize = 100M\n",[39,410,411,416],{"__ignoreMap":53},[57,412,413],{"class":59,"line":60},[57,414,415],{"class":157},"- upload_max_filesize = 2M\n",[57,417,418],{"class":59,"line":142},[57,419,420],{"class":67},"+ upload_max_filesize = 100M\n",[95,422,396,424,427],{"id":423},"编辑etcphpphp-fpmdwwwconf使其在运行时使用caddy用户",[39,425,426],{},"/etc/php/php-fpm.d/www.conf","使其在运行时使用caddy用户。",[48,429,431],{"className":129,"code":430,"language":131,"meta":53,"style":53},"---\n; Unix user/group of processes\n; Note: The user is mandatory. If the group is not set, the default user's group\n;       will be used.\n- user = http\n+ user = caddy\n- group = http\n+ group = caddy\n; The address on which to accept FastCGI requests.\n; Valid syntaxes are:\n;   'ip.add.re.ss:port'    - to listen on a TCP socket to a specific IPv4 address on\n;                            a specific port;\n;   '[ip:6:addr:ess]:port' - to listen on a TCP socket to a specific IPv6 address on\n---\n---\n; Note: This value is mandatory.\nlisten = /run/php-fpm/php-fpm.sock\n; and group can be specified either by name or by their numeric IDs.\n; Default Values: user and group are set as the running user\n;                 mode is set to 0660\n- listen.owner = http\n+ listen.owner = caddy\n- listen.group = http\n+ listen.group = caddy\n;listen.mode = 0660\n; When POSIX Access Control Lists are supported you can set them using\n; these options, value is a comma separated list of user/group names.\n; When set, listen.owner and listen.group are ignored\n;listen.acl_users =\n;listen.acl_groups =\n---\n",[39,432,433,438,443,448,453,458,463,468,473,478,483,488,493,498,502,506,511,516,521,526,531,536,541,546,551,556,561,566,571,576,581],{"__ignoreMap":53},[57,434,435],{"class":59,"line":60},[57,436,437],{"class":138},"---\n",[57,439,440],{"class":59,"line":142},[57,441,442],{"class":138},"; Unix user/group of processes\n",[57,444,445],{"class":59,"line":148},[57,446,447],{"class":138},"; Note: The user is mandatory. If the group is not set, the default user's group\n",[57,449,450],{"class":59,"line":154},[57,451,452],{"class":138},";       will be used.\n",[57,454,455],{"class":59,"line":161},[57,456,457],{"class":157},"- user = http\n",[57,459,460],{"class":59,"line":167},[57,461,462],{"class":67},"+ user = caddy\n",[57,464,465],{"class":59,"line":173},[57,466,467],{"class":157},"- group = http\n",[57,469,470],{"class":59,"line":179},[57,471,472],{"class":67},"+ group = caddy\n",[57,474,475],{"class":59,"line":185},[57,476,477],{"class":138},"; The address on which to accept FastCGI requests.\n",[57,479,480],{"class":59,"line":191},[57,481,482],{"class":138},"; Valid syntaxes are:\n",[57,484,485],{"class":59,"line":197},[57,486,487],{"class":138},";   'ip.add.re.ss:port'    - to listen on a TCP socket to a specific IPv4 address on\n",[57,489,490],{"class":59,"line":203},[57,491,492],{"class":138},";                            a specific port;\n",[57,494,495],{"class":59,"line":209},[57,496,497],{"class":138},";   '[ip:6:addr:ess]:port' - to listen on a TCP socket to a specific IPv6 address on\n",[57,499,500],{"class":59,"line":215},[57,501,437],{"class":138},[57,503,504],{"class":59,"line":221},[57,505,437],{"class":138},[57,507,508],{"class":59,"line":227},[57,509,510],{"class":138},"; Note: This value is mandatory.\n",[57,512,513],{"class":59,"line":233},[57,514,515],{"class":138},"listen = /run/php-fpm/php-fpm.sock\n",[57,517,518],{"class":59,"line":239},[57,519,520],{"class":138},"; and group can be specified either by name or by their numeric IDs.\n",[57,522,523],{"class":59,"line":245},[57,524,525],{"class":138},"; Default Values: user and group are set as the running user\n",[57,527,528],{"class":59,"line":251},[57,529,530],{"class":138},";                 mode is set to 0660\n",[57,532,533],{"class":59,"line":257},[57,534,535],{"class":157},"- listen.owner = http\n",[57,537,538],{"class":59,"line":263},[57,539,540],{"class":67},"+ listen.owner = caddy\n",[57,542,543],{"class":59,"line":269},[57,544,545],{"class":157},"- listen.group = http\n",[57,547,548],{"class":59,"line":275},[57,549,550],{"class":67},"+ listen.group = caddy\n",[57,552,553],{"class":59,"line":281},[57,554,555],{"class":138},";listen.mode = 0660\n",[57,557,558],{"class":59,"line":287},[57,559,560],{"class":138},"; When POSIX Access Control Lists are supported you can set them using\n",[57,562,563],{"class":59,"line":293},[57,564,565],{"class":138},"; these options, value is a comma separated list of user/group names.\n",[57,567,568],{"class":59,"line":299},[57,569,570],{"class":138},"; When set, listen.owner and listen.group are ignored\n",[57,572,573],{"class":59,"line":305},[57,574,575],{"class":138},";listen.acl_users =\n",[57,577,578],{"class":59,"line":311},[57,579,580],{"class":138},";listen.acl_groups =\n",[57,582,583],{"class":59,"line":317},[57,584,437],{"class":138},[19,586,587,591,592,595],{},[588,589,590],"strong",{},"2022年1月14日更新","：在 Fedora 尝试部署的时候遇到了新的坑，Fedora 的相应配置文件为 ",[39,593,594],{},"/etc/php-fpm.d/www.conf","，相应修改如下",[48,597,599],{"className":129,"code":598,"language":131,"meta":53,"style":53},"; Unix user/group of processes\n; Note: The user is mandatory. If the group is not set, the default user's group\n;       will be used.\n; RPM: apache user chosen to provide access to the same directories as httpd\n-user = apache\n+user = caddy\n; RPM: Keep a group allowed to write in log dir.\n-user = apache\n+group = caddy\n\n; The address on which to accept FastCGI requests.\n; Valid syntaxes are:\n;   'ip.add.re.ss:port'    - to listen on a TCP socket to a specific IPv4 address on\n;             a specific port;\n---\n---\n; Set permissions for unix socket, if one is used. In Linux, read/write\n; permissions must be set in order to allow connections from a web server.\n; Default Values: user and group are set as the running user\n;                 mode is set to 0660\n-;listen.owner = nobody\n+listen.owner = caddy\n-;listen.owner = nobody\n+listen.group = caddy\n;listen.mode = 0660\n\n; When POSIX Access Control Lists are supported you can set them using\n; these options, value is a comma separated list of user/group names.\n; When set, listen.owner and listen.group are ignored\n-listen.acl_users = apache,nginx\n+;listen.acl_users = apache,nginx\n;listen.acl_groups =\n\n; List of addresses (IPv4/IPv6) of FastCGI clients which are allowed to connect.\n; Equivalent to the FCGI_WEB_SERVER_ADDRS environment variable in the original\n; PHP FCGI (5.2.2+). Makes sense only with a tcp listening socket. Each address\n; must be separated by a comma. If this value is left blank, connections will be\n; accepted from any ip address.\n; Default Value: any\nlisten.allowed_clients = 127.0.0.1\n",[39,600,601,605,609,613,618,623,628,633,637,642,648,652,656,660,665,669,673,678,683,687,691,696,701,705,710,714,718,722,726,730,735,740,744,748,753,758,763,768,773,778],{"__ignoreMap":53},[57,602,603],{"class":59,"line":60},[57,604,442],{"class":138},[57,606,607],{"class":59,"line":142},[57,608,447],{"class":138},[57,610,611],{"class":59,"line":148},[57,612,452],{"class":138},[57,614,615],{"class":59,"line":154},[57,616,617],{"class":138},"; RPM: apache user chosen to provide access to the same directories as httpd\n",[57,619,620],{"class":59,"line":161},[57,621,622],{"class":157},"-user = apache\n",[57,624,625],{"class":59,"line":167},[57,626,627],{"class":67},"+user = caddy\n",[57,629,630],{"class":59,"line":173},[57,631,632],{"class":138},"; RPM: Keep a group allowed to write in log dir.\n",[57,634,635],{"class":59,"line":179},[57,636,622],{"class":157},[57,638,639],{"class":59,"line":185},[57,640,641],{"class":67},"+group = caddy\n",[57,643,644],{"class":59,"line":191},[57,645,647],{"emptyLinePlaceholder":646},true,"\n",[57,649,650],{"class":59,"line":197},[57,651,477],{"class":138},[57,653,654],{"class":59,"line":203},[57,655,482],{"class":138},[57,657,658],{"class":59,"line":209},[57,659,487],{"class":138},[57,661,662],{"class":59,"line":215},[57,663,664],{"class":138},";             a specific port;\n",[57,666,667],{"class":59,"line":221},[57,668,437],{"class":138},[57,670,671],{"class":59,"line":227},[57,672,437],{"class":138},[57,674,675],{"class":59,"line":233},[57,676,677],{"class":138},"; Set permissions for unix socket, if one is used. In Linux, read/write\n",[57,679,680],{"class":59,"line":239},[57,681,682],{"class":138},"; permissions must be set in order to allow connections from a web server.\n",[57,684,685],{"class":59,"line":245},[57,686,525],{"class":138},[57,688,689],{"class":59,"line":251},[57,690,530],{"class":138},[57,692,693],{"class":59,"line":257},[57,694,695],{"class":157},"-;listen.owner = nobody\n",[57,697,698],{"class":59,"line":263},[57,699,700],{"class":67},"+listen.owner = caddy\n",[57,702,703],{"class":59,"line":269},[57,704,695],{"class":157},[57,706,707],{"class":59,"line":275},[57,708,709],{"class":67},"+listen.group = caddy\n",[57,711,712],{"class":59,"line":281},[57,713,555],{"class":138},[57,715,716],{"class":59,"line":287},[57,717,647],{"emptyLinePlaceholder":646},[57,719,720],{"class":59,"line":293},[57,721,560],{"class":138},[57,723,724],{"class":59,"line":299},[57,725,565],{"class":138},[57,727,728],{"class":59,"line":305},[57,729,570],{"class":138},[57,731,732],{"class":59,"line":311},[57,733,734],{"class":157},"-listen.acl_users = apache,nginx\n",[57,736,737],{"class":59,"line":317},[57,738,739],{"class":67},"+;listen.acl_users = apache,nginx\n",[57,741,742],{"class":59,"line":323},[57,743,580],{"class":138},[57,745,746],{"class":59,"line":329},[57,747,647],{"emptyLinePlaceholder":646},[57,749,750],{"class":59,"line":335},[57,751,752],{"class":138},"; List of addresses (IPv4/IPv6) of FastCGI clients which are allowed to connect.\n",[57,754,755],{"class":59,"line":341},[57,756,757],{"class":138},"; Equivalent to the FCGI_WEB_SERVER_ADDRS environment variable in the original\n",[57,759,760],{"class":59,"line":347},[57,761,762],{"class":138},"; PHP FCGI (5.2.2+). Makes sense only with a tcp listening socket. Each address\n",[57,764,765],{"class":59,"line":353},[57,766,767],{"class":138},"; must be separated by a comma. If this value is left blank, connections will be\n",[57,769,770],{"class":59,"line":359},[57,771,772],{"class":138},"; accepted from any ip address.\n",[57,774,775],{"class":59,"line":365},[57,776,777],{"class":138},"; Default Value: any\n",[57,779,780],{"class":59,"line":371},[57,781,782],{"class":138},"listen.allowed_clients = 127.0.0.1\n",[34,784,786],{"id":785},"拉取-picuploader-最新代码","拉取 PicUploader 最新代码",[19,788,789],{},"首先创建一个用于存放代码的目录",[48,791,793],{"className":50,"code":792,"language":52,"meta":53,"style":53},"sudo mkdir -p /var/www/\n",[39,794,795],{"__ignoreMap":53},[57,796,797,799,802,805],{"class":59,"line":60},[57,798,64],{"class":63},[57,800,801],{"class":67}," mkdir",[57,803,804],{"class":71}," -p",[57,806,807],{"class":67}," /var/www/\n",[19,809,810],{},"clone 最新源码",[48,812,814],{"className":50,"code":813,"language":52,"meta":53,"style":53},"sudo git clone https://github.com/xiebruce/PicUploader.git /var/www/picuploader\n",[39,815,816],{"__ignoreMap":53},[57,817,818,820,823,826,829],{"class":59,"line":60},[57,819,64],{"class":63},[57,821,822],{"class":67}," git",[57,824,825],{"class":67}," clone",[57,827,828],{"class":67}," https://github.com/xiebruce/PicUploader.git",[57,830,831],{"class":67}," /var/www/picuploader\n",[19,833,834],{},"将代码所有权转交给caddy用户",[48,836,838],{"className":50,"code":837,"language":52,"meta":53,"style":53},"sudo chown -R caddy:caddy /var/www/picuploader\n",[39,839,840],{"__ignoreMap":53},[57,841,842,844,847,850,853],{"class":59,"line":60},[57,843,64],{"class":63},[57,845,846],{"class":67}," chown",[57,848,849],{"class":71}," -R",[57,851,852],{"class":67}," caddy:caddy",[57,854,831],{"class":67},[34,856,858],{"id":857},"编辑caddyfile","编辑Caddyfile",[19,860,861,862,865],{},"caddy默认使用",[39,863,864],{},"/etc/caddy/Caddyfile","，因此如果你就部署这一个站点，直接修改这个就好了。",[19,867,868],{},"caddy的语法非常简洁易懂，因此我随手写了几行就能跑起来了。",[19,870,871,872,875],{},"下面是我用的Caddyfile，如果你在服务器上部署，请把",[39,873,874],{},"http://api.picuploader.com","更换为你服务器所需要绑定的域名(不带http协议头)，caddy将自动为你申请ssl证书。",[48,877,882],{"className":878,"code":880,"language":881},[879],"language-text","http://api.picuploader.com {\n        root * /var/www/picuploader\n\n        php_fastcgi * unix//run/php-fpm/php-fpm.sock {\n                index dashboard.php\n        }\n\n        file_server {\n                index index.php\n        }\n\n        handle_errors {\n        root * /etc/caddy/error\n                rewrite * /error.html\n                templates\n                file_server\n        }\n}\n\n# Import additional caddy config files in /etc/caddy/conf.d/\nimport /etc/caddy/conf.d/*\n","text",[39,883,880],{"__ignoreMap":53},[19,885,886,887,890,891,893,894,897],{},"php我选择了监听本地",[39,888,889],{},"unix//run/php-fpm/php-fpm.sock","的方案，这个路径在上文的",[39,892,426],{},"可以设置，如需查询，直接使用 ",[39,895,896],{},"grep listen\\ = /etc/php/php-fpm.d/www.conf","应该就能看见。",[95,899,901],{"id":900},"设置访问密码可选","设置访问密码（可选）",[19,903,904,905,908],{},"caddy2开始不允许在caddyfile中直接指定明文密码，因此我们需要用",[39,906,907],{},"hash-password","获取加密后的密码密文",[48,910,912],{"className":50,"code":911,"language":52,"meta":53,"style":53},"caddy hash-password  --plaintext \u003CYourPassword>\n",[39,913,914],{"__ignoreMap":53},[57,915,916,918,921,924,927,930],{"class":59,"line":60},[57,917,41],{"class":63},[57,919,920],{"class":67}," hash-password",[57,922,923],{"class":71},"  --plaintext",[57,925,926],{"class":138}," \u003C",[57,928,929],{"class":67},"YourPasswor",[57,931,932],{"class":138},"d>\n",[19,934,935],{},"再在Caddyfile中，加上",[48,937,940],{"className":938,"code":939,"language":881},[879],"basicauth /* {\n        \u003Cusername> \u003Chashed_password>\n}\n",[39,941,939],{"__ignoreMap":53},[34,943,945],{"id":944},"修改hosts设置dns解析","修改hosts/设置DNS解析",[19,947,948],{},"由于 api.picuploader.com 这个域名不在我手里，而我只是想在本地使用，并不打算部署到服务器，因此修改hosts将这个域名解析到本地是个不错的选择。",[48,950,952],{"className":50,"code":951,"language":52,"meta":53,"style":53},"sudo sh -c \"echo '127.0.0.1     api.picuploader.com'  /etc/hosts\"\n",[39,953,954],{"__ignoreMap":53},[57,955,956,958,961,964],{"class":59,"line":60},[57,957,64],{"class":63},[57,959,960],{"class":67}," sh",[57,962,963],{"class":71}," -c",[57,965,966],{"class":67}," \"echo '127.0.0.1     api.picuploader.com'  /etc/hosts\"\n",[19,968,969],{},"而你若是在服务器上部署，应当去设置DNS解析，这个应该不需要我多说。",[34,971,972],{"id":972},"开启服务",[19,974,975,976,42,978,980],{},"在Archlinux下，我习惯直接用systemd运行",[39,977,41],{},[39,979,45],{},"以开机自启动。",[48,982,984],{"className":50,"code":983,"language":52,"meta":53,"style":53},"sudo systemctl enable --now caddy php-fpm\n",[39,985,986],{"__ignoreMap":53},[57,987,988,990,993,996,999,1001],{"class":59,"line":60},[57,989,64],{"class":63},[57,991,992],{"class":67}," systemctl",[57,994,995],{"class":67}," enable",[57,997,998],{"class":71}," --now",[57,1000,75],{"class":67},[57,1002,1003],{"class":67}," php-fpm\n",[34,1005,1006],{"id":1006},"最终测试",[19,1008,1009,1010,1014],{},"在浏览器内访问 ",[26,1011,1013],{"href":874,"rel":1012},[30],"api.picuploader.com"," ，如果能看到页面，就算是成功啦。",[34,1016,1017],{"id":1017},"设置上传参数",[19,1019,1020,1021],{},"见作者博客：",[26,1022,1025],{"href":1023,"rel":1024},"https://www.xiebruce.top/117.html",[30],"PicUploader: 各图床获取上传图片参数的方法",[1027,1028,1029],"style",{},"html pre.shiki code .sAdtL, html code.shiki .sAdtL{--shiki-default:#4078F2;--shiki-dark:#61AFEF}html pre.shiki code .sDhpE, html code.shiki .sDhpE{--shiki-default:#50A14F;--shiki-dark:#98C379}html pre.shiki code .sAGMh, html code.shiki .sAGMh{--shiki-default:#986801;--shiki-dark:#D19A66}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html pre.shiki code .s5ixo, html code.shiki .s5ixo{--shiki-default:#383A42;--shiki-dark:#ABB2BF}html pre.shiki code .sJa8x, html code.shiki .sJa8x{--shiki-default:#E45649;--shiki-dark:#E06C75}",{"title":53,"searchDepth":142,"depth":142,"links":1031},[1032,1033,1041,1042,1045,1046,1047,1048],{"id":36,"depth":142,"text":36},{"id":90,"depth":142,"text":90,"children":1034},[1035,1037,1039],{"id":97,"depth":148,"text":1036},"在/etc/php/php.ini启用PicUploader所需拓展",{"id":395,"depth":148,"text":1038},"编辑/etc/php/php.ini以增加单文件上传大小限制",{"id":423,"depth":148,"text":1040},"编辑/etc/php/php-fpm.d/www.conf使其在运行时使用caddy用户。",{"id":785,"depth":142,"text":786},{"id":857,"depth":142,"text":858,"children":1043},[1044],{"id":900,"depth":148,"text":901},{"id":944,"depth":142,"text":945},{"id":972,"depth":142,"text":972},{"id":1006,"depth":142,"text":1006},{"id":1017,"depth":142,"text":1017},[1050,1056],{"title":1051,"path":1052,"stem":1053,"date":1054,"lang":1055,"children":-1},"PicUploader使用系列（二）——为KDE的dolphin添加右键快捷菜单","/2021/10/24/picuploader-with-kde-action","posts/zh/picuploader-with-kde-action","2021-10-24 22:26:50","zh-CN",{"title":1057,"path":1058,"stem":1059,"date":1060,"lang":1055,"children":-1},"Archlinux坚果云踩坑实录","/2021/10/02/nutstore-guide-on-archlinux-kde","posts/zh/nutstore-guide-on-archlinux-kde","2021-10-02 00:21:34",null,1766532349115]